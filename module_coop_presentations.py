print "Exporting coop presentations..."

from header_common import *
from header_presentations import *
from header_mission_templates import *
from ID_meshes import *
from header_operations import *
from header_triggers import *
from module_constants import *
from header_items import *
import string



####################################################################################################################
#  Each presentation record contains the following fields:
#  1) Presentation id: used for referencing presentations in other files. The prefix prsnt_ is automatically added before each presentation id.
#  2) Presentation flags. See header_presentations.py for a list of available flags
#  3) Presentation background mesh: See module_meshes.py for a list of available background meshes
#  4) Triggers: Simple triggers that are associated with the presentation
####################################################################################################################

coop_presentations = [



  ("coop_admin_panel", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (assign, "$g_presentation_obj_coop_admin_panel_1", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_2", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_3", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_4", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_5", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_6", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_7", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_8", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_9", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_10", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_11", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_12", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_13", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_14", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_15", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_16", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_17", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_18", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_19", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_20", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_21", -1),
      # (assign, "$g_presentation_obj_coop_admin_panel_22", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_23", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_24", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_25", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_26", -1),
      (assign, "$g_presentation_obj_coop_admin_panel_27", -1),



      (create_mesh_overlay, reg0, "mesh_mp_ui_host_maps_randomp"),
      (position_set_x, pos1, -1),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1002),
      (position_set_y, pos1, 1002),
      (overlay_set_size, reg0, pos1),

      (create_mesh_overlay, reg0, "mesh_mp_ui_host_main"),
      (position_set_x, pos1, -1),
      (position_set_y, pos1, -1),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1002),
      (position_set_y, pos1, 1002),
      (overlay_set_size, reg0, pos1),

#identify coop admin panel
      (create_text_overlay, reg0, "@Co-op Mode",tf_center_justify),
        (position_set_x, pos1, 850),
        (position_set_y, pos1, 500),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, reg0, pos1),


      (assign, ":cur_y", 1080),
      (assign, ":cur_y_adder", 40),


      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_admin_panel_container", s0, tf_scrollable),
      (position_set_x, pos1, 59),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_admin_panel_container", pos1),
      (position_set_x, pos1, 640),
      (position_set_y, pos1, 520),
      (overlay_set_area_size, "$g_presentation_obj_admin_panel_container", pos1),
      (set_container_overlay, "$g_presentation_obj_admin_panel_container"),

      (create_text_overlay, reg0, "str_add_to_official_game_servers_list", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_6", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_6", pos1),
      (server_get_add_to_game_servers_list, ":add_to_servers_list"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_6", ":add_to_servers_list"),

      # (val_sub, ":cur_y", ":cur_y_adder"),

      # (create_text_overlay, reg0, "str_enable_valve_anti_cheat", 0),
      # (position_set_x, pos1, 30),
      # (position_set_y, pos1, ":cur_y"),
      # (overlay_set_position, reg0, pos1),

      # (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_22", "mesh_checkbox_off", "mesh_checkbox_on"),
      # (position_set_x, pos1, 7),
      # (store_add, ":special_cur_y", ":cur_y", 7),
      # (position_set_y, pos1, ":special_cur_y"),
      # (overlay_set_position, "$g_presentation_obj_coop_admin_panel_22", pos1),
      # (server_get_anti_cheat, ":server_anti_cheat"),
      # (overlay_set_val, "$g_presentation_obj_coop_admin_panel_22", ":server_anti_cheat"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_server_name", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (str_store_server_name, s0),
      (try_begin),
        (eq, "$g_multiplayer_renaming_server_allowed", 1),
        (create_simple_text_box_overlay, "$g_presentation_obj_coop_admin_panel_9"),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_9", pos1),
        (overlay_set_text, "$g_presentation_obj_coop_admin_panel_9", s0),
      (else_try),
        (assign, "$g_presentation_obj_coop_admin_panel_9", -1),
        (create_text_overlay, reg0, s0, 0),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
      (try_end),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_game_password", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_simple_text_box_overlay, "$g_presentation_obj_coop_admin_panel_4"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_4", pos1),
      (str_store_server_password, s0),
      (overlay_set_text, "$g_presentation_obj_coop_admin_panel_4", s0),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_welcome_message", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_simple_text_box_overlay, "$g_presentation_obj_coop_admin_panel_18"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_18", pos1),
      (str_store_welcome_message, s0),
      (overlay_set_text, "$g_presentation_obj_coop_admin_panel_18", s0),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_map", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (try_begin),
        (is_between, "$coop_battle_scene", multiplayer_scenes_begin, multiplayer_scenes_end),
        (store_sub, ":string_id", "$coop_battle_scene", multiplayer_scenes_begin),
        (val_add, ":string_id", multiplayer_scene_names_begin),
        (str_store_string, s0, ":string_id"),
      (else_try),
        (call_script, "script_coop_get_scene_name", "$coop_battle_scene"),#if not random map use party name
      (try_end),

        (create_text_overlay, reg0, s0, 0),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),


      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_game_type", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),


        (store_add, ":string_index", "$g_multiplayer_game_type", multiplayer_game_type_names_begin),
        (str_store_string, s0, ":string_index"),
        (create_text_overlay, reg0, s0, 0),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),


      (val_sub, ":cur_y", ":cur_y_adder"),

      (assign, reg1, 1),
      (create_text_overlay, reg0, "str_team_reg1_faction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),



      (str_store_faction_name, s0, "$coop_team_1_faction"),
      (create_text_overlay, reg0, s0, 0),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),


      (val_sub, ":cur_y", ":cur_y_adder"),

      (assign, reg1, 2),
      (create_text_overlay, reg0, "str_team_reg1_faction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (str_store_faction_name, s0, "$coop_team_2_faction"),
      (create_text_overlay, reg0, s0, 0),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (val_sub, ":cur_y", ":cur_y_adder"),


      (create_text_overlay, reg0, "@Team 1 troops:", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (assign, reg1, "$coop_team_1_troop_num"),
      (create_text_overlay, reg0, "str_reg1", 0),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (val_sub, ":cur_y", ":cur_y_adder"),


      (create_text_overlay, reg0, "@Team 2 troops:", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (assign, reg1, "$coop_team_2_troop_num"),
      (create_text_overlay, reg0, "str_reg1", 0),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),


      (val_sub, ":cur_y", ":cur_y_adder"),

      (assign, reg1, 1),
      (create_text_overlay, reg0, "str_max_number_of_players", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_number_box_overlay, "$g_presentation_obj_coop_admin_panel_10", 2, 65),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_10", pos1),
      (server_get_max_num_players, ":max_players"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_10", ":max_players"),

      (val_sub, ":cur_y", ":cur_y_adder"),


      (create_text_overlay, reg0, "@Battle size:", 0),

      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_number_box_overlay, "$g_presentation_obj_coop_admin_panel_2", coop_min_battle_size, coop_max_battle_size),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_2", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_2", "$coop_battle_size"),


        (val_sub, ":cur_y", ":cur_y_adder"),

        (create_text_overlay, reg0, "str_allow_friendly_fire", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),

        (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_3", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":special_cur_y", ":cur_y", 7),
        (position_set_y, pos1, ":special_cur_y"),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_3", pos1),
        (server_get_friendly_fire, ":server_friendly_fire"),
        (overlay_set_val, "$g_presentation_obj_coop_admin_panel_3", ":server_friendly_fire"),

        (val_sub, ":cur_y", ":cur_y_adder"),

        (create_text_overlay, reg0, "str_allow_melee_friendly_fire", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),

        (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_19", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":special_cur_y", ":cur_y", 7),
        (position_set_y, pos1, ":special_cur_y"),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_19", pos1),
        (server_get_melee_friendly_fire, ":melee_friendly_fire"),
        (overlay_set_val, "$g_presentation_obj_coop_admin_panel_19", ":melee_friendly_fire"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_friendly_fire_damage_self_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_number_box_overlay, "$g_presentation_obj_coop_admin_panel_20", 0, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_20", pos1),
      (server_get_friendly_fire_damage_self_ratio, ":friendly_fire_damage_self_ratio"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_20", ":friendly_fire_damage_self_ratio"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_friendly_fire_damage_friend_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_number_box_overlay, "$g_presentation_obj_coop_admin_panel_21", 0, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_21", pos1),
      (server_get_friendly_fire_damage_friend_ratio, ":friendly_fire_damage_friend_ratio"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_21", ":friendly_fire_damage_friend_ratio"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_spectator_camera", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_combo_button_overlay, "$g_presentation_obj_coop_admin_panel_8"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_coop_admin_panel_8", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_8", pos1),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_8", "str_free"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_8", "str_stick_to_any_player"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_8", "str_stick_to_team_members"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_8", "str_stick_to_team_members_view"),
      (server_get_ghost_mode, ":server_ghost_mode"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_8", ":server_ghost_mode"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_control_block_direction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_combo_button_overlay, "$g_presentation_obj_coop_admin_panel_7"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_coop_admin_panel_7", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_7", pos1),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_7", "str_automatic"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_7", "str_by_mouse_movement"),
      (server_get_control_block_dir, ":server_control_block_dir"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_7", ":server_control_block_dir"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_combat_speed", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_combo_button_overlay, "$g_presentation_obj_coop_admin_panel_14"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_coop_admin_panel_14", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_14", pos1),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_14", "str_combat_speed_0"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_14", "str_combat_speed_1"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_14", "str_combat_speed_2"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_14", "str_combat_speed_3"),
      (overlay_add_item, "$g_presentation_obj_coop_admin_panel_14", "str_combat_speed_4"),
      (server_get_combat_speed, ":server_combat_speed"),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_14", ":server_combat_speed"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_make_kick_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_15", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_15", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_15", "$g_multiplayer_kick_voteable"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_make_ban_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_16", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_16", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_16", "$g_multiplayer_ban_voteable"),



      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "str_valid_vote_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_number_box_overlay, "$g_presentation_obj_coop_admin_panel_17", 50, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_17", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_17", "$g_multiplayer_valid_vote_ratio"),

        (val_sub, ":cur_y", ":cur_y_adder"),

        (create_text_overlay, reg0, "str_players_take_control_of_a_bot_after_death", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),

        (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_13", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":special_cur_y", ":cur_y", 7),
        (position_set_y, pos1, ":special_cur_y"),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_13", pos1),
        (overlay_set_val, "$g_presentation_obj_coop_admin_panel_13", "$g_multiplayer_player_respawn_as_bot"),


# multiplayer_game_type
      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "@Use spawn formations", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_12", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_12", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_12", "$coop_battle_spawn_formation"),

# multiplayer_game_type
      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "@Skip menu buttons", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_11", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_11", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_11", "$coop_skip_menu"),
###
      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "@Disable active inventory", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_25", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_25", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_25", "$coop_disable_inventory"),

      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "@Reduce damage to players", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_26", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_26", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_26", "$coop_reduce_damage"),
###
      (val_sub, ":cur_y", ":cur_y_adder"),

      (create_text_overlay, reg0, "@Prevent companions from being captured", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (create_check_box_overlay, "$g_presentation_obj_coop_admin_panel_27", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":special_cur_y", ":cur_y", 7),
      (position_set_y, pos1, ":special_cur_y"),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_27", pos1),
      (overlay_set_val, "$g_presentation_obj_coop_admin_panel_27", "$coop_no_capture_heroes"),

      (set_container_overlay, -1),

      (create_button_overlay, "$g_presentation_obj_coop_admin_panel_5", "str_back", tf_center_justify),
      (position_set_x, pos1, 825),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_coop_admin_panel_5", pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, "$g_presentation_obj_coop_admin_panel_5", pos1),

      (try_begin),
        (eq, "$coop_battle_state", coop_battle_state_setup_mp),
        (create_button_overlay, "$g_presentation_obj_coop_admin_panel_1", "str_start_map", tf_center_justify),
        (position_set_x, pos1, 825),
        (position_set_y, pos1, 90),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_1", pos1),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_obj_coop_admin_panel_1", pos1),
      (try_end),

      (try_begin),
        (neg|multiplayer_is_server), #we are admin on ded server
        (try_begin),
          (eq, "$coop_battle_state", coop_battle_state_setup_sp), #battle is setup from SP
          (create_button_overlay, "$g_presentation_obj_coop_admin_panel_23", "@Load Battle", tf_center_justify),
          (position_set_x, pos1, 825),
          (position_set_y, pos1, 130),
          (overlay_set_position, "$g_presentation_obj_coop_admin_panel_23", pos1),
          (position_set_x, pos1, 1500),
          (position_set_y, pos1, 1500),
          (overlay_set_size, "$g_presentation_obj_coop_admin_panel_23", pos1),
        (try_end),

        (create_button_overlay, "$g_presentation_obj_coop_admin_panel_24", "@Native Admin Panel", tf_center_justify),
        (position_set_x, pos1, 825),
        (position_set_y, pos1, 170),
        (overlay_set_position, "$g_presentation_obj_coop_admin_panel_24", pos1),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_obj_coop_admin_panel_24", pos1),
      (try_end),

      (presentation_set_duration, 999999),

      ]),

    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (store_trigger_param_2, ":value"),
      (try_begin),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_1"),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_start_map),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_2"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_battle_size, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_3"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_friendly_fire, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_4"),
        (multiplayer_send_string_to_server, multiplayer_event_admin_set_game_password, s0),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_5"), #back
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_6"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_add_to_servers_list, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_7"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_control_block_dir, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_8"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_ghost_mode, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_9"),
        (multiplayer_send_string_to_server, multiplayer_event_admin_set_server_name, s0),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_10"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_max_num_players, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_11"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_skip_admin_panel, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_12"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_spawn_formation, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_13"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_player_respawn_as_bot, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_14"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_combat_speed, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_15"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_kick_voteable, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_16"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_ban_voteable, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_17"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_valid_vote_ratio, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_18"),
        (server_set_welcome_message, s0),
        (multiplayer_send_string_to_server, multiplayer_event_admin_set_welcome_message, s0),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_19"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_melee_friendly_fire, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_20"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_friendly_fire_damage_self_ratio, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_21"),
        (multiplayer_send_int_to_server, multiplayer_event_admin_set_friendly_fire_damage_friend_ratio, ":value"),
      # (else_try),
        # (eq, ":object", "$g_presentation_obj_coop_admin_panel_22"),
        # (multiplayer_send_int_to_server, multiplayer_event_admin_set_anti_cheat, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_23"),
        (presentation_set_duration, 0),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_setup_battle),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_24"),
        (presentation_set_duration, 0),
        (call_script, "script_game_quick_start"),
        (multiplayer_send_message_to_server, multiplayer_event_open_admin_panel),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_25"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_disable_inventory, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_26"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_reduce_damage, ":value"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_coop_admin_panel_27"),
        (multiplayer_send_2_int_to_server, multiplayer_event_coop_send_to_server, coop_event_no_capture_heroes, ":value"),
      (try_end),
      ]),
    (ti_on_presentation_run,
     [
      (try_begin),
        (key_clicked, key_escape),
        (presentation_set_duration, 0),
      (try_end),

      ]),
    ]),





######################################################
  ("coop_troop_select", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),

      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_troop_select_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_troop_select_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),#500
      (overlay_set_area_size, "$g_presentation_obj_troop_select_container", pos1),
      (set_container_overlay, "$g_presentation_obj_troop_select_container"),

###############
      (multiplayer_get_my_team, ":my_team_no"),
      (assign, ":hero_party", 0),
      (try_begin),
        (eq, ":my_team_no", 0),
        (assign, ":hero_party", coop_temp_party_enemy_heroes),
      (else_try),
        (eq, ":my_team_no", 1),
        (assign, ":hero_party", coop_temp_party_ally_heroes),
      (try_end),

      (party_get_num_companion_stacks, ":num_heroes", ":hero_party"),

      (assign, ":total_y",  ":num_heroes"),
      (val_add, ":total_y", "$g_multiplayer_player_respawn_as_bot"), #NEW 0, 1 if respawn as bot

      (val_mul, ":total_y", escape_menu_item_height),
      (assign, ":cur_y",  ":total_y"), #450

      (create_text_overlay, reg0, "str_choose_a_troop", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),

      (position_set_x, pos1, 100),
 
      (try_for_range, ":stack", 0, ":num_heroes"),
 
        (party_stack_get_troop_id, ":troop_no", ":hero_party", ":stack"),	

        (assign, ":break", 0),
        (get_max_players, ":num_players"),
        (try_for_range, ":all_player_no", 0, ":num_players"), #if troop is picked but not spawned
          (player_is_active, ":all_player_no"),
          (player_get_slot, ":other_player_selected_troop", ":all_player_no", slot_player_coop_selected_troop), 
          (eq, ":other_player_selected_troop", ":troop_no"),
          (assign, ":num_players", 0),
          (assign, ":break", 1),
        (try_end),

        (eq, ":break", 0),
        (assign, ":stop", 0),
        (try_for_agents, ":cur_agent"), #dont show this troop if dead or already controlled
          (eq, ":stop", 0),
          (agent_is_human, ":cur_agent"),
          (assign, ":break", 1), #if agents have spawned
          (agent_get_troop_id, ":agent_troop_no", ":cur_agent"),
          (eq, ":agent_troop_no", ":troop_no"),
          (assign, ":stop", 1), #if this troop is found stop trying agents
          (agent_is_alive, ":cur_agent"),#is alive
          (agent_is_non_player, ":cur_agent"),#is not player
          (assign, ":break", 0), #if agent is available then continue
        (try_end),

        (eq, ":break", 0),
        (str_store_troop_name, s1, ":troop_no"),
        (create_button_overlay, reg0, s1, 0),
        (overlay_set_color, reg0, 0xFFFFFF), 

          #native uses multi_data_troop_button_indices_begin which limits to 16 troops per team
        (troop_set_slot, "trp_temp_array_c", reg0, ":troop_no"), #store troop id in slot = object

        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
      (try_end),

      (try_begin),
        (eq, "$g_multiplayer_player_respawn_as_bot", 1), #0, 1 if respawn as bot
        (str_store_string, s1, "@Random troop"),
        (create_button_overlay, "$g_presentation_obj_coop_troop_select_rand", s1, 0),
        (overlay_set_color, "$g_presentation_obj_coop_troop_select_rand", 0xFFFFFF), 
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_coop_troop_select_rand", pos1),
      (try_end),

      (presentation_set_duration, 999999),
      ]),
   
    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (try_begin),
        (eq, ":object", "$g_presentation_obj_coop_troop_select_rand"),
        (assign, "$coop_my_troop_no", 0),
        (presentation_set_duration, 0),
      (else_try),
        (troop_get_slot, "$coop_my_troop_no", "trp_temp_array_c", ":object"), #trp_temp_array_c slot_no = object_no
        (try_begin),
          (multiplayer_get_my_player, ":my_player_no"),
          (player_get_agent_id, ":player_agent", ":my_player_no"),
          (this_or_next|eq, ":player_agent", -1),#if spectator
          (neg|agent_is_alive, ":player_agent"), #if dead
          (player_set_troop_id, ":my_player_no", "$coop_my_troop_no"),#NEW
          (multiplayer_send_int_to_server, multiplayer_event_change_troop_id, "$coop_my_troop_no"),
        (try_end),

        (presentation_set_duration, 0),
        (assign, "$g_presentation_state", 0),
        (start_presentation, "prsnt_coop_commander_select"),
      (try_end),

      ]),
    (ti_on_presentation_run,
     [

      (try_begin),
        (eq, "$coop_refresh_troop_select_presentation", 1),
        (assign, "$coop_refresh_troop_select_presentation", 0),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_troop_select"),
      (try_end),


      (try_begin),
        (key_clicked, key_escape),
#        (multiplayer_get_my_player, ":my_player_no"),
#        (is_between, ":my_player_no", 0, multiplayer_max_possible_player_id),
#        (multiplayer_get_my_troop, ":my_troop"),
#        (try_begin), #spectator
#          (neg|is_between, ":my_troop", active_npcs_including_player_begin, active_npcs_end), 
#          (player_set_troop_id, ":my_player_no", -1),
#          (multiplayer_send_int_to_server, multiplayer_event_change_troop_id, -1),
#          (multiplayer_send_int_to_server, multiplayer_event_change_team_no, multi_team_spectator),
#          (player_set_team_no, ":my_player_no", multi_team_spectator),
#        (try_end),
        (presentation_set_duration, 0),
      (try_end),
      ]),
    ]),



####################################################
#USE FOR LEADER TROOP ONLY
  ("coop_commander_select", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (assign, "$g_presentation_obj_commander_select_11", -1),

      (assign, "$g_presentation_obj_commander_select_13", -1),
      (assign, "$g_presentation_obj_commander_select_14", -1),
      (assign, "$g_presentation_obj_commander_select_15", -1),
      (assign, "$g_presentation_obj_commander_select_16", -1),
      (assign, "$g_presentation_obj_commander_select_17", -1),
      (assign, "$g_presentation_obj_commander_select_18", -1),
      (assign, "$g_presentation_obj_commander_select_19", -1),
      (assign, "$g_presentation_obj_commander_select_20", -1),
      (assign, "$g_presentation_obj_commander_select_21", -1),
      (assign, "$g_presentation_obj_commander_select_22", -1),
      (assign, "$g_presentation_obj_commander_select_23", -1),
      (assign, "$g_presentation_obj_commander_select_24", -1),
      (assign, "$g_presentation_obj_commander_select_25", -1),

      (multiplayer_get_my_player, ":my_player_no"),
      (player_get_team_no, ":my_team_no", ":my_player_no"),


      (create_button_overlay, "$g_presentation_obj_commander_select_11", "str_done", 0),
      (overlay_set_color, "$g_presentation_obj_commander_select_11", 0xFFFFFF),
      (position_set_x, pos1, 430),
      (position_set_y, pos1, 60),
      (overlay_set_position, "$g_presentation_obj_commander_select_11", pos1),

      (assign, ":cur_y", 620),

      (try_begin),

      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 20),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1120),
      (overlay_set_size, reg0, pos1),


        (create_text_overlay, reg0, "str_command", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 300),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (val_sub, ":cur_y", escape_menu_item_height),

        (assign, ":num_options", 4),
        (try_begin),
          (eq, ":my_team_no", 1),#on main party team
          (neg|is_between, "$coop_my_troop_no", kings_begin, pretenders_end), #assume all ally lords are in other parties
          (assign, ":num_options", 13),
        (try_end),


        (try_for_range, ":cur_ai_troop_index", 0, ":num_options"),#13 options
          (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
          (position_set_x, pos1, 400),
          (store_add, ":special_cur_y", ":cur_y", 2),
          (position_set_y, pos1, ":special_cur_y"),
          (overlay_set_position, reg0, pos1),
          (try_begin),
            (eq, ":cur_ai_troop_index", 0),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_1_wanted"),
            (assign, "$g_presentation_obj_commander_select_13", reg0),
            (str_store_string, s0, "@All troops in party"),
          (else_try),
            (eq, ":cur_ai_troop_index", 1),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_2_wanted"),
            (assign, "$g_presentation_obj_commander_select_14", reg0),
            (str_store_string, s0, "@Infantry in party"),
          (else_try),
            (eq, ":cur_ai_troop_index", 2),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_3_wanted"),
            (assign, "$g_presentation_obj_commander_select_15", reg0),
            (str_store_string, s0, "@Archers in party"),
          (else_try),
            (eq, ":cur_ai_troop_index", 3),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_4_wanted"),
            (assign, "$g_presentation_obj_commander_select_16", reg0),
            (str_store_string, s0, "@Cavalry in party"),
          (else_try),
            (eq, ":cur_ai_troop_index", 4),
            (overlay_set_val, reg0, "$coop_class_0_wanted"),
            (assign, "$g_presentation_obj_commander_select_17", reg0),
            (str_store_class_name, s0, 0), 
          (else_try),
            (eq, ":cur_ai_troop_index", 5),
            (overlay_set_val, reg0, "$coop_class_1_wanted"),
            (assign, "$g_presentation_obj_commander_select_18", reg0),
            (str_store_class_name, s0, 1), 
          (else_try),
            (eq, ":cur_ai_troop_index", 6),
            (overlay_set_val, reg0, "$coop_class_2_wanted"),
            (assign, "$g_presentation_obj_commander_select_19", reg0),
            (str_store_class_name, s0, 2), 
          (else_try),
            (eq, ":cur_ai_troop_index", 7),
            (overlay_set_val, reg0, "$coop_class_3_wanted"),
            (assign, "$g_presentation_obj_commander_select_20", reg0),
            (str_store_class_name, s0, 3), 
          (else_try),
            (eq, ":cur_ai_troop_index", 8),
            (overlay_set_val, reg0, "$coop_class_4_wanted"),
            (assign, "$g_presentation_obj_commander_select_21", reg0),
            (str_store_class_name, s0, 4), 
          (else_try),
            (eq, ":cur_ai_troop_index", 9),
            (overlay_set_val, reg0, "$coop_class_5_wanted"),
            (assign, "$g_presentation_obj_commander_select_22", reg0),
            (str_store_class_name, s0, 5), 
          (else_try),
            (eq, ":cur_ai_troop_index", 10),
            (overlay_set_val, reg0, "$coop_class_6_wanted"),
            (assign, "$g_presentation_obj_commander_select_23", reg0),
            (str_store_class_name, s0, 6), 
          (else_try),
            (eq, ":cur_ai_troop_index", 11),
            (overlay_set_val, reg0, "$coop_class_7_wanted"),
            (assign, "$g_presentation_obj_commander_select_24", reg0),
            (str_store_class_name, s0, 7), 
          (else_try),
            (eq, ":cur_ai_troop_index", 12),
            (overlay_set_val, reg0, "$coop_class_8_wanted"),
            (assign, "$g_presentation_obj_commander_select_25", reg0),
            (str_store_class_name, s0, 8), 
          (try_end),

          (create_text_overlay, reg0, "str_s0", 0), #s0
          (overlay_set_color, reg0, 0xFFFFFF),

          (position_set_x, pos1, 430),
          (position_set_y, pos1, ":cur_y"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":cur_y", escape_menu_item_height),#escape_menu_item_height

        (try_end),
        (val_sub, ":cur_y", escape_menu_item_height),
      (try_end),
      (presentation_set_duration, 999999),
      ]),
            
    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (store_trigger_param_2, ":value"),
        (try_begin),
          (eq, ":object", "$g_presentation_obj_commander_select_11"),
          (presentation_set_duration, 0),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_13"),
          (assign, "$g_multiplayer_bot_type_1_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_bot_type_1_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_14"),
          (assign, "$g_multiplayer_bot_type_2_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_bot_type_2_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_15"),
          (assign, "$g_multiplayer_bot_type_3_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_bot_type_3_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_16"),
          (assign, "$g_multiplayer_bot_type_4_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_bot_type_4_wanted, ":value"),
        (else_try),

          (eq, ":object", "$g_presentation_obj_commander_select_17"),
          (assign, "$coop_class_0_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_0_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_18"),
          (assign, "$coop_class_1_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_1_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_19"),
          (assign, "$coop_class_2_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_2_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_20"),
          (assign, "$coop_class_3_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_3_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_21"),
          (assign, "$coop_class_4_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_4_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_22"),
          (assign, "$coop_class_5_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_5_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_23"),
          (assign, "$coop_class_6_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_6_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_24"),
          (assign, "$coop_class_7_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_7_wanted, ":value"),
        (else_try),
          (eq, ":object", "$g_presentation_obj_commander_select_25"),
          (assign, "$coop_class_8_wanted", ":value"),
          (multiplayer_send_2_int_to_server, multiplayer_event_set_bot_selection, slot_player_coop_class_8_wanted, ":value"),
        (try_end),

      ]),
    
    
    (ti_on_presentation_run,
     [

## this causes an error sometimes
##      (multiplayer_get_my_player, ":my_player_no"),
##      (player_get_gold, ":player_gold", ":my_player_no"),
##      (call_script, "script_multiplayer_calculate_cur_selected_items_cost", ":my_player_no", 1),      
##      (try_begin),
##        (ge, ":player_gold", reg0),
##        (overlay_set_color, "$g_presentation_obj_commander_select_12", 0xFFFFFF),
##      (else_try),
##        (overlay_set_color, "$g_presentation_obj_commander_select_12", 0xFF0000),
##      (try_end),

      (try_begin),
          (key_clicked, key_escape),
          (presentation_set_duration, 0),
      (try_end),
      ]),
    ]),
############################################################


  ("coop_team_select", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),

      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_team_select_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_team_select_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_team_select_container", pos1),
      (set_container_overlay, "$g_presentation_obj_team_select_container"),

      (assign, ":cur_y", 450),

      (create_text_overlay, reg0, "str_choose_a_faction", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (position_set_x, pos1, 100),

      (multiplayer_get_my_player, ":my_player_no"),
      (team_get_faction, ":faction_no", 0),
      (str_store_faction_name, s0, ":faction_no"),
      (create_button_overlay, "$g_presentation_obj_team_select_1", s0, 0),
      (try_begin),
        (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 0),
        (overlay_set_color, "$g_presentation_obj_team_select_1", 0xFFFFFF),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_1", 0x55FF50),
        (assign, "$g_multiplayer_team_select_1_available", 1),
      (else_try),
        (overlay_set_color, "$g_presentation_obj_team_select_1", 0x888888),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_1", 0x888888),
        (assign, "$g_multiplayer_team_select_1_available", 0),
      (try_end),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_team_select_1", pos1),
      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),

      (team_get_faction, ":faction_no", 1),
      (str_store_faction_name, s0, ":faction_no"),
      (create_button_overlay, "$g_presentation_obj_team_select_2", s0, 0),
      (try_begin),
        (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 1),
        (overlay_set_color, "$g_presentation_obj_team_select_2", 0xFFFFFF),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_2", 0x55FF50),
        (assign, "$g_multiplayer_team_select_2_available", 1),
      (else_try),
        (overlay_set_color, "$g_presentation_obj_team_select_2", 0x888888),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_2", 0x888888),
        (assign, "$g_multiplayer_team_select_2_available", 0),
      (try_end),
      (overlay_set_position, "$g_presentation_obj_team_select_2", pos1),
      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),

      (create_button_overlay, "$g_presentation_obj_team_select_3", "str_spectator", 0),
      (overlay_set_color, "$g_presentation_obj_team_select_3", 0xFFFFFF),
      (overlay_set_position, "$g_presentation_obj_team_select_3", pos1),
      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),

      (presentation_set_duration, 999999),
      ]),

    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (multiplayer_get_my_player, ":my_player_no"),
      (try_begin),
        (eq, "$g_waiting_for_confirmation_to_terminate", 0),
        (try_begin),
          (eq, ":object", "$g_presentation_obj_team_select_1"),
          (try_begin),
            (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 0),
            (try_begin),
              (player_get_team_no, ":my_team", ":my_player_no"),
              (neq, ":my_team", 0),
              (assign, "$g_confirmation_result", 0),
              (assign, "$g_waiting_for_confirmation_to_terminate", 1),
              (player_get_troop_id, "$g_confirmation_troop_backup", ":my_player_no"),
              (player_get_team_no, "$g_confirmation_team_backup", ":my_player_no"),
              (player_set_troop_id, ":my_player_no", -1),
              (multiplayer_send_int_to_server, multiplayer_event_change_team_no, 0),
              (player_set_team_no, ":my_player_no", 0),
              (assign, "$coop_my_team", 0), #
            (else_try),
              (presentation_set_duration, 0),
              (start_presentation, "prsnt_coop_troop_select"),
            (try_end),
          (try_end),
        (else_try),
          (eq, ":object", "$g_presentation_obj_team_select_2"),
          (try_begin),
            (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 1),
            (try_begin),
              (player_get_team_no, ":my_team", ":my_player_no"),
              (neq, ":my_team", 1),
              (assign, "$g_confirmation_result", 0),
              (assign, "$g_waiting_for_confirmation_to_terminate", 1),
              (player_get_troop_id, "$g_confirmation_troop_backup", ":my_player_no"),
              (player_get_team_no, "$g_confirmation_team_backup", ":my_player_no"),
              (player_set_troop_id, ":my_player_no", -1),
              (multiplayer_send_int_to_server, multiplayer_event_change_team_no, 1),
              (player_set_team_no, ":my_player_no", 1),
              (assign, "$coop_my_team", 1), #
            (else_try),
              (presentation_set_duration, 0),
              (start_presentation, "prsnt_coop_troop_select"),
            (try_end),
          (try_end),
        (else_try),
          (eq, ":object", "$g_presentation_obj_team_select_3"),
          (player_set_troop_id, ":my_player_no", -1),
          (multiplayer_send_int_to_server, multiplayer_event_change_team_no, multi_team_spectator),
          (player_set_team_no, ":my_player_no", multi_team_spectator),
          (assign, "$coop_my_team", multi_team_spectator), #
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
      ]),

    (ti_on_presentation_run,
     [
      (multiplayer_get_my_player, ":my_player_no"),
      (try_begin),
        (key_clicked, key_escape),
        (eq, "$g_waiting_for_confirmation_to_terminate", 0),
        (multiplayer_get_my_team, ":my_team"),
        (try_begin),
          (eq, ":my_team", multi_team_unassigned),
          (player_set_troop_id, ":my_player_no", -1),
          (multiplayer_send_int_to_server, multiplayer_event_change_team_no, multi_team_spectator),
          (player_set_team_no, ":my_player_no", multi_team_spectator),
        (try_end),
        (presentation_set_duration, 0),
      (else_try),
        (eq, "$g_waiting_for_confirmation_to_terminate", 1),
        (eq, "$g_confirmation_result", 1),
        (assign, "$g_waiting_for_confirmation_to_terminate", 0),
        (assign, "$g_confirmation_result", 0),
        (presentation_set_duration, 0),
        # coop only show troop select if heroes are available
        (multiplayer_get_my_team, ":my_team"),
        (try_begin),
          (eq, ":my_team", 0),
          (party_get_num_companion_stacks, ":num_heroes", coop_temp_party_enemy_heroes),
          (gt, ":num_heroes", 0),
          (start_presentation, "prsnt_coop_troop_select"),
        (else_try),
          (eq, ":my_team", 1),
          (party_get_num_companion_stacks, ":num_heroes", coop_temp_party_ally_heroes),
          (gt, ":num_heroes", 0),
          (start_presentation, "prsnt_coop_troop_select"),
        (try_end),

      (else_try),
        (eq, "$g_waiting_for_confirmation_to_terminate", 1),
        (eq, "$g_confirmation_result", -1),
        #return troop and team back to the old state
        (player_set_troop_id, ":my_player_no", "$g_confirmation_troop_backup"),
        (player_set_team_no, ":my_player_no", "$g_confirmation_team_backup"),
        (assign, "$g_waiting_for_confirmation_to_terminate", 0),
        (assign, "$g_confirmation_result", 0),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_team_select"),
      (else_try),
        (assign, ":do_refresh", 0),
        (try_begin),
          (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 0),
          (try_begin),
            (eq, "$g_multiplayer_team_select_1_available", 0),
            (assign, ":do_refresh", 1),
          (try_end),
        (else_try),
          #not available
          (try_begin),
            (eq, "$g_multiplayer_team_select_1_available", 1),
            (assign, ":do_refresh", 1),
          (try_end),
        (try_end),
        (try_begin),
          (call_script, "script_cf_multiplayer_team_is_available", ":my_player_no", 1),
          (try_begin),
            (eq, "$g_multiplayer_team_select_2_available", 0),
            (assign, ":do_refresh", 1),
          (try_end),
        (else_try),
          #not available
          (try_begin),
            (eq, "$g_multiplayer_team_select_2_available", 1),
            (assign, ":do_refresh", 1),
          (try_end),
        (try_end),
        (eq, ":do_refresh", 1),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_team_select"),
      (try_end),
      ]),
    ]),





  ("coop_start_battle", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (assign, "$g_presentation_obj_start_battle_1", -1),

      (try_begin),
        (create_in_game_button_overlay, "$g_presentation_obj_start_battle_1", "@Start battle.", 0),
        (overlay_set_color, "$g_presentation_obj_start_battle_1", 0xFFFFFF),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 700),
        (overlay_set_position, "$g_presentation_obj_start_battle_1", pos1),
      (try_end),

      (presentation_set_duration, 999999),
      ]),
            
    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (try_begin),
        (eq, ":object", "$g_presentation_obj_start_battle_1"),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_start_battle),
        (presentation_set_duration, 0),
      (try_end),
      ]),
    
    (ti_on_presentation_run,
     [
        (eq, "$coop_battle_started", 1),
        (presentation_set_duration, 0),

      ]),


    ]),

  ("coop_welcome_message", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),
      (str_store_welcome_message, s0),
      (try_begin),
        (neg|str_is_empty, s0),
        (eq, "$g_multiplayer_welcome_message_shown", 0),
        (create_mesh_overlay, reg0, "mesh_mp_ui_welcome_panel"),
        (position_set_x, pos1, 200),
        (position_set_y, pos1, 400),
        (overlay_set_position, reg0, pos1),
        (create_text_overlay, reg0, s0, tf_scrollable),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 230),
        (position_set_y, pos1, 425),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 540),
        (position_set_y, pos1, 150),
        (overlay_set_area_size, reg0, pos1),

        (presentation_set_duration, 999999),
      (else_try),
        (eq, "$g_multiplayer_show_server_rules", 1),
        (create_mesh_overlay, reg0, "mesh_mp_ui_welcome_panel"),
        (position_set_x, pos1, 200),
        (position_set_y, pos1, 400),
        (overlay_set_position, reg0, pos1),
        (try_begin),
          (neg|str_is_empty, s0),
          (str_clear, s3),
          (str_store_string, s2, s0),
          (str_store_string, s2, "str_s2_s3"),
          (str_store_string, s2, "str_s2_s3"),
        (else_try),
          (str_clear, s2),
        (try_end),
        (str_store_string, s3, "@Game Rules:^"),
        (str_store_string, s2, "str_s2_s3"),
        (assign, ":end_cond", 1000),
        (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
        (assign, ":cur_mt", reg0),
        
        (str_store_server_name, s0),
        (str_store_string, s3, "str_server_name_s0"),
        (str_store_string, s2, "str_s2_s3"),        

        (try_begin),                
          (eq, "$g_multiplayer_game_type", multiplayer_game_type_coop_battle),
          (str_store_string, s0, "str_multi_game_type_9"),
        (else_try),
          (eq, "$g_multiplayer_game_type", multiplayer_game_type_coop_siege),
          (str_store_string, s0, "str_multi_game_type_10"),
        (try_end),
        (str_store_string, s3, "str_game_type_s0"),
        (str_store_string, s2, "str_s2_s3"),   

        (store_current_scene, ":cur_scene"),
        # (val_sub, ":cur_scene", "scn_multi_scene_1"),
        # (val_add, ":cur_scene", "str_multi_scene_1"),
        # (str_store_string, s0, ":cur_scene"),
        (try_begin),
          (is_between, ":cur_scene", multiplayer_scenes_begin, multiplayer_scenes_end),
          (store_sub, ":string_id", ":cur_scene", multiplayer_scenes_begin),
          (val_add, ":string_id", multiplayer_scene_names_begin),
          (str_store_string, s0, ":string_id"),
        (else_try),
          (call_script, "script_coop_get_scene_name", ":cur_scene"),#if not random map use party name
        (try_end),
        (str_store_string, s3, "str_map_name_s0"),
        (str_store_string, s2, "str_s2_s3"),
        
        (store_mission_timer_a, ":mission_timer"),
        (val_add, ":mission_timer", "$server_mission_timer_while_player_joined"),
        (assign, reg0, ":mission_timer"),       
        (store_mul, "$g_multiplayer_game_max_seconds", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":remaining_seconds", "$g_multiplayer_game_max_seconds", ":mission_timer"),
        (store_div, reg0, ":remaining_seconds", 60),
        (store_mod, reg1, ":remaining_seconds", 60),
        (try_begin),
          (ge, reg0, 10),
          (ge, reg1, 10),          
          (str_clear, s0),
          (str_clear, s1),
        (else_try),  
          (ge, reg0, 10),
          (str_clear, s0),
          (str_store_string, s1, "@0"),
        (else_try),  
          (ge, reg1, 10),
          (str_store_string, s0, "@0"),
          (str_clear, s1),
        (else_try),  
          (str_store_string, s0, "@0"),
          (str_store_string, s1, "@0"),
        (try_end),
        (str_store_string, s3, "str_remaining_time_s0reg0_s1reg1"),
        
        (str_store_string, s2, "str_s2_s3"),

        (try_for_range, ":cur_option", 0, ":end_cond"),
          (assign, reg0, -12345), #magic number
          (call_script, "script_game_get_multiplayer_server_option_for_mission_template", ":cur_mt", ":cur_option"),
          (try_begin),
            (eq, reg0, -12345),
            (assign, ":end_cond", 0),
          (else_try),
            (call_script, "script_game_multiplayer_server_option_for_mission_template_to_string", ":cur_mt", ":cur_option", reg0),
            (str_store_string, s3, s0),
            (str_store_string, s2, "str_s2_s3"),
          (try_end),
        (try_end),        
        (create_text_overlay, reg0, s2, tf_scrollable),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 230),
        (position_set_y, pos1, 425),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 540),
        (position_set_y, pos1, 150),
        (overlay_set_area_size, reg0, pos1),

        (presentation_set_duration, 999999),
      (try_end),
      ]),

    (ti_on_presentation_run,
     [
       (str_store_welcome_message, s0),
       (try_begin),
         (neq, "$g_multiplayer_show_server_rules", 1),
         (this_or_next|str_is_empty, s0),
         (eq, "$g_multiplayer_welcome_message_shown", 1),
         (presentation_set_duration, 0),
         (neg|is_presentation_active, "prsnt_coop_escape_menu"),
         (neg|is_presentation_active, "prsnt_coop_team_select"),
         (start_presentation, "prsnt_coop_team_select"),
       (else_try),
         (store_mission_timer_a, ":mission_timer"),
         (gt, ":mission_timer", 1),
         (this_or_next|key_clicked, key_escape),
         (this_or_next|key_clicked, key_space),
         (this_or_next|key_clicked, key_enter),
         (this_or_next|key_clicked, key_left_mouse_button),
         (key_clicked, key_right_mouse_button),
         (assign, "$g_multiplayer_welcome_message_shown", 1),
         (presentation_set_duration, 0),
         (neg|is_presentation_active, "prsnt_coop_escape_menu"),
         (neg|is_presentation_active, "prsnt_coop_team_select"),
         (try_begin),
           (eq, "$g_multiplayer_show_server_rules", 1),
           (assign, "$g_multiplayer_show_server_rules", 0),
           (start_presentation, "prsnt_coop_escape_menu"),
         (else_try),
           (start_presentation, "prsnt_coop_team_select"),
         (try_end),
       (try_end),
      ]),
    ]),


  ("coop_escape_menu", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (assign, "$g_presentation_obj_escape_menu_1", -1),
      (assign, "$g_presentation_obj_escape_menu_2", -1),
      (assign, "$g_presentation_obj_escape_menu_3", -1),
      (assign, "$g_presentation_obj_escape_menu_4", -1),
      (assign, "$g_presentation_obj_escape_menu_5", -1),
      (assign, "$g_presentation_obj_escape_menu_6", -1),
      (assign, "$g_presentation_obj_escape_menu_7", -1),
      (assign, "$g_presentation_obj_escape_menu_8", -1),
      (assign, "$g_presentation_obj_escape_menu_9", -1),
      (assign, "$g_presentation_obj_escape_menu_10", -1),
      (assign, "$g_presentation_obj_escape_menu_11", -1),
      (assign, "$g_presentation_obj_escape_menu_12", -1),
      (assign, "$g_presentation_obj_escape_menu_13", -1),
      (assign, "$g_presentation_obj_escape_menu_14", -1),
      (assign, "$g_presentation_obj_escape_menu_15", -1),
      (assign, "$g_presentation_obj_escape_menu_16", -1),
      (assign, "$g_presentation_obj_escape_menu_17", -1),

      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 40),#80 move down
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1100),#1000 size
      (overlay_set_size, reg0, pos1),

      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_escape_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 75),#75
      (overlay_set_position, "$g_presentation_obj_escape_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 580),#550
      (overlay_set_area_size, "$g_presentation_obj_escape_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_escape_menu_container"),

      (assign, ":cur_y", 550), #500 add length with scrollbar

      (create_text_overlay, reg0, "str_choose_an_option", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":cur_y", escape_menu_item_height),

      (create_button_overlay, "$g_presentation_obj_escape_menu_1", "str_choose_faction", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_1", 0xFFFFFF),


      (try_begin),
        (multiplayer_get_my_team, ":my_team"),
        (lt, ":my_team", multi_team_spectator),
        (create_button_overlay, "$g_presentation_obj_escape_menu_2", "@Choose Character", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_2", 0xFFFFFF),

        (create_button_overlay, "$g_presentation_obj_escape_menu_3", "@Choose Troops", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_3", 0xFFFFFF),
      (try_end),



      (create_button_overlay, "$g_presentation_obj_escape_menu_4", "str_options", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_4", 0xFFFFFF),
#      (create_button_overlay, "$g_presentation_obj_escape_menu_5", "str_redefine_keys", 0),
#      (overlay_set_color, "$g_presentation_obj_escape_menu_5", 0xFFFFFF),



      (multiplayer_get_my_player, ":my_player_no"),
      (try_begin),
        # (this_or_next|eq, "$g_multiplayer_maps_voteable", 1),
        # (this_or_next|eq, "$g_multiplayer_factions_voteable", 1),
        # (this_or_next|gt, "$g_multiplayer_num_bots_voteable", 0),
        (this_or_next|eq, "$g_multiplayer_kick_voteable", 1),
        (eq, "$g_multiplayer_ban_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_escape_menu_6", "str_submit_a_poll", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_6", 0xFFFFFF),
        (assign, "$g_presentation_obj_escape_menu_6_available", 1),
        (try_begin),
          (ge, ":my_player_no", 0),
          (player_get_slot, ":last_poll_time", ":my_player_no", slot_player_poll_disabled_until_time),
          (store_mission_timer_a, ":mission_timer"),
          (lt, ":mission_timer", ":last_poll_time"),
          (overlay_set_color, "$g_presentation_obj_escape_menu_6", 0x888888),
          (overlay_set_hilight_color, "$g_presentation_obj_escape_menu_6", 0x888888),
          (assign, "$g_presentation_obj_escape_menu_6_available", 0),
        (try_end),
      (try_end),

      (try_begin),
        (ge, ":my_player_no", 0),
        (player_is_admin, ":my_player_no"),
        (create_button_overlay, "$g_presentation_obj_escape_menu_7", "str_administrator_panel", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_7", 0xFFFFFF),
        (create_button_overlay, "$g_presentation_obj_escape_menu_8", "str_kick_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_8", 0xFFFFFF),
        (create_button_overlay, "$g_presentation_obj_escape_menu_9", "str_ban_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_9", 0xFFFFFF),
        (try_begin),
          (eq, "$coop_battle_started", 0),
          (create_button_overlay, "$g_presentation_obj_escape_menu_10", "@Start Battle", 0),
          (overlay_set_color, "$g_presentation_obj_escape_menu_10", 0xFFFFFF),
        (try_end),
      (try_end),

      (create_button_overlay, "$g_presentation_obj_escape_menu_11", "str_mute_player", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_11", 0xFFFFFF),

      (try_begin),
        (assign, "$g_presentation_obj_escape_menu_12", -1),
        (assign, ":any_muted", 0),
        (get_max_players, ":num_players"),
        (try_for_range, ":player_no", 0, ":num_players"),
          (player_is_active, ":player_no"),
          (player_get_is_muted, ":is_muted", ":player_no"),
          (eq, ":is_muted", 1),
          (assign, ":any_muted", 1),
        (try_end),
        (eq, ":any_muted", 1),
        (create_button_overlay, "$g_presentation_obj_escape_menu_12", "str_unmute_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_12", 0xFFFFFF),
      (try_end),
      (create_button_overlay, "$g_presentation_obj_escape_menu_13", "@Show Game Rules", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_13", 0xFFFFFF),

      (create_button_overlay, "$g_presentation_obj_escape_menu_14", "str_quit", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_14", 0xFFFFFF),

      (try_begin),
        (multiplayer_get_my_player, ":my_player_no"),
        (player_get_team_no, ":my_team_no", ":my_player_no"),
        (eq, ":my_team_no", 1),
        (gt, "$coop_my_troop_no", 0),

        (assign, ":stop", 0),
        (try_for_agents, ":cur_agent"), 
          (eq, ":stop", 0),
          (agent_is_human, ":cur_agent"),
          (assign, ":stop", 1),
        (try_end),
        (eq, ":stop", 0),
        (create_button_overlay, "$g_presentation_obj_escape_menu_15", "@Access Inventory", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_15", 0xFFFFFF),
      (try_end),

      (create_button_overlay, "$g_presentation_obj_escape_menu_16", "@Toggle xp Messages", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_16", 0xFFFFFF),

      (try_begin),
        (ge, ":my_player_no", 0),
        (player_is_admin, ":my_player_no"),
        # (eq, "$g_round_ended", 1), #allow retreat early
        (eq, "$coop_battle_started", 1),
        (create_button_overlay, "$g_presentation_obj_escape_menu_17", "@End Battle", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_17", 0xFFFFFF),
      (try_end),

###

      (position_set_x, pos1, 130),
#
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_10", 0),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_10", pos1),
        (val_sub, ":cur_y", escape_menu_item_height),
      (try_end),

      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_1", pos1),

      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_2", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_2", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_3", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_3", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_15", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_15", pos1),
      (try_end),
      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_4", pos1),

#      (val_sub, ":cur_y", escape_menu_item_height),
#      (position_set_y, pos1, ":cur_y"),
#      (overlay_set_position, "$g_presentation_obj_escape_menu_5", pos1),

      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_13", pos1),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_6", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_6", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_7", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_7", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_8", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_8", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_9", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_9", pos1),
      (try_end),

      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_11", pos1),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_12", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_12", pos1),
      (try_end),

      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_16", pos1),

      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_17", 0),
        (val_sub, ":cur_y", escape_menu_item_height),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_17", pos1),
      (try_end),

      (val_sub, ":cur_y", escape_menu_item_height),
      (position_set_y, pos1, ":cur_y"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_14", pos1),



      (presentation_set_duration, 999999),
      ]),
    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      (try_begin),
        (eq, ":object", "$g_presentation_obj_escape_menu_1"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_team_select"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_2"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_troop_select"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_3"),
        (presentation_set_duration, 0),
        (assign, "$g_presentation_state", 0),
        (start_presentation, "prsnt_coop_commander_select"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_4"),
        (presentation_set_duration, 0),
        (change_screen_options),
      # (else_try),
        # (eq, ":object", "$g_presentation_obj_escape_menu_5"),
        # (presentation_set_duration, 0),
        # (change_screen_controls),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_6"),
        (eq, "$g_presentation_obj_escape_menu_6_available", 1),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_poll_menu"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_7"),
        (presentation_set_duration, 0),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_open_admin_panel),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_8"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 3), #admin kick
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_9"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 4), #admin ban
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_10"),# start battle
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_start_battle),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_11"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 5), #mute player
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_12"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 6), #unmute player
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_13"),
        (presentation_set_duration, 0),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_open_game_rules),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_14"),
        (presentation_set_duration, 0),

        # (call_script, "script_game_quick_start"),
        (try_begin),
          (multiplayer_is_server),
          (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_end_battle),
        (else_try),
        (finish_mission, 0),
        (try_end),

      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_15"),
        (presentation_set_duration, 0),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_open_inventory_before_spawn),
      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_16"),
        (try_begin),
          (eq, "$coop_toggle_messages", 0),
          (assign, "$coop_toggle_messages", 1),
          (display_message, "@Messages: off"),
        (else_try),
          (eq, "$coop_toggle_messages", 1),
          (assign, "$coop_toggle_messages", 0),
          (display_message, "@Messages: show xp"),
        (try_end),

      (else_try),
        (eq, ":object", "$g_presentation_obj_escape_menu_17"),
        (multiplayer_send_int_to_server, multiplayer_event_coop_send_to_server, coop_event_end_battle),
        (assign, "$coop_battle_started", -1),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_escape_menu"),
      (try_end),

      ]),
    (ti_on_presentation_run,
     [(store_trigger_param_1, ":cur_time"),
      (try_begin),
        (key_clicked, key_escape),
        (gt, ":cur_time", 200),
        (presentation_set_duration, 0),
      (try_end),
      ]),
    ]),


  ("coop_stats_chart", prsntf_read_only|prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),

      (create_mesh_overlay, reg0, "mesh_mp_score_b"),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),

      (assign, ":team_1_rows", 0),
      (assign, ":team_2_rows", 0),
      (assign, ":spectator_rows", 0),
      (get_max_players, ":num_players"),
      (try_for_range, ":player_no", 0, ":num_players"),
        (store_add, ":slot_index", ":player_no", multi_data_player_index_list_begin),
        (try_begin),
          (player_is_active, ":player_no"),
          (troop_set_slot, "trp_multiplayer_data", ":slot_index", 1),
          (player_get_team_no, ":player_team", ":player_no"),
          (try_begin),
            (eq, ":player_team", 0),
            (val_add, ":team_1_rows", 1),
          (else_try),
            (eq, ":player_team", 1),
            (val_add, ":team_2_rows", 1),
          (else_try),
            (eq, ":player_team", multi_team_spectator),
            (val_add, ":spectator_rows", 1),
          (try_end),
        (else_try),
          (troop_set_slot, "trp_multiplayer_data", ":slot_index", 0),
        (try_end),
      (try_end),
      (try_begin),
#        (gt, "$g_multiplayer_num_bots_team_1", 0),
        (val_add, ":team_1_rows", 1),
      (try_end),
      (try_begin),
#        (gt, "$g_multiplayer_num_bots_team_2", 0),
        (val_add, ":team_2_rows", 1),
      (try_end),

      (assign, ":total_rows", ":team_1_rows"),
      (val_max, ":total_rows", ":team_2_rows"),
      (val_add, ":total_rows", ":spectator_rows"),

      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_stats_chart_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 120),#120
      (overlay_set_position, "$g_presentation_obj_stats_chart_container", pos1),
      (position_set_x, pos1, 746),
      (position_set_y, pos1, 530),#530
      (overlay_set_area_size, "$g_presentation_obj_stats_chart_container", pos1),
      (set_container_overlay, "$g_presentation_obj_stats_chart_container"),

      (store_mul, ":y_needed", ":total_rows", 20),
      (val_add, ":y_needed", 100),
      (try_begin),
        (gt, ":spectator_rows", 0),
        (val_add, ":y_needed", 70),
      (try_end),

      (multiplayer_get_my_player, ":my_player_no"),       

      (try_begin),
        (gt, ":y_needed", 490),
        (assign, "$g_stats_chart_update_period", 8),
      (else_try),
        (assign, "$g_stats_chart_update_period", 1),
      (try_end),

      # (try_begin), #counting number of flags each team has.
        # (eq, "$g_multiplayer_game_type", multiplayer_game_type_headquarters),
        # (call_script, "script_get_headquarters_scores"),
        # (assign, ":team_1_num_flags", reg0),
        # (assign, ":team_2_num_flags", reg1),
      # (try_end),
      #assuming only 2 teams in scene
      (try_for_range, ":i_team", 0, multi_team_spectator),
        (assign, ":number_of_players", 0),
        (get_max_players, ":num_players"),
        (try_for_range, ":player_no", 0, ":num_players"),
          (player_is_active, ":player_no"),
          (player_get_team_no, ":team_no", ":player_no"),
          (eq, ":team_no", ":i_team"),
          (val_add, ":number_of_players", 1),
        (try_end),
        (assign, reg0, ":number_of_players"),
        (try_begin),
          (neq, ":number_of_players", 1),
          (create_text_overlay, reg1, "str_reg0_players", 0),
        (else_try),
          (create_text_overlay, reg1, "str_reg0_player", 0),
        (try_end),

        (assign, ":cur_y", ":y_needed"),
        (team_get_faction, ":cur_faction", ":i_team"),
        (str_store_faction_name, s1, ":cur_faction"),
        (create_text_overlay, reg0, s1, 0),
        (try_begin),
          (eq, ":i_team", 0),
          (overlay_set_color, reg0, 0xFF0000),
          (overlay_set_color, reg1, 0xFF0000),
        (else_try),
          (overlay_set_color, reg0, 0x0099FF),
          (overlay_set_color, reg1, 0x0099FF),
        (try_end),
        (assign, ":distance_between_teams", 373),
        (store_mul, ":cur_x", ":distance_between_teams", ":i_team"),
        (val_add, ":cur_x", 42),
        # (store_add, ":cur_x_add_15", ":cur_x", 15),
        # (position_set_x, pos3, ":cur_x_add_15"),
        # (position_set_y, pos3, ":cur_y"),
        (store_add, ":cur_x_add_35", ":cur_x", 0),
        (position_set_x, pos1, ":cur_x_add_35"),
        (position_set_y, pos1, ":cur_y"),
        (copy_position, pos2, pos1),
        (store_sub, ":cur_y_sub_10", ":cur_y", 10),
        (position_set_x, pos2, ":cur_x_add_35"),
        (position_set_y, pos2, ":cur_y_sub_10"),
        (overlay_set_position, reg0, pos1),
        (overlay_set_position, reg1, pos2),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (position_set_x, pos2, 600),
        (position_set_y, pos2, 600),
        (overlay_set_size, reg0, pos1),
        (overlay_set_size, reg1, pos2),

# dont use faction shield so name will always show
        # (team_get_faction, ":faction_of_team_1", 0),
        # (team_get_faction, ":faction_of_team_2", 1),
          
        # (try_begin),
          # (eq, ":faction_of_team_1", ":faction_of_team_2"),
          # (eq, ":i_team", 1),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_7"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_4"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_1"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_2"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_2"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_3"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_3"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_5"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_4"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_6"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_5"),
        # (else_try),
          # (eq, ":cur_faction", "fac_kingdom_1"),
          # (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_6"),
        # (try_end),
      
        # (position_set_x, pos1, 100),
        # (position_set_y, pos1, 100),
        # (overlay_set_position, reg0, pos3),
#this part removes faction name if it cant find a shield
        # (position_set_x, pos1, 50),
        # (position_set_y, pos1, 50),
        # (overlay_set_size, reg0, pos1),      

#############


       (assign, ":number_of_alive", 0),
       (assign, ":number_of_alive_bots", 0),
        (try_for_agents, ":cur_agent"),
          (agent_is_human, ":cur_agent"),
          (agent_is_alive, ":cur_agent"),
          (agent_get_team, ":cur_agent_team", ":cur_agent"),
          (eq, ":cur_agent_team", ":i_team"),
          (val_add, ":number_of_alive", 1),
          (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (val_add, ":number_of_alive_bots", 1),
          (try_end),
        (try_end),

        (assign, reg1, ":number_of_alive"),
        (create_text_overlay, reg0, "@Troops {reg1}", tf_right_align),

     #   (team_get_score, reg0, ":i_team"),
     #   (create_text_overlay, reg0, "str_score_reg0", tf_right_align),

        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":sub_cur_x", ":cur_x", 325), #325
        (store_add, ":sub_cur_y", ":cur_y", 0),
        (position_set_x, pos1, ":sub_cur_x"),
        (position_set_y, pos1, ":sub_cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1200),
        (position_set_y, pos1, 1200),
        (overlay_set_size, reg0, pos1),      

        (try_begin),
          # (multiplayer_is_server),
          (try_begin),
            (eq, ":i_team", 0),
            (assign, reg0, "$coop_num_bots_team_1"),
          (else_try),
            (eq, ":i_team", 1),
            (assign, reg0, "$coop_num_bots_team_2"),
          (try_end),

          (create_text_overlay, reg0, "@Reserves {reg0}", tf_right_align),
          (overlay_set_color, reg0, 0xFFFFFF),
          (store_add, ":sub_cur_x", ":cur_x", 325),
          (store_add, ":sub_cur_y", ":cur_y", -20),
          (position_set_x, pos1, ":sub_cur_x"),
          (position_set_y, pos1, ":sub_cur_y"),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 600),
          (position_set_y, pos1, 600),
          (overlay_set_size, reg0, pos1),      
        (try_end),
##################################################
        (val_sub, ":cur_y", 60),
      
        (create_text_overlay, reg0, "str_player_name", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, ":cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),

        # (try_begin), #at headquarters and capture the flag write score instead before kill count
          # (this_or_next|eq, "$g_multiplayer_game_type", multiplayer_game_type_capture_the_flag),
          # (eq, "$g_multiplayer_game_type", multiplayer_game_type_headquarters),      
          # (create_text_overlay, reg0, "str_score", 0),
          # (overlay_set_color, reg0, 0xFFFFFF),
          # (store_add, ":sub_cur_x", ":cur_x", 138),
          # (position_set_x, pos1, ":sub_cur_x"),
          # (position_set_y, pos1, ":cur_y"),
          # (overlay_set_position, reg0, pos1),
          # (position_set_x, pos1, 750),
          # (position_set_y, pos1, 750),
          # (overlay_set_size, reg0, pos1),
        # (try_end),
      
        (create_text_overlay, reg0, "str_kills", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":sub_cur_x", ":cur_x", 206), #191
        (position_set_x, pos1, ":sub_cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),

        (create_text_overlay, reg0, "str_deaths", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":sub_cur_x", ":cur_x", 260), #232
        (position_set_x, pos1, ":sub_cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
      
        (create_text_overlay, reg0, "str_ping", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":sub_cur_x", ":cur_x", 308), #291
        (position_set_x, pos1, ":sub_cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
      
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (overlay_set_alpha, reg0, 0xD0),
        (store_add, ":sub_cur_x", ":cur_x", 0),
        (position_set_x, pos1, ":sub_cur_x"),
        (store_add, ":sub_cur_y", ":cur_y", -10),
        (position_set_y, pos1, ":sub_cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 16500),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),

        (val_sub, ":cur_y", 35),
      
        (store_add, ":end_cond", ":num_players", 1),
        (try_for_range, ":unused", 0, ":end_cond"),
          (assign, ":max_score_plus_death", -30030),
          (assign, ":max_score_plus_death_player_no", -1),
          (try_for_range, ":player_no", 0, ":num_players"),            
            (store_add, ":slot_index", ":player_no", multi_data_player_index_list_begin),
            (troop_slot_eq, "trp_multiplayer_data", ":slot_index", 1),
            (player_get_team_no, ":player_team", ":player_no"),
            (eq, ":player_team", ":i_team"),

            (try_begin),
              (this_or_next|eq, "$g_multiplayer_game_type", multiplayer_game_type_capture_the_flag),
              (eq, "$g_multiplayer_game_type", multiplayer_game_type_headquarters),      
              (player_get_score, ":kill_count", ":player_no"), #get score in "capture the flag" or "headquarters"
            (else_try),
              (player_get_kill_count, ":kill_count", ":player_no"), #get kill count in "siege" or "battle" or "team deathmatch" or "deathmatch"
            (try_end),
      
            (player_get_death_count, ":death_count", ":player_no"), #get_death_count

            (store_mul, ":player_score_plus_death", ":kill_count", 1000),
            (val_sub, ":player_score_plus_death", ":death_count"),
      
            (this_or_next|gt, ":player_score_plus_death", ":max_score_plus_death"),
            (eq, ":player_score_plus_death", -30030),
      
            (assign, ":max_score_plus_death", ":player_score_plus_death"),
            (assign, ":max_score_plus_death_player_no", ":player_no"),
          (try_end),
          (try_begin),
            (ge, ":max_score_plus_death_player_no", 0),
            (store_add, ":slot_index", ":max_score_plus_death_player_no", multi_data_player_index_list_begin),
            (troop_set_slot, "trp_multiplayer_data", ":slot_index", 0),
      
            (try_begin),
              (eq, ":my_player_no", ":max_score_plus_death_player_no"),
              (create_mesh_overlay, reg0, "mesh_white_plane"),
              (overlay_set_color, reg0, 0xFFFFFF),
              (overlay_set_alpha, reg0, 0x35),
              (store_add, ":sub_cur_x", ":cur_x", 0),
              (position_set_x, pos1, ":sub_cur_x"),
              (store_add, ":sub_cur_y", ":cur_y", 0),
              (position_set_y, pos1, ":sub_cur_y"),
              (overlay_set_position, reg0, pos1),
              (position_set_x, pos1, 16500),
              (position_set_y, pos1, 1000),
              (overlay_set_size, reg0, pos1),
            (try_end),
  
            (try_begin), #at headquarters and capture the flag write score instead dead label before kill count
              # (this_or_next|eq, "$g_multiplayer_game_type", multiplayer_game_type_capture_the_flag),
              # (eq, "$g_multiplayer_game_type", multiplayer_game_type_headquarters),      

              # (assign, ":font_color", 0xFFFFFF),
              # (player_get_agent_id, ":max_score_plus_death_agent_id", ":max_score_plus_death_player_no"),
              # (try_begin),
                # (this_or_next|lt, ":max_score_plus_death_agent_id", 0),
                # (neg|agent_is_alive, ":max_score_plus_death_agent_id"),
                # (assign, ":font_color", 0xFF0000),
              # (try_end),

              # (player_get_score, reg0, ":max_score_plus_death_player_no"),
              # (create_text_overlay, reg0, "str_reg0", tf_right_align),
              # (overlay_set_color, reg0, ":font_color"),
              # (position_set_x, pos1, 750),
              # (position_set_y, pos1, 750),
              # (overlay_set_size, reg0, pos1),      
              # (store_add, ":sub_cur_x", ":cur_x", 165), #150
              # (position_set_x, pos1, ":sub_cur_x"),
              # (position_set_y, pos1, ":cur_y"),
              # (overlay_set_position, reg0, pos1),
            # (else_try),
              (assign, ":font_color", 0xFFFFFF),
              (player_get_agent_id, ":max_score_plus_death_agent_id", ":max_score_plus_death_player_no"),
              (try_begin),
                (this_or_next|lt, ":max_score_plus_death_agent_id", 0),
                (neg|agent_is_alive, ":max_score_plus_death_agent_id"),
                (assign, ":font_color", 0xFF0000),
                (create_text_overlay, reg0, "str_dead", 0),
                (overlay_set_color, reg0, ":font_color"),
                (position_set_x, pos1, 750),
                (position_set_y, pos1, 750),
                (overlay_set_size, reg0, pos1),
                (store_add, ":sub_cur_x", ":cur_x", 130),
                (position_set_x, pos1, ":sub_cur_x"),
                (position_set_y, pos1, ":cur_y"),
                (overlay_set_position, reg0, pos1),
              (try_end),
            (try_end),

###########################
            (str_store_player_username, s1, ":max_score_plus_death_player_no"),
            (try_begin),
              (player_get_agent_id, ":cur_agent_id", ":max_score_plus_death_player_no"),
              (ge, ":cur_agent_id", 0),
              (agent_get_troop_id,":agent_troop", ":cur_agent_id"),
              (str_store_troop_name, s2, ":agent_troop"),
              (str_store_string,s1,"@{s1} as {s2}"),
            (try_end),
#############################
            (create_text_overlay, reg0, s1, 0),
            (overlay_set_color, reg0, ":font_color"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (position_set_x, pos1, ":cur_x"),
            (position_set_y, pos1, ":cur_y"),
            (overlay_set_position, reg0, pos1),

            (player_get_kill_count, reg0, ":max_score_plus_death_player_no"), #get_kill_count
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":font_color"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),      
            (store_add, ":sub_cur_x", ":cur_x", 215), #200
            (position_set_x, pos1, ":sub_cur_x"),
            (position_set_y, pos1, ":cur_y"),
            (overlay_set_position, reg0, pos1),
      
            (player_get_death_count, reg0, ":max_score_plus_death_player_no"),
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":font_color"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),      
            (store_add, ":sub_cur_x", ":cur_x", 265), #250
            (position_set_x, pos1, ":sub_cur_x"),
            (position_set_y, pos1, ":cur_y"),
            (overlay_set_position, reg0, pos1),
      
            (player_get_ping, reg0, ":max_score_plus_death_player_no"),
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":font_color"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (store_add, ":sub_cur_x", ":cur_x", 315), #300
            (position_set_x, pos1, ":sub_cur_x"),
            (position_set_y, pos1, ":cur_y"),
            (overlay_set_position, reg0, pos1),
            (val_sub, ":cur_y", 20),
          (else_try),
            (try_begin),
##################################
#              (try_begin),
#                (eq, ":i_team", 0),
#                (assign, ":number_of_bots_in_cur_team", "$g_multiplayer_num_bots_team_1"),
#              (else_try),
#                (assign, ":number_of_bots_in_cur_team", "$g_multiplayer_num_bots_team_2"),
#              (try_end),
             
              # (team_get_bot_kill_count, reg0, ":i_team"),
              # (team_get_bot_death_count, reg1, ":i_team"),
              # (try_begin),
                # (this_or_next|neq, reg0, 0),
                # (neq, reg1, 0),
                # (neq, ":number_of_bots_in_cur_team", 0),
                # (assign, ":write_bot_informations_of_team", 1),
              # (else_try),
                # (assign, ":write_bot_informations_of_team", 0),
              # (try_end),
      
              # (eq, ":write_bot_informations_of_team", 1),

#              (store_sub, ":number_of_dead_bots", ":number_of_bots_in_cur_team", ":number_of_alive_bots"),
              (try_begin),
                (eq, ":number_of_alive_bots", 0),
                (assign, ":font_color", 0xFF0000),
              (else_try),
                (assign, ":font_color", 0xD0D0D0),
              (try_end),
	  
#              (try_begin),
#                (gt, ":number_of_dead_bots", 0),
#                (try_begin),
#                  (eq, ":number_of_bots_in_cur_team", 1),
#                  (create_text_overlay, reg0, "str_dead", 0),
#                  (store_add, ":sub_cur_x", ":cur_x", 130),
#                (else_try),
#                  (assign, reg0, ":number_of_dead_bots"),
#                  (create_text_overlay, reg0, "str_reg0_dead", 0),
#                  (store_add, ":sub_cur_x", ":cur_x", 123),
#                (try_end),      
#                (overlay_set_color, reg0, ":font_color"),
#                (position_set_x, pos1, 750),
#                (position_set_y, pos1, 750),
#                (overlay_set_size, reg0, pos1),
#                (position_set_x, pos1, ":sub_cur_x"),
#                (position_set_y, pos1, ":cur_y"),
#                (overlay_set_position, reg0, pos1),
#              (try_end),

              (try_begin),
                (gt, ":number_of_alive_bots", 1),
                (assign, reg0, ":number_of_alive_bots"), #show alive bots
#                (assign, reg0, ":number_of_bots_in_cur_team"),
                (create_text_overlay, reg0, "str_bots_reg0_agents", 0),
              (else_try),
                (create_text_overlay, reg0, "str_bot_1_agent", 0),
              (try_end),
#################################################
              (overlay_set_color, reg0, ":font_color"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (position_set_x, pos1, ":cur_x"),
              (position_set_y, pos1, ":cur_y"),
              (overlay_set_position, reg0, pos1),
      
              (team_get_bot_kill_count, reg0, ":i_team"),
              (create_text_overlay, reg0, "str_reg0", tf_right_align),
              (overlay_set_color, reg0, ":font_color"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (store_add, ":sub_cur_x", ":cur_x", 215), #200
              (position_set_x, pos1, ":sub_cur_x"),
              (position_set_y, pos1, ":cur_y"),
              (overlay_set_position, reg0, pos1),
      
              (team_get_bot_death_count, reg0, ":i_team"),
              (create_text_overlay, reg0, "str_reg0", tf_right_align),
              (overlay_set_color, reg0, ":font_color"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (store_add, ":sub_cur_x", ":cur_x", 265), #250
              (position_set_x, pos1, ":sub_cur_x"),
              (position_set_y, pos1, ":cur_y"),
              (overlay_set_position, reg0, pos1),
              (val_sub, ":cur_y", 20),
            (try_end),
            (assign, ":end_cond", 0), #all players are written for this team, break
          (try_end),
        (try_end),

        (try_begin),
          (eq, ":i_team", 0),
          (assign, ":old_cur_y", ":cur_y"),
        (try_end),
      (try_end),

      (try_begin),
        (le, ":old_cur_y", ":cur_y"),
        (assign, ":cur_y", ":old_cur_y"),
      (try_end),

      (assign, ":cur_x", 42),

      #white line between playing players and spectators
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (overlay_set_color, reg0, 0xFFFFFF),
      (overlay_set_alpha, reg0, 0xD0),
      (store_add, ":sub_cur_x", ":cur_x", 0),
      (position_set_x, pos1, ":sub_cur_x"),
      (store_add, ":sub_cur_y", ":cur_y", 10),
      (position_set_y, pos1, ":sub_cur_y"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 36000),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1), 

      (try_begin),
        (gt, ":spectator_rows", 0),

        (assign, ":cur_x", 280),
        (val_sub, ":cur_y", 50),

        #"spectators" text 
        (create_text_overlay, reg0, "str_spectators", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, ":cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, reg0, pos1),

        (create_text_overlay, reg0, "str_ping", tf_right_align),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":sub_cur_x", ":cur_x", 215), #200
        (position_set_x, pos1, ":sub_cur_x"),
        (position_set_y, pos1, ":cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),

        #white line for spectators list
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (overlay_set_alpha, reg0, 0xD0),
        (store_add, ":sub_cur_x", ":cur_x", 0),
        (position_set_x, pos1, ":sub_cur_x"),
        (store_add, ":sub_cur_y", ":cur_y", -10),
        (position_set_y, pos1, ":sub_cur_y"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 12000),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),

        (val_sub, ":cur_y", 30),

        (assign, ":font_color", 0xC0C0C0),

        (store_add, ":end_cond", ":num_players", 1),
        (try_for_range, ":player_no", 0, ":end_cond"),
          (store_add, ":slot_index", ":player_no", multi_data_player_index_list_begin),
          (troop_slot_eq, "trp_multiplayer_data", ":slot_index", 1),

          (player_get_team_no, ":player_team", ":player_no"),
          (eq, ":player_team", multi_team_spectator), #to not to allow dedicated server to pass below, dedicated servers have -1 for team_no not 2(multi_team_spectator).

          (troop_set_slot, "trp_multiplayer_data", ":slot_index", 1),

          (try_begin),
            (eq, ":my_player_no", ":player_no"),
            (create_mesh_overlay, reg0, "mesh_white_plane"),
            (overlay_set_color, reg0, 0xFFFFFF),
            (overlay_set_alpha, reg0, 0x35),
            (store_add, ":sub_cur_x", ":cur_x", 0),
            (position_set_x, pos1, ":sub_cur_x"),
            (store_add, ":sub_cur_y", ":cur_y", 0),
            (position_set_y, pos1, ":sub_cur_y"),
            (overlay_set_position, reg0, pos1),
            (position_set_x, pos1, 12000),
            (position_set_y, pos1, 1000),
            (overlay_set_size, reg0, pos1),
          (try_end),

          (str_store_player_username, s1, ":player_no"),
          (create_text_overlay, reg0, s1, 0),
          (overlay_set_color, reg0, ":font_color"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, ":cur_x"),
          (position_set_y, pos1, ":cur_y"),
          (overlay_set_position, reg0, pos1),
          
          (player_get_ping, reg0, ":player_no"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, ":font_color"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":sub_cur_x", ":cur_x", 215), #200
          (position_set_x, pos1, ":sub_cur_x"),
          (position_set_y, pos1, ":cur_y"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":cur_y", 20),      
        (try_end),
      (try_end),
	  
      (omit_key_once, key_mouse_scroll_up),
      (omit_key_once, key_mouse_scroll_down),
      
      (presentation_set_duration, 999999),
      ]),
    (ti_on_presentation_run,
     [(store_trigger_param_1, ":cur_time"),
      (try_begin),
        (this_or_next|key_clicked, key_mouse_scroll_up),
        (key_clicked, key_mouse_scroll_down),
        (omit_key_once, key_mouse_scroll_up),
        (omit_key_once, key_mouse_scroll_down),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_stats_chart_opened_manually", 1),
        (neg|game_key_is_down, gk_leave),
        (assign, "$g_multiplayer_stats_chart_opened_manually", 0),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (store_mul, ":update_period_time_limit", "$g_stats_chart_update_period", 1000),
        (gt, ":cur_time", ":update_period_time_limit"),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_coop_stats_chart"),#
      (try_end),
      ]),
    ]),



# inventory
  ("coop_item_select", prsntf_manual_end_only, 0, [
    (ti_on_presentation_load,
     [(set_fixed_point_multiplier, 1000),
     # (multiplayer_get_my_player, ":my_player_no"),

      (assign, "$g_presentation_obj_item_select_1", -1),
      (assign, "$g_presentation_obj_item_select_2", -1),
      (assign, "$g_presentation_obj_item_select_3", -1),
      (assign, "$g_presentation_obj_item_select_4", -1),
      (assign, "$g_presentation_obj_item_select_5", -1),
      (assign, "$g_presentation_obj_item_select_6", -1),
      (assign, "$g_presentation_obj_item_select_7", -1),
      (assign, "$g_presentation_obj_item_select_8", -1),
      (assign, "$g_presentation_obj_item_select_9", -1),
     (assign, "$g_presentation_obj_item_select_10", -1),
      (assign, "$g_presentation_obj_item_select_11", -1),
     (assign, "$g_presentation_obj_item_select_12", -1),
      (assign, "$g_presentation_obj_item_select_13", -1),
      (assign, "$g_presentation_obj_item_select_14", -1),
      (assign, "$g_presentation_obj_item_select_15", -1),
      (assign, "$g_presentation_obj_item_select_16", -1),
      
      (try_begin),
        (neq, "$g_current_opened_item_details", -1),
        (close_item_details),
        (assign, "$g_current_opened_item_details", -1),
      (try_end),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 0),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 0),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_1", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 526),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_1", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_1", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800), # coop make these smaller so they don't overlap and close item details after opening
      (overlay_set_size, "$g_presentation_obj_item_select_1", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 475),
      (overlay_set_position, "$g_presentation_obj_item_select_1", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 1),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 1),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_2", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 426),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_2", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_2", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_2", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 375),
      (overlay_set_position, "$g_presentation_obj_item_select_2", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 2),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 2),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_3", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 326),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_3", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_3", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_3", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 275),
      (overlay_set_position, "$g_presentation_obj_item_select_3", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 3),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 3),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_4", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 226),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_4", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_4", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_4", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 175),
      (overlay_set_position, "$g_presentation_obj_item_select_4", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 4),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 4),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_5", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 576),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_5", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_5", "mesh_mp_inventory_slot_helmet", "mesh_mp_inventory_slot_helmet"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_5", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 525),
      (overlay_set_position, "$g_presentation_obj_item_select_5", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 5),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 5),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_6", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 476),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_6", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_6", "mesh_mp_inventory_slot_armor", "mesh_mp_inventory_slot_armor"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_6", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 425),
      (overlay_set_position, "$g_presentation_obj_item_select_6", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 6),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 6),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_7", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 376),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_7", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_7", "mesh_mp_inventory_slot_boot", "mesh_mp_inventory_slot_boot"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_7", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 325),
      (overlay_set_position, "$g_presentation_obj_item_select_7", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 7),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 7),
      (try_begin),
        (ge, ":selected_item_id", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_8", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 276),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_8", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_8", "mesh_mp_inventory_slot_glove", "mesh_mp_inventory_slot_glove"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_8", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 225),
      (overlay_set_position, "$g_presentation_obj_item_select_8", pos1),

      # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 8),
      # (player_get_slot, ":selected_item_id", ":my_player_no", ":selected_item_index"),
      (troop_get_slot, ":selected_item_id", "trp_temp_troop", 8),
      (try_begin),
        (ge, ":selected_item_id", 0),
      #  (eq, "$g_horses_are_avaliable", 1),
        (create_image_button_overlay, "$g_presentation_obj_item_select_9", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":selected_item_id"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 176),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_9", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_9", "mesh_mp_inventory_slot_horse", "mesh_mp_inventory_slot_horse"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_9", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_item_select_9", pos1),

      (create_mesh_overlay, reg0, "mesh_mp_inventory_left"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 14),
      (overlay_set_position, reg0, pos1),

      (create_mesh_overlay, reg0, "mesh_mp_inventory_right"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 894),
      (position_set_y, pos1, 65),
      (overlay_set_position, reg0, pos1),

      # (create_text_overlay, "$g_presentation_obj_item_select_10", "str_done", 0),
      # (create_in_game_button_overlay, "$g_presentation_obj_item_select_10", "str_reset_to_default", 0),
      # (overlay_set_color, "$g_presentation_obj_item_select_10", 0xFFFFFF),
      # (position_set_x, pos1, 605),
      # (position_set_y, pos1, 25),
      # (overlay_set_position, "$g_presentation_obj_item_select_10", pos1),

      (create_in_game_button_overlay, "$g_presentation_obj_item_select_11", "str_done", 0),
      (overlay_set_color, "$g_presentation_obj_item_select_11", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_item_select_11", pos1),

      # (create_text_overlay, "$g_presentation_obj_item_select_12", "str_done", 0),
     # (multiplayer_get_my_player, ":my_player_no"),
      # (player_get_gold, ":player_gold", ":my_player_no"),
      # (call_script, "script_multiplayer_calculate_cur_selected_items_cost", ":my_player_no", 1),
      # (create_text_overlay, "$g_presentation_obj_item_select_12", "str_total_item_cost_reg0", tf_left_align|tf_single_line|tf_with_outline),
      # (try_begin),
        # (ge, ":player_gold", reg0),
        # (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFFFFFF),
      # (else_try),
        # (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFF0000),
      # (try_end),
      # (position_set_x, pos1, 680),
      # (position_set_y, pos1, 652),
      # (overlay_set_position, "$g_presentation_obj_item_select_12", pos1),
      
      # (store_add, "$g_presentation_obj_item_select_next", "$g_presentation_obj_item_select_12", 1), 
      (store_add, "$g_presentation_obj_item_select_next", "$g_presentation_obj_item_select_11", 3), #add 3 to skip container, need to be > item11 + 2 

     # (player_get_troop_id, ":my_troop_no", ":my_player_no"),
      (try_begin),
        (eq, "$g_presentation_state", 1),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 515),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 2),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 415),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 3),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 315),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 4),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 215),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 5),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 565),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 6),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 465),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 7),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 365),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 8),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 265),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (else_try),
        (eq, "$g_presentation_state", 9),
   #     (eq, "$g_horses_are_avaliable", 1),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 165),
        (overlay_set_position, reg0, pos1),
        (call_script, "script_coop_display_available_items_from_inventory"),
      (try_end),
      (presentation_set_duration, 999999),
      ] ),
    
    (ti_on_presentation_mouse_enter_leave,
       [(store_trigger_param_1, ":object"),
        (store_trigger_param_2, ":enter_leave"),

            # (assign, reg1, ":object"),
            # (try_begin), 
              # (eq, ":enter_leave", 0),
              # (str_store_string, s42, "@Enter"),
            # (else_try),
              # (str_store_string, s42, "@Leave"),
            # (try_end),
            # (display_message, "@{s42} obj {reg1} "),


        (try_begin),
          (eq, "$g_close_equipment_selection", 0),
          (try_begin),
            (eq, ":enter_leave", 0),

            (assign, ":item_no", -1), 
            (try_begin),
              (ge, ":object", "$g_presentation_obj_item_select_next"),
              (store_sub, ":tested_object", ":object", "$g_presentation_obj_item_select_next"),
              (store_mod, ":mod_value", ":tested_object", 2),
              (store_sub, ":mod_value", 1, ":mod_value"),
              (val_div, ":tested_object", 2),
              (store_add, ":cur_slot", multi_data_item_button_indices_begin, ":tested_object"),
              (troop_get_slot, ":item_no", "trp_multiplayer_data", ":cur_slot"),

              (store_add, ":cur_imod_slot", ":cur_slot", 100),
              (troop_get_slot, ":item_imod", "trp_temp_troop", ":cur_imod_slot"),

              (assign, ":target_obj", ":object"),
              (val_add, ":target_obj", ":mod_value"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_1"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 1),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 0),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 10),

              (assign, ":target_obj", "$g_inside_obj_1"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_2"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 2),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 1),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 11),
              (assign, ":target_obj", "$g_inside_obj_2"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_3"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 3),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 2),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 12),
              (assign, ":target_obj", "$g_inside_obj_3"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_4"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 4),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 3),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 13),
              (assign, ":target_obj", "$g_inside_obj_4"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_5"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 5),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 4),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 14),
              (assign, ":target_obj", "$g_inside_obj_5"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_6"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 6),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 5),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 15),
              (assign, ":target_obj", "$g_inside_obj_6"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_7"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 7),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 6),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 16),
              (assign, ":target_obj", "$g_inside_obj_7"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_8"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 8),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),  
              (troop_get_slot, ":item_no", "trp_temp_troop", 7),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 17),
              (assign, ":target_obj", "$g_inside_obj_8"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_9"),
            #  (eq, "$g_horses_are_avaliable", 1),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 9),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 8),
              (troop_get_slot, ":item_imod", "trp_temp_troop", 18),
              (assign, ":target_obj", "$g_inside_obj_9"),
            (try_end),


            (try_begin),
              (ge, ":item_no", 0),
              (overlay_get_position, pos0, ":target_obj"),
              (show_item_details_with_modifier, ":item_no", ":item_imod", pos0, 0),#test

              #(multiplayer_get_my_player, ":my_player_no"),
              #(player_get_troop_id, ":my_player_troop_no", ":my_player_no"),
             # (try_begin),
                # (call_script, "script_cf_multiplayer_is_item_default_for_troop", ":item_no", ":my_player_troop_no"),
               #  (store_item_value, ":item_value", ":item_no"),
               #  (show_item_details, ":item_no", pos0, ":item_value"),
               # (else_try),
                # (store_troop_faction, ":my_player_faction_no", ":my_player_troop_no"),
                # (store_sub, ":faction_slot", ":my_player_faction_no", npc_kingdoms_begin),
                # (val_add, ":faction_slot", slot_item_multiplayer_faction_price_multipliers_begin),
                # (item_get_slot, ":price_multiplier", ":item_no", ":faction_slot"),
                #(show_item_details, ":item_no", pos0, ":price_multiplier"),
             # (try_end),
              # (assign, "$g_current_opened_item_details", ":item_no"),
              (assign, "$g_current_opened_item_details", ":target_obj"),
            (try_end),
          (else_try),
            (assign, ":item_no", -1), 
            (try_begin),
              (ge, ":object", "$g_presentation_obj_item_select_next"),
              (store_sub, ":tested_object", ":object", "$g_presentation_obj_item_select_next"),

              (store_mod, ":mod_value", ":tested_object", 2),
              (store_sub, ":mod_value", 1, ":mod_value"),

              (val_div, ":tested_object", 2),
              (store_add, ":cur_slot", multi_data_item_button_indices_begin, ":tested_object"),
              (troop_get_slot, ":item_no", "trp_multiplayer_data", ":cur_slot"),
  
              (assign, ":target_obj", ":object"),
              (val_add, ":target_obj", ":mod_value"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_1"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 1),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 0),

              (assign, ":target_obj", "$g_inside_obj_1"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_2"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 2),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 1),
              (assign, ":target_obj", "$g_inside_obj_2"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_3"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 3),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 2),
              (assign, ":target_obj", "$g_inside_obj_3"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_4"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 4),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 3),
              (assign, ":target_obj", "$g_inside_obj_4"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_5"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 5),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 4),
              (assign, ":target_obj", "$g_inside_obj_5"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_6"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 6),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 5),
              (assign, ":target_obj", "$g_inside_obj_6"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_7"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 7),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 6),
              (assign, ":target_obj", "$g_inside_obj_7"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_8"),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 8),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"), 
                (troop_get_slot, ":item_no", "trp_temp_troop", 7),
              (assign, ":target_obj", "$g_inside_obj_8"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_9"),
             # (eq, "$g_horses_are_avaliable", 1),
              # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, 9),
              # (val_sub, ":player_slot_index", 1),
              # (multiplayer_get_my_player, ":my_player_no"),
              # (player_get_slot, ":item_no", ":my_player_no", ":player_slot_index"),
              (troop_get_slot, ":item_no", "trp_temp_troop", 8),
              (assign, ":target_obj", "$g_inside_obj_9"),
            (try_end),

            (try_begin),
              # (eq, "$g_current_opened_item_details", ":item_no"),
              (eq, "$g_current_opened_item_details", ":target_obj"),
              (close_item_details),
              (assign, "$g_current_opened_item_details", -1),
            (try_end),
          (try_end),
        (else_try),
          (assign, "$g_close_equipment_selection", 0),
          (presentation_set_duration, 0),
        (try_end),
      ]),
        
    (ti_on_presentation_event_state_change,
     [(store_trigger_param_1, ":object"),
      #(store_trigger_param_2, ":value"),
     # (multiplayer_get_my_player, ":my_player_no"),
    #  (player_get_troop_id, ":my_troop_no", ":my_player_no"),

      (try_begin),
        (eq, "$g_close_equipment_selection", 0),

        (try_begin),
          (eq, "$g_presentation_state", 0),

            #clear item select popup
            (try_for_range, ":cur_slot", multi_data_item_button_indices_begin, multi_data_item_button_indices_end),
              (troop_set_slot, "trp_multiplayer_data", ":cur_slot", -1),
            (try_end),
            (assign, "$coop_num_available_items", 0),
          (try_begin),
            (eq, ":object", "$g_presentation_obj_item_select_1"),
            (assign, "$g_presentation_state", 1),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_one_handed_wpn, itp_type_goods),
             (presentation_set_duration, 0),
            # (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_2"),
            (assign, "$g_presentation_state", 2),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_one_handed_wpn, itp_type_goods),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_3"),
            (assign, "$g_presentation_state", 3),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_one_handed_wpn, itp_type_goods),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_4"),
            (assign, "$g_presentation_state", 4),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_one_handed_wpn, itp_type_goods),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_5"),
            (assign, "$g_presentation_state", 5),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_head_armor, itp_type_body_armor),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_6"),
            (assign, "$g_presentation_state", 6),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_body_armor, itp_type_foot_armor),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_7"),
            (assign, "$g_presentation_state", 7),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_foot_armor, itp_type_hand_armor),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_8"),
            (assign, "$g_presentation_state", 8),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_hand_armor, itp_type_pistol),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (else_try),
            (eq, ":object", "$g_presentation_obj_item_select_9"),
          #  (eq, "$g_horses_are_avaliable", 1),
            (assign, "$g_presentation_state", 9),
            (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_get_selected_item_types, itp_type_horse, itp_type_one_handed_wpn),
            (presentation_set_duration, 0),
#            (start_presentation, "prsnt_coop_item_select"),
          (try_end),
        (else_try),
          (gt, "$g_presentation_state", 0),       
 
          (store_sub, ":tested_object", ":object", "$g_presentation_obj_item_select_next"),
          (val_div, ":tested_object", 2),
          (assign, ":end_cond", multi_data_item_button_indices_end),
          (try_for_range, ":cur_slot", multi_data_item_button_indices_begin, ":end_cond"),
            (neg|troop_slot_eq, "trp_multiplayer_data", ":cur_slot", -1),

            (store_sub, ":button_id", ":cur_slot", multi_data_item_button_indices_begin),
            (eq, ":tested_object", ":button_id"),
            (troop_get_slot, ":item_no", "trp_multiplayer_data", ":cur_slot"),

            # (store_add, ":player_slot_index", slot_player_selected_item_indices_begin, "$g_presentation_state"),
            # (val_sub, ":player_slot_index", 1),
            # (player_set_slot, ":my_player_no", ":player_slot_index", ":item_no"),

            (store_add, ":imod_slot", ":cur_slot", 100),
            (troop_get_slot, ":imod", "trp_temp_troop", ":imod_slot"),

            (store_sub, ":cur_item_index", "$g_presentation_state", 1),
            (store_add, ":cur_imod_index", ":cur_item_index", 10),
            (troop_set_slot, "trp_temp_troop", ":cur_item_index", ":item_no"),
            (troop_set_slot, "trp_temp_troop", ":cur_imod_index", ":imod"),

            (troop_get_slot, ":party_inventory_slot", "trp_temp_troop", ":cur_slot"),
            (store_sub, ":player_slot","$g_presentation_state", 1),

           # (assign, reg5, ":object"),
           # (assign, reg6, ":tested_object"),
           # (assign, reg7, ":button_id"),
           # (assign, reg8, ":cur_slot"),
           # (assign, reg9, "$g_presentation_obj_item_select_next"),

           # (str_store_item_name, s40, ":item_no"),
           # (assign, reg3, ":party_inventory_slot"),
           # (assign, reg2, ":player_slot"),
           # (display_message, "@selected {reg2} / {reg3}  .. {reg5}  {reg6}  {reg7}  {reg8}  {reg9}    ..  {s40}"),

            (ge, ":party_inventory_slot", 10), #dont ask for item not in party inventory
            (multiplayer_send_4_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_ask_for_selected_item, ":player_slot", ":item_no", ":party_inventory_slot"),


            # (player_get_gold, ":player_gold", ":my_player_no"),
            # (call_script, "script_multiplayer_calculate_cur_selected_items_cost", ":my_player_no", 1),
            # (overlay_set_text, "$g_presentation_obj_item_select_12", "str_total_item_cost_reg0"),
            # (try_begin),
              # (ge, ":player_gold", reg0),
              # (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFFFFFF),
            # (else_try),
              # (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFF0000),
            # (try_end),
        
            (assign, ":end_cond", 0), #break
          (try_end),
          (assign, "$g_presentation_state", 0),
          (presentation_set_duration, 0),

          (try_begin), #if server does not trigger presentation reload
            (eq, ":end_cond", multi_data_item_button_indices_end), #if loop above failed
            (start_presentation, "prsnt_coop_item_select"),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":object", "$g_presentation_obj_item_select_11"), #done button
          (presentation_set_duration, 0),
        (try_end),

        # (try_begin),
          # (eq, ":object", "$g_presentation_obj_item_select_10"),
          # (call_script, "script_multiplayer_set_default_item_selections_for_troop", ":my_troop_no"),
          # (presentation_set_duration, 0),
          # (assign, "$g_presentation_state", 0),
          # (start_presentation, "prsnt_coop_item_select"),
        # (else_try),
          # (eq, ":object", "$g_presentation_obj_item_select_11"),
          # (call_script, "script_multiplayer_send_item_selections"),
          # (presentation_set_duration, 0),
        # (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),
      ]),
    
    (ti_on_presentation_mouse_press,
     [(store_trigger_param_1, ":object"),
      (store_trigger_param_2, ":mouse_state"),

      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (eq, ":mouse_state", 1), #right click (clears the item slot)
          (try_begin),
            (eq, "$g_presentation_state", 0),
            #(multiplayer_get_my_player, ":my_player_no"),
            (try_begin),
              (eq, ":object", "$g_presentation_obj_item_select_1"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 0),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),
              (troop_get_slot, ":item_remove", "trp_temp_troop", 0),
              (troop_set_slot, "trp_temp_troop", 0, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 0, ":item_remove"),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_2"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 1),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),
              (troop_get_slot, ":item_remove", "trp_temp_troop", 1),
              (troop_set_slot, "trp_temp_troop", 1, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 1, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_3"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 2),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 2),
              (troop_set_slot, "trp_temp_troop", 2, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 2, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_4"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 3),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 3),
              (troop_set_slot, "trp_temp_troop", 3, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 3, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_5"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 4),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 4),
              (troop_set_slot, "trp_temp_troop", 4, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 4, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_6"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 5),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 5),
              (troop_set_slot, "trp_temp_troop", 5, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 5, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_7"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 6),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 6),
              (troop_set_slot, "trp_temp_troop", 6, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 6, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_8"),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 7),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 7),
              (troop_set_slot, "trp_temp_troop", 7, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 7, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (else_try),
              (eq, ":object", "$g_presentation_obj_item_select_9"),
            #  (eq, "$g_horses_are_avaliable", 1),
              # (store_add, ":selected_item_index", slot_player_selected_item_indices_begin, 8),
              # (player_get_slot, ":item_remove", ":my_player_no", ":selected_item_index"),
              # (player_set_slot, ":my_player_no", ":selected_item_index", -1),

              (troop_get_slot, ":item_remove", "trp_temp_troop", 8),
              (troop_set_slot, "trp_temp_troop", 8, -1),
              (multiplayer_send_3_int_to_server, multiplayer_event_coop_send_to_server, coop_event_player_remove_selected_item, 8, ":item_remove"),

              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_coop_item_select"),
            (try_end),
          (else_try),
            (gt, "$g_presentation_state", 0),
            (presentation_set_duration, 0),
            (assign, "$g_presentation_state", 0),
            (start_presentation, "prsnt_coop_item_select"),      
          (try_end),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),      
      ]),
    
    (ti_on_presentation_run,
     [(store_trigger_param_1, ":cur_time"),

      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (key_clicked, key_escape),
          (try_begin),
            (neq, "$g_current_opened_item_details", -1),
            (close_item_details),
            (assign, "$g_current_opened_item_details", -1),
          (try_end),
          (gt, ":cur_time", 200),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        #daha sonra buraya siege modundaysa ve takimini yeni degistirdigi icin spawn olamiyorsa start_presentation, spawn_counter satirini ekle sdsd.
        (presentation_set_duration, 0),
      (try_end),
      ]),
    ]),



]
