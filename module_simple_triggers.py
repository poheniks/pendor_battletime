# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_operations import *
from header_parties import *
from header_items import *
from header_skills import *
from header_triggers import *
from header_troops import *
from header_music import *

from module_constants import *

####################################################################################################################
# Simple triggers are the alternative to old style triggers. They do not preserve state, and thus simpler to maintain.
#
#  Each simple trigger contains the following fields:
# 1) Check interval: How frequently this trigger will be checked
# 2) Operation block: This must be a valid operation block. See header_operations.py for reference. 
####################################################################################################################

simple_triggers = [
  (ti_on_party_encounter,
  []),

  (ti_simulate_battle,
  []),

  (1,
  [
    (try_begin),
      (eq, "$training_ground_position_changed", 0),
      (assign, "$training_ground_position_changed", 1),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 7050),
      (position_set_y, pos0, 7200),
      (party_set_position, "p_training_ground_3", pos0),
    (try_end),
    (gt, "$auto_besiege_town", 0),
    (gt, "$g_player_besiege_town", 0),
    (ge, "$g_siege_method", 1),
    (store_current_hours, ":var0"),
    (eq, "$g_siege_force_wait", 0),
    (ge, ":var0", "$g_siege_method_finish_hours"),
    (neg|is_currently_night),
    (rest_for_hours, 0, 0, 0),
  ]),

  (0,
  [
    (call_script, "script_detect_load_restore_custom_troops"),
  ]),

  (0,
  [
    (try_begin),
      (gt, "$g_last_rest_center", 0),
      (party_get_battle_opponent, ":var0", "$g_last_rest_center"),
      (gt, ":var0", 0),
      (store_faction_of_party, ":var1", "$g_last_rest_center"),
      (store_relation, ":var2", ":var1", "fac_player_supporters_faction"),
      (store_faction_of_party, ":var3", ":var0"),
      (store_relation, ":var4", ":var3", "fac_player_supporters_faction"),
      (ge, ":var2", 0),
      (lt, ":var4", 0),
      (start_encounter, "$g_last_rest_center"),
      (rest_for_hours, 0, 0, 0),
    (else_try),
      (store_current_hours, ":var5"),
      (assign, ":var6", 0),
      (try_begin),
        (neq, "$g_check_autos_at_hour", 0),
        (ge, ":var5", "$g_check_autos_at_hour"),
        (assign, ":var6", 1),
        (assign, "$g_check_autos_at_hour", 0),
      (try_end),
      (this_or_next|eq, ":var6", 1),
      (map_free),
      (try_begin),
        (ge, "$auto_menu", 1),
        (jump_to_menu, "$auto_menu"),
        (assign, "$auto_menu", -1),
      (else_try),
        (ge, "$auto_enter_town", 1),
        (start_encounter, "$auto_enter_town"),
      (else_try),
        (ge, "$auto_besiege_town", 1),
        (start_encounter, "$auto_besiege_town"),
      (else_try),
        (ge, "$g_camp_mode", 1),
        (assign, "$g_camp_mode", 0),
        (assign, "$g_infinite_camping", 0),
        (assign, "$g_player_icon_state", 0),
        (rest_for_hours, 0, 0, 0),
        (display_message, "@Breaking camp..."),
      (try_end),
    (try_end),
  ]),

  (0,
  [
    (troop_slot_ge, "trp_notification_menu_types", 0, 1),
    (troop_get_slot, ":var0", "trp_notification_menu_types", 0),
    (troop_get_slot, "$g_notification_menu_var1", "trp_notification_menu_var1", 0),
    (troop_get_slot, "$g_notification_menu_var2", "trp_notification_menu_var2", 0),
    (jump_to_menu, ":var0"),
    (assign, ":var1", 2),
    (try_for_range, ":var2", 1, ":var1"),
      (try_begin),
        (troop_slot_ge, "trp_notification_menu_types", ":var2", 1),
        (val_add, ":var1", 1),
      (try_end),
      (store_sub, ":var3", ":var2", 1),
      (troop_get_slot, ":var4", "trp_notification_menu_types", ":var2"),
      (troop_set_slot, "trp_notification_menu_types", ":var3", ":var4"),
      (troop_get_slot, ":var4", "trp_notification_menu_var1", ":var2"),
      (troop_set_slot, "trp_notification_menu_var1", ":var3", ":var4"),
      (troop_get_slot, ":var4", "trp_notification_menu_var2", ":var2"),
      (troop_set_slot, "trp_notification_menu_var2", ":var3", ":var4"),
    (try_end),
  ]),

  (1,
  [
    (map_free),
    (call_script, "script_music_set_situation_with_culture", 65536),
  ]),

  (1,
  [
    (gt, "$g_background_encounter", 0),
    (call_script, "script_spawn_cb5"),
  ]),

  (0,
  [
    (try_begin),
      (eq, "$caravan_escort_state", 1),
      (party_is_active, "$caravan_escort_party_id"),
      (store_distance_to_party_from_party, ":var0", "$caravan_escort_destination_town", "$caravan_escort_party_id"),
      (lt, ":var0", 2),
      (store_distance_to_party_from_party, ":var1", "p_main_party", "$caravan_escort_party_id"),
      (lt, ":var1", 5),
      (assign, "$talk_context", 2),
      (assign, "$g_encountered_party", "$caravan_escort_party_id"),
      (party_stack_get_troop_id, ":var2", "$caravan_escort_party_id", 0),
      (party_stack_get_troop_dna, ":var3", "$caravan_escort_party_id", 0),
      (start_map_conversation, ":var2", ":var3"),
    (try_end),
    (try_begin),
      (gt, "$g_reset_mission_participation", 1),
      (try_for_range, ":var4", "trp_npc_adonja", "trp_heroes_end"),
        (troop_set_slot, ":var4", 149, 0),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "fac_kingdom_1", "fac_kingdoms_end"),
      (faction_get_slot, ":var1", ":var0", 99),
      (store_sub, ":var2", 140, "$player_right_to_rule"),
      (val_div, ":var2", 14),
      (val_max, ":var2", 1),
      (store_div, ":var3", ":var1", ":var2"),
      (val_sub, ":var1", ":var3"),
      (faction_set_slot, ":var0", 99, ":var1"),
    (try_end),
  ]),

  (18,
  [
    (assign, ":var0", -1),
    (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, ":var1", 152, 9),
      (assign, ":var0", ":var1"),
    (try_end),
    (neq, ":var0", -1),
    (store_skill_level, ":var2", skl_trainer, ":var0"),
    (val_mul, ":var2", 3),
    (assign, ":var3", 1000),
    (assign, ":var4", "$cko_training_time_var"),
    (store_add, ":var5", "$cko_training_time_var", 10),
    (try_for_range, ":var6", 0, 2),
      (store_attribute_level, ":var7", ":var0", ":var6"),
      (store_attribute_level, ":var8", "trp_player_knight", ":var6"),
      (store_attribute_level, ":var9", "trp_player_sergeant", ":var6"),
      (try_begin),
        (gt, ":var7", ":var8"),
        (store_sub, ":var10", ":var7", ":var8"),
        (val_sub, ":var10", 5),
        (val_mul, ":var10", 2),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var4"),
        (troop_raise_attribute, "trp_player_knight", ":var6", 1),
      (try_end),
      (try_begin),
        (gt, ":var7", ":var9"),
        (store_sub, ":var12", ":var8", 2),
        (gt, ":var12", ":var9"),
        (store_sub, ":var10", ":var7", ":var9"),
        (val_sub, ":var10", 5),
        (val_mul, ":var10", 2),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var5"),
        (troop_raise_attribute, "trp_player_sergeant", ":var6", 1),
      (try_end),
    (try_end),
    (try_for_range, ":var13", 0, 42),
      (store_skill_level, ":var7", ":var13", ":var0"),
      (store_skill_level, ":var8", ":var13", "trp_player_knight"),
      (store_skill_level, ":var9", ":var13", "trp_player_sergeant"),
      (try_begin),
        (gt, ":var7", ":var8"),
        (store_sub, ":var10", ":var7", ":var8"),
        (val_sub, ":var10", 3),
        (val_mul, ":var10", 5),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var4"),
        (troop_raise_skill, "trp_player_knight", ":var13", 1),
      (try_end),
      (try_begin),
        (gt, ":var7", ":var9"),
        (gt, ":var8", ":var9"),
        (store_sub, ":var10", ":var7", ":var9"),
        (val_sub, ":var10", 3),
        (val_mul, ":var10", 5),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var5"),
        (troop_raise_skill, "trp_player_sergeant", ":var13", 1),
      (try_end),
    (try_end),
    (try_for_range, ":var14", 0, 7),
      (store_proficiency_level, ":var7", ":var0", ":var14"),
      (store_proficiency_level, ":var8", "trp_player_knight", ":var14"),
      (store_proficiency_level, ":var9", "trp_player_sergeant", ":var14"),
      (try_begin),
        (gt, ":var7", ":var8"),
        (store_sub, ":var10", ":var7", ":var8"),
        (val_div, ":var10", 20),
        (val_sub, ":var10", 5),
        (val_mul, ":var10", 5),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var4"),
        (troop_raise_proficiency_linear, "trp_player_knight", ":var14", 10),
      (try_end),
      (try_begin),
        (gt, ":var7", ":var9"),
        (store_sub, ":var12", ":var8", 30),
        (gt, ":var12", ":var9"),
        (store_sub, ":var10", ":var7", ":var9"),
        (val_div, ":var10", 20),
        (val_sub, ":var10", 5),
        (val_mul, ":var10", 5),
        (store_random_in_range, ":var11", 0, ":var3"),
        (val_add, ":var11", ":var2"),
        (val_add, ":var11", ":var10"),
        (ge, ":var11", ":var5"),
        (troop_raise_proficiency_linear, "trp_player_sergeant", ":var14", 10),
      (try_end),
    (try_end),
    (call_script, "script_copy_complete_troop", "trp_player_knight", "trp_player_knight_save", 0),
    (call_script, "script_copy_complete_troop", "trp_player_sergeant", "trp_player_sergeant_save", 0),
    (try_for_range, ":var15", 0, 2),
      (try_begin),
        (eq, ":var15", 0),
        (assign, ":var16", "trp_player_knight"),
        (assign, ":var17", "trp_dragon_knight"),
        (assign, ":var18", "trp_zombie"),
      (else_try),
        (assign, ":var16", "trp_player_sergeant"),
        (assign, ":var17", "trp_dragon_drake"),
        (store_sub, ":var18", "trp_zombie", "trp_dragon_knight"),
        (val_add, ":var18", "trp_dragon_drake"),
      (try_end),
      (assign, ":var19", 0),
      (assign, ":var20", 0),
      (assign, ":var21", 0),
      (assign, ":var22", 0),
      (try_for_range, ":var23", ":var17", ":var18"),
        (neq, ":var23", ":var16"),
        (troop_get_slot, ":var24", ":var23", 169),
        (val_add, ":var19", ":var24"),
        (troop_get_slot, ":var24", ":var23", 170),
        (val_add, ":var20", ":var24"),
        (troop_get_slot, ":var24", ":var23", 171),
        (val_add, ":var21", ":var24"),
        (try_for_range, ":var14", 0, 6),
          (store_proficiency_level, ":var24", ":var23", ":var14"),
          (val_add, ":var22", ":var24"),
        (try_end),
      (try_end),
      (store_sub, ":var25", "trp_zombie", "trp_dragon_knight"),
      (val_sub, ":var25", 1),
      (val_div, ":var19", ":var25"),
      (val_div, ":var20", ":var25"),
      (val_div, ":var21", ":var25"),
      (val_div, ":var22", 6),
      (val_div, ":var22", ":var25"),
      (assign, ":var26", 0),
      (try_for_range, ":var14", 0, 6),
        (store_proficiency_level, ":var24", ":var16", ":var14"),
        (val_add, ":var26", ":var24"),
      (try_end),
      (val_div, ":var26", 6),
      (store_mul, ":var27", ":var26", 100),
      (val_div, ":var27", ":var22"),
      (store_mul, ":var28", ":var19", ":var27"),
      (val_div, ":var28", 100),
      (troop_set_slot, ":var16", 169, ":var28"),
      (store_mul, ":var28", ":var20", ":var27"),
      (val_div, ":var28", 100),
      (troop_set_slot, ":var16", 170, ":var28"),
      (store_mul, ":var28", ":var21", ":var27"),
      (val_div, ":var28", 100),
      (troop_set_slot, ":var16", 171, ":var28"),
    (try_end),
  ]),

  (4,
  [
    (try_for_range, ":var0", "trp_knight_1_1_wife", "trp_heroes_end"),
      (neg|troop_slot_ge, ":var0", 8, 0),
      (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
      (assign, ":var1", reg1),
      (troop_set_slot, ":var0", 12, ":var1"),
    (try_end),
  ]),

  (2,
  [
    (eq, "$cheat_mode", 1),
    (assign, ":var0", 0),
    (try_for_parties, ":var1"),
      (gt, ":var1", "p_spawn_points_end"),
      (party_stack_get_troop_id, ":var2", ":var1", 0),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var3", ":var2", 10),
      (neq, ":var1", ":var3"),
      (assign, reg4, ":var1"),
      (assign, reg5, ":var3"),
      (str_store_troop_name, s3, ":var2"),
      (display_message, "@{!}{s3} commander of party #{reg4} which is not his troop leaded party {reg5}"),
      (str_store_string, s65, "str_party_with_commander_mismatch__check_log_for_details_"),
      (try_begin),
        (eq, ":var0", 0),
        (call_script, "script_add_notification_menu", "mnu_debug_alert_from_s65", 0, 0),
        (assign, ":var0", 1),
      (try_end),
      (try_begin),
        (remove_party, ":var1"),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (try_begin),
      (neg|check_quest_active, "qst_visit_lady"),
      (neg|troop_slot_ge, "trp_player", 8, 1),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (assign, ":var0", -1),
      (assign, ":var1", 120),
      (try_for_range, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
        (troop_slot_ge, ":var2", 5, 2),
        (neg|troop_slot_eq, ":var2", 5, 4),
        (troop_slot_eq, ":var2", 37, 0),
        (troop_slot_eq, ":var2", 30, -1),
        (troop_get_slot, ":var3", ":var2", 12),
        (is_between, ":var3", "p_town_1", "p_village_1"),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var2"),
        (gt, reg0, 1),
        (store_current_hours, ":var4"),
        (troop_get_slot, ":var5", ":var2", 4),
        (val_sub, ":var4", ":var5"),
        (gt, ":var4", ":var1"),
        (assign, ":var1", ":var4"),
        (assign, ":var0", ":var2"),
        (assign, ":var6", ":var3"),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (call_script, "script_add_notification_menu", "mnu_notification_lady_requests_visit", ":var0", ":var6"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (ge, "$g_player_raiding_village", 1),
    (try_begin),
      (neq, "$g_player_is_captive", 0),
      (assign, "$g_player_raiding_village", 0),
    (else_try),
      (map_free),
      (assign, "$g_player_raiding_village", 0),
    (else_try),
      (this_or_next|party_slot_eq, "$g_player_raiding_village", 35, 2),
      (party_slot_eq, "$g_player_raiding_village", 35, 4),
      (start_encounter, "$g_player_raiding_village"),
      (rest_for_hours, 0),
      (assign, "$g_player_raiding_village", 0),
      (assign, "$g_player_raid_complete", 1),
    (else_try),
      (party_slot_eq, "$g_player_raiding_village", 35, 1),
      (rest_for_hours, 3, 5, 1),
    (else_try),
      (rest_for_hours, 0, 0, 0),
      (assign, "$g_player_raiding_village", 0),
      (assign, "$g_player_raid_complete", 0),
    (try_end),
  ]),

  (96,
  [
    (call_script, "script_spawn_renegade"),
  ]),

  (120,
  [
    (store_random_in_range, ":var0", 1, 100),
    (try_begin),
      (lt, ":var0", 50),
      (call_script, "script_cf_spawn_azi_death_cult"),
    (try_end),
    (call_script, "script_update_event_rand", 0),
    (call_script, "script_update_event_rand", 1),
    (call_script, "script_update_event_rand", 3),
    (call_script, "script_update_event_rand", 4),
    (try_begin),
      (main_party_has_troop, "trp_npc_kaverra"),
      (assign, ":var1", 0),
      (try_begin),
        (main_party_has_troop, "trp_vanskerry_warrior"),
        (assign, ":var1", "trp_vanskerry_warrior"),
      (else_try),
        (main_party_has_troop, "trp_sea_raider"),
        (assign, ":var1", "trp_sea_raider"),
      (else_try),
        (main_party_has_troop, "trp_vanskerry_jarl"),
        (assign, ":var1", "trp_vanskerry_jarl"),
      (else_try),
        (main_party_has_troop, "trp_vanskerry_marauder"),
        (assign, ":var1", "trp_vanskerry_marauder"),
      (try_end),
      (neq, ":var1", 0),
      (assign, ":var2", "$event_rand_0"),
      (val_abs, ":var2"),
      (lt, ":var2", 3),
      (try_begin),
        (lt, ":var0", 15),
        (str_store_string, s37, "@Soldiers have found a dead body of one of your Vanskerries. Someone had gelded him."),
      (else_try),
        (lt, ":var0", 40),
        (str_store_string, s37, "@One of your Vanskerries has been killed in an unfortunate accident."),
      (else_try),
        (lt, ":var0", 70),
        (str_store_string, s37, "@Soldiers have found a massacred body, which may be one of your missing Vanskerries. Peoples blame wild animals."),
      (else_try),
        (str_store_string, s37, "@One of your Vanskerries has been found dead. Probably old wounds have just opened."),
      (try_end),
      (display_log_message, "@{s37}", 0xFF5050),
      (party_remove_members, "p_main_party", ":var1", 1),
      (try_begin),
        (le, reg0, 0),
        (party_remove_prisoners, "p_main_party", ":var1", 1),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (try_begin),
      (call_script, "script_spawn_friendlies"),
      (call_script, "script_spawn_signature", 0),
      (call_script, "script_spawn_deserters"),
      (call_script, "script_spawn_signature_patrols"),
      (call_script, "script_generate_noble_recruits"),
      (store_relation, ":var0", "fac_player_faction", "fac_robber_knights"),
      (try_begin),
        (gt, ":var0", 10),
        (set_relation, "fac_player_faction", "fac_robber_knights", 10),
        (set_relation, "fac_player_supporters_faction", "fac_robber_knights", 10),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_heretics"),
      (try_begin),
        (gt, ":var0", -15),
        (set_relation, "fac_player_faction", "fac_heretics", -15),
        (set_relation, "fac_player_supporters_faction", "fac_heretics", -15),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_jatu"),
      (try_begin),
        (gt, ":var0", 2),
        (set_relation, "fac_player_faction", "fac_jatu", 2),
        (set_relation, "fac_player_supporters_faction", "fac_jatu", 2),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_snake_cult"),
      (try_begin),
        (gt, ":var0", -5),
        (set_relation, "fac_player_faction", "fac_snake_cult", -5),
        (set_relation, "fac_player_supporters_faction", "fac_snake_cult", -5),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_adventurers"),
      (try_begin),
        (gt, ":var0", 10),
        (set_relation, "fac_player_faction", "fac_adventurers", 10),
        (set_relation, "fac_player_supporters_faction", "fac_adventurers", 10),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_mystmountain"),
      (try_begin),
        (gt, ":var0", 10),
        (set_relation, "fac_player_faction", "fac_mystmountain", 10),
        (set_relation, "fac_player_supporters_faction", "fac_mystmountain", 10),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_dshar_raiders"),
      (try_begin),
        (gt, ":var0", 10),
        (set_relation, "fac_player_faction", "fac_dshar_raiders", 10),
        (set_relation, "fac_player_supporters_faction", "fac_dshar_raiders", 10),
      (try_end),
      (store_relation, ":var0", "fac_player_faction", "fac_singalians"),
      (try_begin),
        (gt, ":var0", 10),
        (set_relation, "fac_player_faction", "fac_singalians", 10),
        (set_relation, "fac_player_supporters_faction", "fac_singalians", 10),
      (try_end),
    (try_end),
    (assign, "$event_rand_1_can_ask", 1),
    (assign, "$event_rand_3_can_ask", 1),
    (store_character_level, ":var1", "trp_player"),
    (store_random_in_range, ":var2", 0, 100),
    (try_begin),
      (ge, ":var1", 30),
      (try_begin),
        (lt, ":var2", 2),
        (assign, ":var3", 0),
      (else_try),
        (lt, ":var2", 5),
        (assign, ":var3", 1),
      (else_try),
        (lt, ":var2", 20),
        (assign, ":var3", 2),
      (else_try),
        (assign, ":var3", 3),
      (try_end),
    (else_try),
      (is_between, ":var1", 20, 30),
      (try_begin),
        (lt, ":var2", 5),
        (assign, ":var3", 0),
      (else_try),
        (lt, ":var2", 20),
        (assign, ":var3", 1),
      (else_try),
        (lt, ":var2", 80),
        (assign, ":var3", 2),
      (else_try),
        (assign, ":var3", 3),
      (try_end),
    (else_try),
      (is_between, ":var1", 10, 20),
      (try_begin),
        (lt, ":var2", 20),
        (assign, ":var3", 0),
      (else_try),
        (lt, ":var2", 80),
        (assign, ":var3", 1),
      (else_try),
        (lt, ":var2", 95),
        (assign, ":var3", 2),
      (else_try),
        (assign, ":var3", 3),
      (try_end),
    (else_try),
      (try_begin),
        (lt, ":var2", 80),
        (assign, ":var3", 0),
      (else_try),
        (lt, ":var2", 95),
        (assign, ":var3", 1),
      (else_try),
        (lt, ":var2", 98),
        (assign, ":var3", 2),
      (else_try),
        (assign, ":var3", 3),
      (try_end),
    (try_end),
    (try_begin),
      (troop_clear_inventory, "trp_belligerent_drunk"),
      (try_for_range, ":var4", 4, 9),
        (troop_set_inventory_slot, "trp_belligerent_drunk", ":var4", -1),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var3", 1),
      (troop_add_item, "trp_belligerent_drunk", "itm_mail_shirt", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_dshar_mail_shirt1", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fierd_mail_hauberk", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_byrnie", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_haubergeon", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_leather_boots", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_splinted_leather_greaves", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_nasal_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_spiked_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_dshar_war_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_mail_neck_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_cavalry_club", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_scimitar_b", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_sword_medieval_b", imod_plain),
      (troop_set_auto_equip, "trp_belligerent_drunk", 1),
      (troop_equip_items, "trp_belligerent_drunk"),
      (1501, "trp_belligerent_drunk", "@Drunken Caravan Guard"),
      (1502, "trp_belligerent_drunk", "@Drunken Caravan Guards"),
    (else_try),
      (eq, ":var3", 2),
      (troop_add_item, "trp_belligerent_drunk", "itm_coat_plates_black", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_coat_plates_blue", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_coat_plates_green", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_coat_plates_red", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_coat_plates_yellow", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_splinted_greaves", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_mail_boots", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_nordic_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_bascinet_2", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_helm_dshar_warrior", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fluted_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_helm_dshar_warrior", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fluted_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_leather_covered_round_shield", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_wooden_shield", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_sword_medieval_d_long", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_military_pick", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_bastard_sword_a", imod_plain),
      (troop_set_auto_equip, "trp_belligerent_drunk", 1),
      (troop_equip_items, "trp_belligerent_drunk"),
      (1501, "trp_belligerent_drunk", "@Drunken Mercenary"),
      (1502, "trp_belligerent_drunk", "@Drunken Mercenaries"),
    (else_try),
      (eq, ":var3", 3),
      (troop_add_item, "trp_belligerent_drunk", "itm_plate_harness_white_cape", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_pendor_old_harness_cape", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_platemail_26_whiteblack", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_platemail_26_goldpurple", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_platemail_26_bluegrey", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_steel_boots_new", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_greaves_heavy_plate", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_jarl_helmet", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_kiergard_helm", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fierd_helm_1_horned", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_maximilian_helmet_open", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_shield_round_23", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_shield_round_13", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_strange_sword", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_morningstar", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fierd_war_axe", imod_plain),
      (troop_set_auto_equip, "trp_belligerent_drunk", 1),
      (troop_equip_items, "trp_belligerent_drunk"),
      (1501, "trp_belligerent_drunk", "@Drunken Adventurer"),
      (1502, "trp_belligerent_drunk", "@Drunken Adventurers"),
    (else_try),
      (troop_add_item, "trp_belligerent_drunk", "itm_short_tunic", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_linen_tunic", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_coarse_tunic", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_tabard", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_leather_vest", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_woolen_hose", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_nomad_boots", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_blue_hose", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_wrapping_boots", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_fur_hat", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_leather_cap", imod_plain),
      (troop_add_item, "trp_belligerent_drunk", "itm_sword_viking_1", imod_plain),
      (troop_set_auto_equip, "trp_belligerent_drunk", 1),
      (troop_equip_items, "trp_belligerent_drunk"),
      (1501, "trp_belligerent_drunk", "@Belligerent Drunk"),
      (1502, "trp_belligerent_drunk", "@Belligerent Drunks"),
    (try_end),
    (store_current_hours, ":var5"),
    (store_add, "$payday_date", ":var5", 168),
    (assign, "$g_presentation_lines_to_display_begin", 0),
    (assign, "$g_presentation_lines_to_display_end", 15),
    (assign, "$g_apply_budget_report_to_gold", 1),
    (try_begin),
      (eq, "$g_infinite_camping", 0),
      (start_presentation, "prsnt_budget_report"),
    (try_end),
  ]),

  (24,
  [
    (call_script, "script_copy_complete_troop", "trp_player_knight", "trp_player_knight_save", 0),
    (call_script, "script_copy_complete_troop", "trp_player_sergeant", "trp_player_sergeant_save", 0),
    (try_begin),
      (gt, "$g_pop_upgrade_knight_days", 0),
      (val_sub, "$g_pop_upgrade_knight_days", 1),
      (eq, "$g_pop_upgrade_knight_days", 0),
      (troop_set_inventory_slot, "trp_player_knight_save", "$g_pop_upgrade_knight_slot", "$g_pop_upgrade_knight_item"),
      (call_script, "script_copy_complete_troop", "trp_player_knight_save", "trp_player_knight", 1),
      (str_store_item_name_plural, s11, "$g_pop_upgrade_knight_item"),
      (str_store_troop_name_plural, s12, "trp_player_knight"),
      (display_message, "@Your {s12} have acquired the new {s11}!"),
      (play_sound, "snd_bellchant"),
    (try_end),
    (try_begin),
      (gt, "$g_pop_upgrade_squire_days", 0),
      (val_sub, "$g_pop_upgrade_squire_days", 1),
      (eq, "$g_pop_upgrade_squire_days", 0),
      (troop_set_inventory_slot, "trp_player_sergeant_save", "$g_pop_upgrade_squire_slot", "$g_pop_upgrade_squire_item"),
      (call_script, "script_copy_complete_troop", "trp_player_sergeant_save", "trp_player_sergeant", 1),
      (str_store_item_name_plural, s11, "$g_pop_upgrade_squire_item"),
      (str_store_troop_name_plural, s12, "trp_player_sergeant"),
      (display_message, "@Your {s12} have acquired the new {s11}!"),
      (play_sound, "snd_bellchant"),
    (try_end),
    (le, "$auto_menu", 0),
    (gt, "$players_kingdom", 0),
    (neq, "$players_kingdom", "fac_player_supporters_faction"),
    (eq, "$player_has_homage", 0),
    (troop_get_slot, ":var0", "trp_player", 30),
    (assign, ":var1", 0),
    (try_begin),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var2", ":var0"),
      (eq, ":var2", "$players_kingdom"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
    (store_current_day, ":var3"),
    (gt, ":var3", "$mercenary_service_next_renew_day"),
    (jump_to_menu, "mnu_oath_fulfilled"),
  ]),

  (200,
  [
    (val_sub, "$g_player_luck", 1),
    (val_max, "$g_player_luck", 25),
  ]),

  (96,
  [
    (store_random_in_range, ":var0", 0, 100),
    (lt, ":var0", 50),
    (call_script, "script_get_number_of_hero_centers", "trp_player"),
    (assign, ":var1", reg0),
    (try_begin),
      (gt, ":var1", 0),
      (store_random_in_range, ":var2", 0, ":var1"),
      (call_script, "script_troop_get_leaded_center_with_index", "trp_player", ":var2"),
      (assign, ":var3", reg0),
      (store_random_in_range, ":var4", 1, 14),
      (party_set_slot, ":var3", 296, ":var4"),
      (try_begin),
        (eq, "$notif_village_help", 0),
        (call_script, "script_add_notification_menu", "mnu_heartbeat_quest", ":var3", 0),
      (else_try),
        (eq, "$notif_village_help", 1),
        (str_store_party_name, s3, ":var3"),
        (display_message, "str_heartbeat_quest_notif", 0xFF9933),
      (try_end),
    (try_end),
  ]),

  (72,
  [
    (assign, "$lady_flirtation_location", 0),
  ]),

  (4,
  [
    (assign, "$g_time_to_spare", 1),
    (try_begin),
      (troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (assign, "$g_player_banner_granted", 1),
    (try_end),
  ]),

  (24,
  [
    (eq, "$g_player_banner_granted", 1),
    (troop_slot_eq, "trp_player", 13, 0),
    (le, "$auto_menu", 0),
    (start_presentation, "prsnt_banner_selection"),
  ]),

  (24,
  [
    (call_script, "script_get_player_party_morale_values"),
    (assign, ":var0", reg0),
    (party_get_morale, ":var1", "p_main_party"),
    (store_sub, ":var2", ":var0", ":var1"),
    (store_div, ":var3", ":var2", 5),
    (store_mul, ":var4", ":var3", 5),
    (try_begin),
      (neq, ":var4", ":var2"),
      (try_begin),
        (gt, ":var2", 0),
        (val_add, ":var3", 1),
      (else_try),
        (val_sub, ":var3", 1),
      (try_end),
    (try_end),
    (val_add, ":var1", ":var3"),
    (party_set_morale, "p_main_party", ":var1"),
  ]),

  (168,
  [
    (try_for_range, ":var0", "p_town_1", "p_village_1"),
      (party_get_num_prisoner_stacks, ":var1", ":var0"),
      (store_div, ":var2", ":var1", 2),
      (try_for_range_backwards, ":var3", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
        (neg|troop_is_hero, ":var4"),
        (party_prisoner_stack_get_size, ":var5", ":var0", ":var3"),
        (store_random_in_range, ":var6", 0, 40),
        (val_add, ":var6", ":var2"),
        (val_min, ":var6", 100),
        (try_begin),
          (party_slot_eq, ":var0", 275, 1),
          (val_div, ":var6", 2),
        (try_end),
        (val_mul, ":var5", ":var6"),
        (val_div, ":var5", 100),
        (try_begin),
          (ge, ":var6", 20),
          (val_max, ":var5", 1),
        (try_end),
        (party_remove_prisoners, ":var0", ":var4", ":var5"),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var1", ":var0", 21),
      (val_mul, ":var1", 101),
      (val_div, ":var1", 100),
      (troop_set_slot, ":var0", 21, ":var1"),
      (call_script, "script_calculate_hero_weekly_net_income_and_add_to_wealth", ":var0"),
    (try_end),
    (assign, ":var2", 0),
    (try_begin),
      (troop_get_slot, ":var3", "trp_player", 30),
      (gt, ":var3", 0),
      (troop_get_type, ":var4", ":var3"),
      (eq, ":var4", 0),
      (troop_slot_eq, ":var3", 2, 2),
      (assign, ":var2", 1),
    (try_end),
    (try_for_range, ":var5", "p_town_1", "p_village_1"),
      (neg|party_slot_eq, ":var5", 7, "trp_player"),
      (party_slot_ge, ":var5", 7, 1),
      (party_get_slot, ":var6", ":var5", 49),
      (party_get_slot, ":var7", ":var5", 50),
      (party_get_slot, ":var8", ":var5", 290),
      (val_mul, ":var8", 4),
      (store_mul, ":var9", ":var7", 14),
      (val_add, ":var9", 1000),
      (val_add, ":var9", ":var8"),
      (try_begin),
        (this_or_next|eq, ":var5", "p_town_1"),
        (this_or_next|eq, ":var5", "p_town_5"),
        (this_or_next|eq, ":var5", "p_town_6"),
        (this_or_next|eq, ":var5", "p_town_8"),
        (eq, ":var5", "p_town_10"),
        (val_mul, ":var9", 13),
        (val_div, ":var9", 10),
      (try_end),
      (val_add, ":var6", ":var9"),
      (call_script, "script_calculate_weekly_party_wage", ":var5"),
      (try_begin),
        (eq, ":var2", 1),
        (party_slot_eq, ":var5", 7, ":var3"),
        (val_mul, reg0, 3),
        (val_div, reg0, 4),
      (try_end),
      (val_sub, ":var6", reg0),
      (val_max, ":var6", 0),
      (party_set_slot, ":var5", 49, ":var6"),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (ge, ":var1", 1),
      (party_is_active, ":var1"),
      (party_get_attached_to, ":var2", ":var1"),
      (is_between, ":var2", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var2", 54, -1),
      (store_faction_of_party, ":var3", ":var1"),
      (try_begin),
        (this_or_next|eq, ":var3", "fac_player_supporters_faction"),
        (eq, ":var3", "$players_kingdom"),
        (assign, ":var4", 1),
        (store_random_in_range, ":var5", 0, 2),
        (val_add, ":var4", ":var5"),
      (else_try),
        (266, ":var6"),
        (try_begin),
          (eq, ":var6", 0),
          (assign, ":var4", 2),
        (else_try),
          (eq, ":var6", 1),
          (assign, ":var4", 1),
          (store_random_in_range, ":var5", 0, 2),
          (val_add, ":var4", ":var5"),
        (else_try),
          (eq, ":var6", 2),
          (assign, ":var4", 1),
        (try_end),
      (try_end),
      (try_begin),
        (faction_slot_eq, ":var3", 8, ":var0"),
        (val_add, ":var4", 1),
      (try_end),
      (try_for_range, ":var7", 0, ":var4"),
        (call_script, "script_hire_men_to_kingdom_hero_party", ":var0"),
      (try_end),
    (try_end),
    (try_for_range, ":var8", "p_town_1", "p_village_1"),
      (neg|party_slot_eq, ":var8", 7, "trp_player"),
      (party_slot_ge, ":var8", 7, 1),
      (party_slot_eq, ":var8", 54, -1),
      (store_faction_of_party, ":var9", ":var8"),
      (try_begin),
        (this_or_next|eq, ":var9", "fac_player_supporters_faction"),
        (eq, ":var9", "$players_kingdom"),
        (assign, ":var10", 450),
      (else_try),
        (266, ":var6"),
        (assign, ":var10", 450),
        (try_begin),
          (eq, ":var6", 0),
          (assign, ":var10", 300),
          (store_random_in_range, ":var4", 0, 2),
          (val_add, ":var4", 1),
        (else_try),
          (eq, ":var6", 1),
          (assign, ":var10", 450),
          (assign, ":var4", 1),
        (else_try),
          (eq, ":var6", 2),
          (assign, ":var10", 600),
          (store_random_in_range, ":var4", 0, 2),
        (try_end),
      (try_end),
      (try_for_range, ":var7", 0, ":var4"),
        (party_get_slot, ":var11", ":var8", 49),
        (assign, ":var12", ":var11"),
        (val_div, ":var12", 2),
        (gt, ":var12", ":var10"),
        (call_script, "script_cf_reinforce_party", ":var8"),
        (val_sub, ":var11", ":var10"),
        (party_set_slot, ":var8", 49, ":var11"),
      (try_end),
    (try_end),
    (try_for_range, ":var8", "p_town_1", "p_salt_mine"),
      (neg|is_between, ":var8", "p_castle_1", "p_village_1"),
      (call_script, "script_get_center_ideal_prosperity", ":var8"),
      (assign, ":var13", reg0),
      (party_get_slot, ":var14", ":var8", 50),
      (try_begin),
        (gt, ":var14", ":var13"),
        (call_script, "script_change_center_prosperity", ":var8", -1),
        (val_add, "$newglob_total_prosperity_from_convergence", -1),
      (else_try),
        (lt, ":var14", ":var13"),
        (call_script, "script_change_center_prosperity", ":var8", 1),
        (val_add, "$newglob_total_prosperity_from_convergence", 1),
      (try_end),
    (try_end),
  ]),

  (360,
  []),

  (6,
  [
    (store_current_day, ":var0"),
    (try_begin),
      (neq, ":var0", "$g_last_half_payment_check_day"),
      (assign, "$g_last_half_payment_check_day", ":var0"),
      (try_begin),
        (eq, "$g_half_payment_checkpoint", 1),
        (val_add, "$g_cur_week_half_daily_wage_payments", 1),
      (try_end),
      (assign, "$g_half_payment_checkpoint", 1),
    (try_end),
    (assign, ":var1", 0),
    (try_begin),
      (neg|map_free),
      (ge, "$g_last_rest_center", 0),
      (this_or_next|party_slot_eq, "$g_last_rest_center", 251, 1),
      (is_between, "$g_last_rest_center", "p_town_1", "p_village_1"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
    (assign, "$g_half_payment_checkpoint", 0),
  ]),

  (24,
  [
    (call_script, "script_randomly_start_war_peace_new", 1),
    (try_begin),
      (store_random_in_range, ":var0", "p_village_1", "p_salt_mine"),
      (store_random_in_range, ":var1", "p_village_1", "p_salt_mine"),
      (store_faction_of_party, ":var2", ":var0"),
      (store_faction_of_party, ":var3", ":var1"),
      (neq, ":var0", ":var1"),
      (neq, ":var2", ":var3"),
      (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var3", ":var2"),
      (eq, reg0, 0),
      (try_begin),
        (party_slot_eq, ":var0", 61, ":var3"),
        (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":var0", -1),
      (else_try),
        (party_slot_eq, ":var0", 62, ":var3"),
        (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":var0", -1),
      (else_try),
        (set_fixed_point_multiplier, 1),
        (store_distance_to_party_from_party, ":var4", ":var0", ":var1"),
        (lt, ":var4", 25),
        (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":var0", ":var1"),
      (try_end),
    (try_end),
    (try_for_range, ":var5", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var5", 21, 0),
      (try_for_range, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, ":var5", ":var6"),
        (faction_slot_eq, ":var6", 21, 0),
        (store_add, ":var7", ":var6", 120),
        (val_sub, ":var7", "fac_player_supporters_faction"),
        (faction_get_slot, ":var8", ":var5", ":var7"),
        (try_begin),
          (ge, ":var8", 1),
          (try_begin),
            (eq, ":var8", 1),
            (call_script, "script_update_faction_notes", ":var5"),
            (lt, ":var5", ":var6"),
            (call_script, "script_add_notification_menu", "mnu_notification_truce_expired", ":var5", ":var6"),
          (try_end),
          (val_sub, ":var8", 1),
          (faction_set_slot, ":var5", ":var7", ":var8"),
        (try_end),
        (store_add, ":var9", ":var6", 130),
        (val_sub, ":var9", "fac_player_supporters_faction"),
        (faction_get_slot, ":var10", ":var5", ":var9"),
        (try_begin),
          (ge, ":var10", 1),
          (try_begin),
            (store_relation, ":var11", ":var5", ":var6"),
            (lt, ":var11", 0),
            (faction_set_slot, ":var5", ":var9", 0),
          (else_try),
            (eq, ":var10", 1),
            (call_script, "script_add_notification_menu", "mnu_notification_casus_belli_expired", ":var5", ":var6"),
            (faction_set_slot, ":var5", ":var9", 0),
          (else_try),
            (val_sub, ":var10", 1),
            (faction_set_slot, ":var5", ":var9", ":var10"),
          (try_end),
        (try_end),
        (try_begin),
          (store_relation, ":var11", ":var5", ":var6"),
          (lt, ":var11", 0),
          (store_add, ":var12", ":var6", 140),
          (val_sub, ":var12", "fac_player_supporters_faction"),
          (faction_get_slot, ":var13", ":var5", ":var12"),
          (val_add, ":var13", 1),
          (faction_set_slot, ":var5", ":var12", ":var13"),
        (try_end),
      (try_end),
      (call_script, "script_update_faction_notes", ":var5"),
    (try_end),
  ]),

  (48,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", "p_salt_mine"),
      (party_is_active, ":var1"),
      (store_skill_level, ":var2", skl_trainer, ":var0"),
      (val_add, ":var2", 5),
      (store_mul, ":var3", ":var2", 1000),
      (assign, ":var4", 30),
      (try_begin),
        (store_troop_faction, ":var5", ":var0"),
        (neq, ":var5", "$players_kingdom"),
        (266, ":var6"),
        (try_begin),
          (eq, ":var6", 0),
          (assign, ":var4", 35),
          (val_mul, ":var3", 3),
          (val_div, ":var3", 2),
        (else_try),
          (eq, ":var6", 2),
          (assign, ":var4", 25),
          (val_div, ":var3", 2),
        (try_end),
      (try_end),
      (store_random_in_range, ":var7", 0, 100),
      (le, ":var7", ":var4"),
      (party_upgrade_with_xp, ":var1", ":var3"),
    (try_end),
    (try_for_range, ":var8", "p_town_1", "p_village_1"),
      (party_get_slot, ":var9", ":var8", 7),
      (try_begin),
        (neq, ":var9", "trp_player"),
        (assign, ":var3", 3000),
        (assign, ":var4", 30),
        (try_begin),
          (assign, ":var10", -1),
          (try_begin),
            (ge, ":var9", 0),
            (store_troop_faction, ":var10", ":var9"),
          (try_end),
          (neq, ":var10", "$players_kingdom"),
          (266, ":var6"),
          (try_begin),
            (eq, ":var6", 0),
            (assign, ":var4", 35),
            (val_mul, ":var3", 3),
            (val_div, ":var3", 2),
          (else_try),
            (eq, ":var6", 2),
            (assign, ":var4", 25),
            (val_div, ":var3", 2),
          (try_end),
        (try_end),
        (store_random_in_range, ":var7", 0, 100),
        (le, ":var7", ":var4"),
        (party_upgrade_with_xp, ":var8", ":var3"),
        (call_script, "script_pop_sort_garrison", ":var8"),
      (else_try),
        (eq, ":var9", "trp_player"),
        (party_get_slot, ":var11", ":var8", 293),
        (store_skill_level, ":var12", skl_trainer, ":var11"),
        (party_get_slot, ":var13", ":var8", 274),
        (party_slot_eq, ":var8", 349, 0),
        (val_clamp, ":var13", 0, 2),
        (val_add, ":var13", 1),
        (store_mul, ":var3", ":var12", 50),
        (val_add, ":var3", 250),
        (val_mul, ":var3", ":var13"),
        (party_upgrade_with_xp, ":var8", ":var3", 0),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (call_script, "script_process_sieges"),
  ]),

  (2,
  [
    (call_script, "script_process_village_raids"),
  ]),

  (7,
  [
    (call_script, "script_init_ai_calculation"),
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (call_script, "script_calculate_troop_ai", ":var0"),
    (try_end),
  ]),

  (24,
  []),

  (24,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var1", ":var0", 51),
      (val_sub, ":var1", 5),
      (val_max, ":var1", 0),
      (troop_set_slot, ":var0", 51, ":var1"),
    (try_end),
    (store_random_in_range, ":var2", 1, 3),
    (val_min, ":var2", 2),
    (try_for_range, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var4", ":var3", 150),
      (ge, ":var4", 1),
      (val_sub, ":var4", ":var2"),
      (val_max, ":var4", 0),
      (troop_set_slot, ":var3", 150, ":var4"),
    (try_end),
    (troop_get_slot, ":var4", "trp_player", 150),
    (val_sub, ":var4", ":var2"),
    (val_max, ":var4", 0),
    (troop_set_slot, "trp_player", 150, ":var4"),
  ]),

  (8,
  [
    (call_script, "script_cf_random_political_event"),
    (call_script, "script_cf_random_political_event"),
  ]),

  (0.5,
  [
    (val_add, "$g_lord_long_term_count", 1),
    (try_begin),
      (neg|is_between, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
      (assign, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin"),
    (try_end),
    (assign, ":var0", "$g_lord_long_term_count"),
    (try_begin),
      (eq, ":var0", "trp_kingdom_heroes_including_player_begin"),
      (assign, ":var0", "trp_player"),
    (try_end),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (str_store_troop_name, s9, ":var0"),
      (display_message, "@{!}DEBUG -- Doing political calculations for {s9}"),
    (try_end),
    (try_begin),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, ":var0", "trp_player"),
      (assign, ":var1", -1),
      (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var2", 7, ":var0"),
        (assign, ":var1", ":var2"),
      (try_end),
      (try_begin),
        (eq, ":var1", -1),
        (store_troop_faction, ":var3", ":var0"),
        (faction_get_slot, ":var4", ":var3", 11),
        (troop_get_slot, ":var5", ":var0", 52),
        (try_begin),
          (neq, ":var4", ":var0"),
          (try_begin),
            (this_or_next|eq, ":var5", 2),
            (this_or_next|eq, ":var5", 3),
            (this_or_next|eq, ":var5", 4),
            (eq, ":var5", 5),
            (call_script, "script_troop_change_relation_with_troop", ":var0", ":var4", -2),
            (val_add, "$total_no_fief_changes", -2),
          (else_try),
            (eq, ":var5", 1),
            (call_script, "script_troop_change_relation_with_troop", ":var0", ":var4", -1),
            (val_add, "$total_no_fief_changes", -1),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$g_option_no_defections", 0),
      (this_or_next|troop_slot_eq, ":var0", 2, 2),
      (eq, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (assign, ":var6", "$players_kingdom"),
      (else_try),
        (store_troop_faction, ":var6", ":var0"),
      (try_end),
      (faction_get_slot, ":var4", ":var6", 11),
      (neq, ":var0", ":var4"),
      (neg|is_between, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (neg|is_between, ":var0", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (call_script, "script_troop_get_relation_with_troop", ":var0", ":var4"),
      (le, reg0, -90),
      (call_script, "script_cf_troop_can_intrigue", ":var0", 0),
      (store_random_in_range, ":var7", 0, 2),
      (try_begin),
        (neq, ":var7", 0),
        (neq, ":var0", "trp_player"),
        (neq, ":var0", "trp_knight_2_7"),
        (call_script, "script_lord_find_alternative_faction", ":var0"),
        (assign, ":var8", reg0),
        (is_between, ":var8", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_troop_name, s36, ":var0"),
        (str_store_faction_name_link, s2, ":var8"),
        (str_store_faction_name_link, s3, ":var6"),
        (call_script, "script_change_troop_faction", ":var0", ":var8"),
        (str_store_string_reg, s1, s36),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var0"),
          (display_message, "@{!}DEBUG - {s4} faction changed in defection"),
        (try_end),
        (troop_get_type, reg4, ":var0"),
        (str_store_string, s4, "str_lord_defects_ordinary"),
        (str_store_troop_name_link, s7, ":var0"),
        (str_store_string, s4, "@{s4}, and is now known as {s7}"),
        (display_log_message, "@{!}{s4}", 0x66CCFF),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (this_or_next|eq, ":var8", "$players_kingdom"),
          (eq, ":var6", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_lord_defects", ":var0", ":var6"),
        (try_end),
      (else_try),
        (neq, ":var4", "trp_player"),
        (neq, ":var0", "trp_knight_2_7"),
        (call_script, "script_indict_lord_for_treason", ":var0", ":var6"),
      (try_end),
    (else_try),
      (neq, ":var0", "trp_player"),
      (store_troop_faction, ":var6", ":var0"),
      (faction_slot_ge, ":var6", 64, 1),
      (neg|troop_slot_ge, ":var0", 154, 1),
      (this_or_next|troop_slot_eq, ":var0", 154, -1),
      (neq, "$players_kingdom", ":var6"),
      (troop_slot_eq, ":var0", 2, 2),
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", ":var0"),
      (troop_set_slot, ":var0", 154, reg0),
    (try_end),
    (try_for_range, ":var9", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (call_script, "script_troop_get_relation_with_troop", ":var0", ":var9"),
      (lt, reg0, 0),
      (assign, ":var10", reg0),
      (store_sub, ":var11", 0, ":var10"),
      (store_random_in_range, ":var12", 0, 300),
      (lt, ":var12", ":var11"),
      (assign, ":var13", 1),
      (try_begin),
        (neq, ":var0", "trp_player"),
        (neq, ":var9", "trp_player"),
        (store_troop_faction, ":var6", ":var0"),
        (faction_get_slot, ":var4", ":var6", 11),
        (eq, ":var9", ":var4"),
        (store_random_in_range, ":var13", 0, 4),
        (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var2", 7, ":var0"),
          (try_begin),
            (is_between, ":var2", "p_town_1", "p_castle_1"),
            (val_add, ":var13", 3),
          (else_try),
            (is_between, ":var2", "p_castle_1", "p_village_1"),
            (val_add, ":var13", 2),
          (else_try),
            (val_add, ":var13", 1),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg0, ":var13"),
          (str_store_troop_name, s9, ":var0"),
          (display_message, "@{!}DEBUG -- {s9} has gained {reg0} relation with his liege."),
        (try_end),
      (try_end),
      (call_script, "script_troop_change_relation_with_troop", ":var0", ":var9", ":var13"),
      (val_add, "$total_relation_changes_through_convergence", ":var13"),
    (try_end),
  ]),

  (2,
  []),

  (1,
  [
    (call_script, "script_allow_vassals_to_join_indoor_battle"),
    (call_script, "script_process_kingdom_parties_ai"),
  ]),

  (3,
  [
    (call_script, "script_process_alarms"),
  ]),

  (3,
  [
    (store_current_hours, ":var0"),
    (try_for_range, ":var1", "p_town_1", "p_village_1"),
      (party_get_slot, ":var2", ":var1", 54),
      (gt, ":var2", 0),
      (party_is_active, ":var2"),
      (store_faction_of_party, ":var3", ":var2"),
      (party_slot_ge, ":var1", 54, 1),
      (party_get_slot, ":var4", ":var1", 64),
      (store_sub, ":var4", ":var0", ":var4"),
      (assign, ":var5", 0),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (try_for_range, ":var9", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var9", 2, 2),
        (neg|troop_slot_ge, ":var9", 8, 0),
        (troop_get_slot, ":var10", ":var9", 10),
        (gt, ":var10", 0),
        (party_is_active, ":var10"),
        (store_troop_faction, ":var11", ":var9"),
        (eq, ":var11", ":var3"),
        (assign, ":var12", 0),
        (try_begin),
          (party_slot_eq, ":var10", 4, 1),
          (party_slot_eq, ":var10", 5, ":var1"),
          (assign, ":var12", 1),
        (else_try),
          (party_slot_eq, ":var10", 4, 11),
          (party_get_slot, ":var13", ":var10", 5),
          (gt, ":var13", 0),
          (party_is_active, ":var13"),
          (party_slot_eq, ":var13", 4, 1),
          (party_slot_eq, ":var13", 5, ":var1"),
          (assign, ":var12", 1),
        (try_end),
        (eq, ":var12", 1),
        (party_get_battle_opponent, ":var14", ":var10"),
        (this_or_next|lt, ":var14", 0),
        (eq, ":var14", ":var1"),
        (try_begin),
          (faction_slot_eq, ":var3", 8, ":var9"),
          (assign, ":var8", 1),
        (try_end),
        (call_script, "script_party_calculate_regular_strength", ":var10"),
        (val_add, ":var7", reg0),
      (try_end),
      (try_begin),
        (gt, ":var7", 0),
        (party_collect_attachments_to_party, ":var1", "p_collective_enemy"),
        (call_script, "script_party_calculate_regular_strength", "p_collective_enemy"),
        (assign, ":var15", reg0),
        (try_begin),
          (eq, "$auto_enter_town", ":var1"),
          (eq, "$g_player_is_captive", 0),
          (call_script, "script_party_calculate_regular_strength", "p_main_party"),
          (val_add, ":var15", reg0),
          (val_mul, ":var7", 2),
        (try_end),
        (party_get_slot, ":var16", ":var1", 65),
        (val_add, ":var16", 100),
        (val_mul, ":var15", ":var16"),
        (val_div, ":var15", 100),
        (val_max, ":var15", 1),
        (try_begin),
          (eq, ":var8", 1),
          (eq, ":var3", "$players_kingdom"),
          (check_quest_active, "qst_follow_army"),
          (val_mul, ":var7", 2),
        (try_end),
        (val_mul, ":var7", 3),
        (val_div, ":var7", 4),
        (try_begin),
          (party_slot_eq, ":var1", 0, 2),
          (val_mul, ":var15", 13),
          (val_div, ":var15", 10),
        (else_try),
          (party_slot_eq, ":var1", 0, 3),
          (val_mul, ":var15", 15),
          (val_div, ":var15", 10),
        (try_end),
        (store_mul, ":var17", ":var7", 100),
        (val_div, ":var17", ":var15"),
        (store_sub, ":var18", ":var17", 250),
        (try_begin),
          (gt, ":var18", -100),
          (store_div, ":var19", ":var4", 2),
          (val_add, ":var18", ":var19"),
        (try_end),
        (val_div, ":var18", 5),
        (val_max, ":var18", 0),
        (store_sub, ":var20", 175, ":var17"),
        (val_max, ":var20", 0),
        (try_begin),
          (store_random_in_range, ":var21", 0, 100),
          (lt, ":var21", ":var18"),
          (gt, ":var4", 24),
          (assign, ":var5", 1),
        (else_try),
          (store_random_in_range, ":var21", 0, 100),
          (lt, ":var21", ":var20"),
          (assign, ":var6", 1),
        (try_end),
      (else_try),
        (assign, ":var6", 1),
      (try_end),
      (try_begin),
        (eq, ":var5", 1),
        (call_script, "script_begin_assault_on_center", ":var1"),
      (else_try),
        (eq, ":var6", 1),
        (try_for_range, ":var9", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var9", 2, 2),
          (neg|troop_slot_ge, ":var9", 8, 0),
          (troop_get_slot, ":var10", ":var9", 10),
          (gt, ":var10", 0),
          (party_is_active, ":var10"),
          (party_slot_eq, ":var10", 4, 1),
          (party_slot_eq, ":var10", 5, ":var1"),
          (party_slot_eq, ":var10", 8, 1),
          (call_script, "script_party_set_ai_state", ":var10", -1, -1),
          (call_script, "script_party_set_ai_state", ":var10", 1, ":var1"),
          (party_set_slot, ":var1", 64, ":var0"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (6,
  [
    (assign, "$g_recalculate_ais", 1),
  ]),

  (0,
  [
    (try_begin),
      (ge, "$cheat_mode", 1),
      (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
        (store_add, ":var1", ":var0", "fac_kingdom_1"),
        (val_sub, ":var1", "trp_kingdom_1_lord"),
        (store_troop_faction, ":var2", ":var0"),
        (neq, ":var1", ":var2"),
        (neq, ":var2", "fac_commoners"),
        (ge, "$cheat_mode", 2),
        (neq, ":var0", "trp_kingdom_2_lord"),
        (str_store_troop_name, s4, ":var0"),
        (str_store_faction_name, s5, ":var2"),
        (str_store_faction_name, s6, ":var1"),
        (str_store_string, s65, "@{!}DEBUG - {s4} is in {s5}, should be in {s6}, disabling political cheat mode"),
        (rest_for_hours, 0, 0, 0),
        (assign, "$cheat_mode", 1),
        (jump_to_menu, "mnu_debug_alert_from_s65"),
      (try_end),
    (try_end),
    (eq, "$g_recalculate_ais", 1),
    (assign, "$g_recalculate_ais", 0),
    (call_script, "script_recalculate_ais"),
  ]),

  (24,
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_faction_recalculate_strength", ":var0"),
    (try_end),
    (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var2", ":var1"),
      (neg|faction_slot_eq, ":var2", 4, 0),
      (neg|faction_slot_eq, ":var2", 4, 6),
      (neg|faction_slot_eq, ":var2", 4, 1),
      (troop_get_slot, ":var3", ":var1", 10),
      (party_is_active, ":var3"),
      (val_add, "$total_vassal_days_on_campaign", 1),
      (party_slot_eq, ":var3", 4, 11),
      (val_add, "$total_vassal_days_responding_to_campaign", 1),
    (try_end),
  ]),

  (36,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_heroes_end"),
      (troop_set_slot, ":var0", 20, 0),
    (try_end),
    (try_for_range, ":var0", "trp_village_1_elder", "trp_merchants_end"),
      (troop_set_slot, ":var0", 20, 0),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (call_script, "script_refresh_village_merchant_inventory", ":var0"),
    (try_end),
  ]),

  (48,
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (call_script, "script_refresh_village_defenders", ":var0"),
      (party_set_slot, ":var0", 46, 0),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (neg|is_between, ":var0", "p_castle_1", "p_village_1"),
      (party_get_slot, ":var1", ":var0", 205),
      (party_get_slot, ":var2", ":var0", 206),
      (party_get_slot, ":var3", ":var0", 208),
      (val_max, ":var3", 1),
      (store_mul, ":var4", ":var1", 400),
      (store_mul, ":var5", ":var2", 200),
      (val_add, ":var4", ":var5"),
      (val_div, ":var4", ":var3"),
      (store_random_in_range, ":var6", 0, 100),
      (try_begin),
        (eq, ":var6", 0),
        (val_min, ":var1", 10),
      (else_try),
        (gt, ":var4", 100),
        (val_mul, ":var2", 90),
        (val_div, ":var2", 100),
        (val_mul, ":var1", 90),
        (val_div, ":var1", 100),
      (else_try),
        (lt, ":var4", 30),
        (val_mul, ":var1", 120),
        (val_div, ":var1", 100),
        (val_add, ":var1", 1),
        (val_mul, ":var2", 120),
        (val_div, ":var2", 100),
        (val_add, ":var2", 1),
      (else_try),
        (lt, ":var4", 60),
        (val_mul, ":var1", 110),
        (val_div, ":var1", 100),
        (val_add, ":var1", 1),
        (val_mul, ":var2", 110),
        (val_div, ":var2", 100),
        (val_add, ":var2", 1),
      (else_try),
        (lt, ":var4", 100),
        (lt, ":var6", 50),
        (val_mul, ":var1", 105),
        (val_div, ":var1", 100),
        (try_begin),
          (le, ":var1", 20),
          (val_add, ":var1", 1),
        (try_end),
        (val_mul, ":var2", 105),
        (val_div, ":var2", 100),
        (try_begin),
          (le, ":var2", 20),
          (val_add, ":var2", 1),
        (try_end),
      (try_end),
      (party_set_slot, ":var0", 205, ":var1"),
      (party_set_slot, ":var0", 206, ":var2"),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (try_begin),
        (party_slot_ge, ":var0", 7, 0),
        (party_get_slot, ":var1", ":var0", 47),
        (assign, ":var2", 0),
        (party_get_slot, ":var3", ":var0", 290),
        (try_begin),
          (party_slot_eq, ":var0", 0, 4),
          (try_begin),
            (party_slot_eq, ":var0", 35, 0),
            (assign, ":var2", 600),
            (val_mul, ":var3", 4),
            (val_add, ":var2", ":var3"),
          (try_end),
        (else_try),
          (party_slot_eq, ":var0", 0, 2),
          (assign, ":var2", 600),
          (val_mul, ":var3", 6),
          (val_add, ":var2", ":var3"),
        (else_try),
          (party_slot_eq, ":var0", 0, 3),
          (assign, ":var2", 1200),
          (val_mul, ":var3", 3),
          (val_add, ":var2", ":var3"),
        (try_end),
        (party_get_slot, ":var4", ":var0", 50),
        (store_add, ":var5", 80, ":var4"),
        (val_mul, ":var2", ":var5"),
        (val_div, ":var2", 480),
        (try_begin),
          (party_slot_eq, ":var0", 7, "trp_player"),
          (266, ":var6"),
          (try_begin),
            (eq, ":var6", 0),
            (val_mul, ":var2", 3),
            (val_div, ":var2", 4),
          (else_try),
            (eq, ":var6", 1),
          (else_try),
            (eq, ":var6", 2),
            (val_mul, ":var2", 4),
            (val_div, ":var2", 3),
          (try_end),
        (try_end),
        (val_add, ":var1", ":var2"),
        (val_mul, ":var2", 125),
        (val_div, ":var2", 100),
        (party_set_slot, ":var0", 47, ":var1"),
      (try_end),
      (try_begin),
        (is_between, ":var0", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var7", ":var0", 120),
        (party_slot_ge, ":var7", 7, 0),
        (is_between, ":var7", "p_castle_1", "p_village_1"),
        (party_get_slot, ":var1", ":var7", 47),
        (val_add, ":var1", ":var2"),
        (party_set_slot, ":var7", 47, ":var1"),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 7),
      (neq, ":var1", "trp_player"),
      (is_between, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (party_get_slot, ":var2", ":var0", 47),
      (party_get_slot, ":var3", ":var0", 48),
      (troop_get_slot, ":var4", ":var1", 11),
      (val_add, ":var4", ":var2"),
      (val_add, ":var4", ":var3"),
      (troop_set_slot, ":var1", 11, ":var4"),
      (party_set_slot, ":var0", 47, 0),
      (party_set_slot, ":var0", 48, 0),
    (try_end),
  ]),

  (32,
  [
    (eq, "$players_kingdom", 0),
    (le, "$g_invite_faction", 0),
    (eq, "$g_player_is_captive", 0),
    (try_begin),
      (store_random_in_range, ":var0", "fac_kingdom_1", "fac_kingdoms_end"),
      (assign, ":var1", 999999),
      (try_for_range, ":var2", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":var3", ":var2"),
        (eq, ":var3", ":var0"),
        (store_distance_to_party_from_party, ":var4", "p_main_party", ":var2"),
        (val_min, ":var1", ":var4"),
      (try_end),
      (lt, ":var1", 30),
      (store_relation, ":var5", ":var0", "fac_player_supporters_faction"),
      (faction_get_slot, ":var6", ":var0", 11),
      (call_script, "script_troop_get_player_relation", ":var6"),
      (assign, ":var7", reg0),
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (assign, ":var8", reg0),
      (eq, "$g_infinite_camping", 0),
      (assign, ":var9", 0),
      (try_begin),
        (ge, "p_main_party", 0),
        (store_party_size_wo_prisoners, ":var9", "p_main_party"),
      (try_end),
      (try_begin),
        (eq, ":var8", 0),
        (troop_get_slot, ":var10", "trp_player", 7),
        (ge, ":var10", 160),
        (ge, ":var5", 0),
        (ge, ":var7", 0),
        (ge, ":var9", 45),
        (store_random_in_range, ":var11", 0, 100),
        (lt, ":var11", 50),
        (call_script, "script_get_poorest_village_of_faction", ":var0"),
        (assign, "$g_invite_offered_center", reg0),
        (ge, "$g_invite_offered_center", 0),
        (assign, "$g_invite_faction", ":var0"),
        (jump_to_menu, "mnu_invite_player_to_faction"),
      (else_try),
        (gt, ":var8", 0),
        (neq, "$players_oath_renounced_against_kingdom", ":var0"),
        (ge, ":var5", -40),
        (ge, ":var7", -20),
        (ge, ":var9", 30),
        (store_random_in_range, ":var11", 0, 100),
        (lt, ":var11", 20),
        (assign, "$g_invite_faction", ":var0"),
        (assign, "$g_invite_offered_center", -1),
        (jump_to_menu, "mnu_invite_player_to_faction_without_center"),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (store_random_in_range, ":var1", 0, 9999),
      (troop_set_slot, ":var0", 49, ":var1"),
    (try_end),
  ]),

  (0.1,
  [
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (troop_get_slot, ":var1", ":var0", 161),
      (gt, ":var1", 0),
      (party_is_active, ":var1"),
      (party_get_attached_to, ":var2", ":var1"),
      (lt, ":var2", 1),
      (party_get_cur_town, ":var3", ":var1"),
      (is_between, ":var3", "p_town_1", "p_salt_mine"),
      (troop_get_slot, ":var4", ":var0", 10),
      (ge, ":var4", 1),
      (party_is_active, ":var4"),
      (party_get_attached_to, ":var2", ":var4"),
      (eq, ":var2", ":var3"),
      (party_attach_to_party, ":var1", ":var3"),
      (try_begin),
        (this_or_next|party_slot_eq, ":var3", 0, 3),
        (party_slot_eq, ":var3", 0, 2),
        (store_faction_of_party, ":var5", ":var1"),
        (store_faction_of_party, ":var6", ":var3"),
        (eq, ":var5", ":var6"),
        (party_get_num_prisoner_stacks, ":var7", ":var1"),
        (gt, ":var7", 0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_prisoners_add_party_prisoners", ":var3", ":var1"),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_remove_all_prisoners", ":var1"),
      (try_end),
    (try_end),
    (try_begin),
      (troop_get_slot, ":var1", "trp_player", 161),
      (gt, ":var1", 0),
      (party_is_active, ":var1"),
      (party_get_attached_to, ":var2", ":var1"),
      (lt, ":var2", 1),
      (party_get_cur_town, ":var3", ":var1"),
      (is_between, ":var3", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var8", ":var3"),
      (try_begin),
        (neq, ":var8", "fac_player_supporters_faction"),
        (party_set_ai_behavior, ":var1", ai_bhvr_escort_party),
        (party_set_ai_object, ":var1", "p_main_party"),
        (party_set_flags, ":var1", 65536, 0),
        (party_set_ai_initiative, ":var1", 10),
      (try_end),
      (eq, ":var8", "fac_player_supporters_faction"),
      (party_attach_to_party, ":var1", ":var3"),
      (party_get_template_id, ":var9", ":var1"),
      (try_begin),
        (neq, ":var9", "pt_player_merc_singalians"),
        (this_or_next|party_slot_eq, ":var3", 0, 3),
        (party_slot_eq, ":var3", 0, 2),
        (store_faction_of_party, ":var5", ":var1"),
        (store_faction_of_party, ":var6", ":var3"),
        (eq, ":var5", ":var6"),
        (party_get_num_prisoner_stacks, ":var7", ":var1"),
        (gt, ":var7", 0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_prisoners_add_party_prisoners", ":var3", ":var1"),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_remove_all_prisoners", ":var1"),
      (try_end),
    (try_end),
    (try_for_range, ":var0", "trp_npc_adonja", "trp_heroes_end"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var4", ":var0", 10),
      (ge, ":var4", 1),
      (party_is_active, ":var4"),
      (party_get_attached_to, ":var2", ":var4"),
      (lt, ":var2", 1),
      (party_get_cur_town, ":var3", ":var4"),
      (is_between, ":var3", "p_town_1", "p_salt_mine"),
      (call_script, "script_get_relation_between_parties", ":var3", ":var4"),
      (try_begin),
        (ge, reg0, 0),
        (party_attach_to_party, ":var4", ":var3"),
        (try_begin),
          (is_between, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
          (troop_get_slot, ":var1", ":var0", 161),
          (gt, ":var1", 0),
          (party_is_active, ":var1"),
          (party_set_ai_behavior, ":var1", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var1", ":var3"),
        (try_end),
      (else_try),
        (party_set_ai_behavior, ":var4", ai_bhvr_hold),
      (try_end),
      (try_begin),
        (this_or_next|party_slot_eq, ":var3", 0, 3),
        (party_slot_eq, ":var3", 0, 2),
        (store_faction_of_party, ":var5", ":var4"),
        (store_faction_of_party, ":var6", ":var3"),
        (eq, ":var5", ":var6"),
        (party_get_num_prisoner_stacks, ":var7", ":var4"),
        (gt, ":var7", 0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_prisoners_add_party_prisoners", ":var3", ":var4"),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_remove_all_prisoners", ":var4"),
      (try_end),
    (try_end),
    (try_for_parties, ":var10"),
      (gt, ":var10", "p_spawn_points_end"),
      (party_get_template_id, ":var11", ":var10"),
      (ge, ":var11", "pt_steppe_bandit_lair"),
      (store_distance_to_party_from_party, ":var12", "p_main_party", ":var10"),
      (lt, ":var12", 3),
      (party_set_flags, ":var10", 256, 0),
      (party_set_flags, ":var10", 16384, 1),
    (try_end),
  ]),

  (48,
  [
    (store_skill_level, ":var0", skl_prisoner_management, "trp_player"),
    (val_mul, ":var0", 20),
    (store_sub, ":var1", 400, ":var0"),
    (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", "p_main_party", ":var1"),
    (try_for_range, ":var2", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var3", ":var2"),
      (try_begin),
        (eq, ":var3", "$players_kingdom"),
        (party_get_slot, ":var4", ":var2", 293),
        (store_skill_level, ":var0", skl_prisoner_management, ":var4"),
        (val_mul, ":var0", 10),
        (store_sub, ":var1", 200, ":var0"),
        (try_begin),
          (party_slot_eq, ":var2", 275, 1),
          (val_div, ":var1", 2),
        (try_end),
      (else_try),
        (assign, ":var1", 30),
        (try_begin),
          (party_slot_eq, ":var2", 275, 1),
          (assign, ":var1", 5),
        (try_end),
      (try_end),
      (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", ":var2", ":var1"),
    (try_end),
  ]),

  (48,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (neg|troop_slot_ge, ":var0", 8, 0),
      (neg|troop_slot_ge, ":var0", 10, 1),
      (store_troop_faction, ":var1", ":var0"),
      (try_begin),
        (eq, ":var1", "fac_outlaws"),
      (else_try),
        (try_begin),
          (eq, "$cheat_mode", 2),
          (str_store_troop_name, s4, ":var0"),
          (display_message, "str_debug__attempting_to_spawn_s4"),
        (try_end),
        (call_script, "script_cf_select_random_walled_center_with_faction_and_owner_priority_no_siege", ":var1", ":var0"),
        (assign, ":var2", reg0),
        (try_begin),
          (eq, "$cheat_mode", 2),
          (assign, reg7, ":var2"),
          (str_store_party_name, s7, ":var2"),
          (display_message, "str_debug__s0_is_spawning_around_party__s7"),
        (try_end),
        (call_script, "script_create_kingdom_hero_party", ":var0", ":var2"),
        (party_attach_to_party, "$pout_party", ":var2"),
        (troop_get_slot, ":var3", ":var0", 10),
        (call_script, "script_party_set_ai_state", ":var3", 7, ":var2"),
      (else_try),
        (neg|faction_slot_eq, ":var1", 21, 0),
        (try_begin),
          (is_between, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
          (troop_set_slot, ":var0", 55, "fac_commoners"),
        (else_try),
          (store_random_in_range, ":var4", 0, 100),
          (lt, ":var4", 10),
          (call_script, "script_cf_get_random_active_faction_except_player_faction_and_faction", ":var1"),
          (troop_set_slot, ":var0", 55, reg0),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (party_slot_eq, ":var0", 35, 0),
      (party_get_slot, ":var1", ":var0", 122),
      (this_or_next|eq, ":var1", 0),
      (neg|party_is_active, ":var1"),
      (store_random_in_range, ":var2", 0, 100),
      (lt, ":var2", 60),
      (call_script, "script_create_village_farmer_party", ":var0"),
      (party_set_slot, ":var0", 122, reg0),
    (try_end),
  ]),

  (72,
  [
    (call_script, "script_update_trade_good_prices"),
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 51),
      (try_begin),
        (gt, ":var1", 1000),
        (val_mul, ":var1", 95),
        (val_div, ":var1", 100),
        (val_max, ":var1", 1000),
      (else_try),
        (lt, ":var1", 1000),
        (val_mul, ":var1", 105),
        (val_div, ":var1", 100),
        (val_min, ":var1", 1000),
      (try_end),
      (party_set_slot, ":var0", 51, ":var1"),
    (try_end),
  ]),

  (8,
  [
    (try_for_parties, ":var0"),
      (assign, ":var1", 0),
      (try_begin),
        (party_slot_eq, ":var0", 0, 19),
        (party_is_in_any_town, ":var0"),
        (party_get_cur_town, ":var2", ":var0"),
        (party_slot_eq, ":var0", 123, ":var2"),
        (party_get_num_prisoner_stacks, ":var3", ":var0"),
        (try_begin),
          (gt, ":var3", 0),
          (assign, "$g_move_heroes", 1),
          (call_script, "script_party_prisoners_add_party_prisoners", ":var2", ":var0"),
        (try_end),
        (remove_party, ":var0"),
        (assign, ":var1", 1),
      (try_end),
      (eq, ":var1", 0),
      (party_slot_eq, ":var0", 0, 11),
      (party_is_in_any_town, ":var0"),
      (store_faction_of_party, ":var4", ":var0"),
      (faction_get_slot, ":var5", ":var4", 82),
      (try_begin),
        (le, ":var5", 0),
        (remove_party, ":var0"),
      (else_try),
        (party_get_cur_town, ":var2", ":var0"),
        (store_random_in_range, ":var6", 0, 100),
        (try_begin),
          (party_slot_eq, ":var2", 7, "trp_player"),
          (266, ":var7"),
          (try_begin),
            (eq, ":var7", 0),
            (assign, ":var8", 35),
          (else_try),
            (eq, ":var7", 1),
            (assign, ":var8", 45),
          (else_try),
            (eq, ":var7", 2),
            (assign, ":var8", 60),
          (try_end),
        (else_try),
          (assign, ":var8", 45),
        (try_end),
        (lt, ":var6", ":var8"),
        (assign, ":var9", 1),
        (try_begin),
          (is_between, ":var2", "p_town_1", "p_village_1"),
          (neg|party_slot_eq, ":var2", 54, -1),
          (assign, ":var9", 0),
        (try_end),
        (eq, ":var9", 1),
        (assign, ":var10", 0),
        (try_begin),
          (party_get_slot, ":var11", ":var0", 4),
          (eq, ":var11", 13),
          (party_get_slot, ":var12", ":var0", 5),
          (eq, ":var2", ":var12"),
          (assign, ":var10", 1),
        (try_end),
        (assign, ":var13", -1),
        (try_begin),
          (eq, "$caravan_escort_party_id", ":var0"),
          (neg|party_is_in_town, ":var0", "$caravan_escort_destination_town"),
          (assign, ":var13", "$caravan_escort_destination_town"),
        (else_try),
          (call_script, "script_cf_select_most_profitable_town_at_peace_with_faction_in_trade_route", ":var2", ":var4"),
          (assign, ":var13", reg0),
        (try_end),
        (is_between, ":var13", "p_town_1", "p_castle_1"),
        (neg|party_is_in_town, ":var0", ":var13"),
        (try_begin),
          (eq, ":var10", 1),
          (str_store_party_name, s7, ":var2"),
          (call_script, "script_do_merchant_town_trade", ":var0", ":var2"),
        (try_end),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var13"),
        (party_set_flags, ":var0", 65536, 0),
        (party_set_slot, ":var0", 4, 13),
        (party_set_slot, ":var0", 5, ":var13"),
      (try_end),
    (try_end),
  ]),

  (8,
  [
    (try_for_parties, ":var0"),
      (try_begin),
        (party_slot_eq, ":var0", 0, 15),
        (party_is_in_any_town, ":var0"),
        (party_get_slot, ":var1", ":var0", 123),
        (party_get_cur_town, ":var2", ":var0"),
        (assign, ":var3", 1),
        (try_begin),
          (is_between, ":var2", "p_town_1", "p_village_1"),
          (neg|party_slot_eq, ":var2", 54, -1),
          (assign, ":var3", 0),
        (try_end),
        (eq, ":var3", 1),
        (try_begin),
          (eq, ":var2", ":var1"),
          (call_script, "script_do_party_center_trade", ":var0", ":var1", 25),
          (store_faction_of_party, ":var4", ":var2"),
          (party_set_faction, ":var0", ":var4"),
          (party_get_slot, ":var5", ":var1", 121),
          (party_set_slot, ":var0", 5, ":var5"),
          (party_set_slot, ":var0", 4, 13),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var5"),
        (else_try),
          (try_begin),
            (party_get_slot, ":var6", ":var0", 5),
            (eq, ":var2", ":var6"),
            (call_script, "script_do_party_center_trade", ":var0", ":var6", 25),
            (assign, ":var7", reg0),
            (party_get_slot, ":var8", ":var6", 48),
            (party_get_slot, ":var9", ":var6", 50),
            (assign, ":var10", ":var7"),
            (val_mul, ":var10", ":var9"),
            (val_div, ":var10", 400),
            (val_div, ":var10", 20),
            (val_add, ":var8", ":var10"),
            (try_begin),
              (ge, "$cheat_mode", 3),
              (assign, reg4, ":var10"),
              (str_store_party_name, s4, ":var6"),
              (assign, reg5, ":var8"),
              (display_message, "@{!}New tariffs at {s4} = {reg4}, total = {reg5}"),
            (try_end),
            (party_set_slot, ":var6", 48, ":var8"),
            (party_get_slot, ":var11", ":var6", 53),
            (call_script, "script_center_get_food_store_limit", ":var6"),
            (assign, ":var12", reg0),
            (val_add, ":var11", 1000),
            (val_min, ":var11", ":var12"),
            (party_set_slot, ":var6", 53, ":var11"),
            (try_begin),
              (store_random_in_range, ":var13", 0, 100),
              (lt, ":var13", 35),
              (call_script, "script_change_center_prosperity", ":var1", 1),
              (val_add, "$newglob_total_prosperity_from_village_trade", 1),
            (try_end),
          (try_end),
          (party_set_slot, ":var0", 5, ":var1"),
          (party_set_slot, ":var0", 4, 13),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var1"),
        (try_end),
      (else_try),
        (party_is_active, ":var0"),
        (party_get_template_id, ":var14", ":var0"),
        (this_or_next|eq, ":var14", "pt_militia"),
        (this_or_next|eq, ":var14", "pt_errant_knights"),
        (eq, ":var14", "pt_stronghold_patrol"),
        (party_get_slot, ":var1", ":var0", 123),
        (gt, ":var1", 0),
        (try_begin),
          (eq, ":var14", "pt_militia"),
          (party_get_slot, ":var1", ":var0", 123),
          (party_get_slot, ":var15", ":var1", 120),
        (else_try),
          (get_party_ai_object, ":var16", ":var0"),
          (assign, ":var15", ":var16"),
        (try_end),
        (gt, ":var15", 0),
        (try_begin),
          (party_is_in_town, ":var0", ":var15"),
          (party_get_num_prisoner_stacks, ":var17", ":var0"),
          (try_for_range_backwards, ":var18", 0, ":var17"),
            (party_prisoner_stack_get_troop_id, ":var19", ":var0", ":var18"),
            (party_prisoner_stack_get_size, ":var20", ":var0", ":var18"),
            (party_remove_prisoners, ":var0", ":var19", ":var20"),
            (party_count_prisoners_of_type, ":var21", ":var15", ":var19"),
            (party_remove_prisoners, ":var15", ":var19", ":var21"),
            (val_add, ":var21", ":var20"),
            (party_add_prisoners, ":var15", ":var19", ":var21"),
          (try_end),
          (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
          (party_set_ai_patrol_radius, ":var0", 5),
          (party_set_ai_object, ":var0", ":var1"),
        (else_try),
          (get_party_ai_behavior, ":var22", ":var0"),
          (eq, ":var22", 3),
          (call_script, "script_party_count_fit_for_battle", ":var0"),
          (assign, ":var23", reg0),
          (val_max, ":var23", 1),
          (party_get_num_prisoners, ":var24", ":var0"),
          (store_mul, ":var25", ":var24", 100),
          (val_div, ":var25", ":var23"),
          (this_or_next|ge, ":var25", 50),
          (ge, ":var24", 35),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var15"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (try_for_range, ":var0", "p_castle_1", "p_village_1"),
      (party_slot_eq, ":var0", 54, -1),
      (party_get_slot, ":var1", ":var0", 53),
      (val_add, ":var1", 100),
      (call_script, "script_center_get_food_store_limit", ":var0"),
      (assign, ":var2", reg0),
      (val_min, ":var1", ":var2"),
      (party_set_slot, ":var0", 53, ":var1"),
    (try_end),
  ]),

  (0.5,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_heroes_end"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", 0),
      (try_begin),
        (party_is_active, ":var1"),
        (try_begin),
          (get_party_ai_current_behavior, ":var2", ":var1"),
          (eq, ":var2", 5),
          (assign, ":var3", 1),
          (try_begin),
            (this_or_next|troop_slot_eq, ":var0", 52, 7),
            (troop_slot_eq, ":var0", 52, 1),
            (get_party_ai_current_object, ":var4", ":var1"),
            (party_is_active, ":var4"),
            (party_get_battle_opponent, ":var5", ":var4"),
            (party_is_active, ":var5"),
            (assign, ":var3", 0),
          (try_end),
          (eq, ":var3", 1),
          (store_faction_of_party, ":var6", ":var1"),
          (party_get_slot, ":var7", ":var1", 30),
          (faction_get_slot, ":var8", ":var6", 8),
          (neq, ":var8", ":var0"),
          (assign, ":var3", 1),
          (try_begin),
            (ge, ":var8", 0),
            (troop_get_slot, ":var9", ":var8", 10),
            (party_is_active, ":var9", 0),
            (eq, ":var7", ":var9"),
            (assign, ":var3", 0),
          (try_end),
          (eq, ":var3", 1),
          (assign, ":var10", 0),
          (try_for_range, ":var11", "p_town_1", "p_village_1"),
            (eq, ":var10", 0),
            (party_slot_eq, ":var11", 54, -1),
            (store_faction_of_party, ":var12", ":var11"),
            (store_relation, ":var13", ":var12", ":var6"),
            (gt, ":var13", 0),
            (store_distance_to_party_from_party, ":var14", ":var1", ":var11"),
            (lt, ":var14", 20),
            (party_get_position, pos1, ":var1"),
            (party_get_position, pos2, ":var11"),
            (neg|714, 2, 1),
            (call_script, "script_party_set_ai_state", ":var1", 14, ":var11"),
            (assign, ":var10", 1),
          (try_end),
        (try_end),
      (else_try),
        (troop_set_slot, ":var0", 10, -1),
      (try_end),
    (try_end),
  ]),

  (0.5,
  [
    (store_current_hours, ":var0"),
    (store_mod, ":var1", ":var0", 11),
    (store_sub, ":var2", ":var0", 5),
    (party_get_num_companions, ":var3", "p_main_party"),
    (party_get_num_prisoners, ":var4", "p_main_party"),
    (val_add, ":var3", ":var4"),
    (convert_to_fixed_point, ":var3"),
    (store_sqrt, ":var5", ":var3"),
    (convert_from_fixed_point, ":var5"),
    (try_begin),
      (eq, ":var1", 0),
      (try_for_range, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_get_slot, ":var7", ":var6", 30),
        (val_sub, ":var7", 1),
        (val_max, ":var7", 0),
        (faction_set_slot, ":var6", 30, ":var7"),
      (try_end),
    (try_end),
    (eq, "$g_player_is_captive", 0),
    (try_for_range, ":var8", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var6", ":var8"),
      (store_relation, ":var9", ":var6", "fac_player_supporters_faction"),
      (lt, ":var9", 0),
      (store_distance_to_party_from_party, ":var10", "p_main_party", ":var8"),
      (lt, ":var10", 5),
      (store_mul, ":var11", ":var10", ":var10"),
      (store_sub, ":var12", 20, ":var11"),
      (store_sub, ":var13", 20, ":var9"),
      (store_mul, ":var14", ":var12", ":var13"),
      (val_mul, ":var14", ":var5"),
      (store_div, ":var15", ":var14", 10),
      (store_random_in_range, ":var16", 0, 1000),
      (lt, ":var16", ":var15"),
      (faction_get_slot, ":var7", ":var6", 30),
      (val_add, ":var7", 1),
      (val_min, ":var7", 100),
      (faction_set_slot, ":var6", 30, ":var7"),
      (try_begin),
        (neg|party_slot_ge, ":var8", 42, ":var2"),
        (str_store_party_name_link, s1, ":var8"),
        (display_message, "@Your party is spotted by {s1}."),
        (party_set_slot, ":var8", 42, ":var0"),
      (try_end),
    (try_end),
  ]),

  (14,
  [
    (eq, "$g_player_is_captive", 0),
    (party_get_num_companion_stacks, ":var0", "p_main_party"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 0, ":var0"),
      (party_stack_get_size, ":var3", "p_main_party", ":var2"),
      (val_add, ":var1", ":var3"),
    (try_end),
    (val_mul, ":var1", 10),
    (party_get_skill_level, ":var4", "p_main_party", skl_tracking),
    (try_begin),
      (le, ":var4", 0),
      (val_div, ":var1", 27),
    (else_try),
      (le, ":var4", 2),
      (val_div, ":var1", 30),
    (else_try),
      (le, ":var4", 5),
      (val_div, ":var1", 35),
    (else_try),
      (le, ":var4", 8),
      (val_div, ":var1", 43),
    (else_try),
      (le, ":var4", 11),
      (val_div, ":var1", 54),
    (else_try),
      (le, ":var4", 13),
      (val_div, ":var1", 75),
    (else_try),
      (val_div, ":var1", 100),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (val_add, ":var1", 1),
    (try_end),
    (try_begin),
      (assign, ":var5", 0),
      (try_for_range, ":var6", "itm_smoked_fish", "itm_siege_supply"),
        (call_script, "script_cf_player_has_item_without_modifier", ":var6", 41),
        (val_add, ":var5", 1),
      (try_end),
      (try_begin),
        (player_has_item, "itm_raw_date_fruit"),
        (val_add, ":var5", 1),
      (try_end),
      (try_begin),
        (ge, ":var5", 6),
        (372, 36),
      (try_end),
    (try_end),
    (assign, ":var7", ":var1"),
    (assign, ":var8", 0),
    (try_for_range, ":var9", 0, ":var7"),
      (assign, ":var10", 0),
      (try_for_range, ":var11", "itm_smoked_fish", "itm_siege_supply"),
        (item_set_slot, ":var11", 0, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":var11", 41),
        (val_add, ":var10", 1),
      (try_end),
      (try_begin),
        (item_set_slot, "itm_raw_date_fruit", 0, 0),
        (player_has_item, "itm_raw_date_fruit"),
        (val_add, ":var10", 1),
      (try_end),
      (try_begin),
        (gt, ":var10", 0),
        (store_random_in_range, ":var12", 0, ":var10"),
        (call_script, "script_consume_food", ":var12"),
      (else_try),
        (eq, ":var8", 0),
        (display_message, "@Party has nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -3),
        (assign, ":var8", 1),
        (try_begin),
          (call_script, "script_party_count_fit_regulars", "p_main_party"),
          (gt, reg0, 0),
          (call_script, "script_objectionable_action", 2, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (troop_get_inventory_capacity, ":var0", "trp_player"),
    (try_for_range, ":var1", 0, ":var0"),
      (troop_get_inventory_slot, ":var2", "trp_player", ":var1"),
      (this_or_next|eq, ":var2", "itm_cattle_meat"),
      (this_or_next|eq, ":var2", "itm_chicken"),
      (eq, ":var2", "itm_pork"),
      (troop_get_inventory_slot_modifier, ":var3", "trp_player", ":var1"),
      (try_begin),
        (ge, ":var3", 37),
        (lt, ":var3", 41),
        (val_add, ":var3", 1),
        (troop_set_inventory_slot_modifier, "trp_player", ":var1", ":var3"),
      (else_try),
        (lt, ":var3", 37),
        (troop_set_inventory_slot_modifier, "trp_player", ":var1", 37),
      (try_end),
    (try_end),
  ]),

  (72,
  []),

  (0,
  [
    (troop_get_inventory_slot, ":var0", "trp_player", ek_horse),
    (assign, ":var1", -1),
    (try_begin),
      (eq, "$g_player_icon_state", 0),
      (try_begin),
        (ge, ":var0", 0),
        (assign, ":var1", "icon_player_horseman"),
      (else_try),
        (assign, ":var1", "icon_player"),
      (try_end),
    (else_try),
      (eq, "$g_player_icon_state", 1),
      (assign, ":var1", "icon_camp"),
    (else_try),
      (eq, "$g_player_icon_state", 2),
      (assign, ":var1", "icon_ship"),
    (try_end),
    (neq, ":var1", "$g_player_party_icon"),
    (assign, "$g_player_party_icon", ":var1"),
    (party_set_icon, "p_main_party", ":var1"),
  ]),

  (2,
  [
    (store_troop_gold, ":var0", "trp_player"),
    (store_div, ":var1", ":var0", 100),
    (troop_get_inventory_capacity, ":var2", "trp_player"),
    (try_for_range, ":var3", 0, ":var2"),
      (troop_get_inventory_slot, ":var4", "trp_player", ":var3"),
      (ge, ":var4", 0),
      (try_begin),
        (is_between, ":var4", "itm_spice", "itm_baggage_train"),
        (store_item_value, ":var5", ":var4"),
        (val_add, ":var0", ":var5"),
      (try_end),
    (try_end),
    (val_clamp, ":var1", 0, 100),
    (party_set_bandit_attraction, "p_main_party", ":var1"),
  ]),

  (3,
  [
    (try_for_range, ":var0", "p_town_1", "p_village_1"),
      (faction_slot_eq, "fac_player_supporters_faction", 21, 2),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (call_script, "script_activate_player_faction", "trp_player"),
    (try_end),
  ]),

  (6,
  [
    (gt, "$g_prisoner_recruit_troop_id", 0),
    (gt, "$g_prisoner_recruit_size", 0),
    (gt, "$g_prisoner_recruit_last_time", 0),
    (is_currently_night),
    (try_begin),
      (store_skill_level, ":var0", skl_leadership, "trp_player"),
      (val_mul, ":var0", 5),
      (store_sub, ":var1", 66, ":var0"),
      (gt, ":var1", 0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", 0, "$g_prisoner_recruit_size"),
        (store_random_in_range, ":var4", 0, 100),
        (lt, ":var4", ":var1"),
        (val_add, ":var2", 1),
      (try_end),
      (party_remove_members, "p_main_party", "$g_prisoner_recruit_troop_id", ":var2"),
      (assign, ":var2", reg0),
      (gt, ":var2", 0),
      (try_begin),
        (gt, ":var2", 1),
        (assign, reg2, 1),
      (else_try),
        (assign, reg2, 0),
      (try_end),
      (assign, reg1, ":var2"),
      (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", ":var2"),
      (display_log_message, "@{reg1} {s1} {reg2?have:has} escaped from your party during the night."),
    (try_end),
    (assign, "$g_prisoner_recruit_troop_id", 0),
    (assign, "$g_prisoner_recruit_size", 0),
  ]),

  (24,
  [
    (neq, "$g_ransom_offer_rejected", 1),
    (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", "p_main_party"),
    (eq, reg0, 0),
    (assign, ":var0", "p_village_1"),
    (try_for_range, ":var1", "p_town_1", ":var0"),
      (party_slot_eq, ":var1", 7, "trp_player"),
      (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", ":var1"),
      (eq, reg0, 1),
      (assign, ":var0", 0),
    (try_end),
  ]),

  (72,
  [
    (assign, "$g_ransom_offer_rejected", 0),
    (try_for_range, ":var0", "p_town_1", "p_village_1"),
      (party_get_slot, ":var1", ":var0", 7),
      (gt, ":var1", 0),
      (party_get_num_prisoner_stacks, ":var2", ":var0"),
      (try_for_range_backwards, ":var3", 0, ":var2"),
        (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
        (troop_is_hero, ":var4"),
        (troop_slot_eq, ":var4", 2, 2),
        (store_random_in_range, ":var5", 0, 100),
        (try_begin),
          (le, ":var5", 10),
          (call_script, "script_calculate_ransom_amount_for_troop", ":var4"),
          (assign, ":var6", reg0),
          (troop_get_slot, ":var7", ":var1", 11),
          (val_add, ":var7", ":var6"),
          (troop_set_slot, ":var1", 11, ":var7"),
          (party_remove_prisoners, ":var0", ":var4", 1),
          (call_script, "script_remove_troop_from_prison", ":var4"),
          (store_troop_faction, ":var8", ":var1"),
          (store_troop_faction, ":var9", ":var4"),
          (str_store_troop_name, s1, ":var4"),
          (str_store_faction_name, s2, ":var8"),
          (str_store_faction_name, s3, ":var9"),
          (try_begin),
            (this_or_next|eq, ":var9", "$players_kingdom"),
            (eq, "$g_option_important_news", 0),
            (call_script, "script_get_message_color", 3, ":var4"),
            (display_log_message, "@{s1} of the {s3} has been released from captivity.", reg20),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (72,
  [
    (call_script, "script_update_mercenary_units_of_towns"),
    (call_script, "script_update_ransom_brokers"),
    (call_script, "script_update_tavern_travellers"),
    (call_script, "script_update_tavern_minstrels"),
    (call_script, "script_update_booksellers"),
    (call_script, "script_update_villages_infested_by_bandits"),
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (call_script, "script_update_volunteer_troops_in_village", ":var0"),
      (call_script, "script_update_npc_volunteer_troops_in_village", ":var0"),
    (try_end),
  ]),

  (24,
  [
    (call_script, "script_update_other_taverngoers"),
  ]),

  (36,
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (this_or_next|party_slot_eq, ":var0", 0, 3),
      (party_slot_eq, ":var0", 0, 4),
      (call_script, "script_center_remove_walker_type_from_walkers", ":var0", 1),
      (call_script, "script_center_remove_walker_type_from_walkers", ":var0", 2),
      (store_random_in_range, ":var1", 0, 100),
      (try_begin),
        (lt, ":var1", 70),
        (neg|party_slot_ge, ":var0", 50, 240),
        (call_script, "script_cf_center_get_free_walker", ":var0"),
        (call_script, "script_center_set_walker_to_type", ":var0", reg0, 1),
      (try_end),
    (try_end),
  ]),

  (12,
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 124),
      (gt, ":var1", 0),
      (party_get_slot, ":var2", ":var0", 125),
      (store_current_hours, ":var3"),
      (ge, ":var3", ":var2"),
      (call_script, "script_center_base_income_change", ":var0", ":var1", 1),
      (party_set_slot, ":var0", 124, 0),
      (call_script, "script_get_improvement_details", ":var1", ":var0"),
      (try_begin),
        (party_slot_eq, ":var0", 7, "trp_player"),
        (str_store_party_name, s4, ":var0"),
        (val_add, "$g_improvements_built", 1),
        (display_log_message, "@Building of {s10} in {s4} has been completed."),
        (play_sound, "snd_bellchant"),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (assign, ":var0", 0),
    (try_for_range, ":var1", "p_town_1", "p_castle_1"),
      (party_get_slot, ":var2", ":var1", 156),
      (try_begin),
        (eq, ":var2", 1),
        (call_script, "script_fill_tournament_participants_troop", ":var1", 0),
        (call_script, "script_sort_tournament_participant_troops"),
        (call_script, "script_get_num_tournament_participants"),
        (store_sub, ":var3", reg0, 1),
        (call_script, "script_remove_tournament_participants_randomly", ":var3"),
        (call_script, "script_sort_tournament_participant_troops"),
        (troop_get_slot, ":var4", "trp_tournament_participants", 0),
        (try_begin),
          (is_between, ":var4", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (str_store_troop_name_link, s1, ":var4"),
          (str_store_party_name_link, s2, ":var1"),
          (display_message, "@{s1} has won the tournament at {s2}."),
          (call_script, "script_change_troop_renown", ":var4", 20),
        (try_end),
      (try_end),
      (val_sub, ":var2", 1),
      (val_max, ":var2", 0),
      (party_set_slot, ":var1", 156, ":var2"),
      (try_begin),
        (gt, ":var2", 0),
        (val_add, ":var0", 1),
      (try_end),
    (try_end),
    (store_current_hours, ":var5"),
    (call_script, "script_game_get_date_text", 0, ":var5"),
    (assign, ":var6", reg1),
    (try_begin),
      (eq, ":var6", 4),
      (party_set_slot, "p_castle_noldor", 156, 0),
    (else_try),
      (eq, ":var6", 1),
      (party_set_slot, "p_castle_noldor", 156, 1),
    (try_end),
    (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
      (this_or_next|party_slot_eq, ":var1", 0, 3),
      (party_slot_eq, ":var1", 0, 4),
      (party_get_slot, ":var7", ":var1", 155),
      (try_begin),
        (le, ":var7", 0),
        (assign, ":var8", 0),
        (try_begin),
          (check_quest_active, "qst_deal_with_night_bandits"),
          (quest_slot_eq, "qst_deal_with_night_bandits", 1, ":var1"),
          (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
          (assign, ":var8", 1),
        (else_try),
          (store_random_in_range, ":var9", 0, 100),
          (lt, ":var9", 3),
          (assign, ":var8", 1),
        (try_end),
        (try_begin),
          (eq, ":var8", 1),
          (store_random_in_range, ":var9", 0, 9),
          (try_begin),
            (eq, ":var9", 0),
            (assign, ":var10", "trp_bandit"),
          (else_try),
            (eq, ":var9", 1),
            (assign, ":var10", "trp_brigand"),
          (else_try),
            (eq, ":var9", 2),
            (assign, ":var10", "trp_forest_bandit"),
          (else_try),
            (eq, ":var9", 3),
            (assign, ":var10", "trp_rb_thief"),
          (else_try),
            (eq, ":var9", 4),
            (assign, ":var10", "trp_rb_guildsman"),
          (else_try),
            (eq, ":var9", 5),
            (assign, ":var10", "trp_slave_hunter"),
          (else_try),
            (eq, ":var9", 6),
            (assign, ":var10", "trp_scorpion_assassin_knight"),
          (else_try),
            (eq, ":var9", 7),
            (assign, ":var10", "trp_snake_armsman"),
          (else_try),
            (assign, ":var10", "trp_outlaw_leader"),
          (try_end),
          (party_set_slot, ":var1", 155, ":var10"),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@{!}{s1} is infested by bandits (at night)."),
          (try_end),
        (try_end),
      (else_try),
        (try_begin),
          (assign, ":var11", 40),
          (try_begin),
            (party_slot_eq, ":var1", 0, 3),
            (assign, ":var11", 20),
          (try_end),
          (store_random_in_range, ":var9", 0, 100),
          (lt, ":var9", ":var11"),
          (party_set_slot, ":var1", 155, 0),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@{s1} is no longer infested by bandits (at night)."),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (try_for_range, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var12", 4, 6),
      (faction_get_slot, ":var13", ":var12", 5),
      (is_between, ":var13", "p_town_1", "p_castle_1"),
      (party_slot_ge, ":var13", 156, 1),
      (party_set_slot, ":var13", 156, 2),
    (try_end),
    (try_begin),
      (lt, ":var0", 3),
      (store_random_in_range, ":var9", 0, 100),
      (lt, ":var9", 30),
      (store_random_in_range, ":var14", "p_town_1", "p_castle_1"),
      (store_random_in_range, ":var15", 12, 15),
      (party_set_slot, ":var14", 156, ":var15"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_party_name, s1, ":var14"),
        (display_message, "@{!}{s1} is holding a tournament."),
      (try_end),
    (try_end),
  ]),

  (3,
  [
    (assign, "$g_player_tournament_placement", 0),
  ]),

  (8,
  []),

  (1,
  [
    (neg|map_free),
    (is_currently_night),
    (is_between, "$g_last_rest_center", "p_town_1", "p_salt_mine"),
    (neg|party_slot_eq, "$g_last_rest_center", 7, "trp_player"),
    (store_faction_of_party, ":var0", "$g_last_rest_center"),
    (neq, ":var0", "fac_player_supporters_faction"),
    (store_current_hours, ":var1"),
    (ge, ":var1", "$g_last_rest_payment_until"),
    (store_add, "$g_last_rest_payment_until", ":var1", 24),
    (store_troop_gold, ":var2", "trp_player"),
    (party_get_num_companions, ":var3", "p_main_party"),
    (store_div, ":var4", ":var3", 4),
    (val_add, ":var4", 1),
    (try_begin),
      (ge, ":var2", ":var4"),
      (display_message, "@You pay for accommodation."),
      (troop_remove_gold, "trp_player", ":var4"),
    (else_try),
      (gt, ":var2", 0),
      (troop_remove_gold, "trp_player", ":var2"),
    (try_end),
    (store_random_in_range, ":var5", 1, 11),
    (eq, ":var5", 1),
    (assign, "$g_background_encounter", 1),
    (store_random_in_range, ":var6", 1, 6),
    (try_begin),
      (eq, ":var6", 1),
      (play_sound, "snd_encounter_pop_sfx_eight"),
      (display_message, "str_cb5_feeling_1", 0x6666FF),
    (else_try),
      (eq, ":var6", 2),
      (play_sound, "snd_distant_owl"),
      (display_message, "str_cb5_feeling_2", 0x6666FF),
    (else_try),
      (eq, ":var6", 3),
      (play_sound, "snd_distant_dog_bark"),
      (display_message, "str_cb5_feeling_3", 0x6666FF),
    (else_try),
      (eq, ":var6", 4),
      (play_sound, "snd_encounter_pop_sfx_eight"),
      (display_message, "str_cb5_feeling_4", 0x6666FF),
    (else_try),
      (play_sound, "snd_encounter_pop_sfx_eight"),
      (display_message, "str_cb5_feeling_5", 0x6666FF),
    (try_end),
  ]),

  (12,
  [
    (call_script, "script_spawn_bandits"),
    (call_script, "script_spawn_red_brotherhood"),
  ]),

  (16,
  [
    (call_script, "script_spawn_snake_cult", 0),
    (call_script, "script_spawn_heretics", 0),
    (call_script, "script_spawn_jatu", 0),
    (call_script, "script_spawn_vanskerry"),
    (call_script, "script_spawn_mystmountain", 0),
    (call_script, "script_spawn_errant_knights"),
    (call_script, "script_spawn_vanskerry"),
    (call_script, "script_spawn_singal_raiders"),
    (call_script, "script_spawn_noldor", 0),
    (call_script, "script_spawn_inquisition", 0),
  ]),

  (42,
  [
    (call_script, "script_update_party_creation_random_limits"),
    (call_script, "script_determine_victory_conditions_and_text", 0),
  ]),

  (24,
  [
    (assign, ":var0", 0),
    (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_set_slot, ":var1", 20, 0),
    (try_end),
    (try_for_parties, ":var2"),
      (store_faction_of_party, ":var3", ":var2"),
      (is_between, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (this_or_next|is_between, ":var2", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var2", 0, 13),
      (faction_get_slot, ":var4", ":var3", 20),
      (val_add, ":var4", 1),
      (faction_set_slot, ":var3", 20, ":var4"),
    (try_end),
    (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var1", 21, 0),
      (val_add, ":var0", 1),
      (faction_slot_eq, ":var1", 20, 0),
      (assign, ":var5", 0),
      (try_begin),
        (eq, ":var1", "fac_player_supporters_faction"),
        (try_begin),
          (le, "$supported_pretender", 0),
          (faction_set_slot, ":var1", 21, 2),
          (assign, ":var5", 1),
        (try_end),
      (else_try),
        (neq, "$players_kingdom", ":var1"),
        (faction_set_slot, ":var1", 21, 1),
        (try_begin),
          (eq, ":var1", "fac_kingdom_3"),
          (neq, "$supported_pretender", "trp_kingdom_3_pretender"),
          (assign, "$inquisition_spawn_region", "p_heretic_spawn_point"),
          (display_message, "@D'Shar have fallen alongside their ideals. The Inquisition will focus and deploy all efforts against Heretics further north.", 0xFFAA00),
          (try_for_parties, ":var2"),
            (store_faction_of_party, ":var3", ":var2"),
            (eq, ":var3", "fac_inquisition"),
            (remove_party, ":var2"),
          (try_end),
        (try_end),
        (try_for_parties, ":var2"),
          (store_faction_of_party, ":var3", ":var2"),
          (eq, ":var3", ":var1"),
          (party_get_slot, ":var6", ":var2", 123),
          (try_begin),
            (gt, ":var6", 0),
            (store_faction_of_party, ":var7", ":var6"),
            (party_set_faction, ":var2", ":var7"),
          (else_try),
            (party_set_faction, ":var2", "fac_outlaws"),
            (party_set_ai_behavior, ":var2", ai_bhvr_patrol_location),
            (party_set_ai_object, ":var2", "p_main_party"),
          (try_end),
        (try_end),
        (assign, ":var8", -1),
        (try_for_range, ":var9", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var9", 14, ":var1"),
          (assign, ":var8", ":var9"),
        (try_end),
        (try_begin),
          (is_between, ":var8", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
          (neq, ":var8", "$supported_pretender"),
          (troop_set_slot, ":var8", 12, 0),
        (try_end),
        (assign, ":var5", 1),
        (try_begin),
          (eq, "$players_oath_renounced_against_kingdom", ":var1"),
          (assign, "$players_oath_renounced_against_kingdom", 0),
          (assign, "$players_oath_renounced_given_center", 0),
          (assign, "$players_oath_renounced_begin_time", 0),
          (call_script, "script_add_notification_menu", "mnu_notification_oath_renounced_faction_defeated", ":var1", 0),
        (try_end),
        (call_script, "script_add_notification_menu", "mnu_notification_faction_defeated", ":var1", 0),
      (try_end),
      (try_begin),
        (eq, ":var5", 1),
        (val_sub, ":var0", 1),
      (try_end),
      (try_for_range, ":var10", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (call_script, "script_update_faction_notes", ":var10"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var0", 1),
      (assign, "$g_one_faction_left_notification_shown", 1),
      (call_script, "script_determine_victory_conditions_and_text", 0),
      (le, reg7, 30),
      (le, reg8, 30),
      (le, reg9, 30),
      (le, reg10, 30),
      (eq, "$g_win_pop", 0),
      (store_relation, ":var11", "fac_noldor_elves", "fac_player_faction"),
      (ge, ":var11", 30),
      (eq, reg4, 0),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (assign, "$g_win_pop", 1),
        (call_script, "script_add_notification_menu", "mnu_notification_one_faction_left", ":var1", 0),
      (try_end),
    (try_end),
  ]),

  (3,
  [
    (try_begin),
      (is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var0", "$g_player_court"),
      (neq, ":var0", "fac_player_supporters_faction"),
      (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (else_try),
      (lt, "$g_player_court", "p_town_1"),
      (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (gt, "$g_player_minister", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1", "p_village_1"),
        (eq, ":var1", 0),
        (store_faction_of_party, ":var0", ":var2"),
        (eq, ":var0", "fac_player_supporters_faction"),
        (assign, ":var1", ":var2"),
      (try_end),
      (ge, ":var1", 1),
      (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (try_end),
    (try_for_parties, ":var3"),
      (gt, ":var3", "p_spawn_points_end"),
      (party_get_template_id, ":var4", ":var3"),
      (is_between, ":var4", "pt_steppe_bandits", "pt_forest_outcasts"),
      (party_template_get_slot, ":var5", ":var4", 4),
      (try_begin),
        (gt, ":var5", "p_spawn_points_end"),
        (store_distance_to_party_from_party, ":var6", ":var3", ":var5"),
        (gt, ":var6", 30),
        (party_set_ai_behavior, ":var3", ai_bhvr_travel_to_point),
        (party_get_position, pos5, ":var5"),
        (party_set_ai_target_position, ":var3", pos5),
      (else_try),
        (get_party_ai_behavior, ":var7", ":var3"),
        (eq, ":var7", 6),
        (try_begin),
          (gt, ":var5", "p_spawn_points_end"),
          (store_distance_to_party_from_party, ":var6", ":var3", ":var5"),
          (lt, ":var6", 3),
          (party_set_ai_behavior, ":var3", ai_bhvr_patrol_party),
          (party_template_get_slot, ":var8", ":var4", 5),
          (party_set_ai_object, ":var3", ":var8"),
          (party_set_ai_patrol_radius, ":var3", 45),
        (else_try),
          (lt, ":var5", "p_spawn_points_end"),
          (party_set_ai_behavior, ":var3", ai_bhvr_patrol_party),
          (party_template_get_slot, ":var8", ":var4", 5),
          (party_set_ai_object, ":var3", ":var8"),
          (party_set_ai_patrol_radius, ":var3", 45),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (troop_get_slot, ":var9", "trp_player", 34),
      (gt, ":var9", 0),
      (neg|check_quest_active, "qst_wed_betrothed"),
      (neg|check_quest_active, "qst_wed_betrothed_female"),
      (str_store_troop_name, s5, ":var9"),
      (display_message, "@Betrothal to {s5} expires"),
      (troop_set_slot, "trp_player", 34, -1),
      (troop_set_slot, ":var9", 34, -1),
    (try_end),
  ]),

  (336,
  [
    (troop_get_slot, ":var0", "trp_player", 7),
    (store_div, ":var1", ":var0", 200),
    (val_sub, ":var0", ":var1"),
    (troop_set_slot, "trp_player", 7, ":var0"),
  ]),

  (1,
  [
    (neg|map_free),
    (gt, "$g_player_reading_book", 0),
    (player_has_item, "$g_player_reading_book"),
    (store_attribute_level, ":var0", "trp_player", ca_intelligence),
    (item_get_slot, ":var1", "$g_player_reading_book", 4),
    (le, ":var1", ":var0"),
    (item_get_slot, ":var2", "$g_player_reading_book", 2),
    (item_get_slot, ":var3", "$g_player_reading_book", 3),
    (eq, ":var3", 0),
    (val_add, ":var2", 7),
    (item_set_slot, "$g_player_reading_book", 2, ":var2"),
    (ge, ":var2", 1000),
    (item_set_slot, "$g_player_reading_book", 3, 1),
    (str_clear, s2),
    (try_begin),
      (eq, "$g_player_reading_book", "itm_book_tactics"),
      (troop_raise_skill, "trp_player", skl_tactics, 1),
      (str_store_string, s2, "@ Your tactics skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_persuasion"),
      (troop_raise_skill, "trp_player", skl_persuasion, 1),
      (str_store_string, s2, "@ Your persuasion skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_leadership"),
      (troop_raise_skill, "trp_player", skl_leadership, 1),
      (str_store_string, s2, "@ Your leadership skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_intelligence"),
      (troop_raise_attribute, "trp_player", ca_intelligence, 1),
      (str_store_string, s2, "@ Your intelligence has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_trade"),
      (troop_raise_skill, "trp_player", skl_trade, 1),
      (str_store_string, s2, "@ Your trade skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_weapon_mastery"),
      (troop_raise_skill, "trp_player", skl_weapon_master, 1),
      (str_store_string, s2, "@ Your weapon master skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_engineering"),
      (troop_raise_skill, "trp_player", skl_engineer, 1),
      (str_store_string, s2, "@ Your engineer skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_noldor_1"),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 10),
      (str_store_string, s2, "@ Your relation with the Noldor has improved."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_noldor_2"),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 10),
      (str_store_string, s2, "@ Your relation with the Noldor has improved."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_noldor_3"),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 10),
      (str_store_string, s2, "@ Your relation with the Noldor has improved."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_old_diary"),
      (str_store_string, s2, "@The book was very interesting and you have discovered some new facts. It is time share your findings with Vorador."),
      (add_quest_note_from_sreg, "qst_old_tale_part_1", 7, s2, 0),
      (quest_set_slot, "qst_old_tale_part_1", 11, 4),
      (str_clear, s2),
      (str_store_string, s2, "@ Unfortunately the brittle, moldy old pages crumble. Almost as if fate intended it this way ..."),
      (troop_remove_item, "trp_player", "itm_book_old_diary"),
    (try_end),
    (str_store_item_name, s1, "$g_player_reading_book"),
    (372, 37),
    (try_begin),
      (eq, "$g_infinite_camping", 0),
      (dialog_box, "@You have finished reading {s1}.{s2}", "@Book Read"),
    (try_end),
    (assign, "$g_player_reading_book", 0),
  ]),

  (12,
  [
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 17),
      (store_distance_to_party_from_party, ":var1", ":var0", "p_main_party"),
      (try_begin),
        (gt, ":var1", 30),
        (remove_party, ":var0"),
        (try_begin),
          (check_quest_active, "qst_move_cattle_herd"),
          (neg|check_quest_concluded, "qst_move_cattle_herd"),
          (quest_slot_eq, "qst_move_cattle_herd", 8, ":var0"),
          (call_script, "script_fail_quest", "qst_move_cattle_herd"),
        (try_end),
      (else_try),
        (gt, ":var1", 10),
        (party_set_slot, ":var0", 7, 0),
        (party_set_ai_behavior, ":var0", ai_bhvr_hold),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (party_slot_eq, ":var0", 7, "trp_player"),
      (party_slot_eq, ":var0", 254, 1),
      (party_get_slot, ":var1", ":var0", 26),
      (val_add, ":var1", 1),
      (val_min, ":var1", 100),
      (party_set_slot, ":var0", 26, ":var1"),
    (try_end),
  ]),

  (24,
  [
    (try_begin),
      (quest_slot_eq, "qst_order_grandmaster", 11, 6),
      (gt, "$order_stronghold_upgrade_days", 0),
      (val_sub, "$order_stronghold_upgrade_days", 1),
      (eq, "$order_stronghold_upgrade_days", 0),
      (party_set_slot, "p_snake_stronghold", 10, "scn_order_stronghold_exterior"),
      (party_set_slot, "p_snake_stronghold", 11, "scn_castle_6_interior"),
      (display_message, "@Your Order Stronghold has been fully rebuilt!"),
      (play_sound, "snd_bellchant"),
    (try_end),
    (try_begin),
      (gt, "$order_blacksmith_days", 0),
      (val_sub, "$order_blacksmith_days", 1),
      (eq, "$order_blacksmith_days", 0),
      (assign, "$order_blacksmith_days", -1),
      (display_message, "@The Order blacksmith sends a message that your item is ready!"),
      (play_sound, "snd_bellchant"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_old_tale_part_2"),
      (quest_slot_eq, "qst_old_tale_part_2", 11, 6),
      (store_current_day, ":var0"),
      (ge, ":var0", "$old_ruins_var"),
      (assign, "$old_ruins_var", 0),
      (party_set_slot, "p_old_ruins", 10, "scn_abhuva_pendor_castle_2_base"),
      (call_script, "script_finish_quest_simple", "qst_old_tale_part_2", 100),
      (display_log_message, "@Your hidden camp has been fully built!", 0x66CCFF),
      (play_sound, "snd_bellchant"),
    (try_end),
    (try_begin),
      (neg|check_quest_active, "qst_old_tale_part_2"),
      (gt, "$old_ruins_var", 0),
      (try_begin),
        (ge, "$old_ruins_var", 100),
        (val_sub, "$old_ruins_var", 100),
      (try_end),
      (store_mod, ":var1", "$old_ruins_var", 100),
      (try_begin),
        (gt, ":var1", 0),
        (gt, "$old_ruins_var", 0),
        (val_sub, "$old_ruins_var", 1),
      (try_end),
    (try_end),
    (try_for_range, ":var2", 0, "qst_quests_end"),
      (try_begin),
        (check_quest_active, ":var2"),
        (try_begin),
          (neg|check_quest_concluded, ":var2"),
          (quest_slot_ge, ":var2", 23, 1),
          (quest_get_slot, ":var3", ":var2", 23),
          (val_sub, ":var3", 1),
          (try_begin),
            (eq, ":var3", 0),
            (try_begin),
              (eq, ":var2", "qst_order_bounty"),
              (quest_get_slot, ":var4", "qst_order_bounty", 10),
              (try_begin),
                (quest_slot_ge, "qst_order_bounty", 17, ":var4"),
                (call_script, "script_succeed_quest", "qst_order_bounty"),
              (else_try),
                (call_script, "script_fail_quest", "qst_order_bounty"),
              (try_end),
            (else_try),
              (eq, ":var2", "qst_order_tournament"),
              (quest_get_slot, ":var5", "qst_order_tournament", 1),
              (try_begin),
                (party_slot_eq, ":var5", 156, 0),
                (call_script, "script_cancel_quest", "qst_order_tournament"),
                (quest_set_slot, ":var2", 25, 1),
              (else_try),
                (call_script, "script_fail_quest", "qst_order_tournament"),
                (party_set_slot, ":var5", 156, 0),
              (try_end),
            (else_try),
              (eq, ":var2", "qst_order_challenge"),
              (call_script, "script_fail_quest", "qst_order_challenge"),
            (else_try),
              (eq, ":var2", "qst_order_rivalry"),
              (call_script, "script_fail_quest", "qst_order_rivalry"),
            (else_try),
              (call_script, "script_abort_quest", ":var2", 1),
            (try_end),
          (else_try),
            (quest_set_slot, ":var2", 23, ":var3"),
            (assign, reg0, ":var3"),
            (add_quest_note_from_sreg, ":var2", 7, "@You have {reg0} days to finish this quest.", 0),
            (try_begin),
              (eq, ":var2", "qst_order_tournament"),
              (quest_get_slot, ":var5", "qst_order_tournament", 1),
              (party_slot_eq, ":var5", 156, 0),
              (call_script, "script_cancel_quest", "qst_order_tournament"),
              (quest_set_slot, ":var2", 25, 1),
            (try_end),
          (try_end),
        (try_end),
      (else_try),
        (quest_slot_ge, ":var2", 25, 1),
        (quest_get_slot, ":var6", ":var2", 25),
        (val_sub, ":var6", 1),
        (quest_set_slot, ":var2", 25, ":var6"),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (eq, "$g_infinite_camping", 0),
    (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (eq, "$g_player_is_captive", 0),
    (neg|check_quest_active, "qst_wed_betrothed"),
    (try_begin),
      (check_quest_active, "qst_report_to_army"),
      (faction_slot_eq, "$players_kingdom", 8, -1),
      (call_script, "script_abort_quest", "qst_report_to_army", 0),
    (try_end),
    (faction_get_slot, ":var0", "$players_kingdom", 5),
    (neg|faction_slot_eq, "$players_kingdom", 4, 0),
    (neg|faction_slot_eq, "$players_kingdom", 4, 6),
    (assign, ":var1", 1),
    (try_begin),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 5),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 2),
      (faction_slot_eq, "$players_kingdom", 4, 3),
      (neg|is_between, ":var0", "p_town_1", "p_village_1"),
      (assign, ":var1", 0),
    (try_end),
    (eq, ":var1", 1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, ":var3", "$players_kingdom"),
      (store_relation, ":var4", ":var3", "$players_kingdom"),
      (lt, ":var4", 0),
      (assign, ":var2", 1),
    (try_end),
    (eq, ":var2", 1),
    (neg|check_quest_active, "qst_report_to_army"),
    (neg|check_quest_active, "qst_follow_army"),
    (neg|quest_slot_ge, "qst_report_to_army", 25, 1),
    (faction_get_slot, ":var5", "$players_kingdom", 8),
    (gt, ":var5", 0),
    (troop_get_slot, ":var6", ":var5", 10),
    (gt, ":var6", 0),
    (party_is_active, ":var6"),
    (store_distance_to_party_from_party, ":var7", ":var6", "p_main_party"),
    (le, ":var7", 96),
    (assign, ":var8", 1),
    (try_for_range, ":var9", "qst_deliver_message", "qst_follow_army"),
      (check_quest_active, ":var9"),
      (quest_slot_eq, ":var9", 6, ":var5"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (try_for_range, ":var9", "qst_destroy_bandit_lair", "qst_ghost_lady"),
      (check_quest_active, ":var9"),
      (quest_slot_eq, ":var9", 6, ":var5"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (try_for_range, ":var9", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
      (check_quest_active, ":var9"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (store_character_level, ":var10", "trp_player"),
    (ge, ":var10", 8),
    (assign, ":var11", 2),
    (try_for_range, ":var12", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var12", 7, "trp_player"),
      (try_begin),
        (party_slot_eq, ":var12", 0, 3),
        (val_add, ":var11", 3),
      (else_try),
        (party_slot_eq, ":var12", 0, 2),
        (val_add, ":var11", 1),
      (else_try),
        (val_add, ":var11", 1),
      (try_end),
    (try_end),
    (val_mul, ":var11", 4),
    (val_min, ":var11", 60),
    (quest_set_slot, "qst_report_to_army", 6, ":var5"),
    (quest_set_slot, "qst_report_to_army", 2, ":var5"),
    (quest_set_slot, "qst_report_to_army", 10, ":var11"),
    (quest_set_slot, "qst_report_to_army", 23, 4),
    (quest_set_slot, "qst_report_to_army", 24, 22),
    (jump_to_menu, "mnu_kingdom_army_quest_report_to_army"),
  ]),

  (3,
  [
    (assign, "$g_random_army_quest", -1),
    (check_quest_active, "qst_follow_army", 1),
    (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (neg|faction_slot_eq, "$players_kingdom", 4, 0),
    (faction_get_slot, ":var0", "$players_kingdom", 8),
    (neq, ":var0", "trp_player"),
    (gt, ":var0", 0),
    (troop_get_slot, ":var1", ":var0", 10),
    (gt, ":var1", 0),
    (party_is_active, ":var1"),
    (store_distance_to_party_from_party, ":var2", ":var1", "p_main_party"),
    (try_begin),
      (lt, ":var2", 15),
      (assign, "$g_player_follow_army_warnings", 0),
      (store_current_hours, ":var3"),
      (faction_get_slot, ":var4", "$players_kingdom", 95),
      (store_sub, ":var5", ":var3", ":var4"),
      (assign, ":var6", -1),
      (try_begin),
        (store_random_in_range, ":var7", 0, 100),
        (lt, ":var7", 30),
        (troop_slot_eq, ":var0", 20, 0),
        (try_for_range, ":var8", 0, 20),
          (eq, ":var6", -1),
          (store_random_in_range, ":var9", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
          (neg|quest_slot_ge, ":var9", 25, 1),
          (try_begin),
            (eq, ":var9", "qst_deliver_cattle_to_army"),
            (try_begin),
              (faction_slot_eq, "$players_kingdom", 4, 2),
              (gt, ":var5", 120),
              (store_random_in_range, ":var10", 5, 10),
              (assign, ":var6", "qst_deliver_cattle_to_army"),
              (quest_set_slot, ":var6", 10, ":var10"),
              (quest_set_slot, ":var6", 23, 10),
              (quest_set_slot, ":var6", 24, 30),
            (try_end),
          (else_try),
            (eq, ":var9", "qst_join_siege_with_army"),
            (eq, 1, 0),
            (try_begin),
              (faction_slot_eq, "$players_kingdom", 4, 2),
              (faction_get_slot, ":var11", "$players_kingdom", 5),
              (is_between, ":var11", "p_town_1", "p_village_1"),
              (party_get_battle_opponent, ":var12", ":var1"),
              (eq, ":var12", ":var11"),
              (assign, ":var6", ":var9"),
              (quest_set_slot, ":var6", 1, ":var11"),
              (quest_set_slot, ":var6", 23, 2),
              (quest_set_slot, ":var6", 24, 15),
            (try_end),
          (else_try),
            (eq, ":var9", "qst_scout_waypoints"),
            (try_begin),
              (assign, ":var13", 100),
              (assign, "$qst_scout_waypoints_wp_1", -1),
              (assign, "$qst_scout_waypoints_wp_2", -1),
              (assign, "$qst_scout_waypoints_wp_3", -1),
              (assign, ":var14", 0),
              (try_for_range, ":var8", 0, ":var13"),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_1", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (assign, "$qst_scout_waypoints_wp_1", reg0),
                (try_end),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_2", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (neq, "$qst_scout_waypoints_wp_1", reg0),
                  (assign, "$qst_scout_waypoints_wp_2", reg0),
                (try_end),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_3", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (neq, "$qst_scout_waypoints_wp_1", reg0),
                  (neq, "$qst_scout_waypoints_wp_2", reg0),
                  (assign, "$qst_scout_waypoints_wp_3", reg0),
                (try_end),
                (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                (neq, "$qst_scout_waypoints_wp_2", "$qst_scout_waypoints_wp_3"),
                (ge, "$qst_scout_waypoints_wp_1", 0),
                (ge, "$qst_scout_waypoints_wp_2", 0),
                (ge, "$qst_scout_waypoints_wp_3", 0),
                (assign, ":var13", 0),
                (assign, ":var14", 1),
              (try_end),
              (eq, ":var14", 1),
              (assign, "$qst_scout_waypoints_wp_1_visited", 0),
              (assign, "$qst_scout_waypoints_wp_2_visited", 0),
              (assign, "$qst_scout_waypoints_wp_3_visited", 0),
              (assign, ":var6", "qst_scout_waypoints"),
              (quest_set_slot, ":var6", 23, 7),
              (quest_set_slot, ":var6", 24, 25),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (neq, ":var6", -1),
          (quest_set_slot, ":var6", 11, 0),
          (quest_set_slot, ":var6", 6, ":var0"),
          (try_begin),
            (eq, ":var6", "qst_join_siege_with_army"),
            (jump_to_menu, "mnu_kingdom_army_quest_join_siege_order"),
          (else_try),
            (assign, "$g_random_army_quest", ":var6"),
            (quest_set_slot, "$g_random_army_quest", 6, ":var0"),
            (jump_to_menu, "mnu_kingdom_army_quest_messenger"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (val_add, "$g_player_follow_army_warnings", 1),
      (try_begin),
        (lt, "$g_player_follow_army_warnings", 15),
        (try_begin),
          (store_mod, ":var15", "$g_player_follow_army_warnings", 3),
          (eq, ":var15", 0),
          (str_store_troop_name_link, s1, ":var0"),
          (try_begin),
            (lt, "$g_player_follow_army_warnings", 8),
          (else_try),
            (display_message, "str_marshal_warning"),
          (try_end),
        (try_end),
      (else_try),
        (jump_to_menu, "mnu_kingdom_army_follow_failed"),
      (try_end),
    (try_end),
  ]),

  (0.5,
  [
    (check_quest_active, "qst_move_cattle_herd"),
    (neg|check_quest_concluded, "qst_move_cattle_herd"),
    (quest_get_slot, ":var0", "qst_move_cattle_herd", 8),
    (quest_get_slot, ":var1", "qst_move_cattle_herd", 1),
    (store_distance_to_party_from_party, ":var2", ":var0", ":var1"),
    (lt, ":var2", 3),
    (remove_party, ":var0"),
    (call_script, "script_succeed_quest", "qst_move_cattle_herd"),
  ]),

  (2,
  [
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (ge, ":var1", 1),
      (party_is_active, ":var1"),
      (party_slot_eq, ":var1", 31, 1),
      (store_current_hours, ":var2"),
      (neg|party_slot_ge, ":var1", 32, ":var2"),
      (party_set_slot, ":var1", 30, -1),
      (party_set_slot, ":var1", 31, 0),
      (assign, ":var3", 200),
      (store_add, ":var4", ":var2", ":var3"),
      (party_set_slot, ":var1", 33, ":var4"),
    (try_end),
  ]),

  (0.5,
  [
    (try_begin),
      (check_quest_active, "qst_deliver_cattle"),
      (neg|check_quest_succeeded, "qst_deliver_cattle"),
      (quest_get_slot, ":var0", "qst_deliver_cattle", 1),
      (quest_get_slot, ":var1", "qst_deliver_cattle", 10),
      (quest_get_slot, ":var2", "qst_deliver_cattle", 11),
      (store_sub, ":var3", ":var1", ":var2"),
      (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":var0", ":var3"),
      (val_add, ":var2", reg0),
      (quest_set_slot, "qst_deliver_cattle", 11, ":var2"),
      (le, ":var1", ":var2"),
      (call_script, "script_succeed_quest", "qst_deliver_cattle"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_deliver_cattle_to_army"),
      (neg|check_quest_succeeded, "qst_deliver_cattle_to_army"),
      (quest_get_slot, ":var4", "qst_deliver_cattle_to_army", 6),
      (troop_get_slot, ":var5", ":var4", 10),
      (try_begin),
        (gt, ":var5", 0),
        (quest_get_slot, ":var1", "qst_deliver_cattle_to_army", 10),
        (quest_get_slot, ":var2", "qst_deliver_cattle_to_army", 11),
        (store_sub, ":var3", ":var1", ":var2"),
        (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":var5", ":var3"),
        (val_add, ":var2", reg0),
        (quest_set_slot, "qst_deliver_cattle_to_army", 11, ":var2"),
        (try_begin),
          (le, ":var1", ":var2"),
          (call_script, "script_succeed_quest", "qst_deliver_cattle_to_army"),
        (try_end),
      (else_try),
        (call_script, "script_abort_quest", "qst_deliver_cattle_to_army", 0),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (neg|map_free),
    (check_quest_active, "qst_train_peasants_against_bandits"),
    (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
    (eq, "$qst_train_peasants_against_bandits_currently_training", 1),
    (val_add, "$qst_train_peasants_against_bandits_num_hours_trained", 1),
    (call_script, "script_get_max_skill_of_player_party", 17),
    (assign, ":var0", reg0),
    (store_sub, ":var1", 20, ":var0"),
    (val_mul, ":var1", 3),
    (val_div, ":var1", 5),
    (ge, "$qst_train_peasants_against_bandits_num_hours_trained", ":var1"),
    (assign, "$qst_train_peasants_against_bandits_num_hours_trained", 0),
    (rest_for_hours, 0, 0, 0),
    (jump_to_menu, "mnu_train_peasants_against_bandits_ready"),
  ]),

  (1,
  [
    (check_quest_active, "qst_scout_waypoints"),
    (neg|check_quest_succeeded, "qst_scout_waypoints"),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_1_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_1", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_1_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_1"),
      (display_message, "@{s1} is scouted.", 0x66CCFF),
    (try_end),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_2_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_2", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_2_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_2"),
      (display_message, "@{s1} is scouted.", 0x66CCFF),
    (try_end),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_3_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_3", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_3_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_3"),
      (display_message, "@{s1} is scouted.", 0x66CCFF),
    (try_end),
    (eq, "$qst_scout_waypoints_wp_1_visited", 1),
    (eq, "$qst_scout_waypoints_wp_2_visited", 1),
    (eq, "$qst_scout_waypoints_wp_3_visited", 1),
    (call_script, "script_succeed_quest", "qst_scout_waypoints"),
  ]),

  (3,
  [
    (neg|map_free),
    (check_quest_active, "qst_kill_local_merchant"),
    (quest_slot_eq, "qst_kill_local_merchant", 11, 0),
    (quest_set_slot, "qst_kill_local_merchant", 11, 1),
    (rest_for_hours, 0, 0, 0),
    (assign, "$auto_enter_town", "$qst_kill_local_merchant_center"),
    (assign, "$quest_auto_menu", "mnu_kill_local_merchant_begin"),
  ]),

  (1,
  [
    (neg|map_free),
    (check_quest_active, "qst_collect_taxes"),
    (eq, "$g_player_is_captive", 0),
    (eq, "$qst_collect_taxes_currently_collecting", 1),
    (quest_get_slot, ":var0", "qst_collect_taxes", 11),
    (this_or_next|eq, ":var0", 1),
    (this_or_next|eq, ":var0", 2),
    (eq, ":var0", 3),
    (quest_get_slot, ":var1", "qst_collect_taxes", 10),
    (val_sub, ":var1", 1),
    (quest_set_slot, "qst_collect_taxes", 10, ":var1"),
    (call_script, "script_get_max_skill_of_player_party", 0),
    (try_begin),
      (lt, ":var1", 0),
      (assign, ":var0", 4),
      (quest_set_slot, "qst_collect_taxes", 11, 4),
      (rest_for_hours, 0, 0, 0),
      (jump_to_menu, "mnu_collect_taxes_complete"),
    (else_try),
      (assign, ":var2", "$qst_collect_taxes_hourly_income"),
      (party_get_slot, ":var3", "$g_encountered_party", 50),
      (store_add, ":var4", 120, ":var3"),
      (val_mul, ":var2", ":var4"),
      (val_div, ":var2", 270),
      (try_begin),
        (eq, "$qst_collect_taxes_halve_taxes", 1),
        (val_div, ":var2", 2),
      (try_end),
      (val_max, ":var2", 2),
      (store_random_in_range, ":var5", 1, ":var2"),
      (quest_get_slot, ":var6", "qst_collect_taxes", 22),
      (val_add, ":var6", ":var5"),
      (quest_set_slot, "qst_collect_taxes", 22, ":var6"),
      (call_script, "script_troop_add_gold", "trp_player", ":var5"),
    (try_end),
    (try_begin),
      (eq, ":var0", 1),
      (val_sub, "$qst_collect_taxes_menu_counter", 1),
      (le, "$qst_collect_taxes_menu_counter", 0),
      (quest_set_slot, "qst_collect_taxes", 11, 2),
      (jump_to_menu, "mnu_collect_taxes_revolt_warning"),
    (else_try),
      (eq, ":var0", 2),
      (val_sub, "$qst_collect_taxes_unrest_counter", 1),
      (le, "$qst_collect_taxes_unrest_counter", 0),
      (eq, "$qst_collect_taxes_halve_taxes", 0),
      (quest_set_slot, "qst_collect_taxes", 11, 3),
      (store_div, ":var7", 10000, "$qst_collect_taxes_total_hours"),
      (val_add, ":var7", 30),
      (store_random_in_range, ":var8", 0, 1000),
      (try_begin),
        (lt, ":var8", ":var7"),
        (jump_to_menu, "mnu_collect_taxes_revolt"),
      (try_end),
    (try_end),
  ]),

  (72,
  [
    (gt, "$g_force_peace_faction_1", 0),
    (gt, "$g_force_peace_faction_2", 0),
    (try_begin),
      (store_relation, ":var0", "$g_force_peace_faction_1", "$g_force_peace_faction_2"),
      (lt, ":var0", 0),
      (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_force_peace_faction_1", "$g_force_peace_faction_2", 1),
    (try_end),
    (assign, "$g_force_peace_faction_1", 0),
    (assign, "$g_force_peace_faction_2", 0),
  ]),

  (1,
  [
    (eq, "$snouz_test_war", 0),
    (str_store_string, s51, "str_no_trigger_noted"),
    (try_begin),
      (gt, "$npc_to_rejoin_party", 0),
      (eq, "$g_infinite_camping", 0),
      (try_begin),
        (neg|main_party_has_troop, "$npc_to_rejoin_party"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_to_rejoin_party"),
        (assign, "$npc_map_talk_context", 151),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, "$npc_to_rejoin_party", -1),
      (else_try),
        (troop_set_slot, "$npc_to_rejoin_party", 152, 8),
        (assign, "$npc_to_rejoin_party", 0),
      (try_end),
    (else_try),
      (gt, "$npc_is_quitting", 0),
      (eq, "$g_infinite_camping", 0),
      (try_begin),
        (main_party_has_troop, "$npc_is_quitting"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_is_quitting"),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, "$npc_is_quitting", -1),
      (else_try),
        (assign, "$npc_is_quitting", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_grievance", 0),
      (eq, "$g_infinite_camping", 0),
      (try_begin),
        (main_party_has_troop, "$npc_with_grievance"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_has_grievance"),
        (assign, "$npc_map_talk_context", 61),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, "$npc_with_grievance", -1),
      (else_try),
        (assign, "$npc_with_grievance", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_personality_clash", 0),
      (eq, "$g_infinite_camping", 0),
      (troop_get_slot, ":var0", "$npc_with_personality_clash", 71),
      (try_begin),
        (main_party_has_troop, "$npc_with_personality_clash"),
        (main_party_has_troop, ":var0"),
        (neq, "$g_player_is_captive", 1),
        (assign, "$npc_map_talk_context", 72),
        (str_store_string, s51, "str_triggered_by_npc_has_personality_clash"),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, "$npc_with_personality_clash", -1),
      (else_try),
        (assign, "$npc_with_personality_clash", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_political_grievance", 0),
      (eq, "$g_infinite_camping", 0),
      (eq, "$disable_npc_complaints", 0),
      (try_begin),
        (main_party_has_troop, "$npc_with_political_grievance"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_has_political_grievance"),
        (assign, "$npc_map_talk_context", 145),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, "$npc_with_political_grievance", -1),
      (else_try),
        (assign, "$npc_with_political_grievance", 0),
      (try_end),
    (else_try),
      (eq, "$disable_local_histories", 0),
      (neq, "$g_option_companion_dialogs", 0),
      (eq, "$g_infinite_camping", 0),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (main_party_has_troop, ":var1"),
        (troop_slot_eq, ":var1", 78, 0),
        (troop_get_slot, ":var2", ":var1", 60),
        (gt, ":var2", 0),
        (store_distance_to_party_from_party, ":var3", ":var2", "p_main_party"),
        (lt, ":var3", 7),
        (assign, "$npc_map_talk_context", 60),
        (str_store_string, s51, "str_triggered_by_local_histories"),
        (assign, "$npc_dialog_partner", 0),
        (start_map_conversation, ":var1", -1),
      (try_end),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_rebel_against_kingdom"),
      (is_between, "$supported_pretender", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|main_party_has_troop, "$supported_pretender"),
      (neg|troop_slot_eq, "$supported_pretender", 2, 2),
      (party_add_members, "p_main_party", "$supported_pretender", 1),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_rebel_against_kingdom"),
      (is_between, "$supported_pretender", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (main_party_has_troop, "$supported_pretender"),
      (neg|faction_slot_eq, "fac_player_supporters_faction", 8, "trp_player"),
      (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", "trp_player"),
    (try_end),
  ]),

  (4,
  [
    (eq, "$snouz_test_war", 0),
    (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_ge, ":var0", 55, 1),
      (store_troop_faction, ":var1", ":var0"),
      (troop_get_slot, ":var2", ":var0", 55),
      (troop_get_slot, ":var3", ":var0", 10),
      (assign, ":var4", 0),
      (try_begin),
        (le, ":var3", 0),
        (neg|troop_slot_ge, ":var0", 8, 0),
        (assign, ":var4", 1),
      (else_try),
        (gt, ":var3", 0),
        (party_get_attached_to, ":var5", ":var3"),
        (try_begin),
          (lt, ":var5", 0),
          (party_get_cur_town, ":var5", ":var3"),
        (try_end),
        (neg|this_or_next|is_between, ":var5", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 7, ":var0"),
        (assign, ":var6", "trp_knight_1_1_wife"),
        (try_for_range, ":var7", "trp_npc_adonja", ":var6"),
          (troop_slot_eq, ":var7", 2, 2),
          (troop_get_slot, ":var8", ":var7", 10),
          (party_is_active, ":var8"),
          (store_faction_of_party, ":var9", ":var8"),
          (eq, ":var9", ":var1"),
          (store_distance_to_party_from_party, ":var10", ":var3", ":var8"),
          (lt, ":var10", 4),
          (assign, ":var6", 0),
        (try_end),
        (neq, ":var6", 0),
        (assign, ":var4", 1),
      (try_end),
      (eq, ":var4", 1),
      (str_store_troop_name, s36, ":var0"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (str_store_troop_name, s4, ":var0"),
        (display_message, "@{!}DEBUG - {s4} faction changed from slot troop change to faction"),
      (try_end),
      (call_script, "script_change_troop_faction", ":var0", ":var2"),
      (troop_set_slot, ":var0", 55, 0),
      (try_begin),
        (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_troop_name_link, s1, ":var0"),
        (str_store_faction_name_link, s2, ":var1"),
        (str_store_faction_name_link, s3, ":var2"),
        (display_message, "@{s36} has switched from the {s2} to the {s3} and is now known as {s1}.", 0x66CCFF),
        (try_begin),
          (eq, ":var1", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_left_players_faction", ":var0", ":var2"),
        (else_try),
          (eq, ":var2", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_joined_players_faction", ":var0", ":var1"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (eq, "$cheat_mode", 1),
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_battle_opponent, ":var1", ":var0"),
      (try_begin),
        (gt, ":var1", 0),
        (str_store_party_name, s2, ":var0"),
        (str_store_party_name, s3, ":var1"),
        (display_message, "@{!}DEBUG : {s2} is besieged by {s3}"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (store_current_day, ":var0"),
    (gt, ":var0", "$g_last_report_control_day"),
    (store_time_of_day, ":var1"),
    (ge, ":var1", 18),
    (store_random_in_range, ":var2", 0, 4),
    (this_or_next|ge, ":var1", 22),
    (eq, ":var2", 0),
    (assign, "$g_last_report_control_day", ":var0"),
    (store_troop_gold, ":var3", "trp_player"),
    (try_begin),
      (lt, ":var3", 0),
      (store_sub, ":var4", 0, ":var3"),
      (troop_add_gold, "trp_player", ":var4"),
    (try_end),
    (party_get_morale, ":var5", "p_main_party"),
    (try_begin),
      (str_store_string, s1, "str_party_morale_is_low"),
      (str_clear, s2),
      (party_get_num_companion_stacks, ":var6", "p_main_party"),
      (assign, ":var7", 0),
      (try_for_range_backwards, ":var8", 0, ":var6"),
        (party_stack_get_troop_id, ":var9", "p_main_party", ":var8"),
        (neg|troop_is_hero, ":var9"),
        (party_stack_get_size, ":var10", "p_main_party", ":var8"),
        (store_troop_faction, ":var11", ":var9"),
        (assign, ":var12", ":var5"),
        (try_begin),
          (ge, ":var11", "fac_kingdom_1"),
          (lt, ":var11", "fac_kingdoms_end"),
          (faction_get_slot, ":var13", ":var11", 99),
          (val_div, ":var13", 100),
          (val_add, ":var12", ":var13"),
        (try_end),
        (lt, ":var12", 32),
        (store_sub, ":var14", 36, ":var12"),
        (val_div, ":var14", 4),
        (assign, ":var15", 0),
        (try_for_range, ":var16", 0, ":var10"),
          (store_random_in_range, ":var2", 0, 100),
          (lt, ":var2", ":var14"),
          (val_add, ":var15", 1),
          (remove_member_from_party, ":var9", "p_main_party"),
        (try_end),
        (try_begin),
          (ge, ":var15", 1),
          (str_store_troop_name, s2, ":var9"),
          (assign, reg0, ":var15"),
          (try_begin),
            (ge, ":var7", 1),
            (str_store_string, s1, "str_s1_reg0_s2"),
          (else_try),
            (str_store_string, s3, s1),
            (str_store_string, s1, "str_s3_reg0_s2"),
          (try_end),
          (val_add, ":var7", ":var15"),
        (try_end),
      (try_end),
      (try_begin),
        (ge, ":var7", 1),
        (try_begin),
          (ge, ":var7", 2),
          (str_store_string, s2, "str_have_deserted_the_party"),
        (else_try),
          (str_store_string, s2, "str_has_deserted_the_party"),
        (try_end),
        (str_store_string, s1, "str_s1_s2"),
        (eq, "$g_infinite_camping", 0),
        (dialog_box, s1, "str_weekly_report"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (call_script, "script_calculate_castle_prosperities_by_using_its_villages"),
    (store_add, ":var0", "fac_kingdom_5", 1),
    (try_for_range, ":var1", "fac_kingdom_1", ":var0"),
      (try_for_range, ":var2", "fac_kingdom_1", ":var0"),
        (store_relation, ":var3", ":var1", ":var2"),
        (str_store_faction_name, s7, ":var1"),
        (str_store_faction_name, s8, ":var2"),
        (neq, ":var1", ":var2"),
        (assign, reg1, ":var3"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (try_begin),
      (eq, "$g_player_is_captive", 1),
      (neg|party_is_active, "$capturer_party"),
      (rest_for_hours, 0, 0, 0),
    (try_end),
    (assign, ":var0", "$next_center_will_be_fired"),
    (party_get_slot, ":var1", ":var0", 38),
    (eq, ":var1", 0),
    (try_begin),
      (party_get_slot, ":var2", ":var0", 120),
      (party_get_slot, ":var3", ":var2", 240),
      (store_current_hours, ":var4"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (is_between, ":var0", "p_town_1", "p_salt_mine"),
        (is_between, ":var2", "p_town_1", "p_salt_mine"),
        (str_store_party_name, s4, ":var0"),
        (str_store_party_name, s5, ":var2"),
        (store_current_hours, reg3),
        (party_get_slot, reg4, ":var2", 240),
        (display_message, "@{!}DEBUG - Checking fire at {s4} for {s5} - current time {reg3}, last nearby fire {reg4}"),
      (try_end),
      (eq, ":var4", ":var3"),
      (party_add_particle_system, ":var0", "psys_map_village_fire"),
      (party_add_particle_system, ":var0", "psys_map_village_fire_smoke"),
    (else_try),
      (store_add, ":var5", ":var3", 4),
      (eq, ":var5", ":var4"),
      (party_clear_particle_systems, ":var0"),
    (try_end),
  ]),

  (24,
  [
    (val_sub, "$g_dont_give_fief_to_player_days", 1),
    (val_max, "$g_dont_give_fief_to_player_days", -1),
    (val_sub, "$g_dont_give_marshalship_to_player_days", 1),
    (val_max, "$g_dont_give_marshalship_to_player_days", -1),
    (try_begin),
      (check_quest_active, "qst_formal_marriage_proposal"),
      (check_quest_failed, "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_lend_companion"),
      (quest_get_slot, ":var0", "qst_lend_companion", 6),
      (store_troop_faction, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$players_kingdom"),
      (this_or_next|lt, ":var2", 0),
      (neg|is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_abort_quest", "qst_lend_companion", 0),
    (try_end),
    (try_begin),
      (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (val_add, "$g_player_days_as_marshal", 1),
    (else_try),
      (assign, "$g_player_days_as_marshal", 0),
    (try_end),
    (try_for_range, ":var3", "p_town_1", "p_castle_1"),
      (party_get_slot, ":var4", ":var3", 139),
      (ge, ":var4", 1),
      (val_sub, ":var4", 1),
      (party_set_slot, ":var3", 139, ":var4"),
    (try_end),
  ]),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (24,
  []),

  (1,
  [
    (neg|map_free),
    (eq, "$g_player_is_captive", 0),
    (gt, "$pop_train_steward_hours", 0),
    (val_sub, "$pop_train_steward_hours", 1),
    (try_begin),
      (eq, "$pop_train_steward_hours", 0),
      (rest_for_hours, 0, 0, 0),
      (jump_to_menu, "mnu_steward_training_complete"),
    (try_end),
  ]),

  (36,
  [
    (try_begin),
      (eq, "$astraea_aid_snd", 0),
      (store_random_in_range, ":var0", 0, 50),
      (try_begin),
        (lt, ":var0", 2),
        (call_script, "script_get_closest_center", "p_main_party"),
        (call_script, "script_get_culture_with_party_faction_for_music", reg0),
        (eq, reg0, 8),
        (assign, "$astraea_aid_snd", 1),
        (play_sound, "snd_astraea_aid_when_can"),
        (display_message, "@A god's voice booms across the sky:  I am Astraea, Goddess of Justice.  Fight to defend it and I will aid you when and where I can.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$wrath_of_indar", 0),
      (store_random_in_range, ":var0", 0, 10),
      (try_begin),
        (eq, ":var0", 1),
        (store_num_parties_destroyed_by_player, ":var1", "pt_jatu_k_juda"),
        (store_num_parties_destroyed_by_player, ":var2", "pt_jatu_zulkar"),
        (this_or_next|gt, ":var1", 0),
        (gt, ":var2", 0),
        (assign, "$wrath_of_indar", 1),
        (play_sound, "snd_beware_wrath_of_indar"),
        (display_message, "@A god's voice booms across the sky:  You battle and defeat my Jatu.  Beware the wrath of Indar.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (neg|faction_slot_eq, "fac_kingdom_5", 21, 0),
      (eq, "$damia_command", 0),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 1),
        (assign, "$damia_command", 1),
        (play_sound, "snd_damia_provideo_drive_out_snakes"),
        (display_message, "@A god's voice booms across the sky:  I command you to drive from my lands these foul Serpent Cultists who defile it, in the Name of Damia Provideo.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$claws_of_vejovis", 0),
      (try_begin),
        (store_num_parties_destroyed_by_player, ":var1", "pt_mystmountain_army"),
        (gt, ":var1", 0),
        (assign, "$claws_of_vejovis", 1),
        (play_sound, "snd_die_vejovis"),
        (display_message, "@A god's voice booms across the sky:  You will cease fighting my children of the Mystmountains or die in the claws of Vejovis.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$eunomia_warning", 0),
      (neg|faction_slot_eq, "fac_kingdom_1", 21, 0),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 1),
        (assign, "$eunomia_warning", 1),
        (play_sound, "snd_eunomia_stabilitis_warn_of_danger"),
        (display_message, "@A god's voice booms across the sky:  I Eunomia Stabilitis, first in rank amongst the hierarchy of the Pendor Gods, warn you, Chosen One.  You face many dangers ahead.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$hafsigla_wrath", 0),
      (try_begin),
        (store_num_parties_destroyed_by_player, ":var1", "pt_sea_raider_army"),
        (gt, ":var1", 0),
        (assign, "$hafsigla_wrath", 1),
        (play_sound, "snd_incur_wrath_of_hafsigla"),
        (display_message, "@A god's voice booms across the sky:  End your persecution of my raiding Vanskerries or incur the wrath of HafSigla.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$thallo_defend", 0),
      (assign, ":var3", 0),
      (try_for_range, ":var4", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":var5", ":var4"),
        (eq, ":var5", "fac_kingdom_4"),
        (val_add, ":var3", 1),
      (try_end),
      (lt, ":var3", 3),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 1),
        (assign, "$thallo_defend", 1),
        (play_sound, "snd_thallo_defend_fierdsvain"),
        (display_message, "@A god's voice booms across the sky:  Defend my children of the Fierdsvain that they may farm in peace, in the name of Thallo Ver Shures.", 0x30FFC8),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$vata_command", 0),
      (assign, ":var3", 0),
      (try_for_range, ":var4", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":var5", ":var4"),
        (eq, ":var5", "fac_kingdom_3"),
        (val_add, ":var3", 1),
      (try_end),
      (lt, ":var3", 3),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 1),
        (assign, "$vata_command", 1),
        (play_sound, "snd_vata_commands"),
        (display_message, "@A god's voice booms across the sky:  I, Vata, command you in my name to destroy those who threaten my D'Shar.", 0x30FFC8),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (try_begin),
      (eq, "$ullbow", 0),
      (try_begin),
        (store_num_parties_of_template, ":var0", "pt_wolfbode"),
        (ge, ":var0", 1),
        (party_template_get_slot, ":var1", "pt_wolfbode", 7),
        (store_distance_to_party_from_party, ":var2", ":var1", "p_main_party"),
        (lt, ":var2", 30),
        (store_free_inventory_capacity, ":var3", "trp_player"),
        (try_begin),
          (lt, ":var3", 1),
          (display_message, "@The God UllrVetr is about to give you a gift, but you must have space for it in your inventory.", 0x30FFC8),
        (else_try),
          (ge, ":var3", 1),
          (assign, "$ullbow", 1),
          (play_sound, "snd_ullrvetr_manifests_as_bow"),
          (display_message, "@A god's voice booms across the sky: I, UllrVetr, God of Bowmen, manifest myself to you as this bow. Use it well in the battle to come.", 0x30FFC8),
          (troop_add_item, "trp_player", "itm_ullrvetr_manifest"),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$ullbow", 1),
      (store_num_parties_of_template, ":var0", "pt_wolfbode"),
      (eq, ":var0", 0),
      (assign, "$ullbow", 2),
      (try_begin),
        (this_or_next|player_has_item, "itm_ullrvetr_manifest"),
        (troop_has_item_equipped, "trp_player", "itm_ullrvetr_manifest"),
        (troop_remove_item, "trp_player", "itm_ullrvetr_manifest"),
        (display_message, "@UllrVetr has seen the threat vanquished; and in that instance the powerful manifestation that was the bow has disappeared."),
      (else_try),
        (assign, ":var4", 0),
        (try_for_range, ":var5", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (eq, ":var4", 0),
          (troop_has_item_equipped, ":var5", "itm_ullrvetr_manifest"),
          (troop_remove_item, ":var5", "itm_ullrvetr_manifest"),
          (str_store_troop_name, s2, ":var5"),
          (str_store_item_name, s10, "itm_ullrvetr_manifest"),
          (display_message, "@UllrVetr has seen the threat vanquished; and in that instance the powerful manifestation that was the bow has disappeared."),
          (display_message, "@{s2} loses {s10}."),
          (assign, ":var4", 1),
        (try_end),
        (eq, ":var4", 0),
        (try_for_range, ":var6", "trp_town_1_seneschal_chest", "trp_town_1_arena_master"),
          (eq, ":var4", 0),
          (troop_get_inventory_capacity, ":var7", ":var6"),
          (try_for_range, ":var8", 0, ":var7"),
            (troop_get_inventory_slot, ":var9", ":var6", ":var8"),
            (eq, ":var9", "itm_ullrvetr_manifest"),
            (troop_remove_item, ":var6", "itm_ullrvetr_manifest"),
            (str_store_troop_name, s2, ":var6"),
            (str_store_item_name, s10, "itm_ullrvetr_manifest"),
            (display_message, "@UllrVetr has seen the threat vanquished; and in that instance the powerful manifestation that was the bow has disappeared."),
            (display_message, "@{s2} reports the {s10} is gone missing from the chest."),
            (assign, ":var4", 1),
            (assign, ":var7", 0),
          (try_end),
        (try_end),
        (eq, ":var4", 0),
        (try_for_range, ":var10", "trp_town_1_armorer", 1060),
          (eq, ":var4", 0),
          (troop_get_inventory_capacity, ":var7", ":var10"),
          (try_for_range, ":var11", 0, ":var7"),
            (troop_get_inventory_slot, ":var12", ":var10", ":var11"),
            (eq, ":var12", "itm_ullrvetr_manifest"),
            (troop_remove_item, ":var10", "itm_ullrvetr_manifest"),
            (assign, ":var4", 1),
            (assign, ":var7", 0),
          (try_end),
        (try_end),
        (eq, ":var4", 0),
        (troop_get_inventory_capacity, ":var7", "trp_quigfen"),
        (try_for_range, ":var11", 0, ":var7"),
          (troop_get_inventory_slot, ":var12", "trp_quigfen", ":var11"),
          (eq, ":var12", "itm_ullrvetr_manifest"),
          (troop_remove_item, "trp_quigfen", "itm_ullrvetr_manifest"),
          (assign, ":var4", 1),
          (assign, ":var7", 0),
        (try_end),
        (eq, ":var4", 0),
        (troop_get_inventory_capacity, ":var7", "trp_noldor_merchant"),
        (try_for_range, ":var11", 0, ":var7"),
          (troop_get_inventory_slot, ":var12", "trp_noldor_merchant", ":var11"),
          (eq, ":var12", "itm_ullrvetr_manifest"),
          (troop_remove_item, "trp_noldor_merchant", "itm_ullrvetr_manifest"),
          (assign, ":var4", 1),
          (assign, ":var7", 0),
        (try_end),
        (eq, ":var4", 0),
        (try_for_range, ":var10", "trp_order_constable", "trp_find_item_cheat"),
          (eq, ":var4", 0),
          (troop_get_inventory_capacity, ":var7", ":var10"),
          (try_for_range, ":var11", 0, ":var7"),
            (troop_get_inventory_slot, ":var12", ":var10", ":var11"),
            (eq, ":var12", "itm_ullrvetr_manifest"),
            (troop_remove_item, ":var10", "itm_ullrvetr_manifest"),
            (assign, ":var4", 1),
            (assign, ":var7", 0),
          (try_end),
        (try_end),
        (eq, ":var4", 0),
        (try_for_range, ":var10", "trp_tavern_bookseller_1", "trp_tavern_minstrel_1"),
          (eq, ":var4", 0),
          (troop_get_inventory_capacity, ":var7", ":var10"),
          (try_for_range, ":var11", 0, ":var7"),
            (troop_get_inventory_slot, ":var12", ":var10", ":var11"),
            (eq, ":var12", "itm_ullrvetr_manifest"),
            (troop_remove_item, ":var10", "itm_ullrvetr_manifest"),
            (assign, ":var4", 1),
            (assign, ":var7", 0),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (assign, ":var0", 0),
    (troop_get_slot, ":var1", "trp_player", 7),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 16384),
      (eq, ":var0", 0),
      (ge, ":var1", 7500),
      (val_or, "$g_achieve_bitfield", 16384),
      (val_or, "$g_achieve_bitfield", 8192),
      (val_sub, "$g_achieve_bitfield", 8192),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_rnwn_2", 14),
    (else_try),
      (store_and, ":var0", "$g_achieve_bitfield", 16384),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 8192),
      (eq, ":var0", 0),
      (ge, ":var1", 5000),
      (val_or, "$g_achieve_bitfield", 8192),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_rnwn_1", 13),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 16),
      (eq, ":var0", 0),
      (ge, "$g_total_victories", 500),
      (val_or, "$g_achieve_bitfield", 16),
      (val_or, "$g_achieve_bitfield", 8),
      (val_sub, "$g_achieve_bitfield", 8),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_vic_2", 4),
    (else_try),
      (store_and, ":var0", "$g_achieve_bitfield", 16),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 8),
      (eq, ":var0", 0),
      (ge, "$g_total_victories", 250),
      (val_or, "$g_achieve_bitfield", 8),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_vic_1", 3),
    (try_end),
    (get_player_agent_kill_count, ":var2"),
    (get_player_agent_kill_count, ":var3", 1),
    (val_add, ":var2", ":var3"),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 4),
      (eq, ":var0", 0),
      (ge, ":var2", 10000),
      (val_or, "$g_achieve_bitfield", 4),
      (val_or, "$g_achieve_bitfield", 2),
      (val_sub, "$g_achieve_bitfield", 2),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kills_2", 2),
    (else_try),
      (store_and, ":var0", "$g_achieve_bitfield", 4),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 2),
      (eq, ":var0", 0),
      (ge, ":var2", 5000),
      (val_or, "$g_achieve_bitfield", 2),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kills_1", 1),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 32768),
      (eq, ":var0", 0),
      (ge, "$player_honor", 500),
      (val_or, "$g_achieve_bitfield", 32768),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_honor", 15),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 4096),
      (eq, ":var0", 0),
      (ge, "$g_tournaments_won", 50),
      (val_or, "$g_achieve_bitfield", 4096),
      (val_or, "$g_achieve_bitfield", 2048),
      (val_sub, "$g_achieve_bitfield", 2048),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_tour_2", 12),
    (else_try),
      (store_and, ":var0", "$g_achieve_bitfield", 4096),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 2048),
      (eq, ":var0", 0),
      (ge, "$g_tournaments_won", 25),
      (val_or, "$g_achieve_bitfield", 2048),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_tour_1", 11),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 128),
      (eq, ":var0", 0),
      (assign, ":var4", 0),
      (store_num_parties_destroyed_by_player, ":var5", "pt_mystmountain_army"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_wolfbode"),
      (val_add, ":var4", ":var5"),
      (ge, ":var4", 1),
      (val_or, "$g_achieve_bitfield", 128),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_mysts", 7),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 256),
      (eq, ":var0", 0),
      (assign, ":var4", 0),
      (store_num_parties_destroyed_by_player, ":var5", "pt_snake_cult_army"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_dread_legion"),
      (val_add, ":var4", ":var5"),
      (ge, ":var4", 1),
      (val_or, "$g_achieve_bitfield", 256),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_snakes", 8),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 512),
      (eq, ":var0", 0),
      (assign, ":var4", 0),
      (store_num_parties_destroyed_by_player, ":var5", "pt_jatu_army"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_jatu_zulkar"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_jatu_k_juda"),
      (val_add, ":var4", ":var5"),
      (ge, ":var4", 1),
      (val_or, "$g_achieve_bitfield", 512),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_jatu", 9),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 1024),
      (eq, ":var0", 0),
      (assign, ":var4", 0),
      (store_num_parties_destroyed_by_player, ":var5", "pt_heretics_army"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_eyegrim"),
      (val_add, ":var4", ":var5"),
      (store_num_parties_destroyed_by_player, ":var5", "pt_three_seers"),
      (val_add, ":var4", ":var5"),
      (ge, ":var4", 1),
      (val_or, "$g_achieve_bitfield", 1024),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heretics", 10),
    (try_end),
    (assign, ":var6", 0),
    (try_for_range, ":var7", "pt_wolfbode", "pt_refugees"),
      (store_num_parties_destroyed_by_player, ":var5", ":var7"),
      (val_add, ":var6", ":var5"),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 64),
      (eq, ":var0", 0),
      (ge, ":var6", 15),
      (val_or, "$g_achieve_bitfield", 64),
      (val_or, "$g_achieve_bitfield", 32),
      (val_sub, "$g_achieve_bitfield", 32),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heroes_2", 6),
    (else_try),
      (store_and, ":var0", "$g_achieve_bitfield", 64),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 32),
      (eq, ":var0", 0),
      (ge, ":var6", 7),
      (val_or, "$g_achieve_bitfield", 32),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heroes_1", 5),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 262144),
      (eq, ":var0", 0),
      (ge, "$g_improvements_built", 30),
      (val_or, "$g_achieve_bitfield", 262144),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_builder", 18),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 131072),
      (eq, ":var0", 0),
      (ge, "$g_lords_persuaded", 30),
      (val_or, "$g_achieve_bitfield", 131072),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_persuader", 17),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 524288),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 1048576),
      (eq, ":var0", 0),
      (ge, "$g_total_quests_completed", 30),
      (val_or, "$g_achieve_bitfield", 524288),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_quests", 19),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 1048576),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bitfield", 524288),
      (eq, ":var0", 0),
      (ge, "$g_quests_failed", 10),
      (val_or, "$g_achieve_bitfield", 1048576),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_fquests", 20),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 2097152),
      (eq, ":var0", 0),
      (ge, "$g_total_defeats", 10),
      (troop_get_type, ":var8", "trp_player"),
      (eq, ":var8", 0),
      (val_or, "$g_achieve_bitfield", 2097152),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_captured", 21),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 4194304),
      (eq, ":var0", 0),
      (ge, "$g_caravans_raided", 30),
      (val_or, "$g_achieve_bitfield", 4194304),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_caravan", 22),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 8388608),
      (eq, ":var0", 0),
      (ge, "$g_villages_raided", 20),
      (val_or, "$g_achieve_bitfield", 8388608),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_village", 23),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 65536),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bits_delay_popup", 65536),
      (neq, ":var0", 0),
      (val_or, "$g_achieve_bitfield", 65536),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_king", 16),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 1),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bits_delay_popup", 1),
      (neq, ":var0", 0),
      (val_or, "$g_achieve_bitfield", 1),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kill_battle", 0),
    (try_end),
    (try_begin),
      (eq, 0, 0),
      (store_and, ":var0", "$g_achieve_bitfield", 67108864),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bits_delay_popup", 16777216),
      (neq, ":var0", 0),
      (val_sub, "$g_achieve_bits_delay_popup", 16777216),
      (try_begin),
        (store_and, ":var0", "$g_achieve_bitfield", 16777216),
        (eq, ":var0", 0),
        (val_or, "$g_achieve_bitfield", 16777216),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_cheater_warn_1", -1),
      (else_try),
        (store_and, ":var0", "$g_achieve_bitfield", 33554432),
        (eq, ":var0", 0),
        (val_or, "$g_achieve_bitfield", 33554432),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_cheater_warn_2", -1),
      (else_try),
        (store_and, ":var0", "$g_achieve_bitfield", 67108864),
        (eq, ":var0", 0),
        (val_or, "$g_achieve_bitfield", 67108864),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_cheater", 24),
      (try_end),
    (try_end),
    (try_begin),
      (store_and, ":var0", "$g_achieve_bitfield", 134217728),
      (eq, ":var0", 0),
      (store_and, ":var0", "$g_achieve_bits_delay_popup", 134217728),
      (neq, ":var0", 0),
      (val_or, "$g_achieve_bitfield", 134217728),
      (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_gm", 25),
    (try_end),
  ]),

  (24,
  [
    (neg|check_quest_active, "qst_ghost_lady"),
    (neg|quest_slot_eq, "qst_ghost_lady", 11, 8),
    (assign, ":var0", 0),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (assign, ":var5", 0),
    (try_begin),
      (gt, "$players_kingdom", 0),
      (assign, ":var0", "$players_kingdom"),
    (try_end),
    (gt, ":var0", 0),
    (assign, ":var6", 0),
    (try_for_range, ":var7", "p_town_1", "p_castle_1"),
      (store_faction_of_party, ":var8", ":var7"),
      (eq, ":var8", ":var0"),
      (val_add, ":var6", 1),
    (try_end),
    (ge, ":var6", 9),
    (assign, ":var9", 0),
    (assign, ":var10", 0),
    (assign, ":var11", 0),
    (try_for_range, ":var12", 0, 2),
      (eq, ":var11", 0),
      (try_begin),
        (eq, ":var12", 1),
        (store_random_in_range, ":var13", 0, ":var9"),
        (val_add, ":var13", 1),
      (try_end),
      (try_for_range, ":var14", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (eq, ":var11", 0),
        (troop_slot_eq, ":var14", 2, 2),
        (neg|is_between, ":var14", "trp_kingdom_1_lord", "trp_knight_1_1"),
        (neg|is_between, ":var14", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (troop_get_type, ":var15", ":var14"),
        (eq, ":var15", 0),
        (eq, ":var1", 0),
        (store_troop_faction, ":var16", ":var14"),
        (eq, ":var0", ":var16"),
        (troop_get_slot, ":var17", ":var14", 30),
        (eq, ":var17", -1),
        (neg|troop_slot_eq, "trp_player", 30, ":var14"),
        (neg|troop_slot_ge, ":var14", 8, 0),
        (troop_get_slot, ":var18", ":var14", 10),
        (gt, ":var18", 0),
        (party_is_active, ":var18"),
        (call_script, "script_troop_get_player_relation", ":var14"),
        (assign, ":var19", reg0),
        (try_begin),
          (ge, ":var19", 50),
          (call_script, "script_get_number_of_hero_centers", ":var14"),
          (assign, ":var20", reg0),
          (gt, ":var20", 0),
          (assign, ":var21", 0),
          (try_for_range, ":var22", 0, ":var20"),
            (eq, ":var21", 0),
            (call_script, "script_troop_get_leaded_center_with_index", ":var14", ":var22"),
            (assign, ":var23", reg0),
            (is_between, ":var23", "p_castle_1", "p_village_1"),
            (try_begin),
              (eq, ":var12", 0),
              (val_add, ":var9", 1),
            (else_try),
              (val_add, ":var10", 1),
              (eq, ":var13", ":var10"),
              (assign, ":var1", ":var14"),
              (assign, ":var2", ":var23"),
              (assign, ":var11", 1),
            (try_end),
            (assign, ":var21", 1),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var12", 0),
        (eq, ":var9", 0),
        (assign, ":var11", 1),
      (try_end),
    (try_end),
    (gt, ":var1", 0),
    (assign, ":var3", "trp_ghost_quest_friendly_lord_mistress"),
    (call_script, "script_cf_faction_get_random_enemy_faction", ":var0"),
    (assign, ":var5", reg0),
    (gt, ":var5", 0),
    (call_script, "script_cf_get_random_lord_except_king_with_faction", ":var5"),
    (assign, ":var4", reg0),
    (gt, ":var4", 0),
    (quest_set_slot, "qst_ghost_lady", 1, ":var2"),
    (quest_set_slot, "qst_ghost_lady", 2, ":var1"),
    (quest_set_slot, "qst_ghost_lady", 3, ":var0"),
    (quest_set_slot, "qst_ghost_lady", 4, ":var4"),
    (quest_set_slot, "qst_ghost_lady", 15, ":var5"),
    (quest_set_slot, "qst_ghost_lady", 6, ":var3"),
    (quest_set_slot, "qst_ghost_lady", 23, 0),
    (quest_set_slot, "qst_ghost_lady", 25, 10000),
    (quest_set_slot, "qst_ghost_lady", 10, 0),
    (quest_set_slot, "qst_ghost_lady", 11, 0),
    (troop_set_slot, ":var3", 12, ":var2"),
    (setup_quest_text, "qst_ghost_lady"),
    (str_store_troop_name_link, s4, ":var1"),
    (str_store_party_name_link, s5, ":var2"),
    (str_store_string, s60, "@A passing messenger told you {s4}'s wife died suddenly in {s5}."),
    (display_message, "@A passing messenger tells you {s4}'s wife died suddenly in {s5}.", 0x66CCFF),
    (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
    (start_quest, "qst_ghost_lady"),
    (display_message, "str_quest_log_updated", 0x66CCFF),
  ]),

  (168.07,
  [
    (call_script, "script_auto_repair_buildings"),
  ]),

  (480.2,
  [
    (call_script, "script_random_build_buildings"),
  ]),

  (5.11,
  [
    (store_random_in_range, ":var0", 0, 250),
    (try_begin),
      (lt, ":var0", 4),
      (is_currently_night),
      (play_sound, "snd_encounter_pop_sfx_four"),
    (else_try),
      (lt, ":var0", 8),
      (play_sound, "snd_encounter_pop_sfx_five"),
    (else_try),
      (lt, ":var0", 12),
      (play_sound, "snd_encounter_pop_sfx_two"),
    (else_try),
      (lt, ":var0", 16),
      (play_sound, "snd_encounter_pop_sfx_three"),
    (else_try),
      (lt, ":var0", 20),
      (play_sound, "snd_ambient_thunder"),
    (else_try),
      (lt, ":var0", 24),
      (play_sound, "snd_ambient_thunderrain"),
    (else_try),
      (lt, ":var0", 28),
      (play_sound, "snd_ambient_thunderrumble"),
    (else_try),
      (lt, ":var0", 32),
      (is_currently_night),
      (play_sound, "snd_encounter_pop_sfx_eight"),
    (else_try),
      (lt, ":var0", 35),
      (is_currently_night),
      (play_sound, "snd_encounter_pop_sfx_six"),
    (else_try),
      (lt, ":var0", 38),
      (is_currently_night),
      (play_sound, "snd_encounter_pop_sfx_one"),
    (try_end),
  ]),

  (14,
  [
    (try_for_parties, ":var0"),
      (gt, ":var0", "p_spawn_points_end"),
      (store_faction_of_party, ":var1", ":var0"),
      (neg|is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (store_party_size_wo_prisoners, ":var2", ":var0"),
      (ge, ":var2", 150),
      (party_get_battle_opponent, ":var3", ":var0"),
      (eq, ":var3", -1),
      (call_script, "script_party_calculate_strength", ":var0", 0),
      (assign, ":var4", reg0),
      (gt, ":var4", 30000),
      (val_mul, ":var4", 67),
      (val_div, ":var4", 100),
      (assign, ":var5", "p_castle_1"),
      (try_for_range, ":var6", "p_town_1", ":var5"),
        (party_slot_eq, ":var6", 54, -1),
        (store_faction_of_party, ":var7", ":var6"),
        (store_relation, ":var8", ":var1", ":var7"),
        (lt, ":var8", 0),
        (try_begin),
          (party_slot_eq, ":var6", 7, "trp_player"),
          (store_relation, ":var9", "fac_player_faction", ":var1"),
          (ge, ":var9", 0),
          (assign, ":var10", 10),
        (else_try),
          (assign, ":var10", 0),
        (try_end),
        (eq, ":var10", 0),
        (store_distance_to_party_from_party, ":var11", ":var0", ":var6"),
        (le, ":var11", 5),
        (party_collect_attachments_to_party, ":var6", "p_garrison_plus_lords"),
        (call_script, "script_party_calculate_strength", "p_garrison_plus_lords", 0),
        (assign, ":var12", reg0),
        (gt, ":var4", ":var12"),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", 15),
        (party_set_ai_behavior, ":var0", ai_bhvr_attack_party),
        (party_set_ai_object, ":var0", ":var6"),
        (party_set_ai_initiative, ":var0", 0),
        (party_set_slot, ":var6", 54, ":var0"),
        (call_script, "script_village_set_state", ":var6", 5),
        (str_store_party_name, s5, ":var0"),
        (str_store_party_name, s6, ":var6"),
        (display_message, "@{s5} launches a surprise attack on {s6}!", 0x66CCFF),
        (try_begin),
          (this_or_next|party_slot_eq, ":var6", 7, "trp_player"),
          (eq, ":var7", "fac_player_supporters_faction"),
          (call_script, "script_add_notification_menu", "mnu_notification_center_under_siege_special", ":var6", ":var0"),
        (try_end),
        (assign, ":var5", 0),
      (try_end),
    (try_end),
  ]),

  (384,
  [
    (store_current_day, ":var0"),
    (gt, ":var0", 365),
    (store_character_level, ":var1", "trp_player"),
    (gt, ":var1", 30),
    (store_random_in_range, ":var2", 0, 100),
    (lt, ":var2", 5),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "fac_dragon_knights", "fac_player_knights"),
      (neq, ":var4", 49),
      (faction_get_slot, ":var5", ":var4", 68),
      (assign, ":var6", 0),
      (try_for_range, ":var7", "p_town_1", "p_village_1"),
        (party_slot_eq, ":var7", 289, ":var5"),
        (assign, ":var6", 1),
      (try_end),
      (eq, ":var6", 0),
      (val_add, ":var3", 1),
    (try_end),
    (gt, ":var3", 0),
    (assign, ":var8", 0),
    (store_random_in_range, ":var9", 0, ":var3"),
    (val_add, ":var9", 1),
    (try_for_range, ":var4", "fac_dragon_knights", "fac_player_knights"),
      (neq, ":var4", 49),
      (eq, ":var8", 0),
      (faction_get_slot, ":var5", ":var4", 68),
      (assign, ":var6", 0),
      (try_for_range, ":var7", "p_town_1", "p_village_1"),
        (party_slot_eq, ":var7", 289, ":var5"),
        (assign, ":var6", 1),
      (try_end),
      (eq, ":var6", 0),
      (val_sub, ":var9", 1),
      (eq, ":var9", 0),
      (assign, ":var8", ":var4"),
    (try_end),
    (gt, ":var8", 0),
    (assign, ":var10", 0),
    (try_for_range, ":var11", "fac_kingdom_1", "fac_kingdoms_end"),
      (faction_slot_eq, ":var11", 21, 0),
      (faction_get_slot, ":var12", ":var11", 11),
      (assign, ":var6", 0),
      (try_for_range, ":var7", "p_town_1", "p_village_1"),
        (eq, ":var6", 0),
        (party_slot_eq, ":var7", 7, ":var12"),
        (party_slot_eq, ":var7", 289, 0),
        (party_slot_eq, ":var7", 54, -1),
        (assign, ":var6", 1),
      (try_end),
      (eq, ":var6", 1),
      (val_add, ":var10", 1),
    (try_end),
    (gt, ":var10", 0),
    (assign, ":var13", 0),
    (assign, ":var14", 0),
    (store_random_in_range, ":var15", 0, ":var10"),
    (val_add, ":var15", 1),
    (try_for_range, ":var11", "fac_kingdom_1", "fac_kingdoms_end"),
      (eq, ":var13", 0),
      (faction_slot_eq, ":var11", 21, 0),
      (faction_get_slot, ":var12", ":var11", 11),
      (assign, ":var6", 0),
      (try_for_range, ":var7", "p_town_1", "p_village_1"),
        (eq, ":var6", 0),
        (party_slot_eq, ":var7", 7, ":var12"),
        (party_slot_eq, ":var7", 289, 0),
        (party_slot_eq, ":var7", 54, -1),
        (assign, ":var6", 1),
        (val_sub, ":var15", 1),
        (eq, ":var15", 0),
        (assign, ":var13", ":var12"),
        (assign, ":var14", ":var7"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var13", "trp_kingdom_2_lord"),
      (eq, ":var8", 50),
      (try_begin),
        (assign, ":var3", 0),
        (try_for_range, ":var4", "fac_dragon_knights", "fac_player_knights"),
          (this_or_next|neq, ":var4", 49),
          (neq, ":var4", 50),
          (faction_get_slot, ":var5", ":var4", 68),
          (assign, ":var6", 0),
          (try_for_range, ":var7", "p_town_1", "p_village_1"),
            (party_slot_eq, ":var7", 289, ":var5"),
            (assign, ":var6", 1),
          (try_end),
          (eq, ":var6", 0),
          (val_add, ":var3", 1),
        (try_end),
        (gt, ":var3", 0),
        (assign, ":var8", 0),
        (store_random_in_range, ":var9", 0, ":var3"),
        (val_add, ":var9", 1),
        (try_for_range, ":var4", "fac_dragon_knights", "fac_player_knights"),
          (neq, ":var4", 49),
          (neq, ":var4", 50),
          (eq, ":var8", 0),
          (faction_get_slot, ":var5", ":var4", 68),
          (assign, ":var6", 0),
          (try_for_range, ":var7", "p_town_1", "p_village_1"),
            (party_slot_eq, ":var7", 289, ":var5"),
            (assign, ":var6", 1),
          (try_end),
          (eq, ":var6", 0),
          (val_sub, ":var9", 1),
          (eq, ":var9", 0),
          (assign, ":var8", ":var4"),
        (try_end),
        (gt, ":var8", 0),
        (faction_get_slot, ":var16", ":var8", 68),
        (party_set_slot, ":var14", 289, ":var16"),
        (call_script, "script_add_notification_menu", "mnu_notification_order_founded", ":var8", ":var14"),
      (try_end),
    (else_try),
      (faction_get_slot, ":var16", ":var8", 68),
      (party_set_slot, ":var14", 289, ":var16"),
      (call_script, "script_add_notification_menu", "mnu_notification_order_founded", ":var8", ":var14"),
    (try_end),
  ]),

  (312,
  [
    (store_random_in_range, ":var0", 0, 100),
    (lt, ":var0", 5),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "p_castle_1", "p_village_1"),
      (party_slot_eq, ":var2", 289, 0),
      (party_slot_eq, ":var2", 54, -1),
      (party_get_slot, ":var3", ":var2", 7),
      (is_between, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neg|is_between, ":var3", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (neg|is_between, ":var3", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (val_add, ":var1", 1),
    (try_end),
    (gt, ":var1", 0),
    (assign, ":var4", 0),
    (store_random_in_range, ":var5", 0, ":var1"),
    (val_add, ":var5", 1),
    (try_for_range, ":var2", "p_castle_1", "p_village_1"),
      (eq, ":var4", 0),
      (party_slot_eq, ":var2", 289, 0),
      (party_slot_eq, ":var2", 54, -1),
      (party_get_slot, ":var3", ":var2", 7),
      (is_between, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neg|is_between, ":var3", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (neg|is_between, ":var3", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (val_sub, ":var5", 1),
      (eq, ":var5", 0),
      (assign, ":var4", ":var2"),
    (try_end),
    (call_script, "script_generate_minor_order", ":var4"),
    (assign, ":var6", reg0),
    (neq, ":var6", -1),
    (faction_get_slot, ":var7", ":var6", 68),
    (party_set_slot, ":var4", 289, ":var7"),
    (party_get_slot, ":var8", ":var4", 7),
    (try_begin),
      (troop_slot_eq, ":var8", 158, 0),
      (troop_set_slot, ":var8", 158, ":var7"),
      (troop_set_slot, ":var8", 159, 2),
      (troop_set_slot, ":var8", 160, 4),
    (try_end),
    (call_script, "script_add_notification_menu", "mnu_notification_order_founded", ":var6", ":var4"),
  ]),

  (9,
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (try_begin),
        (eq, ":var0", "fac_kingdom_1"),
        (assign, ":var1", "fac_lion_knights"),
        (assign, ":var2", "p_town_6"),
      (else_try),
        (eq, ":var0", "fac_kingdom_2"),
        (assign, ":var1", "fac_dragon_knights"),
        (assign, ":var2", "p_town_13"),
      (else_try),
        (eq, ":var0", "fac_kingdom_3"),
        (assign, ":var1", "fac_windriders_knights"),
        (assign, ":var2", "p_town_10"),
      (else_try),
        (eq, ":var0", "fac_kingdom_4"),
        (assign, ":var1", "fac_valkyrie_knights"),
        (assign, ":var2", "p_town_1"),
      (else_try),
        (eq, ":var0", "fac_kingdom_5"),
        (assign, ":var1", "fac_immortal_knights"),
        (assign, ":var2", "p_town_5"),
      (else_try),
        (assign, ":var1", "fac_player_knights"),
        (assign, ":var2", "p_town_1"),
      (try_end),
      (faction_get_slot, ":var3", ":var1", 68),
      (faction_get_slot, ":var4", ":var1", 69),
      (try_begin),
        (party_slot_eq, ":var2", 289, ":var3"),
        (store_faction_of_party, ":var5", ":var2"),
        (eq, ":var5", ":var0"),
      (else_try),
        (assign, ":var2", 0),
        (try_for_range, ":var6", "p_town_1", "p_village_1"),
          (eq, ":var2", 0),
          (party_slot_eq, ":var6", 289, ":var3"),
          (store_faction_of_party, ":var7", ":var6"),
          (eq, ":var7", ":var0"),
          (assign, ":var2", ":var6"),
        (try_end),
      (try_end),
      (neq, ":var2", 0),
      (faction_get_slot, ":var8", ":var0", 73),
      (faction_get_slot, ":var9", ":var0", 74),
      (try_begin),
        (gt, ":var8", 0),
        (neg|party_is_active, ":var8"),
        (assign, ":var8", 0),
        (faction_set_slot, ":var0", 73, 0),
      (try_end),
      (assign, ":var10", -1),
      (try_begin),
        (call_script, "script_cf_faction_get_random_enemy_faction", ":var0"),
        (assign, ":var10", reg0),
      (try_end),
      (store_current_day, ":var11"),
      (try_begin),
        (neq, ":var10", -1),
        (eq, ":var8", 0),
        (store_sub, ":var12", ":var11", ":var9"),
        (ge, ":var12", 30),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", 1),
        (faction_set_slot, ":var0", 74, ":var11"),
        (assign, ":var9", ":var11"),
        (spawn_around_party, ":var2", "pt_errant_knights"),
        (assign, ":var8", reg0),
        (faction_set_slot, ":var0", 73, ":var8"),
        (party_set_slot, ":var8", 123, ":var2"),
        (party_set_flags, ":var8", 65536, 0),
        (party_set_faction, ":var8", ":var0"),
        (str_store_faction_name, s5, ":var1"),
        (party_set_name, ":var8", "@{s5} War Party"),
        (party_set_ai_initiative, ":var8", 100),
        (1606, ":var8", 10),
        (1607, ":var8", 10),
        (1647, ":var8", 200),
        (party_set_slot, ":var8", 4, -1),
        (party_set_slot, ":var8", 0, 19),
        (store_character_level, ":var14", "trp_player"),
        (val_clamp, ":var14", 10, 41),
        (store_mul, ":var15", ":var14", 12),
        (val_div, ":var15", 10),
        (store_mul, ":var16", ":var14", 24),
        (val_div, ":var16", 10),
        (store_random_in_range, ":var17", ":var15", ":var16"),
        (party_add_members, ":var8", ":var3", ":var17"),
        (store_mul, ":var18", ":var14", 20),
        (val_div, ":var18", 10),
        (store_mul, ":var19", ":var14", 40),
        (val_div, ":var19", 10),
        (store_random_in_range, ":var20", ":var18", ":var19"),
        (party_add_members, ":var8", ":var4", ":var20"),
        (call_script, "script_party_calculate_strength", ":var8", 0),
        (party_set_slot, ":var8", 49, reg0),
        (str_store_faction_name, s11, ":var0"),
        (str_store_faction_name, s12, ":var1"),
        (str_store_party_name, s13, ":var2"),
        (display_message, "@The {s12} from {s13} have assembled a war party to assist the {s11}."),
      (try_end),
      (neq, ":var8", 0),
      (party_get_slot, ":var21", ":var8", 4),
      (try_begin),
        (neq, ":var21", 14),
        (store_sub, ":var12", ":var11", ":var9"),
        (party_get_slot, ":var22", ":var8", 49),
        (val_div, ":var22", 5),
        (call_script, "script_party_calculate_strength", ":var8", 0),
        (this_or_next|ge, ":var22", reg0),
        (this_or_next|ge, ":var12", 15),
        (eq, ":var10", -1),
        (party_set_ai_behavior, ":var8", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var8", ":var2"),
        (party_set_slot, ":var8", 123, ":var2"),
        (party_set_slot, ":var8", 4, 14),
        (assign, ":var21", 14),
      (try_end),
      (neq, ":var21", 14),
      (faction_get_slot, ":var23", ":var0", 8),
      (try_begin),
        (store_random_in_range, ":var24", 0, 100),
        (this_or_next|lt, ":var24", 20),
        (neq, ":var21", 4),
        (ge, ":var23", 0),
        (troop_get_slot, ":var25", ":var23", 10),
        (party_is_active, ":var25"),
        (this_or_next|eq, ":var23", "trp_player"),
        (this_or_next|party_slot_eq, ":var25", 4, 1),
        (party_slot_eq, ":var25", 4, 10),
        (party_set_ai_behavior, ":var8", ai_bhvr_escort_party),
        (party_set_ai_object, ":var8", ":var25"),
        (party_set_slot, ":var8", 4, 11),
        (assign, ":var21", 11),
      (else_try),
        (store_random_in_range, ":var24", 0, 100),
        (this_or_next|lt, ":var24", 50),
        (neq, ":var21", 4),
        (assign, ":var26", 0),
        (try_for_range, ":var27", "p_village_1", "p_salt_mine"),
          (eq, ":var26", 0),
          (party_slot_eq, ":var27", 35, 1),
          (store_faction_of_party, ":var28", ":var27"),
          (eq, ":var28", ":var0"),
          (assign, ":var26", ":var27"),
        (try_end),
        (try_begin),
          (eq, ":var26", 0),
          (try_for_range, ":var29", "p_town_1", "p_village_1"),
            (eq, ":var26", 0),
            (party_slot_ge, ":var29", 54, 1),
            (store_faction_of_party, ":var28", ":var29"),
            (eq, ":var28", ":var0"),
            (assign, ":var26", ":var29"),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var26", 0),
          (call_script, "script_get_closest_walled_center_of_faction", ":var8", ":var10"),
          (neq, reg0, -1),
          (call_script, "script_get_closest_center_of_faction", reg0, ":var0"),
          (neq, reg0, -1),
          (assign, ":var26", reg0),
        (try_end),
        (gt, ":var26", 0),
        (party_set_ai_behavior, ":var8", ai_bhvr_patrol_party),
        (party_set_ai_object, ":var8", ":var26"),
        (party_set_ai_patrol_radius, ":var8", 1),
        (party_set_slot, ":var8", 4, 4),
        (assign, ":var21", 4),
      (try_end),
    (try_end),
  ]),

  (25,
  [
    (try_for_parties, ":var0"),
      (gt, ":var0", "p_spawn_points_end"),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (try_begin),
        (is_between, ":var1", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (neg|troop_slot_eq, ":var1", 2, 2),
        (troop_set_slot, ":var1", 2, 2),
      (try_end),
      (party_get_template_id, ":var2", ":var0"),
      (eq, ":var2", "pt_eyegrim"),
      (party_get_battle_opponent, ":var3", ":var0"),
      (eq, ":var3", -1),
      (try_begin),
        (party_count_members_of_type, ":var4", ":var0", "trp_hero_eyegrim"),
        (le, ":var4", 0),
        (party_add_leader, ":var0", "trp_hero_eyegrim", 1),
        (display_log_message, "@Eyegrim's horde has gathered enough souls to raise him once more.", 0xFF5050),
      (try_end),
      (assign, ":var5", 0),
      (try_begin),
        (party_get_num_companion_stacks, ":var6", ":var0"),
        (gt, ":var6", 1),
        (try_for_range_backwards, ":var7", 1, ":var6"),
          (party_stack_get_troop_id, ":var8", ":var0", ":var7"),
          (troop_get_type, ":var9", ":var8"),
          (neq, ":var9", 3),
          (neg|troop_is_hero, ":var8"),
          (party_stack_get_size, ":var10", ":var0", ":var7"),
          (assign, ":var11", ":var10"),
          (party_remove_members, ":var0", ":var8", ":var10"),
          (try_begin),
            (party_get_num_companions, ":var12", ":var0"),
            (lt, ":var12", 5000),
            (store_character_level, ":var13", ":var8"),
            (try_begin),
              (ge, ":var13", 31),
              (assign, ":var14", "trp_fallen_warrior"),
            (else_try),
              (ge, ":var13", 26),
              (assign, ":var14", "trp_fallen_veteran"),
            (else_try),
              (ge, ":var13", 15),
              (assign, ":var14", "trp_fallen_footman"),
            (else_try),
              (assign, ":var14", "trp_fallen"),
            (try_end),
            (party_add_members, ":var0", ":var14", ":var11"),
            (assign, ":var5", 1),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (party_get_num_prisoner_stacks, ":var6", ":var0"),
        (gt, ":var6", 0),
        (try_for_range_backwards, ":var7", 0, ":var6"),
          (party_prisoner_stack_get_troop_id, ":var8", ":var0", ":var7"),
          (troop_get_type, ":var9", ":var8"),
          (neq, ":var9", 3),
          (neg|troop_is_hero, ":var8"),
          (party_prisoner_stack_get_size, ":var10", ":var0", ":var7"),
          (try_begin),
            (ge, ":var10", 2),
            (store_div, ":var11", ":var10", 2),
          (else_try),
            (assign, ":var11", 1),
          (try_end),
          (party_remove_prisoners, ":var0", ":var8", ":var11"),
          (try_begin),
            (party_get_num_companions, ":var12", ":var0"),
            (lt, ":var12", 5000),
            (store_character_level, ":var13", ":var8"),
            (try_begin),
              (gt, ":var13", 31),
              (assign, ":var14", "trp_fallen_warrior"),
            (else_try),
              (ge, ":var13", 26),
              (assign, ":var14", "trp_fallen_veteran"),
            (else_try),
              (ge, ":var13", 15),
              (assign, ":var14", "trp_fallen_footman"),
            (else_try),
              (assign, ":var14", "trp_fallen"),
            (try_end),
            (party_add_members, ":var0", ":var14", ":var11"),
            (assign, ":var5", 1),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var5", 1),
        (store_random_in_range, ":var15", 0, 100),
        (str_clear, s2),
        (try_begin),
          (lt, ":var15", 14),
          (str_store_string, s2, "@Sources say Knights of the Eventide are avoiding Eyegrim at all costs. Reasons unknown."),
        (else_try),
          (lt, ":var15", 28),
          (str_store_string, s2, "@Rumor has it that the demon king has gathered more Fallen from his prisoners!"),
        (else_try),
          (lt, ":var15", 42),
          (str_store_string, s2, "@Echos of hundreds of souls being forfeited can be heard from miles away."),
        (else_try),
          (lt, ":var15", 56),
          (str_store_string, s2, "@Villages report that Eyegrim is killing humans to create more Fallen!"),
        (else_try),
          (lt, ":var15", 70),
          (str_store_string, s2, "@Full skin of human remains have been found by the hundreds in reported areas where a demonic horde lay waste."),
        (else_try),
          (lt, ":var15", 84),
          (str_store_string, s2, "@Knights of the Dawn report that captured heretics say 'Eyegrim is creating Fallen in Pendor.'"),
        (else_try),
          (str_store_string, s2, "@Eyegrim has risen more Fallen from his prisoners!"),
        (try_end),
        (display_log_message, "@{s2}", 0xFF5050),
      (try_end),
    (try_end),
  ]),

  (48,
  [
    (try_for_range, ":var0", "trp_knight_1_1", "trp_kingdom_1_pretender"),
      (neq, ":var0", "trp_player"),
      (store_troop_faction, ":var1", ":var0"),
      (faction_slot_eq, ":var1", 21, 1),
      (call_script, "script_lord_find_alternative_faction", ":var0"),
      (assign, ":var2", reg0),
      (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (str_store_troop_name, s36, ":var0"),
      (str_store_faction_name_link, s2, ":var2"),
      (str_store_faction_name_link, s3, ":var1"),
      (call_script, "script_change_troop_faction", ":var0", ":var2"),
      (troop_get_type, reg4, ":var0"),
      (str_store_string, s4, "str_lord_defects_ordinary"),
      (str_store_troop_name_link, s7, ":var0"),
      (str_store_string, s4, "@As you approach, you are spotted by the castle guards, who welcome you and open the gates for their {reg63?lord:lady}."),
    (try_end),
  ]),

  (3,
  [
    (try_for_parties, ":var0"),
      (neg|is_between, ":var0", "p_main_party", "p_parties_end"),
      (party_get_num_companions, ":var1", ":var0"),
      (lt, ":var1", 1),
      (remove_party, ":var0"),
    (try_end),
  ]),

]