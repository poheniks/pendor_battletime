# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_troops import *
from header_items import *
from header_dialogs import *
from header_operations import *
from header_parties import *
from header_item_modifiers import *
from header_skills import *
from header_triggers import *
from ID_troops import *
from ID_party_templates import *

from module_constants import *


####################################################################################################################
# During a dialog, the dialog lines are scanned from top to bottom.
# If the dialog-line is spoken by the player, all the matching lines are displayed for the player to pick from.
# If the dialog-line is spoken by another, the first (top-most) matching line is selected.
#
#  Each dialog line contains the following fields:
# 1) Dialogue partner: This should match the person player is talking to.
#    Usually this is a troop-id.
#    You can also use a party-template-id by appending '|party_tpl' to this field.
#    Use the constant 'anyone' if you'd like the line to match anybody.
#    Appending '|plyr' to this field means that the actual line is spoken by the player
#    Appending '|other(troop_id)' means that this line is spoken by a third person on the scene.
#       (You must make sure that this third person is present on the scene)
#
# 2) Starting dialog-state:
#    During a dialog there's always an active Dialog-state.
#    A dialog-line's starting dialog state must be the same as the active dialog state, for the line to be a possible candidate.
#    If the dialog is started by meeting a party on the map, initially, the active dialog state is "start"
#    If the dialog is started by speaking to an NPC in a town, initially, the active dialog state is "start"
#    If the dialog is started by helping a party defeat another party, initially, the active dialog state is "party_relieved"
#    If the dialog is started by liberating a prisoner, initially, the active dialog state is "prisoner_liberated"
#    If the dialog is started by defeating a party led by a hero, initially, the active dialog state is "enemy_defeated"
#    If the dialog is started by a trigger, initially, the active dialog state is "event_triggered"
# 3) Conditions block (list): This must be a valid operation block. See header_operations.py for reference.  
# 4) Dialog Text (string):
# 5) Ending dialog-state:
#    If a dialog line is picked, the active dialog-state will become the picked line's ending dialog-state.
# 6) Consequences block (list): This must be a valid operation block. See header_operations.py for reference.
# 7) Voice-over (string): sound filename for the voice over. Leave here empty for no voice over
####################################################################################################################

dialogs = [
  [anyone, "start",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$g_camp_talk", 1),
    ],
    "Yes?",
    "member_talk",
    []],

  [anyone, "start",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (store_conversation_agent, "$g_talk_agent"),
      (store_troop_faction, "$g_talk_troop_faction", "$g_talk_troop"),
      (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
      (assign, "$g_talk_troop_relation", reg0),
      (store_skill_level, ":var0", skl_persuasion, "trp_player"),
      (assign, "$g_talk_troop_effective_relation", "$g_talk_troop_relation"),
      (val_add, "$g_talk_troop_effective_relation", ":var0"),
      (try_begin),
        (gt, "$g_talk_troop_effective_relation", 0),
        (store_add, ":var1", 10, ":var0"),
        (val_mul, "$g_talk_troop_effective_relation", ":var1"),
        (val_div, "$g_talk_troop_effective_relation", 10),
      (else_try),
        (lt, "$g_talk_troop_effective_relation", 0),
        (store_sub, ":var1", 20, ":var0"),
        (val_mul, "$g_talk_troop_effective_relation", ":var1"),
        (val_div, "$g_talk_troop_effective_relation", 20),
      (try_end),
      (val_clamp, "$g_talk_troop_effective_relation", -100, 101),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg3, "$g_talk_troop_effective_relation"),
        (display_message, "str_test_effective_relation_=_reg3"),
      (try_end),
      (try_begin),
        (this_or_next|is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
        (is_between, "$g_talk_troop", "trp_town_1_mayor", "trp_village_1_elder"),
        (party_get_slot, "$g_talk_troop_relation", "$current_town", 26),
      (try_end),
      (store_relation, "$g_talk_troop_faction_relation", "$g_talk_troop_faction", "fac_player_faction"),
      (assign, "$g_talk_troop_party", "$g_encountered_party"),
      (try_begin),
        (troop_slot_ge, "$g_talk_troop", 10, 1),
        (troop_get_slot, "$g_talk_troop_party", "$g_talk_troop", 10),
      (try_end),
      (store_current_hours, "$g_current_hours"),
      (troop_get_slot, "$g_talk_troop_last_talk_time", "$g_talk_troop", 4),
      (troop_set_slot, "$g_talk_troop", 4, "$g_current_hours"),
      (store_sub, "$g_time_since_last_talk", "$g_current_hours", "$g_talk_troop_last_talk_time"),
      (troop_get_slot, "$g_talk_troop_met", "$g_talk_troop", 5),
      (val_min, "$g_talk_troop_met", 1),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 5, 0),
        (troop_set_slot, "$g_talk_troop", 5, 1),
        (try_begin),
          (is_between, "$g_talk_troop", "trp_knight_1_1_wife", "trp_heroes_end"),
        (try_end),
      (try_end),
      (try_begin),
        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, "$g_enemy_strength", reg0),
        (call_script, "script_party_calculate_strength", "p_main_party", 0),
        (assign, "$g_ally_strength", reg0),
        (store_mul, "$g_strength_ratio", "$g_ally_strength", 100),
        (assign, ":var2", "$g_enemy_strength"),
        (val_max, ":var2", 1),
        (val_div, "$g_strength_ratio", ":var2"),
      (try_end),
      (assign, "$g_comment_found", 0),
      (assign, "$g_comment_has_rejoinder", 0),
      (assign, "$g_romantic_comment_made", 0),
      (assign, "$skip_lord_assumes_argument", 0),
      (assign, "$bypass_female_vassal_explanation", 0),
      (assign, "$g_done_wedding_comment", 0),
      (try_begin),
        (troop_is_hero, "$g_talk_troop"),
        (neg|is_between, "$g_talk_troop", "trp_hero_burilgi", "trp_omen_seeker"),
        (talk_info_show, 1),
        (call_script, "script_setup_talk_info"),
      (else_try),
        (eq, "$talk_context", 2),
        (neg|this_or_next|troop_is_hero, "$g_talk_troop"),
        (is_between, "$g_talk_troop", "trp_hero_burilgi", "trp_omen_seeker"),
        (talk_info_show, 1),
        (store_faction_of_party, ":var3", "p_main_party"),
        (store_relation, ":var4", "$g_encountered_party_faction", ":var3"),
        (talk_info_set_relation_bar, ":var4"),
        (str_store_faction_name, s61, "$g_encountered_party_faction"),
        (str_store_string, s61, "@ {s61}"),
        (assign, reg1, ":var4"),
        (str_store_string, s62, "str_relation_reg1"),
        (talk_info_set_line, 0, s61),
        (talk_info_set_line, 1, s62),
        (call_script, "script_describe_relation_to_s63", ":var4"),
        (talk_info_set_line, 3, s63),
      (else_try),
        (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
        (talk_info_show, 1),
        (talk_info_set_relation_bar, "$g_talk_troop_faction_relation"),
        (str_store_faction_name, s61, "$g_talk_troop_faction"),
        (str_store_string, s61, "@ {s61}"),
        (assign, reg1, "$g_talk_troop_faction_relation"),
        (str_store_string, s62, "str_relation_reg1"),
        (talk_info_set_line, 0, s61),
        (talk_info_set_line, 1, s62),
        (call_script, "script_describe_relation_to_s63", "$g_talk_troop_faction_relation"),
        (talk_info_set_line, 3, s63),
      (try_end),
      (assign, "$g_last_comment_copied_to_s42", 0),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 2, 2),
        (call_script, "script_get_relevant_comment_to_s42"),
        (assign, "$g_comment_found", reg0),
      (try_end),
      (troop_get_type, reg65, "$g_talk_troop"),
      (try_begin),
        (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
        (str_store_string, s64, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s65, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s66, "@{reg65?My Lady:My Lord}"),
        (str_store_string, s67, "@{reg65?My Lady:My Lord}"),
      (else_try),
        (str_store_string, s64, "@{reg65?madame:sir}"),
        (str_store_string, s65, "@{reg65?madame:sir}"),
        (str_store_string, s66, "@{reg65?Madame:Sir}"),
        (str_store_string, s67, "@{reg65?Madame:Sir}"),
      (try_end),
      (call_script, "script_gender_to_reg63"),
      (try_begin),
        (gt, "$cheat_mode", 0),
        (assign, reg4, "$talk_context"),
        (display_message, "@{!}DEBUG -- Talk context: {reg4}"),
      (try_end),
      (try_begin),
        (gt, "$cheat_mode", 0),
        (assign, reg4, "$g_time_since_last_talk"),
        (display_message, "@{!}DEBUG -- Time since last talk: {reg4}"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 0),
        (store_partner_quest, ":var5"),
        (ge, ":var5", 0),
        (str_store_quest_name, s4, ":var5"),
      (try_end),
      (eq, 1, 0),
    ],
    "{!}Warning: This line is never displayed. It is just for storing conversation variables.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (eq, "$current_town", "p_old_ruins"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (str_clear, s54),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s54, "@The men are hard at work, this place is shaping up."),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s54, "@Things are progressing very well."),
      (else_try),
        (str_store_string, s54, "@All seems alright."),
      (try_end),
    ],
    "{s54}",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_sarleon_lady_in_waiting", "trp_caravan_master"),
    ],
    "You are my prisoner, lady. Why would you take up arms against me and what am I to do with you?",
    "lady_prisoner_chat_2",
    []],

  [anyone, "lady_prisoner_chat_2",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_sarleon_lady_in_waiting", "trp_caravan_master"),
    ],
    "My Lord, I was forced {reg63?Lord:Lady} and was in fear for my life. I implore you for mercy and I relinquish my fate into your hands.",
    "do_lady_options",
    []],

  [anyone, "member_chat",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_sarleon_lady_in_waiting", "trp_caravan_master"),
    ],
    "Greetings {reg63?Lord:Lady}. Thank you for saving me!",
    "lady_member_talk",
    []],

  [plyr|anyone, "lady_member_talk",
    [],
    "You are welcome. What should I do with you?",
    "lady_member_options",
    []],

  [anyone, "lady_member_options",
    [],
    "My fate, such as it is, rests in your hands.",
    "do_lady_options",
    []],

  [plyr|anyone, "do_lady_options",
    [
      (store_troop_faction, reg0, "$g_talk_troop"),
      (str_store_faction_name, s3, reg0),
      (faction_slot_eq, reg0, 21, 0),
    ],
    "You could accept my gratitude for freeing me- I am sure the {s3} would be grateful.",
    "lady_end_talk",
    [
      (call_script, "script_lady_in_waiting_rescue", 1, reg0),
    ]],

  [plyr|anyone, "do_lady_options",
    [
      (store_troop_faction, reg0, "$g_talk_troop"),
      (str_store_faction_name, s3, reg0),
      (faction_slot_eq, reg0, 21, 0),
    ],
    "You can receive a ransom for me, but the {s3} would view this in an unfavorable light.",
    "lady_end_talk",
    [
      (call_script, "script_lady_in_waiting_rescue", 0, reg0),
      (store_random_in_range, ":var0", 800, 2000),
      (call_script, "script_troop_add_gold", "trp_player", ":var0"),
    ]],

  [plyr|anyone, "do_lady_options",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 200),
    ],
    "Spend 200 gold for equipment that will allow me to fight at your side.",
    "lady_end_talk",
    [
      (remove_member_from_party, "$g_talk_troop", "p_main_party"),
      (store_random_in_range, ":var0", 1, 6),
      (try_begin),
        (eq, ":var0", 1),
        (party_add_members, "p_main_party", "trp_sword_sister", 1),
      (else_try),
        (eq, ":var0", 2),
        (party_add_members, "p_main_party", "trp_maiden_cavalry", 1),
      (else_try),
        (eq, ":var0", 3),
        (party_add_members, "p_main_party", "trp_veccavi_horse", 1),
      (else_try),
        (party_add_members, "p_main_party", "trp_maiden_adventurer", 1),
      (try_end),
      (troop_remove_gold, "trp_player", 200),
    ]],

  [plyr|anyone, "do_lady_options",
    [],
    "We will speak later.",
    "lady_end_talk",
    []],

  [anyone, "lady_end_talk",
    [],
    "As you wish.",
    "close_window",
    []],

  [anyone, "member_chat",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (talk_info_show, 1),
        (call_script, "script_setup_talk_info_companions"),
      (else_try),
        (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (talk_info_show, 1),
        (call_script, "script_setup_talk_info"),
      (try_end),
      (troop_get_type, reg65, "$g_talk_troop"),
      (try_begin),
        (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
        (str_store_string, s64, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s65, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s66, "@{reg65?My Lady:My Lord}"),
      (else_try),
        (str_store_string, s64, "@{reg65?madame:sir}"),
        (str_store_string, s65, "@{reg65?madame:sir}"),
        (str_store_string, s66, "@{reg65?Madame:Sir}"),
      (try_end),
      (call_script, "script_gender_to_reg63"),
      (store_current_hours, "$g_current_hours"),
      (troop_set_slot, "$g_talk_troop", 4, "$g_current_hours"),
      (eq, 1, 0),
    ],
    "{!}Warning: This line is never displayed. It is just for storing conversation variables.",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (talk_info_show, 1),
        (call_script, "script_setup_talk_info_companions"),
      (try_end),
      (troop_get_type, reg65, "$g_talk_troop"),
      (try_begin),
        (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
        (str_store_string, s64, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s65, "@{reg65?my Lady:my Lord}"),
        (str_store_string, s66, "@{reg65?My Lady:My Lord}"),
      (else_try),
        (str_store_string, s64, "@{reg65?madame:sir}"),
        (str_store_string, s65, "@{reg65?madame:sir}"),
        (str_store_string, s66, "@{reg65?Madame:Sir}"),
      (try_end),
      (call_script, "script_gender_to_reg63"),
      (eq, 1, 0),
    ],
    "{!}Warning: This line is never displayed. It is just for storing conversation variables.",
    "close_window",
    []],

  [plyr|anyone, "start",
    [
      (eq, "$talk_context", 14),
      (is_between, "$g_talk_troop", "trp_town_walker_1", "trp_ramun_the_slave_trader"),
    ],
    "This person looks busy.",
    "close_window",
    []],

  [plyr|anyone, "start",
    [
      (eq, "$talk_context", 14),
      (is_between, "$g_talk_troop", "trp_musician_male", "trp_musicians_end"),
    ],
    "This person looks busy.",
    "close_window",
    []],

  [trp_salt_mine_merchant, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Fair wind to you! What brings you to the Mines of Aziz?",
    "magic_weapon_dialogue_1",
    []],

  [trp_salt_mine_merchant, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 1),
    ],
    "Fair wind to you! Welcome back to the Mines of Aziz.",
    "magic_weapon_3a",
    []],

  [plyr|trp_salt_mine_merchant, "magic_weapon_dialogue_1",
    [],
    "Forgive me, I have found a map to this location and traveled here to explore it. Who are you, and what are you and that crazy old man doing here?",
    "magic_weapon_2",
    []],

  [trp_salt_mine_merchant, "magic_weapon_2",
    [],
    "I have been called by many names over the years. Hmm, I think you can call me Hamidaron.  Yes, that seems to fit well doesn't it? ^^ What am I doing here? Well, I am waiting for a customer. Are you a customer?",
    "magic_weapon_a2",
    []],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a2",
    [],
    "Yes, I guess if that is your name, it fits.   I don't know if I am a customer or not... what do you sell?",
    "magic_weapon_a3a",
    []],

  [plyr|trp_salt_mine_merchant, "magic_weapon_3a",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 1),
    ],
    "Greetings to you also. What do you have for sale?",
    "magic_weapon_a3a",
    []],

  [trp_salt_mine_merchant, "magic_weapon_a3a",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ],
    "Why, I sell the most amazing artifacts ever created by the hand of mortals. But so very few can perceive my wares. ^^ If you cannot see what I offer, then the time is not right for you and you should come back later. ^^^^(requires Qualis Gem and Gold Bar)",
    "magic_weapon_a3",
    []],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_gold"),
    ],
    "I want that Rune Axe.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_gold"),
      (troop_add_item, "trp_player", "itm_strange_rune_axe", imod_plain),
    ]],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_gold"),
    ],
    "I want that Rune Two-handed Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_gold"),
      (troop_add_item, "trp_player", "itm_strange_rune_two_h_sword", imod_plain),
    ]],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_gold"),
    ],
    "I want that Rune Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_gold"),
      (troop_add_item, "trp_player", "itm_strange_rune_sword", imod_plain),
    ]],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_gold"),
    ],
    "I want that Rune Glaive.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_gold"),
      (troop_add_item, "trp_player", "itm_strange_rune_glaive", imod_plain),
    ]],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_gold"),
    ],
    "I want that Rune Bow.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_gold"),
      (troop_add_item, "trp_player", "itm_strange_rune_bow", imod_plain),
    ]],

  [plyr|trp_salt_mine_merchant, "magic_weapon_a3",
    [],
    "Thank you I will leave now.",
    "close_window",
    []],

  [trp_salt_mine_crazy, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Eh? Come on over here... don't dwaddle now... pick up your feet... yes, yes, yes. A Secret I shall tell you. ^^ Listen carefully. HA! Ye hunt a Quails, pluck it well. Trade it for the craft of a mortal man. Then return to me and we shall talk... perhaps, yes, especially if you bring some wine. I like wine. ^^^^(do not equip item, keep in the inventory for the time being)",
    "magic_azziz_1",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_1",
    [],
    "Secrets, Hunting Quail and Wine? Crazy old fart! I have better things to do... goodbye.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [trp_salt_mine_crazy, "start",
    [
      (player_has_item, "itm_wine"),
      (troop_slot_eq, "$g_talk_troop", 80, 1),
    ],
    "Eh? You again? What kept you? Got lost? Sniff-sniff... You have wine for me?",
    "magic_azziz_a1",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_a1",
    [
      (player_has_item, "itm_wine"),
    ],
    "Wine? Yes, here is some wine for you.",
    "magic_weapon_a3",
    [
      (troop_remove_item, "trp_player", "itm_wine"),
      (troop_set_slot, "$g_talk_troop", 80, 2),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_a1",
    [
      (player_has_item, "itm_wine"),
    ],
    "[Tell Lie] No, I do not have any wine!",
    "close_window",
    []],

  [trp_salt_mine_crazy, "magic_weapon_a3",
    [],
    "[BURP!]  aaaah! That hits the spot... I ah... yes... where were we... [YAWN...ZZZZZZ].",
    "magic_azziz_a3",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_a3",
    [],
    "Hey! You! Wake up! You old fart!",
    "close_window",
    []],

  [trp_salt_mine_crazy, "start",
    [
      (neg|player_has_item, "itm_wine"),
      (troop_slot_eq, "$g_talk_troop", 80, 1),
    ],
    "Eh? You again.. without any wine? NO WINE??? Farewell then!",
    "close_window",
    []],

  [trp_salt_mine_crazy, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 2),
    ],
    "Eh? You again.. do you have anything else? ",
    "magic_azziz_7",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_7",
    [],
    "I might... take a look at my inventory.^^^^^(item must be IN inventory, NOT equipped; requires Qualis Gem and Large Pouch of Diamonds)",
    "magic_azziz_9",
    []],

  [trp_salt_mine_crazy, "magic_azziz_9",
    [],
    "Eh? Let me see what I can do... ^^Hmmm ... I can put one of the gemstones into your item's socket to enhance it.",
    "magic_azziz_8",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_axe"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Strange Rune Axe.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_axe"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_saphire_rune_axe", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_axe"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Strange Rune Axe.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_axe"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_ruby_rune_axe", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_axe"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Strange Rune Axe.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_axe"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_emerald_rune_axe", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_glaive"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Strange Rune Glaive.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_glaive"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_saphire_rune_glaive", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_glaive"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Strange Rune Glaive.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_glaive"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_ruby_rune_glaive", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_glaive"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Strange Rune Glaive.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_glaive"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_emerald_rune_glaive", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Strange Rune Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_saphire_rune_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Strange Rune Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_ruby_rune_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Strange Rune Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_emerald_rune_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_bow"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Strange Rune Bow.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_bow"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_saphire_rune_bow", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_bow"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Strange Rune Bow.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_bow"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_ruby_rune_bow", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_bow"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Strange Rune Bow.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_bow"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_emerald_rune_bow", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_two_h_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Strange Rune Two-handed Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_two_h_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_saphire_rune_two_h_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_two_h_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Strange Rune Two-handed Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_two_h_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_ruby_rune_two_h_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_strange_rune_two_h_sword"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Strange Rune Two-handed Sword.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_strange_rune_two_h_sword"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_emerald_rune_two_h_sword", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_rune_plate_strange"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Sapphire into Mystical Rune Plate.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_rune_plate_strange"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_rune_plate_saphire", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_rune_plate_strange"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Ruby into Mystical Rune Plate.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_rune_plate_strange"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_rune_plate_ruby", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_salt_mine_crazy, "magic_azziz_8",
    [
      (player_has_item, "itm_rune_plate_strange"),
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Insert Emerald into Mystical Rune Plate.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_rune_plate_strange"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (troop_add_item, "trp_player", "itm_rune_plate_emerald", imod_plain),
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [trp_salt_mine_crazy, "magic_azziz_8",
    [],
    "...",
    "magic_azziz_10",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_10",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 2),
    ],
    "And?",
    "magic_azziz_11",
    []],

  [trp_salt_mine_crazy, "magic_azziz_11",
    [],
    "Patience you must have my ... hmmm ... ^^ ... Qualis Gem ... rune weapon ... diamonds ... wine ... not enough.",
    "magic_azziz_12",
    []],

  [plyr|trp_salt_mine_crazy, "magic_azziz_12",
    [],
    "Crazy old coot.. I am leaving now.",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (eq, "$talk_context", 20),
      (assign, ":var0", 0),
      (assign, ":var1", "trp_knight_1_1_wife"),
      (try_for_range, ":var2", "trp_npc_adonja", ":var1"),
        (troop_slot_eq, ":var2", 2, 2),
        (neq, "trp_player", ":var2"),
        (store_troop_faction, ":var3", ":var2"),
        (eq, ":var3", "fac_player_supporters_faction"),
        (val_add, ":var0", 1),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (str_store_string, s2, "str_do_you_wish_to_award_it_to_one_of_your_vassals"),
      (else_try),
        (str_store_string, s2, "str_who_do_you_wish_to_give_it_to"),
      (try_end),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (str_store_string, s5, "str_sire_my_lady_we_have_taken_s1_s2"),
    ],
    "{!}{s5}",
    "award_fief_to_vassal",
    []],

  [plyr|anyone, "award_fief_to_vassal",
    [
      (is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var0", "$g_player_court"),
      (eq, ":var0", "fac_player_supporters_faction"),
    ],
    "I wish to defer the appointment of a lord, until I take the counsel of my subjects",
    "award_fief_to_vassal_defer",
    []],

  [anyone, "award_fief_to_vassal_defer",
    [],
    "As you wish, {reg63?sire:my lady}. You may decide this matter at a later date.",
    "close_window",
    [
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, -1),
        (faction_set_slot, "$players_kingdom", 64, "$g_center_taken_by_player_faction"),
      (try_end),
      (call_script, "script_give_center_to_lord", "$g_center_taken_by_player_faction", -1, 0),
      (assign, "$g_center_taken_by_player_faction", -1),
      (try_begin),
        (eq, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "$g_next_menu"),
      (try_end),
    ]],

  [repeat_for_troops|plyr|anyone, "award_fief_to_vassal",
    [
      (store_repeat_object, ":var0"),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, "trp_player", ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (str_store_troop_name, s11, ":var0"),
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", ":var0"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 53, 3),
        (str_store_string, s12, "str__promised_fief"),
      (else_try),
        (str_clear, s12),
      (try_end),
      (try_begin),
        (eq, reg0, 0),
        (str_store_string, s1, "str_no_fiefss12"),
      (else_try),
        (str_store_string, s1, "str_fiefs_s0s12"),
      (try_end),
    ],
    "{!}{s11} {s1}.",
    "award_fief_to_vassal_2",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "award_fief_to_vassal",
    [
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "trp_player"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (str_store_string, s12, "str_please_s65_"),
      (else_try),
        (str_clear, s12),
      (try_end),
      (assign, ":var0", 0),
      (assign, ":var1", "trp_knight_1_1_wife"),
      (try_for_range, ":var2", "trp_npc_adonja", ":var1"),
        (troop_slot_eq, ":var2", 2, 2),
        (neq, "trp_player", ":var2"),
        (store_troop_faction, ":var3", ":var2"),
        (eq, ":var3", "fac_player_supporters_faction"),
        (val_add, ":var0", 1),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (str_store_string, s2, "str_fiefs_s0"),
      (else_try),
        (str_clear, s2),
      (try_end),
      (str_store_string, s5, "str_s12i_want_to_have_s1_for_myself"),
    ],
    "{!}{s5}",
    "award_fief_to_vassal_2",
    [
      (assign, "$temp", "trp_player"),
    ]],

  [anyone, "award_fief_to_vassal_2",
    [],
    "As you wish, {reg63?sire:my lady}. {reg6?I:{reg7?You:{s11}}} will be the new {reg3?lady:lord} of {s1}.",
    "close_window",
    [
      (assign, ":var0", "$temp"),
      (call_script, "script_give_center_to_lord", "$g_center_taken_by_player_faction", ":var0", 0),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$g_center_taken_by_player_faction"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (assign, reg6, 0),
      (assign, reg7, 0),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (assign, reg6, 1),
      (else_try),
        (eq, ":var0", "trp_player"),
        (assign, reg7, 1),
      (else_try),
        (str_store_troop_name, s11, ":var0"),
      (try_end),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (troop_get_type, reg3, ":var0"),
      (assign, "$g_center_taken_by_player_faction", -1),
      (try_begin),
        (eq, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "$g_next_menu"),
      (try_end),
    ]],

  [anyone, "event_triggered",
    [
      (faction_slot_eq, "fac_player_supporters_faction", 11, "$g_talk_troop"),
      (ge, "$g_center_taken_by_player_faction", 0),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
    ],
    "{s1} is not being managed by anyone. Whom shall I put in charge?",
    "center_captured_rebellion",
    []],

  [repeat_for_troops|plyr|anyone, "center_captured_rebellion",
    [
      (store_repeat_object, ":var0"),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, "$g_talk_troop", ":var0"),
      (neq, "trp_player", ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (str_store_troop_name, s11, ":var0"),
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", ":var0"),
      (try_begin),
        (eq, reg0, 0),
        (str_store_string, s1, "@(no fiefs)"),
      (else_try),
        (str_store_string, s1, "@(fiefs: {s0})"),
      (try_end),
    ],
    "{s11}. {s1}",
    "center_captured_rebellion_2",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "center_captured_rebellion",
    [
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "trp_player"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
    ],
    "Please {s65}, I want to have {s1} for myself. (fiefs: {s0})",
    "center_captured_rebellion_2",
    [
      (assign, "$temp", "trp_player"),
    ]],

  [plyr|anyone, "center_captured_rebellion",
    [
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "$g_talk_troop"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
    ],
    "{s66}, you should have {s1} for yourself. (fiefs: {s0})",
    "center_captured_rebellion_2",
    [
      (assign, "$temp", "$g_talk_troop"),
    ]],

  [anyone, "center_captured_rebellion_2",
    [],
    "Hmmm. All right, {playername}. I value your counsel highly. {reg6?I:{reg7?You:{s11}}} will be the new {reg3?lady:lord} of {s1}.",
    "close_window",
    [
      (assign, ":var0", "$temp"),
      (call_script, "script_calculate_troop_score_for_center", ":var0", "$g_center_taken_by_player_faction"),
      (assign, ":var1", reg0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var3", 2, 2),
        (store_troop_faction, ":var4", ":var3"),
        (eq, ":var4", "fac_player_supporters_faction"),
        (neq, ":var3", ":var0"),
        (neg|troop_slot_eq, ":var3", 154, ":var0"),
        (call_script, "script_troop_get_relation_with_troop", ":var3", ":var0"),
        (lt, reg0, 25),
        (call_script, "script_calculate_troop_score_for_center", ":var3", "$g_center_taken_by_player_faction"),
        (assign, ":var5", reg0),
        (gt, ":var5", ":var1"),
        (store_sub, ":var6", ":var5", ":var1"),
        (store_random_in_range, ":var7", 0, ":var6"),
        (val_div, ":var7", 1000),
        (gt, ":var7", 0),
        (val_add, ":var2", ":var7"),
        (val_mul, ":var7", -1),
        (call_script, "script_change_player_relation_with_troop", ":var3", ":var7"),
      (try_end),
      (val_mul, ":var2", 2),
      (val_div, ":var2", 3),
      (val_add, ":var2", 5),
      (try_begin),
        (neq, ":var0", "trp_player"),
        (val_min, ":var2", 30),
        (call_script, "script_change_player_relation_with_troop", ":var0", ":var2"),
      (try_end),
      (call_script, "script_give_center_to_lord", "$g_center_taken_by_player_faction", ":var0", 0),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$g_center_taken_by_player_faction"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (assign, reg6, 0),
      (assign, reg7, 0),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (assign, reg6, 1),
      (else_try),
        (eq, ":var0", "trp_player"),
        (assign, reg7, 1),
      (else_try),
        (str_store_troop_name, s11, ":var0"),
      (try_end),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (troop_get_type, reg3, ":var0"),
      (assign, "$g_center_taken_by_player_faction", -1),
      (try_begin),
        (eq, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "$g_next_menu"),
      (try_end),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 0),
      (eq, "$g_tutorial_fighter_talk_before", 0),
    ],
    "Hello there. We are polishing off our combat skills here with a bit of sparring practice. You look like you could use a bit of training. Why don't you join us, and we can show you a few tricks. And if you need explanation of any combat concepts, just ask, and I will do my best to fill you in.",
    "fighter_talk",
    [
      (try_begin),
        (eq, "$g_tutorial_training_ground_intro_message_being_displayed", 1),
        (assign, "$g_tutorial_training_ground_intro_message_being_displayed", 0),
        (tutorial_message, -1),
      (try_end),
      (assign, "$g_tutorial_fighter_talk_before", 1),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 0),
    ],
    "What do you want to practice?",
    "fighter_talk",
    []],

  [anyone, "fighter_pretalk",
    [],
    "Tell me what kind of practice you want.",
    "fighter_talk",
    []],

  [plyr|anyone, "fighter_talk",
    [],
    "I want to practice attacking.",
    "fighter_talk_train_attack",
    []],

  [plyr|anyone, "fighter_talk",
    [],
    "I want to practice blocking with my weapon.",
    "fighter_talk_train_parry",
    []],

  [plyr|anyone, "fighter_talk",
    [],
    "Let's do some sparring practice.",
    "fighter_talk_train_combat",
    []],

  [plyr|anyone, "fighter_talk",
    [
      (eq, 1, 0),
    ],
    "{!}TODO: Let's train chamber blocking.",
    "fighter_talk_train_chamber",
    []],

  [plyr|anyone, "fighter_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "fighter_talk_train_attack",
    [
      (get_player_agent_no, ":var0"),
      (agent_has_item_equipped, ":var0", "itm_practice_sword"),
    ],
    "All right. There are four principle directions for attacking. These are overhead swing, right swing, left swing and thrust. Now, I will tell you which direction to attack from and you must try to do the correct attack. ^^(Move your mouse while you press the left mouse button to specify attack direction. For example, to execute an overhead attack, move the mouse up at the instant you press the left mouse button. The icons on your screen will help you do the correct action.)",
    "fighter_talk_train_attack_2",
    []],

  [plyr|anyone, "fighter_talk_train_attack_2",
    [],
    "Let's begin then. I am ready.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_melee_trainer_attack", "$g_talk_troop"),
      (assign, "$g_tutorial_training_ground_melee_state", 0),
      (assign, "$g_tutorial_training_ground_melee_trainer_action_state", 0),
      (assign, "$g_tutorial_training_ground_current_score", 0),
      (assign, "$g_tutorial_training_ground_current_score_2", 0),
      (assign, "$g_tutorial_update_mouse_presentation", 0),
    ]],

  [plyr|anyone, "fighter_talk_train_attack_2",
    [],
    "Actually I want to do something else.",
    "fighter_pretalk",
    []],

  [anyone, "fighter_talk_train_attack",
    [
      (str_store_string, s3, "str_tutorial_training_ground_warning_no_weapon"),
    ],
    "{!}{s3}",
    "close_window",
    []],

  [anyone, "fighter_talk_train_parry",
    [
      (get_player_agent_no, ":var0"),
      (agent_has_item_equipped, ":var0", "itm_practice_sword"),
    ],
    "Unlike a shield, blocking with a weapon can only stop attacks coming from one direction. For example if you block up, you'll deflect overhead attacks, but you can still be hit by side swings or thrust attacks. ^^(You must press and hold down the right mouse button to block.)",
    "fighter_talk_train_parry_2",
    []],

  [anyone, "fighter_talk_train_parry_2",
    [],
    "I'll now attack you with different types of strokes, and I will wait until you do the correct block before attacking. Try to do the correct block as soon as you can. ^^(This practice is easy to do with the 'automatic block direction' setting which is the default. If you go to the Options menu and change defend direction control to 'mouse movement' or 'keyboard', you'll need to manually choose block direction. This is much more challenging, but makes the game much more interesting. This practice can be very useful if you use manual blocking.)",
    "fighter_talk_train_parry_3",
    []],

  [plyr|anyone, "fighter_talk_train_parry_3",
    [],
    "Let's begin then. I am ready.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_melee_trainer_parry", "$g_talk_troop"),
      (assign, "$g_tutorial_training_ground_melee_state", 0),
      (assign, "$g_tutorial_training_ground_melee_trainer_action_state", 0),
      (assign, "$g_tutorial_training_ground_current_score", 0),
    ]],

  [plyr|anyone, "fighter_talk_train_parry_3",
    [],
    "Actually I want to do something else.",
    "fighter_pretalk",
    []],

  [anyone, "fighter_talk_train_parry",
    [
      (str_store_string, s3, "str_tutorial_training_ground_warning_no_weapon"),
    ],
    "{!}{s3}",
    "close_window",
    []],

  [anyone, "fighter_talk_train_chamber",
    [
      (get_player_agent_no, ":var0"),
      (agent_has_item_equipped, ":var0", "itm_practice_sword"),
    ],
    "{!}TODO: OK.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_melee_trainer_chamber", "$g_talk_troop"),
      (assign, "$g_tutorial_training_ground_melee_state", 0),
      (assign, "$g_tutorial_training_ground_melee_trainer_action_state", 0),
      (assign, "$g_tutorial_training_ground_current_score", 0),
    ]],

  [anyone, "fighter_talk_train_chamber",
    [
      (str_store_string, s3, "str_tutorial_training_ground_warning_no_weapon"),
    ],
    "{!}{s3}",
    "close_window",
    []],

  [anyone, "fighter_talk_train_combat",
    [
      (get_player_agent_no, ":var0"),
      (agent_has_item_equipped, ":var0", "itm_practice_sword"),
    ],
    "Sparring is an excellent way to prepare for actual combat. We'll fight each other with non-lethal weapons now, until one of us falls to the ground. You can get some bruises of course, but better that than being cut down in the real thing.",
    "fighter_talk_train_combat_2",
    []],

  [plyr|anyone, "fighter_talk_train_combat_2",
    [],
    "Let's begin then. I am ready.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_melee_trainer_combat", "$g_talk_troop"),
      (assign, "$g_tutorial_training_ground_melee_state", 0),
      (assign, "$g_tutorial_training_ground_melee_trainer_action_state", 0),
    ]],

  [plyr|anyone, "fighter_talk_train_combat_2",
    [],
    "Actually I want to do something else.",
    "fighter_pretalk",
    []],

  [anyone, "fighter_talk_train_combat",
    [
      (str_store_string, s3, "str_tutorial_training_ground_warning_no_weapon"),
    ],
    "{!}{s3}",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 1),
    ],
    "Good. You were able to block my attacks successfully. You may repeat this practice and try to get faster each time, until you are confident of your defense skills. Do you want to have another go?",
    "fighter_parry_try_again",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 2),
    ],
    "Well that didn't go too well, did it? (Remember, you must press and hold down the right mouse button to keep your block effective.) Do you want to try again?",
    "fighter_parry_try_again",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [plyr|anyone, "fighter_parry_try_again",
    [],
    "Yes. Let's try again.",
    "fighter_talk_train_parry",
    []],

  [plyr|anyone, "fighter_parry_try_again",
    [],
    "No, I think I am done for now.",
    "fighter_talk_leave_parry",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 3),
    ],
    "Hey! We are doing a blocking practice, mate! You are supposed to block my attacks, not attack me back.",
    "fighter_parry_warn",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [plyr|anyone, "fighter_parry_warn",
    [],
    "I am sorry. Let's try once again.",
    "fighter_talk_train_parry",
    []],

  [plyr|anyone, "fighter_parry_warn",
    [],
    "Sorry. I must leave this practice now.",
    "fighter_talk_leave_parry",
    []],

  [anyone, "fighter_talk_leave_parry",
    [],
    "All right. As you wish.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 4),
    ],
    "Well that didn't go too well, did it? Don't feel bad, and try not to do same mistakes next time. Do you want to have a go again?",
    "fighter_combat_try_again",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [plyr|anyone, "fighter_combat_try_again",
    [],
    "Yes. Let's do another round.",
    "fighter_talk_train_combat",
    []],

  [plyr|anyone, "fighter_combat_try_again",
    [],
    "No. That was enough for me.",
    "fighter_talk_leave_combat",
    []],

  [anyone, "fighter_talk_leave_combat",
    [],
    "Well, all right. Talk to me again if you change your mind.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 5),
    ],
    "Hey, that was good sparring. You defeated me, but next time I'll be more careful. Do you want to have a go again?",
    "fighter_combat_try_again",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 8),
    ],
    "{!}TODO: What are you doing? Don't attack me except while chambering!",
    "fighter_chamber_warn",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tutorial_fighter_1", "trp_tutorial_archer_1"),
      (eq, "$g_tutorial_training_ground_conversation_state", 9),
    ],
    "Very good. You have learned how to attack from any direction you want. If you like we can try this again or move to a different exercise.",
    "fighter_talk",
    [
      (assign, "$g_tutorial_training_ground_conversation_state", 0),
    ]],

  [plyr|anyone, "fighter_chamber_warn",
    [],
    "{!}TODO: Sorry, let's try once again.",
    "fighter_talk_train_chamber",
    []],

  [auto_proceed|trp_tutorial_archer_1, "start",
    [],
    "{!}.",
    "tutorial_troop_default",
    []],

  [trp_tutorial_master_archer, "start",
    [
      (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 1),
    ],
    "Not bad. Not bad at all! You seem to have grasped the basics of archery. Now, try to do the same thing with a crossbow. Take the crossbow and the bolts over there and shoot those three targets. The crossbow is much easier to shoot with compared with the bow, but you need to reload it after each shot.",
    "archer_challenge_2",
    []],

  [trp_tutorial_master_archer, "start",
    [
      (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 2),
    ],
    "Good. You didn't have too much difficulty using the crossbow either. Next you will learn to use throwing weapons. Pick up the javelins you see over there and try to hit those three targets. ",
    "archer_challenge_2",
    []],

  [trp_tutorial_master_archer, "start",
    [
      (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 3),
    ],
    "Well, with that you have received the basic skills to use all three types of ranged weapons. The rest will come with practice. Train each and every day, and in time you will be as good as the best marksmen in Pendor.",
    "ranged_end",
    []],

  [trp_tutorial_master_archer, "ranged_end",
    [],
    "Now, you can go talk with the melee fighters or the horsemanship trainer if you haven't already done so. They can teach you important skills too.",
    "close_window",
    []],

  [trp_tutorial_master_archer, "start",
    [
      (try_begin),
        (eq, "$g_tutorial_training_ground_intro_message_being_displayed", 1),
        (assign, "$g_tutorial_training_ground_intro_message_being_displayed", 0),
        (tutorial_message, -1),
      (try_end),
    ],
    "Good day to you, young fellow. I spend my days teaching about ranged weapons to anyone that is willing to learn. If you need a tutor, let me know and I'll teach you how to use the bow, the crossbow and the javelin.",
    "archer_talk",
    []],

  [plyr|anyone, "archer_talk",
    [
      (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 0),
    ],
    "Yes, show me how to use ranged weapons.",
    "archer_challenge",
    []],

  [plyr|anyone, "archer_talk",
    [],
    "No, not now.",
    "close_window",
    []],

  [trp_tutorial_master_archer, "archer_challenge",
    [
      (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 0),
    ],
    "All right. Your first training will be in archery. The bow is a difficult weapon to master. But once you are sufficiently good at it, you can shoot quickly and with great power. Go pick up the bow and arrows you see over there now and shoot those targets.",
    "archer_challenge_2",
    []],

  [plyr|anyone, "archer_challenge_2",
    [],
    "All right. I am ready.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_archer_trainer_state", 1),
      (try_begin),
        (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 0),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_1", "itm_practice_bow"),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_2", "itm_practice_arrows"),
      (else_try),
        (eq, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 1),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_1", "itm_practice_crossbow"),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_2", "itm_practice_bolts"),
      (else_try),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_1", "itm_practice_javelin"),
        (assign, "$g_tutorial_training_ground_archer_trainer_item_2", -1),
      (try_end),
    ]],

  [plyr|anyone, "archer_challenge_2",
    [],
    "Just a minute. I want to do something else first.",
    "close_window",
    []],

  [trp_tutorial_master_horseman, "start",
    [
      (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 1),
    ],
    "I hope you enjoyed the ride. Now we move on to something a bit more difficult. Grab the lance you see over there and ride around the course hitting each target at least once.",
    "horseman_melee_challenge_2",
    []],

  [trp_tutorial_master_horseman, "start",
    [
      (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 2),
    ],
    "Good! You have been able to hit all targets on horseback. That's no easy feat for a starter. Your next challange will be using a bow and arrows to shoot at the archery targets by the road. You need to put an arrow to each target to consider yourself successful.",
    "horseman_melee_challenge_2",
    []],

  [trp_tutorial_master_horseman, "start",
    [
      (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 3),
    ],
    "Very good. You were able to shoot all targets from horseback. Keep riding and practicing each day and in time you will be an expert horseman.",
    "horsemanship_end",
    []],

  [trp_tutorial_master_horseman, "horsemanship_end",
    [],
    "Now, you can go talk with the melee fighters or the archery trainer if you haven't already done so. You need to learn everything you can to be prepared when you have to defend yourself.",
    "close_window",
    []],

  [trp_tutorial_master_horseman, "start",
    [
      (try_begin),
        (eq, "$g_tutorial_training_ground_intro_message_being_displayed", 1),
        (assign, "$g_tutorial_training_ground_intro_message_being_displayed", 0),
        (tutorial_message, -1),
      (try_end),
    ],
    "Good day! I have come here for some riding practice, but my old bones are aching badly so I decided to give myself a rest today. If you would like to practice your horsemanship, you can take my horse here. The exercise would be good for her.",
    "horseman_talk",
    []],

  [plyr|anyone, "horseman_talk",
    [],
    "Yes, I would like to practice riding.",
    "horseman_challenge",
    []],

  [plyr|anyone, "horseman_talk",
    [],
    "Uhm. Maybe later.",
    "close_window",
    []],

  [trp_tutorial_master_horseman, "horseman_challenge",
    [
      (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 0),
    ],
    "Good. Now, I will give you a few exercises that'll teach you riding and horseback weapon use. Your first assignment is simple. Just take your horse for a ride around the course. Go as slow or as fast as you like. Come back when you feel confident as a rider and I'll give you some tougher exercises.",
    "horseman_melee_challenge_2",
    []],

  [plyr|anyone, "horseman_melee_challenge_2",
    [],
    "All right. I am ready.",
    "close_window",
    [
      (assign, "$g_tutorial_training_ground_horseman_trainer_state", 1),
      (try_begin),
        (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 0),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_1", -1),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_2", -1),
      (else_try),
        (eq, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 1),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_1", "itm_arena_lance"),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_2", -1),
      (else_try),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_1", "itm_practice_bow_2"),
        (assign, "$g_tutorial_training_ground_horseman_trainer_item_2", "itm_practice_arrows_2"),
      (try_end),
    ]],

  [plyr|anyone, "horseman_melee_challenge_2",
    [],
    "Just a minute. I need to do something else first.",
    "close_window",
    []],

  [auto_proceed|trp_tutorial_rider_1, "start",
    [],
    "{!}Warning: This line is never displayed.",
    "tutorial_troop_default",
    []],

  [auto_proceed|trp_tutorial_rider_2, "start",
    [],
    "{!}Warning: This line is never displayed.",
    "tutorial_troop_default",
    []],

  [anyone, "tutorial_troop_default",
    [
      (try_begin),
        (eq, "$g_tutorial_training_ground_intro_message_being_displayed", 1),
        (assign, "$g_tutorial_training_ground_intro_message_being_displayed", 0),
        (tutorial_message, -1),
      (try_end),
    ],
    "Hey, I am trying to practice here. Go, talk with the archery trainer if you need guidance about ranged weapons.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 18),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
      (troop_slot_ge, "$g_talk_troop", 149, 1),
    ],
    "Is there a change of plans?",
    "lord_prison_break_confirm_3",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 18),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg0, "$g_talk_troop"),
        (assign, reg1, "$g_encountered_party"),
        (troop_get_slot, reg2, "$g_talk_troop", 8),
        (display_message, "@{!}g talk troop = {reg0} , g encountered party = {reg1} , slot value = {reg2}"),
      (try_end),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
    ],
    "What's going on?",
    "lord_prison_break",
    []],

  [anyone, "start",
    [
      (eq, "$g_talk_troop", "trp_belligerent_drunk"),
    ],
    "What are you looking at?",
    "drunk_response",
    [
      (try_begin),
        (eq, "$g_main_attacker_agent", 0),
        (call_script, "script_activate_tavern_attackers"),
      (try_end),
      (mission_disable_talk),
    ]],

  [anyone, "start",
    [
      (eq, "$g_talk_troop", "trp_hired_assassin"),
    ],
    "Are you looking at me?",
    "drunk_response",
    [
      (try_begin),
        (eq, "$g_main_attacker_agent", 0),
        (call_script, "script_activate_tavern_attackers"),
      (try_end),
      (mission_disable_talk),
    ]],

  [anyone, "start",
    [
      (eq, "$g_talk_troop", "trp_hired_assassin"),
      (eq, 1, 0),
    ],
    "{!}Added to match dialog ids with translations.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_tavernkeeper", "trp_town_1_merchant"),
      (gt, "$g_main_attacker_agent", 0),
      (neg|agent_is_alive, "$g_main_attacker_agent"),
      (store_character_level, ":var0", "trp_player"),
      (try_begin),
        (neg|agent_is_alive, "$g_main_attacker_agent"),
        (agent_get_troop_id, ":var1", "$g_main_attacker_agent"),
        (eq, ":var1", "trp_hired_assassin"),
        (str_store_string, s9, "str_strange_that_one_didnt_seem_like_your_ordenary_troublemaker_he_didnt_drink_all_that_much__he_just_stood_there_quietly_and_watched_the_door_you_may_wish_to_consider_whether_you_have_any_enemies_who_know_you_are_in_town_a_pity_that_blood_had_to_be_spilled_in_my_establishment"),
        (assign, "$g_main_attacker_agent", 0),
        (add_xp_as_reward, 250),
        (try_begin),
          (ge, ":var0", 30),
          (troop_add_gold, "trp_player", 1000),
        (else_try),
          (is_between, ":var0", 20, 30),
          (troop_add_gold, "trp_player", 800),
        (else_try),
          (is_between, ":var0", 10, 20),
          (troop_add_gold, "trp_player", 600),
        (else_try),
          (troop_add_gold, "trp_player", 400),
        (try_end),
        (troop_add_item, "trp_player", "itm_sword_viking_1", imod_plain),
      (else_try),
        (lt, "$g_attacker_drawn_weapon", "itm_tutorial_spear"),
        (str_store_string, s9, "str_you_never_let_him_draw_his_weapon_still_it_looked_like_he_was_going_to_kill_you_take_his_sword_and_purse_i_suppose_he_was_trouble_but_its_not_good_for_an_establishment_to_get_a_name_as_a_place_where_men_are_killed"),
        (assign, "$g_main_attacker_agent", 0),
        (troop_add_gold, "trp_player", 50),
        (troop_add_item, "trp_player", "itm_sword_viking_1", imod_plain),
        (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -1),
      (else_try),
        (neg|agent_is_alive, "$g_main_attacker_agent"),
        (str_store_string, s9, "str_well_id_say_that_he_started_it_that_entitles_you_to_his_sword_and_purse_i_suppose_have_a_drink_on_the_house_as_i_daresay_youve_saved_a_patron_or_two_a_broken_skull_still_i_hope_he_still_has_a_pulse_its_not_good_for_an_establishment_to_get_a_name_as_a_place_where_men_are_killed"),
        (assign, "$g_main_attacker_agent", 0),
        (store_random_in_range, ":var2", 0, 100),
        (try_begin),
          (ge, ":var0", 30),
          (add_xp_as_reward, 450),
          (try_begin),
            (lt, ":var2", 50),
            (assign, ":var3", "itm_morningstar"),
            (troop_add_gold, "trp_player", 400),
          (else_try),
            (lt, ":var2", 99),
            (assign, ":var3", "itm_fierd_war_axe"),
            (troop_add_gold, "trp_player", 500),
          (else_try),
            (assign, ":var3", "itm_strange_sword"),
            (troop_add_gold, "trp_player", 100),
          (try_end),
        (else_try),
          (is_between, ":var0", 20, 30),
          (add_xp_as_reward, 300),
          (try_begin),
            (lt, ":var2", 35),
            (assign, ":var3", "itm_bastard_sword_a"),
            (troop_add_gold, "trp_player", 300),
          (else_try),
            (lt, ":var2", 70),
            (assign, ":var3", "itm_military_pick"),
            (troop_add_gold, "trp_player", 200),
          (else_try),
            (assign, ":var3", "itm_sword_medieval_d_long"),
            (troop_add_gold, "trp_player", 250),
          (try_end),
        (else_try),
          (is_between, ":var0", 10, 20),
          (add_xp_as_reward, 150),
          (try_begin),
            (lt, ":var2", 50),
            (assign, ":var3", "itm_cavalry_club"),
            (troop_add_gold, "trp_player", 100),
          (else_try),
            (lt, ":var2", 75),
            (assign, ":var3", "itm_scimitar_b"),
            (troop_add_gold, "trp_player", 150),
          (else_try),
            (assign, ":var3", "itm_sword_medieval_b"),
            (troop_add_gold, "trp_player", 200),
          (try_end),
        (else_try),
          (troop_add_gold, "trp_player", 50),
          (add_xp_as_reward, 50),
          (assign, ":var3", "itm_sword_viking_1"),
        (try_end),
        (troop_add_item, "trp_player", ":var3", imod_plain),
        (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 1),
        (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (try_end),
      (troop_set_slot, "trp_hired_assassin", 12, -1),
    ],
    "{!}{s9}",
    "player_duel_response",
    []],

  [plyr|anyone, "player_duel_response",
    [],
    "Such a waste...",
    "close_window",
    []],

  [plyr|anyone, "player_duel_response",
    [],
    "Better him than me",
    "close_window",
    []],

  [plyr|anyone, "drunk_response",
    [],
    "I'm not sure... Some sort of animal, clearly",
    "drunk_fight_start",
    []],

  [plyr|anyone, "drunk_response",
    [],
    "Excuse me, please accept my apologies",
    "drunk_fight_start",
    []],

  [anyone, "drunk_fight_start",
    [],
    "I'll wipe that smirk right off your face!",
    "close_window",
    [
      (troop_set_slot, "trp_belligerent_drunk", 12, 0),
    ]],

  [plyr|anyone, "drunk_response",
    [
      (troop_slot_ge, "trp_player", 7, 1000),
    ],
    "Do you have any idea who I am?",
    "drunk_player_high_renown",
    []],

  [anyone, "drunk_player_high_renown",
    [
      (eq, "$g_talk_troop", "trp_hired_assassin"),
    ],
    "Do I care?",
    "drunk_fight_start",
    []],

  [anyone, "drunk_player_high_renown",
    [],
    "Emmm... Actually... Yes, yes, I do know who you are, {reg63?sir:madame}. Please forgive me, your grace, it must be the drink. I'll be leaving, now...",
    "drunk_player_high_renown_1",
    []],

  [plyr|anyone, "drunk_player_high_renown_1",
    [],
    "Why, if you want a fight, you shall have one!",
    "drunk_fight_start",
    []],

  [plyr|anyone, "drunk_player_high_renown_1",
    [],
    "Now, remove yourself from here. [no more tavern fights]",
    "close_window",
    [
      (assign, "$drunks_dont_pick_fights", 1),
      (troop_set_slot, "trp_belligerent_drunk", 12, 0),
      (call_script, "script_deactivate_tavern_attackers"),
      (assign, "$g_belligerent_drunk_leaving", "$g_main_attacker_agent"),
      (mission_enable_talk),
      (try_for_agents, ":var0"),
        (agent_is_alive, ":var0"),
        (agent_get_position, pos4, ":var0"),
        (agent_set_scripted_destination, ":var0", pos4),
      (try_end),
      (entry_point_get_position, pos1, 0),
      (agent_set_scripted_destination, "$g_main_attacker_agent", pos1),
      (assign, "$g_main_attacker_agent", 0),
    ]],

  [anyone, "start",
    [
      (eq, "$g_talk_troop", "trp_fight_promoter"),
    ],
    "You look like a {reg63?fellow:lady} who can take a few hard knocks -- and deal them out, too. I have a business proposition for you.",
    "fistfight_response",
    []],

  [plyr|anyone, "fistfight_response",
    [],
    "How's that?",
    "fistfight_response_2",
    []],

  [anyone, "fistfight_response_2",
    [],
    "Good -- I'm glad you're interested. Here's the plan... It's a little complicated, so listen well. ",
    "fistfight_response_2a",
    []],

  [anyone, "fistfight_response_2a",
    [],
    "You and this other fellow will start up a fight here. No weapons, no armor -- I'll sit back and take bets, and split the profits with the winner. If we make a loss, then I'll cover it. You've got nothing to lose -- except a bit of blood, of course.",
    "fistfight_response_3",
    []],

  [anyone, "fistfight_response_3",
    [],
    "However, we can't organize this like one of those nice arena bouts, where everyone places their bets beforehand. People will walk in, drawn by the noise, and put a denar or two on whichever one of your two they think is winning. I'll give 'em even odds -- anything else is going to be too tricky for someone who's already on his third flagon of ale.",
    "fistfight_response_4",
    []],

  [anyone, "fistfight_response_4",
    [],
    "So, as you can see, the trick is to stretch things out for as long as possible where it looks like you're losing, and people bet against you -- and then come back fast, and win, before the betting can turn. The best way to make money is for you to be battered almost to the floor, and then jump back off your feet and take the other guy down. However, you have to win in the end in order for me, and you, to make money. ",
    "fistfight_response_4a",
    []],

  [anyone, "fistfight_response_4a",
    [],
    "Also, you can't stretch the fight out too long, or people will suspect a fix. So, one of you has to take a punch every so often. I don't care whose blood is spilled, but there has to be some blood.",
    "fistfight_response_5",
    []],

  [anyone, "fistfight_response_5",
    [],
    "And one other thing -- my mate, your opponent, he doesn't take to well to complexity. So he's just going to come straight at you. It's up to you to supply the artistry.",
    "fistfight_response_5a",
    []],

  [anyone, "fistfight_response_5a",
    [],
    "So, what do you think?",
    "fistfight_response_confirm",
    []],

  [plyr|anyone, "fistfight_response_confirm",
    [],
    "{!}[Yes -- not yet implemented]",
    "close_window",
    []],

  [plyr|anyone, "fistfight_response_confirm",
    [],
    "I have better things to do",
    "close_window",
    []],

  [trp_ramun_the_slave_trader, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Good day to you, {reg63?young man:lassie}.",
    "ramun_introduce_1",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_1",
    [],
    "Forgive me, you look like a trader, but I see none of your merchandise.",
    "ramun_introduce_2",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_1",
    [],
    "Never mind.",
    "close_window",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_2",
    [],
    "A trader? Oh, aye, I certainly am that. My merchandise is a bit different from most, however. It has to be fed and watered twice a day and tries to run away if I turn my back.",
    "ramun_introduce_3",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_3",
    [],
    "Livestock?",
    "ramun_introduce_4",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_4",
    [],
    "Livestock? HAHA! You are not from around here are you? I am the Prince of Singal! No, not like Royality, but a Prince of Flesh. Slave Flesh!  Everyone needs slaves. Those who need oarsmen to row the Triremes; those who need fighters for the arenas; those who need,... subtle diversions. I supply them all! ",
    "ramun_introduce_5",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_5",
    [],
    "People? You trade in people?",
    "ramun_introduce_6",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_6",
    [],
    "No, not People, that would be immoral. I trade in Slaves.  Quite a difference you see. Singal is the center of the Slave Trade and I am the center of Singal!' The Red Brotherhood are good partners for the purchase and selling of flesh. So are hungry sheiks who are weary of their four wives, as are northern lords who need a man with a sword to train their recruits with. They all pay well.",
    "ramun_introduce_7",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_7",
    [],
    "Where do the slaves come from?",
    "ramun_introduce_8",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_8",
    [],
    "Mostly I deal in convicted criminals bought from the authorities. Some are from raiders, but lets not talk about that; there are ears everywhere. Others are prisoners of war from various nations, brought to me because I offer the best prices. However, on occasion I'll buy from privateers and other... 'individuals'. You can't be picky about your suppliers in this line of work. You wouldn't happen to have any prisoners with you, would you?",
    "ramun_introduce_9",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_9",
    [],
    "Me? ",
    "ramun_introduce_10",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_10",
    [],
    "Why not? If you intend to set foot outside this town, you're going to cross swords with someone sooner or later. And, fate willing, you'll come out on top. Why not make some extra money off the whole thing? Take them alive, bring them back to me, and I'll pay you well for each head. Don't much care who they are or where they come from.",
    "ramun_introduce_11",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_introduce_11",
    [],
    "Hmm. I'll think about it.",
    "ramun_introduce_12",
    []],

  [trp_ramun_the_slave_trader, "ramun_introduce_12",
    [],
    "Yes, do think about it! There's a lot of denars to be made, no mistake. More than enough for the both of us.",
    "close_window",
    []],

  [trp_ramun_the_slave_trader, "start",
    [],
    "Hello, {playername}.",
    "ramun_talk",
    []],

  [trp_ramun_the_slave_trader, "ramun_pre_talk",
    [],
    "Anything else?",
    "ramun_talk",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [
      (store_num_regular_prisoners, reg0),
      (ge, reg0, 1),
    ],
    "I've brought you some prisoners, Ramun. Would you like a look?",
    "ramun_sell_prisoners",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [
      (store_num_regular_prisoners, reg0),
      (ge, reg0, 1),
    ],
    "I've brought you some prisoners, Ramun, and I'd like to sell them all.",
    "ramun_sell_prisoners_all",
    []],

  [trp_ramun_the_slave_trader, "ramun_sell_prisoners",
    [],
    "Let me see what you have...",
    "ramun_sell_prisoners_2",
    [
      (change_screen_trade_prisoners),
    ]],

  [anyone, "ramun_sell_prisoners_all",
    [],
    "Let me see what you have...",
    "ramun_sell_prisoners_2",
    [
      (call_script, "script_sell_all_prisoners"),
    ]],

  [trp_ramun_the_slave_trader, "ramun_sell_prisoners_2",
    [],
    "A pleasure doing business with you. {s12}",
    "close_window",
    [
      (str_clear, s12),
      (assign, ":var0", -1),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var2", 82, 0),
        (troop_slot_ge, ":var2", 12, 1),
        (val_add, ":var1", 1),
      (try_end),
      (gt, ":var1", 0),
      (val_add, ":var1", 1),
      (store_random_in_range, ":var3", 1, ":var1"),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var2", 82, 0),
        (troop_slot_ge, ":var2", 12, 1),
        (val_sub, ":var3", 1),
        (eq, ":var3", 0),
        (assign, ":var0", ":var2"),
      (try_end),
      (troop_get_slot, ":var4", ":var0", 12),
      (str_store_troop_name, s11, ":var0"),
      (str_store_party_name, s10, ":var4"),
      (troop_get_type, reg1, ":var0"),
      (str_store_string, s12, "@^It might interest you that someone called {s11} is looking for work in {s10}, you may want to meet {reg1?her:him} there."),
    ]],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 80, 1),
    ],
    "How do I take somebody as prisoner?",
    "ramun_ask_about_capturing",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 80, 1),
    ],
    "Can you tell me again about capturing prisoners?",
    "ramun_ask_about_capturing",
    [
      (troop_set_slot, "$g_talk_troop", 80, 2),
    ]],

  [trp_ramun_the_slave_trader, "ramun_ask_about_capturing",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 80, 1),
    ],
    "You're new to this, aren't you? Let me explain it in simple terms. The basic rule of taking someone prisoner is knocking him down with a blunt weapon, like a mace or a club, rather than cutting him open with a sword. That way he goes to sleep for a little while rather than bleeding to death, you see? I'm assuming you have a blunt weapon with you...",
    "ramun_have_blunt_weapon",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_have_blunt_weapon",
    [],
    "Of course.",
    "ramun_have_blunt_weapon_yes",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_have_blunt_weapon",
    [],
    "As a matter of fact, I don't.",
    "ramun_have_blunt_weapon_no",
    []],

  [trp_ramun_the_slave_trader, "ramun_have_blunt_weapon_yes",
    [],
    "Good. Then all you need to do is beat the bugger down with your weapon, and when the fighting's over you clap him in irons. It's a bit different for nobles and such, they tend to be protected enough that it won't matter what kind of weapon you use, but your average rabble-rouser will bleed like a stuck pig if you get him with something sharp. I don't have many requirements in my merchandise, but I do insist they be breathing when I buy them.",
    "ramun_ask_about_capturing_2",
    []],

  [trp_ramun_the_slave_trader, "ramun_have_blunt_weapon_no",
    [],
    "No? Heh, well, this must be your lucky day. I've got an old club lying around that I was going to throw away. It a bit battered, but still good enough bash someone until he stops moving. Here, have it.",
    "ramun_have_blunt_weapon_no_2",
    [
      (troop_add_item, "trp_player", "itm_club", imod_cracked),
    ]],

  [plyr|trp_ramun_the_slave_trader, "ramun_have_blunt_weapon_no_2",
    [],
    "Thanks, Ramun. Perhaps I may try my hand at it.",
    "ramun_have_blunt_weapon_yes",
    []],

  [trp_ramun_the_slave_trader, "ramun_ask_about_capturing",
    [],
    "Alright, I'll try and expain it again in simple terms. The basic rule of taking someone prisoner is knocking him down with a blunt weapon, like a mace or a club, rather than cutting him open with a sword. That way he goes to sleep for a little while rather than bleeding to death, you see? It's a bit different for nobles and such, they tend to be protected enough that it won't matter what kind of weapon you use, but your average rabble-rouser will bleed like a stuck pig if you get him with something sharp.",
    "ramun_ask_about_capturing_2",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_ask_about_capturing_2",
    [],
    "Alright, I think I understand. Anything else?",
    "ramun_ask_about_capturing_3",
    []],

  [trp_ramun_the_slave_trader, "ramun_ask_about_capturing_3",
    [],
    "Well, it's not as simple as all that. Blunt weapons don't do as much damage as sharp ones, so they won't bring your enemies down as quickly. And trust me, given the chance, most of the scum you run across would just as soon kill you as look at you, so don't expect any courtesy when you pull out a club instead of a sword. Moreover, having to drag prisoners to and fro will slow down your party, which is why some people simply set their prisoners free after the fighting's done. It's madness. How could anyone turn down all that silver, eh?",
    "ramun_ask_about_capturing_4",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_ask_about_capturing_4",
    [],
    "Is that everything?",
    "ramun_ask_about_capturing_5",
    []],

  [trp_ramun_the_slave_trader, "ramun_ask_about_capturing_5",
    [],
    "Just one final thing. Managing prisoners safely is not an easy thing to do, you could call it a skill in itself. If you want to capture a lot of prisoners, you should try and learn the tricks of it yourself, or you won't be able to hang on to a single man you catch.",
    "ramun_ask_about_capturing_7",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_ask_about_capturing_7",
    [],
    "Thanks, I'll keep it in mind.",
    "ramun_pre_talk",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [
      (eq, "$event_rand_3_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 10),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "Ramun, care to participate in a game of chance?",
    "ramun_casino_1",
    []],

  [trp_ramun_the_slave_trader, "ramun_casino_1",
    [
      (ge, "$event_rand_3", 50),
    ],
    "Ha! I am most certain that fortune is on my side!",
    "ramun_casino_2",
    [
      (assign, "$event_rand_3_can_ask", 0),
    ]],

  [trp_ramun_the_slave_trader, "ramun_casino_1",
    [
      (lt, "$event_rand_3", 50),
    ],
    "I must pass, I have not had much luck this week.",
    "ramun_talk",
    [
      (assign, "$event_rand_3_can_ask", 0),
    ]],

  [trp_ramun_the_slave_trader, "ramun_casino_2",
    [
      (assign, reg35, -1),
      (assign, reg36, -1),
      (try_begin),
        (lt, "$event_rand_1b", 30),
      (else_try),
        (lt, "$event_rand_1b", 35),
        (assign, reg35, "trp_iron_circle_centurian"),
      (else_try),
        (lt, "$event_rand_1b", 40),
        (assign, reg35, "trp_empire_guardian_knight"),
      (else_try),
        (lt, "$event_rand_1b", 45),
        (assign, reg35, "trp_valdis_huscarl"),
      (else_try),
        (lt, "$event_rand_1b", 50),
        (assign, reg35, "trp_veccavi_uncut"),
      (else_try),
        (lt, "$event_rand_1b", 55),
        (assign, reg35, "trp_iceguard_ranger"),
      (else_try),
        (lt, "$event_rand_1b", 60),
        (assign, reg35, "trp_noldor_hunter"),
      (else_try),
        (lt, "$event_rand_1b", 68),
        (assign, reg35, "trp_marleons_cavalry"),
      (else_try),
        (lt, "$event_rand_1b", 76),
        (assign, reg35, "trp_dshar_djaha"),
      (else_try),
        (lt, "$event_rand_1b", 84),
        (assign, reg35, "trp_dshar_deathwind"),
      (else_try),
        (lt, "$event_rand_1b", 92),
        (assign, reg35, "trp_red_fletcher_renegade"),
      (else_try),
        (assign, reg35, "trp_vanskery_agnus_freebooters"),
      (try_end),
      (try_begin),
        (lt, "$event_rand_1b", 60),
        (store_mod, ":var0", "$event_rand_1a", 3),
        (val_add, ":var0", 2),
        (val_clamp, ":var0", 2, 5),
      (else_try),
        (store_mod, ":var0", "$event_rand_1a", 4),
        (val_add, ":var0", 3),
        (val_clamp, ":var0", 3, 7),
      (try_end),
      (assign, reg36, ":var0"),
      (try_begin),
        (eq, reg35, -1),
        (assign, ":var1", 1000),
      (else_try),
        (call_script, "script_game_get_join_cost_selectable", reg35, 125, 100),
        (store_mul, ":var1", reg0, ":var0"),
      (try_end),
      (store_mod, ":var2", "$event_rand_0", 31),
      (val_abs, ":var2"),
      (val_add, ":var2", 0),
      (val_clamp, ":var2", 0, 31),
      (assign, ":var3", "$event_rand_0"),
      (val_abs, ":var3"),
      (try_begin),
        (lt, ":var3", 50),
        (store_sub, ":var2", 100, ":var2"),
      (else_try),
        (store_add, ":var2", 100, ":var2"),
      (try_end),
      (val_mul, ":var1", ":var2"),
      (val_div, ":var1", 100),
      (assign, reg37, ":var1"),
    ],
    "The stakes are this: I will sell you peculiar slaves from parts of Pendor for {reg37} denars. Otherwise, I will take your gambled coin. ^^Shall we begin ... or you going to turn tail and run?",
    "ramun_casino_3",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_casino_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg37),
    ],
    "Let the dice be cast.",
    "ramun_casino_4",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_casino_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg37),
    ],
    "These dice feel a bit strange to me ... I pass.",
    "close_window",
    []],

  [plyr|trp_ramun_the_slave_trader, "ramun_casino_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", reg37),
    ],
    "Your bid is too high form me. I pass.",
    "ramun_leave",
    []],

  [trp_ramun_the_slave_trader, "ramun_casino_4",
    [
      (eq, reg35, -1),
    ],
    "You should have listened to old Ramun! Luck is indeed in my favor!",
    "ramun_leave",
    [
      (troop_remove_gold, "trp_player", reg37),
    ]],

  [trp_ramun_the_slave_trader, "ramun_casino_4",
    [
      (neq, reg35, -1),
    ],
    "It seems I have been bested in this game of chance, how unfortunate. The slaves will be brought to you shortly.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg37),
      (party_add_members, "p_main_party", reg35, reg36),
      (str_store_troop_name, s0, reg35),
      (display_log_message, "@{reg36}x {s0} have joined you party"),
    ]],

  [plyr|trp_ramun_the_slave_trader, "ramun_talk",
    [],
    "I'd better be going.",
    "ramun_leave",
    []],

  [trp_ramun_the_slave_trader, "ramun_leave",
    [],
    "Remember, any prisoners you've got, bring them to me. I'll pay you good silver for every one.",
    "close_window",
    []],

  [trp_nurse_for_lady, "start",
    [],
    "I humbly request that your lordship keeps his hands where I can see them.",
    "close_window",
    []],

  [party_tpl|pt_militia, "start",
    [
      (eq, "$talk_context", 2),
      (encountered_party_is_attacker),
    ],
    "Cursed robber {reg63?Lord:Lady}! We had enough of you praying on our villages!",
    "close_window",
    []],

  [party_tpl|pt_militia, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "{s4}",
    "manhunter_talk_b",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (str_store_party_name, s11, ":var0"),
      (store_random_in_range, ":var1", 0, 3),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s4, "@ Hail Captain!"),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@ Hail {reg63?M'Lord:M'Lady}!"),
      (else_try),
        (str_store_string, s4, "@ Well met, {reg63?M'Lord:M'Lady}!"),
      (try_end),
      (store_random_in_range, ":var1", 0, 4),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s4, "@ {s4} We are the Militia Patrol out of {s11}."),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@ {s4} You are a welcome sight for weary eyes. We hail from {s11}."),
      (else_try),
        (eq, ":var1", 3),
        (str_store_string, s4, "@ {s4} We are the sheriff patrol riding out from {s11}."),
      (else_try),
        (str_store_string, s4, "@ {s4} We are glad to see you! We ride from {s11}."),
      (try_end),
      (store_random_in_range, ":var1", 0, 4),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s4, "@ {s4} We have had a rough time of it, {reg63?M'Lord:M'lady}, avoiding enemy Lords and raiding parties. We are searching for thugs and bandits."),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@ {s4} We are on the lookout for outlaws, your {reg63?Lordship:Ladyship}."),
      (else_try),
        (eq, ":var1", 3),
        (str_store_string, s4, "@ {s4} We set out days ago looking for the vermin who murdered one of our landowners."),
      (else_try),
        (str_store_string, s4, "@ {s4} Our horses are tired as are we, {reg63?M'Lord:M'lady}. Yet justice still calls us onward to find those responsible for crimes most vile."),
      (try_end),
    ]],

  [plyr|party_tpl|pt_militia, "manhunter_talk_b",
    [],
    "Well met, valiant Militia! What news can you share?",
    "manhunter_talk_b1",
    []],

  [party_tpl|pt_militia, "manhunter_talk_b1",
    [],
    "{s4}",
    "manhunter_talk_b2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 300),
      (val_add, ":var0", 2),
      (store_current_day, ":var1"),
      (try_begin),
        (gt, ":var0", ":var1"),
        (store_random_in_range, ":var2", 0, 4),
        (try_begin),
          (eq, ":var2", 1),
          (str_store_string, s4, "@ No {reg63?M'Lord:M'Lady}, we have seen very little of interest, except a nice seven point stag I was tempted to bag."),
        (else_try),
          (eq, ":var2", 2),
          (str_store_string, s4, "@ I wish we had something to share, your {reg63?Lordship:Ladyship}. Our eyes have been on catching those bandits and we have seen little else."),
        (else_try),
          (eq, ":var2", 3),
          (str_store_string, s4, "@ No {reg63?M'Lord:M'Lady}, we have not seen nor heard of anything unusual during our expedition."),
        (else_try),
          (str_store_string, s4, "@ Nothing except to keep your wits about you, {reg63?M'Lord:M'Lady}. These are dangerous times and desperate men can be unpredictable."),
        (try_end),
      (else_try),
        (party_get_slot, ":var3", "$g_encountered_party", 123),
        (party_get_slot, ":var4", ":var3", 61),
        (call_script, "script_main_scenario_external", ":var4"),
        (party_set_slot, "$g_encountered_party", 300, ":var1"),
      (try_end),
    ]],

  [plyr|party_tpl|pt_militia, "manhunter_talk_b",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (party_slot_eq, ":var0", 7, "trp_player"),
      (party_get_num_companions, ":var1", "$g_encountered_party"),
      (lt, ":var1", 100),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to give some troops to you.",
    "militia_give_troops",
    []],

  [anyone, "militia_give_troops",
    [],
    "Blessings upon you {reg63?M'Lord:M'Lady}, we can always use more men. (max 100)",
    "militia_give_troops_continue",
    [
      (change_screen_give_members, "$g_encountered_party"),
    ]],

  [anyone, "militia_give_troops_continue",
    [],
    "Anything else, {reg63?M'Lord:M'Lady}?",
    "manhunter_talk_b",
    []],

  [plyr|party_tpl|pt_militia, "manhunter_talk_b",
    [],
    "Good for you. Carry on with your mission!",
    "manhunter_talk_b2",
    []],

  [plyr|party_tpl|pt_militia, "manhunter_talk_b",
    [
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (lt, ":var0", 0),
    ],
    "Well, you just met your last outlaws, now draw steel.",
    "close_window",
    [
      (call_script, "script_change_player_honor", -1),
      (encounter_attack),
    ]],

  [party_tpl|pt_militia, "manhunter_talk_b2",
    [],
    "Thank you, your {reg63?Lordship:Ladyship}. Come on Men! Onward!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (party_slot_eq, ":var0", 7, "trp_player"),
      (party_get_num_companions, ":var1", "$g_encountered_party"),
      (gt, ":var1", 100),
      (party_get_num_companions, ":var1", "$g_encountered_party"),
      (store_sub, ":var2", ":var1", 100),
      (party_get_num_companion_stacks, ":var3", "$g_encountered_party"),
      (try_for_range_backwards, ":var4", 0, ":var3"),
        (party_stack_get_troop_id, ":var5", "$g_encountered_party", ":var4"),
        (party_stack_get_size, ":var6", "$g_encountered_party", ":var4"),
        (try_begin),
          (le, ":var6", ":var2"),
          (party_remove_members, "$g_encountered_party", ":var5", ":var6"),
          (val_sub, ":var2", ":var6"),
        (else_try),
          (party_remove_members, "$g_encountered_party", ":var5", ":var2"),
          (assign, ":var2", 0),
        (try_end),
        (try_begin),
          (le, ":var2", 0),
          (assign, ":var3", 0),
        (try_end),
      (try_end),
      (display_message, "@Your patrol leader is not skilled enough to command that many soldiers. For the time being some of them will be sent away to help nearby villagers."),
    ]],

  [party_tpl|auto_proceed|pt_cb5_results, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 10, 15),
      (try_begin),
        (this_or_next|eq, "$background_answer_5", 48),
        (eq, "$background_answer_5", 50),
        (str_store_string, s4, "@  Ah We have you at last!"),
      (else_try),
        (this_or_next|eq, "$background_answer_5", 25),
        (eq, "$background_answer_5", 26),
        (str_store_string, s4, "@ You! Here?! Who would have thought you had it in you? Come, then! Let us dance over the sweet memories of your lover. Mine are quite sweet, let me tell you!"),
      (else_try),
        (eq, "$background_answer_5", 31),
        (str_store_string, s4, "@ You! I thought I had given you the slip!"),
      (else_try),
        (eq, "$background_answer_5", 27),
        (str_store_string, s4, "@ Ha! Come to take revenge for your sweetheart? You will taste my cold steel instead! Die now!"),
      (else_try),
        (eq, "$background_answer_5", 28),
        (str_store_string, s4, "@ You! Fie this day! It was just business, see... no one was suppose to get hurt! Oh Damn... now I have to kill you! See what you made me do!?"),
      (else_try),
        (str_store_string, s4, "@ Finally... now you shall join your ancestors in hell!"),
      (try_end),
      (try_begin),
        (lt, reg1, 11),
        (play_sound, "snd_han_oi_what_do_we_have_here_02"),
        (str_store_string, s4, "@ Oi! What do we have here? {s4}"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_lt_what_this_eh"),
        (str_store_string, s4, "@ What's this, eh? {s4}"),
      (else_try),
        (play_sound, "snd_encounter_sb_hunt_u_down"),
        (str_store_string, s4, "@ We will hunt you down! {s4}"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_looters, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 10, 15),
      (try_begin),
        (lt, reg1, 11),
        (play_sound, "snd_han_oi_what_do_we_have_here_02"),
        (str_store_string, s4, "@ Oi! What do we have here?"),
      (else_try),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_lt_not_a_manhunter"),
        (str_store_string, s4, "@ You better not be a manhunter!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_lt_out_stroll"),
        (str_store_string, s4, "@ Out for a stroll are we?"),
      (else_try),
        (lt, reg1, 14),
        (play_sound, "snd_encounter_lt_what_this_eh"),
        (str_store_string, s4, "@ What's this, eh?"),
      (else_try),
        (play_sound, "snd_encounter_lt_break_legs"),
        (str_store_string, s4, "@ I'm going to break your legs, nice and slow!"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_forest_outcasts, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 12, 18),
      (try_begin),
        (eq, reg1, 12),
        (play_sound, "snd_encounter_fb_money_or_lifel"),
        (str_store_string, s4, "@ Your money or your life!"),
      (else_try),
        (eq, reg1, 13),
        (play_sound, "snd_encounter_fb_have_pay_or_have_fun"),
        (str_store_string, s4, "@ We'll have our pay, or we'll have our fun!"),
      (else_try),
        (eq, reg1, 14),
        (play_sound, "snd_encounter_fb_word_with_you"),
        (str_store_string, s4, "@ My men and I would like to have a word with you."),
      (else_try),
        (eq, reg1, 15),
        (play_sound, "snd_encounter_fb_everything_price"),
        (str_store_string, s4, "@ Everything has a price, even your life!"),
      (else_try),
        (eq, reg1, 16),
        (play_sound, "snd_dangerous_times"),
        (str_store_string, s4, "@ These are dangerous times to be galavanting around with such fine horses... better let me hold 'em for ya."),
      (else_try),
        (play_sound, "snd_encounter_what_do_ere_this_pleasure"),
        (str_store_string, s4, "@ An what do we owe this pleasure?"),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (party_get_template_id, ":var0", "$g_encountered_party"),
      (this_or_next|eq, ":var0", 19),
      (eq, ":var0", 18),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 12, 17),
      (try_begin),
        (eq, reg1, 12),
        (play_sound, "snd_encounter_snake_cult_blood_mistress"),
        (str_store_string, s4, "@ Your blood must be ours to satisfy the mistress, {reg63?peasant:my lovely}!"),
      (else_try),
        (eq, reg1, 13),
        (play_sound, "snd_encounter_snake_cult_taste_divinity"),
        (str_store_string, s4, "@ Lucky for you, we are your ssssssalvation! Come... kissss the priestessss and taste her divinity!"),
      (else_try),
        (eq, reg1, 14),
        (play_sound, "snd_encounter_snake_cult_blade_drink_soul"),
        (str_store_string, s4, "@ How SSSSublime! Fresh Blood to please our Mistresssss. Come here my pretty... and let my blade drink your soul."),
      (else_try),
        (eq, reg1, 15),
        (play_sound, "snd_snake_priestess_bug"),
        (str_store_string, s4, "@ You dare speak to me? You are less than a bug to be squashed!"),
      (else_try),
        (str_store_string, s4, "@ I was expecting a challenge... not something like you!"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_heretics, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 15),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_heretic_quietly_swift_death"),
        (str_store_string, s4, "@ Come quietly and your death will be swift!!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_heretic_you_have_been_marked"),
        (str_store_string, s4, "@ YOU have been marked!"),
      (else_try),
        (lt, reg1, 14),
        (play_sound, "snd_encounter_heretic_strip_altar"),
        (str_store_string, s4, "@ Ah! Good! Strip off your clothes and come over to this altar! C'mon now, be a good {reg63?chap:lass}, I haven't got all day!"),
      (else_try),
        (play_sound, "snd_encounter_heretic_for_glory"),
        (str_store_string, s4, "@ For Glory!"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_errant_knights, "start",
    [
      (eq, "$talk_context", 2),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (lt, ":var0", 0),
      (this_or_next|eq, "$g_encountered_party_faction", "fac_eventide_knights"),
      (eq, "$g_encountered_party_faction", "fac_dawn_knights"),
      (store_random_in_range, ":var1", 0, 100),
      (lt, ":var1", 50),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (eq, "$g_encountered_party_faction", "fac_eventide_knights"),
        (try_begin),
          (lt, reg1, 12),
          (play_sound, "snd_encounter_eventide_death"),
          (str_store_string, s4, "@ Your deaths will enhance the power of our goddess! Die, knowing it is for a good cause."),
        (else_try),
          (lt, reg1, 13),
          (play_sound, "snd_encounter_eventide_dawn"),
          (str_store_string, s4, "@ We'd prefer to fight the Knights of the Dawn, but in a pinch, you'll do. Charge!"),
        (else_try),
          (play_sound, "snd_encounter_eventide_goddess"),
          (str_store_string, s4, "@ With our goddess standing with us, all fall before our might. Surrender or die!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_dawn_knights"),
        (try_begin),
          (lt, reg1, 12),
          (play_sound, "snd_encounter_dawn_chilly"),
          (str_store_string, s4, "@ Ah, we were feeling a bit chilly. A sinner's bonfire is just what we need! Surrender now."),
        (else_try),
          (lt, reg1, 13),
          (play_sound, "snd_encounter_dawn_fires"),
          (str_store_string, s4, "@ Our fires will purge your souls of evil. Do you have any last words?"),
        (else_try),
          (play_sound, "snd_encounter_dawn_bidding"),
          (str_store_string, s4, "@ We do the bidding of Astraea and no one can stand against us. To battle!"),
        (try_end),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_player_knights"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (ge, ":var0", 0),
      (store_random_in_range, ":var1", 0, 100),
      (lt, ":var1", 80),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (eq, "$g_encountered_party_faction", "fac_dragon_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Tread softly stranger, there are Mystmountains about..."),
        (else_try),
          (str_store_string, s4, "@Keep your wits about you. There are ever Mystmountains nearby."),
        (try_end),
        (str_store_string, s5, "@Right, we'll keep our eyes open."),
        (str_store_string, s6, "@There are worse things than Mystmountains... [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_lion_knights"),
        (str_store_string, s5, "@All hail King Ulric, rightful ruler of Pendor!"),
        (str_store_string, s6, "@All hail {playername}, rightful ruler of Pendor! [Attack]"),
        (try_begin),
          (lt, ":var2", 33),
          (str_store_string, s4, "@Halt in the name of King Ulric, rightful ruler of Pendor!"),
        (else_try),
          (lt, ":var2", 67),
          (str_store_string, s4, "@Hold, in the name of the King!"),
        (else_try),
          (str_store_string, s4, "@Clear the road! King's men passing through."),
          (str_store_string, s5, "@My apologies, please take the road."),
          (str_store_string, s6, "@This is MY road! [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_immortal_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Hail, {playername}! We give you greetings in the name of the New Empire!"),
          (str_store_string, s5, "@The New Empire should be proud of such worthy representatives. Farewell."),
          (str_store_string, s6, "@Your New Empire will soon be in tatters. [Attack]"),
        (else_try),
          (str_store_string, s4, "@Greetings, we are hunting a group of Snake Cultists on orders of Marius Imperator. Have you by chance seen them?"),
          (str_store_string, s5, "@I'm afraid no, but good hunting to you."),
          (str_store_string, s6, "@That is irrelevant, for your hunt ends here. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_windriders_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Well met, travelers, may you find an oasis of tranquility."),
          (str_store_string, s5, "@And may you find inspiration in the cool shade of a palm."),
          (str_store_string, s6, "@And may your blood turn its waters red! [Attack]"),
        (else_try),
          (str_store_string, s4, "@Well met travelers, if you are still and listen for a moment then you may hear the desert speak to you on the wind."),
          (str_store_string, s5, "@I hear it! The desert speaks to me."),
          (str_store_string, s6, "@Then it should have warned you to stay away from us! [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_valkyrie_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@I hope fair winds brought you before us today."),
          (str_store_string, s5, "@None fairer than sharing your company for a time."),
        (else_try),
          (str_store_string, s4, "@May the Winds bring fortune to you."),
          (str_store_string, s5, "@Thanks! Same to you."),
        (try_end),
        (str_store_string, s6, "@We come with the winds of war. [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_griffon_knights"),
        (try_begin),
          (eq, "$pop_kingdom", 0),
          (try_begin),
            (lt, ":var2", 50),
            (str_store_string, s4, "@Clear the road in the name of the prophesied {reg63?King:Queen} of Pendor!"),
            (str_store_string, s5, "@My apologies, please take the road."),
            (str_store_string, s6, "@This is MY road! [Attack]"),
          (else_try),
            (str_store_string, s4, "@Hold traveler, do you stand with the prophesied {reg63?King:Queen}, or against?"),
            (str_store_string, s5, "@For!"),
            (str_store_string, s6, "@Against! [Attack]"),
          (try_end),
        (else_try),
          (try_begin),
            (lt, ":var2", 50),
            (str_store_string, s4, "@Your Majesty! How may we be of service?"),
            (str_store_string, s5, "@Nothing for the moment, be about your duties."),
            (str_store_string, s6, "@Your death would serve me best! [Attack]"),
          (else_try),
            (str_store_string, s4, "@Clear a path for {reg63?His:Her} Majesty! All hail the prophesied ruler of Pendor!"),
            (str_store_string, s5, "@All hail me!"),
            (str_store_string, s6, "@Such exclamations are giving me a royal headache! [Attack]"),
          (try_end),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_falcon_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Hello there stranger, are you looking to procure the service of some elite mercenaries?"),
        (else_try),
          (str_store_string, s4, "@Hello there stranger, any news of underdogs looking to hire that extra winning boost?"),
        (try_end),
        (str_store_string, s5, "@Not today, thank you."),
        (str_store_string, s6, "@No, but the loot you're walking in may yet serve me. [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_raven_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Ho there wanderer! Have you seen an old, confused looking scholar in these parts? We were meant to escort him, but he wandered off in the night."),
          (str_store_string, s5, "@Wearing a white habit, and sporting a candle on his head? He's behind those bushes pulling faces at you."),
          (str_store_string, s6, "@Indeed, and he squealed like a pig when I killed him. [Attack]"),
        (else_try),
          (str_store_string, s4, "@Ho there wanderer, stay thy course and indulge an old man."),
          (str_store_string, s5, "@Of course, I will stay a while and listen."),
          (str_store_string, s6, "@Ain't nobody got time for that! [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_radiant_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Greetings traveler, have you wounded?"),
        (else_try),
          (str_store_string, s4, "@Greetings traveler, do you need assistance?"),
        (try_end),
        (str_store_string, s5, "@Thank you, no. We care for our own."),
        (str_store_string, s6, "@No, but you will soon. Charge! [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_clarion_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Watch the horizon traveler, you never know what kind of savages stalk the steppe."),
        (else_try),
          (str_store_string, s4, "@Watch the horizon traveler, you never know who you may stumble across out here or who may stumble across you."),
        (try_end),
        (str_store_string, s5, "@Thanks for the warning."),
        (str_store_string, s6, "@Too bad you didn't take your own advice. [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_dawn_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Are you here to confess your sins? Guilt can only be purged clean with fire."),
          (str_store_string, s5, "@Thank you, no. My conscience is clear."),
          (str_store_string, s6, "@I confess that I want you dead. [Attack]"),
        (else_try),
          (str_store_string, s4, "@Among the Dawn, we have a saying; 'Red sky at night, Astraea's delight'."),
          (str_store_string, s5, "@Red sky in the morning, heretic's warning."),
          (str_store_string, s6, "@Red sky in the morning, the Dawn will be in mourning. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_ebony_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Hello there {reg63?brother:sister}! Keep your eyes on the trees; you never know what evils lurk in their shadows."),
          (str_store_string, s5, "@We'll be wary of what they hide, thanks for the warning."),
          (str_store_string, s6, "@Take your eyes off the foliage and you might notice the foe standing right in front of you! [Attack]"),
        (else_try),
          (str_store_string, s4, "@Hello there {reg63?brother:sister}! Have you heard this one? What's green, pale, and red all over? A dead Noldor. HAH!"),
          (str_store_string, s5, "@Hah! Good one."),
          (str_store_string, s6, "@The murder of Noldor is no laughing matter. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadow_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Salve. May the gods of old Baccus watch over you."),
          (str_store_string, s5, "@And may the gods of Pendor watch over you, friend."),
          (str_store_string, s6, "@Tell them yourself. [Attack]"),
        (else_try),
          (str_store_string, s4, "@Ave, Legate! May your troops always be in good order and discipline."),
          (str_store_string, s5, "@Thanks. We are striving to follow your shining example in this."),
          (str_store_string, s6, "@Indeed. Make yourself ready for a demonstration. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_silvermist_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Salinohaei, {playername}! Lergir vaes drethargll... Oh, sod it. How are you? I am trying to learn the Noldor language."),
        (else_try),
          (str_store_string, s4, "@Adar lir Hieth!... Oh, you're just a human. We had hoped to meet some Noldor. You can learn such a lot from them."),
        (try_end),
        (str_store_string, s5, "@Amazing. I wish you success in your endeavour."),
        (str_store_string, s6, "@Have you already learned the Noldor word for 'death'? [Attack]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_eventide_knights"),
        (try_begin),
          (lt, ":var2", 20),
          (str_store_string, s4, "@You have about ten seconds to give me a reason not to crush your skull!"),
          (str_store_string, s5, "@Ahh...yes, excuse me. I just remembered I am expected somewhere else."),
          (str_store_string, s6, "@Well, you had two and wasted them! Now you are going to die! [Attack]"),
        (else_try),
          (lt, ":var2", 40),
          (str_store_string, s4, "@I would love to chat, but we have spotted smoke up ahead. It seems the Dawn never hesitates to put more innocents to the torch."),
          (str_store_string, s5, "@How horrible! Don't let me keep you, then. Be on your way."),
          (str_store_string, s6, "@The Dawn is the least of your problems right now. Attack! [Attack]"),
        (else_try),
          (lt, ":var2", 60),
          (str_store_string, s4, "@Greetings. Have you seen any heretics around here? We have orders to...take care of them."),
          (str_store_string, s5, "@Sorry, I have encountered none. You better keep on searching."),
          (str_store_string, s6, "@Not before I have taken care of you! [Attack]"),
        (else_try),
          (lt, ":var2", 80),
          (str_store_string, s4, "@Forgive my bluntness, good {reg63?sir:madame}, but we are waiting for someone else. You better move on, and you better do it quickly."),
          (str_store_string, s5, "@If you say so, sir knight. Good day to you."),
          (str_store_string, s6, "@I am afraid your appointment will have to wait. First you must deal with me! [Attack]"),
        (else_try),
          (str_store_string, s4, "@May Astraea, Goddess of Justice, watch over you, {playername}."),
          (str_store_string, s5, "@Thank you, good sir. May she watch over you as well."),
          (str_store_string, s6, "@She can certainly watch me taking you apart! [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_phoenix_knights"),
        (try_begin),
          (lt, ":var2", 33),
          (str_store_string, s4, "@These lands of yours are beautiful. You are lucky the touch of the Snake Cult has not yet tainted it all."),
          (str_store_string, s5, "@Well said, and we will do everything in our power to keep it that way. Farewell, good sir."),
          (str_store_string, s6, "@Oh, luck has little to do with it. Come, let me show you. [Attack]"),
        (else_try),
          (lt, ":var2", 66),
          (str_store_string, s4, "@We are the Knights of the Phoenix! State your business."),
          (str_store_string, s5, "@Forgive me. I was merely curious. You don't see your kind often in these parts."),
          (str_store_string, s6, "@I do not like your tone. You are in dire need of a lesson! [Attack]"),
        (else_try),
          (str_store_string, s4, "@We have seen our homeland burned to cinders and have risen from the ashes to take vengeance upon our enemies. One such as you does not scare us."),
          (str_store_string, s5, "@The tale of your homeland saddens me. Maybe, one day, the people of Pendor can help you set things right."),
          (str_store_string, s6, "@We all make mistakes. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadowwolves_knights"),
        (try_begin),
          (lt, ":var2", 25),
          (str_store_string, s4, "@You are lucky, stranger. Normally, you don't see us Shadow Wolves until we strike."),
          (str_store_string, s5, "@I see. Hopefully, your brothers will never have cause to come after me."),
          (str_store_string, s6, "@Spoken like a true coward! When I strike, you will see me coming. Like right now! [Attack]"),
        (else_try),
          (lt, ":var2", 50),
          (str_store_string, s4, "@You do not look like one in league with the snakes. Begone! Your needs do not concern me."),
          (str_store_string, s5, "@Good luck finding allies with that attitude."),
          (str_store_string, s6, "@Maybe you will reconsider when your men start dying around you! [Attack]"),
        (else_try),
          (lt, ":var2", 75),
          (str_store_string, s4, "@You are not our chosen prey. What do you want?"),
          (str_store_string, s5, "@I was merely passing by. Excuse me."),
          (str_store_string, s6, "@Right now? Your head on a pike! [Attack]"),
        (else_try),
          (str_store_string, s4, "@We came to this land looking for allies. So far, what we have seen does not impress us."),
          (str_store_string, s5, "@There are many fine warriors in Pendor. I am sure that if you keep looking, you will find your match."),
          (str_store_string, s6, "@To arms! Let us show these dogs how true Pendorians fight. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_scorpion_assassin_knights"),
        (try_begin),
          (lt, ":var2", 33),
          (str_store_string, s4, "@The Feuding Father has not summoned you yet. Why do you stop those who do his bidding?"),
          (str_store_string, s5, "@I meant no disrespect. Please, have a safe journey."),
          (str_store_string, s6, "@Enough people have died at your hand. I believe it is your turn! [Attack]"),
        (else_try),
          (lt, ":var2", 66),
          (str_store_string, s4, "@The Bahadur Khan might have outlawed our ancient rights of vengeance, but the laws of gods stand above the laws of men."),
          (str_store_string, s5, "@I am not sure the Bahadur Khan would agree, but good luck to you."),
          (str_store_string, s6, "@Spoken like a true fanatic. Pendor will be better off without you! [Attack]"),
        (else_try),
          (str_store_string, s4, "@Greetings. Do you have a feud that needs settling?"),
          (str_store_string, s5, "@What, no! I settle my own feuds."),
          (str_store_string, s6, "@Actually, my quarrel is with you. [Attack]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_kraken_knights"),
        (try_begin),
          (str_store_string, s4, "@If you are not the beasts or men we hunt, why do you stop us?"),
          (str_store_string, s5, "@My apologies, I dare not stray you away from your hunt."),
          (str_store_string, s6, "@To be blunt, those aren't the only things getting hunted! [Attack]"),
        (try_end),
      (try_end),
    ],
    "{s4}",
    "order_party_friendly_response_specific",
    []],

  [plyr|anyone, "order_party_friendly_response_specific",
    [],
    "{s5}",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "order_party_friendly_response_specific",
    [],
    "{s6}",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -1),
      (encounter_attack),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (this_or_next|is_between, "$g_encountered_party_faction", 65, 72),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_noldor_castle"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (ge, ":var0", 0),
      (str_store_faction_name, s5, "$g_encountered_party_faction"),
      (store_random_in_range, ":var1", 0, 5),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s4, "@Well met, {playername}, it is good to meet a friend of the {s5} in these troubled times."),
      (else_try),
        (eq, ":var1", 1),
        (str_store_string, s4, "@Hail, good {reg63?sir:madam}! Such a fine day to be out on patrol with loyal men at your command, eh?"),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@Ah, {playername}, what a coincidence - we were just discussing you with our Grandmaster this morning! You might know that the {s5} post bounties on our enemies occasionally, and you may be just the right {reg63?man:woman} to aid us."),
      (else_try),
        (eq, ":var1", 3),
        (str_store_string, s4, "@Good day, {playername}. We are on a lookout for vagrants and raiders in the area preying upon our villagers. If you find us dispensing swift justice upon some, we would be obliged if you help us out."),
      (else_try),
        (str_store_string, s4, "@Hail traveler! Be warned that strange attacks were reported around the outlying villages. If you need protection, follow us closely."),
      (try_end),
    ],
    "{s4}",
    "order_party_friendly_response",
    []],

  [plyr|anyone, "order_party_friendly_response",
    [],
    "Greetings, it is a relief to see a friendly face. Good luck in your travels!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "order_party_friendly_response",
    [
      (neq, "$g_encountered_party_faction", "fac_player_knights"),
    ],
    "Long enough have I endured your false friendship. Get ready to die!",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -1),
      (encounter_attack),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (neg|encountered_party_is_attacker),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_player_knights"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (lt, ":var0", 0),
      (store_random_in_range, ":var1", 0, 100),
      (lt, ":var1", 80),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (eq, "$g_encountered_party_faction", "fac_dragon_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@State your business stranger."),
        (else_try),
          (str_store_string, s4, "@Hold. What is your business in Ravenstern?"),
        (try_end),
        (str_store_string, s5, "@Our business is death; yours."),
        (str_store_string, s6, "@Och aye, we're people of Ravenstern. Ye ken? [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_lion_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Be quick, our mission is urgent."),
          (str_store_string, s5, "@Your date with death is more urgent! Charge!"),
        (else_try),
          (str_store_string, s4, "@State your business, or leave. We are on a mission for the King."),
          (str_store_string, s5, "@All hail {playername}, rightful ruler of Pendor!"),
        (try_end),
        (str_store_string, s6, "@My apologies, please take the road. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_immortal_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Remember our order's name, {playername}, before you do anything rash."),
          (str_store_string, s5, "@Indeed I do. It contains 'mortal' and I don't care for prefixes."),
          (str_store_string, s6, "@Well, well, we shall test your immortality another time. [Leave]"),
        (else_try),
          (str_store_string, s4, "@You had better be hunting Snake Cultists instead of wasting our valuable time. Begone."),
          (str_store_string, s5, "@In fact I think I just heard you lisping. To arms!"),
          (str_store_string, s6, "@You're probably right there. Move on. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_windriders_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@The desert whispered to us that you were near. The desert is never wrong."),
          (str_store_string, s5, "@Then it should have warned you to stay away from us!"),
          (str_store_string, s6, "@The wisdom of the desert is deep indeed. [Leave]"),
        (else_try),
          (str_store_string, s4, "@What is more ancient than the sands beneath our feet? The D'Shar, and like the desert, they shall never die."),
          (str_store_string, s5, "@Maybe I should help them on their way then..."),
          (str_store_string, s6, "@May the D'Shar last for eternity. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_valkyrie_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Speak quickly, for my anger is more akin to a tempest than a summer breeze."),
          (str_store_string, s5, "@Even a storm will not save you from my wrath."),
        (else_try),
          (str_store_string, s4, "@You would do well not to interrupt a Stormbride going about her duties."),
          (str_store_string, s5, "@This may be a rather permanent interruption."),
        (try_end),
        (str_store_string, s6, "@Apologies, I will leave you in peace. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_griffon_knights"),
        (str_store_string, s4, "@We are clearing this land of traitors. There are rumors one passed through here recently."),
        (str_store_string, s5, "@And you found them!"),
        (str_store_string, s6, "@Good luck in your search. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_falcon_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@What do you want? We're on business and our contract has no 'idle chit chat' clause, so make it quick."),
          (str_store_string, s5, "@If you have a contract, then you will have been paid. Time to make a profit then, to arms!"),
        (else_try),
          (str_store_string, s4, "@What do you want? You have no bounty on your head, so be on your way pleb."),
          (str_store_string, s5, "@I don't, but you do."),
        (try_end),
        (str_store_string, s6, "@Nothing, we were just curious. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_raven_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Keep your hands where we can see them wanderer. Our charge is too valuable to risk with vagrants like you about."),
          (str_store_string, s5, "@Vagrants? I'll have your head for that!"),
          (str_store_string, s6, "@Quite right, you can never be too careful. [Leave]"),
        (else_try),
          (str_store_string, s4, "@Careful wanderer, there are many dangers afoot. There are dangers we know that we know, there are dangers that we know we do not yet know, there are dangers we do not know that we know, and finally and most dangerous of all, there are dangers that we do not know that we do not know. Now, which are you?"),
          (str_store_string, s5, "@Ow! You make head hurt. Me thump you now. Make head better."),
          (str_store_string, s6, "@And there are some dangers which are no threat to you at all. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_radiant_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Ho there traveler, we seek a Cultist. Have you seen them?"),
          (str_store_string, s5, "@You infer that I am a Cultist? You will pay for your insolence!"),
          (str_store_string, s6, "@Yes... he was heading west and riding hard. [Leave]"),
        (else_try),
          (str_store_string, s4, "@Ho there traveler, have you any news of the Red Plague?"),
          (str_store_string, s5, "@No, but you have just stumbled across something far more deadly!"),
          (str_store_string, s6, "@No, this area seems to be free of the disease. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_clarion_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Company, HALT! Who are you to stand in our way, peasant?"),
          (str_store_string, s6, "@My apologies, please take the road. [Leave]"),
        (else_try),
          (str_store_string, s4, "@We have you surrounded, peasant. Explain yourselves quickly, or we will assume that you are lowlife rogues like most who hide out here."),
          (str_store_string, s6, "@We are also looking for vagrants and bandits. [Leave]"),
        (try_end),
        (str_store_string, s5, "@Peasant? I will have to teach you some manners!"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_dawn_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@You look like you're guilty of something, but then everyone inevitably is, whether aware of the fact or not. "),
          (str_store_string, s5, "@The only guilty party here, are you, and you will answer for your crimes!"),
          (str_store_string, s6, "@You have to prove that we are in the wrong, but until then we are leaving. [Leave]"),
        (else_try),
          (str_store_string, s4, "@Look deeply into the fire, and we shall determine the level of your guilt."),
          (str_store_string, s5, "@I see only death!"),
          (str_store_string, s6, "@I see the glory of Astraea! [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_ebony_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Hello there {reg63?brother:sister}, we're on our way to a town near by to receive alms to distribute to the poor people of the area, left bereft by the ongoing wars. Why do you stop us in this important task?"),
          (str_store_string, s5, "@Lies! You are just raising money to continue your own butchery of the Noldor."),
          (str_store_string, s6, "@My apologies, please take the road. [Leave]"),
        (else_try),
          (str_store_string, s4, "@You there! Aydar lear Heaf! What do you make of that then, eh?"),
          (str_store_string, s5, "@It's pronounced Adar lir Hieth, you cretin."),
          (str_store_string, s6, "@Sorry I don't speak gibberish either. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadow_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Legionarii, formatio defensiva! - Who are you and why do you interfere with the Legion's business?"),
        (else_try),
          (str_store_string, s4, "@Ad Signa! Scuta! Gladii! - One wrong move and you'll have a hasta between the eyes, {playername}!"),
        (try_end),
        (str_store_string, s5, "@Your Baccus gibberish will not save you from death."),
        (str_store_string, s6, "@No reason to form a testudo, decurio. We'll be on our way. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_silvermist_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Don't think we did not hear you coming. You're breathing so loud we heard you miles away."),
          (str_store_string, s5, "@At least I'll still be breathing when this is over."),
        (else_try),
          (str_store_string, s4, "@What do you want? Our elven allies will avenge any insult dealt to us!"),
          (str_store_string, s5, "@Pity there will be no one to tell them of this one."),
        (try_end),
        (str_store_string, s6, "@It's nothing, just give the Noldor my regards. [Leave]"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_eventide_knights"),
        (try_begin),
          (lt, ":var2", 16),
          (str_store_string, s4, "@So you have chosen to stand and fight. Commendable, but foolish."),
          (str_store_string, s5, "@You are quite sure of yourself. Enjoy it while you can - it will not last!"),
          (str_store_string, s6, "@[Leave]"),
        (else_try),
          (lt, ":var2", 32),
          (str_store_string, s4, "@Let me guess: you have heard all about the evil Knights of the Eventide, their heinous crimes and unholy ways, and are now here to vanquish us scoundrels from the face of the earth. It is so sad that people would kill based on nothing but rumors and hearsay."),
          (str_store_string, s5, "@I will not be swayed by your pathetic claims of innocence."),
          (str_store_string, s6, "@Maybe I have rushed to false conclusions about your order. [Leave]"),
        (else_try),
          (lt, ":var2", 48),
          (str_store_string, s4, "@I am tired of being harassed by self-appointed judges and so-called heroes. You think me and my men are servants of evil? Fine, throw away your life for this fabric of lies woven by my order's enemies, but know that are you are making a grave mistake."),
          (str_store_string, s5, "@We all make mistakes. The only difference is I will be able to live with mine."),
          (str_store_string, s6, "@Fine, you may leave for now. [Leave]"),
        (else_try),
          (lt, ":var2", 65),
          (str_store_string, s4, "@Look at this, brothers. It seems our hunting days are over. Now our enemies come to us, like lambs to the slaughter. Surely we are blessed."),
          (str_store_string, s5, "@Maybe this lamb will turn out to be a wolf in sheep's clothing. To arms!"),
          (str_store_string, s6, "@You think I am going to make it that easy for you? [Leave]"),
        (else_try),
          (lt, ":var2", 82),
          (str_store_string, s4, "@Interesting. Normally people scream and scramble and do everything they can to get away from us, but you don't. That raises the question of whether you are brave, foolish, or simply have a deathwish."),
          (str_store_string, s5, "@You better get used to it. Your reign of terror over this land ends today!"),
          (str_store_string, s6, "@I am beginning to think this was a bad idea. Excuse me. [Leave]"),
        (else_try),
          (str_store_string, s4, "@It seems the Goddess has taken pity on you, {playername}. Luckily for you, we are currently seeking other prey. Get out of the way, and you and your men will not be harmed."),
          (str_store_string, s5, "@So I will not only rid this world of you, but also save whoever you are hunting."),
          (str_store_string, s6, "@I agree to your terms, Sir Knight. We will fight another day. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_phoenix_knights"),
        (try_begin),
          (lt, ":var2", 25),
          (str_store_string, s4, "@We have come to these lands seeking those of noble spirit. Instead, we keep running into fiends like you!"),
          (str_store_string, s5, "@You should have never set foot on this land!"),
          (str_store_string, s6, "@What a pathetic bunch you are. Go on then, continue your worthless search for a while longer. [Leave]"),
        (else_try),
          (lt, ":var2", 50),
          (str_store_string, s4, "@We have risen from the ashes once before. Do your worst, fiend!"),
          (str_store_string, s5, "@Well, since you asked nicely..."),
          (str_store_string, s6, "@Get out of my sight. I don't break what is already broken. [Leave]"),
        (else_try),
          (lt, ":var2", 75),
          (str_store_string, s4, "@We have come to these lands seeking those of noble spirit. Instead, we find you!"),
          (str_store_string, s5, "@You should have never set foot on this land!"),
          (str_store_string, s6, "@What a pathetic bunch you are. Go on then, continue your worthless search for a while longer. [Leave]"),
        (else_try),
          (str_store_string, s4, "@We have no wish to fight you, but if you challenge us, know that we have risen from the ashes once before."),
          (str_store_string, s5, "@Well, since you asked nicely... To arms!"),
          (str_store_string, s6, "@Get out of my sight. I don't break what is already broken. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadowwolves_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Do your worst, snake-thrall. We will fight to the last man standing!"),
          (str_store_string, s5, "@If you insist..."),
          (str_store_string, s6, "@Fight you? Please, you puppies are not even worth the effort. [Leave]"),
        (else_try),
          (str_store_string, s4, "@We are used to being hunters, not prey. You'd better have a good explanation for this!"),
          (str_store_string, s5, "@Most certainly. My blade will do all the talking, though!"),
          (str_store_string, s6, "@Not really. I just thought you looked awfully suspicious in that black armor of yours. No harm done. [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_scorpion_assassin_knights"),
        (try_begin),
          (lt, ":var2", 50),
          (str_store_string, s4, "@Have you come to pursue your feud with our order? I respect that."),
          (str_store_string, s5, "@Your respect means nothing to me, cut-throat. Prepare to die."),
          (str_store_string, s6, "@Your disregard for life disgusts me. I kill only when I have no other choice. [Leave]"),
        (else_try),
          (str_store_string, s4, "@Did you honestly think we would come after you with so many soldiers surrounding you? There is always the next alleyway, you know."),
          (str_store_string, s5, "@You will not get that chance. To arms!"),
          (str_store_string, s6, "@I will be ready for you, coward. Now get out of my sight! [Leave]"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_kraken_knights"),
        (str_store_string, s4, "@The Beast is out there in the seas waiting to be hunted. Instead, we travel and search, hunting others..on land even."),
        (str_store_string, s5, "@Shame, it's too bad you must die on land!"),
        (str_store_string, s6, "@May your hunt be less arduous than the unforgiving seas. [Leave]"),
      (try_end),
    ],
    "{s4}",
    "order_party_hostile_weak_specific",
    []],

  [plyr|anyone, "order_party_hostile_weak_specific",
    [],
    "{s5}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [plyr|anyone, "order_party_hostile_weak_specific",
    [],
    "{s6}",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (neg|encountered_party_is_attacker),
      (this_or_next|is_between, "$g_encountered_party_faction", 65, 72),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_noldor_castle"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (lt, ":var0", 0),
      (str_store_faction_name, s5, "$g_encountered_party_faction"),
      (store_random_in_range, ":var1", 0, 5),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s4, "@What do you want, {playername}? Add another crime to the list of your insults against the {s5}?"),
      (else_try),
        (eq, ":var1", 1),
        (str_store_string, s4, "@Stand down, mendicant. Your rag-tag rabble doesn't scare the noble {s5}."),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@{playername}! You can battle us today and lose or depart and make amends with the {s5}. Choose wisely."),
      (else_try),
        (eq, ":var1", 3),
        (str_store_string, s4, "@We would rather perish in glory than be chased by vagrants all day. Stand fast, men, until I give the order to charge."),
      (else_try),
        (str_store_string, s4, "@Look, men, here comes that {playername}, an infamous looter and highwayman, no doubt drawn by the {s5} fine equipment. You may try to take it - from our cold, dead hands."),
      (try_end),
    ],
    "{s4}",
    "order_party_hostile_weak",
    []],

  [plyr|anyone, "order_party_hostile_weak",
    [],
    "Your false Order brings disgrace upon Pendor! To arms!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [plyr|anyone, "order_party_hostile_weak",
    [],
    "Bah, I have better things to do than wasting my time with you pathetic lot. [Leave]",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_player_knights"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 80),
      (store_random_in_range, ":var1", 0, 100),
      (try_begin),
        (eq, "$g_encountered_party_faction", "fac_dragon_knights"),
        (str_store_string, s4, "@Blood and thunder we found {reg63?him:her}! Yer accused of treason against the people of..."),
        (str_store_string, s5, "@Ravenstern. Yes, yes. Get to the good bit; where we fight."),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_lion_knights"),
        (str_store_string, s4, "@Halt! You are charged with treason against the King!"),
        (str_store_string, s5, "@Curses... you caught us."),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_immortal_knights"),
        (str_store_string, s4, "@By order of Marius Imperator and with the blessing of Damia Provideo I sentence you to death by my blade, traitor to the New Empire."),
        (str_store_string, s5, "@You will die as the pompous fool you are."),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_windriders_knights"),
        (str_store_string, s4, "@The desert brings death to those who do not respect her, as do we."),
        (str_store_string, s5, "@I have more to fear from scorpions than from you!"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_valkyrie_knights"),
        (str_store_string, s4, "@You should fear the coming storm, for its thunder will deafen you, and the lightning will strike you all down."),
        (str_store_string, s5, "@Then it will have to be furious indeed!"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_griffon_knights"),
        (str_store_string, s4, "@Halt! You are charged with treason against the prophesied ruler of Pendor. The penalty for treason is death!"),
        (str_store_string, s5, "@Stop! I AM the proph-"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_falcon_knights"),
        (str_store_string, s4, "@Surprised to have been caught by a female knight? Granted this plate armor fits a little snug in places, but the price on your head will more than pay for a new suit."),
        (str_store_string, s5, "@Let's see how that armor fits when you have no arms, or legs... or head. "),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_raven_knights"),
        (str_store_string, s4, "@Hold fast there! Pendor should be enjoying a golden age of achievement and progress, instead because of brigands like you, the flame of knowledge flickers and nearly goes out. We shall not allow it to be extinguished entirely, and the breath that will restore it will be your death rattle!"),
        (str_store_string, s5, "@It will be your last breath instead, fool. Defend yourselves!"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_radiant_knights"),
        (try_begin),
          (lt, ":var1", 50),
          (str_store_string, s4, "@Halt Cultist! You have been charged with conspiring to spread the Red Plague and will answer for your actions!"),
        (else_try),
          (str_store_string, s4, "@Hold, scum. We will not suffer Cult agents to corrupt Pendor any longer!"),
        (try_end),
        (str_store_string, s5, "@This is hardly a fair trial, I am not gui-"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_clarion_knights"),
        (str_store_string, s4, "@Up and at them chaps!"),
        (str_store_string, s5, "@..."),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_dawn_knights"),
        (try_begin),
          (lt, ":var1", 50),
          (str_store_string, s4, "@Astraea will see this world purged clean with flames; I am her firebrand, and you are her kindling."),
          (str_store_string, s5, "@Defend yourselves!"),
        (else_try),
          (str_store_string, s4, "@Astraea will test the purity of your hearts with fire. To resist is to be condemned."),
          (str_store_string, s5, "@To arms!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_ebony_knights"),
        (str_store_string, s4, "@There they are lads! Those are the elf-loving, good for nothing, traitorous bastards! Kill 'em all!"),
        (str_store_string, s5, "@To arms!"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadow_knights"),
        (str_store_string, s4, "@You insulted the glorious Baccus empire, you Pendorian heathen, and soon our lines will march over your lifeless bodies, like in the good old days."),
        (str_store_string, s5, "@Pendor is not defeated that easily. Have you learned nothing in the past centuries?"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_silvermist_knights"),
        (str_store_string, s4, "@Sedrath aenelui daneth! Or was it 'aeneluth'? I don't care. You'll die independent of orthography."),
        (str_store_string, s5, "@I fear I'll die of laughing before I can get to slaughtering you."),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_eventide_knights"),
        (try_begin),
          (lt, ":var1", 20),
          (str_store_string, s4, "@And so the hunt comes to an end. You can scream if you want. In fact, me and my men would prefer it."),
          (str_store_string, s5, "@Like I would give you that satisfaction, fiend! If anyone's screams are going to pierce the air, it is going to be yours!"),
        (else_try),
          (lt, ":var1", 40),
          (str_store_string, s4, "@I don't know what you have done to offend the Knights of the Eventide, but our Grandmaster has ordered you killed, and it is my duty to obey. Die well, stranger."),
          (str_store_string, s5, "@So much blind devotion. Maybe in your next life, you will make an outstanding puppy!"),
        (else_try),
          (lt, ":var1", 60),
          (str_store_string, s4, "@You look like a worthy opponent. Pray that you die during the battle, for I assure you, the fate of the prisoners will be far worse."),
          (str_store_string, s5, "@Thank you for letting me know. I will remember that when you are dragged before me in chains!"),
        (else_try),
          (lt, ":var1", 80),
          (str_store_string, s4, "@Prepare yourself to be judged in the name of Astraea, {playername}. Today, justice shall be done!"),
          (str_store_string, s5, "@Justice has nothing to do with this, fool. Nothing. Let us get this over with."),
        (else_try),
          (str_store_string, s4, "@We have been eager to meet you, {playername}. Can you already hear the void calling out for you?"),
          (str_store_string, s5, "@No, I am afraid I can't hear it over the sound of my blade baying for your blood!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_phoenix_knights"),
        (try_begin),
          (lt, ":var1", 50),
          (str_store_string, s4, "@We could have been allies, fool! You have brought this upon yourself."),
          (str_store_string, s5, "@Bring it on, chicken knight!"),
        (else_try),
          (str_store_string, s4, "@Your death will bring us one step closer to the final victory of the Ashenborn Empire. Take comfort in that."),
          (str_store_string, s5, "@We will see about that. To arms!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_shadowwolves_knights"),
        (try_begin),
          (lt, ":var1", 50),
          (str_store_string, s4, "@You have been found guilty of being in league with the Snake Cult. Now face our wrath!"),
          (str_store_string, s5, "@Ridiculous! I harbor only hate for the Snake Cult. It just so happens that I loath your kind with equal intensity."),
        (else_try),
          (str_store_string, s4, "@And so the hunt comes to an end. To arms!"),
          (str_store_string, s5, "@Come then, lapdog! Let us do battle!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_scorpion_assassin_knights"),
        (try_begin),
          (lt, ":var1", 50),
          (str_store_string, s4, "@{playername}, the Feuding Father begs an audience..."),
          (str_store_string, s5, "@I am afraid he will have to wait. You can pass that on once I sent you to him!"),
        (else_try),
          (str_store_string, s4, "@Did you really think you could evade us? You have been marked, {playername}. Your life is forfeit."),
          (str_store_string, s5, "@We will see about that. To arms!"),
        (try_end),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_kraken_knights"),
        (str_store_string, s4, "@Pity, you are not as worthy as The Beast to hunt, but your skulls will do nicely on our ships!"),
        (str_store_string, s5, "@The only skulls that are crakin' are yours!"),
      (try_end),
    ],
    "{s4}",
    "order_party_hostile_strong_specific",
    []],

  [plyr|anyone, "order_party_hostile_strong_specific",
    [],
    "{s5}",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (this_or_next|is_between, "$g_encountered_party_faction", 65, 72),
      (is_between, "$g_encountered_party_faction", "fac_dragon_knights", "fac_noldor_castle"),
      (str_store_faction_name, s5, "$g_encountered_party_faction"),
      (store_random_in_range, ":var0", 0, 5),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s4, "@Stop right there, {playername}! Did you think you could actually escape the wrath of the {s5}??"),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s4, "@At last we meet, vagrant! Now you shall pay for your crimes against the {s5}!"),
      (else_try),
        (eq, ":var0", 2),
        (str_store_string, s4, "@Greetings, {playername}. When I'm done with you poor lot and bring your head back to the {s5} chapterhouse, I'm sure they'll make me the next Grandmaster."),
      (else_try),
        (eq, ":var0", 3),
        (str_store_string, s4, "@A glorious battle awaits! The finest of the {s5} against the infamous {playername}! Good luck, for you shall sorely need it."),
      (else_try),
        (str_store_string, s4, "@Chased down like a rabbit, eh, {playername}? Let us teach you a painful lesson: no one opposes the {s5} and lives!"),
      (try_end),
    ],
    "{s4}",
    "order_party_hostile_strong",
    []],

  [plyr|anyone, "order_party_hostile_strong",
    [],
    "We will answer wrath with steel. To arms!",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_template", "pt_errant_knights"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (ge, ":var0", 0),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
      (str_store_faction_name, s5, "$g_encountered_party_faction"),
    ],
    "Greetings, we are of the {s4}, serving the {s5}. What is your business here?",
    "order_party_kingdom_friend",
    []],

  [plyr|anyone, "order_party_kingdom_friend",
    [],
    "Greetings, it is a relief to see a friendly face. Good luck in your travels!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "order_party_kingdom_friend",
    [],
    "Your false Order serves a pathetic master! To arms!",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -1),
      (encounter_attack),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_template", "pt_errant_knights"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
      (str_store_faction_name, s5, "$g_encountered_party_faction"),
    ],
    "Beware the might of the {s4}, serving the {s5}. Surrender or perish!",
    "order_party_kingdom_hostile",
    []],

  [plyr|anyone, "order_party_kingdom_hostile",
    [],
    "We will answer wrath with steel. To arms!",
    "close_window",
    []],

  [plyr|anyone, "order_party_kingdom_hostile",
    [
      (neg|encountered_party_is_attacker),
    ],
    "Bah, I have better things to do than wasting my time with you pathetic lot.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_jatu"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (eq, reg1, 11),
        (play_sound, "snd_encounter_jatu_honor_lance"),
        (str_store_string, s4, "@ We are the Jatu! We salute you - may your death bring honor to my lance!"),
      (else_try),
        (eq, reg1, 12),
        (play_sound, "snd_encounter_Jatu_prepare_2_die"),
        (str_store_string, s4, "@ HAZAH Jatu! Prepare to Fight! Prepare to Die!"),
      (else_try),
        (play_sound, "snd_encounter_jatu_lances"),
        (str_store_string, s4, "@ Jatu! Our Lances are sharp! Our arms strong! Fear us.. and Perish!"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_steppe_bandits, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "steppe_bandits_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_sb_born_in_saddle"),
        (str_store_string, s4, "@ We were born in the saddle, but you will die in one!"),
        (str_store_string, s3, "@And it smells as if you died in your saddle! Draw Steel!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_sb_hunt_u_down"),
        (str_store_string, s4, "@ We will hunt you down!"),
        (str_store_string, s3, "@I am not impressed! Let's see how strong your bows really are!"),
      (else_try),
        (play_sound, "snd_encounter_sb_ride_u_down"),
        (str_store_string, s4, "@ We're going to ride you down!"),
        (str_store_string, s3, "@I am not impressed! Let's see how strong your bows really are!"),
      (try_end),
    ]],

  [party_tpl|pt_steppe_bandits, "steppe_bandits_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_burilgi_the_usurper, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "burilgi_the_usurper_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_sb_born_in_saddle"),
        (str_store_string, s4, "@ We were born in the saddle, but you will die in one!"),
        (str_store_string, s3, "@And it smells as if you died in your saddle! Draw Steel! "),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_sb_hunt_u_down"),
        (str_store_string, s4, "@ We will hunt you down!"),
        (str_store_string, s3, "@I am not impressed! Let's see how strong your bows really are!"),
      (else_try),
        (play_sound, "snd_encounter_sb_ride_u_down"),
        (str_store_string, s4, "@ We're going to ride you down!"),
        (str_store_string, s3, "@I am not impressed! Let's see how strong your bows really are!"),
      (try_end),
    ]],

  [party_tpl|pt_burilgi_the_usurper, "burilgi_the_usurper_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_mett_obrist, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "obrist_heynrich_1",
    [
      (store_random_in_range, ":var0", 0, 2),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s4, "@Ha! It looks like the battle at the Mettenheim capital once again!^It all ends in a massive rout, if you are curious, so keep your horse where you can see him!"),
        (str_store_string, s3, "@If you had learned how to ride, you could have gotten a horse too."),
      (else_try),
        (str_store_string, s4, "@I have fought many battles. Whole Snake Cult armies fear me. You are nothing but a bumbling upstart."),
        (str_store_string, s3, "@Old men with swords tend to frighten snakes, I'm sure."),
      (try_end),
    ]],

  [party_tpl|pt_mett_obrist, "obrist_heynrich_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|pt_vecc_verante, "start",
    [
      (eq, "$talk_context", 2),
      (ge, "$g_encountered_party_relation", 0),
      (neg|main_party_has_troop, "trp_npc_boadice"),
    ],
    "I am Verante, Kruus to the new Queen of Veccavia. We heard rumors that a powerful witch has fled into these lands to seek shelter and support for her dark and sinister purpose. We came to chase and root her out, and carry back her head to my Queen.^Beware the witch. Her name is Boadice, and she is powerful. She claims to be the rightful Queen of Veccavia, yet do not believe her lies!",
    "verante_kruus_friendly",
    []],

  [plyr|anyone, "verante_kruus_friendly",
    [],
    "A powerful witch in these lands? You should speak to the Knights of the Dawn in Valonbray. They may know more about witches.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|auto_proceed|pt_vecc_verante, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "verante_kruus_1",
    [
      (try_begin),
        (main_party_has_troop, "trp_npc_boadice"),
        (assign, ":var0", "$g_encountered_party_relation"),
        (val_min, ":var0", -10),
        (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
        (str_store_string, s4, "@The Witch Boadice! The chase has ended! Sisters, to battle!"),
        (str_store_string, s3, "@Boadice is under my protection. The witchcraft you speak of is nothing but a deception for political ends. Your hunt ends here, but not in the way you expected."),
      (else_try),
        (str_store_string, s4, "@I see many dead men walking, commander. I may keep you alive long enough to witness how we cut down the weak survivors, for I am Verante Kruus of Veccavia and my sisters and I will sweep you apart!"),
        (str_store_string, s3, "@You remind me of someone I knew. Quite a bitch, she was, but I taught her manners, just as I am going to teach you."),
      (try_end),
    ]],

  [party_tpl|pt_vecc_verante, "verante_kruus_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_barclay_rufio, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "barclay_rufio_1",
    [
      (store_random_in_range, ":var0", 0, 2),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s4, "@Rufio Vincente de Villaviciosia at your service, friend, you must've seen the posters. Now kindly deliver your baggage and your fine equipment, or I will personally tear off your limbs, one by one, then beat you to death with them."),
        (str_store_string, s3, "@You foreign outlaws are like flies on Pendor's wounds. I shall make an example of you for others to heed before they consider disembarking here."),
      (else_try),
        (str_store_string, s4, "@You have the fleeting honor of meeting Rufio and his famous Tercio Villaviciosia. My bandoleros need some killing practice - you'll do just fine."),
        (str_store_string, s3, "@I am {playername} and this is Pendor, not Barclay. We kill for much less here."),
      (try_end),
    ]],

  [party_tpl|pt_barclay_rufio, "barclay_rufio_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_melitine_kaspax, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "melitine_kaspax_1",
    [
      (store_random_in_range, ":var0", 0, 2),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s4, "@In the name of the Melitine Empire, surrender all your fiefs to the care of the Sebastokrator Kaspax! Failure to obey will be punished by confiscation and a particularly slow crucifixion."),
        (str_store_string, s3, "@I don't parley with foreign invaders, I drive them away."),
      (else_try),
        (str_store_string, s4, "@Your continued insolence, Pendorian, will not be tolerated. You'll learn to bow to your new Melitine masters or perish."),
        (str_store_string, s3, "@I am {playername} and this is Pendor, not Melitine. We kill for much less here."),
      (try_end),
    ]],

  [party_tpl|pt_melitine_kaspax, "melitine_kaspax_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_sea_raiders, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 15),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_sr_drink_skull"),
        (str_store_string, s4, "@ I will drink from your skull!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_sr_gods_fate"),
        (str_store_string, s4, "@ Today the gods will decide your fate!"),
      (else_try),
        (lt, reg1, 14),
        (play_sound, "snd_encounter_sr_nice_head"),
        (str_store_string, s4, "@ That's a nice head on your shoulders! "),
      (else_try),
        (play_sound, "snd_encounter_sr_less_talking"),
        (str_store_string, s4, "@ Less talking, more raiding!"),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_mystmountain"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 16),
      (play_sound, "snd_encounter_mystmountain"),
      (try_begin),
        (eq, reg1, 11),
        (play_sound, "snd_encounter_crush_people"),
        (str_store_string, s4, "@ I will crush your people, drive them before me and hear the lamentation of your women!"),
      (else_try),
        (eq, reg1, 12),
        (play_sound, "snd_encounter_sword_do_talking"),
        (str_store_string, s4, "@  Come face me on the field of battle. I will let my sword do my talking!"),
      (else_try),
        (eq, reg1, 13),
        (play_sound, "snd_encounter_ram_fist"),
        (str_store_string, s4, "@ I am going to take my fist and ram it into your stomach, and rip out your god-cursed spine!"),
      (else_try),
        (play_sound, "snd_encounter_des_body"),
        (str_store_string, s4, "@ When this battle is over, I am going to desecrate your body, and then I am going to drink from your skull!"),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_noldor_elves"),
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (ge, ":var0", 0),
      (store_random_in_range, ":var1", 0, 9),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s4, "@Greetings, {playername}. Be careful in your travels, our forests are dangerous."),
      (else_try),
        (eq, ":var1", 1),
        (str_store_string, s4, "@Well met, friend of the Noldor. Have you had the joy of killing Ebony Gauntlet brutes recently?"),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s4, "@Hail! We are hunting for Jatu, stay close to us and we might seal our friendship with Jatu blood."),
      (else_try),
        (eq, ":var1", 3),
        (str_store_string, s4, "@Good to see you, {playername}. Lord Faergwethanir spoke highly of you just yesterday."),
      (else_try),
        (eq, ":var1", 4),
        (str_store_string, s4, "@Hunting down forest bandits is utterly boring. What a welcome surprise to meet such a civilized member of the human race as you in our forests, {playername}."),
      (else_try),
        (eq, ":var1", 5),
        (str_store_string, s4, "@Salinohaei, {playername}. Good thing I recognized you. Otherwise you would now lie in a ditch with an arrow piercing your heart. How do your people put it? Ah yes, old habits die hard."),
      (else_try),
        (eq, ":var1", 6),
        (str_store_string, s4, "@Adar lir Hieth! It is good to see you, {playername}."),
      (else_try),
        (eq, ":var1", 7),
        (str_store_string, s4, "@{playername} unafae Mael, vi Drael vae lunor sivensi Nael!"),
      (else_try),
        (str_store_string, s4, "@Relvir niae Jatue aeneluth vae Noldor valneori daneth."),
      (try_end),
      (play_sound, "snd_encounter_noldor"),
    ],
    "{s4}",
    "noldor_player_response",
    []],

  [plyr|anyone, "noldor_player_response",
    [],
    "We'll leave you to your forests, friends.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_noldor_elves"),
    ],
    "W.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 12, 19),
      (try_begin),
        (eq, reg1, 12),
        (str_store_string, s4, "@ Hai! Dreth Ael Noldor!"),
        (play_sound, "snd_encounter_noldor"),
      (else_try),
        (eq, reg1, 13),
        (str_store_string, s4, "@ Bah! Noldor Dralerion vae savensir luith Drae! Begone outlander!"),
        (play_sound, "snd_encounter_noldor"),
      (else_try),
        (eq, reg1, 14),
        (str_store_string, s4, "@ Hai! Ael vae bandrae? Bah!"),
        (play_sound, "snd_encounter_noldor"),
      (else_try),
        (eq, reg1, 15),
        (str_store_string, s4, "@ You Humans are like an infestation of maggots!"),
        (play_sound, "snd_encounter_noldor_maggots"),
      (else_try),
        (eq, reg1, 16),
        (str_store_string, s4, "@ Tell me Human, do you get tired of challenging us? As I get weary of putting you in your place!"),
        (play_sound, "snd_encounter_noldor_tell_me_human"),
      (else_try),
        (eq, reg1, 17),
        (str_store_string, s4, "@ There are so few of you. And I was hoping that this would be interesting. Pity!"),
        (play_sound, "snd_encounter_noldor_there_are_so_few_of_you"),
      (else_try),
        (str_store_string, s4, "@ You are not welcome here. Begone!"),
        (play_sound, "snd_encounter_noldor_you_are_not_welcome_here_begone"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_three_seers, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: .",
    "seer_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (str_store_string, s4, "@ Come... join the sweet embrace of the sisters of eternity!"),
      (else_try),
        (lt, reg1, 13),
        (str_store_string, s4, "@ Your fame runs before you {playername}, join us for dinner!"),
      (else_try),
        (lt, reg1, 14),
        (str_store_string, s4, "@ Hail great {playername}, there is no need for alarm, come sit with us and be enlightened!"),
      (try_end),
      (play_sound, "snd_encounter_pop_sfx_eight"),
    ]],

  [party_tpl|pt_three_seers, "seer_1",
    [],
    "{s4}",
    "seer_2",
    []],

  [plyr|party_tpl|pt_three_seers, "seer_2",
    [],
    "Yes, there is no need for battle... let us sit down together!",
    "seer_a",
    []],

  [plyr|party_tpl|pt_three_seers, "seer_2",
    [],
    "I will not fall for your tricks, witches! Too many souls have been lost to your embrace! It is time to die!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_three_seers, "seer_a",
    [],
    "Very good choice {playername}, let us drink together, make merriment and bask in the warm sun.",
    "seer_a2",
    []],

  [plyr|party_tpl|pt_three_seers, "seer_a2",
    [],
    "Agreed! Lads! Put down your weapons, unbuckle your shields, and let us drink wine and rest with these beautiful souls.",
    "close_window",
    [
      (assign, "$g_player_surrenders", 1),
    ]],

  [plyr|party_tpl|pt_three_seers, "seer_a2",
    [],
    "You almost had me, witch! Words of honey and promises of pleasure will not fool me. You die now!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|auto_proceed|pt_heretics_army, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_demonic_dialogue"),
    ]],

  [party_tpl|auto_proceed|pt_eyegrim, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_demonic_dialogue"),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_robber_knights"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_rogue_knight_dialogue"),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_adventurers"),
      (store_conversation_troop, "$g_talk_troop"),
      (troop_get_type, ":var0", "$g_talk_troop"),
      (eq, ":var0", 0),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 15),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_adv_hell_with_it_fight"),
        (str_store_string, s4, "@ Hail and well met friend. What say we... ah... er... oh to hell with it! Prepare to fight!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_adv_gay_ale"),
        (str_store_string, s4, "@ Hmm, you are not the type of encounter I was looking for, but with enough ale... well... hmm... maybe not. Draw your sword, swine!"),
      (else_try),
        (lt, reg1, 14),
        (play_sound, "snd_encounter_adv_laugh_at_me"),
        (str_store_string, s4, "@ You! Yeah you! What are you looking at? Are you making fun of me? I'll teach you to laugh!"),
      (else_try),
        (lt, reg1, 15),
        (play_sound, "snd_encounter_adv_pit_strength"),
        (str_store_string, s4, "@ I have taken a vow to pit my strength against the finest warriors of all of Pendor. Until I find them, I guess I'll settle for you."),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_adventurers"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 1, 4),
      (try_begin),
        (lt, reg1, 2),
        (play_sound, "snd_encounter_ladv_cat_dragged_in"),
        (str_store_string, s4, "@ Well well! Just look what the cat dragged in! Care to test your arms?"),
      (else_try),
        (lt, reg1, 3),
        (play_sound, "snd_encounter_ladv2_liven_day"),
        (str_store_string, s4, "@ Ah! Hey! Hey! A little something to liven up our day troops! Lets have at it!"),
      (else_try),
        (play_sound, "snd_encounter_ladv3_vow_vow"),
        (str_store_string, s4, "@ I have sworn to conquer everyone I meet. You do not look like much of a challenge... but a vow is a vow."),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_barclay"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 1, 4),
      (try_begin),
        (lt, reg1, 2),
        (play_sound, "snd_encounter_barc_loot_bodies"),
        (str_store_string, s4, "@ We came here to make our fortunes. Looting your bodies will certainly aid us in that."),
      (else_try),
        (play_sound, "snd_encounter_barc_fight_sell"),
        (str_store_string, s4, "@ It won't do much for our prestige to fight you. But we can use the gold we receive for selling you!"),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_mettenheim"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 1, 3),
      (try_begin),
        (lt, reg1, 2),
        (play_sound, "snd_encounter_met_kill_pendor"),
        (str_store_string, s4, "@ We have not killed any Pendorians for almost a day. Thank you for giving us an opportunity to kill more!"),
      (else_try),
        (play_sound, "snd_encounter_met_die_today"),
        (str_store_string, s4, "@ We of Mettenheim never pass up a challenge. Are you ready to die today?"),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_veccavia"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 1, 4),
      (try_begin),
        (lt, reg1, 2),
        (this_or_next|eq, "$character_gender", 0),
        (eq, "$character_gender", 4),
        (play_sound, "snd_encounter_vecad_gelding"),
        (str_store_string, s4, "@ Look Girls, some fresh candidates for gelding! Try to take all the men alive!"),
      (else_try),
        (lt, reg1, 3),
        (play_sound, "snd_encounter_vecad_error"),
        (str_store_string, s4, "@ You challenge the Veccavi, fool? You shall learn the error of your ways! "),
      (else_try),
        (play_sound, "snd_encounter_vecad_be_warned"),
        (str_store_string, s4, "@ You risk both your lives and your manhoods by challenging us, you know. Be warned!"),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_melitine"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 1, 4),
      (try_begin),
        (lt, reg1, 2),
        (str_store_string, s4, "@Men! Another Pendorian wishes to challenge us - let us show {reg63?him:her} the valor of the Melitine soldiers!"),
      (else_try),
        (lt, reg1, 3),
        (str_store_string, s4, "@Have you ever seen the charge of Melitine Griwbanars? Rarely has anyone seen it twice and lived."),
      (else_try),
        (str_store_string, s4, "@We are on a lookout for suitable landing beaches and provisions. Stay clear and live."),
      (try_end),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_red_brotherhood"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 15),
      (try_begin),
        (lt, reg1, 12),
        (play_sound, "snd_encounter_rb_price_head"),
        (str_store_string, s4, "@A price has been put on your head, and we are here to collect!"),
      (else_try),
        (lt, reg1, 13),
        (play_sound, "snd_encounter_rb_pay_well"),
        (str_store_string, s4, "@You have made powerful enemies, friend. They pay well... too bad for you."),
      (else_try),
        (lt, reg1, 14),
        (play_sound, "snd_encounter_rb_dead_man"),
        (str_store_string, s4, "@You look pretty good... for a dead {reg63?man:woman}!"),
      (else_try),
        (play_sound, "snd_encounter_rb_destiny_slave"),
        (str_store_string, s4, "@It is your destiny to end your days chained to the oars of a slave galley. It is my destiny to make a tidy profit putting you there."),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_heretics_army, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_demonic_dialogue"),
    ]],

  [party_tpl|auto_proceed|pt_eyegrim, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_demonic_dialogue"),
    ]],

  [auto_proceed|anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "fac_singalians"),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 13),
        (str_store_string, s4, "@ Hail, outland scum. Today, at my hands, you shall greet the lord of death."),
        (play_sound, "snd_encounter_sing_1"),
      (else_try),
        (str_store_string, s4, "@ How opportune that we meet here today - the vultures who follow me are hungry."),
        (play_sound, "snd_encounter_sing_2"),
      (try_end),
    ]],

  [party_tpl|auto_proceed|pt_sea_raider_army, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (str_store_string, s4, "@ We have come to plunder this land! Stand aside or die!"),
      (else_try),
        (lt, reg1, 13),
        (str_store_string, s4, "@ If you must die this day outlander, keep your sword in your hand to prove you had a warriors death!"),
      (else_try),
        (lt, reg1, 14),
        (str_store_string, s4, "@ May your death be glorious!"),
      (try_end),
      (play_sound, "snd_encounter_vanskerry_army"),
    ]],

  [party_tpl|auto_proceed|pt_snake_cult_army, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "snake_cult_army_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (str_store_string, s4, "@ We have come to deliver the salvation from the mistress! Stand aside or die!"),
      (else_try),
        (lt, reg1, 13),
        (str_store_string, s4, "@ You look like a worthy sacrifice to our beloved mistress!"),
      (else_try),
        (str_store_string, s4, "@ So YOU are the snake hater? You look like food to me!"),
      (try_end),
      (store_character_level, reg1, "trp_player"),
      (try_begin),
        (lt, reg1, 4),
        (str_store_string, s3, "@Snakes... I hate snakes... except for belts and boots... which are you?"),
      (else_try),
        (str_store_string, s3, "@I promise that I will burn every last snake I can find."),
      (try_end),
      (play_sound, "snd_encounter_welcome_snake_cult_army"),
    ]],

  [party_tpl|pt_snake_cult_army, "snake_cult_army_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [party_tpl|auto_proceed|pt_dread_legion, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (call_script, "script_demonic_dialogue"),
    ]],

  [anyone, "generic_response_1",
    [],
    "{s4}",
    "companion_comment",
    [
      (call_script, "script_encounter_dialogue_response"),
      (assign, "$random_companion", 0),
    ]],

  [plyr|anyone, "companion_comment",
    [
      (eq, "$random_companion", 0),
      (assign, "$random_companion", -1),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 5),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (main_party_has_troop, ":var2"),
        (neg|troop_is_wounded, ":var2"),
        (val_add, ":var1", 1),
      (try_end),
      (gt, ":var1", 0),
      (store_random_in_range, ":var3", 0, ":var1"),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (ge, ":var3", 0),
        (main_party_has_troop, ":var2"),
        (neg|troop_is_wounded, ":var2"),
        (try_begin),
          (eq, ":var3", 0),
          (assign, "$random_companion", ":var2"),
        (try_end),
        (val_sub, ":var3", 1),
      (try_end),
      (store_sub, ":var4", "$random_companion", "trp_npc_adonja"),
      (store_add, ":var5", "str_npc_adonja_to_enemy_d", ":var4"),
      (str_store_string, s6, ":var5"),
      (store_add, reg13, "snd_adonja_to_enemy_d", ":var4"),
      (eq, 1, 0),
    ],
    "This should not show up.",
    "close_window",
    []],

  [anyone|other(trp_npc_adonja), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_adonja"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_leslie), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_leslie"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_ansen), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_ansen"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_riva), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_riva"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_kassim), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_kassim"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_lethaldiran), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_lethaldiran"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_jocelyn), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_jocelyn"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_alistair), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_alistair"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_rayne), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_rayne"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_julia), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_julia"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_frederick), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_frederick"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_ediz), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_ediz"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_sara), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_sara"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_donavan), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_donavan"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_diev), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_diev"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_alyssa), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_alyssa"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_roland), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_roland"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_kaverra), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_kaverra"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_sigismund), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_sigismund"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone|other(trp_npc_boadice), "companion_comment",
    [
      (eq, "$random_companion", "trp_npc_boadice"),
      (play_sound, reg13),
    ],
    "{s6}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [plyr|anyone, "companion_comment",
    [
      (eq, "$random_companion", -1),
    ],
    "{s3}",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|auto_proceed|pt_peasant_army, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "generic_response_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (str_store_string, s4, "@ We are taking back what you nobles have stolen from us!"),
      (else_try),
        (lt, reg1, 13),
        (str_store_string, s4, "@ Get {reg63?him:her} Lads! Hang {reg63?him:her} from that oak over there as a message to all the highborns that we have had enough!"),
      (else_try),
        (lt, reg1, 14),
        (str_store_string, s4, "@ At {reg63?him:her} lads! Strip {reg63?his:her} body and feed it to the dogs!"),
      (try_end),
      (play_sound, "snd_encounter_peasant_army"),
    ]],

  [party_tpl|auto_proceed|pt_brouhaha, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Warning: This line should never be displayed.",
    "brouhaha_1",
    [
      (store_random_in_range, reg1, 11, 14),
      (try_begin),
        (lt, reg1, 12),
        (str_store_string, s4, "@ We are taking back the land for the people! <hic>!"),
      (else_try),
        (lt, reg1, 13),
        (str_store_string, s4, "@ You got ale? We are running low and ya know.. can't run an army without ale!"),
      (else_try),
        (lt, reg1, 14),
        (str_store_string, s4, "@ Wanna drink? Or maybe you want to fight sober?"),
      (try_end),
      (play_sound, "snd_encounter_peasant_army"),
    ]],

  [party_tpl|pt_brouhaha, "brouhaha_1",
    [],
    "{s4}",
    "brouhaha_2",
    []],

  [plyr|party_tpl|pt_brouhaha, "brouhaha_2",
    [],
    "Ha! Drinks are a great idea... no reason to spill blood!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|party_tpl|pt_brouhaha, "brouhaha_2",
    [],
    "Hold your ale, mendicant, and your tongue!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_village_farmers, "start",
    [
      (eq, "$talk_context", 2),
      (check_quest_active, "qst_escort_peasants"),
      (quest_slot_eq, "qst_escort_peasants", 8, "$g_encountered_party"),
      (agent_play_sound, "$g_talk_agent", "snd_encounter_farmers"),
    ],
    "My {reg63?lord:lady}, we are so glad you are escorting us to {s11}. Please stay close, we heard rumors about Red Brotherhood gangs preying on travelers going this way.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_escort_peasants", 1),
      (str_store_party_name, s11, ":var0"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_village_farmers, "start",
    [
      (eq, "$talk_context", 2),
      (agent_play_sound, "$g_talk_agent", "snd_encounter_farmers"),
    ],
    "My {reg63?lord:lady}, we're only poor farmers from the village of {s11}. {reg1?We are taking our products to the market at {s12}.:We are returning from the market at {s12} back to our village.}",
    "village_farmer_talk",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 5),
      (party_get_slot, ":var1", "$g_encountered_party", 123),
      (party_get_slot, ":var2", ":var1", 121),
      (str_store_party_name, s11, ":var1"),
      (str_store_party_name, s12, ":var2"),
      (assign, reg1, 1),
      (try_begin),
        (party_slot_eq, ":var0", 0, 4),
        (assign, reg1, 0),
      (try_end),
    ]],

  [plyr|anyone, "village_farmer_talk",
    [
      (check_quest_active, "qst_track_down_bandits"),
      (neg|check_quest_succeeded, "qst_track_down_bandits"),
    ],
    "I am hunting a group of bandits with the following description... Have you seen them?",
    "farmer_bandit_information",
    []],

  [anyone, "farmer_bandit_information",
    [
      (call_script, "script_get_manhunt_information_to_s15", "qst_track_down_bandits"),
    ],
    "{s15}",
    "village_farmer_talk",
    []],

  [plyr|anyone, "village_farmer_talk",
    [
      (store_faction_of_party, ":var0", "$g_encountered_party"),
      (neq, ":var0", "$players_kingdom"),
      (neq, ":var0", "fac_player_supporters_faction"),
    ],
    "We'll see how poor you are after I take what you've got!",
    "close_window",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (party_get_slot, ":var1", ":var0", 121),
      (party_get_slot, ":var2", ":var0", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", -4),
      (call_script, "script_change_player_relation_with_center", ":var1", -2),
      (call_script, "script_change_player_relation_with_troop", ":var2", -2),
      (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
      (store_relation, ":var3", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (try_begin),
        (gt, ":var3", 0),
        (val_sub, ":var3", 5),
      (try_end),
      (val_sub, ":var3", 3),
      (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var3"),
      (assign, "$encountered_party_hostile", 1),
      (assign, "$encountered_party_friendly", 0),
    ]],

  [plyr|anyone, "village_farmer_talk",
    [],
    "Carry on, then. Farewell.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_refugees, "start",
    [
      (eq, "$talk_context", 2),
      (agent_play_sound, "$g_talk_agent", "snd_encounter_farmers"),
    ],
    "My {reg63?lord:lady}, Please do us no harm. We are from {s11}, and managed to escape the carnage with our lives and little else. We are outcasts now, seeking a new home. ",
    "refugee_1",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (str_store_party_name, s11, ":var0"),
    ]],

  [plyr|party_tpl|pt_refugees, "refugee_1",
    [],
    "Well.. that makes you easy pickings!",
    "close_window",
    [
      (call_script, "script_change_player_honor", -2),
      (encounter_attack),
    ]],

  [plyr|party_tpl|pt_refugees, "refugee_1",
    [],
    "Best of luck to you. Farewell.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_refugees_guarded, "start",
    [
      (eq, "$talk_context", 2),
      (agent_play_sound, "$g_talk_agent", "snd_encounter_farmers"),
    ],
    "My {reg63?lord:lady}; Hail and well met! We are from {s11}, and managed to fight out way out of the carnage with our lives and little else. We are outcasts now, seeking a new home. ",
    "refugee_g1",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 123),
      (str_store_party_name, s11, ":var0"),
    ]],

  [plyr|party_tpl|pt_refugees_guarded, "refugee_g1",
    [],
    "Well.. that makes you easy pickings!",
    "close_window",
    [
      (call_script, "script_change_player_honor", -2),
      (encounter_attack),
    ]],

  [plyr|party_tpl|pt_refugees_guarded, "refugee_g1",
    [],
    "I offer you my protection, join ranks with me.",
    "refugee_g2",
    [
      (store_random_in_range, reg9, 0, 200),
      (try_begin),
        (lt, reg9, 100),
        (str_store_string, s4, "@ Thank you {reg63?m'lord:m'Lady}, we will be your most loyal subjects!"),
        (change_screen_exchange_members, 1),
      (else_try),
        (str_store_string, s4, "@ Thank you {reg63?m'lord:m'Lady}, take no offense, but we are expected elsewhere."),
      (try_end),
    ]],

  [party_tpl|pt_refugees_guarded, "refugee_g2",
    [],
    "{s4}.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|party_tpl|pt_refugees_guarded, "refugee_g1",
    [],
    "Best of luck to you. Farewell.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (gt, "$g_talk_troop", 0),
      (eq, "$g_talk_troop", "$g_player_minister"),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "I am at your service, {reg63?sire:my lady}",
    "minister_issues",
    []],

  [anyone, "start",
    [
      (eq, "$g_talk_troop", "trp_temporary_minister"),
      (neq, "$g_talk_troop", "$g_player_minister"),
    ],
    "It has been an honor to serve you, {reg63?sire:my lady}",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 5),
      (party_slot_eq, "$g_encountered_party", 0, 2),
      (party_get_num_companion_stacks, ":var0", "$g_encountered_party"),
      (ge, ":var0", 1),
      (party_stack_get_troop_id, ":var1", "$g_encountered_party", 0),
      (eq, ":var1", "$g_talk_troop"),
      (eq, "$talk_context", 0),
    ],
    "Yes, {playername}? What can I do for you?",
    "member_castellan_talk",
    []],

  [anyone, "member_castellan_pretalk",
    [],
    "Anything else?",
    "member_castellan_talk",
    []],

  [plyr|anyone, "member_castellan_talk",
    [],
    "I want to review the castle garrison.",
    "member_review_castle_garrison",
    []],

  [anyone, "member_review_castle_garrison",
    [],
    "Of course. Here are our lists, let me know of any changes you require...",
    "member_castellan_pretalk",
    [
      (change_screen_exchange_members, 0),
    ]],

  [plyr|anyone, "member_castellan_talk",
    [],
    "Let me see your equipment.",
    "member_review_castellan_equipment",
    []],

  [anyone, "member_review_castellan_equipment",
    [],
    "Very well, it's all here...",
    "member_castellan_pretalk",
    [
      (change_screen_equip_other),
    ]],

  [plyr|anyone, "member_castellan_talk",
    [],
    "I want you to abandon the castle and join my party.",
    "member_castellan_join",
    []],

  [anyone, "member_castellan_join",
    [
      (party_can_join_party, "$g_encountered_party", "p_main_party"),
    ],
    "I've grown quite fond of the place... But if it is your wish, {playername}, I'll come with you.",
    "close_window",
    [
      (assign, "$g_move_heroes", 1),
      (call_script, "script_party_add_party", "p_main_party", "$g_encountered_party"),
      (party_clear, "$g_encountered_party"),
    ]],

  [anyone, "member_castellan_join",
    [],
    "And where would we sleep? You're dragging a whole army with you, {playername}, there's no more room for all of us.",
    "member_castellan_pretalk",
    []],

  [plyr|anyone, "member_castellan_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [trp_kidnapped_girl, "member_chat",
    [],
    "Are we home yet?",
    "kidnapped_girl_chat_1",
    []],

  [plyr|trp_kidnapped_girl, "kidnapped_girl_chat_1",
    [],
    "Not yet.",
    "kidnapped_girl_chat_2",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_chat_2",
    [],
    "I can't wait to get back. I've missed my family so much, I'd give anything to see them again.",
    "close_window",
    []],

  [trp_kidnapped_daughter, "member_chat",
    [],
    "Please take me home to my village, my {reg63?lord:lady}. The things they have said they'd do to me... are too terrible to mention.",
    "close_window",
    []],

  [anyone, "member_chat",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
    ],
    "{playername}, when do you think we can reach our destination?",
    "member_lady_1",
    []],

  [plyr|anyone, "member_lady_1",
    [],
    "We still have a long way ahead of us.",
    "member_lady_2a",
    []],

  [plyr|anyone, "member_lady_1",
    [],
    "Very soon. We're almost there.",
    "member_lady_2b",
    []],

  [anyone, "member_lady_2a",
    [],
    "Ah, I am going to enjoy the road for a while longer then. I won't complain. I find riding out in the open so much more pleasant than sitting in the castle all day. You know, I envy you. You can live like this all the time.",
    "close_window",
    []],

  [anyone, "member_lady_2b",
    [],
    "That's good news. Not that I don't like your company, but I did miss my little luxuries. Still I am sorry that I'll leave you soon. You must promise me, you'll come visit me when you can.",
    "close_window",
    []],

  [anyone, "member_chat",
    [
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
    ],
    "Greetings, {playername}, my first and foremost vassal. I await your counsel.",
    "supported_pretender_talk",
    []],

  [anyone, "supported_pretender_pretalk",
    [],
    "Anything else?",
    "supported_pretender_talk",
    []],

  [plyr|anyone, "supported_pretender_talk",
    [],
    "What do you think about our progress so far?",
    "pretender_progress",
    []],

  [anyone, "pretender_progress",
    [
      (assign, reg11, 0),
      (assign, reg13, 0),
      (assign, reg14, 0),
      (assign, reg15, 0),
      (assign, reg21, 0),
      (assign, reg23, 0),
      (assign, reg24, 0),
      (assign, reg25, 0),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (store_troop_faction, ":var1", ":var0"),
        (try_begin),
          (eq, ":var1", "fac_player_supporters_faction"),
          (neq, ":var0", "trp_player"),
          (neq, ":var0", "$supported_pretender"),
          (val_add, reg11, 1),
        (else_try),
          (eq, ":var1", "$supported_pretender_old_faction"),
          (neg|faction_slot_eq, "$supported_pretender_old_faction", 11, ":var0"),
          (val_add, reg21, 1),
        (try_end),
      (try_end),
      (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var3", ":var2"),
        (try_begin),
          (eq, ":var3", "fac_player_supporters_faction"),
          (try_begin),
            (party_slot_eq, ":var2", 0, 3),
            (val_add, reg13, 1),
          (else_try),
            (party_slot_eq, ":var2", 0, 2),
            (val_add, reg14, 1),
          (else_try),
            (party_slot_eq, ":var2", 0, 4),
            (val_add, reg15, 1),
          (try_end),
        (else_try),
          (eq, ":var3", "$supported_pretender_old_faction"),
          (try_begin),
            (party_slot_eq, ":var2", 0, 3),
            (val_add, reg23, 1),
          (else_try),
            (party_slot_eq, ":var2", 0, 2),
            (val_add, reg24, 1),
          (else_try),
            (party_slot_eq, ":var2", 0, 4),
            (val_add, reg25, 1),
          (try_end),
        (try_end),
      (try_end),
      (store_add, reg19, reg13, reg14),
      (val_add, reg19, reg15),
      (store_add, reg29, reg23, reg24),
      (val_add, reg29, reg25),
      (store_add, ":var4", reg13, reg14),
      (val_add, ":var4", reg11),
      (store_add, ":var5", reg23, reg24),
      (val_add, ":var5", reg21),
      (store_add, ":var6", ":var4", ":var5"),
      (val_mul, ":var4", 100),
      (store_div, ":var7", ":var4", ":var6"),
      (try_begin),
        (lt, ":var7", 10),
        (str_store_string, s30, "@we have made very little progress so far"),
      (else_try),
        (lt, ":var7", 30),
        (str_store_string, s30, "@we have succeeded in gaining some ground, but we still have a long way to go"),
      (else_try),
        (lt, ":var7", 50),
        (str_store_string, s30, "@we have become a significant force, and we have an even chance of victory"),
      (else_try),
        (lt, ":var7", 75),
        (str_store_string, s30, "@we are winning the war, but our enemies are still holding on."),
      (else_try),
        (str_store_string, s30, "@we are on the verge of victory. The remaining enemies pose no threat, but we still need to hunt them down."),
      (try_end),
      (faction_get_slot, ":var8", "$supported_pretender_old_faction", 11),
      (str_store_troop_name, s9, ":var8"),
    ],
    "{reg11?We have {reg11} lords on our side:We have no lord with us yet}, whereas {reg21?{s9} still has {reg21} lords supporting him:{s9} has no loyal lords left}. {reg19?We control {reg13?{reg13} towns:} {reg14?{reg14} castles:} {reg15?and {reg15} villages:}:We don't control any settlements}, while {reg29?they have {reg23?{reg23} towns:} {reg24?{reg24} castles:} {reg25?and {reg25} villages:}:they have no remaining settlements}. Overall, {s30}.",
    "pretender_progress_2",
    []],

  [plyr|anyone, "pretender_progress_2",
    [],
    "Then, we must keep fighting and rally our supporters!",
    "supported_pretender_pretalk",
    []],

  [plyr|anyone, "pretender_progress_2",
    [],
    "It seems this rebellion is not going anywhere. We must give up.",
    "pretender_quit_rebel_confirm",
    []],

  [anyone, "pretender_quit_rebel_confirm",
    [],
    "{playername}, you can't abandon me now. Are you serious?",
    "pretender_quit_rebel_confirm_2",
    []],

  [plyr|anyone, "pretender_quit_rebel_confirm_2",
    [],
    "Indeed, I am. I can't support you any longer.",
    "pretender_quit_rebel_confirm_3",
    []],

  [plyr|anyone, "pretender_quit_rebel_confirm_2",
    [],
    "I was jesting. I will fight for you until we succeed.",
    "supported_pretender_pretalk",
    []],

  [anyone, "pretender_quit_rebel_confirm_3",
    [],
    "Are you absolutely sure? I will never forgive you if you abandon my cause.",
    "pretender_quit_rebel_confirm_4",
    []],

  [plyr|anyone, "pretender_quit_rebel_confirm_4",
    [],
    "I am sure.",
    "pretender_quit_rebel",
    []],

  [plyr|anyone, "pretender_quit_rebel_confirm_4",
    [],
    "Let me think about this some more.",
    "supported_pretender_pretalk",
    []],

  [anyone, "pretender_quit_rebel",
    [],
    "So be it. Then my cause is lost. There is only one thing to do for me now. I will go from Pendor and never come back. With me gone, you may try to make your peace with {s4}.",
    "close_window",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s4, ":var1"),
      (try_for_parties, ":var2"),
        (neq, ":var2", "p_main_party"),
        (store_faction_of_party, ":var3", ":var2"),
        (eq, ":var3", "fac_player_supporters_faction"),
        (party_get_num_prisoner_stacks, ":var4", ":var2"),
        (try_for_range_backwards, ":var5", 0, ":var4"),
          (party_prisoner_stack_get_troop_id, ":var6", ":var2", ":var5"),
          (try_begin),
            (troop_is_hero, ":var6"),
            (call_script, "script_remove_troop_from_prison", ":var6"),
          (try_end),
          (party_prisoner_stack_get_size, ":var7", ":var2", ":var5"),
          (party_remove_prisoners, ":var2", ":var6", ":var7"),
        (try_end),
      (try_end),
      (try_for_range, ":var8", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var8", 2, 2),
        (store_troop_faction, ":var9", ":var8"),
        (eq, ":var9", "fac_player_supporters_faction"),
        (call_script, "script_change_troop_faction", ":var8", ":var0"),
      (try_end),
      (faction_set_slot, "fac_player_supporters_faction", 11, "trp_player"),
      (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var9", ":var10"),
        (eq, ":var9", "fac_player_supporters_faction"),
        (call_script, "script_give_center_to_faction_aux", ":var10", ":var0"),
      (try_end),
      (party_remove_members, "p_main_party", "$supported_pretender", 1),
      (faction_set_slot, ":var0", 60, 0),
      (assign, "$supported_pretender", 0),
      (call_script, "script_deactivate_player_faction"),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_fail_quest", "qst_rebel_against_kingdom"),
      (call_script, "script_end_quest", "qst_rebel_against_kingdom"),
    ]],

  [plyr|anyone, "supported_pretender_talk",
    [],
    "If it would please you, can you tell me about your skills?",
    "pretneder_view_char_requested",
    []],

  [anyone, "pretneder_view_char_requested",
    [],
    "Well, all right.",
    "supported_pretender_pretalk",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "supported_pretender_talk",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (party_slot_eq, ":var1", 7, -1),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "I suggest that you decide who should hold a fief that does not have a lord.",
    "supported_pretender_grant_fief",
    []],

  [anyone, "supported_pretender_grant_fief",
    [],
    "Which fief did you have in mind?",
    "supported_pretender_grant_fief_select",
    []],

  [repeat_for_parties|plyr|anyone, "supported_pretender_grant_fief_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (party_slot_eq, ":var0", 7, -1),
      (str_store_party_name, s4, ":var0"),
    ],
    "{s4}",
    "supported_pretender_grant_fief_choose_recipient",
    [
      (store_repeat_object, "$g_center_taken_by_player_faction"),
    ]],

  [anyone, "supported_pretender_grant_fief_choose_recipient",
    [],
    "And who should receive it?",
    "center_captured_rebellion",
    [
      (str_store_party_name, s4, "$g_center_taken_by_player_faction"),
    ]],

  [plyr|anyone, "supported_pretender_grant_fief_select",
    [],
    "Never mind.",
    "supported_pretender_pretalk",
    []],

  [plyr|anyone, "supported_pretender_talk",
    [],
    "Let us keep going, {reg65?my lady:sir}.",
    "close_window",
    []],

  [anyone, "do_member_trade",
    [],
    "Anything else?",
    "member_talk",
    []],

  [anyone, "member_pretalk",
    [],
    "Anything else?",
    "member_talk",
    []],

  [anyone, "member_chat",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (troop_is_hero, "$g_talk_troop"),
      (troop_get_slot, ":var0", "$g_talk_troop", 130),
      (str_store_string, s5, ":var0"),
    ],
    "Yes, {s5}?",
    "member_talk",
    [
      (try_begin),
        (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (372, 46),
      (try_end),
    ]],

  [plyr|anyone, "member_talk",
    [
      (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "As marshal, I wish for you to send a message to the vassals of the realm",
    "member_direct_campaign",
    []],

  [plyr|anyone, "member_talk",
    [],
    "Let me see your equipment.",
    "member_trade",
    []],

  [anyone, "member_trade",
    [
      (eq, "$g_talk_troop", "trp_npc_lethaldiran"),
      (store_character_level, ":var0", "trp_player"),
      (lt, ":var0", 30),
    ],
    "I can't allow humans to handle my Noldor equipment, I'm sorry.^^^^^[unlocks at level 30]",
    "do_member_trade",
    []],

  [anyone, "member_trade",
    [],
    "Very well, it's all here...",
    "do_member_trade",
    [
      (change_screen_equip_other),
    ]],

  [anyone, "do_member_trade",
    [],
    "Anything else?",
    "member_talk",
    []],

  [plyr|anyone, "member_talk",
    [],
    "What can you tell me about your skills?",
    "view_member_char_requested",
    []],

  [anyone, "view_member_char_requested",
    [],
    "All right, let me tell you...",
    "do_member_view_char",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "member_talk",
    [
      (eq, "$g_camp_talk", 0),
    ],
    "We need to separate for a while.",
    "member_separate",
    [
      (call_script, "script_npc_morale", "$g_talk_troop"),
      (assign, "$npc_quit_morale", reg0),
    ]],

  [anyone, "member_separate",
    [
      (gt, "$npc_quit_morale", 30),
    ],
    "Oh really? Well, I'm not just going to wait around here. I'm going to go to the towns to look for other work. Is that what you want?",
    "member_separate_confirm",
    []],

  [anyone, "member_separate",
    [],
    "Well, actually, there was something I needed to tell you.",
    "companion_quitting",
    [
      (assign, "$player_can_refuse_npc_quitting", 0),
      (assign, "$player_can_persuade_npc", 0),
    ]],

  [plyr|anyone, "member_separate_confirm",
    [],
    "That's right. We need to part ways.",
    "member_separate_yes",
    []],

  [plyr|anyone, "member_separate_confirm",
    [],
    "No, I'd rather have you at my side.",
    "do_member_trade",
    []],

  [anyone, "member_separate_yes",
    [],
    "Well. I'll be off, then. Look me up if you need me.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 2, 0),
      (troop_set_slot, "$g_talk_troop", 82, 2),
      (remove_member_from_party, "$g_talk_troop"),
    ]],

  [plyr|anyone, "member_talk",
    [],
    "I'd like to ask you something.",
    "member_question",
    []],

  [plyr|anyone, "member_talk",
    [],
    "I'd like to talk to you about how you manage your equipment.",
    "member_automanage_report",
    []],

  [anyone, "member_automanage_report",
    [
      (eq, "$g_talk_troop", "trp_npc_lethaldiran"),
      (store_character_level, ":var0", "trp_player"),
      (lt, ":var0", 30),
    ],
    "There is nothing to speak about, human.^^^^^[unlocks at level 30]",
    "member_talk",
    []],

  [anyone, "member_automanage_report",
    [
      (store_conversation_troop, reg3),
      (call_script, "script_print_wpn_upgrades_to_s0", reg3),
      (str_store_string, s2, "@My weapon slot upgrades are as follows:^{s15}"),
      (troop_get_slot, reg4, reg3, 163),
      (val_add, reg4, "str_hero_not_upgrading_armor"),
      (str_store_string, s1, reg4),
      (troop_get_slot, reg4, reg3, 164),
      (val_add, reg4, "str_hero_not_upgrading_horse"),
      (str_store_string, s4, reg4),
    ],
    "I'm currently {s1} and {s4}. {s2}",
    "member_automanage_change",
    []],

  [plyr|anyone, "member_automanage_change",
    [
      (troop_get_slot, reg4, reg3, 163),
      (neq, reg4, 0),
    ],
    "Stop acquiring new armor.",
    "member_automanage_clear_armor",
    [
      (troop_set_slot, reg3, 163, 0),
    ]],

  [anyone, "member_automanage_clear_armor",
    [],
    "All right. I won't acquire any armor on my own until you tell me otherwise.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [
      (troop_get_slot, reg4, reg3, 163),
      (eq, reg4, 0),
    ],
    "Start upgrading your armor on your own.",
    "member_automanage_set_armor",
    [
      (troop_set_slot, reg3, 163, 1),
    ]],

  [anyone, "member_automanage_set_armor",
    [],
    "All right. I will upgrade my armor whenever I can.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [],
    "Let's talk about how you upgrade your weapons.",
    "member_automanage_select_melee_1",
    []],

  [anyone, "member_automanage_select_melee_1",
    [
      (call_script, "script_print_wpn_upgrades_to_s0", reg3),
      (str_store_string, s2, "@My weapon slot upgrades are as follows:^{s15}"),
    ],
    "{s2}^^What would you like to change?",
    "member_automanage_select_melee",
    []],

  [plyr|anyone, "member_automanage_select_melee",
    [],
    "Upgrade your weapons as follows....",
    "member_automanage_select_melee_2",
    [
      (assign, reg1, 0),
    ]],

  [anyone, "member_automanage_select_melee_2",
    [
      (call_script, "script_print_wpn_upgrades_to_s0", reg3),
      (try_begin),
        (eq, reg1, 4),
        (str_store_string, s2, "@Is this satisfactory?"),
      (else_try),
        (str_store_string, s2, "@Select the type of item for slot {reg1}."),
      (try_end),
    ],
    "My current weapon upgrade settings are:^{s15}^^{s2}",
    "member_automanage_select_melee_slot",
    []],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 0, "str_hero_wpn_slot_none"),
      (troop_get_inventory_slot, ":var1", reg3, reg1),
      (try_begin),
        (ge, ":var1", 0),
        (str_store_item_name, s10, ":var1"),
      (else_try),
        (str_store_string, s10, "str_none"),
      (try_end),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 0),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 2, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 2),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 3, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 3),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 4, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 4),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 5, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 5),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 6, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 6),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 7, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 7),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 8, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 8),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 9, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 9),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (neq, reg1, 4),
      (store_add, ":var0", 10, "str_hero_wpn_slot_none"),
      (str_store_string, s1, ":var0"),
    ],
    "{s1}",
    "member_automanage_select_melee_2",
    [
      (store_add, ":var0", reg1, 165),
      (troop_set_slot, reg3, ":var0", 10),
      (val_add, reg1, 1),
    ]],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (eq, reg1, 4),
    ],
    "Yes.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_select_melee_slot",
    [
      (eq, reg1, 4),
    ],
    "No, let me select again.",
    "member_automanage_select_melee_2",
    [
      (assign, reg1, 0),
    ]],

  [plyr|anyone, "member_automanage_select_melee",
    [],
    "Nevermind.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [
      (troop_get_slot, reg4, reg3, 164),
      (neq, reg4, 0),
    ],
    "Stop acquiring new horses.",
    "member_automanage_clear_horses",
    [
      (troop_set_slot, reg3, 164, 0),
    ]],

  [anyone, "member_automanage_clear_horses",
    [],
    "All right. I won't acquire any horses on my own until you tell me otherwise.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [
      (troop_get_slot, reg4, reg3, 164),
      (neq, reg4, 1),
    ],
    "Start upgrading your horse on your own.",
    "member_automanage_set_horses",
    [
      (troop_set_slot, reg3, 164, 1),
    ]],

  [anyone, "member_automanage_set_horses",
    [],
    "All right. I will now upgrade to better horses whenever I can.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [],
    "Make all party members upgrade as you do now.",
    "member_automanage_set_all_get_confirm",
    []],

  [anyone, "member_automanage_set_all_get_confirm",
    [],
    "Are you sure you want everyone to upgrade as I do?",
    "member_automanage_set_all_confirm",
    []],

  [plyr|anyone, "member_automanage_set_all_confirm",
    [],
    "Yes, do it.",
    "member_automanage_set_all",
    [
      (call_script, "script_copy_upgrade_to_all_heroes", reg3),
    ]],

  [plyr|anyone, "member_automanage_set_all_confirm",
    [],
    "No, I changed my mind.",
    "member_automanage_report",
    []],

  [anyone, "member_automanage_set_all",
    [],
    "All right. I will order everyone to upgrade as I do.",
    "member_automanage_report",
    []],

  [plyr|anyone, "member_automanage_change",
    [],
    "I'm done, let's talk about something else.",
    "do_member_view_char",
    []],

  [plyr|anyone, "member_talk",
    [
      (troop_slot_eq, "$g_talk_troop", 403, 0),
    ],
    "Stay back from the fighting, can't risk you getting hurt.",
    "member_dont_fight_okay",
    []],

  [anyone, "member_dont_fight_okay",
    [],
    "Of course, I'll stay back from now on. However, I will join the fray if we do not have enough warriors to fight.",
    "member_talk",
    [
      (call_script, "script_dont_fight_okay", "$g_talk_troop"),
      (display_message, "@This companion will now be placed at the last place in the party each time a battle starts.", 0x44E529),
    ]],

  [plyr|anyone, "member_talk",
    [
      (troop_slot_eq, "$g_talk_troop", 403, 1),
    ],
    "I need you to join the fighting again",
    "member_do_fight_okay",
    []],

  [anyone, "member_do_fight_okay",
    [],
    "As you wish.",
    "member_talk",
    [
      (call_script, "script_you_can_fight_okay", "$g_talk_troop"),
    ]],

  [plyr|anyone, "member_talk",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "member_question",
    [],
    "Very well. What did you want to ask?",
    "member_question_2",
    []],

  [plyr|anyone, "member_question_2",
    [],
    "How do you feel about the way things are going in this company?",
    "member_morale",
    []],

  [plyr|anyone, "member_question_2",
    [],
    "Tell me your story again.",
    "member_background_recap",
    []],

  [plyr|anyone, "member_question_2",
    [
      (troop_slot_eq, "$g_talk_troop", 142, 0),
    ],
    "I suppose you know that I aspire to be {reg63?king:queen} of this land?",
    "member_kingsupport_1",
    []],

  [plyr|anyone, "member_question_2",
    [],
    "Do you have any connections that we could use to our advantage?",
    "member_intelgathering_1",
    []],

  [plyr|anyone, "member_question_2",
    [
      (eq, "$event_rand_1_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 20),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "We are in need of more soldiers. Could you help the party somehow?",
    "ask_companions_for_unique_troops",
    [
      (call_script, "script_ask_companions_for_unique_troops", "$g_talk_troop", 1),
    ]],

  [plyr|anyone, "member_question_2",
    [
      (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    ],
    "Would you be interested in holding a fief?",
    "member_fief_grant_1",
    []],

  [plyr|anyone, "member_question_2",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_village_1"),
        (party_slot_eq, ":var1", 289, "trp_player_knight"),
        (party_slot_eq, ":var1", 7, "trp_player"),
        (assign, ":var0", 1),
      (try_end),
      (str_store_faction_name, s2, "fac_player_knights"),
      (eq, ":var0", 1),
    ],
    "I would like you to train the knights and sergeants of the {s2}.",
    "member_train_order_1",
    []],

  [plyr|anyone, "member_question_2",
    [],
    "Never mind.",
    "member_question_2_return",
    []],

  [anyone, "member_question_2_return",
    [],
    "Anything else?",
    "member_talk",
    []],

  [anyone, "member_morale",
    [
      (call_script, "script_npc_morale", "$g_talk_troop"),
    ],
    "{s21}",
    "do_member_trade",
    []],

  [anyone, "member_background_recap",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 59),
      (str_store_party_name, s20, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 60),
      (str_store_party_name, s21, ":var1"),
      (troop_get_slot, ":var2", "$g_talk_troop", 129),
      (str_store_string, s5, ":var2"),
    ],
    "{s5}",
    "member_background_recap_2",
    []],

  [anyone, "member_background_recap_2",
    [
      (str_clear, s19),
      (troop_get_slot, ":var0", "$g_talk_troop", 105),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "member_background_recap_3",
    []],

  [anyone, "member_background_recap_3",
    [],
    "Then shortly after, I joined up with you.",
    "do_member_trade",
    []],

  [anyone, "do_member_view_char",
    [],
    "Anything else?",
    "member_talk",
    []],

  [anyone, "member_kingsupport_1",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 69),
      (gt, ":var0", 10),
    ],
    "Um... Yes. I had heard.",
    "do_member_trade",
    []],

  [anyone, "member_kingsupport_1",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_1", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "member_kingsupport_1a",
    []],

  [plyr|anyone, "member_kingsupport_1a",
    [],
    "Would you then support my cause?",
    "member_kingsupport_2",
    []],

  [plyr|anyone, "member_kingsupport_1a",
    [],
    "Very good. I shall keep that in mind.",
    "do_member_trade",
    []],

  [anyone, "member_kingsupport_2",
    [
      (assign, ":var0", -1),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var1", 2, 5),
        (troop_get_slot, ":var2", ":var1", 151),
        (gt, ":var2", 17),
        (neg|main_party_has_troop, ":var1"),
        (troop_slot_eq, ":var1", 152, 1),
        (assign, ":var0", ":var1"),
      (try_end),
      (gt, ":var0", -1),
      (troop_get_slot, ":var3", "$g_talk_troop", 130),
      (str_store_string, s21, ":var3"),
      (str_store_troop_name, s22, ":var0"),
    ],
    "I would, {s21}. Moreover, I have a proposal on how I might help you attain your throne. But you recently sent {s22} off on a similar mission. Perhaps we should wait for a couple of weeks to avoid drawing too much attention to ourselves.",
    "do_member_trade",
    []],

  [anyone, "member_kingsupport_2",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_2", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "member_kingsupport_2a",
    []],

  [plyr|anyone, "member_kingsupport_2a",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_2a", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "member_kingsupport_3",
    []],

  [plyr|anyone, "member_kingsupport_2a",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_2b", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "do_member_trade",
    []],

  [anyone, "member_kingsupport_3",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_3", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "member_kingsupport_3a",
    []],

  [plyr|anyone, "member_kingsupport_3a",
    [],
    "Very good. You do that",
    "member_kingsupport_4",
    []],

  [plyr|anyone, "member_kingsupport_3a",
    [],
    "On second thought, stay with me for a while",
    "do_member_trade",
    []],

  [anyone, "member_kingsupport_4",
    [
      (troop_set_slot, "$g_talk_troop", 151, 21),
      (troop_set_slot, "$g_talk_troop", 152, 1),
      (remove_member_from_party, "$g_talk_troop", "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 130),
      (str_store_string, s21, ":var0"),
    ],
    "Farewell then, {s21}, for a little while",
    "close_window",
    []],

  [anyone, "member_intelgathering_1",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 67),
      (str_store_party_name, s17, ":var0"),
      (store_faction_of_party, ":var1", ":var0"),
      (str_store_faction_name, s18, ":var1"),
      (store_sub, ":var2", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var3", "str_npc_adonja_intel_mission", ":var2"),
      (str_store_string, s21, ":var3"),
    ],
    "{s21}",
    "member_intelgathering_3",
    []],

  [anyone, "member_intelgathering_3",
    [
      (eq, 1, 0),
    ],
    "Of course, as few people should know of this as possible. If you want to collect the information, or pull me out, then don't send a messenger. Come and get me yourself -- even if that means you have to sneak through the gates.",
    "member_intelgathering_3",
    []],

  [plyr|anyone, "member_intelgathering_3",
    [],
    "Splendid idea -- you do that.",
    "member_intelgathering_4",
    []],

  [plyr|anyone, "member_intelgathering_3",
    [],
    "Actually, hold off for now.",
    "do_member_trade",
    []],

  [anyone, "member_intelgathering_4",
    [
      (troop_set_slot, "$g_talk_troop", 151, 5),
      (troop_set_slot, "$g_talk_troop", 152, 2),
      (remove_member_from_party, "$g_talk_troop", "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 130),
      (str_store_string, s21, ":var0"),
    ],
    "Good. I should be ready to report in about five days. Farewell then, {s21}, for a little while.",
    "close_window",
    []],

  [anyone, "member_train_order_1",
    [
      (assign, ":var0", -1),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var1", 2, 5),
        (troop_slot_eq, ":var1", 152, 9),
        (neg|main_party_has_troop, ":var1"),
        (assign, ":var0", ":var1"),
      (try_end),
      (gt, ":var0", -1),
      (troop_get_slot, ":var2", "$g_talk_troop", 130),
      (str_store_string, s21, ":var2"),
      (str_store_troop_name, s22, ":var0"),
      (troop_get_slot, reg1, ":var0", 151),
    ],
    "That would not be very wise, {s21}. {s22} is already training the Order and we don't see eye-to-eye when it comes to training. I suggest you wait another {reg1} days for {s22}'s return, and then reconsider.",
    "do_member_trade",
    []],

  [anyone, "member_train_order_1",
    [
      (str_store_troop_name_plural, s11, "trp_player_knight"),
      (str_store_troop_name_plural, s12, "trp_player_sergeant"),
    ],
    "I would gladly do that. I guess I can teach your {s11} and {s12} a few tricks.^How long shall I train them?",
    "member_train_order_2",
    []],

  [plyr|anyone, "member_train_order_2",
    [],
    "A week would suffice.",
    "member_train_order_3",
    [
      (troop_set_slot, "$g_talk_troop", 151, 7),
    ]],

  [plyr|anyone, "member_train_order_2",
    [],
    "Two weeks seems reasonable.",
    "member_train_order_3",
    [
      (troop_set_slot, "$g_talk_troop", 151, 14),
    ]],

  [plyr|anyone, "member_train_order_2",
    [],
    "They would learn a lot in three weeks.",
    "member_train_order_3",
    [
      (troop_set_slot, "$g_talk_troop", 151, 21),
    ]],

  [plyr|anyone, "member_train_order_2",
    [],
    "Four weeks - give them your best.",
    "member_train_order_3",
    [
      (troop_set_slot, "$g_talk_troop", 151, 28),
    ]],

  [plyr|anyone, "member_train_order_2",
    [],
    "Actually, they are fine.",
    "do_member_trade",
    []],

  [anyone, "member_train_order_3",
    [
      (call_script, "script_copy_complete_troop", "trp_player_knight", "trp_player_knight_before_training", 0),
      (call_script, "script_copy_complete_troop", "trp_player_sergeant", "trp_player_sergeant_before_training", 0),
      (troop_set_slot, "$g_talk_troop", 152, 9),
      (remove_member_from_party, "$g_talk_troop", "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 130),
      (str_store_string, s21, ":var0"),
      (str_store_faction_name, s2, "fac_player_knights"),
      (troop_get_slot, reg1, "$g_talk_troop", 151),
    ],
    "Good. I should be ready to report in about {reg1} days. Rest assured, {s21}, you would be proud of the {s2} when I'm done with them.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (check_quest_finished, "qst_save_relative_of_merchant"),
    ],
    "Thank you again for all you've done.",
    "close_window",
    []],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 0),
    ],
    "{!}.",
    "merchant_quest_4_start",
    []],

  [anyone, "merchant_quest_4_start",
    [],
    "It's time, lads! Up and at them!",
    "close_window",
    [
      (try_for_agents, ":var0"),
        (agent_get_troop_id, ":var1", ":var0"),
        (ge, ":var1", "trp_looter"),
        (le, ":var1", "trp_dshar_chieftain"),
        (agent_set_team, ":var0", 1),
      (try_end),
      (get_player_agent_no, ":var2"),
      (assign, ":var3", 1000),
      (try_for_agents, ":var4"),
        (neq, ":var4", ":var2"),
        (agent_get_team, ":var5", ":var4"),
        (eq, ":var5", 0),
        (agent_get_position, pos0, ":var4"),
        (try_for_agents, ":var6"),
          (agent_get_team, ":var7", ":var6"),
          (eq, ":var7", 1),
          (agent_get_position, pos1, ":var6"),
          (get_distance_between_positions, ":var8", pos0, pos1),
          (le, ":var8", ":var3"),
          (assign, ":var3", ":var8"),
          (copy_position, pos2, pos1),
        (try_end),
        (agent_set_scripted_destination, ":var4", pos2, 0),
        (agent_set_speed_limit, ":var4", 10),
      (try_end),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_relative_of_merchant_sarleon", "trp_relative_of_merchants_end"),
      (try_begin),
        (check_quest_active, "qst_save_relative_of_merchant"),
        (call_script, "script_succeed_quest", "qst_save_relative_of_merchant"),
      (try_end),
      (str_store_party_name, s9, "$g_starting_town"),
      (str_store_string, s1, "@husband"),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_relative_of_merchant_sarleon"),
        (eq, "$g_talk_troop", "trp_relative_of_merchant_ravenstern"),
        (str_store_string, s1, "@brother"),
      (else_try),
        (this_or_next|eq, "$g_talk_troop", "trp_relative_of_merchant_fierdsvain"),
        (eq, "$g_talk_troop", "trp_relative_of_merchant_empire"),
        (str_store_string, s1, "@father"),
      (try_end),
      (assign, "$relative_of_merchant_is_found", 1),
    ],
    "Thank you! Thank you, {reg63?sir:my lady}, for rescuing me from those fiends. Did my {s1} in {s9} put you onto their track?",
    "relative_saved_1a",
    []],

  [plyr|anyone, "relative_saved_1a",
    [],
    "Yes. I told him that I would find you. I advise you to return to your family as quickly as you can -- and be careful on the road.",
    "close_window",
    []],

  [anyone, "start",
    [
      (check_quest_active, "qst_learn_where_merchant_brother_is"),
      (is_between, "$g_talk_troop", "trp_heretic_leader", "trp_bandit_leaders_end"),
      (eq, "$talk_context", 9),
    ],
    "Ay! Spare me! Spare my life! Let me go, and I'll go far away from here, and learn an honest trade, and you'll never hear of me again!",
    "bandit_leader_1a",
    []],

  [plyr|anyone, "bandit_leader_1a",
    [
      (is_between, "$g_talk_troop", "trp_heretic_leader", "trp_bandit_leaders_end"),
      (store_sub, ":var0", "$g_talk_troop", "trp_heretic_leader"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (str_store_string, s1, ":var1"),
      (assign, reg11, 0),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_myst_leader"),
        (eq, "$g_talk_troop", "trp_vanskerry_leader"),
        (assign, reg11, 1),
      (try_end),
    ],
    "I'll spare your life, but in exchange, I want information. Either you or your fellows kidnapped the {s1} of a prominent merchant in town. Tell me where you're hiding {reg11?him:her}, and give me your word that you'll stop troubling the people of these parts, and you can go free.",
    "bandit_leader_1b",
    []],

  [anyone, "start",
    [
      (check_quest_active, "qst_learn_where_merchant_brother_is"),
      (eq, "$talk_context", 2),
      (is_between, "$g_talk_troop", "trp_heretic_leader", "trp_bandit_leaders_end"),
    ],
    "What do you want?",
    "looter_leader_1",
    []],

  [plyr|anyone, "looter_leader_1",
    [
      (store_faction_of_party, ":var0", "$g_starting_town"),
      (try_begin),
        (eq, ":var0", "fac_kingdom_1"),
        (assign, ":var1", "trp_sarleon_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_2"),
        (assign, ":var1", "trp_ravenstern_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_3"),
        (assign, ":var1", "trp_dshar_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_4"),
        (assign, ":var1", "trp_fierdsvain_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_5"),
        (assign, ":var1", "trp_empire_merchant"),
      (try_end),
      (str_store_troop_name, s9, ":var1"),
    ],
    "I've been looking for you. Tell me where you keep your prisoners, and I'll let you go.",
    "looter_leader_2",
    []],

  [plyr|anyone, "looter_leader_1",
    [],
    "Nothing. We'll leave you in peace.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "looter_leader_2",
    [],
    "Hah! And did you bring silver in hopes of ransoming one of our captives?",
    "looter_leader_3",
    []],

  [plyr|anyone, "looter_leader_3",
    [],
    "No, but I brought steel.",
    "close_window",
    []],

  [anyone, "bandit_leader_1b",
    [
      (check_quest_active, "qst_learn_where_merchant_brother_is"),
      (is_between, "$g_talk_troop", "trp_heretic_leader", "trp_bandit_leaders_end"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 120, "$g_starting_town"),
        (val_add, ":var0", 1),
      (try_end),
      (store_random_in_range, ":var2", 0, ":var0"),
      (val_add, ":var2", 1),
      (try_for_range, ":var1", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 120, "$g_starting_town"),
        (val_sub, ":var2", 1),
        (eq, ":var2", 0),
        (assign, "$lair_neighboor_village", ":var1"),
      (try_end),
      (str_store_party_name_link, s9, "$lair_neighboor_village"),
      (set_spawn_radius, 4),
      (spawn_around_party, "$lair_neighboor_village", "pt_looter_lair"),
      (party_set_flags, reg0, 16384, 1),
      (assign, reg11, 0),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_myst_leader"),
        (eq, "$g_talk_troop", "trp_vanskerry_leader"),
        (assign, reg11, 1),
      (try_end),
    ],
    "Oh bless you, {reg63?sir:my lady}. Bless you. We've done {reg11?him:her} no harm. We've been keeping {reg11?him:her} in our camp near {s9}. I'll describe the area nearby in detail, so there's no mistaking it ...",
    "close_window",
    [
      (call_script, "script_succeed_quest", "qst_learn_where_merchant_brother_is"),
      (call_script, "script_reward_for_quest_per_player_level", 0, 100, 0, 0),
      (add_xp_as_reward, reg33),
      (display_message, "@Gained {reg33} XP"),
      (call_script, "script_end_quest", "qst_learn_where_merchant_brother_is"),
      (store_faction_of_party, ":var0", "$g_starting_town"),
      (try_begin),
        (eq, ":var0", "fac_kingdom_1"),
        (assign, ":var1", "trp_sarleon_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_2"),
        (assign, ":var1", "trp_ravenstern_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_3"),
        (assign, ":var1", "trp_dshar_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_4"),
        (assign, ":var1", "trp_fierdsvain_merchant"),
      (else_try),
        (eq, ":var0", "fac_kingdom_5"),
        (assign, ":var1", "trp_empire_merchant"),
      (try_end),
      (str_store_troop_name, s10, ":var1"),
      (store_sub, ":var2", "$g_talk_troop", "trp_heretic_leader"),
      (store_add, ":var3", "str_victim_sarleon", ":var2"),
      (str_store_string, s1, ":var3"),
      (str_store_string, s2, "str_find_the_lair_near_s9_and_free_the_brother_of_the_prominent_s10_merchant"),
      (call_script, "script_start_quest", "qst_save_relative_of_merchant", ":var1"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (check_quest_active, "qst_rescue_prisoner"),
      (check_quest_succeeded, "qst_rescue_prisoner"),
      (quest_slot_eq, "qst_rescue_prisoner", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_rescue_prisoner", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "{playername}, you saved him! Thank you ever so much for rescuing my {s11}. Please, take this as some small repayment for your noble deed.",
    "rescue_prisoner_succeed_2",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 9),
      (quest_get_slot, ":var0", "qst_rescue_prisoner", 2),
      (try_for_range, ":var1", "p_town_1", "p_castle_1"),
        (party_slot_eq, ":var1", 7, ":var0"),
        (call_script, "script_change_player_relation_with_center", ":var1", 1),
      (try_end),
      (call_script, "script_finish_quest_simple", "qst_rescue_prisoner", 100),
    ]],

  [plyr|anyone, "rescue_prisoner_succeed_2",
    [],
    "Always an honor to serve, {s65}.",
    "lord_pretalk",
    []],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 11),
      (eq, "$talked_with_merchant", 0),
    ],
    "{!}.",
    "start_up_quest_1_next",
    []],

  [anyone, "start_up_quest_1_next",
    [],
    "Are you all right? Well.... I guess you're alive, at any rate. I'm not sure that we can say the same for the other fellow. That's one less thief to trouble our streets at night, although Heaven knows he won't be the last.... Anyway, maybe you can help me with something. Let's talk more inside. Out here, we don't know who's listening.",
    "close_window",
    [
      (assign, "$talked_with_merchant", 1),
      (mission_disable_talk),
    ]],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var0", reg0),
      (assign, ":var1", 0),
      (try_begin),
        (check_quest_active, "qst_collect_men"),
        (neg|check_quest_succeeded, "qst_collect_men"),
        (le, ":var0", 4),
        (try_begin),
          (le, ":var0", 1),
          (str_store_string, s11, "str_please_sir_my_lady_go_find_some_volunteers_i_do_not_know_how_much_time_we_have"),
        (else_try),
          (str_store_string, s11, "str_you_need_more_men_sir_my_lady"),
        (try_end),
        (assign, ":var1", 1),
      (else_try),
        (check_quest_active, "qst_learn_where_merchant_brother_is"),
        (neg|check_quest_succeeded, "qst_learn_where_merchant_brother_is"),
        (store_sub, ":var2", "$g_talk_troop", "trp_sarleon_merchant"),
        (store_add, ":var3", "str_victim_sarleon", ":var2"),
        (str_store_string, s3, ":var3"),
        (str_store_string, s11, "str_do_not_waste_time_go_and_learn_where_my_brother_is"),
        (assign, ":var1", 1),
      (try_end),
      (eq, ":var1", 1),
    ],
    "{!}.",
    "start_up_quest_2_next",
    []],

  [anyone, "start_up_quest_2_next",
    [],
    "{!}{s11}",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (check_quest_active, "qst_collect_men"),
      (neg|check_quest_succeeded, "qst_duel_for_lady"),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (ge, reg0, 5),
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (store_add, ":var2", "str_bandits_sarleon", ":var0"),
      (str_store_string, s3, ":var1"),
      (str_store_string, s2, ":var2"),
      (str_store_party_name, s9, "$current_town"),
    ],
    "Splendid work. You have hired enough men to take on the {s2}. Travelers entering {s9} have told us that there is a small group of robbers lurking on the outside of town. I suspect that they are all from the same band, the one that took my {s3}. Hunt them down and defeat them, and make them disclose the location of their lair!",
    "merchant_quest_2a",
    [
      (call_script, "script_succeed_quest", "qst_collect_men"),
      (call_script, "script_reward_for_quest_per_player_level", 0, 80, 0, 0),
      (add_xp_as_reward, reg33),
      (display_message, "@Gained {reg33} XP"),
      (call_script, "script_end_quest", "qst_collect_men"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (check_quest_active, "qst_save_relative_of_merchant"),
      (neg|check_quest_succeeded, "qst_save_relative_of_merchant"),
      (str_store_party_name, s9, "$current_town"),
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (store_add, ":var2", "str_bandits_sarleon", ":var0"),
      (str_store_string, s1, ":var1"),
      (str_store_string, s2, ":var2"),
      (assign, reg11, 0),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_ravenstern_merchant"),
        (eq, "$g_talk_troop", "trp_fierdsvain_merchant"),
        (assign, reg11, 1),
      (try_end),
    ],
    "So, you've found out where they hid my {s1}? Splendid work. I flatter myself that I'm a fine judge of character, and you look to be a {reg63?man:woman} who can get things done. Now, go out and save {reg11?him:her} from the kidnappers!",
    "merchant_quest_3a",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (check_quest_active, "qst_save_relative_of_merchant"),
      (check_quest_succeeded, "qst_save_relative_of_merchant"),
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (str_store_string, s11, ":var1"),
      (assign, reg11, 0),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_ravenstern_merchant"),
        (eq, "$g_talk_troop", "trp_fierdsvain_merchant"),
        (assign, reg11, 1),
      (try_end),
    ],
    "Well... My {s11} is home safe. I'm not sure what to do with {reg11?him:her} to protect {reg11?him:her} from future folly. But that's not your problem. Here's the rest of your reward. It was well-earned.",
    "merchant_quest_3b",
    [
      (call_script, "script_reward_for_quest_per_player_level", 300, 100, 685, 70),
      (add_xp_as_reward, reg33),
      (display_message, "@Gained {reg33} XP"),
      (call_script, "script_troop_add_gold", "trp_player", reg34),
      (try_begin),
        (is_between, "$current_town", "p_town_1", "p_castle_1"),
        (party_get_slot, ":var0", "$current_town", 26),
        (val_add, ":var0", 5),
        (val_min, ":var0", 100),
        (party_set_slot, "$current_town", 26, ":var0"),
      (try_end),
      (call_script, "script_end_quest", "qst_save_relative_of_merchant"),
    ]],

  [plyr|anyone, "merchant_quest_3b",
    [],
    "The money is most welcome, and I am glad to have been of service.",
    "merchant_quest_4a",
    []],

  [anyone, "merchant_quest_4a",
    [],
    "Thank you, {playername}, and good luck in your travels.",
    "close_window",
    []],

  [plyr|anyone, "merchant_quest_2a",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (store_add, ":var2", "str_bandits_sarleon", ":var0"),
      (str_store_string, s1, ":var1"),
      (str_store_string, s3, ":var2"),
    ],
    "Very well. I shall hunt for {s3}.",
    "close_window",
    [
      (str_store_party_name, s9, "$current_town"),
      (str_store_string, s2, "str_start_up_quest_message_2"),
      (call_script, "script_start_quest", "qst_learn_where_merchant_brother_is", "$g_talk_troop"),
      (set_spawn_radius, 2),
      (spawn_around_party, "$current_town", "pt_leaded_looters"),
      (assign, ":var0", reg0),
      (store_sub, ":var1", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var2", "trp_heretic_leader", ":var1"),
      (party_add_leader, ":var0", ":var2"),
      (party_get_position, pos0, "$current_town"),
      (party_set_ai_behavior, ":var0", ai_bhvr_patrol_location),
      (party_set_ai_patrol_radius, ":var0", 3),
      (party_set_ai_target_position, ":var0", pos0),
    ]],

  [plyr|anyone, "merchant_quest_2a",
    [],
    "Why don't you come with us?",
    "merchant_quest_2a_whynotcome",
    []],

  [anyone, "merchant_quest_2a_whynotcome",
    [],
    "Because I'm paying you to go take care of it. But I respect your question. Now, what do you say?",
    "merchant_quest_2a",
    []],

  [plyr|anyone, "merchant_quest_2a",
    [],
    "I cannot deal with this matter at this time.",
    "close_window",
    []],

  [plyr|anyone, "merchant_quest_3a",
    [],
    "Very well. I go now to attack the {s2} in their lair, and find your {s1}.",
    "close_window",
    []],

  [plyr|anyone, "merchant_quest_3a",
    [],
    "I cannot deal with this matter at this time.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (this_or_next|eq, "$talk_context", 14),
      (neq, "$dialog_with_merchant_ended", 0),
      (assign, ":var0", 0),
      (try_begin),
        (neg|check_quest_succeeded, "qst_collect_men"),
        (neg|check_quest_active, "qst_collect_men"),
        (assign, ":var0", 1),
      (else_try),
        (neg|check_quest_active, "qst_collect_men"),
        (neg|check_quest_succeeded, "qst_learn_where_merchant_brother_is"),
        (neg|check_quest_active, "qst_learn_where_merchant_brother_is"),
        (assign, ":var0", 1),
      (else_try),
        (neg|check_quest_active, "qst_collect_men"),
        (neg|check_quest_active, "qst_learn_where_merchant_brother_is"),
        (neg|check_quest_succeeded, "qst_save_relative_of_merchant"),
        (neg|check_quest_active, "qst_save_relative_of_merchant"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "Ho there wanderer! If you have a moment, I would have a word.",
    "merchant_quest_persuasion",
    []],

  [plyr|anyone, "merchant_quest_persuasion",
    [
      (neg|check_quest_finished, "qst_collect_men"),
      (neg|check_quest_active, "qst_collect_men"),
    ],
    "Of course, what do you need?",
    "merchant_quest_1_prologue_1",
    []],

  [plyr|anyone, "merchant_quest_persuasion",
    [
      (check_quest_finished, "qst_collect_men"),
      (neg|check_quest_finished, "qst_learn_where_merchant_brother_is"),
      (neg|check_quest_active, "qst_learn_where_merchant_brother_is"),
    ],
    "You make a persuasive case. I will help you.",
    "merchant_quest_2",
    []],

  [plyr|anyone, "merchant_quest_persuasion",
    [
      (check_quest_finished, "qst_collect_men"),
      (check_quest_finished, "qst_learn_where_merchant_brother_is"),
      (neg|check_quest_finished, "qst_save_relative_of_merchant"),
      (neg|check_quest_active, "qst_save_relative_of_merchant"),
    ],
    "You make a persuasive case. I will help you.",
    "merchant_quest_3",
    []],

  [plyr|anyone, "merchant_quest_persuasion",
    [],
    "I am sorry, I have more important business elsewhere.",
    "close_window",
    []],

  [anyone, "merchant_quest_2",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_bandits_sarleon", ":var0"),
      (str_store_string, s3, ":var1"),
    ],
    "Now -- go find and defeat that group of {s3}.",
    "merchant_quest_2a",
    []],

  [anyone, "merchant_quest_3",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (store_add, ":var2", "str_bandits_sarleon", ":var0"),
      (str_store_string, s1, ":var1"),
      (str_store_string, s2, ":var2"),
    ],
    "Now -- go attack that bandit hideout, get my {s1} back, and show those {s2} what happens to those who threaten my household.",
    "merchant_quest_3a",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$g_do_one_more_meeting_with_merchant", 1),
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s5, ":var0"),
    ],
    "Ah... {playername}. Things didn't go quite so well as I had hoped. {s5} couldn't quite find it in him to overlook my little breach of the peace. Oh, he's grateful enough that I got rid of his crooked captain -- a guard who'll let in bandits will let in an enemy army, if the price is right -- but he can't exactly have me running around here as a lasting reminder of his failure to take care of things himself.",
    "merchant_closing_statement_2",
    []],

  [plyr|anyone, "merchant_closing_statement_2",
    [],
    "That hardly seems fair...",
    "merchant_closing_statement_3",
    []],

  [anyone, "merchant_closing_statement_3",
    [],
    "Fair? This is Pendor, {reg63?my boy:my lady}! Kings do what they will, and the rest of us do as they must. He didn't string me up, and instead gave me time to sell my properties -- even put in a word with the other merchants that they best pay me a fair price, too. That's gracious enough, as kings go -- but he's a weak king, as they all are here, and weak kings must always look to their authority first, and justice second. I suppose I'd do the same, in his shoes.",
    "merchant_closing_statement_4",
    []],

  [anyone, "merchant_closing_statement_4",
    [],
    "Anyway, I wouldn't go rubbing your part in this affair in {s5}'s face -- but he's taken note of you, and decided that you're not worth hanging, and that's something to which I'll raise a glass any day of the week. He might even have work for you, further down the road. Or, you can sell your sword to one of his competitors. Anyway, I hope you've learned a bit about what it will take to stay alive in this troubled land, and I suspect that the money you've earned won't go to waste. Good luck.",
    "close_window",
    [
      (assign, "$g_do_one_more_meeting_with_merchant", 2),
    ]],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (check_quest_finished, "qst_save_town_from_bandits"),
      (eq, "$g_do_one_more_meeting_with_merchant", 2),
    ],
    "{!}.",
    "merchant_quests_last_word",
    []],

  [anyone, "merchant_quests_last_word",
    [],
    "I am preparing to leave town in a short while. It's been an honor to know you. Good luck.",
    "close_window",
    []],

  [plyr|anyone, "member_intel_liaison",
    [],
    "What have you discovered?",
    "member_intel_liaison_results",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$talk_context", 14),
      (troop_slot_eq, "$g_talk_troop", 152, 2),
    ],
    "Greetings, stranger.",
    "member_intel_liaison",
    []],

  [plyr|anyone, "member_intel_liaison",
    [],
    "What have you discovered?",
    "member_intel_liaison_results",
    []],

  [plyr|anyone, "member_intel_liaison",
    [],
    "It's time to pull you out. Let's leave town separately, but join me soon after",
    "close_window",
    [
      (assign, "$npc_to_rejoin_party", "$g_talk_troop"),
    ]],

  [plyr|anyone, "member_intel_liaison",
    [],
    "You're doing good work. Stay here for a little longer",
    "close_window",
    []],

  [anyone, "member_intel_liaison_results",
    [
      (store_faction_of_party, ":var0", "$g_encountered_party"),
      (call_script, "script_update_faction_political_notes", ":var0"),
      (assign, ":var1", reg0),
      (val_add, ":var1", reg0),
      (val_add, ":var1", reg1),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var2", 2, 2),
        (store_troop_faction, ":var3", ":var2"),
        (eq, ":var3", ":var0"),
        (call_script, "script_update_troop_political_notes", ":var2"),
      (try_end),
      (str_store_faction_name, s12, ":var0"),
      (try_begin),
        (gt, ":var1", 60),
        (str_store_string, s11, "str_the_s12_is_a_labyrinth_of_rivalries_and_grudges_lords_ignore_their_lieges_summons_and_many_are_ripe_to_defect"),
      (else_try),
        (is_between, ":var1", 40, 60),
        (str_store_string, s11, "str_the_s12_is_shaky_many_lords_do_not_cooperate_with_each_other_and_some_might_be_tempted_to_defect_to_a_liege_that_they_consider_more_worthy"),
      (else_try),
        (is_between, ":var1", 20, 40),
        (str_store_string, s11, "str_the_s12_is_fairly_solid_some_lords_bear_enmities_for_each_other_but_they_tend_to_stand_together_against_outside_enemies"),
      (else_try),
        (lt, ":var1", 20),
        (str_store_string, s11, "str_the_s12_is_a_rock_of_stability_politically_speaking_whatever_the_lords_may_think_of_each_other_they_fight_as_one_against_the_common_foe"),
      (try_end),
    ],
    "{s11} I notice that you have been keeping some notes about individual lords. I have annotated those with my findings.",
    "member_intel_liaison",
    []],

  [anyone, "member_fief_grant_1",
    [],
    "Which fief did you have in mind?",
    "member_fief_grant_2",
    []],

  [repeat_for_parties|plyr|anyone, "member_fief_grant_2",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (neq, ":var0", "$g_player_court"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (neg|party_slot_ge, ":var0", 7, "trp_npc_adonja"),
      (str_store_party_name, s11, ":var0"),
    ],
    "{s11}",
    "member_fief_grant_3",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "member_fief_grant_2",
    [],
    "Never mind -- there is no fief I can offer.",
    "do_member_trade",
    []],

  [anyone, "member_fief_grant_3",
    [],
    "{s5}",
    "close_window",
    [
      (call_script, "script_npc_morale", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (remove_member_from_party, "$g_talk_troop", "p_main_party"),
      (store_random_in_range, ":var1", 0, 5),
      (try_begin),
        (eq, ":var1", 0),
        (troop_add_item, "$g_talk_troop", "itm_leather_jacket", imod_plain),
      (else_try),
        (eq, ":var1", 1),
        (troop_add_item, "$g_talk_troop", "itm_tabard", imod_plain),
      (else_try),
        (eq, ":var1", 2),
        (troop_add_item, "$g_talk_troop", "itm_tabard_padded1", imod_plain),
      (else_try),
        (eq, ":var1", 3),
        (troop_add_item, "$g_talk_troop", "itm_gambeson", imod_plain),
      (else_try),
        (troop_add_item, "$g_talk_troop", "itm_sarleon_clothing4", imod_plain),
      (try_end),
      (store_random_in_range, ":var1", 0, 3),
      (try_begin),
        (eq, ":var1", 0),
        (troop_add_item, "$g_talk_troop", "itm_light_leather_boots", imod_plain),
      (else_try),
        (eq, ":var1", 1),
        (troop_add_item, "$g_talk_troop", "itm_leather_boots2", imod_plain),
      (else_try),
        (troop_add_item, "$g_talk_troop", "itm_dark_leather_boots", imod_plain),
      (try_end),
      (try_begin),
        (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
        (assign, ":var2", 167),
        (val_sub, ":var2", 1),
        (val_sub, ":var2", "$g_companions_banner_id"),
        (store_add, ":var3", "spr_banner_a", ":var2"),
        (troop_set_slot, "$g_talk_troop", 13, ":var3"),
        (val_add, "$g_companions_banner_id", 1),
        (troop_set_slot, "$g_talk_troop", 2, 2),
      (try_end),
      (troop_set_faction, "$g_talk_troop", "fac_player_supporters_faction"),
      (call_script, "script_give_center_to_lord", "$temp", "$g_talk_troop", 0),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$temp"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 14, 0),
        (party_get_slot, ":var4", "$temp", 61),
        (troop_set_slot, "$g_talk_troop", 14, ":var4"),
      (try_end),
      (store_character_level, ":var5", "$g_talk_troop"),
      (val_mul, ":var5", 25),
      (val_max, ":var5", 1000),
      (troop_set_slot, "$g_talk_troop", 7, ":var5"),
      (troop_set_slot, "$g_talk_troop", 11, 2500),
      (call_script, "script_troop_set_title_according_to_faction", "$g_talk_troop", "fac_player_supporters_faction"),
      (372, 42),
      (call_script, "script_check_concilio_calradi_achievement"),
      (store_div, ":var6", ":var0", 3),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", ":var6"),
      (str_store_party_name, s17, "$temp"),
      (store_sub, ":var7", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var8", "str_npc_adonja_fief_acceptance", ":var7"),
      (str_store_string, s5, ":var8"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (this_or_next|eq, "$talk_context", 14),
      (eq, "$talk_context", 1),
      (main_party_has_troop, "$g_talk_troop"),
    ],
    "Let's leave whenever you are ready.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (troop_slot_eq, "$g_talk_troop", 81, 1),
    ],
    "Please do not waste any more of my time today, {reg63?sir:madame}. Perhaps we shall meet again in our travels.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (eq, "$g_talk_troop_met", 0),
      (troop_get_slot, ":var0", "$g_talk_troop", 101),
      (str_store_string, s5, ":var0"),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_intro_response",
    [
      (troop_set_slot, "$g_talk_troop", 59, "$g_encountered_party"),
    ]],

  [plyr|anyone, "companion_recruit_intro_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 102),
      (str_store_string, s6, ":var0"),
    ],
    "{s6}",
    "companion_recruit_backstory_a",
    []],

  [plyr|anyone, "companion_recruit_intro_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 103),
      (str_store_string, s7, ":var0"),
    ],
    "{s7}",
    "close_window",
    []],

  [anyone, "companion_recruit_backstory_a",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 104),
      (str_store_string, s5, ":var0"),
      (str_store_string, s19, "str_here_plus_space"),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_backstory_b",
    []],

  [anyone, "companion_recruit_backstory_b",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 105),
      (str_store_string, s5, ":var0"),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_backstory_c",
    []],

  [anyone, "companion_recruit_backstory_c",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 106),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_recruit_backstory_response",
    []],

  [plyr|anyone, "companion_recruit_backstory_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 108),
      (str_store_string, s6, ":var0"),
    ],
    "{s6}",
    "companion_recruit_signup",
    []],

  [plyr|anyone, "companion_recruit_backstory_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 109),
      (str_store_string, s7, ":var0"),
    ],
    "{s7}",
    "close_window",
    []],

  [anyone, "companion_recruit_signup",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 110),
      (str_store_string, s5, ":var0"),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_signup_b",
    []],

  [anyone, "companion_recruit_signup_b",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 111),
      (troop_get_slot, reg3, "$g_talk_troop", 141),
      (str_store_string, s5, ":var0"),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_signup_response",
    []],

  [plyr|anyone, "companion_recruit_signup_response",
    [
      (neg|hero_can_join, "p_main_party"),
    ],
    "Unfortunately, I can't take on any more hands in my party right now.",
    "close_window",
    []],

  [plyr|anyone, "companion_recruit_signup_response",
    [
      (hero_can_join, "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 112),
      (str_store_string, s6, ":var0"),
    ],
    "{s6}",
    "companion_recruit_payment",
    []],

  [plyr|anyone, "companion_recruit_signup_response",
    [
      (hero_can_join, "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 113),
      (str_store_string, s7, ":var0"),
    ],
    "{s7}",
    "close_window",
    []],

  [auto_proceed|anyone, "companion_recruit_payment",
    [
      (troop_slot_eq, "$g_talk_troop", 141, 0),
    ],
    ".",
    "companion_recruit_signup_confirm",
    []],

  [anyone, "companion_recruit_payment",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_payment", ":var0"),
      (str_store_string, s5, ":var1"),
      (troop_get_slot, reg3, "$g_talk_troop", 141),
      (str_store_party_name, s20, "$g_encountered_party"),
    ],
    "{s5}",
    "companion_recruit_payment_response",
    []],

  [plyr|anyone, "companion_recruit_payment_response",
    [
      (hero_can_join, "p_main_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 141),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", ":var0"),
      (assign, reg3, ":var0"),
      (store_sub, ":var2", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var3", "str_npc_adonja_payment_response", ":var2"),
      (str_store_string, s6, ":var3"),
    ],
    "{s6}",
    "companion_recruit_signup_confirm",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 141),
      (gt, ":var0", 0),
      (troop_remove_gold, "trp_player", ":var0"),
      (troop_set_slot, "$g_talk_troop", 141, 0),
    ]],

  [plyr|anyone, "companion_recruit_payment_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 113),
      (str_store_string, s7, ":var0"),
    ],
    "Sorry. I can't afford that at the moment.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (troop_slot_eq, "$g_talk_troop", 80, 1),
      (troop_slot_eq, "$g_talk_troop", 82, 0),
    ],
    "We meet again.",
    "companion_recruit_meet_again",
    [
      (troop_set_slot, "$g_talk_troop", 81, 1),
    ]],

  [plyr|anyone, "companion_recruit_meet_again",
    [],
    "So... what have you been doing since our last encounter?",
    "companion_recruit_backstory_delayed",
    []],

  [plyr|anyone, "companion_recruit_meet_again",
    [
      (eq, "$event_rand_1_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 20),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I am looking for good soldiers. Could you help me somehow?",
    "ask_companions_for_unique_troops",
    [
      (call_script, "script_ask_companions_for_unique_troops", "$g_talk_troop", 0),
    ]],

  [plyr|anyone, "companion_recruit_meet_again",
    [],
    "Good day to you.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (troop_slot_eq, "$g_talk_troop", 80, 0),
      (troop_slot_eq, "$g_talk_troop", 82, 0),
    ],
    "Yes?",
    "companion_recruit_secondchance",
    [
      (troop_set_slot, "$g_talk_troop", 81, 1),
    ]],

  [plyr|anyone, "companion_recruit_secondchance",
    [],
    "My apologies if I was rude, earlier. What was your story again?",
    "companion_recruit_backstory_b",
    []],

  [plyr|anyone, "companion_recruit_secondchance",
    [
      (eq, "$event_rand_1_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 20),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I need more soldiers in my party. Think you can help?",
    "ask_companions_for_unique_troops",
    [
      (call_script, "script_ask_companions_for_unique_troops", "$g_talk_troop", 0),
    ]],

  [plyr|anyone, "companion_recruit_secondchance",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "companion_recruit_backstory_delayed",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 107),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_recruit_backstory_delayed_response",
    []],

  [plyr|anyone, "companion_recruit_backstory_delayed_response",
    [],
    "I might be able to use you in my company.",
    "companion_recruit_signup_b",
    []],

  [plyr|anyone, "companion_recruit_backstory_delayed_response",
    [],
    "I'll let you know if I hear of anything.",
    "close_window",
    []],

  [anyone, "companion_recruit_signup_confirm",
    [],
    "Good! Give me a few moments to prepare and I'll be ready to move.",
    "close_window",
    [
      (call_script, "script_recruit_troop_as_companion", "$g_talk_troop"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_slot_eq, "$g_talk_troop", 82, 4),
      (troop_get_slot, ":var0", "$g_talk_troop", 8),
      (lt, ":var0", "p_town_1"),
    ],
    "My offer to rejoin you still stands, if you'll have me.",
    "companion_rehire",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_slot_eq, "$g_talk_troop", 82, 1),
      (this_or_next|eq, "$talk_context", 8),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (neq, "$talk_context", 18),
      (assign, ":var0", "str_battle_fate_1"),
      (store_random_in_range, ":var1", 0, 5),
      (val_add, ":var0", ":var1"),
      (str_store_string, s6, ":var0"),
      (troop_get_slot, ":var2", "$g_talk_troop", 130),
      (str_store_string, s5, ":var2"),
    ],
    "It is good to see you alive, {s5}! {s6}, and I did not know whether you had been captured, or slain, or got away. I've been roaming around since then, looking for you. Shall I get my gear together and rejoin your company?",
    "companion_rehire",
    [
      (troop_set_slot, "$g_talk_troop", 82, 4),
      (troop_set_slot, "$g_talk_troop", 8, -1),
    ]],

  [plyr|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_slot_eq, "$g_talk_troop", 82, 1),
      (troop_slot_ge, "$g_talk_troop", 8, 0),
      (neq, "$talk_context", 18),
      (assign, ":var0", "str_battle_fate_1"),
      (store_random_in_range, ":var1", 0, 5),
      (val_add, ":var0", ":var1"),
      (str_store_string, s6, ":var0"),
      (troop_get_slot, ":var2", "$g_talk_troop", 130),
      (str_store_string, s5, ":var2"),
    ],
    "I've come to break you out of here.",
    "companion_prison_break_chains",
    []],

  [anyone, "companion_prison_break_chains",
    [],
    "Thank the heavens you came! However, I'm not going anywhere with these chains on my legs. You'll need to get the key away from the guard somehow.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (troop_slot_eq, "$g_talk_troop", 81, 0),
      (troop_slot_eq, "$g_talk_troop", 82, 3),
      (troop_get_slot, ":var0", "$g_talk_troop", 125),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_rehire",
    [
      (troop_set_slot, "$g_talk_troop", 82, 4),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (troop_slot_eq, "$g_talk_troop", 82, 2),
      (troop_get_slot, ":var0", "$g_talk_troop", 130),
      (str_store_string, s21, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 107),
      (str_store_string, s5, ":var1"),
    ],
    "It is good to see you, {s21}! To tell you the truth, I had hoped to run into you.",
    "companion_was_dismissed",
    [
      (troop_set_slot, "$g_talk_troop", 82, 4),
    ]],

  [anyone, "companion_was_dismissed",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_get_slot, ":var0", "$g_talk_troop", 107),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}. Would you want me to rejoin your company?",
    "companion_rehire",
    []],

  [plyr|anyone, "companion_rehire",
    [
      (hero_can_join, "p_main_party"),
    ],
    "Welcome back, my friend!",
    "companion_recruit_signup_confirm",
    []],

  [plyr|anyone, "companion_rehire",
    [
      (eq, "$event_rand_1_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 20),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I need more soldiers in my party. Think you can help?",
    "ask_companions_for_unique_troops",
    [
      (call_script, "script_ask_companions_for_unique_troops", "$g_talk_troop", 0),
    ]],

  [plyr|anyone, "companion_rehire",
    [],
    "Sorry, I can't take on anyone else right now.",
    "companion_rehire_refused",
    []],

  [anyone, "companion_rehire_refused",
    [],
    "Well... Look me up if you change your mind, eh?",
    "close_window",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 12),
      (try_begin),
        (neg|is_between, ":var0", "p_town_1", "p_castle_1"),
        (store_random_in_range, ":var1", "p_town_1", "p_castle_1"),
        (troop_set_slot, "$g_talk_troop", 12, ":var1"),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg1, ":var0"),
          (str_store_party_name, s7, ":var1"),
          (display_message, "@{!}current town was {reg1}, now moved to {s7}"),
        (try_end),
      (try_end),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_get_slot, ":var0", "$g_talk_troop", 8),
      (lt, ":var0", "p_town_1"),
    ],
    "So... Do you want me back yet?",
    "companion_rehire",
    []],

  [anyone, "minister_issues",
    [
      (eq, "$pop_kingdom", 0),
      (store_free_inventory_capacity, ":var0"),
      (lt, ":var0", 2),
    ],
    "Welcome {reg63?Lord:Lady} {playername}. It is time for you to assume the throne of your new kingdom, but make sure you have space in your inventory to accept coronation gifts.",
    "close_window",
    []],

  [anyone, "minister_issues",
    [
      (eq, "$pop_kingdom", 0),
      (store_free_inventory_capacity, ":var0"),
      (ge, ":var0", 3),
    ],
    "Welcome {reg63?Lord:Lady} {playername}. It is time for you to assume the throne of your new kingdom.",
    "declaration_of_indep1",
    []],

  [anyone, "declaration_of_indep1",
    [],
    "Do you Swear upon this crown to accept the duty to fairly rule the peoples who have sworn their oath of loyalty to you, and to defend these lands from those who would take them by force or guile, and to continue, by the grace of the divine, to uphold your oath to your last breath, and upon your passing to provide an heir that shall take your mantle to discharge your oath and so forth to the end of days?",
    "declaration_of_indep2",
    [
      (assign, "$pop_kingdom", 1),
    ]],

  [plyr|anyone, "declaration_of_indep2",
    [],
    "I so swear by the grace of the Divine henceforth and to my last breath, to fairly rule the peoples of this land, provide for the defense against any who would do harm to its peoples and provide an heir to continue my bloodline to the end of days.",
    "declaration_of_indep2a",
    []],

  [anyone, "declaration_of_indep2a",
    [],
    "This line should not be displayed.",
    "declaration_of_indep2a",
    []],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Chalice as a symbol of my divine right, and declare that our culture will follow the Old Kings of Pendor.",
    "declaration_of_indep3",
    [
      (assign, reg20, 6),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_6"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_6"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_pendor_manatarms"),
    ]],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Crown as a symbol of my divine right, and declare that our culture will follow the Kingdom of Sarleon.",
    "declaration_of_indep3",
    [
      (assign, reg20, 1),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_1"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_1"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_sarleon_halberdier"),
    ]],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Sword as a symbol of my divine right, and declare that our culture will follow the Kingdom of Ravenstern.",
    "declaration_of_indep3",
    [
      (assign, reg20, 2),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_2"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_2"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_rav_kierguard"),
    ]],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Axe as a symbol of my divine right, and declare that our culture will follow the Fierdsvain.",
    "declaration_of_indep3",
    [
      (assign, reg20, 4),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_4"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_4"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_fierd_axeman"),
    ]],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Bow as a symbol of my divine right, and declare that our culture will follow the D'Shar.",
    "declaration_of_indep3",
    [
      (assign, reg20, 3),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_3"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_3"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_dshar_nobleman"),
    ]],

  [plyr|anyone, "declaration_of_indep2a",
    [],
    "I take this Spear as a symbol of my divine right, and declare that our culture will follow the Empire.",
    "declaration_of_indep3",
    [
      (assign, reg20, 5),
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_5"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_5"),
      (faction_set_slot, "fac_player_supporters_faction", 49, "trp_empire_infantry"),
    ]],

  [anyone, "declaration_of_indep3",
    [],
    "All Hail {reg63?King:Queen} {playername}! ^^ Long live the {reg63?King:Queen}!!!",
    "declaration_of_indep3",
    [
      (val_or, "$g_achieve_bits_delay_popup", 65536),
      (music_set_situation, 0),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (gt, ":var0", 0),
        (play_sound, "snd_declare_own_kingdom_femaleplayer"),
      (else_try),
        (play_sound, "snd_declare_own_kingdom_maleplayer"),
      (try_end),
    ]],

  [plyr|anyone, "declaration_of_indep3",
    [],
    "Very good... let the mighty tremble at my coming!",
    "declaration_of_indep4",
    []],

  [anyone, "declaration_of_indep4",
    [
      (neq, "$pop_received_crown", 0),
    ],
    "Long live the {reg63?King:Queen}!!!",
    "close_window",
    []],

  [anyone, "declaration_of_indep4",
    [
      (eq, "$pop_received_crown", 0),
    ],
    "My {reg63?King:Queen}, could you choose your new battle helm, please?",
    "declaration_of_indep5",
    []],

  [repeat_for_100|plyr|anyone, "declaration_of_indep5",
    [
      (store_repeat_object, ":var0"),
      (val_add, ":var0", "itm_sarleon_king_helm"),
      (is_between, ":var0", "itm_sarleon_king_helm", "itm_noldor_inf_helm"),
      (str_store_item_name, s5, ":var0"),
    ],
    "I will take {s5}",
    "close_window",
    [
      (store_repeat_object, ":var0"),
      (val_add, ":var0", "itm_sarleon_king_helm"),
      (troop_add_item, "trp_player", "itm_royal_crown", imod_plain),
      (troop_add_item, "trp_player", "itm_royal_crown", imod_plain),
      (troop_add_item, "trp_player", ":var0", imod_plain),
      (assign, "$pop_received_crown", 1),
    ]],

  [anyone, "minister_issues",
    [
      (check_quest_active, "qst_consult_with_minister"),
      (eq, "$g_minister_notification_quest", "qst_resolve_dispute"),
      (setup_quest_text, "qst_resolve_dispute"),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (str_store_troop_name, s11, ":var0"),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (str_store_troop_name, s12, ":var1"),
      (str_store_string, s2, "str_resolve_the_dispute_between_s11_and_s12"),
      (call_script, "script_start_quest", "qst_resolve_dispute", -1),
      (call_script, "script_reward_for_quest_per_player_level", 300, 50, 0, 0),
      (quest_set_slot, "qst_resolve_dispute", 21, reg33),
      (quest_set_slot, "qst_resolve_dispute", 23, 30),
      (quest_set_slot, "qst_resolve_dispute", 6, "$g_player_minister"),
      (quest_set_slot, "qst_resolve_dispute", 16, 0),
      (quest_set_slot, "qst_resolve_dispute", 17, 0),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (str_store_troop_name, s11, ":var0"),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (str_store_troop_name, s12, ":var1"),
    ],
    "There is a matter which needs your attention. The quarrel between {s11} and {s12} has escalated to a point where it has become unseemly. If you do intervene, you risk offending one of the lords. However, if you do nothing, you risk appearing weak. Such are the burdens of kingship, {reg63?sire:my lady}.",
    "minister_pretalk",
    [
      (call_script, "script_end_quest", "qst_consult_with_minister"),
    ]],

  [anyone, "minister_issues",
    [
      (assign, "$g_center_taken_by_player_faction", -1),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (eq, "$g_center_taken_by_player_faction", -1),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (neg|party_slot_ge, ":var0", 7, 0),
        (assign, "$g_center_taken_by_player_faction", ":var0"),
      (try_end),
      (is_between, "$g_center_taken_by_player_faction", "p_town_1", "p_salt_mine"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
    ],
    "{s1} currently does not have a lord. You may wish to keep it this way, as lords will sometimes gravitate towards lieges who have land to offer, but for the time being, no one is collecting any of its rents.",
    "minister_talk",
    []],

  [anyone, "minister_issues",
    [
      (neg|is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
    ],
    "At this point, there are no particularly urgent matters which need your attention. I should point out though, sire, that I am not very skilled in the ways of politics, and that I am anxious to return to private life. If you wish to issue any but the most basic directives, I suggest appointing a trusted companion in my stead. In the meantime, is there anything you wish done?",
    "minister_talk",
    []],

  [anyone, "minister_issues",
    [
      (eq, 1, 0),
    ],
    "{!}[Should not appear - there to prevent error related to center captured lord advice]",
    "center_captured_lord_advice",
    []],

  [anyone, "minister_issues",
    [
      (lt, "$player_right_to_rule", 30),
    ],
    "If I may offer you a word of advice, my {reg63?lord:lady}, it seems that your right to rule as an independent monarch is not sufficiently recognized, and this may bring us problems further down the road. It may be advisable to find another kingdom with whom you have shared interests and seek its recognition, to establish yourself as an equal with Pendor's other kings.",
    "minister_talk",
    []],

  [anyone, "minister_issues",
    [],
    "At this point, there are no particularly urgent matters which need your attention. Is there anything you wish done?",
    "minister_talk",
    []],

  [anyone, "minister_pretalk",
    [],
    "Is there anything you wish done?",
    "minister_talk",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
    ],
    "Do you have any ideas to strengthen our kingdom's unity?",
    "combined_political_quests",
    [
      (call_script, "script_get_political_quest", "$g_talk_troop"),
      (assign, "$political_quest_found", reg0),
      (assign, "$political_quest_target_troop", reg1),
      (assign, "$political_quest_object_troop", reg2),
    ]],

  [plyr|anyone, "minister_talk",
    [
      (assign, "$political_quest_to_cancel", -1),
      (try_begin),
        (check_quest_active, "qst_offer_gift"),
        (quest_slot_eq, "qst_offer_gift", 6, "$g_talk_troop"),
        (assign, "$political_quest_to_cancel", "qst_offer_gift"),
        (str_store_string, s10, "str_offer_gift_description"),
      (else_try),
        (check_quest_active, "qst_resolve_dispute"),
        (quest_slot_eq, "qst_resolve_dispute", 6, "$g_talk_troop"),
        (assign, "$political_quest_to_cancel", "qst_resolve_dispute"),
        (str_store_string, s10, "str_resolve_dispute_description"),
      (try_end),
      (gt, "$political_quest_to_cancel", 0),
    ],
    "Let's abandon our plan to {s10}.",
    "minister_cancel_political_quest",
    []],

  [anyone, "minister_cancel_political_quest",
    [],
    "Are you sure you want to drop that idea?",
    "minister_cancel_political_quest_confirm",
    []],

  [plyr|anyone, "minister_cancel_political_quest_confirm",
    [],
    "Yes, I am sure. Let's abandon that idea.",
    "minister_pretalk",
    [
      (call_script, "script_abort_quest", "$political_quest_to_cancel", 1),
    ]],

  [plyr|anyone, "minister_cancel_political_quest_confirm",
    [],
    "Actually, never mind.",
    "minister_pretalk",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
    ],
    "I wish to dispatch an emissary.",
    "minister_diplomatic_kingdoms",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
    ],
    "I wish to indict a disloyal vassal for treason.",
    "minister_indict",
    []],

  [plyr|anyone, "minister_talk",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 8),
      (ge, ":var0", 0),
      (try_begin),
        (gt, ":var0", 0),
        (str_store_troop_name, s4, ":var0"),
      (else_try),
        (str_store_string, s4, "str_myself"),
      (try_end),
    ],
    "I wish to replace {s4} as marshal.",
    "minister_change_marshal",
    []],

  [plyr|anyone, "minister_talk",
    [
      (faction_slot_eq, "$players_kingdom", 8, -1),
    ],
    "I wish to appoint a new marshal.",
    "minister_change_marshal",
    []],

  [anyone, "minister_change_marshal",
    [
      (store_current_hours, ":var0"),
      (val_sub, ":var0", "$g_player_faction_last_marshal_appointment"),
      (lt, ":var0", 48),
    ],
    "You have just made such an appointment, {reg63?sire:my lady}. If you countermand your decree so soon, there will be great confusion. We will need to wait a few days.",
    "minister_pretalk",
    []],

  [plyr|anyone, "minister_talk",
    [
      (neg|is_between, "$g_player_minister", "trp_npc_adonja", "trp_knight_1_1_wife"),
    ],
    "I wish for you to retire as minister.",
    "minister_replace",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "I wish you to rejoin my party.",
    "minister_replace",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
    ],
    "I wish you to grant one of my vassals a fief.",
    "minister_grant_fief",
    []],

  [plyr|anyone, "minister_talk",
    [
      (is_between, "$g_player_minister", "trp_npc_adonja", "trp_heroes_end"),
      (assign, ":var0", -1),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (eq, ":var0", -1),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (party_get_slot, ":var3", ":var1", 7),
        (try_begin),
          (ge, ":var3", "trp_npc_adonja"),
          (store_troop_faction, ":var4", ":var3"),
          (neq, ":var4", "fac_player_supporters_faction"),
          (assign, ":var3", -1),
        (try_end),
        (lt, ":var3", 0),
        (assign, ":var0", ":var1"),
      (try_end),
      (gt, ":var0", -1),
      (str_store_party_name, s4, ":var0"),
    ],
    "I wish to make myself lord of {s4}.",
    "minister_grant_self_fief",
    []],

  [anyone, "minister_grant_self_fief",
    [],
    "As you wish. You shall be lord of {s4}.",
    "minister_pretalk",
    [
      (assign, ":var0", -1),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (eq, ":var0", -1),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (party_get_slot, ":var3", ":var1", 7),
        (try_begin),
          (ge, ":var3", "trp_npc_adonja"),
          (store_troop_faction, ":var4", ":var3"),
          (neq, ":var4", "fac_player_supporters_faction"),
          (assign, ":var3", -1),
        (try_end),
        (lt, ":var3", 0),
        (assign, ":var0", ":var1"),
      (try_end),
      (call_script, "script_give_center_to_lord", ":var0", "trp_player", 0),
      (call_script, "script_disband_skilled_garrison_in_fief_assigned_to_player", ":var0"),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, ":var0"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (str_store_party_name, s4, ":var0"),
    ]],

  [plyr|anyone, "minister_talk",
    [],
    "Let us hire a mercenary company.",
    "pop_minister_hire_mercs",
    []],

  [plyr|anyone, "minister_talk",
    [],
    "Let us change our Kingdom color.",
    "pop_change_color1",
    []],

  [plyr|anyone, "minister_talk",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300000),
    ],
    "Our cultural legacy is not helping our people... the time has come to change our ways.",
    "pop_change_culture1",
    []],

  [plyr|anyone, "minister_talk",
    [],
    "That is all for now.",
    "close_window",
    []],

  [anyone, "pop_minister_hire_mercs",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (gt, ":var0", 0),
      (party_is_active, ":var0"),
      (str_store_party_name, s4, ":var0"),
    ],
    "But we have already hired the {s4}, my {reg63?King:Queen}, we cannot hire more mercenaries.",
    "minister_pretalk",
    []],

  [anyone, "pop_minister_hire_mercs",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", 15000),
    ],
    "Unfortunately, my {reg63?King:Queen}, our Treasury cannot support the usual hiring cost (15000) of such a party.",
    "minister_pretalk",
    []],

  [anyone, "pop_minister_hire_mercs",
    [],
    "Very well, my {reg63?King:Queen}, the usual hiring cost of mercenary companies is 15000 gold in advance, then they'll require rather hefty weekly wages.^It would not be very prudent to hire them for a longer period, if you don't mind me saying so.^At the moment, we can purchase the services of a few mercenary leaders and their companies, but more may become available if you increase your right to rule, my {reg63?King:Queen}.",
    "pop_minister_hire_mercs_choose",
    [
      (assign, "$temp_2", -1),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_mettenheim"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 60),
    ],
    "Let us hire a dependable Mettenheim company.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_mettenheim"),
      (assign, "$temp_2", "pt_player_merc_mettenheim_2"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_veccavian"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 30),
    ],
    "Let us hire the Veccavian Renegades.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_veccavian"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_barclay"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 60),
    ],
    "Let us hire a capable Barclay company.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_barclay"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_melitine"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 60),
    ],
    "Let us hire those mysterious Melitines.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_melitine"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_marleons"),
      (eq, ":var0", 0),
      (store_faction_of_party, ":var1", "p_town_7"),
      (store_relation, ":var2", ":var1", "fac_player_faction"),
      (ge, ":var2", 0),
      (gt, "$player_right_to_rule", 45),
    ],
    "Let us hire the Marleons Banneret.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_marleons"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_unicorns"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 45),
    ],
    "Let us hire that new Unicorn Knights company.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_unicorns"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_snowlions"),
      (eq, ":var0", 0),
      (faction_slot_eq, "fac_kingdom_2", 21, 0),
      (store_relation, ":var1", "fac_kingdom_2", "fac_player_faction"),
      (lt, ":var1", 0),
      (gt, "$player_right_to_rule", 45),
    ],
    "Let us hire the Snowlion Brigade to do battle against Ravenstern.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_snowlions"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_red_brotherhood"),
      (eq, ":var0", 0),
    ],
    "Let us hire a friendly Red Brotherhood band.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_red_brotherhood"),
      (assign, "$temp_2", "pt_player_merc_red_brotherhood_2"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_singalians"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 30),
    ],
    "Let us hire some Singalian Slavers.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_singalians"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_jatu"),
      (eq, ":var0", 0),
      (gt, "$player_right_to_rule", 30),
    ],
    "Let us hire a Jatu Warband.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_jatu"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [
      (store_num_parties_of_template, ":var0", "pt_player_merc_generic"),
      (eq, ":var0", 0),
    ],
    "Let us hire a professional mercenary company.",
    "pop_minister_hire_mercs_confirm",
    [
      (assign, "$temp", "pt_player_merc_generic"),
    ]],

  [plyr|anyone, "pop_minister_hire_mercs_choose",
    [],
    "Maybe this is not such a good idea.",
    "minister_pretalk",
    []],

  [anyone, "pop_minister_hire_mercs_confirm",
    [
      (party_template_get_slot, ":var0", "$temp", 8),
      (store_current_hours, ":var1"),
      (val_sub, ":var1", ":var0"),
      (neq, ":var0", 0),
      (lt, ":var1", 336),
    ],
    "But {reg63?Sire:Madam}, you hired them not long ago, I doubt they will be available again so soon.",
    "minister_pretalk",
    []],

  [anyone, "pop_minister_hire_mercs_confirm",
    [],
    "A reasonable choice, they should arrive in the vicinity shortly!",
    "minister_pretalk",
    [
      (troop_remove_gold, "trp_player", 15000),
      (party_template_set_slot, "$temp", 6, 1),
      (spawn_around_party, "p_main_party", "$temp"),
      (assign, ":var0", reg0),
      (try_begin),
        (neq, "$temp_2", -1),
        (party_add_template, ":var0", "$temp_2"),
      (try_end),
      (party_set_faction, ":var0", "fac_player_supporters_faction"),
      (1606, ":var0", 6),
      (1607, ":var0", 9),
      (party_set_ai_initiative, ":var0", 50),
      (party_set_ai_behavior, ":var0", ai_bhvr_escort_party),
      (party_set_ai_object, ":var0", "p_main_party"),
      (troop_set_slot, "trp_player", 161, ":var0"),
      (str_store_party_name, s12, ":var0"),
      (display_log_message, "@ {s12} were hired by {reg63?King:Queen} {playername}!"),
      (play_sound, "snd_kinghorn"),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (troop_set_health, ":var1", 100),
    ]],

  [anyone, "minister_change_marshal",
    [],
    "Who should be the new marshal?",
    "minister_change_marshal_choose",
    []],

  [plyr|anyone, "minister_change_marshal_choose",
    [],
    "I shall be marshal.",
    "minister_pretalk",
    [
      (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", "trp_player"),
      (store_current_hours, ":var0"),
      (assign, "$g_recalculate_ais", 1),
      (assign, "$g_player_faction_last_marshal_appointment", ":var0"),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 64, 1),
        (faction_set_slot, "fac_player_supporters_faction", 64, 0),
        (troop_set_slot, "trp_player", 154, -1),
        (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var2", ":var1"),
          (eq, ":var2", "fac_player_supporters_faction"),
          (troop_set_slot, ":var1", 154, -1),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "minister_change_marshal_choose",
    [],
    "For a short while, we should have no marshal",
    "minister_pretalk",
    [
      (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", -1),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 64, 1),
        (faction_set_slot, "fac_player_supporters_faction", 64, 0),
        (troop_set_slot, "trp_player", 154, -1),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var1", ":var0"),
          (eq, ":var1", "fac_player_supporters_faction"),
          (troop_set_slot, ":var0", 154, -1),
        (try_end),
      (try_end),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [repeat_for_troops|plyr|anyone, "minister_change_marshal_choose",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "{s4}",
    "minister_pretalk",
    [
      (store_repeat_object, ":var0"),
      (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", ":var0"),
      (store_current_hours, ":var1"),
      (assign, "$g_player_faction_last_marshal_appointment", ":var1"),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 64, 1),
        (faction_set_slot, "fac_player_supporters_faction", 64, 0),
        (troop_set_slot, "trp_player", 154, -1),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var3", ":var2"),
          (eq, ":var3", "fac_player_supporters_faction"),
          (troop_set_slot, ":var2", 154, -1),
        (try_end),
      (try_end),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [plyr|anyone, "minister_change_marshal_choose",
    [],
    "Never mind",
    "minister_pretalk",
    []],

  [anyone, "minister_diplomatic_kingdoms",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (main_party_has_troop, ":var1"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "To whom do you wish to send this emissary?",
    "minister_diplomatic_kingdoms_select",
    []],

  [anyone, "minister_diplomatic_kingdoms",
    [],
    "Unfortunately, there is no one to send right now.",
    "minister_pretalk",
    []],

  [anyone, "minister_diplomatic_kingdoms",
    [],
    "To whom do you wish to send this emissary?",
    "minister_diplomatic_kingdoms_select",
    []],

  [repeat_for_factions|plyr|anyone, "minister_diplomatic_kingdoms_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, ":var0", "fac_player_supporters_faction"),
      (faction_slot_eq, ":var0", 21, 0),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s10, ":var1"),
      (str_store_faction_name, s11, ":var0"),
      (str_clear, s14),
    ],
    "{s10} of the {s11}{s14}",
    "minister_diplomatic_initiative_type",
    [
      (store_repeat_object, "$g_faction_selected"),
    ]],

  [plyr|anyone, "minister_diplomatic_kingdoms_select",
    [],
    "Never mind",
    "minister_pretalk",
    []],

  [anyone, "minister_diplomatic_initiative_type",
    [],
    "What do you wish to tell him?",
    "minister_diplomatic_initiative_type_select",
    []],

  [plyr|anyone, "minister_diplomatic_initiative_type_select",
    [
      (store_relation, ":var0", "fac_player_supporters_faction", "$g_faction_selected"),
      (lt, ":var0", 0),
    ],
    "That our two kingdoms should enter into truce.",
    "minister_diplomatic_emissary",
    [
      (assign, "$g_initiative_selected", 3),
    ]],

  [plyr|anyone, "minister_diplomatic_initiative_type_select",
    [],
    "That I wish to put myself under his protection, as his vassal.",
    "minister_diplomatic_emissary",
    [
      (assign, "$g_initiative_selected", 4),
    ]],

  [plyr|anyone, "minister_diplomatic_initiative_type_select",
    [
      (store_relation, ":var0", "fac_player_supporters_faction", "$g_faction_selected"),
      (faction_slot_eq, "$g_faction_selected", 32, 0),
      (ge, ":var0", 0),
    ],
    "That I wish to express my goodwill, as one monarch to another.",
    "minister_diplomatic_emissary",
    [
      (assign, "$g_initiative_selected", 5),
    ]],

  [plyr|anyone, "minister_diplomatic_initiative_type_select",
    [
      (store_relation, ":var0", "fac_player_supporters_faction", "$g_faction_selected"),
      (ge, ":var0", 0),
    ],
    "That I declare war upon him.",
    "minister_declare_war",
    []],

  [plyr|anyone, "minister_diplomatic_initiative_type_select",
    [],
    "Never mind",
    "close_window",
    []],

  [anyone, "minister_declare_war",
    [
      (try_begin),
        (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "$g_faction_selected"),
        (eq, reg0, 1),
        (str_store_string, s12, "str_in_doing_so_you_will_be_in_violation_of_your_truce_is_that_what_you_want"),
      (else_try),
        (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "$g_faction_selected"),
        (neq, reg0, -1),
        (str_store_string, s12, "str_if_you_attack_without_provocation_some_of_your_vassals_may_consider_you_to_be_too_warlike_is_that_what_you_want"),
      (else_try),
        (str_store_string, s12, "str_our_men_are_ready_to_ride_forth_at_your_bidding_are_you_sure_this_is_what_you_want"),
      (try_end),
    ],
    "{s12}",
    "minister_declare_war_confirm",
    []],

  [plyr|anyone, "minister_declare_war_confirm",
    [
      (str_store_faction_name, s12, "$g_faction_selected"),
    ],
    "It is. I wish to make war on {s12}.",
    "minister_declare_war_confirm_yes",
    [
      (call_script, "script_diplomacy_start_war_between_kingdoms", "fac_player_supporters_faction", "$g_faction_selected", 1),
    ]],

  [plyr|anyone, "minister_declare_war_confirm",
    [
      (str_store_faction_name, s12, "$g_faction_selected"),
    ],
    "Hmm. Perhaps not.",
    "minister_pretalk",
    []],

  [anyone, "minister_declare_war_confirm_yes",
    [
      (str_store_faction_name, s12, "$g_faction_selected"),
    ],
    "As you command. We are now at war with the {s12}. May the heavens grant us victory.",
    "minister_pretalk",
    []],

  [anyone, "minister_diplomatic_emissary",
    [],
    "Who shall be your emissary? You should choose one whom you trust, but who is also persuasive -- one who can negotiate without giving offense.",
    "minister_emissary_select",
    []],

  [repeat_for_troops|plyr|anyone, "minister_emissary_select",
    [
      (store_repeat_object, ":var0"),
      (main_party_has_troop, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, ":var0", 8, -1),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (str_store_troop_name, s11, ":var0"),
    ],
    "{s11}",
    "minister_emissary_dispatch",
    [
      (store_repeat_object, "$g_emissary_selected"),
    ]],

  [plyr|anyone, "minister_emissary_select",
    [],
    "Actually, I can't think of anyone.",
    "minister_pretalk",
    []],

  [anyone, "minister_emissary_dispatch",
    [
      (str_store_troop_name, s11, "$g_emissary_selected"),
      (str_store_faction_name, s12, "$g_faction_selected"),
      (try_begin),
        (eq, "$g_initiative_selected", 5),
        (str_store_string, s14, "str_seek_recognition"),
      (else_try),
        (eq, "$g_initiative_selected", 4),
        (str_store_string, s14, "str_seek_vassalhood"),
      (else_try),
        (eq, "$g_initiative_selected", 3),
        (str_store_string, s14, "str_seek_a_truce"),
      (try_end),
    ],
    "Very well -- I shall send {s11} to the {s12} to {s14}.",
    "minister_diplomatic_dispatch_confirm",
    []],

  [plyr|anyone, "minister_diplomatic_dispatch_confirm",
    [],
    "Yes, do that",
    "minister_pretalk",
    [
      (troop_set_slot, "$g_emissary_selected", 151, 3),
      (troop_set_slot, "$g_emissary_selected", 152, "$g_initiative_selected"),
      (troop_set_slot, "$g_emissary_selected", 153, "$g_faction_selected"),
      (remove_member_from_party, "$g_emissary_selected", "p_main_party"),
    ]],

  [plyr|anyone, "minister_diplomatic_dispatch_confirm",
    [],
    "Actually, hold off on that",
    "minister_pretalk",
    []],

  [anyone, "minister_replace",
    [],
    "Very good. Whom will you appoint in my stead?",
    "minister_replace_select",
    []],

  [repeat_for_troops|plyr|anyone, "minister_replace_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (main_party_has_troop, ":var0"),
      (troop_slot_eq, ":var0", 8, -1),
      (str_store_troop_name, s4, ":var0"),
    ],
    "{s4}",
    "minister_replace_confirm",
    [
      (store_repeat_object, "$g_player_minister"),
    ]],

  [plyr|anyone, "minister_replace_select",
    [
      (troop_get_slot, ":var0", "trp_player", 30),
      (gt, ":var0", 0),
      (troop_get_type, ":var1", ":var0"),
      (neg|troop_slot_eq, ":var0", 2, 2),
      (neq, ":var1", 0),
      (str_store_troop_name, s4, ":var0"),
      (neq, ":var0", "$g_talk_troop"),
    ],
    "My wife, {s4}.",
    "minister_replace_confirm",
    [
      (troop_get_slot, "$g_player_minister", "trp_player", 30),
    ]],

  [plyr|anyone, "minister_replace_select",
    [],
    "Actually, hold off on that.",
    "minister_pretalk",
    []],

  [anyone, "minister_replace_confirm",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 5),
    ],
    "Very good. {s9} is your new minister. I shall make ready to rejoin you.",
    "close_window",
    [
      (str_store_troop_name, s9, "$g_player_minister"),
      (party_add_members, "p_main_party", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
      (try_begin),
        (main_party_has_troop, "$g_player_minister"),
        (party_remove_members, "p_main_party", "$g_player_minister", 1),
      (try_end),
      (try_for_range, ":var0", 0, "qst_quests_end"),
        (quest_slot_eq, ":var0", 6, "$g_talk_troop"),
        (try_begin),
          (check_quest_active, ":var0"),
          (call_script, "script_abort_quest", ":var0", 0),
        (try_end),
        (quest_set_slot, ":var0", 6, -1),
      (try_end),
    ]],

  [anyone, "minister_replace_confirm",
    [],
    "Very good. {s9} is your new minister. It has been an honor to serve you.",
    "close_window",
    [
      (str_store_troop_name, s9, "$g_player_minister"),
      (try_begin),
        (main_party_has_troop, "$g_player_minister"),
        (party_remove_members, "p_main_party", "$g_player_minister", 1),
      (try_end),
      (try_for_range, ":var0", 0, "qst_quests_end"),
        (quest_slot_eq, ":var0", 6, "$g_talk_troop"),
        (try_begin),
          (check_quest_active, ":var0"),
          (call_script, "script_abort_quest", ":var0", 0),
        (try_end),
        (quest_set_slot, ":var0", 6, -1),
      (try_end),
    ]],

  [anyone, "minister_grant_fief",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 64),
      (str_clear, s12),
      (try_begin),
        (is_between, ":var0", "p_town_1", "p_salt_mine"),
        (str_store_party_name, s4, ":var0"),
        (str_store_string, s12, "str_minister_advice_select_fief"),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s12, "str_minister_advice_select_fief_wait"),
      (try_end),
    ],
    "Which of your fiefs did you wish to grant?{s12}",
    "minister_grant_fief_select",
    []],

  [repeat_for_parties|plyr|anyone, "minister_grant_fief_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (neq, ":var0", "$g_player_court"),
      (party_get_slot, ":var2", ":var0", 7),
      (try_begin),
        (ge, ":var2", "trp_npc_adonja"),
        (store_troop_faction, ":var3", ":var2"),
        (neq, ":var3", "fac_player_supporters_faction"),
        (assign, ":var2", -1),
      (try_end),
      (le, ":var2", 0),
      (str_store_party_name, s1, ":var0"),
      (str_clear, s12),
      (try_begin),
        (party_slot_eq, ":var0", 7, -1),
        (str_store_string, s12, "str_unassigned_center"),
      (try_end),
    ],
    "{s1}{s12}",
    "minister_grant_fief_select_recipient",
    [
      (store_repeat_object, "$fief_selected"),
    ]],

  [plyr|anyone, "minister_grant_fief_select",
    [],
    "Never mind",
    "minister_pretalk",
    []],

  [anyone, "minister_grant_fief_select_recipient",
    [
      (str_clear, s12),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$fief_selected"),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_set_slot, ":var0", 46, 0),
        (try_end),
        (assign, ":var1", -1),
        (assign, ":var2", 0),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var3", ":var0"),
          (eq, ":var3", "fac_player_supporters_faction"),
          (troop_get_slot, ":var4", ":var0", 154),
          (ge, ":var4", 0),
          (troop_get_slot, ":var5", ":var4", 46),
          (val_add, ":var5", 1),
          (troop_set_slot, ":var4", 46, ":var5"),
          (gt, ":var5", ":var2"),
          (assign, ":var2", ":var5"),
          (assign, ":var1", ":var4"),
        (try_end),
        (is_between, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (str_store_troop_name, s4, ":var1"),
        (assign, reg4, ":var2"),
        (str_store_string, s12, "str_minister_advice_fief_leading_vassal"),
      (try_end),
    ],
    "And who will you choose to receive the fief?{s12}",
    "minister_grant_fief_select_recipient_choice",
    []],

  [repeat_for_troops|plyr|anyone, "minister_grant_fief_select_recipient_choice",
    [
      (store_repeat_object, ":var0"),
      (this_or_next|troop_slot_eq, ":var0", 2, 2),
      (eq, ":var0", "trp_player"),
      (this_or_next|is_between, ":var0", "trp_kingdom_heroes_including_player_begin", "trp_kingdom_5_pretender"),
      (eq, ":var0", "trp_player"),
      (store_troop_faction, ":var1", ":var0"),
      (this_or_next|eq, ":var1", "fac_player_supporters_faction"),
      (eq, ":var0", "trp_player"),
      (str_store_troop_name, s1, ":var0"),
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", ":var0"),
      (str_clear, s12),
      (try_begin),
        (eq, reg0, 0),
        (str_store_string, s11, "str_no_fiefss12"),
      (else_try),
        (str_store_string, s11, "str_fiefs_s0s12"),
      (try_end),
    ],
    "{s1} {s11}",
    "minister_grant_fief_complete",
    [
      (store_repeat_object, "$lord_selected"),
    ]],

  [plyr|anyone, "minister_grant_fief_select_recipient_choice",
    [],
    "Never mind",
    "minister_pretalk",
    []],

  [anyone, "minister_grant_fief_complete",
    [],
    "Very well - {s2} shall receive {s1}.",
    "minister_pretalk",
    [
      (call_script, "script_give_center_to_lord", "$fief_selected", "$lord_selected", 0),
      (try_begin),
        (assign, ":var0", 0),
        (try_begin),
          (troop_get_slot, ":var1", "trp_player", 30),
          (gt, ":var1", 0),
          (troop_get_type, ":var2", ":var1"),
          (eq, ":var2", 0),
          (troop_slot_eq, ":var1", 2, 2),
          (assign, ":var0", 1),
        (try_end),
        (try_begin),
          (eq, ":var0", 1),
          (this_or_next|eq, "$lord_selected", ":var0"),
          (eq, "$lord_selected", "trp_player"),
          (call_script, "script_disband_skilled_garrison_in_fief_assigned_to_player", "$fief_selected"),
        (else_try),
          (eq, "$lord_selected", "trp_player"),
          (call_script, "script_disband_skilled_garrison_in_fief_assigned_to_player", "$fief_selected"),
        (try_end),
      (try_end),
      (str_store_party_name, s1, "$fief_selected"),
      (str_store_troop_name, s2, "$lord_selected"),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$fief_selected"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (call_script, "script_add_log_entry", 20, "trp_player", "$fief_selected", "$lord_selected", "$g_encountered_party_faction"),
    ]],

  [anyone, "minister_indict",
    [],
    "Grim news, {reg63?sire:my lady}. Who do you believe is planning to betray you?",
    "minister_indict_select",
    []],

  [repeat_for_troops|plyr|anyone, "minister_indict_select",
    [
      (store_repeat_object, ":var0"),
      (troop_slot_eq, ":var0", 2, 2),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (str_store_troop_name, s11, ":var0"),
    ],
    "{s11}",
    "minister_indict_confirm",
    [
      (store_repeat_object, "$lord_selected"),
    ]],

  [plyr|anyone, "minister_indict_select",
    [],
    "Never mind.",
    "minister_pretalk",
    []],

  [anyone, "minister_indict_confirm",
    [
      (str_store_troop_name, s4, "$lord_selected"),
      (troop_get_type, reg4, "$lord_selected"),
    ],
    "Think carefully on this, {reg63?sire:my lady}. If you indict {s4} for treason unjustly, you may find that others become nervous about serving you. On the other hand, if you truly believe that {reg4?she:he} is about to betray you, then perhaps it is best to move first, to secure control of {reg4?her:his} fortresses.",
    "minister_indict_confirm_answer",
    []],

  [plyr|anyone, "minister_indict_confirm_answer",
    [],
    "I have thought long enough. Issue the indictment!",
    "minister_indict_conclude",
    []],

  [plyr|anyone, "minister_indict_confirm_answer",
    [],
    "Perhaps I should wait a little while longer..",
    "minister_pretalk",
    []],

  [anyone, "minister_indict_conclude",
    [],
    "It has been sent, {reg63?sire:my lady}.",
    "minister_pretalk",
    [
      (call_script, "script_indict_lord_for_treason", "$lord_selected", "fac_player_supporters_faction"),
    ]],

  [repeat_for_troops|plyr|anyone, "center_captured_lord_advice",
    [
      (store_repeat_object, ":var0"),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, "$g_talk_troop", ":var0"),
      (neq, "trp_player", ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (str_store_troop_name, s11, ":var0"),
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", ":var0"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 53, 3),
        (str_store_string, s12, "str__promised_fief"),
      (else_try),
        (str_clear, s12),
      (try_end),
      (try_begin),
        (eq, reg0, 0),
        (str_store_string, s1, "str_no_fiefss12"),
      (else_try),
        (str_store_string, s1, "str_fiefs_s0s12"),
      (try_end),
    ],
    "{s11}. {s1}",
    "center_captured_lord_advice_2",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "center_captured_lord_advice",
    [
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "trp_player"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (str_store_string, s12, "str_please_s65_"),
      (else_try),
        (str_clear, s12),
      (try_end),
    ],
    "{s12}I want to have {s1} for myself. (fiefs: {s0})",
    "center_captured_lord_advice_2",
    [
      (assign, "$temp", "trp_player"),
    ]],

  [plyr|anyone, "center_captured_lord_advice",
    [
      (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "$g_talk_troop"),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
    ],
    "{s66}, you should have {s1} for yourself. (fiefs: {s0})",
    "center_captured_lord_advice_2",
    [
      (assign, "$temp", "$g_talk_troop"),
    ]],

  [anyone, "center_captured_lord_advice_2",
    [
      (eq, "$g_talk_troop", "$g_player_minister"),
    ],
    "As you wish, {reg63?sire:my lady}. {reg6?I:{reg7?You:{s11}}} will be the new {reg3?lady:lord} of {s1}.",
    "minister_issues",
    [
      (assign, ":var0", "$temp"),
      (call_script, "script_give_center_to_lord", "$g_center_taken_by_player_faction", ":var0", 0),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$g_center_taken_by_player_faction"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (try_begin),
        (neq, ":var0", "trp_player"),
        (try_for_range, ":var1", 0, 4),
          (call_script, "script_cf_reinforce_party", "$g_center_taken_by_player_faction"),
        (try_end),
      (try_end),
      (assign, reg6, 0),
      (assign, reg7, 0),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (assign, reg6, 1),
      (else_try),
        (eq, ":var0", "trp_player"),
        (assign, reg7, 1),
      (else_try),
        (str_store_troop_name, s11, ":var0"),
      (try_end),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (troop_get_type, reg3, ":var0"),
      (assign, "$g_center_taken_by_player_faction", -1),
    ]],

  [anyone, "center_captured_lord_advice_2",
    [],
    "Hmmm. All right, {playername}. I value your counsel highly. {reg6?I:{reg7?You:{s11}}} will be the new {reg3?lady:lord} of {s1}.",
    "close_window",
    [
      (assign, ":var0", "$temp"),
      (troop_set_slot, ":var0", 53, 0),
      (call_script, "script_give_center_to_lord", "$g_center_taken_by_player_faction", ":var0", 0),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 64, "$g_center_taken_by_player_faction"),
        (faction_set_slot, "$players_kingdom", 64, -1),
      (try_end),
      (try_begin),
        (neq, ":var0", "trp_player"),
        (try_for_range, ":var1", 0, 4),
          (call_script, "script_cf_reinforce_party", "$g_center_taken_by_player_faction"),
        (try_end),
      (try_end),
      (assign, reg6, 0),
      (assign, reg7, 0),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (assign, reg6, 1),
      (else_try),
        (eq, ":var0", "trp_player"),
        (assign, reg7, 1),
      (else_try),
        (str_store_troop_name, s11, ":var0"),
      (try_end),
      (str_store_party_name, s1, "$g_center_taken_by_player_faction"),
      (troop_get_type, reg3, ":var0"),
      (assign, "$g_center_taken_by_player_faction", -1),
    ]],

  [trp_npc_sigismund, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_siggy_to_adonja_1_a"),
      (play_sound, "snd_siggy_to_adonja_1_a"),
    ]],

  [trp_npc_sigismund|other(trp_npc_adonja), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_adonja_to_siggy_1_a"),
      (play_sound, "snd_adonja_to_siggy_1_a"),
    ]],

  [trp_npc_sigismund, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_siggy_to_adonja_2_a"),
      (play_sound, "snd_siggy_to_adonja_2_a"),
    ]],

  [trp_npc_sigismund|other(trp_npc_adonja), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_adonja_to_siggy_2_a"),
      (play_sound, "snd_adonja_to_siggy_2_a"),
    ]],

  [trp_npc_donavan, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_donavan_to_leslie_1_a"),
      (play_sound, "snd_donavan_to_leslie_1_a"),
    ]],

  [trp_npc_donavan|other(trp_npc_leslie), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_leslie_to_donavan_1_a"),
      (play_sound, "snd_leslie_to_donavan_1_a"),
    ]],

  [trp_npc_donavan, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_donavan_to_leslie_2_a"),
      (play_sound, "snd_donavan_to_leslie_2_a"),
    ]],

  [trp_npc_donavan|other(trp_npc_leslie), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_leslie_to_donavan_2_a"),
      (play_sound, "snd_leslie_to_donavan_2_a"),
    ]],

  [trp_npc_ansen, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_ansen_to_boadice_1_a"),
      (play_sound, "snd_ansen_to_boadice_1_a"),
    ]],

  [trp_npc_ansen|other(trp_npc_boadice), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_boadice_to_ansen_1_a"),
      (play_sound, "snd_boadice_to_ansen_1_a"),
    ]],

  [trp_npc_ansen, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_ansen_to_boadice_2_a"),
      (play_sound, "snd_ansen_to_boadice_2_a"),
    ]],

  [trp_npc_ansen|other(trp_npc_boadice), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_boadice_to_ansen_2_a"),
      (play_sound, "snd_boadice_to_ansen_2_a"),
    ]],

  [trp_npc_riva, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_julia"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_riva_to_julia_1_a"),
      (play_sound, "snd_riva_to_julia_1_a"),
    ]],

  [trp_npc_riva|other(trp_npc_julia), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_julia"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_julia_to_riva_1_a"),
      (play_sound, "snd_julia_to_riva_1_a"),
    ]],

  [trp_npc_riva, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_julia"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_riva_to_julia_2_a"),
      (play_sound, "snd_riva_to_julia_2_a"),
    ]],

  [trp_npc_riva|other(trp_npc_julia), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_julia"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_julia_to_riva_2_a"),
      (play_sound, "snd_julia_to_riva_2_a"),
    ]],

  [trp_npc_kassim, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_kassim_to_kaverra_1_a"),
      (play_sound, "snd_kassim_to_kaverra_1_a"),
    ]],

  [trp_npc_kassim|other(trp_npc_kaverra), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_kaverra_to_kassim_1_a"),
      (play_sound, "snd_kaverra_to_kassim_1_a"),
    ]],

  [trp_npc_kassim, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_kassim_to_kaverra_2_a"),
      (play_sound, "snd_kassim_to_kaverra_2_a"),
    ]],

  [trp_npc_kassim|other(trp_npc_kaverra), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_kaverra_to_kassim_2_a"),
      (play_sound, "snd_kaverra_to_kassim_2_a"),
    ]],

  [trp_npc_kassim, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_6",
    [
      (str_store_string, s4, "str_npc_kassim_to_kaverra_3_a"),
      (play_sound, "snd_kassim_to_kaverra_3_a"),
    ]],

  [trp_npc_kassim|other(trp_npc_kaverra), "npc_clash_line_6",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_kaverra_to_kassim_3_a"),
      (play_sound, "snd_kaverra_to_kassim_3_a"),
    ]],

  [trp_npc_ediz, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_ediz_to_lethaldiran_1_a"),
      (play_sound, "snd_ediz_to_lethaldiran_1_a"),
    ]],

  [trp_npc_ediz|other(trp_npc_lethaldiran), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_ediz_1_a"),
      (play_sound, "snd_lethaldiran_to_ediz_1_a"),
    ]],

  [trp_npc_ediz, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_ediz_to_lethaldiran_2_a"),
      (play_sound, "snd_ediz_to_lethaldiran_2_a"),
    ]],

  [trp_npc_ediz|other(trp_npc_lethaldiran), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_ediz_2_a"),
      (play_sound, "snd_lethaldiran_to_ediz_2_a"),
    ]],

  [trp_npc_ediz, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_6",
    [
      (str_store_string, s4, "str_npc_ediz_to_lethaldiran_3_a"),
      (play_sound, "snd_ediz_to_lethaldiran_3_a"),
    ]],

  [trp_npc_ediz|other(trp_npc_lethaldiran), "npc_clash_line_6",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_ediz_3_a"),
      (play_sound, "snd_lethaldiran_to_ediz_3_a"),
    ]],

  [trp_npc_jocelyn, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_diev"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_diev_1_a"),
      (play_sound, "snd_jocelyn_to_diev_1_a"),
    ]],

  [trp_npc_jocelyn|other(trp_npc_diev), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_diev"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_diev_to_jocelyn_1_a"),
      (play_sound, "snd_diev_to_jocelyn_1_a"),
    ]],

  [trp_npc_jocelyn, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_diev"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_diev_2_a"),
      (play_sound, "snd_jocelyn_to_diev_2_a"),
    ]],

  [trp_npc_jocelyn|other(trp_npc_diev), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_diev"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_diev_to_jocelyn_2_a"),
      (play_sound, "snd_diev_to_jocelyn_2_a"),
    ]],

  [trp_npc_alistair, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_alistair_to_roland_1_a"),
      (play_sound, "snd_alistair_to_roland_1_a"),
    ]],

  [trp_npc_alistair|other(trp_npc_roland), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_roland_to_alistair_1_a"),
      (play_sound, "snd_roland_to_alistair_1_a"),
    ]],

  [trp_npc_alistair, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_alistair_to_roland_2_a"),
      (play_sound, "snd_alistair_to_roland_2_a"),
    ]],

  [trp_npc_alistair|other(trp_npc_roland), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_roland_to_alistair_2_a"),
      (play_sound, "snd_roland_to_alistair_2_a"),
    ]],

  [trp_npc_alistair, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_alistair_to_roland_3_a"),
      (play_sound, "snd_alistair_to_roland_3_a"),
    ]],

  [trp_npc_rayne, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_rayne_to_fred_1_a"),
      (play_sound, "snd_rayne_to_fred_1_a"),
    ]],

  [trp_npc_rayne|other(trp_npc_frederick), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_fred_to_rayne_1_a"),
      (play_sound, "snd_fred_to_rayne_1_a"),
    ]],

  [trp_npc_rayne, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_rayne_to_fred_2_a"),
      (play_sound, "snd_rayne_to_fred_2_a"),
    ]],

  [trp_npc_rayne|other(trp_npc_frederick), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_fred_to_rayne_2_a"),
      (play_sound, "snd_fred_to_rayne_2_a"),
    ]],

  [trp_npc_alyssa, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_alyssa_to_sara_1_a"),
      (play_sound, "snd_alyssa_to_sara_1_a"),
    ]],

  [trp_npc_alyssa|other(trp_npc_sara), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_sara_to_alyssa_1_a"),
      (play_sound, "snd_sara_to_alyssa_1_a"),
    ]],

  [trp_npc_alyssa, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_alyssa_to_sara_2_a"),
      (play_sound, "snd_alyssa_to_sara_2_a"),
    ]],

  [trp_npc_alyssa|other(trp_npc_sara), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_sara_to_alyssa_2_a"),
      (play_sound, "snd_sara_to_alyssa_2_a"),
    ]],

  [trp_npc_diev, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_diev_to_adonja_1_b"),
      (play_sound, "snd_diev_to_adonja_1_b"),
    ]],

  [trp_npc_diev|other(trp_npc_adonja), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_adonja_to_diev_1_b"),
      (play_sound, "snd_adonja_to_diev_1_b"),
    ]],

  [trp_npc_diev, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_diev_to_adonja_2_b"),
      (play_sound, "snd_diev_to_adonja_2_b"),
    ]],

  [trp_npc_diev|other(trp_npc_adonja), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_adonja_to_diev_2_b"),
      (play_sound, "snd_adonja_to_diev_2_b"),
    ]],

  [trp_npc_leslie, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kassim"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_leslie_to_kassim_b"),
      (play_sound, "snd_leslie_to_kassim_b"),
    ]],

  [trp_npc_leslie|other(trp_npc_kassim), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kassim"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_kassim_to_leslie_b"),
      (play_sound, "snd_kassim_to_leslie_b"),
    ]],

  [trp_npc_frederick, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ansen"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_fred_to_ansen_1_b"),
      (play_sound, "snd_fred_to_ansen_1_b"),
    ]],

  [trp_npc_frederick|other(trp_npc_ansen), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ansen"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_ansen_to_fred_1_b"),
      (play_sound, "snd_ansen_to_fred_1_b"),
    ]],

  [trp_npc_frederick, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ansen"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_fred_to_ansen_2_b"),
      (play_sound, "snd_fred_to_ansen_2_b"),
    ]],

  [trp_npc_frederick|other(trp_npc_ansen), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ansen"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_ansen_to_fred_2_b"),
      (play_sound, "snd_ansen_to_fred_2_b"),
    ]],

  [trp_npc_lethaldiran, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_riva_1_b"),
      (play_sound, "snd_lethaldiran_to_riva_1_b"),
    ]],

  [trp_npc_lethaldiran|other(trp_npc_riva), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_riva_to_lethaldiran_1_b"),
      (play_sound, "snd_riva_to_lethaldiran_1_b"),
    ]],

  [trp_npc_lethaldiran, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_riva_2_b"),
      (play_sound, "snd_lethaldiran_to_riva_2_b"),
    ]],

  [trp_npc_lethaldiran|other(trp_npc_riva), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_riva_to_lethaldiran_2_b"),
      (play_sound, "snd_riva_to_lethaldiran_2_b"),
    ]],

  [trp_npc_lethaldiran, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_riva_3_b"),
      (play_sound, "snd_lethaldiran_to_riva_3_b"),
    ]],

  [trp_npc_jocelyn, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alistair"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_alistair_1_b"),
      (play_sound, "snd_jocelyn_to_alistair_1_b"),
    ]],

  [trp_npc_jocelyn|other(trp_npc_alistair), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alistair"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_alistair_to_jocelyn_1_b"),
      (play_sound, "snd_alistair_to_jocelyn_1_b"),
    ]],

  [trp_npc_jocelyn, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alistair"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_alistair_2_b"),
      (play_sound, "snd_jocelyn_to_alistair_2_b"),
    ]],

  [trp_npc_boadice, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_rayne"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_boadice_to_rayne_1_b"),
      (play_sound, "snd_boadice_to_rayne_1_b"),
    ]],

  [trp_npc_boadice|other(trp_npc_rayne), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_rayne"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_rayne_to_boadice_1_b"),
      (play_sound, "snd_rayne_to_boadice_1_b"),
    ]],

  [trp_npc_boadice, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_rayne"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_boadice_to_rayne_2_b"),
      (play_sound, "snd_boadice_to_rayne_2_b"),
    ]],

  [trp_npc_boadice|other(trp_npc_rayne), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_rayne"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_rayne_to_boadice_2_b"),
      (play_sound, "snd_rayne_to_boadice_2_b"),
    ]],

  [trp_npc_julia, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_julia_to_sara_1_b"),
      (play_sound, "snd_julia_to_sara_1_b"),
    ]],

  [trp_npc_julia|other(trp_npc_sara), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_sara_to_julia_1_b"),
      (play_sound, "snd_sara_to_julia_1_b"),
    ]],

  [trp_npc_julia, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_julia_to_sara_2_b"),
      (play_sound, "snd_julia_to_sara_2_b"),
    ]],

  [trp_npc_ediz, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_ediz_to_kaverra_1_b"),
      (play_sound, "snd_ediz_to_kaverra_1_b"),
    ]],

  [trp_npc_ediz|other(trp_npc_kaverra), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_kaverra_to_ediz_1_b"),
      (play_sound, "snd_kaverra_to_ediz_1_b"),
    ]],

  [trp_npc_ediz, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_ediz_to_kaverra_2_b"),
      (play_sound, "snd_ediz_to_kaverra_2_b"),
    ]],

  [trp_npc_ediz|other(trp_npc_kaverra), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_kaverra_to_ediz_2_b"),
      (play_sound, "snd_kaverra_to_ediz_2_b"),
    ]],

  [trp_npc_ediz, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "npc_clash_line_6",
    [
      (str_store_string, s4, "str_npc_ediz_to_kaverra_3_b"),
      (play_sound, "snd_ediz_to_kaverra_3_b"),
    ]],

  [trp_npc_ediz|other(trp_npc_kaverra), "npc_clash_line_6",
    [
      (eq, "$npc_dialog_partner", "trp_npc_kaverra"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_kaverra_to_ediz_3_b"),
      (play_sound, "snd_kaverra_to_ediz_3_b"),
    ]],

  [trp_npc_sigismund, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_donavan"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_siggy_to_donavan_1_b"),
      (play_sound, "snd_siggy_to_donavan_1_b"),
    ]],

  [trp_npc_sigismund|other(trp_npc_donavan), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_donavan"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_donavan_to_siggy_1_b"),
      (play_sound, "snd_donavan_to_siggy_1_b"),
    ]],

  [trp_npc_sigismund, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_donavan"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_siggy_to_donavan_2_b"),
      (play_sound, "snd_siggy_to_donavan_2_b"),
    ]],

  [trp_npc_sigismund|other(trp_npc_donavan), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_donavan"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_donavan_to_siggy_2_b"),
      (play_sound, "snd_donavan_to_siggy_2_b"),
    ]],

  [trp_npc_alyssa, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_alyssa_to_roland_1_b"),
      (play_sound, "snd_alyssa_to_roland_1_b"),
    ]],

  [trp_npc_alyssa|other(trp_npc_roland), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_roland_to_alyssa_1_b"),
      (play_sound, "snd_roland_to_alyssa_1_b"),
    ]],

  [trp_npc_alyssa, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_alyssa_to_roland_2_b"),
      (play_sound, "snd_alyssa_to_roland_2_b"),
    ]],

  [trp_npc_alyssa|other(trp_npc_roland), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_5",
    [
      (str_store_string, s4, "str_npc_roland_to_alyssa_2_b"),
      (play_sound, "snd_roland_to_alyssa_2_b"),
    ]],

  [trp_npc_alyssa, "npc_clash_line_5",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_6",
    [
      (str_store_string, s4, "str_npc_alyssa_to_roland_3_b"),
      (play_sound, "snd_alyssa_to_roland_3_b"),
    ]],

  [trp_npc_alyssa|other(trp_npc_roland), "npc_clash_line_6",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_roland_to_alyssa_3_b"),
      (play_sound, "snd_roland_to_alyssa_3_b"),
    ]],

  [trp_npc_ansen, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_ansen_to_adonja_c"),
      (play_sound, "snd_ansen_to_adonja_c"),
    ]],

  [trp_npc_ansen|other(trp_npc_adonja), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_adonja"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_adonja_to_ansen_c"),
      (play_sound, "snd_adonja_to_ansen_c"),
    ]],

  [trp_npc_diev, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_diev_to_leslie_c"),
      (play_sound, "snd_diev_to_leslie_c"),
    ]],

  [trp_npc_diev|other(trp_npc_leslie), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_leslie"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_leslie_to_diev_c"),
      (play_sound, "snd_leslie_to_diev_c"),
    ]],

  [trp_npc_kassim, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_kassim_to_riva_c"),
      (play_sound, "snd_kassim_to_riva_c"),
    ]],

  [trp_npc_kassim|other(trp_npc_riva), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_riva"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_riva_to_kassim_c"),
      (play_sound, "snd_riva_to_kassim_c"),
    ]],

  [trp_npc_julia, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_julia_to_lethaldiran_c"),
      (play_sound, "snd_julia_to_lethaldiran_c"),
    ]],

  [trp_npc_julia|other(trp_npc_lethaldiran), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_lethaldiran"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_julia_c"),
      (play_sound, "snd_lethaldiran_to_julia_c"),
    ]],

  [trp_npc_jocelyn, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_boadice_1_c"),
      (play_sound, "snd_jocelyn_to_boadice_1_c"),
    ]],

  [trp_npc_jocelyn|other(trp_npc_boadice), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_boadice_to_jocelyn_1_c"),
      (play_sound, "snd_boadice_to_jocelyn_1_c"),
    ]],

  [trp_npc_jocelyn, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_boadice_2_c"),
      (play_sound, "snd_jocelyn_to_boadice_2_c"),
    ]],

  [trp_npc_jocelyn|other(trp_npc_boadice), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_boadice"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_boadice_to_jocelyn_2_c"),
      (play_sound, "snd_boadice_to_jocelyn_2_c"),
    ]],

  [trp_npc_alistair, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alyssa"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_alistair_to_alyssa_1_c"),
      (play_sound, "snd_alistair_to_alyssa_1_c"),
    ]],

  [trp_npc_alistair|other(trp_npc_alyssa), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alyssa"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_alyssa_to_alistair_1_c"),
      (play_sound, "snd_alyssa_to_alistair_1_c"),
    ]],

  [trp_npc_alistair, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alyssa"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_alistair_to_alyssa_2_c"),
      (play_sound, "snd_alistair_to_alyssa_2_c"),
    ]],

  [trp_npc_alistair|other(trp_npc_alyssa), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_alyssa"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_alyssa_to_alistair_2_c"),
      (play_sound, "snd_alyssa_to_alistair_2_c"),
    ]],

  [trp_npc_rayne, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ediz"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_rayne_to_ediz_c"),
      (play_sound, "snd_rayne_to_ediz_c"),
    ]],

  [trp_npc_rayne|other(trp_npc_ediz), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_ediz"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_ediz_to_rayne_c"),
      (play_sound, "snd_ediz_to_rayne_c"),
    ]],

  [trp_npc_donavan, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_donavan_to_fred_c"),
      (play_sound, "snd_donavan_to_fred_c"),
    ]],

  [trp_npc_donavan|other(trp_npc_frederick), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_frederick"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_fred_to_donavan_c"),
      (play_sound, "snd_fred_to_donavan_c"),
    ]],

  [trp_npc_sigismund, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_siggy_to_sara_1_c"),
      (play_sound, "snd_siggy_to_sara_1_c"),
    ]],

  [trp_npc_sigismund|other(trp_npc_sara), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_sara_to_siggy_1_c"),
      (play_sound, "snd_sara_to_siggy_1_c"),
    ]],

  [trp_npc_sigismund, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_siggy_to_sara_2_c"),
      (play_sound, "snd_siggy_to_sara_2_c"),
    ]],

  [trp_npc_sigismund|other(trp_npc_sara), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_sara"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_sara_to_siggy_2_c"),
      (play_sound, "snd_sara_to_siggy_2_c"),
    ]],

  [trp_npc_kaverra, "event_triggered",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_2",
    [
      (str_store_string, s4, "str_npc_kaverra_to_roland_1_c"),
      (play_sound, "snd_kaverra_to_roland_1_c"),
    ]],

  [trp_npc_kaverra|other(trp_npc_roland), "npc_clash_line_2",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_3",
    [
      (str_store_string, s4, "str_npc_roland_to_kaverra_1_c"),
      (play_sound, "snd_roland_to_kaverra_1_c"),
    ]],

  [trp_npc_kaverra, "npc_clash_line_3",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "npc_clash_line_4",
    [
      (str_store_string, s4, "str_npc_kaverra_to_roland_2_c"),
      (play_sound, "snd_kaverra_to_roland_2_c"),
    ]],

  [trp_npc_kaverra|other(trp_npc_roland), "npc_clash_line_4",
    [
      (eq, "$npc_dialog_partner", "trp_npc_roland"),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_roland_to_kaverra_2_c"),
      (play_sound, "snd_roland_to_kaverra_2_c"),
    ]],

  [trp_npc_adonja, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_adonja_to_player_e"),
      (play_sound, "snd_adonja_to_player_e"),
    ]],

  [trp_npc_leslie, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_leslie_to_player_e"),
      (play_sound, "snd_leslie_to_player_e"),
    ]],

  [trp_npc_ansen, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_ansen_to_player_e"),
      (play_sound, "snd_ansen_to_player_e"),
    ]],

  [trp_npc_riva, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_riva_to_player_e"),
      (play_sound, "snd_riva_to_player_e"),
    ]],

  [trp_npc_kassim, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_kassim_to_player_e"),
      (play_sound, "snd_kassim_to_player_e"),
    ]],

  [trp_npc_lethaldiran, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_player_e"),
      (play_sound, "snd_lethaldiran_to_player_e"),
    ]],

  [trp_npc_jocelyn, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_jocelyn_to_player_e"),
      (play_sound, "snd_jocelyn_to_player_e"),
    ]],

  [trp_npc_alistair, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_alistair_to_player_e"),
      (play_sound, "snd_alistair_to_player_e"),
    ]],

  [trp_npc_rayne, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_rayne_to_player_e"),
      (play_sound, "snd_rayne_to_player_e"),
    ]],

  [trp_npc_julia, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_julia_to_player_e"),
      (play_sound, "snd_julia_to_player_e"),
    ]],

  [trp_npc_frederick, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_fred_to_player_e"),
      (play_sound, "snd_fred_to_player_e"),
    ]],

  [trp_npc_ediz, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_ediz_to_player_e"),
      (play_sound, "snd_ediz_to_player_e"),
    ]],

  [trp_npc_sara, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_sara_to_player_e"),
      (play_sound, "snd_sara_to_player_e"),
    ]],

  [trp_npc_donavan, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_donavan_to_player_e"),
      (play_sound, "snd_donavan_to_player_e"),
    ]],

  [trp_npc_diev, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_diev_to_player_e"),
      (play_sound, "snd_diev_to_player_e"),
    ]],

  [trp_npc_alyssa, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_alyssa_to_player_e"),
      (play_sound, "snd_alyssa_to_player_e"),
    ]],

  [trp_npc_roland, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_roland_to_player_e"),
      (play_sound, "snd_roland_to_player_e"),
    ]],

  [trp_npc_kaverra, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_kaverra_to_player_e"),
      (play_sound, "snd_kaverra_to_player_e"),
    ]],

  [trp_npc_sigismund, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_siggy_to_player_e"),
      (play_sound, "snd_siggy_to_player_e"),
    ]],

  [trp_npc_boadice, "event_triggered",
    [
      (eq, "$npc_dialog_partner", -1),
    ],
    "{s4}",
    "player_response_to_npc_comments",
    [
      (str_store_string, s4, "str_npc_boadice_to_player_e"),
      (play_sound, "snd_boadice_to_player_e"),
    ]],

  [plyr|anyone, "player_response_to_npc_comments",
    [],
    "Very interesting. Thank you, I'll take that under advisement.",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (eq, "$g_infinite_camping", 0),
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_is_quitting"),
      (troop_get_slot, ":var0", "$map_talk_troop", 130),
      (str_store_string, s5, ":var0"),
    ],
    "Excuse me {s5} -- there is something I need to tell you.",
    "companion_quitting",
    [
      (assign, "$npc_is_quitting", 0),
      (assign, "$player_can_persuade_npc", 1),
      (assign, "$player_can_refuse_npc_quitting", 1),
      (eq, "$player_can_refuse_npc_quitting", 1),
    ]],

  [anyone, "companion_quitting",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (troop_get_slot, ":var0", "$map_talk_troop", 124),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_quitting_2",
    []],

  [anyone, "companion_quitting_2",
    [
      (call_script, "script_npc_morale", "$map_talk_troop"),
    ],
    "To tell you the truth, {s21}",
    "companion_quitting_response",
    []],

  [plyr|anyone, "companion_quitting_response",
    [],
    "Very well. You be off, then.",
    "companion_quitting_yes",
    []],

  [plyr|anyone, "companion_quitting_response",
    [
      (eq, "$player_can_persuade_npc", 1),
    ],
    "Perhaps I can persuade you to change your mind.",
    "companion_quitting_persuasion",
    [
      (assign, "$player_can_persuade_npc", 0),
    ]],

  [anyone, "companion_quitting_persuasion",
    [
      (store_random_in_range, ":var0", -2, 13),
      (store_skill_level, ":var1", skl_persuasion, "trp_player"),
      (le, ":var0", ":var1"),
    ],
    "Hm. When you put it like that, I suppose I can stay a while longer, see if things improve.",
    "close_window",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 69),
      (val_div, ":var0", 2),
      (troop_set_slot, "$map_talk_troop", 69, ":var0"),
      (troop_get_slot, ":var1", "$map_talk_troop", 77),
      (val_div, ":var1", 2),
      (troop_set_slot, "$map_talk_troop", 77, ":var1"),
    ]],

  [anyone, "companion_quitting_persuasion",
    [],
    "I'm sorry, but I don't see your point. I am leaving whether you like it or not.",
    "companion_quitting_response",
    []],

  [anyone, "companion_quitting_yes",
    [],
    "Then this is goodbye. Perhaps I'll see you around, {playername}.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 82, 3),
      (call_script, "script_retire_companion", "$map_talk_troop", 100),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_with_grievance"),
      (eq, "$npc_map_talk_context", 61),
      (try_begin),
        (eq, "$npc_grievance_slot", 61),
        (troop_get_slot, ":var0", "$map_talk_troop", 116),
      (else_try),
        (troop_get_slot, ":var0", "$map_talk_troop", 117),
      (try_end),
      (str_store_string, s21, "$npc_grievance_string"),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_objection_response",
    [
      (assign, "$npc_with_grievance", 0),
    ]],

  [plyr|anyone, "companion_objection_response",
    [
      (eq, "$npc_praise_not_complaint", 1),
    ],
    "Thanks, I appreciate your support.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", "$npc_grievance_slot", 1),
    ]],

  [plyr|anyone, "companion_objection_response",
    [
      (eq, "$npc_praise_not_complaint", 0),
    ],
    "Hopefully it won't happen again.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", "$npc_grievance_slot", 1),
    ]],

  [plyr|anyone, "companion_objection_response",
    [
      (eq, "$npc_praise_not_complaint", 0),
    ],
    "Your objection is noted. Now fall back in line.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", "$npc_grievance_slot", 2),
      (troop_get_slot, ":var0", "$map_talk_troop", 69),
      (val_add, ":var0", 10),
      (troop_set_slot, "$map_talk_troop", 69, ":var0"),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_with_personality_clash_2"),
      (eq, "$npc_map_talk_context", 74),
      (troop_get_slot, ":var0", "$map_talk_troop", 120),
      (troop_get_slot, ":var1", "$map_talk_troop", 73),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_personalityclash2_b",
    [
      (assign, "$npc_with_personality_clash_2", 0),
      (troop_get_slot, ":var0", "$map_talk_troop", 77),
      (val_add, ":var0", 5),
      (troop_set_slot, "$map_talk_troop", 77, ":var0"),
      (troop_get_slot, ":var1", "$map_talk_troop", 73),
      (call_script, "script_troop_change_relation_with_troop", "$map_talk_troop", ":var1", -15),
    ]],

  [anyone, "companion_personalityclash2_b",
    [],
    "{s5}",
    "companion_personalityclash2_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 121),
      (troop_get_slot, ":var1", "$map_talk_troop", 73),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ]],

  [plyr|anyone, "companion_personalityclash2_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 73),
      (str_store_troop_name, s11, ":var0"),
      (troop_get_type, reg11, ":var0"),
    ],
    "{s11} is a valuable member of this company. I don't want you picking any more fights with {reg11?her:him}.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 74, 1),
      (str_store_troop_name, s11, "$map_talk_troop"),
      (display_message, "@{s11} is upset.", 0xFFFF00),
    ]],

  [plyr|anyone, "companion_personalityclash2_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 73),
      (str_store_troop_name, s11, ":var0"),
      (troop_get_type, reg11, ":var0"),
    ],
    "Tell {s11} you have my support in this, and {reg11?she:he} should hold {reg11?her:his} tongue.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 74, 2),
      (troop_get_slot, ":var0", "$map_talk_troop", 73),
      (str_store_troop_name, s11, ":var0"),
      (display_message, "@{s11} is upset.", 0xFFFF00),
    ]],

  [plyr|anyone, "companion_personalityclash2_response",
    [],
    "I don't have time for your petty dispute. Do not bother me with this again.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 74, 3),
      (troop_get_slot, ":var0", "$map_talk_troop", 73),
      (str_store_troop_name, s11, "$map_talk_troop"),
      (str_store_troop_name, s12, ":var0"),
      (display_message, "@{s11} and {s12} are upset at each other.", 0xFFFF00),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_with_personality_clash"),
      (eq, "$npc_map_talk_context", 72),
      (troop_get_slot, ":var0", "$map_talk_troop", 118),
      (troop_get_slot, ":var1", "$map_talk_troop", 71),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_personalityclash_b",
    [
      (assign, "$npc_with_personality_clash", 0),
      (troop_get_slot, ":var0", "$map_talk_troop", 77),
      (val_add, ":var0", 5),
      (troop_set_slot, "$map_talk_troop", 77, ":var0"),
      (troop_get_slot, ":var1", "$map_talk_troop", 71),
      (call_script, "script_troop_change_relation_with_troop", "$map_talk_troop", ":var1", -15),
    ]],

  [anyone, "companion_personalityclash_b",
    [],
    "{s5}",
    "companion_personalityclash_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 119),
      (troop_get_slot, ":var1", "$map_talk_troop", 71),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ]],

  [plyr|anyone, "companion_personalityclash_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 71),
      (str_store_troop_name, s11, ":var0"),
      (troop_get_type, reg11, ":var0"),
    ],
    "{s11} is a capable member of this company. I don't want you picking any more fights with {reg11?her:him}.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 72, 1),
      (str_store_troop_name, s12, "$map_talk_troop"),
      (display_message, "@{s12} is upset.", 0xFFFF00),
    ]],

  [plyr|anyone, "companion_personalityclash_response",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 71),
      (str_store_troop_name, s11, ":var0"),
      (troop_get_type, reg11, ":var0"),
    ],
    "Tell {s11} you have my support in this, and {reg11?she:he} should hold {reg11?her:his} tongue.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 72, 2),
      (display_message, "@{s11} is upset.", 0xFFFF00),
    ]],

  [plyr|anyone, "companion_personalityclash_response",
    [],
    "I don't have time for your petty dispute. Do not bother me with this again.",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 72, 3),
      (troop_get_slot, ":var0", "$map_talk_troop", 71),
      (str_store_troop_name, s11, "$map_talk_troop"),
      (str_store_troop_name, s12, ":var0"),
      (display_message, "@{s11} and {s12} are upset at each other.", 0xFFFF00),
    ]],

  [anyone, "event_triggered",
    [
      (eq, "$npc_map_talk_context", 76),
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_with_personality_match"),
      (troop_get_slot, ":var0", "$map_talk_troop", 122),
      (troop_get_slot, ":var1", "$map_talk_troop", 75),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_personalitymatch_b",
    [
      (assign, "$npc_with_personality_match", 0),
      (troop_get_slot, ":var0", "$map_talk_troop", 75),
      (call_script, "script_troop_change_relation_with_troop", "$map_talk_troop", ":var0", 15),
    ]],

  [anyone, "companion_personalitymatch_b",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 123),
      (troop_get_slot, ":var1", "$map_talk_troop", 75),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_personalitymatch_response",
    []],

  [plyr|anyone, "companion_personalitymatch_response",
    [
      (str_clear, s41),
      (store_random_in_range, ":var0", 0, 6),
      (try_begin),
        (eq, ":var0", 1),
        (str_store_string, s41, "@It is good to have a trusted companion. "),
      (else_try),
        (eq, ":var0", 2),
        (str_store_string, s41, "@It is good to know that you two are getting along so well. "),
      (else_try),
        (eq, ":var0", 3),
        (str_store_string, s41, "@Excellent news, I was worried that there would be bickering. "),
      (else_try),
        (eq, ":var0", 4),
        (str_store_string, s41, "@That is good to hear."),
      (else_try),
        (eq, ":var0", 5),
        (str_store_string, s41, "@It is good that someone has your back. "),
      (else_try),
        (str_store_string, s41, "@I am glad you approve and get along so well."),
      (try_end),
    ],
    "{s41}",
    "close_window",
    [
      (troop_set_slot, "$map_talk_troop", 76, 1),
      (troop_get_slot, ":var0", "$map_talk_troop", 75),
      (str_store_troop_name, s11, "$map_talk_troop"),
      (str_store_troop_name, s12, ":var0"),
      (display_message, "@{s11} likes {s12}.", 0xFFFF00),
    ]],

  [anyone, "event_triggered",
    [
      (eq, "$npc_map_talk_context", 139),
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (store_sub, ":var0", "$map_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_woman_to_woman", ":var0"),
      (str_store_string, s5, ":var1"),
    ],
    "{s5}",
    "companion_sisterly_advice",
    [
      (troop_set_slot, "$map_talk_troop", 139, -1),
      (assign, "$npc_with_sisterly_advice", 0),
    ]],

  [plyr|anyone, "companion_sisterly_advice",
    [],
    "Thank you.",
    "close_window",
    []],

  [plyr|anyone, "companion_sisterly_advice",
    [],
    "I would prefer not to discuss such things.",
    "close_window",
    [
      (assign, "$disable_sisterly_advice", 1),
    ]],

  [anyone, "event_triggered",
    [
      (eq, "$g_infinite_camping", 0),
      (eq, "$npc_map_talk_context", 60),
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_get_slot, ":var0", "$map_talk_troop", 126),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_home_description",
    [
      (troop_set_slot, "$map_talk_troop", 78, 1),
    ]],

  [plyr|anyone, "companion_home_description",
    [],
    "Tell me more.",
    "companion_home_description_2",
    []],

  [plyr|anyone, "companion_home_description",
    [],
    "We don't have time to chat just now.",
    "close_window",
    []],

  [plyr|anyone, "companion_home_description",
    [],
    "I prefer my companions not to bother me with such trivialities.",
    "close_window",
    [
      (assign, "$disable_local_histories", 1),
    ]],

  [anyone, "companion_home_description_2",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 127),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "companion_home_description_3",
    []],

  [anyone, "companion_home_description_3",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 128),
      (str_store_string, s5, ":var0"),
    ],
    "{s5}",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (eq, "$talk_context", 15),
      (store_conversation_troop, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (call_script, "script_set_player_relation_with_faction", ":var0", 60),
      (troop_add_item, "$g_talk_troop", "itm_royal_crown", imod_plain),
      (str_store_faction_name, s3, ":var0"),
      (str_store_string, s6, "@{playername}, when we started our long walk, few people had the courage to support me. And fewer still would be willing to put their lives at risk for my cause. But you didn't hesitate for a moment in throwing yourself at my enemies. We have gone through a lot together, and there were times I came close to losing all hope. But with God's help, we prevailed. It is now time for me to leave your company and take what's rightfully mine. From now on, I will carry out the great responsibility of ruling {s3}. There still lie many challanges ahead and I count on your help in overcoming those. And of course, you will always remain as my foremost vassal."),
    ],
    "{s6}",
    "rebel_thanks_answer",
    [
      (372, 47),
      (call_script, "script_end_quest", "qst_rebel_against_kingdom"),
      (try_begin),
        (troop_get_type, ":var0", "trp_player"),
        (gt, ":var0", 0),
        (troop_get_type, ":var0", "$g_talk_troop"),
        (gt, ":var0", 0),
        (372, 76),
      (try_end),
    ]],

  [plyr|anyone, "rebel_thanks_answer",
    [],
    "It was an honor to fight for your cause, {reg65?madame:my lord}.",
    "rebel_thanks_answer_2",
    []],

  [plyr|anyone, "rebel_thanks_answer",
    [],
    "You will always have my loyal support, {reg65?my lady:sir}.",
    "rebel_thanks_answer_2",
    []],

  [anyone, "rebel_thanks_answer_2",
    [],
    "I will miss living this life of adventure with you, but my duties await me. So... farewell for now, {playername}. I hope I'll see you again soon.",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_with_political_grievance"),
      (eq, "$npc_map_talk_context", 145),
      (store_sub, ":var0", "$g_talk_troop", "trp_npc_adonja"),
      (store_add, ":var1", "str_npc_adonja_kingsupport_objection", ":var0"),
      (str_store_string, s21, ":var1"),
    ],
    "{s21}",
    "companion_political_grievance_response",
    [
      (assign, "$npc_with_political_grievance", 0),
      (troop_set_slot, "$map_talk_troop", 145, 2),
    ]],

  [plyr|anyone, "companion_political_grievance_response",
    [],
    "Your opinion is noted.",
    "close_window",
    [
      (troop_get_slot, ":var0", "$map_talk_troop", 69),
      (val_add, ":var0", 25),
      (troop_set_slot, "$map_talk_troop", 69, ":var0"),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_to_rejoin_party"),
      (neg|main_party_has_troop, "$map_talk_troop"),
      (troop_slot_eq, "$map_talk_troop", 152, 8),
      (troop_slot_eq, "$map_talk_troop", 2, 5),
      (troop_get_slot, ":var0", "$map_talk_troop", 130),
      (str_store_string, s21, ":var0"),
    ],
    "Greetings, {s21}. Are you ready for me to rejoin you?",
    "companion_rejoin_response",
    [
      (assign, "$npc_to_rejoin_party", 0),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_to_rejoin_party"),
      (troop_slot_eq, "$g_talk_troop", 152, 1),
      (troop_get_slot, ":var0", "$map_talk_troop", 130),
      (str_store_string, s21, ":var0"),
    ],
    "Well, {s21}, at last I've found you. I've been out spreading the word about your claim and am now ready to rejoin the company. I was able to convince few warriors to support our case.",
    "companion_rejoin_response",
    [
      (assign, "$npc_to_rejoin_party", 0),
      (call_script, "script_change_player_right_to_rule", 3),
      (try_begin),
        (neg|check_quest_active, "qst_order_challenge"),
        (call_script, "script_rtr_quest_troops_reward", "$map_talk_troop", "p_main_party"),
      (else_try),
        (quest_get_slot, ":var0", "qst_order_challenge", 8),
        (gt, ":var0", -1),
        (call_script, "script_rtr_quest_troops_reward", "$map_talk_troop", ":var0"),
      (try_end),
      (troop_set_slot, "$g_talk_troop", 142, 1),
      (try_begin),
        (is_between, "$player_right_to_rule", 10, 15),
        (call_script, "script_add_log_entry", 24, "trp_player", 0, 0, 0),
      (else_try),
        (is_between, "$player_right_to_rule", 20, 25),
        (call_script, "script_add_log_entry", 25, "trp_player", 0, 0, 0),
      (try_end),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_to_rejoin_party"),
      (troop_slot_eq, "$map_talk_troop", 152, 2),
      (troop_get_slot, ":var0", "$map_talk_troop", 130),
      (str_store_string, s21, ":var0"),
      (troop_get_slot, ":var1", "$map_talk_troop", 67),
      (store_faction_of_party, ":var2", ":var1"),
      (call_script, "script_update_faction_political_notes", ":var2"),
      (assign, ":var3", reg0),
      (val_add, ":var3", reg0),
      (val_add, ":var3", reg1),
      (str_store_faction_name, s12, ":var2"),
      (try_begin),
        (ge, ":var3", 60),
        (str_store_string, s35, "str_the_s12_is_a_labyrinth_of_rivalries_and_grudges_lords_ignore_their_lieges_summons_and_many_are_ripe_to_defect"),
      (else_try),
        (ge, ":var3", 40),
        (str_store_string, s35, "str_the_s12_is_shaky_many_lords_do_not_cooperate_with_each_other_and_some_might_be_tempted_to_defect_to_a_liege_that_they_consider_more_worthy"),
      (else_try),
        (ge, ":var3", 20),
        (str_store_string, s35, "str_the_s12_is_fairly_solid_some_lords_bear_enmities_for_each_other_but_they_tend_to_stand_together_against_outside_enemies"),
      (else_try),
        (str_store_string, s35, "str_the_s12_is_a_rock_of_stability_politically_speaking_whatever_the_lords_may_think_of_each_other_they_fight_as_one_against_the_common_foe"),
      (try_end),
      (try_for_range, ":var4", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var4", 2, 2),
        (store_troop_faction, ":var5", ":var4"),
        (eq, ":var5", ":var2"),
        (call_script, "script_update_troop_political_notes", ":var4"),
      (try_end),
    ],
    "Well, {s21}, at last I've found you. {s35} The rest of my report I submit to you in writing.",
    "companion_rejoin_response",
    []],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_to_rejoin_party"),
      (troop_slot_eq, "$g_talk_troop", 152, 9),
      (troop_get_slot, ":var0", "$map_talk_troop", 130),
      (str_store_string, s21, ":var0"),
      (str_store_troop_name_plural, s11, "trp_player_knight"),
      (str_store_troop_name_plural, s12, "trp_player_sergeant"),
    ],
    "Well, {s21}, at last I've found you. I've been busy training your {s11} and {s12} on your orders.^Would you like to know the details?",
    "companion_rejoin_report_training",
    []],

  [plyr|anyone, "companion_rejoin_report_training",
    [
      (str_store_troop_name_plural, s11, "trp_player_knight"),
    ],
    "Yes, tell me about the {s11}.",
    "companion_rejoin_report_training_details",
    [
      (assign, "$g_pop_upgrade_troop", "trp_player_knight"),
      (assign, "$g_pop_upgrade_troop_dummy", "trp_player_knight_before_training"),
    ]],

  [plyr|anyone, "companion_rejoin_report_training",
    [
      (str_store_troop_name_plural, s12, "trp_player_sergeant"),
    ],
    "Yes, tell me about the {s12}.",
    "companion_rejoin_report_training_details",
    [
      (assign, "$g_pop_upgrade_troop", "trp_player_sergeant"),
      (assign, "$g_pop_upgrade_troop_dummy", "trp_player_sergeant_before_training"),
    ]],

  [plyr|anyone, "companion_rejoin_report_training",
    [],
    "Never mind that, I know enough.",
    "companion_rejoin_report_training_rejoin",
    []],

  [anyone, "companion_rejoin_report_training_details",
    [],
    "What do you want to hear about?",
    "companion_rejoin_report_training_details_choose",
    []],

  [plyr|anyone, "companion_rejoin_report_training_details_choose",
    [],
    "Tell me how did their physical training go.",
    "companion_rejoin_report_training_attr",
    []],

  [plyr|anyone, "companion_rejoin_report_training_details_choose",
    [],
    "I want to know about their skills.",
    "companion_rejoin_report_training_skills",
    []],

  [plyr|anyone, "companion_rejoin_report_training_details_choose",
    [],
    "How about their weapon proficiencies?",
    "companion_rejoin_report_training_prof",
    []],

  [plyr|anyone, "companion_rejoin_report_training_details_choose",
    [],
    "None of that, thank you.",
    "companion_rejoin_report_training_details_choose_back",
    []],

  [anyone, "companion_rejoin_report_training_details_choose_back",
    [],
    "Do you need to know more about the training?",
    "companion_rejoin_report_training",
    []],

  [anyone, "companion_rejoin_report_training_attr",
    [
      (str_store_string, s14, "@Here are the results of the physical training:"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", 0, 2),
        (store_attribute_level, reg2, "$g_pop_upgrade_troop", ":var1"),
        (store_attribute_level, ":var2", "$g_pop_upgrade_troop_dummy", ":var1"),
        (store_sub, reg1, reg2, ":var2"),
        (gt, reg1, 0),
        (assign, ":var0", 1),
        (try_begin),
          (eq, ":var1", 0),
          (str_store_string, s15, "@Strength"),
        (else_try),
          (str_store_string, s15, "@Agility"),
        (try_end),
        (str_store_string, s14, "@{s14}^- Increased their {s15} by {reg1} to {reg2}"),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s14, "@I am sorry, there were no changes to their Strength and Agility."),
      (try_end),
    ],
    "{s14}",
    "companion_rejoin_report_training_details_choose",
    []],

  [anyone, "companion_rejoin_report_training_prof",
    [
      (str_store_string, s14, "@Here's what happened with the weapon proficiencies:"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", 0, 7),
        (store_proficiency_level, reg2, "$g_pop_upgrade_troop", ":var1"),
        (store_proficiency_level, ":var2", "$g_pop_upgrade_troop_dummy", ":var1"),
        (store_sub, reg1, reg2, ":var2"),
        (gt, reg1, 0),
        (assign, ":var0", 1),
        (try_begin),
          (eq, ":var1", 0),
          (str_store_string, s15, "@One-handed"),
        (else_try),
          (eq, ":var1", 1),
          (str_store_string, s15, "@Two-handed"),
        (else_try),
          (eq, ":var1", 2),
          (str_store_string, s15, "@Polearm"),
        (else_try),
          (eq, ":var1", 3),
          (str_store_string, s15, "@Archery"),
        (else_try),
          (eq, ":var1", 4),
          (str_store_string, s15, "@Crossbow"),
        (else_try),
          (eq, ":var1", 5),
          (str_store_string, s15, "@Throwing"),
        (else_try),
          (str_store_string, s15, "@Firearm"),
        (try_end),
        (str_store_string, s14, "@{s14}^- {s15} proficiency increased by {reg1} to {reg2}"),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s14, "@I am sorry, there were no changes to their weapon proficiencies."),
      (try_end),
    ],
    "{s14}",
    "companion_rejoin_report_training_details_choose",
    []],

  [anyone, "companion_rejoin_report_training_skills",
    [
      (str_store_string, s14, "@The skills were increased as follows:"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", 0, 42),
        (this_or_next|eq, ":var1", 23),
        (this_or_next|eq, ":var1", 24),
        (this_or_next|eq, ":var1", 25),
        (this_or_next|eq, ":var1", 26),
        (this_or_next|eq, ":var1", 33),
        (this_or_next|eq, ":var1", 34),
        (this_or_next|eq, ":var1", 35),
        (eq, ":var1", 36),
        (store_skill_level, reg2, ":var1", "$g_pop_upgrade_troop"),
        (store_skill_level, ":var2", ":var1", "$g_pop_upgrade_troop_dummy"),
        (store_sub, reg1, reg2, ":var2"),
        (gt, reg1, 0),
        (assign, ":var0", 1),
        (try_begin),
          (eq, ":var1", 23),
          (str_store_string, s15, "@Horse archery"),
        (else_try),
          (eq, ":var1", 24),
          (str_store_string, s15, "@Riding"),
        (else_try),
          (eq, ":var1", 25),
          (str_store_string, s15, "@Athletics"),
        (else_try),
          (eq, ":var1", 26),
          (str_store_string, s15, "@Shield"),
        (else_try),
          (eq, ":var1", 33),
          (str_store_string, s15, "@Power Draw"),
        (else_try),
          (eq, ":var1", 34),
          (str_store_string, s15, "@Power Throw"),
        (else_try),
          (eq, ":var1", 35),
          (str_store_string, s15, "@Power Strike"),
        (else_try),
          (str_store_string, s15, "@Ironflesh"),
        (try_end),
        (str_store_string, s14, "@{s14}^- {s15} skill increased by {reg1} to {reg2}"),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s14, "@I am sorry, there were no changes to their skills."),
      (try_end),
    ],
    "{s14}",
    "companion_rejoin_report_training_details_choose",
    []],

  [anyone, "companion_rejoin_report_training_rejoin",
    [],
    "I see. Are you ready for me to rejoin you?",
    "companion_rejoin_response",
    [
      (assign, "$npc_to_rejoin_party", 0),
    ]],

  [anyone, "event_triggered",
    [
      (store_conversation_troop, "$map_talk_troop"),
      (is_between, "$map_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$map_talk_troop", "$npc_to_rejoin_party"),
      (troop_get_slot, ":var0", "$g_talk_troop", 152),
      (this_or_next|eq, ":var0", 3),
      (this_or_next|eq, ":var0", 4),
      (this_or_next|eq, ":var0", 6),
      (this_or_next|eq, ":var0", 7),
      (eq, ":var0", 5),
      (troop_get_slot, ":var1", "$map_talk_troop", 130),
      (str_store_string, s21, ":var1"),
      (troop_get_slot, ":var2", "$g_talk_troop", 153),
      (str_store_faction_name, s31, ":var2"),
      (call_script, "script_npc_decision_checklist_peace_or_war", ":var2", "fac_player_supporters_faction", "$g_talk_troop"),
      (assign, "$g_mission_result", reg0),
    ],
    "Well, {s21}, at last I've found you. I have returned from my mission to {s31}. In general, I would say, {s14}.",
    "companion_embassy_results",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 5),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (this_or_next|ge, "$g_mission_result", 2),
      (faction_slot_eq, ":var0", 32, 1),
      (is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
      (neg|party_slot_eq, "$g_player_court", 61, ":var0"),
      (str_store_party_name, s4, "$g_player_court"),
    ],
    "In this letter, {s12} addresses you as {reg63?Lord:Lady} of {s4}, which implies some sort of recognition that you are a sovereign and independent monarch.",
    "companion_rejoin_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (try_begin),
        (faction_slot_eq, ":var0", 32, 0),
        (faction_set_slot, ":var0", 32, 1),
        (call_script, "script_change_player_right_to_rule", 10),
      (try_end),
    ]],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 5),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "In his letter, {s12} merely refers to you as {playername}, omitting any title. This does not constitute recognition of your right to rule.",
    "companion_rejoin_response",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 3),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_slot_ge, ":var0", 120, 1),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that your current truce should suffice.",
    "companion_rejoin_response",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 3),
      (ge, "$g_mission_result", 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that he is willing to consider a truce of forty days.",
    "companion_truce_confirm",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 3),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that he is unwilling to conclude a peace.",
    "companion_rejoin_response",
    []],

  [plyr|anyone, "companion_truce_confirm",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (str_store_faction_name, s4, ":var0"),
    ],
    "Very well - let this truce with the {s4} be concluded.",
    "companion_rejoin_response",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (call_script, "script_diplomacy_start_peace_between_kingdoms", ":var0", "$players_kingdom", 1),
      (str_store_faction_name, s4, ":var0"),
    ]],

  [plyr|anyone, "companion_truce_confirm",
    [],
    "On second thought, perhaps this is currently not in our interests.",
    "companion_rejoin_response",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 4),
      (this_or_next|check_quest_active, "qst_join_faction"),
      (is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that you are already pledged to another ruler.",
    "companion_rejoin_response",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 4),
      (lt, "$g_mission_result", -2),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that he does not believe that you would honor your obligations as a vassal, and suspects that your offer is just a ploy.",
    "companion_rejoin_response",
    []],

  [anyone, "companion_embassy_results",
    [
      (troop_slot_eq, "$g_talk_troop", 152, 4),
      (troop_get_slot, ":var0", "$g_talk_troop", 153),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
    ],
    "{s12} says that he accepts your offer of vassalage. He will give you 30 days to seek him out, in which time he will refrain from making war on you.",
    "vassalage_offer_confirm",
    []],

  [plyr|anyone, "vassalage_offer_confirm",
    [],
    "Tell him that I accept his terms...",
    "companion_rejoin_response",
    [
      (troop_get_slot, "$g_invite_faction", "$g_talk_troop", 153),
      (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", 11),
      (str_store_troop_name, s1, "$g_invite_faction_lord"),
      (setup_quest_text, "qst_join_faction"),
      (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
      (str_store_faction_name_link, s4, "$g_invite_faction"),
      (quest_set_slot, "qst_join_faction", 6, "$g_invite_faction_lord"),
      (quest_set_slot, "qst_join_faction", 23, 30),
      (try_begin),
        (store_relation, ":var0", "$g_invite_faction", "fac_player_supporters_faction"),
        (lt, ":var0", 0),
        (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_invite_faction", "fac_player_supporters_faction", 0),
        (quest_set_slot, "qst_join_faction", 26, 1),
      (try_end),
      (str_store_string, s2, "@Find and speak with {s3} of {s4} to give him your oath of homage."),
      (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
      (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
    ]],

  [plyr|anyone, "companion_rejoin_response",
    [
      (neg|main_party_has_troop, "$map_talk_troop"),
    ],
    "Welcome back, friend!",
    "close_window",
    [
      (party_force_add_members, "p_main_party", "$map_talk_troop", 1),
      (assign, "$npc_to_rejoin_party", 0),
      (troop_set_slot, "$map_talk_troop", 152, 0),
      (troop_set_slot, "$map_talk_troop", 151, 0),
    ]],

  [plyr|anyone, "companion_rejoin_response",
    [],
    "Unfortunately, I cannot take you back just yet.",
    "companion_rejoin_refused",
    [
      (troop_set_slot, "$map_talk_troop", 152, 8),
      (troop_set_slot, "$map_talk_troop", 151, 0),
      (assign, "$npc_to_rejoin_party", 0),
    ]],

  [anyone, "companion_rejoin_refused",
    [],
    "As you wish. I will take care of some business, and try again in a few days.",
    "close_window",
    []],

  [anyone, "event_triggered",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (neg|main_party_has_troop, "$g_talk_troop"),
    ],
    "Would you have me rejoin you?",
    "companion_rejoin_response",
    [
      (assign, "$map_talk_troop", "$g_talk_troop"),
    ]],

  [anyone, "event_triggered",
    [
      (eq, "$caravan_escort_state", 1),
      (eq, "$g_encountered_party", "$caravan_escort_party_id"),
      (le, "$talk_context", 2),
      (store_distance_to_party_from_party, reg0, "$caravan_escort_destination_town", "$caravan_escort_party_id"),
      (lt, reg0, 5),
      (str_store_party_name, s3, "$caravan_escort_destination_town"),
      (assign, reg3, "$caravan_escort_agreed_reward"),
    ],
    "There! I can see the walls of {s3} in the distance. We've made it safely. Here, take this purse of {reg3} denars, as I promised. I hope we can travel together again someday.",
    "close_window",
    [
      (assign, "$caravan_escort_state", 0),
      (call_script, "script_troop_add_gold", "trp_player", "$caravan_escort_agreed_reward"),
      (assign, reg4, "$caravan_escort_agreed_reward"),
      (val_mul, reg4, 1),
      (add_xp_as_reward, reg4),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "event_triggered",
    [],
    "{!}Sorry -- just talking to myself [ERROR- {s51}]",
    "close_window",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (store_current_hours, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 39),
      (val_sub, ":var0", ":var1"),
      (lt, ":var0", 720),
      (str_clear, s12),
      (try_begin),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 0),
        (str_store_string, s12, "@ We will of course need to wait until the realm is no longer on campaign."),
      (try_end),
    ],
    "My lady, I look forward to our marriage, as soon as there is an opportunity to hold a proper feast.{s12}",
    "lord_start",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 5),
      (party_slot_eq, "$g_talk_troop_party", 4, 7),
      (party_slot_eq, "$g_talk_troop_party", 5, ":var0"),
      (neq, ":var0", "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "My lady, if you wish to marry, we can proceed to the feast at {s4} to exchange vows before the lords of the realm.",
    "lord_start",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
      (store_current_hours, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 39),
      (val_sub, ":var0", ":var1"),
      (ge, ":var0", 720),
      (party_get_attached_to, ":var2", "$g_talk_troop_party"),
      (neg|is_between, ":var2", "p_town_1", "p_village_1"),
      (party_slot_eq, "$g_talk_troop_party", 4, 7),
      (party_get_slot, ":var3", "$g_talk_troop_party", 5),
      (str_store_party_name, s4, ":var3"),
    ],
    "My lady, I grow tired of waiting for the lords of this realm to assemble. Come with me to {s4} exchange our vows.",
    "lord_start",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
      (store_current_hours, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 39),
      (val_sub, ":var0", ":var1"),
      (ge, ":var0", 0),
      (party_get_attached_to, ":var2", "$g_talk_troop_party"),
      (neg|is_between, ":var2", "p_town_1", "p_village_1"),
    ],
    "My lady, I grow tired of waiting for the lords of this realm to assemble. Perhaps we should take the first opportunity to marry, in any great hall that is open to us.",
    "lord_start",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
      (neg|this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
    ],
    "My lady, I have grown tired of waiting. Let us proceed with the vows immediately.",
    "lord_groom_vows",
    []],

  [anyone, "start",
    [
      (lt, "$talk_context", 4),
      (check_quest_active, "qst_wed_betrothed_female"),
      (quest_slot_eq, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
    ],
    "My lady, my eyes rejoice to see you. We may proceed with the vows.",
    "lord_groom_vows",
    []],

  [anyone, "lord_groom_vows",
    [],
    "My lady, with this assembly as my witness, I vow to take you as my wife, to honor, cherish, and protect you. My the heavens bless us with health, prosperity, and children.",
    "female_pc_marriage_vow",
    []],

  [plyr|anyone, "female_pc_marriage_vow",
    [],
    "I vow to take you as my husband.",
    "lord_groom_wedding_complete",
    [
      (call_script, "script_courtship_event_bride_marry_groom", "trp_player", "$g_talk_troop", 0),
      (call_script, "script_end_quest", "qst_wed_betrothed_female"),
    ]],

  [plyr|anyone, "female_pc_marriage_vow",
    [],
    "Wait -- I need to think about this.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_groom_wedding_complete",
    [],
    "We are now husband and wife. Let the festivities commence!",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (check_quest_active, "qst_denounce_lord"),
      (check_quest_succeeded, "qst_denounce_lord"),
      (quest_slot_eq, "qst_denounce_lord", 2, "$g_talk_troop"),
    ],
    "Very well. You've made your point. I have nothing more to say.",
    "close_window",
    [
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (check_quest_active, "qst_denounce_lord"),
      (check_quest_failed, "qst_denounce_lord"),
      (quest_slot_eq, "qst_denounce_lord", 2, "$g_talk_troop"),
    ],
    "Well, {reg63?sir:my lady}! Please, do not trouble yourself to rise from the ground, as I would simply have to knock you down again. I shall take your silence as an apology. Good day to you.",
    "close_window",
    [
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (assign, "$temp", 0),
      (try_begin),
        (check_quest_active, "qst_duel_avenge_insult"),
        (check_quest_succeeded, "qst_duel_avenge_insult"),
        (quest_slot_eq, "qst_duel_avenge_insult", 2, "$g_talk_troop"),
        (assign, "$temp", 1),
      (else_try),
        (check_quest_active, "qst_duel_for_lady"),
        (check_quest_succeeded, "qst_duel_for_lady"),
        (quest_slot_eq, "qst_duel_for_lady", 2, "$g_talk_troop"),
        (assign, "$temp", 2),
      (try_end),
      (gt, "$temp", 0),
    ],
    "Very well. You've made your point. I retract what I said. I hope you have obtained satisfaction.",
    "close_window",
    [
      (try_begin),
        (eq, "$temp", 1),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (call_script, "script_end_quest", "qst_duel_avenge_insult"),
      (try_end),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (assign, "$temp", 0),
      (try_begin),
        (check_quest_active, "qst_duel_avenge_insult"),
        (check_quest_failed, "qst_duel_avenge_insult"),
        (quest_slot_eq, "qst_duel_avenge_insult", 2, "$g_talk_troop"),
        (assign, "$temp", 1),
      (else_try),
        (check_quest_active, "qst_duel_for_lady"),
        (check_quest_failed, "qst_duel_for_lady"),
        (quest_slot_eq, "qst_duel_for_lady", 2, "$g_talk_troop"),
        (assign, "$temp", 2),
      (try_end),
      (gt, "$temp", 0),
    ],
    "Hah! Not so gallant now, are we? Now trouble me no more.",
    "close_window",
    [
      (try_begin),
        (eq, "$temp", 1),
        (call_script, "script_change_troop_renown", "trp_player", -10),
        (call_script, "script_end_quest", "qst_duel_avenge_insult"),
      (try_end),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_succeeded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 6),
      (str_store_troop_name, s10, ":var0"),
    ],
    "Very well -- you have won. Let all those present today witness that you have defeated me, and I shall abandon my suit of {s10}. Are you satisfied, you heartless bastard?",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 6),
      (call_script, "script_courtship_event_lady_break_relation_with_suitor", ":var0", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 17),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_failed, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 6),
      (str_store_troop_name, s10, ":var0"),
    ],
    "Get up. Let all those present today witness that I have defeated you, and you are now bound to relinquish your suit of the {s10}. I will permit you one final visit, to make your farewells. After that, if you persist in attempting to see her, everyone shall know that you are a man of scant honor.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 7),
    ],
    "What do you want?",
    "player_siege_castle_commander_1",
    []],

  [plyr|anyone, "player_siege_castle_commander_1",
    [],
    "Surrender! Your situation is hopeless!",
    "player_siege_ask_surrender",
    []],

  [plyr|anyone, "player_siege_castle_commander_1",
    [],
    "Nothing. I'll leave you now.",
    "close_window",
    []],

  [anyone, "player_siege_ask_surrender",
    [
      (lt, "$g_enemy_strength", 2000),
      (store_mul, ":var0", "$g_enemy_strength", 5),
      (ge, "$g_ally_strength", ":var0"),
    ],
    "Perhaps... Do you give your word of honor that we'll be treated well?",
    "player_siege_ask_surrender_treatment",
    []],

  [anyone, "player_siege_ask_surrender",
    [
      (lt, "$g_enemy_strength", 4000),
      (store_mul, ":var0", "$g_enemy_strength", 3),
      (ge, "$g_ally_strength", ":var0"),
    ],
    "We are ready to leave this castle to you and march away if you give me your word of honor that you'll let us leave unmolested.",
    "player_siege_ask_leave_unmolested",
    []],

  [anyone, "player_siege_ask_surrender",
    [],
    "Surrender? Hah! We can hold these walls until we all die of old age.",
    "close_window",
    []],

  [plyr|anyone, "player_siege_ask_surrender_treatment",
    [],
    "I give you nothing. Surrender now or prepare to die!",
    "player_siege_ask_surrender_treatment_reject",
    []],

  [anyone, "player_siege_ask_surrender_treatment_reject",
    [],
    "Bastard. We will fight you to the last man!",
    "close_window",
    []],

  [plyr|anyone, "player_siege_ask_surrender_treatment",
    [],
    "You will be ransomed and your soldiers will live. I give you my word.",
    "player_siege_ask_surrender_treatment_accept",
    []],

  [anyone, "player_siege_ask_surrender_treatment_accept",
    [],
    "Very well then. Under those terms, I offer you my surrender.",
    "close_window",
    [
      (assign, "$g_enemy_surrenders", 1),
    ]],

  [plyr|anyone, "player_siege_ask_leave_unmolested",
    [],
    "You have my word. You will not come under attack if you leave the castle.",
    "player_siege_ask_leave_unmolested_accept",
    []],

  [anyone, "player_siege_ask_leave_unmolested_accept",
    [],
    "Very well. Then we leave this castle to you. You have won this day. But we'll meet again.",
    "close_window",
    [
      (assign, "$g_castle_left_to_player", 1),
    ]],

  [plyr|anyone, "player_siege_ask_leave_unmolested",
    [],
    "Unacceptable. I want prisoners.",
    "player_siege_ask_leave_unmolested_reject",
    []],

  [anyone, "player_siege_ask_leave_unmolested_reject",
    [],
    "Then we will defend this castle to the death, and this parley is done. Farewell.",
    "close_window",
    []],

  [plyr|anyone, "lord_prison_break",
    [],
    "I've come to get you out of here",
    "lord_prison_break_confirm",
    []],

  [plyr|anyone, "lord_prison_break",
    [],
    "Never mind -- just stay quiet",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 149, 1),
      (assign, "$g_reset_mission_participation", 1),
    ]],

  [anyone, "lord_prison_break_confirm",
    [],
    "Thank the heavens! I don't know how long I could have lasted in here",
    "lord_prison_break_confirm_2",
    []],

  [anyone, "lord_prison_break_confirm_2",
    [],
    "But wait -- how will we escape? We'll be rushed by the garrison the moment we step out that door. I can help you hold them off -- but I'll tell you now, they have fed me nothing but watery porridge and a few scraps, and I'm not as strong as I could be.",
    "lord_prison_break_confirm_3",
    []],

  [plyr|anyone, "lord_prison_break_confirm_3",
    [],
    "You keep well behind me, and try to stay out of the fighting.",
    "lord_prison_break_confirm_4",
    [
      (troop_set_slot, "$g_talk_troop", 149, 3),
      (assign, "$g_reset_mission_participation", 1),
      (agent_set_team, "$g_talk_agent", 0),
    ]],

  [plyr|anyone, "lord_prison_break_confirm_3",
    [],
    "I'll need you to grab a weapon and help me, despite your weakness.",
    "lord_prison_break_confirm_4",
    [
      (troop_set_slot, "$g_talk_troop", 149, 2),
      (assign, "$g_reset_mission_participation", 1),
      (agent_set_team, "$g_talk_agent", 0),
    ]],

  [plyr|anyone, "lord_prison_break_confirm_3",
    [],
    "Actually, don't get involved in this.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 149, 1),
      (assign, "$g_reset_mission_participation", 1),
    ]],

  [anyone, "lord_prison_break_confirm_4",
    [
      (str_clear, s14),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_heroes_end"),
        (troop_slot_eq, ":var0", 8, "$g_encountered_party"),
        (neq, ":var0", "$g_talk_troop"),
        (assign, ":var1", 0),
        (try_begin),
          (call_script, "script_cf_prisoner_offered_parole", ":var0"),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 0),
        (troop_slot_eq, ":var0", 149, 0),
        (str_store_troop_name, s15, ":var0"),
        (troop_get_type, reg4, ":var0"),
        (str_store_string, s14, "str__s15_is_also_being_held_here_and_you_may_wish_to_see_if_reg4shehe_will_join_us"),
      (try_end),
    ],
    "Let's go!{s14}",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 8),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "I am in your debt for freeing me, friend.",
    "freed_lord_answer",
    [
      (try_begin),
        (check_quest_active, "qst_rescue_lord_by_replace"),
        (quest_slot_eq, "qst_rescue_lord_by_replace", 2, "$g_talk_troop"),
        (call_script, "script_succeed_quest", "qst_rescue_lord_by_replace"),
        (assign, "$do_not_cancel_quest", 1),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_rescue_prisoner"),
        (quest_slot_eq, "qst_rescue_prisoner", 2, "$g_talk_troop"),
        (call_script, "script_succeed_quest", "qst_rescue_prisoner"),
        (assign, "$do_not_cancel_quest", 1),
      (try_end),
      (call_script, "script_remove_troop_from_prison", "$g_talk_troop"),
      (assign, "$do_not_cancel_quest", 0),
    ]],

  [plyr|anyone, "freed_lord_answer",
    [
      (lt, "$g_talk_troop_faction_relation", 0),
    ],
    "You're not going anywhere, 'friend'. You're my prisoner now.",
    "freed_lord_answer_1",
    [
      (troop_set_slot, "$g_talk_troop", 8, "p_main_party"),
      (party_force_add_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -30),
      (call_script, "script_change_player_relation_with_faction_ex", "$g_talk_troop_faction", -2),
      (call_script, "script_event_hero_taken_prisoner_by_player", "$g_talk_troop"),
    ]],

  [anyone, "freed_lord_answer_1",
    [],
    "I'll have your head on a pike for this, you bastard! Someday!",
    "close_window",
    []],

  [plyr|anyone, "freed_lord_answer",
    [],
    "You are free to go wherever you want.",
    "freed_lord_answer_2",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 5),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_faction_ex", "$g_talk_troop_faction", 2),
    ]],

  [anyone, "freed_lord_answer_2",
    [],
    "Thank you, good {reg63?sire:lady}. I never forget someone who's done me a good turn.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 9),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "{s43}{s23}",
    "defeat_lord_answer",
    [
      (troop_set_slot, "$g_talk_troop", 10, -1),
      (str_clear, s23),
      (try_begin),
        (eq, "$pop_kingdom", 1),
        (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
        (assign, ":var0", reg0),
        (assign, ":var1", 15),
        (266, ":var2"),
        (try_begin),
          (eq, ":var2", 0),
          (val_add, ":var1", 10),
        (else_try),
          (eq, ":var2", 1),
          (val_add, ":var1", 5),
        (try_end),
        (store_skill_level, ":var3", skl_persuasion, "trp_player"),
        (val_sub, ":var1", ":var3"),
        (try_begin),
          (this_or_next|is_between, "$g_talk_troop", "trp_knight_1_1", "trp_knight_1_4"),
          (this_or_next|is_between, "$g_talk_troop", "trp_knight_2_1", "trp_knight_2_4"),
          (this_or_next|is_between, "$g_talk_troop", "trp_knight_3_1", "trp_knight_3_4"),
          (this_or_next|is_between, "$g_talk_troop", "trp_knight_4_1", "trp_knight_4_4"),
          (is_between, "$g_talk_troop", "trp_knight_5_1", "trp_knight_5_4"),
          (val_add, ":var1", 10),
        (try_end),
        (store_troop_faction, ":var4", "$g_talk_troop"),
        (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
          (store_faction_of_party, ":var6", ":var5"),
          (eq, ":var6", ":var4"),
          (try_begin),
            (party_slot_eq, ":var5", 0, 2),
            (val_add, ":var1", 1),
          (else_try),
            (party_slot_eq, ":var5", 0, 3),
            (val_add, ":var1", 2),
          (try_end),
        (try_end),
        (try_begin),
          (assign, ":var7", 0),
          (assign, ":var8", 0),
          (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
            (store_faction_of_party, ":var6", ":var5"),
            (eq, ":var6", "fac_player_supporters_faction"),
            (try_begin),
              (party_slot_eq, ":var5", 0, 2),
              (val_add, ":var7", 1),
            (else_try),
              (party_slot_eq, ":var5", 0, 3),
              (val_add, ":var8", 1),
            (try_end),
          (try_end),
          (val_clamp, ":var7", 0, 6),
          (val_clamp, ":var8", 0, 4),
          (val_mul, ":var8", 2),
          (val_sub, ":var1", ":var7"),
          (val_sub, ":var1", ":var8"),
        (try_end),
        (store_sub, ":var9", ":var1", ":var0"),
        (try_begin),
          (le, ":var9", 0),
          (str_store_string, s23, "@^^(The defeated lord genuinely admires both you and your kingdom)"),
        (else_try),
          (le, ":var9", 8),
          (str_store_string, s23, "@^^(You have a feeling that the defeated lord almost likes your kingdom)"),
        (else_try),
          (le, ":var9", 15),
          (str_store_string, s23, "@^^(The defeated lord eyes you cautiously)"),
        (else_try),
          (str_store_string, s23, "@^^(The defeated lord looks at you hatefully)"),
        (try_end),
      (try_end),
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_surrender_offer_default"),
    ]],

  [plyr|anyone, "defeat_lord_answer",
    [],
    "You are my prisoner now.",
    "defeat_lord_answer_1",
    [
      (troop_set_slot, "$g_talk_troop", 8, "p_main_party"),
      (party_force_add_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
      (call_script, "script_change_player_relation_with_faction_ex", "$g_talk_troop_faction", -3),
      (call_script, "script_event_hero_taken_prisoner_by_player", "$g_talk_troop"),
      (call_script, "script_add_log_entry", 12, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
    ]],

  [anyone, "defeat_lord_answer_1",
    [],
    "I am at your mercy.",
    "close_window",
    []],

  [plyr|anyone, "defeat_lord_answer",
    [],
    "You have fought well. You are free to go.",
    "defeat_lord_answer_2",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_add_log_entry", 13, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
    ]],

  [anyone, "defeat_lord_answer_2",
    [],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_prisoner_released_default"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (lt, "$g_encountered_party_relation", 0),
      (encountered_party_is_attacker),
      (eq, "$g_talk_troop_met", 1),
    ],
    "{playername}!",
    "party_encounter_lord_hostile_attacker",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (lt, "$g_encountered_party_relation", 0),
      (encountered_party_is_attacker),
    ],
    "Halt!",
    "party_encounter_lord_hostile_attacker",
    []],

  [anyone, "party_encounter_lord_hostile_attacker",
    [
      (gt, "$g_comment_found", 0),
    ],
    "{s42}",
    "party_encounter_lord_hostile_attacker",
    [
      (try_begin),
        (neq, "$log_comment_relation_change", 0),
        (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", "$log_comment_relation_change"),
      (try_end),
      (assign, "$g_comment_found", 0),
    ]],

  [anyone, "party_encounter_lord_hostile_attacker",
    [],
    "{s43}",
    "party_encounter_lord_hostile_attacker_2",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_surrender_demand_default"),
    ]],

  [plyr|anyone, "party_encounter_lord_hostile_attacker_2",
    [],
    "We will fight you to the end!",
    "close_window",
    []],

  [plyr|anyone, "party_encounter_lord_hostile_attacker_2",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Stay your hand! There is something I must tell you in private.",
    "lord_recruit_1_relation",
    []],

  [plyr|anyone, "party_encounter_lord_hostile_attacker_2",
    [],
    "Is there no way to avoid this battle? I don't want to fight with you.",
    "party_encounter_offer_dont_fight",
    []],

  [plyr|anyone, "party_encounter_lord_hostile_attacker_2",
    [],
    "Don't attack! We surrender.",
    "close_window",
    [
      (assign, "$g_player_surrenders", 1),
    ]],

  [anyone, "party_encounter_offer_dont_fight",
    [
      (gt, "$g_talk_troop_effective_relation", 30),
    ],
    "I owe you a favor, don't I. Well... all right then. I will let you go just this once.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -7),
      (store_current_hours, ":var0"),
      (val_add, ":var0", 72),
      (party_set_slot, "$g_encountered_party", 3, ":var0"),
      (party_ignore_player, "$g_encountered_party", 72),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "party_encounter_offer_dont_fight",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_declines_negotiation_offer_default"),
    ],
    "{s43}",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, "$g_talk_troop", 2, 0),
      (neq, "$g_talk_troop", "$g_player_minister"),
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s10, ":var1"),
      (str_store_string, s9, "str_lord_indicted_dialog_approach"),
    ],
    "{s9}",
    "lord_requests_recruitment",
    []],

  [plyr|anyone, "lord_requests_recruitment",
    [
      (str_store_string, s9, "str_lord_indicted_dialog_approach_yes"),
    ],
    "{s9}",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 2, 2),
    ]],

  [plyr|anyone, "lord_requests_recruitment",
    [
      (str_store_string, s9, "str_lord_indicted_dialog_approach_no"),
    ],
    "{s9}",
    "lord_requests_recruitment_refuse",
    []],

  [anyone, "lord_requests_recruitment_refuse",
    [
      (str_store_string, s9, "str_lord_indicted_dialog_rejected"),
    ],
    "{s9}",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -10),
      (call_script, "script_lord_find_alternative_faction", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (try_begin),
        (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (troop_get_slot, ":var1", "$g_talk_troop", 14),
        (str_store_troop_name, s1, "$g_talk_troop"),
        (str_store_faction_name, s2, ":var0"),
        (str_store_faction_name, s3, ":var1"),
        (call_script, "script_change_troop_faction", "$g_talk_troop", ":var0"),
        (troop_get_type, reg4, "$g_talk_troop"),
        (display_message, "str_lord_defects_ordinary", 0xFF5050),
      (else_try),
        (call_script, "script_change_troop_faction", "$g_talk_troop", "fac_outlaws"),
      (try_end),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (eq, "$g_talk_troop", "$supported_pretender"),
    ],
    "I await your counsel, {playername}.",
    "supported_pretender_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
      (assign, "$pretender_told_story", 0),
      (eq, "$g_talk_troop_met", 0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Do I know you?",
    "pretender_intro_1",
    []],

  [plyr|anyone, "pretender_intro_1",
    [],
    "My name is {playername}. At your service.",
    "pretender_intro_2",
    []],

  [plyr|anyone, "pretender_intro_1",
    [],
    "I am {playername}. Perhaps you have heard of my exploits.",
    "pretender_intro_2",
    []],

  [anyone, "pretender_intro_2",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (val_sub, ":var0", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_pretender_intro"),
      (str_store_string, s48, ":var0"),
    ],
    "{s48}",
    "pretender_intro_3",
    []],

  [plyr|anyone, "pretender_intro_3",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (str_store_faction_name, s12, ":var0"),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s11, ":var1"),
    ],
    "I thought {s12} was ruled by {s11}?",
    "pretender_rebellion_cause_1",
    [
      (troop_set_slot, "$g_talk_troop", 78, 1),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "Greetings, {playername}",
    "pretender_start",
    [
      (assign, "$pretender_told_story", 0),
    ]],

  [plyr|anyone, "pretender_start",
    [
      (troop_slot_eq, "$g_talk_troop", 78, 1),
      (eq, "$pretender_told_story", 0),
    ],
    "What was your story again, {reg65?my lady:sir}?",
    "pretender_rebellion_cause_prelim",
    []],

  [anyone, "pretender_rebellion_cause_prelim",
    [],
    "I shall tell you.",
    "pretender_rebellion_cause_1",
    []],

  [anyone, "pretender_rebellion_cause_1",
    [],
    "{s48}",
    "pretender_rebellion_cause_2",
    [
      (assign, "$pretender_told_story", 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (val_sub, ":var0", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_pretender_story_1"),
      (str_store_string, s48, ":var0"),
    ]],

  [anyone, "pretender_rebellion_cause_2",
    [],
    "{s48}",
    "pretender_rebellion_cause_3",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (val_sub, ":var0", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_pretender_story_2"),
      (str_store_string, s48, ":var0"),
    ]],

  [anyone, "pretender_rebellion_cause_3",
    [],
    "{s48}",
    "pretender_start",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (val_sub, ":var0", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_pretender_story_3"),
      (str_store_string, s48, ":var0"),
    ]],

  [plyr|anyone, "pretender_start",
    [
      (troop_slot_eq, "$g_talk_troop", 78, 1),
    ],
    "I want to take up your cause and help you reclaim your throne!",
    "pretender_discuss_rebellion_1",
    []],

  [plyr|anyone, "pretender_start",
    [],
    "I must leave now.",
    "pretender_end",
    []],

  [anyone, "pretender_discuss_rebellion_1",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s11, ":var1"),
    ],
    "Are you sure you will be up to the task, {playername}? Reclaiming my throne will be no simple matter. The lords of our realm have all sworn oaths of homage to {s11}. Such oaths to a usurper are of course invalid, and we can expect some of the lords to side with us, but it will be a very tough and challenging struggle ahead.",
    "pretender_discuss_rebellion_2a",
    []],

  [anyone, "pretender_discuss_rebellion_2a",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s12, ":var1"),
      (call_script, "script_evaluate_realm_stability", ":var0"),
      (assign, ":var2", reg0),
      (val_add, ":var2", reg0),
      (val_add, ":var2", reg1),
      (try_begin),
        (gt, ":var2", 60),
        (str_store_string, s11, "str_one_thing_in_our_favor_is_that_s12s_grip_is_very_shaky_he_rules_over_a_labyrinth_of_rivalries_and_grudges_lords_often_fail_to_cooperate_and_many_would_happily_seek_a_better_liege"),
      (else_try),
        (is_between, ":var2", 40, 60),
        (str_store_string, s11, "str_thankfully_s12s_grip_is_fairly_shaky_many_lords_do_not_cooperate_with_each_other_and_some_might_be_tempted_to_seek_a_better_liege"),
      (else_try),
        (is_between, ":var2", 20, 40),
        (str_store_string, s11, "str_unfortunately_s12s_grip_is_fairly_strong_until_we_can_shake_it_we_may_have_to_look_long_and_hard_for_allies"),
      (else_try),
        (lt, ":var2", 20),
        (str_store_string, s11, "str_unfortunately_s12s_grip_is_very_strong_unless_we_can_loosen_it_it_may_be_difficult_to_find_allies"),
      (try_end),
    ],
    "{s11}",
    "pretender_discuss_rebellion_2",
    []],

  [plyr|anyone, "pretender_discuss_rebellion_2",
    [],
    "I am ready for this struggle.",
    "pretender_discuss_rebellion_3",
    []],

  [plyr|anyone, "pretender_discuss_rebellion_2",
    [],
    "You are right. Perhaps, I should think about this some more.",
    "pretender_end",
    []],

  [anyone, "pretender_discuss_rebellion_3",
    [
      (neg|this_or_next|faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (neg|faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (neg|troop_slot_ge, "trp_player", 7, 200),
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s11, ":var1"),
    ],
    "I have no doubt that your support for my cause is heartfelt, {playername}, and I am grateful to you for it. But I don't think we have much of a chance of success. If you can gain renown in the battlefield and make a name for yourself as a great commander, then our friends would not hesitate to join our cause, and our enemies would be wary to take up arms against us. When that time comes, I will come with you gladly. But until that time, it will be wiser not to openly challange the usurper, {s11}.",
    "close_window",
    []],

  [anyone, "pretender_discuss_rebellion_3",
    [
      (neg|this_or_next|faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (neg|faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (gt, "$supported_pretender", 0),
      (str_store_troop_name, s17, "$supported_pretender"),
    ],
    "Haven't you already taken up the cause of {s17}? You must have a very strong sense of justice, indeed. But no, thank you. I will not be part of your game.",
    "close_window",
    []],

  [anyone, "pretender_discuss_rebellion_3",
    [
      (neg|this_or_next|faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (neg|faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (gt, "$players_kingdom", 0),
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
      (neq, "$players_kingdom", "fac_player_faction"),
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (neq, "$players_kingdom", ":var0"),
      (eq, "$player_has_homage", 1),
      (str_store_faction_name, s16, "$players_kingdom"),
      (faction_get_slot, ":var1", "$players_kingdom", 11),
      (str_store_troop_name, s15, ":var1"),
      (str_store_faction_name, s17, ":var0"),
    ],
    "{playername}, you are already oath-bound to serve {s15}. As such, I cannot allow you to take up my cause, and let my enemies claim that I am but a mere puppet of {s16}. No, if I am to have the throne of {s17}, I must do it due to the righteousness of my cause and the support of my subjects alone. If you want to help me, you must first free yourself of your oath to {s15}.",
    "close_window",
    []],

  [anyone, "pretender_discuss_rebellion_3",
    [
      (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
    ],
    "You are a monarch in your own right, {reg63?sir:my lady}. If you were to back me, I would be merely your puppet.",
    "close_window",
    []],

  [anyone, "pretender_discuss_rebellion_3",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 14),
      (str_store_faction_name, s12, ":var0"),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s11, ":var1"),
    ],
    "You are a capable warrior, {playername}, and I am sure with your renown as a commander, and my righteous cause, the nobles and the good people of {s12} will flock to our support. The time is ripe for us to act! I will come with you, and together, we will topple the usurper {s11} and take the throne from his bloodied hands. But first, you must give me your oath of homage and accept me as your liege {reg65?lady:lord}.",
    "pretender_rebellion_ready",
    []],

  [plyr|anyone, "pretender_rebellion_ready",
    [
      (troop_get_type, reg3, "$g_talk_troop"),
    ],
    "I am ready to pledge myself to your cause, {reg3?my lady:sir}.",
    "lord_give_oath_2",
    []],

  [plyr|anyone, "pretender_rebellion_ready",
    [],
    "Let us bide our time a little longer.",
    "pretender_end",
    []],

  [anyone, "lord_give_conclude_2",
    [
      (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "Forward, then! Our first task is to take hold of a fortress and persuade other lords to join us. You lead the way!",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 50),
      (faction_set_slot, "$g_talk_troop_faction", 21, 0),
      (party_force_add_members, "p_main_party", "$supported_pretender", 1),
      (troop_set_slot, "$supported_pretender", 12, 0),
      (troop_set_auto_equip, "$supported_pretender", 1),
      (str_store_troop_name_link, s6, "$supported_pretender"),
      (display_message, "@{s6} has joined your party.", 0xFFFF00),
      (store_relation, ":var0", "$supported_pretender_old_faction", "fac_player_supporters_faction"),
      (val_min, ":var0", -50),
      (call_script, "script_set_player_relation_with_faction", "$supported_pretender_old_faction", ":var0"),
      (faction_get_slot, ":var1", "$supported_pretender_old_faction", 22),
      (str_store_string, s1, ":var1"),
      (faction_set_name, "fac_player_supporters_faction", "@{s1} Rebels"),
      (faction_set_color, "fac_player_supporters_faction", 3200456),
      (call_script, "script_update_all_notes"),
    ]],

  [anyone, "pretender_end",
    [],
    "Farewell for now, then.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (neq, "$g_talk_troop_met", 0),
      (gt, "$g_time_since_last_talk", 24),
      (gt, "$g_talk_troop_relation", -10),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 30),
      (eq, "$talk_context", 0),
      (call_script, "script_cf_troop_get_random_enemy_troop_with_occupation", "$g_talk_troop", 2),
      (assign, ":var1", reg0),
      (troop_get_slot, ":var2", ":var1", 22),
      (ge, ":var2", 20),
      (str_store_troop_name, s6, ":var1"),
      (assign, "$temp", ":var1"),
    ],
    "I heard that you have befriended that {s43} called {s6}. Believe me, you can't trust that man. You should end your dealings with him.",
    "lord_event_choose_friend",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_insult_default"),
    ]],

  [plyr|anyone, "lord_event_choose_friend",
    [],
    "I assure you, {s65}, I am no friend of {s6}.",
    "lord_event_choose_friend_renounce",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 5),
      (call_script, "script_change_player_relation_with_troop", "$temp", -10),
    ]],

  [anyone, "lord_event_choose_friend_renounce",
    [],
    "Glad news, {playername}. I would fear for your safety otherwise. If you do encounter {s6}, be on your guard and don't believe a word.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_event_choose_friend",
    [],
    "{s6} is an honorable man, you've no right to speak of him thus.",
    "lord_event_choose_friend_defend",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -10),
      (call_script, "script_change_player_relation_with_troop", "$temp", 5),
    ]],

  [anyone, "lord_event_choose_friend_defend",
    [],
    "As you like, {playername}. A fool you might be, but a loyal fool at the least. {s6}'s loyalty may not be so steadfast, however...",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_event_choose_friend",
    [],
    "I don't want to be involved in your quarrel with {s6}.",
    "lord_event_choose_friend_neutral",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -2),
      (call_script, "script_change_player_relation_with_troop", "$temp", -3),
    ]],

  [anyone, "lord_event_choose_friend_neutral",
    [],
    "Hmph. As you wish, {playername}. Just remember that a {reg63?man:woman} needs friends in this world, and you'll never make any if you never stand with anyone.",
    "lord_pretalk",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "Yes, my wife?",
    "lord_start",
    []],

  [anyone, "start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (le, "$talk_context", 4),
    ],
    "Yes, {reg63?sire:my lady}?",
    "lord_start",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (le, "$talk_context", 4),
    ],
    "It is good to see you, old friend",
    "lord_start",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (check_quest_active, "qst_join_faction"),
      (eq, "$g_invite_faction_lord", "$g_talk_troop"),
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
    ],
    "Well, {playername}. I am willing to forgive your impudence in proclaiming yourself {reg63?king:queen}, and will welcome you into my realm with full honor, as one of my vassals. Shall we proceed to the oath of allegiance?",
    "lord_invite_player_monarch_1",
    []],

  [plyr|anyone, "lord_invite_player_monarch_1",
    [],
    "Yes... my lord.",
    "lord_invite_2",
    []],

  [plyr|anyone, "lord_invite_player_monarch_1",
    [],
    "No. That oath sticks in my throat.",
    "lord_enter_service_reject",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (check_quest_active, "qst_join_faction"),
      (eq, "$g_invite_faction_lord", "$g_talk_troop"),
      (try_begin),
        (gt, "$g_invite_offered_center", 0),
        (store_faction_of_party, ":var0", "$g_invite_offered_center"),
        (neq, ":var0", "$g_talk_troop_faction"),
        (call_script, "script_get_poorest_village_of_faction", "$g_talk_troop_faction"),
        (assign, "$g_invite_offered_center", reg0),
      (try_end),
    ],
    "{playername}, I've been expecting you. Word has reached my ears of your exploits. Why, I keep hearing such tales of prowess and bravery that my mind was quickly made up. I knew that I had found someone worthy of becoming my vassal.",
    "lord_invite_1",
    []],

  [plyr|anyone, "lord_invite_1",
    [],
    "Thank you, {s65}, you honor me with your offer.",
    "lord_invite_2",
    []],

  [plyr|anyone, "lord_invite_1",
    [],
    "It is good to have my true value recognised.",
    "lord_invite_2",
    []],

  [anyone, "lord_invite_2",
    [],
    "Aye. Let us dispense with the formalities, {playername}; are you ready to swear homage to me?",
    "lord_invite_3",
    []],

  [plyr|anyone, "lord_invite_3",
    [],
    "Yes, {s65}.",
    "lord_give_oath_2",
    []],

  [plyr|anyone, "lord_invite_3",
    [],
    "No, {s65}. I cannot serve you right now.",
    "lord_enter_service_reject",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (gt, "$g_talk_troop_relation", 10),
      (gt, "$g_time_since_last_talk", 3),
      (troop_get_type, ":var0", "trp_player"),
      (gt, ":var0", 0),
      (troop_slot_eq, "trp_player", 30, -1),
      (troop_slot_eq, "trp_player", 34, -1),
      (troop_slot_eq, "$g_talk_troop", 30, -1),
      (troop_slot_eq, "$g_talk_troop", 34, -1),
      (call_script, "script_npc_decision_checklist_marry_female_pc", "$g_talk_troop"),
      (ge, reg0, 1),
    ],
    "My lady, I have been giving much thought to our recent conversation. It is time for me to ask. Would you do me the honor of becoming my wife?",
    "lord_female_pc_marriage_proposal",
    []],

  [plyr|anyone, "lord_female_pc_marriage_proposal",
    [],
    "Yes. I would.",
    "lord_marriage_proposal_female_pc_next_step",
    []],

  [plyr|anyone, "lord_female_pc_marriage_proposal",
    [],
    "Let me think about this some more.",
    "lord_female_pc_marriage_proposal_postponed",
    []],

  [plyr|anyone, "lord_female_pc_marriage_proposal",
    [],
    "No. I have decided that it would not be appropriate",
    "lord_female_pc_marriage_proposal_rejected",
    []],

  [anyone, "lord_female_pc_marriage_proposal_postponed",
    [],
    "Of course, my lady. Take all the time you need.",
    "lord_start",
    []],

  [anyone, "lord_female_pc_marriage_proposal_rejected",
    [],
    "Do you mean to reject my suit outright, my lady?",
    "lord_female_pc_marriage_proposal_rejected_confirm",
    []],

  [plyr|anyone, "lord_female_pc_marriage_proposal_rejected_confirm",
    [],
    "Yes. I do.",
    "lord_female_pc_marriage_proposal_rejected_confirm_yes",
    []],

  [plyr|anyone, "lord_female_pc_marriage_proposal_rejected_confirm",
    [],
    "No, you misunderstand. I just need some more time to think",
    "lord_female_pc_marriage_proposal_postponed",
    []],

  [anyone, "lord_female_pc_marriage_proposal_rejected_confirm_yes",
    [
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 3),
      (troop_slot_eq, "$g_talk_troop", 52, 2),
    ],
    "Well, in that case, let me tell you something -- with those harsh words, you have removed the scales from my eyes. I would agree that it would not be appropriate for me to marry one such as you. Good day, my lady.",
    "close_window",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -20),
      (troop_set_slot, "$g_talk_troop", 5, 4),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_female_pc_marriage_proposal_rejected_confirm_yes",
    [],
    "Such is your right, my lady. If you ever wished to reconsider, I would be overwhelmed with joy.",
    "close_window",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -5),
      (troop_set_slot, "$g_talk_troop", 5, 4),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (gt, "$g_time_since_last_talk", 24),
      (gt, "$g_talk_troop_relation", 0),
      (troop_get_type, ":var0", "trp_player"),
      (gt, ":var0", 0),
      (troop_slot_eq, "trp_player", 30, -1),
      (troop_slot_eq, "trp_player", 34, -1),
      (troop_slot_eq, "$g_talk_troop", 30, -1),
      (troop_slot_eq, "$g_talk_troop", 34, -1),
    ],
    "My lady, it brings my heart great joy to see you again...",
    "lord_start",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 2),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (gt, "$g_talk_troop_relation", 0),
      (troop_get_type, ":var0", "trp_player"),
      (gt, ":var0", 0),
    ],
    "My lady, I am always your humble servant",
    "lord_start",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (neq, "$g_talk_troop_met", 0),
      (gt, "$g_time_since_last_talk", 24),
      (gt, "$g_talk_troop_relation", 50),
      (gt, "$g_talk_troop_faction_relation", 10),
      (le, "$talk_context", 4),
    ],
    "If it isn't my brave champion, {playername}...",
    "lord_prestart_comment",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (neq, "$g_talk_troop_met", 0),
      (gt, "$g_time_since_last_talk", 24),
      (gt, "$g_talk_troop_relation", 10),
      (le, "$talk_context", 4),
    ],
    "Good to see you again {playername}...",
    "lord_prestart_comment",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (neq, "$g_talk_troop_met", 0),
      (gt, "$g_time_since_last_talk", 24),
      (lt, "$g_talk_troop_relation", 0),
      (le, "$talk_context", 4),
    ],
    "Be brief, {playername}...",
    "companion_comment_negative",
    []],

  [anyone|other(trp_npc_ansen), "companion_comment_negative",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_ansen"),
      (neg|troop_is_wounded, "trp_npc_ansen"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 15),
    ],
    "{s4}",
    "lord_prestart_comment",
    [
      (str_store_string, s4, "str_npc_ansen_to_lord_f"),
      (play_sound, "snd_ansen_to_lord_f"),
    ]],

  [anyone|other(trp_npc_lethaldiran), "companion_comment_negative",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_lethaldiran"),
      (neg|troop_is_wounded, "trp_npc_lethaldiran"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 20),
    ],
    "{s4}",
    "lord_prestart_comment",
    [
      (str_store_string, s4, "str_npc_lethaldiran_to_lord_f"),
      (play_sound, "snd_lethaldiran_to_lord_f"),
    ]],

  [anyone|other(trp_npc_ediz), "companion_comment_negative",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_ediz"),
      (neg|troop_is_wounded, "trp_npc_ediz"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 25),
    ],
    "{s4}",
    "lord_prestart_comment",
    [
      (str_store_string, s4, "str_npc_ediz_to_lord_f"),
      (play_sound, "snd_ediz_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_negative",
    [],
    "This should not show",
    "lord_prestart_comment",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (neq, "$g_talk_troop_met", 0),
      (gt, "$g_time_since_last_talk", 24),
      (le, "$talk_context", 4),
    ],
    "We meet again, {playername}...",
    "lord_prestart_comment",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (eq, "$g_talk_troop_met", 0),
      (ge, "$g_talk_troop_faction_relation", 0),
      (le, "$talk_context", 4),
    ],
    "Do I know you?",
    "lord_meet_neutral",
    []],

  [plyr|anyone, "lord_meet_neutral",
    [],
    "I am {playername}.",
    "lord_intro",
    []],

  [plyr|anyone, "lord_meet_neutral",
    [],
    "My name is {playername}. At your service sir.",
    "lord_intro",
    []],

  [anyone, "lord_intro",
    [],
    "{s11}",
    "lord_prestart_comment",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_faction_name, s6, "$g_talk_troop_faction"),
      (assign, reg4, 0),
      (str_store_troop_name, s4, "$g_talk_troop"),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (str_store_string, s9, "@I am {s4}, the ruler of {s6}", 0),
      (else_try),
        (str_store_string, s9, "@I am {s4}, a vassal of {s6}", 0),
      (try_end),
      (assign, ":var1", 0),
      (str_clear, s8),
      (try_for_range_backwards, ":var2", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var2", 7, "$g_talk_troop"),
        (try_begin),
          (eq, ":var1", 0),
          (str_store_party_name, s8, ":var2"),
        (else_try),
          (eq, ":var1", 1),
          (str_store_party_name, s7, ":var2"),
          (str_store_string, s8, "@{s7} and {s8}"),
        (else_try),
          (str_store_party_name, s7, ":var2"),
          (str_store_string, s8, "@{!}{s7}, {s8}"),
        (try_end),
        (val_add, ":var1", 1),
      (try_end),
      (assign, reg5, ":var1"),
      (str_store_string, s11, "@{s9}{reg5? and the lord of {s8}.:.", 0),
    ]],

  [anyone, "lord_prestart_comment",
    [
      (this_or_next|eq, "$talk_context", 2),
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop_faction", "fac_kingdom_1", "fac_kingdoms_end"),
      (troop_get_slot, ":var0", "$g_talk_troop", 52),
      (neq, ":var0", 0),
      (store_random_in_range, ":var1", 0, 100),
      (lt, ":var1", 20),
    ],
    "{s41}",
    "lord_start",
    [
      (assign, ":var0", 0),
      (try_begin),
        (eq, "$g_talk_troop_faction", "fac_kingdom_1"),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop_faction", "fac_kingdom_2"),
        (assign, ":var0", 4),
      (else_try),
        (eq, "$g_talk_troop_faction", "fac_kingdom_3"),
        (assign, ":var0", 3),
      (else_try),
        (eq, "$g_talk_troop_faction", "fac_kingdom_4"),
        (assign, ":var0", 0),
      (else_try),
        (assign, ":var0", 2),
      (try_end),
      (troop_get_slot, ":var1", "$g_talk_troop", 52),
      (assign, ":var2", 0),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", 2),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", 5),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", 4),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 0),
      (else_try),
        (eq, ":var1", 5),
        (assign, ":var2", 3),
      (else_try),
        (eq, ":var1", 6),
        (assign, ":var2", 6),
      (else_try),
        (eq, ":var1", 7),
        (assign, ":var2", 1),
      (try_end),
      (assign, ":var3", 0),
      (try_begin),
        (eq, "$talk_context", 2),
        (assign, ":var3", 1),
      (try_end),
      (assign, ":var4", 0),
      (assign, ":var5", 0),
      (store_mul, ":var4", ":var2", 10),
      (val_add, ":var4", ":var0"),
      (val_add, ":var4", ":var0"),
      (val_add, ":var4", ":var3"),
      (store_add, ":var5", ":var4", "snd_lord_fierds_cunning_hall"),
      (val_add, ":var4", "str_comment_cunning_fierds_hall"),
      (str_store_string, s41, ":var4"),
      (play_sound, ":var5"),
    ]],

  [auto_proceed|anyone, "lord_prestart_comment",
    [],
    "This should also never appear on screen.",
    "lord_start",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (eq, "$g_talk_troop_met", 0),
      (lt, "$g_talk_troop_faction_relation", 0),
      (le, "$talk_context", 4),
    ],
    "{s43}",
    "lord_meet_enemy",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_enemy_meet_default"),
    ]],

  [plyr|anyone, "lord_meet_enemy",
    [],
    "I am {playername}, {s65}.",
    "lord_intro",
    []],

  [plyr|anyone, "lord_meet_enemy",
    [],
    "They know me as {playername}. Mark it down, you shall be hearing of me a lot.",
    "lord_intro",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (le, "$talk_context", 4),
      (try_begin),
        (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (lt, "$g_talk_troop_relation", -15),
        (str_store_string, s8, "str_playername_come_to_plague_me_some_more_have_you"),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (str_store_string, s8, "str_ah_it_is_you_again"),
      (else_try),
        (str_store_string, s8, "str_well_playername"),
      (try_end),
    ],
    "{s8}",
    "lord_prestart_comment",
    []],

  [anyone, "lord_start",
    [
      (gt, "$g_comment_found", 0),
      (str_store_string, s1, "$g_last_comment_copied_to_s42"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "str_comment_found_s1"),
      (try_end),
    ],
    "{s42}",
    "lord_start",
    [
      (try_begin),
        (neq, "$log_comment_relation_change", 0),
        (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", "$log_comment_relation_change"),
      (try_end),
      (assign, "$g_comment_has_rejoinder", 0),
      (try_begin),
        (gt, "$g_rejoinder_to_last_comment", 0),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_rejoinder_noted"),
        (try_end),
        (assign, "$g_comment_has_rejoinder", 1),
      (try_end),
      (assign, "$g_comment_found", 0),
    ]],

  [auto_proceed|anyone, "lord_start",
    [
      (check_quest_active, "qst_destroy_bandit_lair"),
      (check_quest_succeeded, "qst_destroy_bandit_lair"),
      (quest_slot_eq, "qst_destroy_bandit_lair", 6, "$g_talk_troop"),
    ],
    "{!}.",
    "lair_quest_intermediate_1",
    []],

  [anyone, "lair_quest_intermediate_1",
    [],
    "Splendid work, {playername} - your audacious attack is the talk of the realm. No doubt they, or others like them, will soon be back, but for a short while you have bought this land a small respite. We are most grateful to you.",
    "lord_pretalk",
    [
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 22),
      (call_script, "script_troop_add_gold", "trp_player", ":var0"),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 4),
      (call_script, "script_finish_quest_simple", "qst_destroy_bandit_lair", 100),
      (assign, reg5, ":var0"),
    ]],

  [auto_proceed|anyone, "lord_start",
    [
      (check_quest_active, "qst_destroy_bandit_lair"),
      (check_quest_failed, "qst_destroy_bandit_lair"),
      (quest_slot_eq, "qst_destroy_bandit_lair", 6, "$g_talk_troop"),
    ],
    "{!}.",
    "lair_quest_intermediate_2",
    []],

  [anyone, "lair_quest_intermediate_2",
    [],
    "Well, {playername}, I guess that at least some of those brigands eluded you - and of course, it will be the peaceful travelers of this land who will pay the price. Still, it was good of you to try.",
    "lord_pretalk",
    [
      (call_script, "script_finish_quest_simple", "qst_destroy_bandit_lair", 25),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_lend_surgeon"),
      (quest_slot_eq, "qst_lend_surgeon", 6, "$g_talk_troop"),
    ],
    "Your surgeon managed to convince my friend and made the operation. The matter is in God's hands now, and all we can do is pray for his recovery. Anyway, I thank you for lending your surgeon to me {reg63?sir:madam}. You have a noble spirit. I will not forget it.",
    "lord_generic_mission_completed",
    [
      (call_script, "script_finish_quest", "qst_lend_surgeon", 100),
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 11),
      (is_between, ":var0", 0, 4),
    ],
    "Why have you come, when I am consumed with grief and have no wish for company?",
    "ghostlord_start_response",
    []],

  [plyr|anyone, "ghostlord_start_response",
    [],
    "Apologies, I did not mean to trouble you in your grief, my Lord.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "ghostlord_start_response",
    [
      (this_or_next|quest_slot_eq, "qst_ghost_lady", 11, 2),
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "I came to offer you my condolences, but I also seek your Lady's murderer, my Lord.",
    "ghostlord_backstory_intro",
    []],

  [anyone, "ghostlord_backstory_intro",
    [],
    "I am deep in mourning for my lady wife; she died unexpectedly just recently, and I have no wish to speak to you or anyone else in my grief. Leave me to mourn, I order you.",
    "ghostlord_backstory_response",
    []],

  [plyr|anyone, "ghostlord_backstory_response",
    [],
    "She did not die of a malady, she was murdered by poison.",
    "ghostlord_backstory_a",
    []],

  [anyone, "ghostlord_backstory_a",
    [],
    "Why say you that? She awoke in the night clutching her stomach in pain, and expired in my arms in terrible agony. I saw no sign of foul play in her death. She must have eaten bad food or been taken with an evil malady to die so suddenly. Who has told you she was murdered? I demand to know the name of your informant!",
    "ghostlord_backstory_a_response",
    []],

  [plyr|anyone, "ghostlord_backstory_a_response",
    [],
    "She told me so herself, and her ghost stands weeping in your hall as we speak.",
    "ghostlord_backstory_b",
    []],

  [anyone, "ghostlord_backstory_b",
    [],
    "Her spirit is in my hall?! I have sometimes thought I sensed her presence, but deemed it merely a fancy born of my grief.",
    "ghostlord_backstory_b_response",
    []],

  [plyr|anyone, "ghostlord_backstory_b_response",
    [],
    "She'd like to know if you had aught to do with her death? Did you murder her?",
    "ghostlord_backstory_c",
    []],

  [anyone, "ghostlord_backstory_c",
    [],
    "How could she think I wished her dead? I loved her dearly and would never harm her! I would give my all, my life itself, to keep her safe and well. Life without her is unbearable. If she was murdered, the culprit shall pay very dearly, I swear on my honor! Tell me who has done this thing!",
    "ghostlord_backstory_c_response",
    []],

  [plyr|anyone, "ghostlord_backstory_c_response",
    [],
    "When I discover her murderer, I will inform you. Farewell for now.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (neq, ":var0", 15),
      (val_or, ":var0", 2),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 15),
      (quest_set_slot, "qst_ghost_lady", 11, 3),
      (str_store_string, s60, "@You have decided which of the suspects is guilty and now it is time to confront the murderer."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|anyone, "ghostlord_start_response",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
      (quest_get_slot, ":var0", "qst_ghost_lady", 6),
      (str_store_troop_name, s6, ":var0"),
    ],
    "My friend, you betrayed your wife with {s6}. It pains me to accuse you of killing your lady.",
    "ghostlord_accuse",
    []],

  [anyone, "ghostlord_accuse",
    [],
    "Well, I did not, so there goes a wonderful friendship!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_set_slot, "qst_ghost_lady", 11, 5),
      (str_store_troop_name, s60, "$g_talk_troop"),
      (str_store_string, s60, "@You have wrongfully accused {s60}, talk to the Ghost Lady again."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (str_clear, s60),
      (add_quest_note_from_sreg, "qst_ghost_lady", 1, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 2, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 3, s60, 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -20),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (check_quest_succeeded, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (assign, ":var1", 0),
      (store_and, ":var1", ":var0", 2),
      (eq, ":var1", 0),
    ],
    "Come to accuse me yet again of murdering my beloved wife, {playername}? How often must I tell you I did not?",
    "ghostlord_success_response",
    []],

  [plyr|anyone, "ghostlord_success_response",
    [],
    "My lord, I have found your wife's poisoner. It was your scribe, who murdered her to hide his thefts from you. He now faces his gods for punishment.",
    "ghostlord_end",
    []],

  [anyone, "ghostlord_end",
    [],
    "I thank you for discovering both my wife's murderer and for punishing her thieving killer! I must be more careful in my next choice of scribe.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 10),
      (val_or, ":var0", 2),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 14),
      (call_script, "script_end_quest", "qst_ghost_lady"),
      (quest_set_slot, "qst_ghost_lady", 11, 8),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 4, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 11),
      (is_between, ":var0", 0, 4),
    ],
    "Why do you accost me?",
    "ghostenemy_start_response",
    []],

  [plyr|anyone, "ghostenemy_start_response",
    [],
    "Apologies, my Lord, for disturbing you. I must beg my leave.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "ghostenemy_start_response",
    [
      (this_or_next|quest_slot_eq, "qst_ghost_lady", 11, 2),
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "I seek the one who murdered Lady Alienor.",
    "ghostenemy_backstory_intro",
    []],

  [anyone, "ghostenemy_backstory_intro",
    [],
    "I'd heard she died. What's that to me? You say someone murdered her? A pity. Despite her poor taste in husbands, she was a charming lady. Before she married, I courted her, but her father bestowed her hand elsewhere.",
    "ghostenemy_backstory_response",
    []],

  [plyr|anyone, "ghostenemy_backstory_response",
    [],
    "She urged her Lord to fight you and rescue the peasants you captured.",
    "ghostenemy_backstory_a",
    []],

  [anyone, "ghostenemy_backstory_a",
    [],
    "You bumptious fool! If I hold another lord in enmity, it is he I fight, man to man, army to army! I do not stoop to killing noblewomen.",
    "ghostenemy_backstory_a_response",
    []],

  [plyr|anyone, "ghostenemy_backstory_a_response",
    [],
    "She tells me you took peasants from one of her villages for your army.",
    "ghostenemy_backstory_b",
    []],

  [anyone, "ghostenemy_backstory_b",
    [],
    "She tells you? The lady has been dead for some time, so I misdoubt you've spoken with her. What nonsense are you spouting? I did a bit of recruiting on their fief, but everyone does that. Now leave, before you offend me.",
    "ghostenemy_backstory_b_response",
    []],

  [plyr|anyone, "ghostenemy_backstory_b_response",
    [],
    "Her spirit remains and she tasked me with finding her murderer. Was it you?",
    "ghostenemy_backstory_c",
    []],

  [anyone, "ghostenemy_backstory_c",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
    ],
    "You damned fool, I may take peasants by force when I need recruits, but I do not kill women of noble birth. I have been married myself for years, and bore Alienor no grudge for marrying another. It assuredly was not me who killed her and I'd like to know who did! She may have urged {s4} to fight me for taking those worthless peasants, but anyone would have done so in like case, except perhaps her gutless lord. I bore no grudge against her for that.",
    "ghostenemy_backstory_c_response",
    []],

  [plyr|anyone, "ghostenemy_backstory_c_response",
    [],
    "When I know her killer's name, I will inform you of it.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (neq, ":var0", 15),
      (val_or, ":var0", 4),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 15),
      (quest_set_slot, "qst_ghost_lady", 11, 3),
      (str_store_string, s60, "@You have decided which of the suspects is guilty and now it is time to confront the murderer."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|anyone, "ghostenemy_start_response",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "What better way to harm an enemy, than by striking at his beloved wife? I accuse you of murder!",
    "ghostenemy_accuse",
    []],

  [anyone, "ghostenemy_accuse",
    [],
    "Pull your head our of your arse, fool - I did nothing of the kind.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_set_slot, "qst_ghost_lady", 11, 5),
      (str_store_troop_name, s60, "$g_talk_troop"),
      (str_store_string, s60, "@You have wrongfully accused {s60}, talk to the Ghost Lady again."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (str_clear, s60),
      (add_quest_note_from_sreg, "qst_ghost_lady", 1, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 2, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 3, s60, 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -10),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (check_quest_succeeded, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 4, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (assign, ":var1", 0),
      (store_and, ":var1", ":var0", 4),
      (eq, ":var1", 0),
    ],
    "So you've returned. Do you intend to accuse me of murder yet again?",
    "ghostenemy_success_response",
    []],

  [plyr|anyone, "ghostenemy_success_response",
    [],
    "My Lord, I found the man who poisoned Lady Alienor, her scribe, and gave him his due.",
    "ghostenemy_end",
    []],

  [anyone, "ghostenemy_end",
    [],
    "I suppose I should be thankful you had enough sense to recognize the real killer. I'd advise you to take care where you fling careless accusations in future.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 5),
      (val_or, ":var0", 4),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 14),
      (call_script, "script_end_quest", "qst_ghost_lady"),
      (quest_set_slot, "qst_ghost_lady", 11, 8),
    ]],

  [anyone, "start",
    [
      (this_or_next|is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (party_get_slot, ":var0", "$g_encountered_party", 296),
      (ge, ":var0", 1),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
      (store_random_in_range, ":var1", 0, 7),
      (store_add, ":var2", ":var1", "str_heartbeat_intro_1"),
      (str_store_string, s48, ":var2"),
    ],
    "{s48}",
    "heartbeat_intro_response_1",
    []],

  [plyr|anyone, "heartbeat_intro_response_1",
    [
      (store_random_in_range, ":var0", 0, 7),
      (store_add, ":var1", ":var0", "str_heartbeat_intro_response_1"),
      (str_store_string, s48, ":var1"),
    ],
    "{s48}",
    "heartbeat_problem_statement",
    []],

  [anyone, "heartbeat_problem_statement",
    [
      (str_clear, s19),
      (call_script, "script_pop3_heartbeat_offset"),
      (store_random_in_range, ":var0", 0, 4),
      (store_add, ":var1", reg19, ":var0"),
      (store_add, ":var2", reg23, "str_heartbeat_problem_statement_1"),
      (str_store_string, s49, ":var2"),
      (store_add, ":var2", ":var1", "str_heartbeat_problem_1_a"),
      (str_store_string, s50, ":var2"),
      (str_store_string, s48, "@ {s49} {s50}"),
    ],
    "{s48}",
    "heartbeat_problem_selection",
    []],

  [plyr|anyone, "heartbeat_problem_selection",
    [
      (store_add, ":var0", reg19, 0),
      (store_add, ":var1", ":var0", "str_heartbeat_problem_response_1_a"),
      (str_store_string, s48, ":var1"),
    ],
    "{s48}",
    "close_window",
    [
      (store_add, reg31, reg19, 0),
      (call_script, "script_pop3_heartbeat_resolve", 1, reg23),
    ]],

  [plyr|anyone, "heartbeat_problem_selection",
    [
      (store_add, ":var0", reg19, 1),
      (store_add, ":var1", ":var0", "str_heartbeat_problem_response_1_a"),
      (str_store_string, s48, ":var1"),
    ],
    "{s48}",
    "close_window",
    [
      (store_add, reg31, reg19, 1),
      (call_script, "script_pop3_heartbeat_resolve", 2, reg23),
    ]],

  [plyr|anyone, "heartbeat_problem_selection",
    [
      (store_add, ":var0", reg19, 2),
      (store_add, ":var1", ":var0", "str_heartbeat_problem_response_1_a"),
      (str_store_string, s48, ":var1"),
    ],
    "{s48}",
    "close_window",
    [
      (store_add, reg31, reg19, 2),
      (call_script, "script_pop3_heartbeat_resolve", 3, reg23),
    ]],

  [plyr|anyone, "heartbeat_problem_selection",
    [
      (store_add, ":var0", reg19, 3),
      (store_add, ":var1", ":var0", "str_heartbeat_problem_response_1_a"),
      (str_store_string, s48, ":var1"),
    ],
    "{s48}",
    "close_window",
    [
      (store_add, reg31, reg19, 3),
      (call_script, "script_pop3_heartbeat_resolve", 4, reg23),
    ]],

  [anyone, "lord_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (check_quest_active, "qst_wed_betrothed"),
      (quest_slot_eq, "qst_wed_betrothed", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_wed_betrothed", 2),
      (troop_slot_eq, ":var0", 12, "$g_encountered_party"),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "May the heavens witness that I am ready to give you my {s11} {s4}, to have in marriage...",
    "wedding_ceremony_bride_vow",
    [
      (quest_get_slot, "$g_player_bride", "qst_wed_betrothed", 2),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_wed_betrothed"),
      (quest_slot_eq, "qst_wed_betrothed", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_wed_betrothed", 23),
      (lt, ":var0", 362),
      (eq, "$g_done_wedding_comment", 0),
      (str_clear, s12),
      (try_begin),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 0),
        (str_store_string, s12, "@ We will of course need to wait until the realm is no longer on campaign."),
      (try_end),
    ],
    "It is good to see you, {playername}. We look forward to the wedding, as soon as we can all gather together for the feast.{s12}",
    "lord_wedding_reschedule",
    [
      (assign, "$g_done_wedding_comment", 1),
    ]],

  [plyr|anyone, "lord_wedding_reschedule",
    [],
    "It is no problem. I can wait.",
    "lord_start",
    []],

  [plyr|anyone, "lord_wedding_reschedule",
    [],
    "I have no faith that this wedding will be concluded. Please return my dower.",
    "lord_return_dower",
    []],

  [anyone, "lord_return_dower",
    [],
    "Well, that is your right, if you indeed have no confidence in our family's commitments. Take your money.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_wed_betrothed", 2),
      (fail_quest, "qst_wed_betrothed"),
      (call_script, "script_end_quest", "qst_wed_betrothed"),
      (troop_set_slot, "trp_player", 34, -1),
      (troop_set_slot, ":var0", 34, -1),
      (assign, "$marriage_dowry", 0),
      (troop_add_gold, "trp_player", "$marriage_dower"),
      (assign, "$marriage_dower", 0),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -3),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_incriminate_loyal_commander"),
      (check_quest_succeeded, "qst_incriminate_loyal_commander"),
      (quest_get_slot, ":var1", "qst_incriminate_loyal_commander", 2),
      (str_store_troop_name, s3, ":var1"),
      (quest_get_slot, reg5, "qst_incriminate_loyal_commander", 22),
    ],
    "Hah! Our little plot against {s3} worked perfectly, {playername}. The fool has lost one of his most valuable retainers, and we are one step closer to bringing him to his knees. Here, this purse contains {reg5} denars, and I wish you to have it. You deserve every copper. And, need I remind you, there could be much more to come if you've a mind to earn it...",
    "lord_generic_mission_completed",
    [
      (call_script, "script_finish_quest_simple", "qst_incriminate_loyal_commander", 100),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 5),
      (call_script, "script_change_player_honor", -10),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_incriminate_loyal_commander"),
      (check_quest_failed, "qst_incriminate_loyal_commander"),
    ],
    "You weren't able to complete a simple task. I had set up everything. The only thing you needed to do was sacrifice a messenger, and we would be celebrating now. But no, you were too damned honorable, weren't you?",
    "close_window",
    [
      (call_script, "script_finish_quest_simple", "qst_incriminate_loyal_commander", 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
      (call_script, "script_change_player_honor", 5),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_meet_spy_in_enemy_town"),
      (check_quest_succeeded, "qst_meet_spy_in_enemy_town"),
    ],
    "Have you brought me any news about that task I gave you? You know the one I mean...",
    "quest_meet_spy_in_enemy_town_completed",
    []],

  [plyr|anyone, "quest_meet_spy_in_enemy_town_completed",
    [],
    "I have the reports you wanted right here.",
    "quest_meet_spy_in_enemy_town_completed_2",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_completed_2",
    [],
    "Ahh, well done. It's good to have competent {reg63?men:people} on my side. Here is the payment I promised you.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
      (call_script, "script_finish_quest_simple", "qst_meet_spy_in_enemy_town", 100),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_cause_provocation"),
      (check_quest_succeeded, "qst_cause_provocation"),
      (quest_get_slot, ":var1", "qst_cause_provocation", 3),
      (str_store_faction_name, s13, ":var1"),
    ],
    "Brilliant work, {playername}! Whatever you did, the nobles of the {s13} are clamoring for war! Soon, the time will come for us to reap the benefits of our hard work, from fields ripe for plunder. This war is going to make us rich, mark my words!",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 10),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (store_troop_faction, ":var1", ":var0"),
        (eq, ":var1", "$players_kingdom"),
        (neq, ":var0", "$g_talk_troop"),
        (store_random_in_range, ":var2", -5, 4),
        (call_script, "script_change_player_relation_with_troop", ":var0", ":var2"),
      (try_end),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_finish_quest_simple", "qst_cause_provocation", 100),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_collect_debt"),
      (quest_slot_eq, "qst_collect_debt", 11, 1),
      (quest_get_slot, ":var1", "qst_collect_debt", 2),
      (str_store_troop_name, s7, ":var1"),
      (quest_get_slot, ":var2", "qst_collect_debt", 10),
      (store_div, reg3, ":var2", 5),
      (store_sub, reg4, ":var2", reg3),
    ],
    "I'm told that you've collected the money owed me from {s7}. Good, it's past time I had it back. I believe I promised to give you one-fifth of it all, eh? Well, that makes {reg3} denars, so if you give me my share -- that's {reg4} denars -- you can keep the rest.",
    "lord_collect_debt_completed",
    []],

  [plyr|anyone, "lord_collect_debt_completed",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg4),
    ],
    "Of course, {s65}. {reg4} denars, all here.",
    "lord_collect_debt_pay",
    []],

  [anyone, "lord_collect_debt_pay",
    [],
    "I must admit I'm impressed, {playername}. I had lost hope of ever getting this money back. Please accept my sincere thanks.",
    "lord_pretalk",
    [
      (troop_remove_gold, "trp_player", reg4),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (add_xp_as_reward, 100),
      (call_script, "script_end_quest", "qst_collect_debt"),
    ]],

  [plyr|anyone, "lord_collect_debt_completed",
    [],
    "I am afraid I don't have the money with me sir.",
    "lord_collect_debt_no_pay",
    []],

  [anyone, "lord_collect_debt_no_pay",
    [],
    "Is this a joke? I know full well that {s7} gave you the money, and I want every denar owed to me, {reg63?sir:madam}. As far as I'm concerned, I hold you personally in my debt until I see that silver.",
    "close_window",
    [
      (call_script, "script_change_debt_to_troop", "$g_talk_troop", reg4),
      (call_script, "script_end_quest", "qst_collect_debt"),
      (call_script, "script_objectionable_action", 4, "str_squander_money"),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_kill_local_merchant"),
      (check_quest_succeeded, "qst_kill_local_merchant"),
      (quest_slot_eq, "qst_kill_local_merchant", 11, 1),
    ],
    "I heard you got rid of that poxy merchant that was causing me so much grief. I can see you're not afraid to get your hands dirty, eh? I like that in a {reg63?man:woman}. Here's your reward. Remember, {playername}, stick with me and we'll go a long, long way together.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 4),
      (call_script, "script_finish_quest_simple", "qst_kill_local_merchant", 70),
      (call_script, "script_troop_add_gold", "trp_player", 1500),
      (call_script, "script_objectionable_action", 3, "str_murder_merchant"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_kill_local_merchant"),
      (check_quest_failed, "qst_kill_local_merchant"),
    ],
    "Oh, it's you. Enlighten me, how exactly does one lose a simple fight to some poxy, lowborn merchant? Truly, if I ever need my guardsmen to take a lesson in how to lay down and die, I'll be sure to come to you. Just leave me be, {playername}, I have things to do.",
    "close_window",
    [
      (call_script, "script_finish_quest_simple", "qst_kill_local_merchant", 20),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_kill_local_merchant"),
      (check_quest_succeeded, "qst_kill_local_merchant"),
      (quest_slot_eq, "qst_kill_local_merchant", 11, 2),
    ],
    "You! Do you have sawdust between your ears? Did you think that when I said to kill the merchant, I meant you to have a nice chat with him and then let him go?! What possessed you?",
    "lord_kill_local_merchant_let_go",
    []],

  [plyr|anyone, "lord_kill_local_merchant_let_go",
    [],
    "Sir, I made sure he will not act against you.",
    "lord_kill_local_merchant_let_go_2",
    []],

  [anyone, "lord_kill_local_merchant_let_go_2",
    [],
    "Piffle. You were supposed to remove him, not give him a sermon and send him on his way. He had better do as you say, or you'll both regret it. Here, this is half the money I promised you. Don't say a word, {playername}, you're lucky to get even that. I have little use for {reg63?men:people} who cannot follow orders.",
    "lord_pretalk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 750),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_finish_quest_simple", "qst_kill_local_merchant", 100),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_follow_spy"),
      (eq, "$qst_follow_spy_no_active_parties", 1),
      (party_count_prisoners_of_type, ":var1", "p_main_party", "trp_spy"),
      (party_count_prisoners_of_type, ":var2", "p_main_party", "trp_spy_partner"),
      (gt, ":var1", 0),
      (gt, ":var2", 0),
    ],
    "Beautiful work, {playername}! You captured both the spy and his handler, just as I'd hoped, and the pair are now safely ensconced in my dungeon, waiting to be questioned. My torturer shall be busy tonight! Anyway, I'm very pleased with your success, {playername}, and I give you this purse as a token of my appreciation.",
    "lord_follow_spy_completed",
    [
      (party_remove_prisoners, "p_main_party", "trp_spy", 1),
      (party_remove_prisoners, "p_main_party", "trp_spy_partner", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 4),
      (call_script, "script_finish_quest_simple", "qst_follow_spy", 100),
    ]],

  [anyone, "lord_start",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_follow_spy"),
      (eq, "$qst_follow_spy_no_active_parties", 1),
      (party_count_prisoners_of_type, ":var1", "p_main_party", "trp_spy"),
      (party_count_prisoners_of_type, ":var2", "p_main_party", "trp_spy_partner"),
      (gt, ":var1", 0),
      (eq, ":var2", 0),
    ],
    "Blast and damn you! I wanted TWO prisoners, {playername} -- what you've brought me is one step short of useless! I already know everything the spy knows, it was the handler I was after. Here, half a job gets you lesser reward. Take it and begone.",
    "lord_follow_spy_half_completed",
    [
      (party_remove_prisoners, "p_main_party", "trp_spy", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (call_script, "script_finish_quest_simple", "qst_follow_spy", 20),
    ]],

  [anyone, "lord_start",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_follow_spy"),
      (eq, "$qst_follow_spy_no_active_parties", 1),
      (party_count_prisoners_of_type, ":var1", "p_main_party", "trp_spy"),
      (party_count_prisoners_of_type, ":var2", "p_main_party", "trp_spy_partner"),
      (eq, ":var1", 0),
      (gt, ":var2", 0),
    ],
    "I asked you for two prisoners, {playername}, not one. Two. Still, I suppose you did capture the spy's handler, the more important one of the pair. The spy will not dare return here and will prove quite useless to whatever master he served. 'Tis better than nothing. However, you'll understand if I pay you half the promised reward for what is but half a success.",
    "lord_follow_spy_half_completed",
    [
      (party_remove_prisoners, "p_main_party", "trp_spy_partner", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (call_script, "script_finish_quest_simple", "qst_follow_spy", 50),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_follow_spy"),
      (eq, "$qst_follow_spy_no_active_parties", 1),
      (party_count_prisoners_of_type, ":var1", "p_main_party", "trp_spy"),
      (party_count_prisoners_of_type, ":var2", "p_main_party", "trp_spy_partner"),
      (eq, ":var1", 0),
      (eq, ":var2", 0),
    ],
    "Truly, {playername}, you are nothing short of totally incompetent. Failing to capture both the spy AND his handler plumbs astonishing new depths of failure. Forget any reward I offered you. You've done nothing to earn it.",
    "lord_follow_spy_failed",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -2),
      (call_script, "script_finish_quest_simple", "qst_follow_spy", 0),
    ]],

  [plyr|anyone, "lord_follow_spy_half_completed",
    [],
    "I did my best, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_follow_spy_completed",
    [],
    "Thank you, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_follow_spy_failed",
    [],
    "Hrm. As you like, {s65}.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_bring_back_runaway_serfs"),
      (check_quest_succeeded, "qst_bring_back_runaway_serfs"),
    ],
    "Splendid work, {playername}. All the serfs are back, properly cowed, and they're busy preparing for the harvest. You certainly earned your reward. Here, take it, with my compliments.",
    "lord_generic_mission_completed",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_finish_quest_simple", "qst_bring_back_runaway_serfs", 100),
      (call_script, "script_objectionable_action", 3, "str_round_up_serfs"),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_bring_back_runaway_serfs"),
      (check_quest_failed, "qst_bring_back_runaway_serfs"),
    ],
    "{playername}. I have been waiting patiently for my serfs, yet none have returned. Have you an explanation? Were you outwitted by simple fieldhands, or are you merely incompetent? Or perhaps you are plotting with my enemies, intending to ruin me...",
    "lord_bring_back_runaway_serfs_failed",
    []],

  [plyr|anyone, "lord_bring_back_runaway_serfs_failed",
    [],
    "Forgive me, {s65}, those serfs were slippery as eels.",
    "lord_bring_back_runaway_serfs_failed_1a",
    []],

  [plyr|anyone, "lord_bring_back_runaway_serfs_failed",
    [],
    "Perhaps if you had treated them better...",
    "lord_bring_back_runaway_serfs_failed_1b",
    []],

  [anyone, "lord_bring_back_runaway_serfs_failed_1a",
    [],
    "Hmph, that is hardly an excuse for failure, {playername}. Now if you will excuse me, I need to recruit new men to work these fields before we all starve.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (call_script, "script_finish_quest_simple", "qst_bring_back_runaway_serfs", 0),
    ]],

  [anyone, "lord_bring_back_runaway_serfs_failed_1b",
    [],
    "Hah, now you reveal your true colours, traitor! Your words match your actions all too well. I should never have trusted you.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -10),
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", 10),
      (call_script, "script_finish_quest_simple", "qst_bring_back_runaway_serfs", 0),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_bring_back_runaway_serfs"),
      (check_quest_concluded, "qst_bring_back_runaway_serfs"),
      (assign, reg17, "$qst_bring_back_runaway_serfs_num_parties_returned"),
    ],
    "You disappoint me, {playername}. There were 3 groups of serfs that I charged you to return. 3. Not {reg17}. I suppose the ones who did come back shall have to work twice as hard to make up for those that got away. As for your reward, {playername}, I'll only pay you for the serfs you returned, not the ones you let fly. Here. Take it, and let this business be done.",
    "lord_runaway_serf_half_completed",
    [
      (store_mul, ":var0", "$qst_bring_back_runaway_serfs_num_parties_returned", 33),
      (call_script, "script_finish_quest_simple", "qst_bring_back_runaway_serfs", ":var0"),
      (call_script, "script_objectionable_action", 3, "str_round_up_serfs"),
    ]],

  [plyr|anyone, "lord_runaway_serf_half_completed",
    [],
    "Thank you, {s65}. You are indeed generous.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_runaway_serf_half_completed",
    [],
    "Bah, this proved to be a waste of my time.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deal_with_bandits_at_lords_village"),
      (check_quest_succeeded, "qst_deal_with_bandits_at_lords_village"),
    ],
    "{playername}, I was told that you have crushed the bandits at my village of {s5}. Please know that I am most grateful to you for that. Please, let me pay the expenses of your campaign. Here, I hope these {reg14} denars will be adequate.",
    "lord_deal_with_bandits_completed",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
      (call_script, "script_finish_quest_simple", "qst_deal_with_bandits_at_lords_village", 100),
      (quest_get_slot, ":var0", "qst_deal_with_bandits_at_lords_village", 22),
      (assign, reg14, ":var0"),
      (quest_get_slot, ":var1", "qst_deal_with_bandits_at_lords_village", 1),
      (str_store_party_name, s5, ":var1"),
    ]],

  [plyr|anyone, "lord_deal_with_bandits_completed",
    [],
    "Not a problem, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_deal_with_bandits_completed",
    [],
    "Glad to be of service.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_deal_with_bandits_completed",
    [],
    "It was mere child's play.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deal_with_bandits_at_lords_village"),
      (check_quest_concluded, "qst_deal_with_bandits_at_lords_village"),
    ],
    "Damn it, {playername}. I heard that you were unable to drive off the bandits from my village of {s5}, and thanks to you, my village now lies in ruins. Everyone said that you were a capable warrior, but apparently, they were wrong.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
      (call_script, "script_end_quest", "qst_deal_with_bandits_at_lords_village"),
      (quest_get_slot, ":var0", "qst_deal_with_bandits_at_lords_village", 1),
      (str_store_party_name, s5, ":var0"),
    ]],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deliver_cattle_to_army"),
      (check_quest_succeeded, "qst_deliver_cattle_to_army"),
      (quest_get_slot, reg13, "qst_deliver_cattle_to_army", 10),
    ],
    "Ah, {playername}. My quartermaster has informed me of your delivery, {reg13} heads of cattle, as I requested. I'm impressed.",
    "lord_deliver_cattle_to_army_thank",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (quest_get_slot, ":var0", "qst_deliver_cattle_to_army", 10),
      (store_mul, ":var1", ":var0", 100),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
      (val_div, ":var1", 2),
      (add_xp_as_reward, ":var1"),
      (call_script, "script_end_quest", "qst_deliver_cattle_to_army"),
      (assign, "$g_random_army_quest", -1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (setup_quest_text, "qst_follow_army"),
      (str_store_string, s2, "str_follow_army_quest_brief_2"),
      (call_script, "script_start_quest", "qst_follow_army", "$g_talk_troop"),
      (assign, "$g_player_follow_army_warnings", 0),
    ]],

  [plyr|anyone, "lord_deliver_cattle_to_army_thank",
    [],
    "Not a problem, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_deliver_cattle_to_army_thank",
    [],
    "Glad to be of service.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_deliver_cattle_to_army_thank",
    [],
    "Mere child's play.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_scout_waypoints"),
      (check_quest_succeeded, "qst_scout_waypoints"),
      (str_store_party_name, s13, "$qst_scout_waypoints_wp_1"),
      (str_store_party_name, s14, "$qst_scout_waypoints_wp_2"),
      (str_store_party_name, s15, "$qst_scout_waypoints_wp_3"),
    ],
    "You make a good scout, {playername}. My runner just brought me your reports of the mission to {s13}, {s14} and {s15}. Well done.",
    "lord_scout_waypoints_thank",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (call_script, "script_reward_for_quest_per_player_level", 150, 10, 0, 0),
      (add_xp_as_reward, reg33),
      (call_script, "script_end_quest", "qst_scout_waypoints"),
      (assign, "$g_random_army_quest", -1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (setup_quest_text, "qst_follow_army"),
      (str_store_string, s2, "str_follow_army_quest_brief_2"),
      (call_script, "script_start_quest", "qst_follow_army", "$g_talk_troop"),
      (assign, "$g_player_follow_army_warnings", 0),
    ]],

  [plyr|anyone, "lord_scout_waypoints_thank",
    [],
    "A simple task, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_scout_waypoints_thank",
    [],
    "Nothing I couldn't handle.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_scout_waypoints_thank",
    [],
    "My pleasure, {s65}.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_follow_army"),
      (faction_slot_eq, "$g_talk_troop_faction", 8, "$g_talk_troop"),
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (eq, "$g_random_army_quest", "qst_deliver_cattle_to_army"),
      (quest_get_slot, ":var0", "$g_random_army_quest", 10),
      (assign, reg3, ":var0"),
    ],
    "The army's supplies are dwindling too quickly, {playername}. I need you to bring me {reg3} heads of cattle so I can keep the troops fed. I care very little about where you get them, just bring them to me as soon as you can.",
    "lord_mission_told_deliver_cattle_to_army",
    []],

  [plyr|anyone, "lord_mission_told_deliver_cattle_to_army",
    [],
    "Very well, I can find you some cattle.",
    "lord_mission_told_deliver_cattle_to_army_accepted",
    []],

  [plyr|anyone, "lord_mission_told_deliver_cattle_to_army",
    [],
    "Sorry, sir, I have other plans.",
    "lord_mission_told_deliver_cattle_to_army_rejected",
    []],

  [anyone, "lord_mission_told_deliver_cattle_to_army_accepted",
    [],
    "Excellent! You know what to do, {playername}, now get to it. I need that cattle sooner rather than later.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_follow_army"),
      (quest_get_slot, ":var0", "$g_random_army_quest", 10),
      (str_store_troop_name_link, s13, "$g_talk_troop"),
      (assign, reg3, ":var0"),
      (setup_quest_text, "$g_random_army_quest"),
      (str_store_string, s2, "@{s13} asked you to gather {reg3} heads of cattle and deliver them back to him."),
      (call_script, "script_start_quest", "$g_random_army_quest", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_told_deliver_cattle_to_army_rejected",
    [],
    "That... is unfortunate, {playername}. I shall have to find someone else who's up to the task. Please go now, I've work to do.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_report_to_army"),
      (quest_slot_eq, "qst_report_to_army", 2, "$g_talk_troop"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (store_relation, ":var2", ":var1", "$players_kingdom"),
        (lt, ":var2", 0),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "Thank you for answering the summons, {playername}. However, as we are now at peace, we do not need your services. You may attend to your other business.",
    "lord_pretalk",
    [
      (call_script, "script_end_quest", "qst_report_to_army"),
      (quest_set_slot, "qst_report_to_army", 6, "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_report_to_army"),
      (quest_slot_eq, "qst_report_to_army", 2, "$g_talk_troop"),
    ],
    "Ah, you have arrived at last, {playername}. We've been expecting you. I hope you have brought with you troops of sufficient number and experience.",
    "lord_report_to_army_asked",
    []],

  [plyr|anyone, "lord_report_to_army_asked",
    [
      (quest_get_slot, ":var0", "qst_report_to_army", 10),
      (call_script, "script_party_count_fit_for_battle", "p_main_party"),
      (gt, reg0, ":var0"),
    ],
    "I have a company of good, hardened soldiers with me. We are ready to join you.",
    "lord_report_to_army_completed",
    []],

  [plyr|anyone, "lord_report_to_army_asked",
    [],
    "I don't have the sufficient number of troops yet. I will need some more time.",
    "lord_report_to_army_continue",
    []],

  [anyone, "lord_report_to_army_completed",
    [],
    "Excellent. We'll be moving soon. Now -- you are a {reg63?man:warrior} of sound judgement, and we trust that you will do what is necessary to support our campaign. I do not require you to remain close at hand, and I will not count it against you if you believe that your forces would be of better use elsewhere. But if you do choose to remain with me, to support me in battle, that would be appreciated. I may also have additional tasks for you to perform.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_report_to_army"),
      (quest_set_slot, "qst_report_to_army", 6, "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (setup_quest_text, "qst_follow_army"),
      (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
      (call_script, "script_start_quest", "qst_follow_army", "$g_talk_troop"),
      (assign, "$g_player_follow_army_warnings", 0),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_report_to_army_continue",
    [],
    "Then you'd better hurry. We'll be moving out soon against the enemy and I need every able hand we can muster.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_follow_army"),
      (faction_slot_eq, "$players_kingdom", 8, "$g_talk_troop"),
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (eq, "$g_random_army_quest", "qst_scout_waypoints"),
      (str_store_party_name, s13, "$qst_scout_waypoints_wp_1"),
      (str_store_party_name, s14, "$qst_scout_waypoints_wp_2"),
      (str_store_party_name, s15, "$qst_scout_waypoints_wp_3"),
    ],
    "{playername}, I need a volunteer to scout the area. We're sorely lacking on information, and I simply must have a better picture of the situation before we can proceed. I want you to go to {s13}, {s14} and {s15} and report back whatever you find.",
    "lord_mission_told_scout_waypoints",
    []],

  [plyr|anyone, "lord_mission_told_scout_waypoints",
    [],
    "You've found your volunteer, sir.",
    "lord_mission_told_scout_waypoints_accepted",
    []],

  [plyr|anyone, "lord_mission_told_scout_waypoints",
    [],
    "I fear I must decline.",
    "lord_mission_told_scout_waypoints_rejected",
    []],

  [anyone, "lord_mission_told_scout_waypoints_accepted",
    [],
    "Good {reg63?man:lass}! Simply pass near {s13}, {s14} and {s15} and check out what's there. Make a note of anything you find and return to me as soon as possible.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_follow_army"),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s13, "$qst_scout_waypoints_wp_1"),
      (str_store_party_name_link, s14, "$qst_scout_waypoints_wp_2"),
      (str_store_party_name_link, s15, "$qst_scout_waypoints_wp_3"),
      (setup_quest_text, "$g_random_army_quest"),
      (str_store_string, s2, "@{s9} asked you to scout {s13}, {s14} and {s15}, then report back."),
      (call_script, "script_start_quest", "$g_random_army_quest", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_told_scout_waypoints_rejected",
    [],
    "Hm. I'm disappointed, {playername}. Very disappointed. We'll talk later, I need to go and find somebody to scout for us.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_generic_mission_thank",
    [],
    "You have been most helpful, {playername}. My thanks.",
    "lord_generic_mission_completed",
    []],

  [plyr|anyone, "lord_generic_mission_completed",
    [],
    "It was an honor to serve.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (troop_get_slot, ":var0", "$g_talk_troop", 21),
      (gt, ":var0", 0),
      (assign, reg1, ":var0"),
    ],
    "I think you owe me {reg1} denars, {playername}. Do you intend to pay your debt anytime soon?",
    "lord_pay_debt_2",
    []],

  [plyr|anyone, "lord_pay_debt_2",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 21),
      (store_troop_gold, ":var1", "trp_player"),
      (le, ":var0", ":var1"),
    ],
    "That is why I came, {s65}. Here it is, every denar I owe you.",
    "lord_pay_debt_3_1",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 21),
      (troop_remove_gold, "trp_player", ":var0"),
      (troop_set_slot, "$g_talk_troop", 21, 0),
    ]],

  [plyr|anyone, "lord_pay_debt_2",
    [],
    "Alas, I don't have sufficient funds, {s65}. But I'll pay you soon enough.",
    "lord_pay_debt_3_2",
    []],

  [anyone, "lord_pay_debt_3_1",
    [],
    "Ah, excellent. You are a {reg63?man:woman} of honor, {playername}. I am satisfied. Your debt to me has been paid in full.",
    "lord_pretalk",
    []],

  [anyone, "lord_pay_debt_3_2",
    [],
    "Well, don't keep me waiting much longer.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (eq, "$g_romantic_comment_made", 0),
      (ge, "$g_talk_troop_relation", 20),
      (troop_slot_ge, "trp_player", 7, 250),
      (neg|troop_slot_ge, "trp_player", 30, "trp_knight_1_1_wife"),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
        (troop_slot_eq, ":var2", 30, -1),
        (troop_slot_eq, ":var2", 34, -1),
        (troop_slot_eq, ":var2", 12, "$g_encountered_party"),
        (neg|troop_slot_ge, ":var2", 5, 4),
        (call_script, "script_get_kingdom_lady_social_determinants", ":var2"),
        (eq, reg0, "$g_talk_troop"),
        (assign, "$marriage_candidate", ":var2"),
        (call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", "$g_talk_troop", "trp_player"),
        (gt, reg0, 0),
        (assign, ":var1", ":var2"),
      (try_end),
      (gt, ":var1", 0),
      (troop_slot_eq, ":var1", 5, 0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
      (str_store_troop_name, s14, ":var1"),
    ],
    "By the way, I hope you get a chance to meet my {s11}, {s14}. ",
    "lord_start",
    [
      (troop_set_slot, "$g_talk_troop", 38, 1),
      (assign, "$g_romantic_comment_made", 1),
    ]],

  [anyone, "lord_start",
    [
      (eq, "$g_romantic_comment_made", 0),
      (ge, "$g_talk_troop_relation", 20),
      (troop_slot_ge, "trp_player", 7, 250),
      (assign, ":var0", 0),
      (neg|troop_slot_ge, "trp_player", 30, "trp_knight_1_1_wife"),
      (troop_get_type, ":var1", "trp_player"),
      (eq, ":var1", 0),
      (try_for_range, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
        (troop_slot_eq, ":var2", 30, -1),
        (troop_slot_eq, ":var2", 34, -1),
        (troop_slot_eq, ":var2", 12, "$g_encountered_party"),
        (neg|troop_slot_ge, ":var2", 5, 4),
        (call_script, "script_get_kingdom_lady_social_determinants", ":var2"),
        (eq, reg0, "$g_talk_troop"),
        (assign, "$marriage_candidate", ":var2"),
        (call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", "$g_talk_troop", "trp_player"),
        (gt, reg0, 0),
        (troop_slot_ge, ":var2", 5, 1),
        (store_current_hours, ":var3"),
        (troop_get_slot, ":var4", ":var2", 4),
        (val_sub, ":var3", ":var4"),
        (ge, ":var3", 24),
        (assign, ":var0", ":var2"),
      (try_end),
      (gt, ":var0", 0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s14, ":var0"),
    ],
    "By the way, I am sure that my {s11}, {s14}, would be delighted were you to pay her a visit. She awaits you in her chambers.",
    "lord_start",
    [
      (troop_set_slot, "$g_talk_troop", 38, 1),
      (assign, "$g_romantic_comment_made", 1),
    ]],

  [anyone, "lord_start",
    [
      (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
      (ge, "$g_talk_troop_faction_relation", 0),
      (neq, "$g_ransom_offer_rejected", 1),
      (lt, "$g_encountered_party_2", 0),
      (hero_can_join_as_prisoner, "$g_encountered_party"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 10),
      (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
      (assign, "$prisoner_lord_to_buy", -1),
      (try_for_range, ":var2", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
        (troop_slot_eq, ":var3", 2, 2),
        (store_troop_faction, ":var4", ":var3"),
        (store_relation, ":var5", ":var4", "$g_talk_troop_faction"),
        (lt, ":var5", 0),
        (assign, "$prisoner_lord_to_buy", ":var3"),
      (try_end),
      (gt, "$prisoner_lord_to_buy", 0),
      (assign, ":var6", 1),
      (try_begin),
        (check_quest_active, "qst_capture_enemy_hero"),
        (store_troop_faction, ":var7", "$prisoner_lord_to_buy"),
        (quest_slot_eq, "qst_capture_enemy_hero", 3, ":var7"),
        (assign, ":var6", 0),
      (try_end),
      (eq, ":var6", 1),
      (str_store_troop_name, s3, "$prisoner_lord_to_buy"),
      (assign, reg5, "$prisoner_lord_to_buy"),
      (call_script, "script_calculate_ransom_amount_for_troop", "$prisoner_lord_to_buy"),
      (assign, reg6, reg0),
      (val_div, reg6, 2),
      (assign, "$temp", reg6),
    ],
    "I heard that you have captured our enemy {s3} and he is with you at the moment. I can pay you {reg6} denars for him if you want to get rid of him. You can wait for his family to pay his ransom of course, but there is no telling how long that will take, eh?",
    "lord_buy_prisoner",
    []],

  [plyr|anyone, "lord_buy_prisoner",
    [],
    "I accept your offer. I'll leave {s3} to you for {reg6} denars.",
    "lord_buy_prisoner_accept",
    []],

  [plyr|anyone, "lord_buy_prisoner",
    [],
    "I fear I can't accept your offer.",
    "lord_buy_prisoner_deny",
    [
      (assign, "$g_ransom_offer_rejected", 1),
    ]],

  [anyone, "lord_buy_prisoner_accept",
    [],
    "Excellent! Here's your {reg6} denars. I'll send some men to take him to our prison with due haste.",
    "lord_pretalk",
    [
      (remove_troops_from_prisoners, "$prisoner_lord_to_buy", 1),
      (call_script, "script_troop_add_gold", "trp_player", "$temp"),
      (party_add_prisoners, "$g_encountered_party", "$prisoner_lord_to_buy", 1),
      (troop_set_slot, "$prisoner_lord_to_buy", 8, "$g_encountered_party"),
    ]],

  [anyone, "lord_buy_prisoner_deny",
    [],
    "Mmm. As you wish, {playername}, but you'll not get a better offer. Take it from me.",
    "lord_pretalk",
    []],

  [anyone, "lord_start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
      (check_quest_active, "qst_organize_feast"),
      (quest_slot_eq, "qst_organize_feast", 1, "$g_encountered_party"),
      (try_begin),
        (eq, "$g_talk_troop_faction", "fac_kingdom_4"),
        (str_store_string, s5, "str_flagon_of_mead"),
      (else_try),
        (store_mod, ":var0", "$g_talk_troop", 2),
        (eq, ":var0", 0),
        (eq, "$g_talk_troop_faction", "fac_kingdom_3"),
        (str_store_string, s5, "str_skin_of_kumis"),
      (else_try),
        (store_mod, ":var0", "$g_talk_troop", 2),
        (eq, ":var0", 0),
        (eq, "$g_talk_troop_faction", "fac_kingdom_2"),
        (str_store_string, s5, "str_mug_of_kvass"),
      (else_try),
        (str_store_string, s5, "str_cup_of_wine"),
      (try_end),
    ],
    "I lift a {s5} to your health, {playername}! You are most gracious to host us on this occasion. Now, what is it?",
    "lord_talk",
    [
      (call_script, "script_internal_politics_rate_feast_to_s9", "trp_household_possessions", 120, "$players_kingdom", 0),
      (assign, ":var0", reg0),
      (try_begin),
        (ge, ":var0", 20),
        (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_pretender"),
          (troop_get_slot, ":var2", ":var1", 10),
          (gt, ":var2", 0),
          (party_get_attached_to, ":var3", ":var2"),
          (eq, ":var3", "$g_encountered_party"),
          (troop_get_slot, ":var4", ":var1", 162),
          (store_current_day, ":var5"),
          (try_begin),
            (gt, ":var5", ":var4"),
            (call_script, "script_troop_change_relation_with_troop", ":var1", "trp_player", 2),
            (troop_set_slot, ":var1", 162, ":var5"),
          (try_end),
        (try_end),
      (try_end),
    ]],

  [anyone, "lord_start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
    ],
    "To your health, {reg63?sire:your Highness}. Long may you reign. What is your bidding?",
    "lord_talk",
    [
      (try_begin),
        (this_or_next|party_slot_eq, "$g_encountered_party", 7, "trp_player"),
        (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
        (ge, "$g_time_since_last_talk", 24),
        (ge, "$g_talk_troop_relation", 0),
        (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 1),
      (try_end),
    ]],

  [anyone, "lord_start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
    ],
    "What is your bidding?",
    "lord_talk",
    []],

  [anyone, "lord_start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
      (ge, "$g_encountered_party_relation", 0),
      (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
      (neq, "$talk_context", 3),
    ],
    "I wish to welcome you to my hall on this auspicious occasion. Now, what is it?",
    "lord_talk",
    [
      (try_begin),
        (is_between, "$g_talk_troop_relation", 0, 10),
        (ge, "$g_time_since_last_talk", 24),
        (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 2),
      (try_end),
    ]],

  [anyone, "lord_start",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
      (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
      (ge, "$g_encountered_party_relation", 0),
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (try_begin),
        (lt, ":var0", 0),
        (str_store_string, s4, "@shall we"),
      (else_try),
        (str_store_troop_name, s4, ":var0"),
      (try_end),
      (neq, "$talk_context", 3),
      (try_begin),
        (eq, "$g_talk_troop_faction", "fac_kingdom_4"),
        (str_store_string, s5, "str_flagon_of_mead"),
      (else_try),
        (store_mod, ":var1", "$g_talk_troop", 2),
        (eq, ":var1", 0),
        (eq, "$g_talk_troop_faction", "fac_kingdom_3"),
        (str_store_string, s5, "str_skin_of_kumis"),
      (else_try),
        (store_mod, ":var1", "$g_talk_troop", 2),
        (eq, ":var1", 0),
        (eq, "$g_talk_troop_faction", "fac_kingdom_2"),
        (str_store_string, s5, "str_mug_of_kvass"),
      (else_try),
        (str_store_string, s5, "str_cup_of_wine"),
      (try_end),
    ],
    "Let us lift a {s5} to the health of our host, {s4}. Now, what is it?",
    "lord_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_offer_gift"),
      (quest_slot_eq, "qst_offer_gift", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_offer_gift", 2),
      (str_store_troop_name, s4, ":var0"),
      (player_has_item, "itm_furs"),
      (player_has_item, "itm_velvet"),
    ],
    "I have the materials for {s4}'s gift.",
    "offer_gift_quest_complete",
    []],

  [anyone, "offer_gift_quest_complete",
    [
      (quest_get_slot, ":var0", "qst_offer_gift", 2),
      (troop_get_type, reg4, ":var0"),
    ],
    "Ah, let me take those. Hopefully this will mend the quarrel between you two. You may wish to speak to {reg4?her:him}, and see if I had any success.",
    "close_window",
    [
      (quest_set_slot, "qst_offer_gift", 11, 2),
      (troop_remove_item, "trp_player", "itm_furs"),
      (troop_remove_item, "trp_player", "itm_velvet"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_intrigue_against_lord"),
      (neg|check_quest_succeeded, "qst_intrigue_against_lord"),
      (neg|check_quest_failed, "qst_intrigue_against_lord"),
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (store_troop_faction, ":var1", ":var0"),
      (faction_slot_eq, ":var1", 11, "$g_talk_troop"),
    ],
    "My lord, there is something I wish to tell you in confidence, about one of your vassals.",
    "intrigue_quest_state_complaint",
    []],

  [anyone, "intrigue_quest_state_complaint",
    [
      (assign, ":var0", 1),
      (try_begin),
        (call_script, "script_cf_troop_can_intrigue", "$g_talk_troop", 1),
        (assign, ":var0", 0),
      (try_end),
      (eq, ":var0", 1),
    ],
    "Whatever you have to say, I would ask you to wait until we are alone.",
    "lord_pretalk",
    []],

  [anyone, "intrigue_quest_state_complaint",
    [],
    "What is it? I value your opinion, although I hope that you are not trying to sew dissension among my vassals?",
    "intrigue_quest_state_complaint_plyr",
    [
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (call_script, "script_troop_get_relation_with_troop", ":var0", "$g_talk_troop"),
      (assign, reg4, reg0),
      (str_store_troop_name, s4, ":var0"),
      (assign, reg5, "$g_talk_troop_effective_relation"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_string, s12, "str_intrigue_success_chance"),
        (display_message, "str_s12"),
      (try_end),
    ]],

  [plyr|anyone, "intrigue_quest_state_complaint_plyr",
    [
      (check_quest_active, "qst_intrigue_against_lord"),
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (str_store_troop_name, s4, ":var0"),
      (troop_get_slot, ":var1", ":var0", 52),
      (val_add, ":var1", "str_lord_derogatory_default"),
      (str_store_string, s5, ":var1"),
    ],
    "My liege, {s4} is widely held by your vassals to be {s5}, and a liability to your realm",
    "lord_intrigue_quest_complaint_stated",
    []],

  [plyr|anyone, "intrigue_quest_state_complaint_plyr",
    [],
    "Actually, my liege, never mind.",
    "lord_pretalk",
    [
      (call_script, "script_fail_quest", "qst_intrigue_against_lord"),
    ]],

  [anyone, "lord_intrigue_quest_complaint_stated",
    [
      (store_random_in_range, ":var0", -50, 50),
      (store_add, ":var1", "$g_talk_troop_effective_relation", ":var0"),
      (quest_get_slot, ":var2", "qst_intrigue_against_lord", 2),
      (call_script, "script_troop_get_relation_with_troop", ":var2", "$g_talk_troop"),
      (ge, ":var1", reg0),
    ],
    "Hmm... This is troubling to hear. Although I do not encourage my vassals to speak ill of each other, I value your opinion. Perhaps I should think twice about granting {s4} any further fiefs or offices ...",
    "lord_pretalk",
    [
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", ":var0", -10),
      (call_script, "script_succeed_quest", "qst_intrigue_against_lord"),
    ]],

  [anyone, "lord_intrigue_quest_complaint_stated",
    [],
    "Sew discord among my vassals, will you? With everything else going on, do you think I appreciate my nobles turning on each other like quarreling dogs? Let me ask you this: did someone put you up this?",
    "intrigue_quest_state_complaint_failed",
    [
      (call_script, "script_fail_quest", "qst_intrigue_against_lord"),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -5),
    ]],

  [plyr|anyone, "intrigue_quest_state_complaint_failed",
    [],
    "I stand by my words, my liege.",
    "intrigue_quest_state_accept_blame",
    [
      (call_script, "script_change_player_honor", 1),
    ]],

  [plyr|anyone, "intrigue_quest_state_complaint_failed",
    [
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 6),
      (quest_get_slot, ":var1", "qst_intrigue_against_lord", 2),
      (str_store_troop_name, s4, ":var0"),
      (str_store_troop_name, s5, ":var1"),
    ],
    "Yes sire, {s4} put me up to denouncing {s5}!",
    "intrigue_quest_state_deflect_blame",
    [
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 6),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", ":var0", -5),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 4),
      (call_script, "script_change_player_honor", -2),
    ]],

  [anyone, "intrigue_quest_state_accept_blame",
    [],
    "Indeed. You may stand by your words, but keep them to yourself. I will not have you undercutting my faithful follower {s4}.",
    "lord_pretalk",
    []],

  [anyone, "intrigue_quest_state_deflect_blame",
    [],
    "I thought as much. Here's some advice for you, {reg63?lad:lassie} -- don't meddle in the quarrels of others. Now, enough of this.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_denounce_lord"),
      (neg|check_quest_succeeded, "qst_denounce_lord"),
      (neg|check_quest_failed, "qst_denounce_lord"),
      (quest_slot_eq, "qst_denounce_lord", 2, "$g_talk_troop"),
      (troop_get_slot, ":var0", "$g_talk_troop", 52),
      (val_add, ":var0", "str_lord_derogatory_default"),
      (str_store_string, s4, ":var0"),
    ],
    "I want to tell you something -- we have had enough of your {s4} ways",
    "lord_denounce_1",
    []],

  [anyone, "lord_denounce_1",
    [],
    "I'm sorry... What did you say?",
    "lord_denounce_2",
    []],

  [plyr|anyone, "lord_denounce_2",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 52),
      (val_add, ":var0", "str_lord_derogatory_result"),
      (str_store_string, s4, ":var0"),
    ],
    "You heard me. You will {s4}",
    "lord_denounce_3",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -15),
      (store_div, ":var0", "$g_talk_troop_relation", 10),
      (val_add, ":var0", 1),
      (val_max, ":var0", 1),
      (val_mul, ":var0", -1),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (neq, "$g_talk_troop", ":var1"),
        (store_troop_faction, ":var2", ":var1"),
        (eq, ":var2", "$g_talk_troop_faction"),
        (call_script, "script_troop_get_relation_with_troop", ":var1", "$g_talk_troop"),
        (lt, reg0, 15),
        (call_script, "script_troop_change_relation_with_troop", ":var1", "$g_talk_troop", ":var0"),
      (try_end),
    ]],

  [plyr|anyone, "lord_denounce_2",
    [],
    "Never mind. You must have misheard me.",
    "lord_pretalk",
    []],

  [anyone, "lord_denounce_3",
    [
      (ge, "$g_talk_troop_relation", 10),
      (neg|this_or_next|troop_slot_eq, "$g_talk_troop", 52, 2),
      (neg|troop_slot_eq, "$g_talk_troop", 52, 1),
    ],
    "Why would you say such a thing? To insult me like this, in spite of our friendship -- how much crueler is a knife in my back from an erstwhile friends, than the sword of a sworn foe. I do not know what game you are playing, but I want no part of it. Go away. I do not want to look at you.",
    "close_window",
    [
      (call_script, "script_succeed_quest", "qst_denounce_lord"),
    ]],

  [anyone, "lord_denounce_3",
    [
      (troop_slot_ge, "trp_player", 7, 500),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 4),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 7),
      (troop_slot_eq, "$g_talk_troop", 52, 6),
    ],
    "Hmf. Really? Is that your opinion, or did one of my rivals put those words in your mouth? Never mind. I will not play your game. Go away, and take your intrigues with you.",
    "close_window",
    [
      (call_script, "script_succeed_quest", "qst_denounce_lord"),
    ]],

  [anyone, "lord_denounce_3",
    [
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 1),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 4),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 7),
      (troop_slot_eq, "$g_talk_troop", 52, 6),
    ],
    "I will not have you shame me in public, {reg63?sir:my lady}. Retract your words, or meet me on the dueling ground.",
    "lord_denounce_4",
    []],

  [anyone, "lord_denounce_3",
    [],
    "Is that so? Well, hear this: you're a snake, and a knave, and, if you don't meet me on the dueling ground, a coward. What say you to that? Do you retract your words, or shall we cross swords?",
    "lord_denounce_4",
    []],

  [plyr|anyone, "lord_denounce_4",
    [],
    "It would be a pleasure to fight you.",
    "lord_respond_to_insult_challenge_duel_confirm",
    []],

  [plyr|anyone, "lord_denounce_4",
    [],
    "I spoke rashly. I retract my words.",
    "lord_denounce_retract",
    [
      (call_script, "script_fail_quest", "qst_denounce_lord"),
    ]],

  [anyone, "lord_denounce_retract",
    [],
    "I thought as much. Now, be gone from here.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_comment_has_rejoinder", 1),
      (assign, "$g_comment_has_rejoinder", 0),
      (str_store_string, s9, "$g_rejoinder_to_last_comment"),
    ],
    "{s9}",
    "lord_respond_to_insult",
    [
      (try_begin),
        (troop_get_type, ":var0", "trp_player"),
        (gt, ":var0", 0),
        (372, 43),
      (try_end),
    ]],

  [anyone, "lord_pretalk",
    [
      (lt, "$g_encountered_party_relation", 0),
      (encountered_party_is_attacker),
    ],
    "But enough talking - yield or fight!",
    "party_encounter_lord_hostile_attacker_2",
    []],

  [anyone, "lord_pretalk",
    [],
    "Anything else?",
    "lord_talk",
    []],

  [anyone, "hero_pretalk",
    [],
    "Anything else?",
    "lord_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_resolve_dispute"),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (assign, ":var2", 0),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (quest_slot_eq, "qst_resolve_dispute", 16, 0),
        (assign, "$g_other_lord", ":var1"),
        (assign, ":var2", ":var1"),
      (else_try),
        (eq, ":var1", "$g_talk_troop"),
        (quest_slot_eq, "qst_resolve_dispute", 17, 0),
        (assign, "$g_other_lord", ":var0"),
        (assign, ":var2", ":var0"),
      (try_end),
      (gt, ":var2", 0),
      (str_store_troop_name, s11, "$g_other_lord"),
    ],
    "I wish to address your quarrel with {s11}",
    "lord_quarrel_intervention_1",
    []],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (encountered_party_is_attacker),
      (neg|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Stay your hand! There is something I must say to you in private.",
    "lord_recruit_1_relation",
    []],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_track_down_bandits"),
      (neg|check_quest_succeeded, "qst_track_down_bandits"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 1),
    ],
    "I am hunting a group of bandits with the following description... Have you seen them?",
    "lord_bandit_information",
    []],

  [anyone, "lord_bandit_information",
    [
      (call_script, "script_get_manhunt_information_to_s15", "qst_track_down_bandits"),
    ],
    "{s15}",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_slot_eq, "$players_kingdom", 64, 1),
    ],
    "Who do you think should be made the marshal of our realm?",
    "lord_internal_politics_cur_stance",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_get_slot, ":var0", "$players_kingdom", 64),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (str_store_party_name, s4, ":var0"),
    ],
    "Who do you think should receive the fief of {s4}?",
    "lord_internal_politics_cur_stance",
    []],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s4, ":var0"),
      (str_store_faction_name, s5, "$players_kingdom"),
    ],
    "I need you to renounce your allegiance to {s4} and join the {s5} now, my husband.",
    "lord_husband_auto_recruit",
    []],

  [anyone, "lord_husband_auto_recruit",
    [
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (neg|party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
    ],
    "Ask me again when we are outside of these walls, my wife.",
    "lord_pretalk",
    []],

  [anyone, "lord_husband_auto_recruit",
    [],
    "As you wish, my wife.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_troop_faction", "$g_talk_troop", "$players_kingdom"),
      (try_begin),
        (store_relation, ":var0", "$players_kingdom", "$g_talk_troop_faction"),
        (ge, ":var0", 0),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_lord_recruitment_provokes_home_faction"),
        (try_end),
        (call_script, "script_add_log_entry", 78, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
        (store_add, ":var1", "$players_kingdom", 130),
        (val_sub, ":var1", "fac_player_supporters_faction"),
        (faction_set_slot, "$g_talk_troop_faction", ":var1", 30),
        (faction_get_slot, ":var2", "$g_talk_troop_faction", 11),
        (call_script, "script_troop_change_relation_with_troop", "trp_player", ":var2", -3),
      (try_end),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
        (call_script, "script_change_player_right_to_rule", 5),
      (try_end),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "There is a matter which I would like to discuss in private.",
    "lord_recruit_1_relation",
    []],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (neg|encountered_party_is_attacker),
      (neg|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
    ],
    "There is something which I would like to discuss with to you in private.",
    "lord_recruit_1_relation",
    []],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 51, 1),
      (eq, "$cheat_mode", 1),
    ],
    "CHEAT -- Reset lord decision seed and intrigue impatience",
    "lord_talk",
    [
      (troop_set_slot, "$g_talk_troop", 51, 0),
      (store_random_in_range, ":var0", 0, 9999),
      (troop_set_slot, "$g_talk_troop", 49, ":var0"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$cheat_mode", 1),
    ],
    "CHEAT -- Let's duel (insult)",
    "lord_respond_to_insult_challenge_duel",
    []],

  [anyone, "lord_respond_to_insult",
    [
      (eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_sadistic_admiring"),
    ],
    "Hah! I admire a quick tongue. Perhaps some day I shall remove it, with tongs, to admire it at greater leisure, but today, at least, I shall salute your wit and courage.",
    "lord_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 5),
      (call_script, "script_change_troop_renown", "trp_player", 2),
    ]],

  [anyone, "lord_respond_to_insult",
    [
      (this_or_next|eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_pitiless_admiring"),
      (this_or_next|eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_common_upstanding"),
      (this_or_next|eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_noble_upstanding"),
      (this_or_next|eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_common_martial"),
      (eq, "$g_last_comment_copied_to_s42", "str_comment_intro_female_badtempered_admiring"),
    ],
    "I meant no offense, madame.",
    "lord_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -2),
      (call_script, "script_change_troop_renown", "trp_player", 2),
    ]],

  [anyone, "lord_respond_to_insult",
    [
      (troop_slot_eq, "$g_talk_troop", 10, "$g_encountered_party"),
      (store_party_size_wo_prisoners, ":var0", "$g_talk_troop_party"),
      (store_party_size_wo_prisoners, ":var1", "p_main_party"),
      (val_mul, ":var1", 3),
      (val_div, ":var1", 2),
      (gt, ":var0", ":var1"),
      (neq, "$players_kingdom", "$g_talk_troop_faction"),
    ],
    "Are you trying to provoke me? Well, I would have you know that I am under no obligation to duel women, commoners, rebels, or brigands. I could, however, order my men to seize you and horsewhip you. Would you like them to do that?",
    "lord_respond_to_insult_challenge_battle",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
      (call_script, "script_change_troop_renown", "trp_player", 2),
    ]],

  [anyone, "lord_respond_to_insult",
    [],
    "Are you trying to provoke me? Well, I would have you know that I am under no obligation to duel women, commoners, rebels, or brigands. However, in your case, I would be delighted to make an exception. Are you ready for a lesson in deference to your betters, {reg63?varlot:girl}?",
    "lord_respond_to_insult_challenge_duel",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
      (call_script, "script_change_troop_renown", "trp_player", 2),
    ]],

  [anyone, "lord_respond_to_insult",
    [],
    "Are you trying to provoke me? Well, I would have you know that I am under no obligation to duel women, commoners, rebels, or brigands. You are lucky that I am in a good mood, because I am perfectly within my rights to order my men to seize you and horsewhip you. Now begone -- I have had enough of you.",
    "close_window",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_respond_to_insult_challenge_battle",
    [],
    "I would like to see them try.",
    "lord_respond_to_insult_challenge_battle_confirm",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
      (call_script, "script_change_troop_renown", "trp_player", 3),
    ]],

  [plyr|anyone, "lord_respond_to_insult_challenge_battle",
    [],
    "This is not worth the shedding of blood.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_respond_to_insult_challenge_battle_confirm",
    [],
    "Enough of your insolence! At {reg63?him:her}, lads!",
    "close_window",
    [
      (assign, "$g_private_battle_with_troop", "$g_talk_troop"),
      (assign, "$cant_leave_encounter", 1),
      (assign, "$encountered_party_friendly", 0),
      (jump_to_menu, "mnu_simple_encounter"),
    ]],

  [plyr|anyone, "lord_respond_to_insult_challenge_duel",
    [],
    "I am ready to teach you one.",
    "lord_respond_to_insult_challenge_duel_confirm",
    [
      (str_store_troop_name_link, s13, "$g_talk_troop"),
      (setup_quest_text, "qst_duel_avenge_insult"),
      (str_store_string, s2, "str_you_intend_to_challenge_s13_to_force_him_to_retract_an_insult"),
      (call_script, "script_start_quest", "qst_duel_avenge_insult", "$g_talk_troop"),
      (quest_set_slot, "qst_duel_avenge_insult", 2, "$g_talk_troop"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
    ]],

  [plyr|anyone, "lord_respond_to_insult_challenge_duel",
    [],
    "This is not worth the shedding of blood.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_respond_to_insult_challenge_duel_confirm",
    [],
    "So be it. Defend yourself!",
    "close_window",
    [
      (call_script, "script_set_up_duel_with_troop", "$g_talk_troop"),
    ]],

  [anyone, "lord_quarrel_intervention_1",
    [
      (str_store_string, s14, "str_general_quarrel"),
      (assign, "$temp", "$g_other_lord"),
      (assign, ":var0", 0),
      (store_add, ":var1", "$num_log_entries", 1),
      (try_for_range, ":var2", 1, ":var1"),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 27),
        (troop_slot_eq, "trp_log_array_troop_object", ":var2", "$temp"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_faction_object", ":var2", "$g_talk_troop_faction"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 32),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 33),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 26),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_troop_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 31),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 31),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$temp"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$g_talk_troop"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (call_script, "script_troop_describes_quarrel_with_troop_to_s14", "$g_talk_troop", "$temp"),
      (try_end),
    ],
    "{s14}",
    "lord_quarrel_intervention_2",
    []],

  [plyr|anyone, "lord_quarrel_intervention_2",
    [],
    "Ah, well. It sounds like you're in the right, then.",
    "lord_quarrel_intervention_3a",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_other_lord", -20),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 10),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
        (call_script, "script_add_log_entry", 27, "trp_player", "$g_other_lord", "$g_talk_troop", "fac_player_supporters_faction"),
      (try_end),
      (call_script, "script_finish_quest_simple", "qst_resolve_dispute", 20),
    ]],

  [plyr|anyone, "lord_quarrel_intervention_2",
    [
      (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    ],
    "Whatever your differences, I want you to settle them.",
    "lord_quarrel_intervention_3b",
    []],

  [plyr|anyone, "lord_quarrel_intervention_2",
    [
      (neg|faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    ],
    "Could you not be convinced to settle your differences?",
    "lord_quarrel_intervention_3b",
    []],

  [plyr|anyone, "lord_quarrel_intervention_2",
    [],
    "On second thought, I want nothing to do with this.",
    "lord_pretalk",
    [
      (call_script, "script_abort_quest", "qst_resolve_dispute", 1),
    ]],

  [anyone, "lord_quarrel_intervention_3a",
    [],
    "I'm glad that you think so.",
    "lord_pretalk",
    []],

  [anyone, "lord_quarrel_intervention_3b",
    [
      (store_random_in_range, ":var0", 0, 21),
      (le, ":var0", "$g_talk_troop_effective_relation"),
      (str_store_troop_name, s11, "$g_other_lord"),
    ],
    "For the sake of our friendship, I defer to your judgment. I will try to make amends with {s11}.",
    "lord_quarrel_intervention_4",
    [
      (try_begin),
        (quest_slot_eq, "qst_resolve_dispute", 2, "$g_talk_troop"),
        (quest_set_slot, "qst_resolve_dispute", 16, 1),
      (else_try),
        (quest_slot_eq, "qst_resolve_dispute", 4, "$g_talk_troop"),
        (quest_set_slot, "qst_resolve_dispute", 17, 1),
      (try_end),
    ]],

  [anyone, "lord_quarrel_intervention_3b",
    [
      (str_store_troop_name, s11, "$g_other_lord"),
    ],
    "I will not reconcile with {s11}. I know my rights.",
    "lord_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -15),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_other_lord", 10),
      (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_add_log_entry", 27, "trp_player", "$g_talk_troop", "$g_other_lord", "fac_player_supporters_faction"),
      (try_end),
      (call_script, "script_finish_quest_simple", "qst_resolve_dispute", 30),
    ]],

  [anyone, "lord_quarrel_intervention_4",
    [
      (quest_slot_eq, "qst_resolve_dispute", 17, 1),
      (quest_slot_eq, "qst_resolve_dispute", 16, 1),
    ],
    "Let it be as though our quarrel never occurred.",
    "lord_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "$g_other_lord", 20),
      (call_script, "script_succeed_quest", "qst_resolve_dispute"),
      (call_script, "script_finish_quest_simple", "qst_resolve_dispute", 100),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", 25),
    ]],

  [anyone, "lord_quarrel_intervention_4",
    [
      (str_store_troop_name, s11, "$g_other_lord"),
    ],
    "I suppose that you should speak to {s11}, and see if he will do the same for me.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_cur_stance",
    [
      (troop_slot_eq, "$g_talk_troop", 154, "trp_player"),
    ],
    "I had already made up my mind to support you.",
    "lord_internal_politics_cur_stance_plyr_response",
    []],

  [anyone, "lord_internal_politics_cur_stance",
    [
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", "$g_talk_troop"),
      (eq, reg0, -1),
    ],
    "I am unable to decide at this time",
    "lord_internal_politics_cur_stance_plyr_response",
    []],

  [anyone, "lord_internal_politics_cur_stance",
    [],
    "I support {s15}. {s10}",
    "lord_internal_politics_cur_stance_plyr_response",
    [
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (troop_set_slot, "$g_talk_troop", 154, ":var0"),
      (str_store_string, s10, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_talk_troop"),
        (str_clear, s10),
      (try_end),
      (call_script, "script_troop_describes_troop_to_s15", "$g_talk_troop", ":var0"),
    ]],

  [plyr|anyone, "lord_internal_politics_cur_stance_plyr_response",
    [
      (troop_slot_eq, "trp_player", 154, -1),
      (eq, "$player_has_homage", 1),
    ],
    "Let me tell you whom I support...",
    "lord_internal_politics_plyr_choose_candidate",
    []],

  [plyr|anyone, "lord_internal_politics_cur_stance_plyr_response",
    [
      (eq, "$cheat_mode", 1),
      (eq, "$player_has_homage", 1),
    ],
    "CHEAT -- Reset support",
    "lord_internal_politics_cur_stance_plyr_response",
    [
      (troop_set_slot, "trp_player", 154, -1),
    ]],

  [anyone, "lord_internal_politics_plyr_choose_candidate",
    [],
    "Whom do you support?",
    "lord_internal_politics_plyr_choose_candidate_select",
    []],

  [plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [],
    "I would like to nominate myself for that honor",
    "lord_internal_politics_pretalk",
    [
      (troop_set_slot, "trp_player", 154, "trp_player"),
    ]],

  [plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [
      (troop_get_slot, ":var0", "trp_player", 30),
      (neq, ":var0", "$g_talk_troop"),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "$players_kingdom"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I support my husband, {s4}",
    "lord_internal_politics_pretalk",
    [
      (troop_get_slot, ":var0", "trp_player", 30),
      (troop_set_slot, "trp_player", 154, ":var0"),
    ]],

  [plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [
      (str_store_troop_name, s4, "$g_talk_troop"),
    ],
    "I would support you, {s4}",
    "lord_internal_politics_support_acknowledge",
    []],

  [plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (str_store_troop_name, s4, ":var0"),
      (neq, ":var0", "$g_talk_troop"),
    ],
    "I would support your choice, {s4}",
    "lord_internal_politics_support_same_acknowledge",
    []],

  [plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [],
    "Never mind",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_support_acknowledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (neq, "$g_talk_troop", ":var0"),
    ],
    "That is most gracious of you, but I do not seek the honor, and I decline your support.",
    "lord_pretalk",
    [
      (troop_set_slot, "trp_player", 154, -1),
    ]],

  [anyone, "lord_internal_politics_support_acknowledge",
    [
      (lt, "$g_talk_troop_effective_relation", -5),
    ],
    "I do not trust you, and I do not need your support.",
    "lord_pretalk",
    [
      (troop_set_slot, "trp_player", 154, -1),
    ]],

  [anyone, "lord_internal_politics_support_acknowledge",
    [],
    "That is most gracious of you",
    "lord_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 3),
      (troop_set_slot, "trp_player", 154, "$g_talk_troop"),
    ]],

  [anyone, "lord_internal_politics_support_same_acknowledge",
    [
      (lt, "$g_talk_troop_effective_relation", -5),
    ],
    "You may tell him that yourself. I do not trust you, and I will have no part in any game you are playing.",
    "lord_pretalk",
    [
      (troop_set_slot, "trp_player", 154, -1),
    ]],

  [anyone, "lord_internal_politics_support_same_acknowledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
      (lt, reg0, -5),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Given your relation with {s4}, I do not think that he would welcome your support.",
    "lord_pretalk",
    [
      (troop_set_slot, "trp_player", 154, -1),
    ]],

  [anyone, "lord_internal_politics_support_same_acknowledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I will tell {s4}. He will no doubt be grateful for your support.",
    "lord_pretalk",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", ":var0", 2),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 1),
      (troop_set_slot, "trp_player", 154, ":var0"),
    ]],

  [repeat_for_troops|plyr|anyone, "lord_internal_politics_plyr_choose_candidate_select",
    [
      (store_repeat_object, ":var0"),
      (eq, 1, 0),
      (troop_slot_eq, ":var0", 2, 2),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "$players_kingdom"),
      (neg|troop_slot_eq, "trp_player", 30, ":var0"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I support {s4}",
    "lord_internal_politics_pretalk",
    [
      (store_repeat_object, ":var0"),
      (troop_set_slot, "trp_player", 154, ":var0"),
    ]],

  [anyone, "lord_internal_politics_pretalk",
    [],
    "Ah. Most interesting.",
    "lord_internal_politics_cur_stance_plyr_response",
    []],

  [plyr|anyone, "lord_internal_politics_cur_stance_plyr_response",
    [
      (eq, "$player_has_homage", 1),
      (neg|troop_slot_eq, "$g_talk_troop", 154, "$g_talk_troop"),
      (neg|troop_slot_ge, "trp_player", 154, "trp_npc_adonja"),
      (neg|troop_slot_eq, "$g_talk_troop", 154, "trp_player"),
    ],
    "Can I convince you to support me instead?",
    "lord_internal_politics_plyr_request_support",
    []],

  [plyr|anyone, "lord_internal_politics_cur_stance_plyr_response",
    [],
    "Anyway, enough of politics for the time being.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [
      (troop_slot_ge, "trp_player", 150, 25),
      (this_or_next|faction_slot_eq, "$players_kingdom", 64, 1),
      (troop_slot_ge, "trp_player", 150, 50),
    ],
    "You have engendered too much controversy to be a viable candidate right now. I would advise you to wait a little while before seeking any further honors for yourself.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (gt, ":var0", 0),
      (str_store_troop_name, s4, ":var0"),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (ge, reg0, "$g_talk_troop_effective_relation"),
    ],
    "I am sorry. I would not wish to strain my relationship with {s4}.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 64),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (troop_get_slot, ":var1", "trp_player", 7),
      (assign, ":var2", ":var1"),
      (try_for_range, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (store_troop_faction, ":var4", ":var3"),
        (eq, ":var4", "$players_kingdom"),
        (troop_get_slot, ":var5", ":var3", 7),
        (val_add, ":var2", ":var5"),
      (try_end),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (try_for_range, ":var8", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var9", ":var8"),
        (eq, ":var9", "$players_kingdom"),
        (assign, ":var10", 1),
        (try_begin),
          (is_between, ":var8", "p_town_1", "p_castle_1"),
          (assign, ":var10", 2),
        (try_end),
        (val_add, ":var6", ":var10"),
        (party_slot_eq, ":var8", 7, "trp_player"),
        (val_add, ":var7", ":var10"),
      (try_end),
      (val_max, ":var6", 1),
      (val_max, ":var7", 1),
      (store_div, ":var11", ":var2", ":var6"),
      (store_div, ":var12", ":var1", ":var7"),
      (store_mul, ":var13", ":var11", 3),
      (val_div, ":var13", 4),
      (lt, ":var12", ":var13"),
    ],
    "You have already been well-rewarded with fiefs appropriate to your accomplishments, I would say.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [
      (faction_slot_eq, "$players_kingdom", 64, 1),
      (troop_get_slot, ":var0", "trp_player", 7),
      (lt, ":var0", 400),
    ],
    "I think you would need to prove yourself further before you are eligible for that position.",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [
      (lt, "$g_talk_troop_effective_relation", 10),
    ],
    "Hmm... That is too much to ask, given the state of our relationship. ",
    "lord_pretalk",
    []],

  [anyone, "lord_internal_politics_plyr_request_support",
    [],
    "I would support you with pleasure. ",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 154, "trp_player"),
    ]],

  [anyone, "lord_internal_politics_plyr_request_support",
    [],
    "{!}[Placeholder - sorry, not yet]",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_1_relation",
    [
      (troop_slot_ge, "$g_talk_troop", 51, 100),
    ],
    "I am a bit weary of talking politics. Perhaps at a later date",
    "lord_pretalk",
    [
      (troop_get_slot, reg3, "$g_talk_troop", 51),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "str_intrigue_impatience=_reg3_must_be_less_than_100"),
      (try_end),
    ]],

  [anyone, "lord_recruit_1_relation",
    [
      (assign, ":var0", 1),
      (try_begin),
        (call_script, "script_cf_troop_can_intrigue", "$g_talk_troop", 1),
        (assign, ":var0", 0),
      (try_end),
      (eq, ":var0", 1),
      (str_store_string, s12, "str_youll_have_to_speak_to_me_at_some_other_time_then"),
      (try_begin),
        (lt, "$g_encountered_party_relation", 0),
        (encountered_party_is_attacker),
        (str_store_string, s12, "str_this_is_no_time_for_words"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "str_lord_not_alone"),
      (try_end),
    ],
    "{s12}",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_1_relation",
    [
      (is_between, "$supported_pretender", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (troop_slot_eq, "$supported_pretender", 14, "$g_talk_troop_faction"),
      (troop_get_type, reg3, "$supported_pretender"),
      (str_store_troop_name, s16, "$supported_pretender"),
      (eq, "$skip_lord_assumes_argument", 0),
    ],
    "You have raised the standard of rebellion on behalf of {s16}. Have you come to plead {reg3?her:his} case?",
    "lord_recruit_pretender",
    []],

  [plyr|anyone, "lord_recruit_pretender",
    [],
    "I have",
    "lord_recruit_3_dilemma_1",
    [
      (troop_set_slot, "$g_talk_troop", 54, "$supported_pretender"),
    ]],

  [plyr|anyone, "lord_recruit_pretender",
    [],
    "No, that's not it. There's another issue I wish to discuss.",
    "lord_recruit_1_relation",
    [
      (assign, "$skip_lord_assumes_argument", 1),
    ]],

  [anyone, "lord_recruit_1_relation",
    [
      (try_begin),
        (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
        (assign, ":var0", 20),
        (str_store_string, s13, "str_of_course_my_wife"),
        (str_store_string, s14, "str_perhaps_not_our_marriage_has_become_a_bit_strained_dont_you_think"),
        (str_store_string, s15, "str_why_is_that_my_wife_actually_our_marriage_has_become_such_that_i_prefer_to_have_a_witness_for_all_of_our_converations"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (assign, ":var0", 6),
        (str_store_string, s13, "str_all_right_then_what_do_you_have_to_say_out_with_it"),
        (str_store_string, s14, "str_bah__im_in_no_mood_for_whispering_in_the_corner"),
        (str_store_string, s15, "str_bah_i_dont_like_you_that_much_im_not_going_to_go_plot_with_you_in_some_corner"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 5),
        (assign, ":var0", 8),
        (str_store_string, s13, "str_well__now_what_do_you_have_to_propose"),
        (str_store_string, s14, "str_trying_our_hand_at_intrigue_are_we_i_think_not"),
        (str_store_string, s15, "str_hah_i_trust_you_as_a_i_would_a_serpent_i_think_not"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 7),
        (assign, ":var0", -10),
        (str_store_string, s13, "str_i_do_not_like_to_conduct_my_business_in_the_shadows_but_sometimes_it_must_be_done_what_do_you_have_to_say"),
        (str_store_string, s14, "str_i_would_prefer_to_conduct_our_affairs_out_in_the_open"),
        (str_store_string, s15, "str_do_not_take_this_amiss_but_with_you_i_would_prefer_to_conduct_our_affairs_out_in_the_open"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 4),
        (assign, ":var0", 4),
        (str_store_string, s13, "str_hmm_you_have_piqued_my_interest_what_do_you_have_to_say"),
        (str_store_string, s14, "str_em_lets_keep_our_affairs_out_in_the_open_for_the_time_being"),
        (str_store_string, s15, "str_em_lets_keep_our_affairs_out_in_the_open_for_the_time_being"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 3),
        (assign, ":var0", 0),
        (str_store_string, s13, "str_thats_sensible__the_world_is_full_of_churls_who_poke_their_noses_into_their_betters_business_now_tell_me_what_it_is_that_you_have_to_say"),
        (str_store_string, s14, "str_what_do_you_take_me_for_a_plotter"),
        (str_store_string, s15, "str_hah_i_trust_you_as_a_i_would_a_serpent_i_think_not"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 6),
        (assign, ":var0", -10),
        (str_store_string, s13, "str_well_i_normally_like_to_keep_things_out_in_the_open_but_im_sure_someone_like_you_would_not_want_to_talk_in_private_unless_heshe_had_a_good_reason_what_is_it"),
        (str_store_string, s14, "str_surely_we_can_discuss_whatever_you_want_to_discuss_out_here_in_the_open_cant_we"),
        (str_store_string, s15, "str_surely_we_can_discuss_whatever_you_want_to_discuss_out_here_in_the_open_cant_we"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 1),
        (assign, ":var0", -5),
        (str_store_string, s13, "str_im_a_simple__man_not_one_for_intrigue_but_id_guess_that_you_have_something_worthwhile_to_say_what_is_it"),
        (str_store_string, s14, "str_forgive_me_but_im_not_one_for_going_off_in_corners_to_plot"),
        (str_store_string, s15, "str_please_do_not_take_this_amiss_but_i_do_not_trust_you"),
      (else_try),
        (troop_slot_ge, "$g_talk_troop", 52, 8),
        (assign, ":var0", 10),
        (str_store_string, s13, "str_certainly_playername_what_is_it"),
        (str_store_string, s14, "str_forgive_me_but_id_prefer_to_keep_our_conversations_in_the_open"),
        (str_store_string, s15, "str_please_do_not_take_this_amiss_but_im_not_sure_you_and_i_are_still_on_those_terms"),
      (try_end),
      (assign, ":var1", 0),
      (store_skill_level, ":var2", skl_persuasion, "trp_player"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_persuasion__relation_less_than_5"),
        (try_end),
        (str_store_string, s12, "str_s15"),
      (else_try),
        (store_add, ":var3", ":var2", "$g_talk_troop_relation"),
        (val_add, ":var3", ":var0"),
        (266, ":var4"),
        (try_begin),
          (eq, ":var4", 0),
          (val_sub, ":var3", 5),
        (else_try),
          (eq, ":var4", 1),
        (else_try),
          (eq, ":var4", 2),
          (val_add, ":var3", 5),
        (try_end),
        (lt, ":var3", 10),
        (str_store_string, s12, "str_s14"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_persuasion__2__lord_reputation_modifier__relation_less_than_10"),
        (try_end),
        (str_store_string, s12, "str_s14"),
      (else_try),
        (str_store_string, s12, "str_s13"),
        (assign, ":var1", 1),
      (try_end),
      (eq, ":var1", 0),
    ],
    "{s12}",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_1_relation",
    [],
    "{s12}",
    "lord_recruit_2",
    []],

  [plyr|anyone, "lord_recruit_2",
    [],
    "What do you think, in general terms, about kings, lords, and politics?",
    "lord_recruit_2_philosophy",
    []],

  [plyr|anyone, "lord_recruit_2",
    [
      (troop_slot_eq, "$g_talk_troop", 30, "trp_player"),
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
      (troop_get_type, ":var0", "$g_talk_troop"),
      (eq, ":var0", 0),
      (faction_get_slot, ":var1", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s11, ":var1"),
    ],
    "My husband, I believe that you should rethink you allegiance to {s11}",
    "lord_spouse_leave_faction",
    []],

  [anyone, "lord_spouse_leave_faction",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (gt, reg0, 25),
      (str_store_troop_name, s9, ":var0"),
    ],
    "{s9} has always been a good liege to me, but I will hear you out. What do you suggest we do?",
    "lord_spouse_leave_faction_2",
    []],

  [anyone, "lord_spouse_leave_faction",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (gt, reg0, -5),
      (str_store_troop_name, s9, ":var0"),
    ],
    "I see no particular reason to abandon {s9}, but I will heed your advice. What do you suggest we do?",
    "lord_spouse_leave_faction_2",
    []],

  [anyone, "lord_spouse_leave_faction",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (str_store_troop_name, s9, ":var0"),
    ],
    "Yes -- as a liege, {s9} is a great disappointment. What do you suggest we do?",
    "lord_spouse_leave_faction_2",
    []],

  [plyr|anyone, "lord_spouse_leave_faction_2",
    [],
    "I believe you should be king, my husband!",
    "lord_spouse_leave_faction_husband_king",
    []],

  [plyr|anyone, "lord_spouse_leave_faction_2",
    [],
    "I am the rightful queen of Pendor",
    "lord_spouse_leave_faction_proclaim_queen",
    []],

  [plyr|anyone, "lord_spouse_leave_faction_2",
    [],
    "Never mind",
    "lord_pretalk",
    []],

  [anyone, "lord_spouse_leave_faction_husband_king",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_village_1"),
        (this_or_next|party_slot_eq, ":var1", 7, "trp_player"),
        (party_slot_eq, ":var1", 7, "$g_talk_troop"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "Perhaps some day, my wife -- but before I declare myself king, I should like for one of us to hold a fortress which could serve as our court before we declare ourselves publically.",
    "lord_pretalk",
    []],

  [anyone, "lord_spouse_leave_faction_proclaim_queen",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_village_1"),
        (this_or_next|party_slot_eq, ":var1", 7, "trp_player"),
        (party_slot_eq, ":var1", 7, "$g_talk_troop"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "While I do not contest your claim, my wife, I should like for one of us to hold a fortress which could serve as our court before we declare ourselves publically.",
    "lord_pretalk",
    []],

  [anyone, "lord_spouse_leave_faction_proclaim_queen",
    [
      (assign, ":var0", 0),
      (try_begin),
        (le, "$player_right_to_rule", 5),
        (str_store_string, s11, "str_really_well_this_is_the_first_i_have_heard_of_it_unless_you_build_up_support_for_that_claim_you_may_find_it_difficult_to_find_allies_however_whenever_you_see_fit_to_declare_yourself_publically_as_queen_i_should_be_honored_to_be_your_consort"),
        (assign, "$player_right_to_rule", 5),
      (else_try),
        (lt, "$player_right_to_rule", 20),
        (str_store_string, s11, "str_yes_i_have_heard_such_talk_while_it_is_good_that_you_are_building_up_your_support_i_do_not_think_that_you_are_quite_ready_to_proclaim_yourself_yet_however_i_will_let_you_be_the_judge_of_that_and_when_you_decide_i_should_be_honored_to_be_your_consort"),
      (else_try),
        (str_store_string, s11, "str_yes_and_many_others_in_calradia_think_so_as_well_perhaps_it_is_time_that_you_declared_yourself_and_we_shall_ride_forth_together_to_claim_your_throne_i_should_be_honored_to_be_your_consort"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "{s11}",
    "lord_spouse_leave_faction_proclaim_queen_confirm",
    []],

  [anyone, "lord_spouse_leave_faction_proclaim_queen",
    [],
    "{s11}",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_spouse_leave_faction_proclaim_queen_confirm",
    [],
    "I am ready now, my husband. Let us go forth to seek our throne.",
    "close_window",
    [
      (call_script, "script_activate_player_faction", "trp_player"),
      (call_script, "script_change_troop_faction", "$g_talk_troop", "fac_player_supporters_faction"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_spouse_leave_faction_proclaim_queen_confirm",
    [],
    "Perhaps I am not yet ready.",
    "lord_pretalk",
    []],

  [anyone, "lord_spouse_leave_faction_husband_king",
    [
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (gt, "$supported_pretender", 0),
      (str_store_troop_name, s4, "$supported_pretender"),
    ],
    "Perhaps, but I would need your full support to press that claim. You would want to resolve {s4}'s rebellion before pushing this any further.",
    "lord_pretalk",
    []],

  [anyone, "lord_spouse_leave_faction_husband_king",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Most of the great families of this land have a claim to the throne... Given the recent issues with the succession, I should be as legitimate a king as {s4}. ",
    "lord_spouse_leave_faction_husband_king_2",
    []],

  [anyone, "lord_spouse_leave_faction_husband_king_2",
    [],
    "While king, I will defer to your judgment in the appointment of ministers, the conduct of diplomacy, and other such matters.",
    "lord_spouse_leave_faction_husband_king_3",
    []],

  [plyr|anyone, "lord_spouse_leave_faction_husband_king_3",
    [],
    "Very well, my husband. Let us ride forth to press your claim! ",
    "close_window",
    [
      (call_script, "script_change_troop_faction", "$g_talk_troop", "fac_player_supporters_faction"),
      (call_script, "script_activate_player_faction", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_spouse_leave_faction_husband_king_3",
    [],
    "Actually, let us bide our time for a bit.",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_2_philosophy",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_political_philosophy_default"),
    ],
    "{s43} Did you wish to speak of anything else?",
    "lord_recruit_2",
    []],

  [plyr|anyone, "lord_recruit_2",
    [
      (troop_slot_eq, "$g_talk_troop", 50, 0),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (neq, "$g_talk_troop", ":var0"),
      (neq, "trp_player", ":var0"),
      (str_store_troop_name, s15, ":var0"),
    ],
    "How do you feel about {s15}?",
    "lord_recruit_2_discontent",
    []],

  [plyr|anyone, "lord_recruit_2",
    [
      (troop_slot_ge, "$g_talk_troop", 53, 1),
      (neq, "$g_talk_troop_faction", "$players_kingdom"),
    ],
    "Do you remember what I had told you earlier?",
    "lord_recruit_3_a",
    []],

  [repeat_for_troops|plyr|anyone, "lord_recruit_2",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, ":var1", "$g_talk_troop_faction"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, ":var0"),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (lt, reg0, -9),
      (str_store_troop_name, s16, ":var0"),
    ],
    "I have heard that you have quarreled with {s16}",
    "lord_recruit_quarrel_describe",
    [
      (store_repeat_object, "$temp"),
    ]],

  [anyone, "lord_recruit_quarrel_describe",
    [
      (assign, ":var0", 0),
      (store_add, ":var1", "$num_log_entries", 1),
      (try_for_range, ":var2", 1, ":var1"),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 27),
        (troop_slot_eq, "trp_log_array_troop_object", ":var2", "$temp"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_faction_object", ":var2", "$g_talk_troop_faction"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 32),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 33),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 26),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_troop_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 31),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$temp"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var2", 31),
        (troop_slot_eq, "trp_log_array_actor", ":var2", "$temp"),
        (troop_slot_eq, "trp_log_array_center_object", ":var2", "$g_talk_troop"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var2"),
        (str_store_string, s14, reg0),
        (assign, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (call_script, "script_troop_describes_quarrel_with_troop_to_s14", "$g_talk_troop", "$temp"),
      (try_end),
      (call_script, "script_add_rumor_string_to_troop_notes", "$g_talk_troop", "$temp", 14),
    ],
    "It is no secret. {s14}",
    "lord_recruit_2",
    []],

  [plyr|anyone, "lord_recruit_2",
    [],
    "Never mind",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_2_discontent",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (call_script, "script_calculate_troop_political_factors_for_liege", "$g_talk_troop", ":var0"),
      (assign, ":var1", reg3),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "@{!}DEBUG : result for political is {reg3}"),
      (try_end),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (assign, ":var2", reg0),
      (str_store_troop_name, s15, ":var0"),
      (troop_get_type, reg15, ":var0"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 7),
        (assign, ":var3", -5),
        (str_store_string, s12, "str_i_am_disturbed_about_my_lord_s15s_choice_of_companions"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 1),
        (assign, ":var3", -1),
        (str_store_string, s12, "str_well_ill_be_honest_i_feel_that_sometimes_s15_overlooks_my_rights_and_extends_his_protection_to_the_unworthy"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (assign, ":var3", 5),
        (str_store_string, s12, "str_heh_one_thing_that_ill_say_about_s15_is_that_he_has_a_ripe_batch_of_bastards_in_his_court"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 6),
        (assign, ":var3", -4),
        (str_store_string, s12, "str_well_sometimes_i_have_to_say_that_i_question_s15s_judgment_regarding_those_who_he_keeps_in_his_court"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 3),
        (assign, ":var3", 1),
        (str_store_string, s12, "str_s15_is_a_weak_man_who_too_easily_lends_his_ear_to_evil_council_and_gives_his_protection_to_some_who_have_done_me_wrong"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 4),
        (assign, ":var3", 3),
        (str_store_string, s12, "str_i_will_confess_that_sometimes_i_worry_about_s15s_judgment_particularly_in_the_matter_of_the_counsel_that_he_keeps"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 5),
        (assign, ":var3", 5),
        (str_store_string, s12, "str_what_do_i_think_i_think_that_s15_is_a_vile_pretender_a_friend_to_the_flatterer_and_the_hypocrite"),
      (else_try),
        (troop_slot_ge, "$g_talk_troop", 52, 8),
        (assign, ":var3", 5),
        (str_store_string, s12, "str_well_s15_is_not_like_you_ill_say_that_much"),
      (try_end),
      (store_add, ":var4", "$num_log_entries", 1),
      (try_for_range, ":var5", 1, ":var4"),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 27),
        (troop_slot_eq, "trp_log_array_actor", ":var5", ":var0"),
        (troop_slot_eq, "trp_log_array_center_object", ":var5", "$g_talk_troop"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var5"),
        (str_store_string, s12, reg0),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 32),
        (troop_slot_eq, "trp_log_array_actor", ":var5", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_troop_object", ":var5", ":var0"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var5"),
        (str_store_string, s12, reg0),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 33),
        (troop_slot_eq, "trp_log_array_actor", ":var5", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_troop_object", ":var5", ":var0"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var5"),
        (str_store_string, s12, reg0),
      (else_try),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 26),
        (troop_slot_eq, "trp_log_array_actor", ":var5", "$g_talk_troop"),
        (troop_slot_eq, "trp_log_array_faction_object", ":var5", "$g_talk_troop_faction"),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var5"),
        (str_store_string, s12, reg0),
      (try_end),
      (val_mul, ":var3", 2),
      (assign, "$lord_might_open_up", 0),
      (try_begin),
        (gt, ":var1", 12),
        (gt, ":var2", 0),
        (str_store_string, s12, "str_s15_long_may_he_live"),
      (else_try),
        (ge, ":var1", ":var3"),
        (str_store_string, s12, "str_he_is_my_liege_that_is_all_that_i_will_say_on_this_matter"),
        (assign, "$lord_might_open_up", 1),
      (try_end),
      (lt, ":var1", ":var3"),
      (call_script, "script_add_rumor_string_to_troop_notes", "$g_talk_troop", ":var0", 12),
    ],
    "{s12}",
    "lord_recruit_2_discontent_b",
    []],

  [anyone, "lord_recruit_2_discontent",
    [],
    "{s12}",
    "lord_recruit_hesitant",
    []],

  [anyone, "lord_recruit_2_discontent_b",
    [],
    "Sometimes, I do worry about the state of the realm.",
    "lord_recruit_3",
    []],

  [plyr|anyone, "lord_recruit_hesitant",
    [
      (eq, "$lord_might_open_up", 1),
    ],
    "Can't I persuade you to say a little more?",
    "lord_recruit_hesitant_persuade",
    []],

  [plyr|anyone, "lord_recruit_hesitant",
    [],
    "Ah. Very good.",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_hesitant_persuade",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (call_script, "script_calculate_troop_political_factors_for_liege", "$g_talk_troop", ":var0"),
      (assign, ":var1", reg3),
      (store_sub, ":var2", 12, ":var1"),
      (assign, reg3, ":var2"),
      (val_div, ":var2", 3),
      (store_sub, ":var3", 14, ":var2"),
      (troop_get_slot, ":var4", "$g_talk_troop", 49),
      (store_mod, ":var5", ":var4", ":var3"),
      (val_sub, ":var5", 2),
      (store_skill_level, ":var6", skl_persuasion, "trp_player"),
      (lt, ":var5", ":var6"),
    ],
    "If you put it that way, I admit that I do sometimes worry about the state of the realm.",
    "lord_recruit_3",
    []],

  [anyone, "lord_recruit_hesitant_persuade",
    [
      (troop_set_slot, "$g_talk_troop", 51, 100),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -1),
    ],
    "You try my patience. I said that I have nothing to say.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_recruit_3",
    [],
    "Well, I have something to tell you.",
    "lord_recruit_3_a",
    []],

  [plyr|anyone, "lord_recruit_3",
    [],
    "Well, that's interesting to know. But enough about politics.",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_3_a",
    [
      (troop_slot_ge, "$g_talk_troop", 53, 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_troop_name, s14, ":var0"),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s14, "@you"),
      (try_end),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 53, 1),
        (eq, ":var0", "trp_player"),
        (str_store_string, s12, "str_that_you_are_the_rightful_heir_to_the_throne_of_calradia"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 1),
        (str_store_troop_name, s14, ":var0"),
        (str_store_string, s12, "str_that_s14_is_the_rightful_ruler_of_calradia"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 2),
        (str_store_string, s12, "str_that_s14_will_rule_this_land_justly"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 5),
        (str_store_string, s12, "str_that_s14_will_protect_our_rights_as_nobles"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 4),
        (str_store_string, s12, "str_that_s14_will_unify_this_land_and_end_this_war"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 3),
        (str_store_string, s12, "str_that_s14_will_reward_me_with_a_fief"),
      (try_end),
    ],
    "{s12}",
    "lord_recruit_3_reset_claim",
    []],

  [plyr|anyone, "lord_recruit_3_reset_claim",
    [],
    "Yes, that's it.",
    "lord_recruit_3_claim",
    []],

  [plyr|anyone, "lord_recruit_3_reset_claim",
    [],
    "Let me phrase that a little differently.",
    "lord_recruit_3_a_reset",
    []],

  [anyone, "lord_recruit_3_a",
    [],
    "Yes?",
    "lord_recruit_3_b",
    []],

  [anyone, "lord_recruit_3_a_reset",
    [],
    "Yes?",
    "lord_recruit_3_b",
    []],

  [plyr|anyone, "lord_recruit_3_b",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (eq, ":var0", "trp_player"),
    ],
    "I ask for your support for the throne of Pendor",
    "lord_recruit_3_why",
    [
      (troop_set_slot, "$g_talk_troop", 54, "trp_player"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 50, 0),
        (troop_get_slot, ":var0", "$g_talk_troop", 49),
        (store_div, ":var1", ":var0", 100),
        (val_add, ":var1", 1),
        (troop_set_slot, "$g_talk_troop", 50, ":var1"),
      (try_end),
    ]],

  [plyr|anyone, "lord_recruit_3_b",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (neq, ":var0", "trp_player"),
      (neq, "$players_kingdom", "$g_talk_troop_faction"),
      (str_store_troop_name, s45, ":var0"),
    ],
    "I ask you to pledge allegiance to my liege, {s45}, as monarch of all Pendor",
    "lord_recruit_3_why",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (troop_set_slot, "$g_talk_troop", 54, ":var0"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 50, 0),
        (troop_get_slot, ":var1", "$g_talk_troop", 49),
        (store_div, ":var2", ":var1", 100),
        (val_add, ":var2", 1),
        (troop_set_slot, "$g_talk_troop", 50, ":var2"),
      (try_end),
    ]],

  [plyr|anyone, "lord_recruit_3_b",
    [],
    "Never mind",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_3_dilemma_1",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_troop_name, s45, ":var0"),
      (troop_get_type, reg3, ":var0"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s46, ":var1"),
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_rebellion_dilemma_default"),
    ],
    "{s43}",
    "lord_recruit_3_dilemma_2",
    []],

  [anyone, "lord_recruit_3_dilemma_2",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_rebellion_dilemma_2_default"),
    ],
    "{s43}",
    "lord_recruit_3_why",
    []],

  [anyone, "lord_recruit_3_why",
    [
      (troop_slot_eq, "$g_talk_troop", 54, "trp_player"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_village_1"),
        (this_or_next|party_slot_eq, ":var1", 7, "$g_talk_troop"),
        (party_slot_eq, ":var1", 7, "trp_player"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "Neither of us has so much as a single fortress to our name. Would you rule your kingdom from an outlaw's den in the woods?",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_3_why",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s44, "@you"),
      (else_try),
        (str_store_troop_name, s44, ":var0"),
      (try_end),
    ],
    "Why should I support {s44}?",
    "lord_recruit_3_d",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (try_begin),
        (troop_get_type, ":var1", ":var0"),
        (str_store_string, s45, "str_he"),
        (str_store_string, s47, "str_king"),
        (try_begin),
          (gt, ":var1", 0),
          (str_store_string, s45, "str_she"),
          (str_store_string, s47, "str_queen"),
        (try_end),
        (try_begin),
          (eq, ":var0", "$supported_pretender"),
          (eq, "$supported_pretender_old_faction", "fac_kingdom_3"),
          (str_store_string, s47, "str_khan"),
        (try_end),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (str_store_string, s45, "str_i"),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_string, s43, "str_according_to_the_ancient_law_and_custom_of_the_calradians_s45_should_be_s47"),
      (try_begin),
        (gt, "$supported_pretender", 0),
        (eq, ":var0", "$supported_pretender"),
        (str_store_faction_name, s46, "$supported_pretender_old_faction"),
        (str_store_string, s43, "str_because_s44_is_the_rightful_s47_of_the_s46"),
      (try_end),
    ],
    "{s43}",
    "lord_recruit_3_claim",
    [
      (troop_set_slot, "$g_talk_troop", 53, 1),
      (val_add, "$claim_arguments_made", 1),
      (assign, "$opposed_arguments_made", "$victory_arguments_made"),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [],
    "If {s45} were {s47}, {s45} would deal with all men fairly and uphold the rights of the commons.",
    "lord_recruit_3_claim",
    [
      (troop_set_slot, "$g_talk_troop", 53, 2),
      (val_add, "$ruler_arguments_made", 1),
      (assign, "$opposed_arguments_made", "$lords_arguments_made"),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [],
    "If {s45} were {s47}, {s45} would uphold your ancient rights as a noble of this land.",
    "lord_recruit_3_claim",
    [
      (troop_set_slot, "$g_talk_troop", 53, 5),
      (val_add, "$lords_arguments_made", 1),
      (assign, "$opposed_arguments_made", "$ruler_arguments_made"),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [],
    "Because {s45} can unify Pendor and end this discord.",
    "lord_recruit_3_claim",
    [
      (troop_set_slot, "$g_talk_troop", 53, 4),
      (val_add, "$victory_arguments_made", 1),
      (assign, "$opposed_arguments_made", "$claim_arguments_made"),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [],
    "Because {s45} will reward you with lands.",
    "lord_recruit_3_claim",
    [
      (troop_set_slot, "$g_talk_troop", 53, 3),
      (val_add, "$benefit_arguments_made", 1),
    ]],

  [plyr|anyone, "lord_recruit_3_d",
    [],
    "Never mind",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 50, 0),
    ]],

  [anyone, "lord_recruit_3_claim",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 53, 3),
      (gt, "$opposed_arguments_made", 0),
      (troop_get_slot, ":var0", "$g_talk_troop", 50),
      (store_mul, ":var1", "$opposed_arguments_made", 10),
      (val_add, ":var1", ":var0"),
      (gt, ":var1", 100),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 53, 1),
        (str_store_string, s12, "str_you_speak_of_claims_and_legalities_yet_to_others_you_talk_of_bringing_peace_by_force"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 4),
        (str_store_string, s12, "str_you_speak_of_bringing_peace_by_force_yet_to_others_you_make_legal_claims"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 2),
        (str_store_string, s12, "str_you_speak_to_some_of_upholding_the_rights_of_the_commons_yet_you_speak_to_others_of_uphold_the_rights_of_nobles_what_if_those_rights_are_in_conflict"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 53, 5),
        (str_store_string, s12, "str_you_speak_to_me_of_upholding_my_rights_as_a_lord_but_to_others_you_talk_of_upholding_the_rights_of_all_commons_what_if_those_rights_come_into_conflict"),
      (try_end),
    ],
    "Do you perhaps tell each person what you think they most want to hear? {s12}",
    "lord_recruit_3_claim",
    [
      (assign, "$opposed_arguments_made", -1),
    ]],

  [anyone, "lord_recruit_3_claim",
    [
      (assign, "$g_persuasion_trump_used", 0),
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (assign, ":var1", 0),
      (str_store_string, s12, "str_a_claim_should_be_strong_indeed_before_one_starts_talking_about_it"),
      (try_begin),
        (neq, ":var0", "trp_player"),
        (str_store_string, s12, "str_indeed_please_continue"),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 1),
        (str_store_string, s12, "str_a_claim_should_be_strong_indeed_before_one_starts_talking_about_it"),
        (ge, "$player_right_to_rule", 10),
        (str_store_string, s12, "str_a_king_should_prove_his_valor_beyond_any_doubt_before_he_starts_talking_about_a_claim_to_the_throne"),
        (troop_slot_ge, ":var0", 7, 400),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 6),
        (str_store_string, s12, "str_you_must_prove_yourself_a_great_warrior_before_men_will_follow_you_as_king"),
        (troop_slot_ge, ":var0", 7, 200),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 7),
        (str_store_string, s12, "str_a_claim_to_the_throne_should_be_strong_indeed_before_one_presses_it"),
        (ge, "$player_right_to_rule", 20),
        (str_store_string, s12, "str_indeed_but_a_man_must_also_prove_himself_a_great_warrior_before_men_will_follow_you_as_king"),
        (troop_slot_ge, ":var0", 7, 200),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (str_store_string, s12, "str_my_pigherd_can_declare_himself_king_if_he_takes_he_fancy_i_think_you_need_to_break_a_few_more_heads_on_tbe_battlefield_before_men_will_follow_you"),
        (troop_slot_ge, ":var0", 7, 200),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 3),
        (str_store_string, s12, "str_if_you_do_not_wish_to_die_on_a_scaffold_like_so_many_failed_pretenders_before_you_i_would_suggest_that_you_to_build_your_claim_on_stronger_foundations_so_that_men_will_follow_you"),
        (ge, "$player_right_to_rule", 10),
        (str_store_string, s12, "str_if_you_do_not_wish_to_die_on_a_scaffold_like_so_many_failed_pretenders_before_you_i_would_advise_you_prove_yourself_on_the_field_of_battle_so_that_men_will_follow_you"),
        (troop_slot_ge, ":var0", 7, 200),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 5),
        (str_store_string, s12, "str_talk_is_for_heralds_and_lawyers_real_kings_prove_themselves_with_their_swords"),
        (troop_slot_ge, ":var0", 7, 200),
        (assign, ":var1", 1),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 4),
        (str_store_string, s12, "str_i_were_you_i_would_try_to_prove_myself_a_bit_more_before_i_went_about_pressing_my_claim"),
        (troop_slot_ge, ":var0", 7, 400),
        (assign, ":var1", 1),
      (try_end),
      (str_clear, s14),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s12, "str_indeed_please_continue"),
      (else_try),
        (eq, ":var1", 0),
        (eq, "$g_persuasion_trump_used", 0),
        (assign, "$g_persuasion_trump_used", 1),
        (store_skill_level, ":var2", skl_persuasion, "trp_player"),
        (troop_get_slot, ":var3", "$g_talk_troop", 50),
        (try_begin),
          (eq, "$cheat_mode", 1),
        (try_end),
        (val_mul, ":var2", 7),
        (ge, ":var2", ":var3"),
        (assign, ":var1", 1),
        (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_changed_my_mind_default"),
        (str_store_string, s14, "str_s12_s43"),
        (str_store_string, s12, s14),
      (try_end),
      (eq, ":var1", 1),
    ],
    "{s12}",
    "lord_recruit_4",
    []],

  [anyone, "lord_recruit_3_claim",
    [],
    "{s12}",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_recruit_4",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_troop_name, s16, ":var0"),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s16, "str_me"),
      (try_end),
    ],
    "I ask you to pledge your allegiance to {s16}.",
    "lord_recruit_4_objective_conditions",
    []],

  [plyr|anyone, "lord_recruit_4",
    [
      (troop_set_slot, "$g_talk_troop", 50, 0),
    ],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_4_objective_conditions",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (call_script, "script_calculate_troop_political_factors_for_liege", "$g_talk_troop", ":var0"),
      (str_store_string, s33, s14),
      (assign, ":var1", reg2),
      (assign, ":var2", reg4),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "str_preliminary_result_for_political_=_reg4"),
      (try_end),
      (assign, ":var3", reg10),
      (assign, ":var4", reg0),
      (faction_get_slot, ":var5", "$g_talk_troop_faction", 11),
      (call_script, "script_calculate_troop_political_factors_for_liege", "$g_talk_troop", ":var5"),
      (store_sub, ":var6", ":var1", reg2),
      (store_sub, ":var7", ":var2", reg4),
      (assign, ":var8", reg0),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg31, ":var4"),
        (assign, reg32, ":var8"),
        (display_message, "@{!}DEBUG : result for new liege : {reg31}"),
        (display_message, "@{!}DEBUG : result for old liege : {reg32}"),
      (try_end),
      (store_sub, "$pledge_chance", ":var4", ":var8"),
      (val_add, "$pledge_chance", 50),
      (val_div, "$pledge_chance", 2),
      (try_begin),
        (lt, ":var2", 0),
        (try_begin),
          (troop_slot_eq, "$g_talk_troop", 52, 7),
          (str_store_string, s31, "str_i_worry_about_those_with_whom_you_have_chosen_to_surround_yourself"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 1),
          (str_store_string, s31, "str_there_are_some_outstanding_matters_between_me_and_some_of_your_vassals_"),
          (try_begin),
            (assign, reg41, ":var2"),
            (display_message, "str_result_for_political_=_reg41"),
          (try_end),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 2),
          (str_store_string, s31, "str_my_liege_has_his_faults_but_i_dont_care_for_your_toadies"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 6),
          (str_store_string, s31, "str_i_think_youre_a_good_man_but_im_worried_that_you_might_be_pushed_in_the_wrong_direction_by_some_of_those_around_you"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 3),
          (str_store_string, s31, "str_i_am_loathe_to_fight_alongside_you_so_long_as_you_take_under_your_wing_varlots_and_base_men"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 4),
          (str_store_string, s31, "str_ill_be_honest__with_some_of_those_who_follow_you_i_think_id_be_more_comfortable_fighting_against_you_than_with_you"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 5),
          (str_store_string, s31, "str_i_say_that_you_can_judge_a_man_by_the_company_he_keeps_and_you_have_surrounded_yourself_with_vipers_and_vultures"),
        (else_try),
          (troop_slot_ge, "$g_talk_troop", 52, 8),
          (str_store_string, s31, "str_you_know_that_i_have_always_had_a_problem_with_some_of_our_companions"),
        (try_end),
      (else_try),
        (lt, ":var7", 0),
        (str_store_string, s31, "str_politically_i_would_be_a_better_position_in_the_court_of_my_current_liege_than_in_yours"),
      (else_try),
        (str_store_string, s31, "str_i_am_more_comfortable_with_you_and_your_companions_than_with_my_current_liege"),
      (try_end),
      (try_begin),
        (lt, ":var1", 10),
        (try_begin),
          (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 4),
          (troop_slot_ge, "$g_talk_troop", 52, 8),
          (str_store_string, s32, "str_militarily_youre_in_no_position_to_protect_me_should_i_be_attacked_id_be_reluctant_to_join_you_until_you_could"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 7),
          (str_store_string, s32, "str_militarily_when_i_consider_the_lay_of_the_land_i_realize_that_to_pledge_myself_to_you_now_would_endanger_my_faithful_retainers_and_my_family"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 1),
          (str_store_string, s32, "str_militarily_youre_in_no_position_to_come_to_my_help_if_someone_attacked_me_i_dont_mind_a_good_fight_but_i_like_to_have_a_chance_of_winning"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 6),
          (str_store_string, s32, "str_militarily_youre_in_no_position_to_come_to_my_help_if_someone_attacked_me_i_dont_mind_a_good_fight_but_i_like_to_have_a_chance_of_winning"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 5),
          (str_store_string, s32, "str_militarily_you_would_have_me_join_you_only_to_find_myself_isolated_amid_a_sea_of_enemies"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 3),
          (str_store_string, s32, "str_militarily_you_would_have_me_join_you_only_to_find_myself_isolated_amid_a_sea_of_enemies"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 2),
          (str_store_string, s32, "str_militarily_youre_in_no_position_to_come_to_my_help_if_someone_attacked_me_youd_let_me_be_cut_down_like_a_dog_id_bet"),
        (try_end),
      (else_try),
        (lt, ":var6", 0),
        (str_store_string, s32, "str_militarily_i_wouldnt_be_any_safer_if_i_joined_you"),
      (else_try),
        (str_store_string, s32, "str_militarily_i_might_be_safer_if_i_joined_you"),
      (try_end),
      (try_begin),
        (gt, ":var3", 40),
        (str_store_string, s34, "str_finally_there_is_a_cost_to_ones_reputation_to_change_sides_in_this_case_the_cost_would_be_very_high"),
      (else_try),
        (gt, ":var3", 20),
        (str_store_string, s34, "str_finally_there_is_a_cost_to_ones_reputation_to_change_sides_in_this_case_the_cost_would_be_significant"),
      (else_try),
        (str_store_string, s34, "str_finally_there_is_a_cost_to_ones_reputation_to_change_sides_in_this_case_however_many_men_would_understand"),
      (try_end),
    ],
    "Let me think...",
    "lord_recruit_5_security",
    []],

  [anyone, "lord_recruit_5_security",
    [],
    "{s32}",
    "lord_recruit_5_political",
    []],

  [anyone, "lord_recruit_5_political",
    [],
    "{s31}",
    "lord_recruit_5_ideological",
    []],

  [anyone, "lord_recruit_5_ideological",
    [],
    "{s33}",
    "lord_recruit_5_change_sides",
    []],

  [anyone, "lord_recruit_5_change_sides",
    [],
    "{s34}",
    "lord_recruit_6",
    [
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg1, "$pledge_chance"),
        (display_message, "str_chance_of_success_=_reg1"),
      (try_end),
    ]],

  [plyr|anyone, "lord_recruit_6",
    [],
    "It is time for you to make a decision.",
    "lord_recruit_6_reaction",
    []],

  [plyr|anyone, "lord_recruit_6",
    [],
    "No need to decide anything -- we can speak of this at a later time.",
    "lord_pretalk",
    []],

  [anyone, "lord_recruit_6_reaction",
    [],
    "Very well...",
    "lord_recruit_7_decision",
    [
      (troop_set_slot, "$g_talk_troop", 50, 0),
    ]],

  [anyone, "lord_recruit_7_decision",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 49),
      (store_mod, ":var1", ":var0", 100),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg3, ":var1"),
        (display_message, "str_random_=_reg3"),
      (try_end),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s14, ":var2"),
      (assign, ":var3", 0),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 3),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_i_will_not_have_it_be_said_about_me_that_i_am_a_traitor_that_is_my_final_decision_i_have_nothing_more_to_say_on_this_matter"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 1),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_i_am_pledged_to_defend_s14_i_am_sorry_though_we_may_meet_on_the_battlefield_i_hope_that_we_will_still_be_friends"),
      (else_try),
        (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 6),
        (troop_slot_ge, "$g_talk_troop", 52, 8),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_i_really_cannot_bring_myself_to_renounce_s14_i_am_sorry_please_lets_not_talk_about_this_any_more"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 7),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_however_i_have_decided_that_i_must_remain_loyal_to_s14_i_am_sorry"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 5),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_however_i_will_not_let_you_lead_me_into_treason_do_not_talk_to_me_of_this_again"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 4),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_its_not_good_to_get_a_reputation_as_one_who_abandons_his_liege_that_is_my_decision_let_us_speak_no_more_of_this_matter"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (gt, ":var1", "$pledge_chance"),
        (str_store_string, s12, "str_ive_decided_to_stick_with_s14_i_dont_want_to_talk_about_this_matter_any_more"),
      (else_try),
        (assign, ":var3", 1),
      (try_end),
      (eq, ":var3", 0),
    ],
    "{s12}",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 51, 500),
    ]],

  [anyone, "lord_recruit_7_decision",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_troop_name, s4, ":var0"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "str_lord_pledges_to_s4"),
      (try_end),
    ],
    "Very well -- I am ready to pledge myself to {s4} as my {reg4?queen:king}.",
    "lord_recruit_pledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 2),
        (call_script, "script_activate_player_faction", "trp_player"),
      (try_end),
      (assign, "$lord_expects_fief", 0),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 53, 3),
        (assign, "$lord_expects_fief", 1),
      (try_end),
      (call_script, "script_change_troop_faction", "$g_talk_troop", "$players_kingdom"),
      (val_add, "$g_lords_persuaded", 1),
      (try_begin),
        (store_relation, ":var1", "$players_kingdom", "$g_talk_troop_faction"),
        (ge, ":var1", 0),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_lord_recruitment_provokes_home_faction"),
        (try_end),
        (call_script, "script_add_log_entry", 78, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
        (store_add, ":var2", "$players_kingdom", 130),
        (val_sub, ":var2", "fac_player_supporters_faction"),
        (faction_set_slot, "$g_talk_troop_faction", ":var2", 30),
        (faction_get_slot, ":var3", "$g_talk_troop_faction", 11),
        (call_script, "script_troop_change_relation_with_troop", "trp_player", ":var3", -3),
      (try_end),
      (troop_get_type, reg4, ":var0"),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s4, "@you"),
        (call_script, "script_change_player_right_to_rule", 5),
      (else_try),
        (str_store_troop_name, s4, ":var0"),
      (try_end),
    ]],

  [anyone, "lord_recruit_pledge",
    [
      (eq, "$lord_expects_fief", 1),
    ],
    "Remember. You have promised me a fief. I will hold you to that promise.",
    "lord_recruit_pledge",
    [
      (assign, "$lord_expects_fief", 0),
      (troop_set_slot, "$g_talk_troop", 53, 0),
      (call_script, "script_add_log_entry", 37, "trp_player", 0, "$g_talk_troop", "$players_kingdom"),
      (troop_set_slot, "$g_talk_troop", 47, 1),
    ]],

  [anyone, "lord_recruit_pledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (eq, ":var0", "trp_player"),
    ],
    "So be it -- I pledge allegiance to you as your faithful vassal. I shall stand at your side to fight your enemies should you need my sword, and uphold your claims and those of your legitimate heirs. I expect in turn that you will protect me and recognize my rights as your vassal.",
    "lord_recruit_pledge_conclude",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_recruit_pledge",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 54),
      (str_store_troop_name, s4, ":var0"),
    ],
    "So be it -- you may inform {s4} that I am now {reg4?her:him} faithful vassal, that I will follow {reg4?her:him} as long as my breath remains, and I will be at {reg4?her:his} side to fight {reg4?her:his} enemies should {reg4?she:he} need my sword, and that I uphold {reg4?her:his} lawful claims and those of {reg4?her:his} legitimate heirs. In turn, I expect {reg4?her:his} protection and recognition of my rights as {reg4?her:his} vassal.",
    "lord_recruit_pledge_conclude",
    []],

  [anyone, "lord_recruit_pledge_conclude",
    [],
    "Now... It is a momentous step I have taken. I will take my leave, as I may need some time prepare myself for what comes next.",
    "close_window",
    []],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_offer_gift"),
      (quest_slot_eq, "qst_offer_gift", 2, "$g_talk_troop"),
      (quest_slot_eq, "qst_offer_gift", 11, 2),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 7),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 6),
      (troop_slot_eq, "$g_talk_troop", 52, 1),
      (store_random_in_range, ":var0", 3),
      (eq, ":var0", 0),
      (quest_get_slot, ":var1", "qst_offer_gift", 6),
      (str_store_troop_name, s10, ":var1"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
    ],
    "I received the gift, presented to me through my {s11} {s10}. It was a noble gesture, {reg63?sir:my lady}, and I regret that we ever quarreled.",
    "close_window",
    [
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (store_sub, ":var0", 0, reg0),
      (val_add, ":var0", 5),
      (val_max, ":var0", 5),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", ":var0"),
      (call_script, "script_finish_quest_simple", "qst_offer_gift", 100),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_offer_gift"),
      (quest_slot_eq, "qst_offer_gift", 2, "$g_talk_troop"),
      (quest_slot_eq, "qst_offer_gift", 11, 2),
      (store_random_in_range, ":var0", 3),
      (neq, ":var0", 0),
      (quest_get_slot, ":var1", "qst_offer_gift", 6),
      (str_store_troop_name, s10, ":var1"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
    ],
    "I received the gift, presented to me through my {s11} {s10}. For {reg4?her:his} sake, I am willing to let bygones be bygones.",
    "close_window",
    [
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (store_sub, ":var0", 0, reg0),
      (val_max, ":var0", 2),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", ":var0"),
      (call_script, "script_finish_quest_simple", "qst_offer_gift", 100),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_offer_gift"),
      (quest_slot_eq, "qst_offer_gift", 2, "$g_talk_troop"),
      (quest_slot_eq, "qst_offer_gift", 11, 2),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 2),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
      (troop_slot_eq, "$g_talk_troop", 52, 3),
      (quest_get_slot, ":var0", "qst_offer_gift", 6),
      (str_store_troop_name, s10, ":var0"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "I received the gift, presented to me through my {s11} {s10}. Bah! Do you think you can buy my friendship?",
    "close_window",
    [
      (call_script, "script_finish_quest_simple", "qst_offer_gift", 20),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_start",
    [
      (check_quest_active, "qst_offer_gift"),
      (quest_slot_eq, "qst_offer_gift", 2, "$g_talk_troop"),
      (quest_slot_eq, "qst_offer_gift", 11, 2),
      (quest_get_slot, ":var0", "qst_offer_gift", 6),
      (str_store_troop_name, s10, ":var0"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "I received the gift, presented to me through my {s11} {s10}. As dear as {reg?she:he} is to me, however, I cannot forget our differences.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_finish_quest_simple", "qst_offer_gift", 20),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_denounce_lord"),
      (quest_slot_eq, "qst_denounce_lord", 6, "$g_talk_troop"),
      (this_or_next|check_quest_succeeded, "qst_denounce_lord"),
      (check_quest_failed, "qst_denounce_lord"),
      (quest_get_slot, ":var0", "qst_denounce_lord", 6),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I did as you suggested, and denounced {s4}",
    "denounce_lord_results",
    []],

  [anyone, "denounce_lord_results",
    [
      (check_quest_succeeded, "qst_denounce_lord"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Yes, and hopefully now {s4} will think twice before entrusting him with any additional fiefs, honors, or offices. We are grateful to you.",
    "lord_pretalk",
    [
      (call_script, "script_succeed_quest", "qst_denounce_lord"),
      (call_script, "script_finish_quest_simple", "qst_denounce_lord", 100),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 8),
    ]],

  [anyone, "denounce_lord_results",
    [],
    "So you did -- and we have heard that he forced you to retract your words, and thus emerged from this affair looking stronger than before. You will forgive me, {reg63?sir:my lady}, if my gratitude to you is somewhat muted.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_denounce_lord"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_intrigue_against_lord"),
      (quest_slot_eq, "qst_intrigue_against_lord", 6, "$g_talk_troop"),
      (this_or_next|check_quest_succeeded, "qst_intrigue_against_lord"),
      (check_quest_failed, "qst_intrigue_against_lord"),
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (str_store_troop_name, s4, ":var0"),
      (faction_get_slot, ":var1", "$players_kingdom", 11),
      (str_store_troop_name, s5, ":var1"),
    ],
    "I did as you asked, and spoke to {s5} about the danger posed by {s4}.",
    "lord_quest_intrigue_result",
    []],

  [anyone, "lord_quest_intrigue_result",
    [
      (check_quest_succeeded, "qst_intrigue_against_lord"),
    ],
    "So we hear. Hopefully now {s5} will think twice before entrusting him with any additional fiefs, honors, or offices. We are grateful to you.",
    "lord_pretalk",
    [
      (call_script, "script_finish_quest_simple", "qst_intrigue_against_lord", 100),
      (quest_set_slot, "qst_intrigue_against_lord", 25, 30),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 8),
    ]],

  [anyone, "lord_quest_intrigue_result",
    [
      (check_quest_failed, "qst_intrigue_against_lord"),
    ],
    "So we hear -- but alas, {s5} seems not to have listened. Still, we are grateful to you for trying.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_intrigue_against_lord"),
      (quest_set_slot, "qst_intrigue_against_lord", 25, 30),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_lend_companion"),
      (quest_slot_eq, "qst_lend_companion", 6, "$g_talk_troop"),
      (store_current_day, ":var0"),
      (quest_get_slot, ":var1", "qst_lend_companion", 10),
      (ge, ":var0", ":var1"),
      (quest_get_slot, ":var2", "qst_lend_companion", 2),
      (str_store_troop_name, s14, ":var2"),
      (troop_get_type, reg3, ":var2"),
    ],
    "I should like {s14} returned to me, {s65}, if you no longer require {reg3?her:his} services.",
    "lord_lend_companion_end",
    []],

  [anyone, "lord_lend_companion_end",
    [
      (neg|hero_can_join, "p_main_party"),
    ],
    "You've too many men in your company already, {playername}. You could not lead any more at the moment.",
    "lord_pretalk",
    []],

  [anyone, "lord_lend_companion_end",
    [],
    "Certainly, {playername}. {reg3?She:He} is a bright {reg3?girl:fellow}, you're a lucky {reg63?man:woman} to have such worthy companions.",
    "lord_pretalk",
    [
      (quest_get_slot, ":var0", "qst_lend_companion", 2),
      (party_add_members, "p_main_party", ":var0", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
      (call_script, "script_finish_quest_simple", "qst_lend_companion", 100),
      (str_store_troop_name, s14, ":var0"),
      (troop_get_type, reg3, ":var0"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_collect_debt"),
      (quest_slot_eq, "qst_collect_debt", 11, 0),
      (quest_get_slot, ":var0", "qst_collect_debt", 2),
      (eq, "$g_talk_troop", ":var0"),
      (quest_get_slot, ":var1", "qst_collect_debt", 6),
      (str_store_troop_name, s1, ":var1"),
    ],
    "I've come to collect the debt you owe to {s1}.",
    "lord_ask_to_collect_debt",
    [
      (assign, "$g_convince_quest", "qst_collect_debt"),
    ]],

  [anyone, "lord_ask_to_collect_debt",
    [],
    "Oh. Well, {s1} did lend me some silver a ways back, but I've done him many favours in the past and I consider that money as my due payment.",
    "lord_ask_to_collect_debt_2",
    []],

  [plyr|anyone, "lord_ask_to_collect_debt_2",
    [],
    "{s1} considers it a debt. He asked me to speak to you on his behalf.",
    "convince_begin",
    []],

  [plyr|anyone, "lord_ask_to_collect_debt_2",
    [],
    "Then I will not press the matter any further.",
    "lord_pretalk",
    []],

  [anyone, "convince_accept",
    [
      (check_quest_active, "qst_collect_debt"),
      (quest_slot_eq, "qst_collect_debt", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_collect_debt", 6),
      (str_store_troop_name, s8, ":var0"),
      (quest_get_slot, reg10, "qst_collect_debt", 10),
    ],
    "My debt to {s8} has long been overdue and was a source of great discomfort to me. Thank you for accepting to take the money to him. Please give him these {reg10} denars and thank him on my behalf.",
    "close_window",
    [
      (call_script, "script_troop_add_gold", "trp_player", reg10),
      (quest_set_slot, "qst_collect_debt", 11, 1),
      (call_script, "script_succeed_quest", "qst_collect_debt"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_persuade_lords_to_make_peace"),
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 2),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (this_or_next|eq, ":var0", "$g_talk_troop"),
      (eq, ":var1", "$g_talk_troop"),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var3", "qst_persuade_lords_to_make_peace", 15),
      (str_store_faction_name, s12, ":var2"),
      (str_store_faction_name, s13, ":var3"),
    ],
    "Please, {s64}, it's time to end this war between {s12} and {s13}.",
    "lord_ask_to_make_peace",
    [
      (assign, "$g_convince_quest", "qst_persuade_lords_to_make_peace"),
    ]],

  [anyone, "lord_ask_to_make_peace",
    [],
    "Eh? I'm not sure I heard you right, {playername}. War is not easily forgotten by either side of the conflict, and I have a very long memory. Why should I take any interest in brokering peace with those dogs?",
    "lord_ask_to_make_peace_2",
    []],

  [plyr|anyone, "lord_ask_to_make_peace_2",
    [],
    "Perhaps I can talk you into it...",
    "convince_begin",
    []],

  [plyr|anyone, "lord_ask_to_make_peace_2",
    [],
    "Never mind, peace can wait for now.",
    "lord_pretalk",
    []],

  [anyone, "convince_accept",
    [
      (check_quest_active, "qst_persuade_lords_to_make_peace"),
      (this_or_next|quest_slot_eq, "qst_persuade_lords_to_make_peace", 2, "$g_talk_troop"),
      (quest_slot_eq, "qst_persuade_lords_to_make_peace", 4, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 15),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 3),
      (str_store_faction_name, s12, ":var0"),
      (str_store_faction_name, s13, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_talk_troop_faction"),
        (str_store_faction_name, s14, ":var1"),
      (else_try),
        (str_store_faction_name, s14, ":var0"),
      (try_end),
    ],
    "You... have convinced me, {playername}. Very well then, you've my blessing to bring a peace offer to {s14}. I cannot guarantee they will accept it, but on the off-chance they do, I will stand by it.",
    "close_window",
    [
      (store_mul, ":var0", "$g_talk_troop", -1),
      (try_begin),
        (quest_slot_eq, "qst_persuade_lords_to_make_peace", 2, "$g_talk_troop"),
        (quest_set_slot, "qst_persuade_lords_to_make_peace", 2, ":var0"),
      (else_try),
        (quest_set_slot, "qst_persuade_lords_to_make_peace", 4, ":var0"),
      (try_end),
      (quest_set_slot, "qst_persuade_lords_to_make_peace", 19, 1500),
      (assign, "$g_leave_encounter", 1),
      (neg|quest_slot_ge, "qst_persuade_lords_to_make_peace", 2, 0),
      (neg|quest_slot_ge, "qst_persuade_lords_to_make_peace", 4, 0),
      (call_script, "script_succeed_quest", "qst_persuade_lords_to_make_peace"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_rescue_daughter"),
      (neg|check_quest_succeeded, "qst_rescue_daughter"),
      (quest_slot_eq, "qst_rescue_daughter", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_rescue_daughter", 12),
      (str_store_party_name, s1, ":var0"),
    ],
    "I want you to hand over the girl you took from {s1}, intact.",
    "lord_ask_to_give_girl",
    [
      (assign, "$g_convince_quest", "qst_rescue_daughter"),
    ]],

  [anyone, "lord_ask_to_give_girl",
    [
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
      (troop_slot_eq, "$g_talk_troop", 52, 2),
    ],
    "Why should I? I'll have my way with her, and then leave her to the soldiers. You can have her then, ha-ha.",
    "lord_ask_to_give_girl_2",
    []],

  [anyone, "lord_ask_to_give_girl",
    [],
    "Why would you care? It's just a village girl, and a lawful part of my booty.",
    "lord_ask_to_give_girl_2",
    []],

  [plyr|anyone, "lord_ask_to_give_girl_2",
    [],
    "Nevertheless, I want her back now. Let us talk.",
    "convince_begin",
    []],

  [plyr|anyone, "lord_ask_to_give_girl_2",
    [
      (eq, "$talk_context", 2),
      (lt, "$g_talk_troop_faction_relation", 0),
    ],
    "Then I shall take her by force.",
    "close_window",
    [
      (encounter_attack),
    ]],

  [plyr|anyone, "lord_ask_to_give_girl_2",
    [],
    "Then I will not insist further, do as you please.",
    "lord_pretalk",
    []],

  [anyone, "convince_accept",
    [
      (check_quest_active, "qst_rescue_daughter"),
      (eq, "$g_convince_quest", "qst_rescue_daughter"),
    ],
    "You can have your girl, she is just a plain peasant strumpet.",
    "close_window",
    [
      (party_force_add_members, "p_main_party", "trp_kidnapped_daughter", 1),
      (call_script, "script_succeed_quest", "qst_rescue_daughter"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_duel_for_lady"),
      (neg|check_quest_concluded, "qst_duel_for_lady"),
      (quest_slot_eq, "qst_duel_for_lady", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_for_lady", 6),
      (str_store_troop_name, s1, ":var0"),
    ],
    "I want you to take back your accusations against {s1}.",
    "lord_challenge_duel_for_lady",
    []],

  [anyone, "lord_challenge_duel_for_lady",
    [],
    "What accusations? Everyone knows that she beds her stable boys and anyone else she can lay hands on while her husband is away. I merely repeat the words of many.",
    "lord_challenge_duel_for_lady_2",
    []],

  [plyr|anyone, "lord_challenge_duel_for_lady_2",
    [],
    "You will recant these lies, sirrah, or prove them against my sword!",
    "lord_challenge_duel",
    []],

  [plyr|anyone, "lord_challenge_duel_for_lady_2",
    [],
    "If you say so...",
    "lord_pretalk",
    []],

  [anyone, "lord_challenge_duel",
    [
      (str_store_string, s15, "str_error__wrong_quest_type"),
      (try_begin),
        (check_quest_active, "qst_duel_for_lady"),
        (neg|check_quest_concluded, "qst_duel_for_lady"),
        (quest_slot_eq, "qst_duel_for_lady", 2, "$g_talk_troop"),
        (str_store_string, s15, "@You are challenging me to a duel? How droll! As you wish, {playername}, it will be good sport to bash your head in."),
      (else_try),
        (check_quest_active, "qst_duel_courtship_rival"),
        (neg|check_quest_concluded, "qst_duel_courtship_rival"),
        (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_talk_troop"),
        (str_store_string, s15, "str_call_me_coward_very_well_you_leave_me_no_choice"),
      (try_end),
    ],
    "{s15}",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -15),
      (call_script, "script_set_up_duel_with_troop", "$g_talk_troop"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_duel_courtship_rival"),
      (neg|check_quest_concluded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 6),
      (str_store_troop_name, s5, ":var0"),
    ],
    "Relinquish your suit of {s5}!",
    "lord_challenge_courtship_rival",
    []],

  [anyone, "lord_challenge_courtship_rival",
    [],
    "Or what? Do you intend to duel over a lady? I'll let you know -- our liege frowns on this sort of hot-headed challenge, when every man must stand together against the foreign foe.",
    "lord_challenge_courtship_rival_2",
    []],

  [plyr|anyone, "lord_challenge_courtship_rival_2",
    [],
    "Do you fear to fight me?",
    "lord_challenge_duel",
    []],

  [plyr|anyone, "lord_challenge_courtship_rival_2",
    [],
    "My pardon. I have spoken rashly...",
    "lord_pretalk",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_deliver_message"),
      (quest_get_slot, ":var0", "qst_deliver_message", 2),
      (eq, "$g_talk_troop", ":var0"),
      (quest_get_slot, ":var1", "qst_deliver_message", 6),
      (str_store_troop_name, s9, ":var1"),
    ],
    "I bring a message from {s9}.",
    "lord_message_delivered",
    []],

  [anyone, "lord_message_delivered",
    [],
    "Oh? Let me see that... Well, well, well! It was good of you to bring me this, {playername}. Take my seal as proof that I've received it, and give my regards to {s9} when you see him again.",
    "lord_pretalk",
    [
      (call_script, "script_finish_quest_simple", "qst_deliver_message", 100),
      (quest_get_slot, ":var0", "qst_deliver_message", 6),
      (str_store_troop_name, s9, ":var0"),
      (call_script, "script_change_player_relation_with_troop", ":var0", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_deliver_message_to_enemy_lord"),
      (quest_get_slot, ":var0", "qst_deliver_message_to_enemy_lord", 2),
      (eq, "$g_talk_troop", ":var0"),
      (quest_get_slot, ":var1", "qst_deliver_message_to_enemy_lord", 6),
      (str_store_troop_name, s9, ":var1"),
    ],
    "I bring a message from {s9}.",
    "lord_message_delivered_enemy",
    []],

  [anyone, "lord_message_delivered_enemy",
    [],
    "Oh? Let me see that... Hmmm. It was good of you to bring me this, {playername}. Take my seal as proof that I've received it, with my thanks.",
    "close_window",
    [
      (call_script, "script_finish_quest_simple", "qst_deliver_message_to_enemy_lord", 100),
      (quest_get_slot, ":var0", "qst_deliver_message_to_enemy_lord", 6),
      (call_script, "script_change_player_relation_with_troop", ":var0", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (check_quest_active, "qst_deliver_message_to_prisoner_lord"),
      (quest_slot_eq, "qst_deliver_message_to_prisoner_lord", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_deliver_message_to_prisoner_lord", 6),
      (str_store_troop_name, s11, ":var0"),
    ],
    "I bring a message from {s11}.",
    "lord_deliver_message_prisoner",
    [
      (call_script, "script_finish_quest_simple", "qst_deliver_message_to_prisoner_lord", 100),
    ]],

  [anyone, "lord_deliver_message_prisoner",
    [],
    "Can it be true? Oh, thank you kindly, {playername}! You have brought hope and some small ray of light to these bleak walls. Perhaps one day I will be able to repay you.",
    "lord_deliver_message_prisoner_2",
    []],

  [plyr|anyone, "lord_deliver_message_prisoner_2",
    [],
    " 'Twas the least I could do, {s65}.",
    "lord_deliver_message_prisoner_2a",
    []],

  [anyone, "lord_deliver_message_prisoner_2a",
    [],
    "You've no idea how grateful I am, {playername}. A thousand thanks and more.",
    "close_window",
    []],

  [plyr|anyone, "lord_deliver_message_prisoner_2",
    [],
    "Worry not, {s65}. You'll have ample opportunity once you are free again.",
    "lord_deliver_message_prisoner_2b",
    []],

  [anyone, "lord_deliver_message_prisoner_2b",
    [],
    "Hah, of course, {playername}. My eternal thanks go with you.",
    "close_window",
    []],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_rescue_lord_by_replace"),
      (quest_slot_eq, "qst_rescue_lord_by_replace", 2, "$g_talk_troop"),
      (neg|check_quest_succeeded, "qst_rescue_lord_by_replace"),
    ],
    "Fear not, I am here to rescue you.",
    "lord_rescue_by_replace_offer",
    []],

  [anyone, "lord_rescue_by_replace_offer",
    [],
    "By God, are you serious? What is your plan?",
    "lord_rescue_by_replace_offer_2",
    []],

  [plyr|anyone, "lord_rescue_by_replace_offer_2",
    [],
    "A simple ruse, {s65}. If we exchange garments, I shall take your place here in prison, while you make your escape disguised as myself. I paid the guards a handsome bribe, with which I am sure they have already purchased half the wine stocks of the nearest tavern. With some luck they'll soon get so drunk they'd have trouble recognizing their own mothers, let alone telling one of us from the other. At least not until you are safely away.",
    "lord_rescue_by_replace_offer_3",
    []],

  [anyone, "lord_rescue_by_replace_offer_3",
    [],
    "Hmm, it might just work... But what of you, my {reg63?friend:lady}? The guards won't take kindly to this trickery. You may end up spending some time in this cell yourself.",
    "lord_rescue_by_replace_offer_4",
    []],

  [plyr|anyone, "lord_rescue_by_replace_offer_4",
    [],
    "Not to worry, {s65}. The place is already starting to grow on me.",
    "lord_rescue_by_replace_offer_5a",
    []],

  [plyr|anyone, "lord_rescue_by_replace_offer_4",
    [],
    "I shall be fine as long there is an ample reward waiting at the end.",
    "lord_rescue_by_replace_offer_5b",
    []],

  [anyone, "lord_rescue_by_replace_offer_5a",
    [],
    "You are a brave soul indeed. I won't forget this.",
    "lord_rescue_by_replace_offer_6",
    []],

  [anyone, "lord_rescue_by_replace_offer_5b",
    [],
    "Of course, my {reg63?friend:lady}, of course! Come to me when you have regained your freedom, and perhaps I shall be able to repay the debt I owe you.",
    "lord_rescue_by_replace_offer_6",
    []],

  [plyr|anyone, "lord_rescue_by_replace_offer_6",
    [],
    "Quickly, {s65}, let us change garments. It is past time you were away from here.",
    "close_window",
    [
      (call_script, "script_succeed_quest", "qst_rescue_lord_by_replace"),
      (quest_get_slot, ":var0", "qst_rescue_lord_by_replace", 2),
      (quest_get_slot, ":var1", "qst_rescue_lord_by_replace", 1),
      (party_remove_prisoners, ":var1", ":var0", 1),
      (troop_set_slot, ":var0", 8, -1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_rescue_lord_taken_prisoner"),
      (finish_mission),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (eq, "$players_oath_renounced_against_kingdom", "$g_talk_troop_faction"),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
    ],
    "{s66}, I wish to restore my old oath to {s4}.",
    "lord_ask_pardon_after_oath_renounced",
    []],

  [anyone, "lord_ask_pardon_after_oath_renounced",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (neq, ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "That is too great a matter for me to decide, {playername}. You should seek out {s4}. Such clemency is his alone to grant or deny.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon_after_oath_renounced",
    [
      (assign, ":var0"),
      (try_for_range, ":var1", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (party_slot_eq, ":var1", 159, "$g_talk_troop_faction"),
        (val_add, ":var0", 1),
      (try_end),
      (store_mul, ":var3", ":var0", 500),
      (store_current_hours, ":var4"),
      (val_sub, ":var4", "$players_oath_renounced_begin_time"),
      (val_add, ":var3", ":var4"),
      (try_begin),
        (gt, ":var3", 800),
        (assign, ":var5", -1),
        (try_begin),
          (gt, ":var3", 1500),
          (try_begin),
            (eq, "$players_oath_renounced_given_center", 0),
            (store_random_in_range, ":var5", 0, ":var0"),
          (try_end),
        (else_try),
          (assign, "$players_oath_renounced_given_center", 0),
        (try_end),
        (assign, ":var6", 0),
        (try_for_range, ":var1", "p_town_1", "p_village_1"),
          (store_faction_of_party, ":var2", ":var1"),
          (eq, ":var2", "fac_player_supporters_faction"),
          (party_slot_eq, ":var1", 159, "$g_talk_troop_faction"),
          (try_begin),
            (eq, ":var5", 0),
            (assign, "$players_oath_renounced_given_center", ":var1"),
          (else_try),
            (neq, "$players_oath_renounced_given_center", ":var1"),
            (try_begin),
              (eq, ":var6", 0),
              (str_store_party_name, s17, ":var1"),
            (else_try),
              (eq, ":var6", 1),
              (str_store_party_name, s16, ":var1"),
              (str_store_string, s17, "@{s16} and {s17}"),
            (else_try),
              (str_store_party_name, s16, ":var1"),
              (str_store_string, s17, "@{!}{s16}, {s17}"),
            (try_end),
            (val_add, ":var6", 1),
          (try_end),
          (val_sub, ":var5", 1),
        (try_end),
        (try_begin),
          (eq, ":var6", 0),
          (str_store_string, s11, "@Very well, I will accept you back into my ranks, if you're ready to swear your solemn oath once more."),
          (assign, "$players_oath_renounced_terms_state", 1),
        (else_try),
          (str_store_string, s11, "@A pardon will only be possible if you are willing to cede {s17} to me. Do you agree to my terms?"),
          (assign, "$players_oath_renounced_terms_state", 2),
        (try_end),
      (else_try),
        (str_store_string, s11, "@No. There is no chance of peace between us, I am not interested."),
        (assign, "$players_oath_renounced_terms_state", 0),
      (try_end),
    ],
    "{s11}.",
    "lord_ask_pardon_terms",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 0),
    ],
    "As you like, {s65}. I will accept your judgment.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 0),
    ],
    "A shame, {s65}. A shame.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 0),
    ],
    "Very well, go and die without me.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 1),
    ],
    "Aye, I am ready.",
    "lord_ask_pardon_after_renounce_peace",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 1),
    ],
    "On second thought, no. I don't wish to be in your service again.",
    "lord_ask_pardon_terms_rejected",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 2),
    ],
    "Aye, I agree to those terms.",
    "lord_ask_pardon_after_renounce_peace",
    []],

  [plyr|anyone, "lord_ask_pardon_terms",
    [
      (eq, "$players_oath_renounced_terms_state", 2),
    ],
    "That is too high a price, {s65}. I must decline.",
    "lord_ask_pardon_terms_rejected",
    []],

  [anyone, "lord_ask_pardon_after_renounce_peace",
    [],
    "Excellent. Though you strayed from us, {playername}, it gladdens all our hearts that you have found your way back to the right path. I hereby restore your homage to me. Rise once more as an honored {reg63?man:warrior} in my service.",
    "lord_pretalk",
    [
      (try_for_range, ":var0", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (party_slot_eq, ":var0", 159, "$g_talk_troop_faction"),
        (neq, ":var0", "$players_oath_renounced_given_center"),
        (call_script, "script_give_center_to_faction", ":var0", "$g_talk_troop_faction"),
      (try_end),
      (call_script, "script_player_join_faction", "$g_talk_troop_faction"),
      (assign, "$player_has_homage", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
    ]],

  [anyone, "lord_ask_pardon_terms_rejected",
    [],
    "Then get out of my sight, traitor! Begone with you, and do not come back!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (lt, "$g_talk_troop_faction_relation", 0),
      (store_relation, ":var0", "$g_talk_troop_faction", "$players_kingdom"),
      (this_or_next|ge, ":var0", 0),
      (this_or_next|eq, "$players_kingdom", 0),
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (neq, "$players_oath_renounced_against_kingdom", "$g_talk_troop_faction"),
      (assign, ":var1", 1),
      (try_begin),
        (gt, "$supported_pretender", 0),
        (eq, "$supported_pretender_old_faction", "$g_talk_troop_faction"),
        (assign, ":var1", 0),
      (try_end),
      (eq, ":var1", 1),
      (is_between, "$g_talk_troop_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
    ],
    "I wish to make peace with the {s4}.",
    "lord_ask_pardon",
    []],

  [anyone, "lord_ask_pardon",
    [
      (lt, "$g_talk_troop_relation", -10),
    ],
    "Do you indeed, {playername}? Then go and trip on your sword. Give us all peace.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
      (lt, "$player_right_to_rule", 10),
    ],
    "{playername}, you are a {reg63?lord:lady} without a master, holding lands in your name, with only the barest scrap of a claim to legitimacy. No king in Pendor would accept a lasting peace with you.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
      (encountered_party_is_attacker),
    ],
    "Make peace when I have you at an advantage? I think not.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
      (call_script, "script_npc_decision_checklist_peace_or_war", "$g_talk_troop_faction", "fac_player_supporters_faction", "trp_player"),
      (lt, reg0, 0),
    ],
    "I do not see it as being in my current interest to make peace.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "Yes... I am weary of fighting you. I could offer you a truce of forty days. If you keep your word and do not molest my lands and subjects, we may talk again ...",
    "lord_truce_offer",
    []],

  [plyr|anyone, "lord_truce_offer",
    [],
    "I accept. Let us stop making war upon each other, for the time being, anyway.",
    "close_window",
    [
      (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_talk_troop_faction", "$players_kingdom", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_truce_offer",
    [],
    "On second thought, such an accord would not be in my interests.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "fac_player_supporters_faction"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
      (store_sub, ":var3", 4, "$g_talk_troop_faction_relation"),
      (val_mul, ":var3", ":var3"),
      (store_mul, reg16, ":var3", 50),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
    ],
    "Hmm. I could use my considerable influence to arrange a pardon for you, {playername}, but there are some who see you as an enemy and will not be satisfied unless you pay tribute. All in all, you'd need to bring no less than {reg16} denars to make any friends in {s4}.",
    "lord_ask_pardon_2",
    []],

  [anyone, "lord_ask_pardon",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (neq, "$g_talk_troop", ":var0"),
      (str_store_troop_name, s7, ":var0"),
    ],
    "I am in no position to offer you anything. You must speak to {s7}.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_pardon",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (neg|faction_slot_ge, "fac_player_supporters_faction", 11, 1),
      (store_sub, ":var0", 4, "$g_talk_troop_faction_relation"),
      (val_mul, ":var0", ":var0"),
      (store_mul, reg16, ":var0", 50),
      (str_store_faction_name, s4, "$g_talk_troop_faction"),
    ],
    "Yes... I have bigger worries than you or your followers. However, you have wronged my subjects, and wrongs demand compensation. For the sum of {reg16} denars, I suppose that I could agree to grant you a pardon. What do you say?",
    "lord_ask_pardon_2",
    []],

  [anyone, "lord_ask_pardon",
    [],
    "I am sorry. I am in no position to offer you a pardon",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_ask_pardon_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg16),
    ],
    "I have the money here. {reg16} denars.",
    "lord_ask_pardon_tribue_accept",
    []],

  [plyr|anyone, "lord_ask_pardon_2",
    [],
    "I fear I cannot pay that much.",
    "lord_ask_pardon_tribue_deny",
    []],

  [anyone, "lord_ask_pardon_tribue_accept",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Excellent, {playername}. I will use this to make amends to those you have wronged, and I will let it be known that you are no longer an enemy of the {s4}.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg16),
      (store_relation, ":var0", "$g_talk_troop_faction", "$players_kingdom"),
      (try_begin),
        (this_or_next|eq, "$players_kingdom", 0),
        (ge, ":var0", 0),
        (call_script, "script_set_player_relation_with_faction", "$g_talk_troop_faction", 0),
      (try_end),
      (assign, "$g_leave_town_outside", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_pardon_tribue_accept",
    [],
    "Excellent, {playername}. I'll use the coin to smooth the feathers of those that can oppose your pardon, and I'm sure that word will soon spread that you are no longer an enemy of {s4}.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg16),
      (store_relation, ":var0", "$g_talk_troop_faction", "$players_kingdom"),
      (try_begin),
        (this_or_next|eq, "$players_kingdom", 0),
        (ge, ":var0", 0),
        (call_script, "script_set_player_relation_with_faction", "$g_talk_troop_faction", 0),
      (else_try),
        (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_talk_troop_faction", "$players_kingdom", 1),
      (try_end),
      (assign, "$g_leave_town_outside", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_pardon_tribue_deny",
    [],
    "Then there's nothing I can do for you, {playername}. No silver, no pardon.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (store_partner_quest, ":var0"),
      (ge, ":var0", 0),
    ],
    "About the task you gave me...",
    "lord_active_mission_1",
    []],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "Let us discuss matters related to our household.",
    "lord_switch_to_spouse",
    []],

  [anyone, "lord_switch_to_spouse",
    [
      (assign, ":var0", -1),
      (try_begin),
        (is_between, "$current_town", "p_town_1", "p_village_1"),
        (this_or_next|party_slot_eq, "$current_town", 7, "trp_player"),
        (party_slot_eq, "$current_town", 7, "$g_talk_troop"),
        (assign, ":var0", "$current_town"),
      (else_try),
        (try_for_range, ":var1", "p_town_1", "p_village_1"),
          (eq, ":var0", -1),
          (this_or_next|party_slot_eq, ":var1", 7, "trp_player"),
          (party_slot_eq, ":var1", 7, "$g_talk_troop"),
          (assign, ":var0", ":var1"),
        (try_end),
        (is_between, ":var0", "p_town_1", "p_village_1"),
      (else_try),
        (is_between, "$current_town", "p_town_1", "p_village_1"),
        (assign, ":var0", "$current_town"),
      (try_end),
      (neg|is_between, ":var0", "p_town_1", "p_village_1"),
    ],
    "Let us wait until we are in a hall, my wife, as it is difficult to deal with household inventories and such matters in the field.",
    "lord_pretalk",
    []],

  [anyone, "lord_switch_to_spouse",
    [],
    "Certainly, my wife",
    "spouse_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (ge, "$g_talk_troop_faction_relation", 0),
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "Do you have any tasks for me?",
    "lord_request_mission_ask",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (eq, "$player_has_homage", 1),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Do you think we can work together to advance our standings in this realm?",
    "combined_political_quests",
    [
      (call_script, "script_get_political_quest", "$g_talk_troop"),
      (assign, "$political_quest_found", reg0),
      (assign, "$political_quest_target_troop", reg1),
      (assign, "$political_quest_object_troop", reg2),
    ]],

  [anyone, "combined_political_quests",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (lt, "$g_talk_troop_effective_relation", -5),
    ],
    "I do not imagine that you and I have many mutual interests.",
    "lord_pretalk",
    []],

  [anyone, "combined_political_quests",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
      (gt, "$political_quest_found", 0),
      (assign, ":var0", 1),
      (try_begin),
        (call_script, "script_cf_troop_can_intrigue", "$g_talk_troop", 1),
        (assign, ":var0", 0),
      (try_end),
      (eq, ":var0", 1),
    ],
    "Hmm.. Perhaps we can discuss this matter in a more private setting, at a later date.",
    "lord_pretalk",
    []],

  [anyone, "combined_political_quests",
    [
      (this_or_next|eq, "$political_quest_found", "qst_intrigue_against_lord"),
      (eq, "$political_quest_found", "qst_denounce_lord"),
      (troop_slot_ge, "trp_player", 150, 30),
    ],
    "Hmm... I do have an idea, but it would require you that you be free of controversy. If you were to wait some time without getting into any arguments with the other lords of our realm, perhaps we could proceed further.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (le, "$talk_context", 2),
      (faction_slot_eq, "$players_kingdom", 11, "$g_talk_troop"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "I wish to resign the marshalship",
    "lord_ask_resign_marshalship",
    []],

  [anyone, "lord_ask_resign_marshalship",
    [],
    "So be it. I shall have to find someone else.",
    "lord_pretalk",
    [
      (assign, ":var0", "$players_kingdom"),
      (faction_set_slot, ":var0", 64, 1),
      (store_current_hours, ":var1"),
      (val_max, ":var1", 0),
      (faction_set_slot, ":var0", 65, ":var1"),
      (faction_get_slot, ":var2", ":var0", 8),
      (try_begin),
        (ge, ":var2", 0),
        (troop_get_slot, ":var3", ":var2", 10),
        (party_is_active, ":var3"),
        (1604, ":var3", 0),
      (try_end),
      (faction_set_slot, ":var0", 8, -1),
      (try_for_range, ":var4", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (store_troop_faction, ":var5", ":var4"),
        (eq, ":var5", ":var0"),
        (troop_set_slot, ":var4", 154, -1),
      (try_end),
      (try_begin),
        (eq, "$players_kingdom", ":var0"),
        (troop_set_slot, "trp_player", 154, -1),
      (try_end),
      (call_script, "script_add_notification_menu", "mnu_notification_relieved_as_marshal", 0, 0),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (le, "$talk_context", 2),
      (ge, "$g_talk_troop_faction_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (neq, "$players_kingdom", "$g_talk_troop_faction"),
      (eq, "$pop_kingdom", 0),
      (store_partner_quest, ":var0"),
      (neq, ":var0", "qst_join_faction"),
    ],
    "{s66}, I have come to offer you my sword in vassalage!",
    "lord_ask_enter_service",
    []],

  [plyr|anyone, "lord_talk",
    [
      (le, "$talk_context", 2),
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (eq, "$players_kingdom", "$g_talk_troop_faction"),
      (eq, "$player_has_homage", 0),
      (store_partner_quest, ":var0"),
      (neq, ":var0", "qst_join_faction"),
    ],
    "{s66}, I wish to become your sworn {reg63?man:woman} and fight for your honor.",
    "lord_ask_enter_service",
    []],

  [plyr|anyone, "lord_talk",
    [
      (le, "$talk_context", 2),
      (ge, "$g_talk_troop_faction_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (eq, "$players_kingdom", "$g_talk_troop_faction"),
      (eq, "$player_has_homage", 1),
    ],
    "{s66}, I wish to be released from my oath to you.",
    "lord_ask_leave_service",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, 1, 0),
      (le, "$talk_context", 2),
      (ge, "$g_talk_troop_faction_relation", 0),
    ],
    "I have an offer for you.",
    "lord_talk_preoffer",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (troop_slot_ge, "$g_talk_troop", 10, 1),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to give some troops to you.",
    "lord_give_troops",
    []],

  [anyone, "lord_give_troops",
    [],
    "Well, I could use some good soldiers. Thank you.",
    "lord_pretalk",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 10),
      (change_screen_give_members, ":var0"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (eq, "$talk_context", 1),
      (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to reinforce your garrison here.",
    "lord_give_troops_garrison",
    []],

  [anyone, "lord_give_troops_garrison",
    [],
    "Well, the garrison can use some good soldiers. Thank you.",
    "lord_pretalk",
    [
      (change_screen_give_members, "$g_encountered_party"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
    ],
    "Dear Friend, let me see your equipment.",
    "companion_lord_trade",
    []],

  [anyone, "companion_lord_trade",
    [],
    "Very well, it's all here...",
    "do_companion_lord_trade",
    [
      (change_screen_equip_other),
    ]],

  [anyone, "do_companion_lord_trade",
    [],
    "Anything else, my {reg63?King:Queen}?",
    "lord_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
    ],
    "My Friend, what can you tell me about your skills?",
    "view_companion_lord_char_requested",
    []],

  [anyone, "view_companion_lord_char_requested",
    [],
    "All right, let me tell you...",
    "do_companion_lord_view_char",
    [
      (change_screen_view_character),
    ]],

  [anyone, "do_companion_lord_view_char",
    [],
    "Anything else, {reg63?Sire:Madame}?",
    "lord_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "I have a new task for you.",
    "lord_give_order_ask",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "May I suggest a course of action?",
    "lord_give_suggestion_ask",
    []],

  [anyone, "lord_give_order_ask",
    [],
    "Yes?",
    "lord_give_order",
    []],

  [anyone, "lord_give_suggestion_ask",
    [
      (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    ],
    "I will gladly follow your direction, {reg63?sire:your Highness}. If you intend to direct an extensive campaign, however, you may also wish to declare yourself marshal, so there is no cause for confusion.",
    "lord_give_order",
    []],

  [anyone, "lord_give_suggestion_ask",
    [
      (lt, "$g_talk_troop_effective_relation", 5),
    ],
    "My apologies. I don't know you well enough to take your advice.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_suggestion_ask",
    [],
    "What is it?",
    "lord_give_order",
    []],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "Follow me.",
    "lord_give_order_answer",
    [
      (assign, "$temp", 11),
      (assign, "$temp_2", "p_main_party"),
      (store_current_hours, ":var0"),
      (party_set_slot, "$g_talk_troop_party", 244, "trp_kingdom_heroes_including_player_begin"),
      (party_set_slot, "$g_talk_troop_party", 245, "$temp"),
      (party_set_slot, "$g_talk_troop_party", 246, "$temp_2"),
      (party_set_slot, "$g_talk_troop_party", 247, ":var0"),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "Will you follow me? I have a plan...",
    "lord_give_order_answer",
    [
      (assign, "$temp", 11),
      (assign, "$temp_2", "p_main_party"),
      (store_current_hours, ":var0"),
      (party_set_slot, "$g_talk_troop_party", 244, "trp_kingdom_heroes_including_player_begin"),
      (party_set_slot, "$g_talk_troop_party", 245, "$temp"),
      (party_set_slot, "$g_talk_troop_party", 246, "$temp_2"),
      (party_set_slot, "$g_talk_troop_party", 247, ":var0"),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "Go to...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 7),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "Raid around the village of...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 5),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "Patrol around...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 4),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 1),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (party_slot_eq, ":var0", 54, "$g_talk_troop_party"),
      (party_slot_eq, ":var0", 35, 5),
      (str_store_party_name, s11, ":var0"),
    ],
    "Together, you and I can take {s11}. You should assault immediately...",
    "lord_give_order_assault",
    []],

  [plyr|anyone, "lord_give_order",
    [
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "We are under attack, but the enemy can be repulsed. You should ride towards...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 4),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 8, "$g_talk_troop"),
    ],
    "We are under attack, but the enemy can be repulsed. You should assemble the army and march to...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 4),
    ]],

  [anyone, "lord_give_order_assault",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (party_get_slot, ":var1", ":var0", 54),
      (neq, ":var1", "$g_talk_troop_party"),
      (party_stack_get_troop_id, ":var2", ":var1", 0),
      (str_store_troop_name, s4, ":var2"),
      (troop_get_type, reg4, ":var2"),
    ],
    "{s4} is directing this siege. I suggest you speak to {reg4?her:him}",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_assault",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (party_get_slot, ":var1", ":var0", 64),
      (store_current_hours, ":var2"),
      (store_sub, ":var3", ":var2", ":var1"),
      (try_begin),
        (assign, ":var4", 9),
      (try_end),
      (val_sub, ":var4", ":var3"),
      (gt, ":var4", 0),
      (try_begin),
        (gt, ":var4", 1),
        (assign, reg3, ":var4"),
        (str_store_string, s11, "str_reg3_hours"),
      (else_try),
        (str_store_string, s11, "str_hour"),
      (try_end),
    ],
    "Our preparations are not yet ready. We need another {s11}",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_assault",
    [],
    "Very well -- to the walls!",
    "close_window",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (call_script, "script_begin_assault_on_center", ":var0"),
      (party_set_slot, "$g_talk_troop_party", 249, 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_give_order",
    [],
    "There is a fortress which can easily be taken. Go to..",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 1),
    ]],

  [plyr|anyone, "lord_give_order",
    [],
    "The enemy is coming in force. Flee in the direction of...",
    "lord_give_order_details_ask",
    [
      (assign, "$temp", 14),
    ]],

  [plyr|anyone, "lord_give_order",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
    ],
    "I won't need you for some time. You are free to do as you like.",
    "lord_give_order_stop",
    []],

  [plyr|anyone, "lord_give_order",
    [
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (party_slot_eq, "$g_talk_troop_party", 4, 11),
      (party_slot_eq, "$g_talk_troop_party", 5, "p_main_party"),
    ],
    "You no longer need to accompany me.",
    "lord_give_order_stop",
    []],

  [plyr|anyone, "lord_give_order",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_details_ask",
    [
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (troop_slot_eq, "$g_talk_troop", 52, 1),
      (eq, "$temp", 14),
    ],
    "It is not my way to turn tail and run, without even laying eyes on the enemy.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_details_ask",
    [
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (troop_slot_eq, "$g_talk_troop", 52, 5),
      (eq, "$temp", 1),
    ],
    "You want me to shed my blood outside a fortress while others stand by and watch? I think not.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_details_ask",
    [],
    "Where?",
    "lord_give_order_details",
    []],

  [repeat_for_parties|plyr|anyone, "lord_give_order_details",
    [
      (store_repeat_object, ":var0"),
      (store_faction_of_party, ":var1", ":var0"),
      (is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (store_relation, ":var2", ":var1", "$players_kingdom"),
      (assign, ":var3", 0),
      (try_begin),
        (this_or_next|eq, "$temp", 14),
        (eq, "$temp", 7),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 0, 2),
          (party_slot_eq, ":var0", 0, 3),
          (eq, ":var1", "$players_kingdom"),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 5),
        (try_begin),
          (party_slot_eq, ":var0", 0, 4),
          (lt, ":var2", 0),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 1),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 0, 2),
          (party_slot_eq, ":var0", 0, 3),
          (party_slot_eq, ":var0", 54, -1),
          (lt, ":var2", 0),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 4),
        (try_begin),
          (eq, ":var1", "$players_kingdom"),
          (is_between, ":var0", "p_town_1", "p_salt_mine"),
          (assign, ":var3", 1),
        (else_try),
          (is_between, ":var0", "p_town_1", "p_salt_mine"),
          (store_distance_to_party_from_party, ":var4", ":var0", "p_main_party"),
          (le, ":var4", 25),
          (assign, ":var3", 1),
        (try_end),
      (try_end),
      (eq, ":var3", 1),
      (neq, ":var0", "$g_encountered_party"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{s1}",
    "lord_give_order_answer",
    [
      (store_repeat_object, "$temp_2"),
      (store_current_hours, ":var0"),
      (party_set_slot, "$g_talk_troop_party", 244, "trp_kingdom_heroes_including_player_begin"),
      (party_set_slot, "$g_talk_troop_party", 245, "$temp"),
      (party_set_slot, "$g_talk_troop_party", 246, "$temp_2"),
      (party_set_slot, "$g_talk_troop_party", 247, ":var0"),
    ]],

  [plyr|anyone, "lord_give_order_details",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_stop",
    [],
    "All right. I will stop here.",
    "lord_pretalk",
    [
      (party_set_slot, "$g_talk_troop_party", 245, -1),
      (party_set_slot, "$g_talk_troop_party", 246, -1),
      (store_current_hours, ":var0"),
      (val_sub, ":var0", 36),
      (val_max, ":var0", 0),
      (party_set_slot, "$g_talk_troop_party", 244, "trp_kingdom_heroes_including_player_begin"),
      (party_set_slot, "$g_talk_troop_party", 245, -1),
      (party_set_slot, "$g_talk_troop_party", 246, -1),
      (party_set_slot, "$g_talk_troop_party", 247, ":var0"),
      (troop_get_slot, ":var1", "$g_talk_troop", 10),
      (try_begin),
        (gt, ":var1", 0),
        (call_script, "script_party_set_ai_state", ":var1", -1, -1),
        (party_set_slot, ":var1", 30, -1),
      (try_end),
    ]],

  [anyone, "lord_give_order_answer",
    [
      (eq, "$temp", 11),
      (neg|faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|faction_slot_eq, "$players_kingdom", 11, "trp_player"),
      (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (troop_get_slot, ":var1", "$g_talk_troop", 7),
      (troop_get_slot, ":var2", "trp_player", 7),
      (store_skill_level, ":var3", skl_persuasion, "trp_player"),
      (store_div, ":var4", ":var0", 5),
      (val_min, ":var4", 10),
      (store_add, ":var5", ":var4", ":var3"),
      (store_sub, ":var6", 20, ":var5"),
      (val_mul, ":var6", ":var1"),
      (val_div, ":var6", 10),
      (this_or_next|lt, ":var2", ":var6"),
      (lt, ":var0", 0),
    ],
    "That would hardly be proper. It would be more appropriate for you to follow me instead. Did you have any other ideas?",
    "lord_give_order",
    [
      (party_set_slot, "$g_talk_troop_party", 244, 0),
      (party_set_slot, "$g_talk_troop_party", 245, 0),
      (party_set_slot, "$g_talk_troop_party", 246, 0),
      (party_set_slot, "$g_talk_troop_party", 247, 0),
    ]],

  [anyone, "lord_give_order_answer",
    [
      (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
      (eq, reg0, "$temp"),
      (eq, reg1, "$temp_2"),
      (str_clear, s12),
      (try_begin),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 8, "trp_player"),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
        (str_store_string, s12, "str_but_if_this_goes_badly"),
      (try_end),
    ],
    "All right. I will do that.{s12}",
    "lord_pretalk",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", "$temp", "$temp_2"),
      (str_clear, s12),
      (try_begin),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 8, "trp_player"),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "trp_player"),
        (str_store_string, s12, "str_but_if_this_goes_badly"),
      (try_end),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_give_order_answer",
    [],
    "I am sorry. I need to attend my own business at the moment.",
    "lord_pretalk",
    [
      (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", reg0, reg1),
    ]],

  [anyone, "lord_start",
    [],
    "What is it?",
    "lord_talk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 0),
      (faction_slot_eq, "$players_kingdom", 4, 6),
    ],
    "I want to start a new campaign. Let us assemble the army here.",
    "lord_give_order_call_to_arms_verify",
    []],

  [anyone, "lord_give_order_call_to_arms_verify",
    [],
    "You wish to summon all lords for a new campaign?",
    "lord_give_order_call_to_arms_verify_2",
    []],

  [plyr|anyone, "lord_give_order_call_to_arms_verify_2",
    [],
    "Yes. We must gather all our forces before we march on the enemy.",
    "lord_give_order_call_to_arms",
    []],

  [plyr|anyone, "lord_give_order_call_to_arms_verify_2",
    [],
    "On second thought, it won't be necessary to summon everyone.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_call_to_arms",
    [],
    "All right then. I will send messengers and tell everyone to come here.",
    "lord_pretalk",
    [
      (assign, "$player_marshal_ai_state", 1),
      (assign, "$player_marshal_ai_object", "p_main_party"),
      (call_script, "script_decide_faction_ai", "$players_kingdom"),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (neg|faction_slot_eq, "$players_kingdom", 4, 0),
      (neg|faction_slot_eq, "$players_kingdom", 4, 6),
    ],
    "I want to end the campaign and let everyone return home.",
    "lord_give_order_disband_army_verify",
    []],

  [anyone, "lord_give_order_disband_army_verify",
    [],
    "You want to end the current campaign and release all lords from duty?",
    "lord_give_order_disband_army_2",
    []],

  [plyr|anyone, "lord_give_order_disband_army_2",
    [],
    "Yes. We no longer need all our forces here.",
    "lord_give_order_disband_army",
    []],

  [plyr|anyone, "lord_give_order_disband_army_2",
    [],
    "On second thought, it will be better to stay together for now.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_order_disband_army",
    [],
    "All right. I will let everyone know that they are released from duty.",
    "lord_pretalk",
    [
      (assign, "$player_marshal_ai_state", 0),
      (assign, "$player_marshal_ai_object", -1),
      (call_script, "script_decide_faction_ai", "$players_kingdom"),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (ge, "$g_encountered_party_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "I wish to ask you something.",
    "lord_talk_ask_something",
    []],

  [anyone, "lord_talk_ask_something",
    [],
    "Aye? What is it?",
    "lord_talk_ask_something_2",
    []],

  [anyone, "lord_talk_ask_something_again",
    [],
    "Is there anything else?",
    "lord_talk_ask_something_2",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (eq, "$event_rand_1_can_ask", 1),
      (store_character_level, ":var0", "trp_player"),
      (ge, ":var0", 20),
      (neg|check_quest_active, "qst_order_challenge"),
      (troop_get_slot, ":var1", "$g_talk_troop", 22),
      (ge, ":var1", 40),
    ],
    "I am looking for good soldiers, my friend. Could you help me out somehow?",
    "ask_companions_for_unique_troops",
    [
      (call_script, "script_ask_companions_for_unique_troops", "$g_talk_troop", 2),
    ]],

  [anyone, "ask_companions_for_unique_troops",
    [
      (this_or_next|eq, reg35, -1),
      (eq, reg36, -1),
    ],
    "Unfortunately, not now, but ask me again anytime in the following week.",
    "close_window",
    [
      (assign, "$event_rand_1_can_ask", 0),
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "ask_companions_for_unique_troops",
    [
      (neq, reg35, -1),
      (neq, reg36, -1),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (eq, ":var0", 0),
    ],
    "I could, but you have no space in your party.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "ask_companions_for_unique_troops",
    [
      (neq, reg35, -1),
      (neq, reg36, -1),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (gt, ":var0", 0),
      (val_min, reg36, ":var0"),
      (call_script, "script_game_get_join_cost_selectable", reg35, 125, 120),
      (store_mul, reg37, reg36, reg0),
      (str_store_troop_name, s0, reg35),
    ],
    "{reg63?Sire:Madame}, maybe I will be able to help you. ^^Not too long ago, I noticed several {s0} whom I could try convince to join our ranks. Give me, say, {reg37} denars and I will have enough incentive to make an attempt at swaying them into joining us. I will set a location for to make the offer and meet you back here shortly. Soldiers have a hard time resisting good coin. ^^What do you think about my plan?",
    "ask_companions_for_unique_troops_2",
    []],

  [plyr|anyone, "ask_companions_for_unique_troops_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg37),
    ],
    "Bit expensive, but I will take you up on your offer. Take the coin.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg37),
      (party_add_members, "p_main_party", reg35, reg36),
      (try_begin),
        (eq, "$g_talk_troop", "trp_npc_kaverra"),
        (display_log_message, "@{reg36}x {s0} have joined your party. You have noticed Kaverra's smile. Deadly one ...", 0xFFAA00),
      (else_try),
        (display_log_message, "@{reg36}x {s0} have joined your party."),
      (try_end),
      (assign, "$event_rand_1_can_ask", 0),
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "ask_companions_for_unique_troops_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg37),
    ],
    "Though your plan sounds reasonable, it is such that I do not wish to spend this many denars.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "ask_companions_for_unique_troops_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", reg37),
    ],
    "That is way too much!",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "I want to know the location of someone.",
    "lord_talk_ask_location",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [],
    "Can you tell me of any events or news?",
    "lord_tell_news",
    []],

  [anyone, "lord_tell_news",
    [
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_village_1"),
        (party_get_num_attached_parties, ":var2", "$g_encountered_party"),
        (try_for_range, ":var3", 0, ":var2"),
          (party_get_attached_party_with_rank, ":var4", "$g_encountered_party", ":var3"),
          (party_stack_get_troop_id, ":var5", ":var4", 0),
          (eq, ":var5", "$g_talk_troop"),
          (assign, ":var2", 0),
        (try_end),
        (eq, ":var5", "$g_talk_troop"),
        (party_get_slot, ":var0", ":var4", 300),
        (assign, ":var1", 1),
      (else_try),
        (party_get_slot, ":var0", "$g_encountered_party", 300),
      (try_end),
      (val_add, ":var0", 2),
      (store_current_day, ":var6"),
      (try_begin),
        (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
        (try_begin),
          (troop_slot_ge, "$g_talk_troop", 22, 0),
          (lt, ":var0", ":var6"),
          (store_troop_faction, ":var7", "$g_talk_troop"),
          (call_script, "script_main_scenario_external", ":var7"),
          (try_begin),
            (eq, ":var1", 1),
            (party_set_slot, ":var4", 300, ":var6"),
          (else_try),
            (party_set_slot, "$g_encountered_party", 300, ":var6"),
          (try_end),
        (else_try),
          (str_store_string, s4, "@ Perhaps, but I prefer not to spread gossip."),
        (try_end),
      (else_try),
        (str_store_string, s4, "@ I am a prisoner, how could I possibly know of any news?"),
      (try_end),
    ],
    "{s4}",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 10, -1),
    ],
    "What are you and your men doing?",
    "lord_tell_objective",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 4),
      (party_get_slot, ":var1", "$g_talk_troop_party", 5),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (1638, reg4, "$g_talk_troop_party"),
        (1646, reg5, "$g_talk_troop_party"),
        (display_message, "@{!}DEBUG : Initiative {reg4}, helpfulness {reg5}"),
      (try_end),
      (str_clear, s14),
      (str_clear, s15),
      (str_clear, s16),
      (try_begin),
        (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
        (eq, reg0, ":var0"),
        (eq, reg1, ":var1"),
      (else_try),
        (call_script, "script_party_set_ai_state", "$g_talk_troop_party", reg0, reg1),
        (str_store_string, s14, "str_however_circumstances_have_changed_since_we_made_that_decision_and_i_may_reconsider_shortly_s16"),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (display_message, "@{!}DEBUG -- ai behavior: {reg0}, ai object: {reg1}"),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "What is the realm doing?",
    "lord_talk_ask_about_strategy",
    []],

  [anyone, "lord_talk_ask_about_strategy",
    [
      (eq, "$players_kingdom", "$g_talk_troop_faction"),
      (faction_slot_eq, "$g_talk_troop_faction", 8, "trp_player"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
    ],
    "You should decide that, as you are the marshal.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "How goes the war?",
    "lord_talk_ask_about_war",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (assign, reg26, 0),
      (assign, reg61, 0),
      (store_troop_faction, ":var0", "$g_talk_troop"),
      (eq, ":var0", "$players_kingdom"),
      (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
      (ge, reg0, 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 7, "$g_talk_troop"),
        (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var2", 7, "trp_player"),
          (neq, ":var2", "$g_player_court"),
          (assign, ":var3", 1),
          (try_begin),
            (eq, ":var1", "p_town_1"),
            (eq, "$g_talk_troop", "trp_kingdom_4_lord"),
            (assign, ":var3", 0),
          (else_try),
            (eq, ":var1", "p_town_5"),
            (eq, "$g_talk_troop", "trp_kingdom_5_lord"),
            (assign, ":var3", 0),
          (else_try),
            (eq, ":var1", "p_town_6"),
            (eq, "$g_talk_troop", "trp_kingdom_1_lord"),
            (assign, ":var3", 0),
          (else_try),
            (eq, ":var1", "p_town_8"),
            (eq, "$g_talk_troop", "trp_kingdom_2_lord"),
            (assign, ":var3", 0),
          (else_try),
            (eq, ":var1", "p_town_10"),
            (eq, "$g_talk_troop", "trp_kingdom_3_lord"),
            (assign, ":var3", 0),
          (try_end),
          (eq, ":var3", 1),
          (neg|party_slot_ge, ":var2", 54, 1),
          (neg|party_slot_ge, ":var2", 34, 1),
          (party_get_slot, ":var4", ":var2", 0),
          (party_get_slot, ":var5", ":var1", 0),
          (try_begin),
            (eq, ":var4", 2),
            (val_add, ":var4", 1),
          (else_try),
            (eq, ":var4", 3),
            (val_sub, ":var4", 1),
          (try_end),
          (try_begin),
            (eq, ":var5", 2),
            (val_add, ":var5", 1),
          (else_try),
            (eq, ":var5", 3),
            (val_sub, ":var5", 1),
          (try_end),
          (le, ":var4", ":var5"),
          (assign, ":var6", 5),
        (try_end),
      (try_end),
      (eq, ":var6", 5),
    ],
    "Would you like to exchange fiefs?",
    "lord_ask_exchange_fiefs",
    []],

  [anyone, "lord_ask_exchange_fiefs",
    [],
    "It depends. Which one of my fiefs would you like to have?",
    "lord_select_his_fief",
    []],

  [plyr|anyone, "lord_select_his_fief",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [repeat_for_parties|plyr|anyone, "lord_select_his_fief",
    [
      (store_repeat_object, ":var0"),
      (party_slot_eq, ":var0", 7, "$g_talk_troop"),
      (assign, ":var1", 1),
      (try_begin),
        (eq, ":var0", "p_town_1"),
        (eq, "$g_talk_troop", "trp_kingdom_4_lord"),
        (assign, ":var1", 0),
      (else_try),
        (eq, ":var0", "p_town_5"),
        (eq, "$g_talk_troop", "trp_kingdom_5_lord"),
        (assign, ":var1", 0),
      (else_try),
        (eq, ":var0", "p_town_6"),
        (eq, "$g_talk_troop", "trp_kingdom_1_lord"),
        (assign, ":var1", 0),
      (else_try),
        (eq, ":var0", "p_town_8"),
        (eq, "$g_talk_troop", "trp_kingdom_2_lord"),
        (assign, ":var1", 0),
      (else_try),
        (eq, ":var0", "p_town_10"),
        (eq, "$g_talk_troop", "trp_kingdom_3_lord"),
        (assign, ":var1", 0),
      (try_end),
      (eq, ":var1", 1),
      (str_store_party_name, s13, ":var0"),
    ],
    "{s13}",
    "lord_respond_exchange_fiefs_his_fief",
    [
      (store_repeat_object, "$lord_selected"),
      (str_store_party_name, s13, "$lord_selected"),
    ]],

  [anyone, "lord_respond_exchange_fiefs_his_fief",
    [],
    "So, {s13} it is. Interesting. But what fief will you give me in exchange?",
    "lord_select_my_fief",
    []],

  [plyr|anyone, "lord_select_my_fief",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [repeat_for_parties|plyr|anyone, "lord_select_my_fief",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var0", 7, "trp_player"),
      (neq, ":var0", "$g_player_court"),
      (neg|party_slot_ge, ":var0", 54, 1),
      (neg|party_slot_ge, ":var0", 34, 1),
      (party_get_slot, ":var1", ":var0", 0),
      (party_get_slot, ":var2", "$lord_selected", 0),
      (try_begin),
        (eq, ":var1", 2),
        (val_add, ":var1", 1),
      (else_try),
        (eq, ":var1", 3),
        (val_sub, ":var1", 1),
      (try_end),
      (try_begin),
        (eq, ":var2", 2),
        (val_add, ":var2", 1),
      (else_try),
        (eq, ":var2", 3),
        (val_sub, ":var2", 1),
      (try_end),
      (ge, ":var2", ":var1"),
      (str_store_party_name, s12, ":var0"),
    ],
    "{s12}",
    "lord_respond_exchange_fiefs_my_fief",
    [
      (store_repeat_object, "$fief_selected"),
      (str_store_party_name, s12, "$fief_selected"),
      (party_get_slot, ":var0", "$fief_selected", 0),
      (party_get_slot, ":var1", "$lord_selected", 0),
      (try_begin),
        (eq, ":var0", 2),
        (val_add, ":var0", 1),
      (else_try),
        (eq, ":var0", 3),
        (val_sub, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var1", 2),
        (val_add, ":var1", 1),
      (else_try),
        (eq, ":var1", 3),
        (val_sub, ":var1", 1),
      (try_end),
      (store_sub, reg26, ":var1", ":var0"),
    ]],

  [anyone, "lord_respond_exchange_fiefs_my_fief",
    [
      (party_get_slot, ":var0", "$fief_selected", 50),
      (party_get_slot, ":var1", "$lord_selected", 50),
      (store_sub, ":var2", ":var1", ":var0"),
      (val_mul, ":var2", 50),
      (store_mul, ":var3", reg26, 5000),
      (val_sub, ":var2", ":var3"),
      (assign, ":var4", 0),
      (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 7, "$g_talk_troop"),
        (assign, ":var6", 0),
        (try_for_range, ":var7", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var7", 7, "$g_talk_troop"),
          (store_distance_to_party_from_party, ":var8", ":var5", ":var7"),
          (val_add, ":var6", ":var8"),
        (try_end),
        (try_begin),
          (eq, ":var4", 0),
          (assign, ":var9", ":var6"),
          (assign, ":var4", 1),
        (try_end),
        (assign, ":var10", ":var6"),
        (val_min, ":var9", ":var10"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg61, ":var9"),
        (display_message, "str_archery_target_hit"),
      (try_end),
      (assign, ":var4", 0),
      (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
        (neq, ":var5", "$lord_selected"),
        (this_or_next|eq, ":var5", "$fief_selected"),
        (party_slot_eq, ":var5", 7, "$g_talk_troop"),
        (assign, ":var6", 0),
        (try_for_range, ":var7", "p_town_1", "p_salt_mine"),
          (neq, ":var7", "$lord_selected"),
          (this_or_next|eq, ":var7", "$fief_selected"),
          (party_slot_eq, ":var7", 7, "$g_talk_troop"),
          (store_distance_to_party_from_party, ":var8", ":var5", ":var7"),
          (val_add, ":var6", ":var8"),
        (try_end),
        (try_begin),
          (eq, ":var4", 0),
          (assign, ":var11", ":var6"),
          (assign, ":var4", 1),
        (try_end),
        (assign, ":var12", ":var6"),
        (val_min, ":var11", ":var12"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg61, ":var11"),
        (display_message, "str_archery_target_hit"),
      (try_end),
      (store_sub, ":var13", ":var11", ":var9"),
      (val_mul, ":var13", 50),
      (val_add, ":var2", ":var13"),
      (assign, ":var14", 0),
      (try_begin),
        (this_or_next|party_slot_eq, "$fief_selected", 0, 2),
        (party_slot_eq, "$fief_selected", 0, 3),
        (call_script, "script_party_calculate_strength", "$fief_selected", 0),
        (neq, reg0, 0),
        (assign, ":var14", reg0),
      (try_end),
      (try_begin),
        (party_slot_eq, "$lord_selected", 0, 4),
        (val_sub, ":var2", ":var14"),
      (try_end),
      (try_begin),
        (party_slot_ge, "$fief_selected", 289, 1),
        (assign, ":var15", 10000),
      (else_try),
        (assign, ":var15", 0),
      (try_end),
      (try_begin),
        (party_slot_ge, "$lord_selected", 289, 1),
        (party_get_slot, ":var16", "$lord_selected", 289),
        (try_begin),
          (is_between, ":var16", "trp_dragon_knight", "trp_griffon_knight"),
          (assign, ":var17", 60000),
        (else_try),
          (this_or_next|is_between, ":var16", "trp_ebony_gauntlet", "trp_zombie"),
          (eq, ":var16", "trp_griffon_knight"),
          (neq, ":var16", "trp_eventide_knight"),
          (assign, ":var17", 120000),
        (else_try),
          (assign, ":var17", 40000),
        (try_end),
      (else_try),
        (assign, ":var17", 0),
      (try_end),
      (val_add, ":var2", ":var17"),
      (val_sub, ":var2", ":var15"),
      (assign, reg26, ":var2"),
      (gt, reg26, 500),
    ],
    "Hmm. This suggestion of yours is not exactly beneficial for me. However, I will agree to this as a sign of my good will, but only if you pay me {reg26} denars to at least partially compensate for my losses.",
    "lord_agree_or_not_to_fief_exchange",
    []],

  [anyone, "lord_respond_exchange_fiefs_my_fief",
    [
      (gt, reg26, -500),
      (le, reg26, 500),
    ],
    "All right, {playername}. Your suggestion sounds reasonable enough. So, is this a deal?",
    "lord_agree_or_not_to_fief_exchange",
    []],

  [anyone, "lord_respond_exchange_fiefs_my_fief",
    [
      (le, reg26, -500),
      (store_mul, reg61, reg26, -1),
      (troop_get_slot, ":var0", "$g_talk_troop", 11),
      (val_min, reg61, ":var0"),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s11, "@I would even pay you some extra, but I don't have any gold with me at the moment. Do have a deal?"),
      (else_try),
        (str_store_string, s11, "@I am even willing to pay you {reg61} denars in addition! So, is this a deal?"),
      (try_end),
    ],
    "What a splendid proposal, {playername}! {s11}",
    "lord_agree_or_not_to_fief_exchange",
    []],

  [plyr|anyone, "lord_agree_or_not_to_fief_exchange",
    [
      (assign, ":var0", 0),
      (try_begin),
        (gt, reg26, 500),
        (store_troop_gold, ":var1", "trp_player"),
        (ge, ":var1", reg26),
        (assign, ":var0", 10),
      (else_try),
        (le, reg26, 500),
        (assign, ":var0", 10),
      (try_end),
      (eq, ":var0", 10),
    ],
    "Deal!",
    "lord_confirm_exchange_fiefs",
    []],

  [plyr|anyone, "lord_agree_or_not_to_fief_exchange",
    [],
    "Actually, never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_confirm_exchange_fiefs",
    [
      (str_store_party_name, s13, "$lord_selected"),
      (str_store_party_name, s12, "$fief_selected"),
    ],
    "Excellent! Then, as agreed, I am giving you {s13}, and you are giving me {s12}.",
    "lord_pretalk",
    [
      (try_begin),
        (gt, reg26, 500),
        (troop_remove_gold, "trp_player", reg26),
        (troop_get_slot, ":var0", "$g_talk_troop", 11),
        (val_add, ":var0", reg26),
        (troop_set_slot, "$g_talk_troop", 11, ":var0"),
      (else_try),
        (le, reg26, -500),
        (troop_add_gold, "trp_player", reg61),
        (troop_get_slot, ":var0", "$g_talk_troop", 11),
        (val_sub, ":var0", reg61),
        (try_begin),
          (lt, ":var0", 0),
          (assign, ":var0", 0),
        (try_end),
        (troop_set_slot, "$g_talk_troop", 11, ":var0"),
      (try_end),
      (call_script, "script_give_center_to_lord_exchange", "$lord_selected", "trp_player"),
      (call_script, "script_give_center_to_lord_exchange", "$fief_selected", "$g_talk_troop"),
      (try_begin),
        (neg|party_slot_ge, "$lord_selected", 0, 4),
        (neg|party_slot_ge, "$fief_selected", 0, 4),
        (party_clear, "p_temp_party"),
        (party_get_num_companion_stacks, ":var1", "$lord_selected"),
        (party_get_num_prisoner_stacks, ":var2", "$lord_selected"),
        (try_for_range, ":var3", 0, ":var1"),
          (party_stack_get_troop_id, ":var4", "$lord_selected", ":var3"),
          (party_stack_get_size, ":var5", "$lord_selected", ":var3"),
          (party_force_add_members, "p_temp_party", ":var4", ":var5"),
        (try_end),
        (try_for_range, ":var6", 0, ":var2"),
          (party_prisoner_stack_get_troop_id, ":var7", "$lord_selected", ":var6"),
          (party_prisoner_stack_get_size, ":var8", "$lord_selected", ":var6"),
          (party_force_add_prisoners, "p_temp_party", ":var7", ":var8"),
        (try_end),
        (party_clear, "$lord_selected"),
        (party_get_num_companion_stacks, ":var9", "$fief_selected"),
        (try_for_range, ":var10", 0, ":var9"),
          (party_stack_get_troop_id, ":var11", "$fief_selected", ":var10"),
          (party_stack_get_size, ":var12", "$fief_selected", ":var10"),
          (party_force_add_members, "$lord_selected", ":var11", ":var12"),
        (try_end),
        (party_get_num_prisoner_stacks, ":var13", "$fief_selected"),
        (try_for_range, ":var14", 0, ":var13"),
          (party_prisoner_stack_get_troop_id, ":var15", "$fief_selected", ":var14"),
          (party_prisoner_stack_get_size, ":var16", "$fief_selected", ":var14"),
          (party_force_add_prisoners, "$lord_selected", ":var15", ":var16"),
        (try_end),
        (party_clear, "$fief_selected"),
        (party_get_num_companion_stacks, ":var17", "p_temp_party"),
        (try_for_range, ":var18", 0, ":var17"),
          (party_stack_get_troop_id, ":var19", "p_temp_party", ":var18"),
          (party_stack_get_size, ":var20", "p_temp_party", ":var18"),
          (party_force_add_members, "$fief_selected", ":var19", ":var20"),
        (try_end),
        (party_get_num_prisoner_stacks, ":var20", "p_temp_party"),
        (try_for_range, ":var21", 0, ":var20"),
          (party_prisoner_stack_get_troop_id, ":var22", "p_temp_party", ":var21"),
          (party_prisoner_stack_get_size, ":var23", "p_temp_party", ":var21"),
          (party_force_add_prisoners, "$fief_selected", ":var22", ":var23"),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (check_quest_active, "qst_formal_marriage_proposal"),
      (neg|check_quest_failed, "qst_formal_marriage_proposal"),
      (neg|check_quest_succeeded, "qst_formal_marriage_proposal"),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (quest_slot_eq, "qst_formal_marriage_proposal", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (str_store_troop_name, s10, ":var0"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
      (try_begin),
        (gt, reg0, 20),
        (str_store_string, s19, "str_i_wish_to_marry_your_s11_s10_i_ask_for_your_blessing"),
      (else_try),
        (str_store_string, s19, "str_i_wish_to_marry_your_s11_s10_i_ask_for_your_help"),
      (try_end),
    ],
    "{s19}",
    "lord_marriage_permission",
    []],

  [anyone, "lord_marriage_permission",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 38, 1),
    ],
    "Great heaven, man -- if I haven't given you permission to see her, do you think I'm going to give you permission to marry her?",
    "lord_pretalk",
    [
      (call_script, "script_fail_quest", "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [anyone, "lord_marriage_permission",
    [
      (troop_slot_eq, "$g_talk_troop", 38, 1),
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
      (lt, reg0, 20),
      (neg|troop_slot_eq, "$g_talk_troop", 52, 5),
      (neg|troop_slot_eq, "$g_talk_troop", 52, 3),
      (neg|troop_slot_eq, "$g_talk_troop", 52, 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "It is not my way to push my {s11} to marry against her will or her better judgment",
    "lord_pretalk",
    [
      (call_script, "script_fail_quest", "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [anyone, "lord_marriage_permission",
    [
      (troop_slot_eq, "$g_talk_troop", 38, 1),
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
      (lt, reg0, 20),
      (assign, ":var1", "$g_talk_troop_relation"),
      (try_for_range, ":var2", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (this_or_next|troop_slot_eq, ":var2", 35, ":var0"),
        (this_or_next|troop_slot_eq, ":var2", 36, ":var0"),
        (troop_slot_eq, ":var2", 37, ":var0"),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var2"),
        (gt, reg0, ":var1"),
        (assign, ":var1", reg0),
        (str_store_troop_name, s12, ":var2"),
      (try_end),
      (gt, ":var1", "$g_talk_troop_relation"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Sorry, lad -- I'm not going to make my {s11} marry you, when I'd rather see her married to {s12}",
    "lord_pretalk",
    [
      (call_script, "script_fail_quest", "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [anyone, "lord_marriage_permission",
    [
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (str_store_troop_name, s11, ":var0"),
    ],
    "Splendid news, my young man -- I shall be proud to have you in our family. Now, let us talk the terms of the marriage. As per our custom, the two of us must make sure that {s11} has sufficient finances to support herself, in the event of any unforeseen circumstances...",
    "lord_marriage_permission_endowment",
    [
      (troop_get_slot, ":var0", "trp_player", 7),
      (troop_get_slot, ":var1", "$g_talk_troop", 7),
      (store_mul, "$marriage_dowry", ":var0", 20),
      (val_min, "$marriage_dowry", 20000),
      (store_mul, "$marriage_dower", ":var1", 20),
      (val_min, "$marriage_dower", 20000),
    ]],

  [anyone, "lord_marriage_permission_endowment",
    [
      (assign, reg3, "$marriage_dower"),
      (assign, reg4, "$marriage_dowry"),
    ],
    "I would say that, taking into consideration the prestige of our two houses, that you can provide a dower of {reg3} denars, while I will supply a dowry of {reg4} denars. This shall be her ladyship's property, as a security, lest for any reason you are unable to provide for her. What say you to that?",
    "lord_marriage_permission_endowment_answer",
    []],

  [plyr|anyone, "lord_marriage_permission_endowment_answer",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$marriage_dower"),
    ],
    "Very well -- so let it be.",
    "lord_marriage_permission_engagement_date",
    []],

  [plyr|anyone, "lord_marriage_permission_endowment_answer",
    [],
    "I cannot afford that right now.",
    "lord_marriage_permission_endowment_answer_delay",
    []],

  [plyr|anyone, "lord_marriage_permission_endowment_answer",
    [
      (eq, 1, 0),
    ],
    "That is too much to pay.",
    "lord_marriage_permission_endowment_answer_no",
    []],

  [anyone, "lord_marriage_permission_endowment_answer_no",
    [],
    "Well. I cannot in all decency allow my daughter to marry without some security, can I? Let me know if you change your mind.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_marriage_permission_engagement_date",
    [
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
      (assign, ":var1", reg1),
      (is_between, ":var1", "p_town_1", "p_village_1"),
      (party_slot_eq, ":var1", 35, 0),
      (str_store_party_name, s24, ":var1"),
    ],
    "Splendid! You two may now consider yourselves offically betrothed. Very well -- I shall plan to hold a great feast in {s24}, as soon as circumstances permit. We will be sure to notify you when the day comes.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_formal_marriage_proposal", 6),
      (troop_set_slot, "trp_player", 34, ":var0"),
      (troop_set_slot, ":var0", 34, "trp_player"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
      (troop_remove_gold, "trp_player", "$marriage_dower"),
      (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
      (assign, ":var1", reg1),
      (str_store_troop_name, s3, ":var0"),
      (str_store_troop_name, s4, "$g_talk_troop"),
      (str_store_party_name, s5, ":var1"),
      (setup_quest_text, "qst_wed_betrothed"),
      (str_store_string, s2, "str_you_plan_to_marry_s3_at_a_feast_hosted_by_s4_in_s5_you_should_be_notifed_of_the_feast_as_soon_as_it_is_held"),
      (call_script, "script_start_quest", "qst_wed_betrothed", "$g_talk_troop"),
      (quest_set_slot, "qst_wed_betrothed", 23, 365),
      (quest_set_slot, "qst_wed_betrothed", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_wed_betrothed", 2, ":var0"),
      (try_begin),
        (eq, "$talk_context", 2),
        (assign, "$g_leave_encounter", 1),
      (try_end),
    ]],

  [anyone, "lord_marriage_permission_engagement_date",
    [],
    "Unfortunately, there is one final complication -- there is no safe place to hold the wedding. Let us hold off on finalizing this, for the time being.",
    "close_window",
    []],

  [anyone, "lord_marriage_permission_endowment_answer_delay",
    [],
    "No matter -- take the time you need to raise the money. I want her ladyship to be well looked after.",
    "lord_pretalk",
    []],

  [anyone, "lord_marriage_permission_endowment_answer_delay",
    [],
    "That is a shame, but I would be remiss in my duty if I allowed her ladyship to face an uncertain future.",
    "lord_pretalk",
    [
      (call_script, "script_fail_quest", "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 38, 1),
      (assign, "$marriage_candidate", 0),
      (try_for_range, ":var0", "trp_knight_1_1_wife", "trp_heroes_end"),
        (eq, "$marriage_candidate", 0),
        (troop_slot_ge, ":var0", 5, 2),
        (neg|troop_slot_eq, ":var0", 5, 4),
        (neg|troop_slot_ge, ":var0", 30, 0),
        (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
        (eq, reg0, "$g_talk_troop"),
        (assign, "$marriage_candidate", ":var0"),
        (str_clear, s14),
        (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
        (gt, reg0, 0),
        (str_store_string, s14, "str_your_s11_"),
      (try_end),
      (gt, "$marriage_candidate", 0),
      (str_store_troop_name, s12, "$marriage_candidate"),
      (str_clear, s10),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 38, -1),
        (str_store_string, s10, "str_i_ask_again_may"),
      (else_try),
        (str_store_string, s10, "str_may"),
      (try_end),
    ],
    "{s10} I have the honor of visiting with {s14}{s12}?",
    "lord_courtship_permission",
    []],

  [anyone, "lord_courtship_permission",
    [
      (troop_slot_ge, "$marriage_candidate", 5, 2),
      (neg|troop_slot_eq, "$marriage_candidate", 5, 4),
      (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
      (troop_slot_eq, "$g_talk_troop", 52, 2),
      (call_script, "script_troop_get_relation_with_troop", "$marriage_candidate", "trp_player"),
      (gt, reg0, 0),
    ],
    "From what I hear, you have already spoken to her -- without my permission. Let me tell you this: I am her lord and guardian, and I have plans for her. I will not be mocked behind my back as a man who cannot control the women of his household. I would ask you not to discuss this matter with me again.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 38, -1),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -1),
    ]],

  [anyone, "lord_courtship_permission",
    [
      (call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", "$g_talk_troop", "trp_player"),
      (lt, reg0, 1),
      (str_store_string, s14, reg1),
    ],
    "{s14}",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 38, -1),
    ]],

  [anyone, "lord_courtship_permission",
    [
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 6),
        (str_store_string, s12, "str_very_well_as_far_as_im_concerned_i_suppose_she_can_see_most_anyone_she_likes__within_reason_of_course"),
      (else_try),
        (this_or_next|troop_slot_eq, "$g_talk_troop", 52, 5),
        (troop_slot_eq, "$g_talk_troop", 52, 2),
        (str_store_string, s12, "str_very_well_an_alliance_with_you_could_be_valuable_go_chat_with_her_and_see_if_you_can_get_her_to_take_a_fancy_to_you_if_she_doesnt_and_if_we_still_want_to_conclude_this_business_then_i_can_make_her_see_reason"),
      (else_try),
        (str_store_string, s12, "str_you_have_my_blessing_to_pay_suit_to_her__so_long_as_your_intentions_are_honorable_of_course_depending_on_how_things_proceed_between_you_two_we_may_have_more_to_discuss_at_a_later_date"),
      (try_end),
    ],
    "{s12}",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 38, 1),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (neg|troop_slot_eq, "$g_talk_troop", 38, 1),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (troop_get_type, ":var0", "$g_talk_troop"),
      (eq, ":var0", 0),
    ],
    "What would it take to cement a lasting alliance with your house?",
    "lord_talk_ask_marriage_1",
    []],

  [plyr|anyone, "lord_talk_ask_something_2",
    [
      (eq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (try_begin),
        (eq, ":var0", "fac_culture_6"),
        (assign, ":var1", "fac_player_supporters_faction"),
      (else_try),
        (store_sub, ":var1", ":var0", "fac_culture_1"),
        (val_add, ":var1", "fac_kingdom_1"),
      (try_end),
      (neg|troop_slot_eq, "$g_talk_troop", 14, ":var1"),
    ],
    "I want you to train your soldiers according to the customs of my kingdom.",
    "lord_change_culture",
    []],

  [anyone, "lord_change_culture",
    [
      (this_or_next|eq, "$g_talk_troop", "trp_npc_lethaldiran"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_boadice"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_roland"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_rayne"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_alistair"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_frederick"),
      (this_or_next|eq, "$g_talk_troop", "trp_npc_donavan"),
      (eq, "$g_talk_troop", "trp_npc_adonja"),
    ],
    "I am sorry, my {reg63?King:Queen}, I simply cannot train inferior soldiers.",
    "lord_pretalk",
    []],

  [anyone, "lord_change_culture",
    [],
    "Are you sure, my {reg63?King:Queen}?",
    "lord_change_culture_1",
    []],

  [plyr|anyone, "lord_change_culture_1",
    [],
    "Yes, obey my order.",
    "lord_change_culture_2",
    []],

  [plyr|anyone, "lord_change_culture_1",
    [],
    " Wait! Diversity in our forces may be beneficial to my new strategy.",
    "lord_change_culture_2_no",
    []],

  [anyone, "lord_change_culture_2_no",
    [],
    "As you wish, my {reg63?King:Queen}.",
    "lord_talk_ask_something_2",
    []],

  [anyone, "lord_change_culture_2",
    [],
    "As you wish, my {reg63?King:Queen}, though it pains me to abandon the ways of my forefathers.",
    "lord_talk_ask_something_2",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (try_begin),
        (eq, ":var0", "fac_culture_6"),
        (assign, ":var1", "fac_player_supporters_faction"),
      (else_try),
        (store_sub, ":var1", ":var0", "fac_culture_1"),
        (val_add, ":var1", "fac_kingdom_1"),
      (try_end),
      (troop_set_slot, "$g_talk_troop", 14, ":var1"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -5),
    ]],

  [plyr|anyone, "lord_talk_ask_something_2",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_location",
    [],
    "Very well, I may or may not have an answer for you. About whom do you wish to hear?",
    "lord_talk_ask_location_2",
    []],

  [repeat_for_troops|plyr|anyone, "lord_talk_ask_location_2",
    [
      (store_repeat_object, ":var0"),
      (neq, "$g_talk_troop", ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_heroes_end"),
      (neq, ":var0", "trp_player"),
      (this_or_next|troop_slot_eq, ":var0", 2, 2),
      (troop_slot_eq, ":var0", 2, 6),
      (store_troop_faction, ":var1", ":var0"),
      (eq, "$g_encountered_party_faction", ":var1"),
      (str_store_troop_name, s1, ":var0"),
      (try_begin),
        (faction_slot_eq, "$players_kingdom", 8, ":var0"),
        (str_store_string, s1, "@Our marshal, {s1}"),
      (try_end),
    ],
    "{s1}",
    "lord_talk_ask_location_3",
    [
      (store_repeat_object, "$hero_requested_to_learn_location"),
    ]],

  [plyr|anyone, "lord_talk_ask_location_2",
    [
      (is_between, "$g_talk_troop", "trp_knight_1_1_wife", "trp_heroes_end"),
    ],
    "Never mind.",
    "lady_pretalk",
    []],

  [plyr|anyone, "lord_talk_ask_location_2",
    [
      (neg|is_between, "$g_talk_troop", "trp_knight_1_1_wife", "trp_heroes_end"),
    ],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_location_3",
    [
      (is_between, "$g_talk_troop", "trp_knight_1_1_wife", "trp_heroes_end"),
      (call_script, "script_update_troop_location_notes", "$hero_requested_to_learn_location", 1),
      (call_script, "script_get_information_about_troops_position", "$hero_requested_to_learn_location", 0),
    ],
    "{s1}",
    "lady_pretalk",
    []],

  [anyone, "lord_talk_ask_location_3",
    [
      (call_script, "script_update_troop_location_notes", "$hero_requested_to_learn_location", 1),
      (call_script, "script_get_information_about_troops_position", "$hero_requested_to_learn_location", 0),
    ],
    "{s1}",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_about_war",
    [],
    "{s12}",
    "lord_talk_ask_about_war_2",
    [
      (assign, ":var0", 0),
      (try_for_range_backwards, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (store_relation, ":var2", ":var1", "$g_talk_troop_faction"),
        (lt, ":var2", 0),
        (try_begin),
          (eq, ":var0", 0),
          (str_store_faction_name_link, s12, ":var1"),
        (else_try),
          (eq, ":var0", 1),
          (str_store_faction_name_link, s11, ":var1"),
          (str_store_string, s12, "@{s11} and {s12}"),
        (else_try),
          (str_store_faction_name_link, s11, ":var1"),
          (str_store_string, s12, "@{!}{s11}, {s12}"),
        (try_end),
        (val_add, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s12, "@We are not at war with anyone."),
      (else_try),
        (str_store_string, s12, "@We are at war with {s12}."),
      (try_end),
    ]],

  [repeat_for_factions|plyr|anyone, "lord_talk_ask_about_war_2",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (store_relation, ":var1", ":var0", "$g_talk_troop_faction"),
      (lt, ":var1", 0),
      (str_store_faction_name, s1, ":var0"),
    ],
    "Tell me more about the war with {s1}.",
    "lord_talk_ask_about_war_details",
    [
      (store_repeat_object, "$faction_requested_to_learn_more_details_about_the_war_against"),
    ]],

  [plyr|anyone, "lord_talk_ask_about_war_2",
    [],
    "That's all I wanted to know. Thank you.",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_about_war_details",
    [],
    "{s9}.",
    "lord_talk_ask_about_war_2",
    [
      (store_add, ":var0", "$faction_requested_to_learn_more_details_about_the_war_against", 140),
      (val_sub, ":var0", "fac_player_supporters_faction"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", ":var0"),
      (store_add, ":var0", "$g_talk_troop_faction", 140),
      (val_sub, ":var0", "fac_player_supporters_faction"),
      (faction_get_slot, ":var2", "$faction_requested_to_learn_more_details_about_the_war_against", ":var0"),
      (val_max, ":var2", 1),
      (store_mul, ":var3", ":var1", 100),
      (val_div, ":var3", ":var2"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg3, ":var1"),
        (assign, reg4, ":var2"),
        (assign, reg5, ":var3"),
        (display_message, "str_war_damage_inflicted_reg3_suffered_reg4_ratio_reg5"),
      (try_end),
      (str_store_string, s9, "str_error__did_not_calculate_war_progress_string_properly"),
      (try_begin),
        (lt, ":var1", 5),
        (str_store_string, s9, "str_the_war_has_barely_begun_so_and_it_is_too_early_to_say_who_is_winning_and_who_is_losing"),
      (else_try),
        (gt, ":var1", 100),
        (gt, ":var3", 200),
        (str_store_string, s9, "str_we_have_been_hitting_them_very_hard_and_giving_them_little_chance_to_recover"),
      (else_try),
        (gt, ":var1", 80),
        (gt, ":var3", 150),
        (str_store_string, s9, "str_the_fighting_has_been_hard_but_we_have_definitely_been_getting_the_better_of_them"),
      (else_try),
        (gt, ":var2", 100),
        (lt, ":var3", 50),
        (str_store_string, s9, "str_they_have_been_hitting_us_very_hard_and_causing_great_suffering"),
      (else_try),
        (gt, ":var2", 80),
        (lt, ":var3", 68),
        (str_store_string, s9, "str_the_fighting_has_been_hard_and_i_am_afraid_that_we_have_been_having_the_worst_of_it"),
      (else_try),
        (gt, ":var2", 50),
        (gt, ":var1", 50),
        (gt, ":var3", 65),
        (str_store_string, s9, "str_both_sides_have_suffered_in_the_fighting"),
      (else_try),
        (gt, ":var3", 125),
        (str_store_string, s9, "str_no_clear_winner_has_yet_emerged_in_the_fighting_but_i_think_we_are_getting_the_better_of_them"),
      (else_try),
        (gt, ":var3", 80),
        (str_store_string, s9, "str_no_clear_winner_has_yet_emerged_in_the_fighting_but_i_fear_they_may_be_getting_the_better_of_us"),
      (else_try),
        (str_store_string, s9, "str_no_clear_winner_has_yet_emerged_in_the_fighting"),
      (try_end),
      (try_begin),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_talk_troop_faction", "$faction_requested_to_learn_more_details_about_the_war_against", -1),
        (str_store_string, s9, "str_s9_s14"),
      (try_end),
    ]],

  [anyone, "lord_talk_ask_about_strategy",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 4),
      (faction_get_slot, ":var1", "$g_encountered_party_faction", 5),
      (faction_get_slot, ":var2", "$g_encountered_party_faction", 8),
      (try_begin),
        (eq, ":var2", -1),
        (faction_get_slot, ":var2", "$g_encountered_party_faction", 11),
      (try_end),
      (call_script, "script_npc_decision_checklist_faction_ai_alt", ":var2"),
      (assign, ":var3", reg0),
      (assign, ":var4", reg1),
      (try_begin),
        (gt, ":var1", -1),
        (str_store_party_name, s8, ":var1"),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s7, "str_there_is_no_campaign_currently_in_progress"),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s7, "str_we_are_assembling_the_army"),
      (else_try),
        (eq, ":var0", 2),
        (str_store_string, s7, "str_we_aim_to_take_the_fortress_of_s8"),
      (else_try),
        (eq, ":var0", 3),
        (str_store_string, s7, "str_we_are_on_a_raid_and_are_now_targeting_s8"),
      (else_try),
        (eq, ":var0", 4),
        (str_store_string, s7, "str_we_are_trying_to_seek_out_and_defeat_s8"),
      (else_try),
        (eq, ":var0", 5),
        (str_store_string, s7, "str_we_are_riding_to_the_defense_of_s8"),
      (else_try),
        (eq, ":var0", 6),
        (str_store_string, s7, "str_we_are_gathering_for_a_feast_at_s8"),
      (try_end),
      (str_clear, s9),
      (try_begin),
        (eq, ":var0", 1),
        (faction_get_slot, ":var5", "$g_talk_troop_faction", 8),
        (gt, ":var5", -1),
        (troop_get_slot, ":var6", ":var5", 10),
        (party_is_active, ":var6"),
        (this_or_next|eq, "$g_talk_troop", ":var5"),
        (party_slot_eq, "$g_talk_troop_party", 5, ":var6"),
        (party_get_slot, ":var7", ":var6", 5),
        (try_begin),
          (eq, ":var7", -1),
          (str_store_string, s9, "str_we_are_waiting_here_for_vassals"),
        (else_try),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s9, "str_we_are_travelling_to_s11_for_vassals"),
        (try_end),
      (try_end),
      (try_begin),
        (this_or_next|neq, ":var0", ":var3"),
        (neq, ":var1", ":var4"),
        (str_store_string, s14, "str__however_that_may_change_shortly_s14"),
      (try_end),
    ],
    "{s7} {s9} {s14}",
    "lord_strategy_follow_evaluation",
    []],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 8, "$g_talk_troop"),
      (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 0),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
    ],
    "Did you have any other questions?",
    "lord_talk_ask_something_2",
    []],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 1),
      (call_script, "script_npc_decision_checklist_faction_ai_alt", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (neq, ":var0", 1),
      (store_current_hours, ":var1"),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 97),
      (val_sub, ":var1", ":var2"),
      (ge, ":var1", 40),
      (faction_get_slot, ":var3", "$g_talk_troop_faction", 8),
      (is_between, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var3", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var3"),
    ],
    "Our leader {s4} is far too cautious. {reg4?She:He} should either use the army to attack the enemy, or let it go home.",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ]],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 1),
      (store_current_hours, ":var0"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 97),
      (val_sub, ":var0", ":var1"),
      (ge, ":var0", 40),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var2", "$g_talk_troop"),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var2"),
      (lt, reg0, 5),
      (str_store_troop_name, s4, ":var2"),
    ],
    "Our army sits, doing nothing. Apparently, too few vassals have answered the call to arms. Perhaps {s4} does not enjoy the confidence of the great lords of this realm.",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ]],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (call_script, "script_npc_decision_checklist_faction_ai_alt", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 4, ":var0"),
      (assign, ":var1", 1),
      (try_begin),
        (eq, ":var0", 3),
        (str_store_string, s4, "@go on the offensive now."),
      (else_try),
        (eq, ":var0", 2),
        (str_store_string, s4, "@go on the offensive now."),
      (else_try),
        (eq, ":var0", 5),
        (str_store_string, s4, "@act to defend our lands."),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s4, "@take more time to gather the army."),
      (else_try),
        (assign, ":var1", 0),
      (try_end),
      (eq, ":var1", 1),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var2", "$g_talk_troop"),
      (str_store_troop_name, s10, ":var2"),
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ],
    "I disagree with this strategy. I would prefer to {s4}.",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ]],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 2),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 3),
      (call_script, "script_find_center_to_attack_alt", "$g_talk_troop", 1, 0),
      (assign, ":var0", reg0),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 5),
      (neq, ":var1", ":var0"),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var2", "$g_talk_troop"),
      (call_script, "script_npc_decision_checklist_evaluate_enemy_center_for_attack", ":var2", ":var0", 1, 0),
      (str_store_string, s9, reg1),
      (str_store_party_name, s8, ":var0"),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var2", "$g_talk_troop"),
      (str_store_troop_name, s10, ":var2"),
    ],
    "I personally would prefer to attack {s8}, but our marshal {s10} believes that it {s9}",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ]],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 4, 5),
      (call_script, "script_find_center_to_defend", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 5),
      (neq, ":var1", ":var0"),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neq, ":var2", "$g_talk_troop"),
      (str_store_party_name, s8, ":var0"),
      (str_store_party_name, s9, ":var1"),
    ],
    "I personally would prefer to defend {s8}, instead of {s9}.",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 1),
    ]],

  [anyone, "lord_strategy_follow_evaluation",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (neg|this_or_next|is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (eq, ":var0", "$g_talk_troop"),
    ],
    "Is there anything else?",
    "lord_talk",
    []],

  [anyone, "lord_strategy_follow_evaluation",
    [],
    "This strategy seems reasonable to me.",
    "lord_strategy_follow_up",
    [
      (assign, "$g_talk_troop_disagrees_with_marshal", 0),
    ]],

  [plyr|anyone, "lord_strategy_follow_up",
    [
      (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 2),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 3),
    ],
    "If you're attacking, why aren't you...",
    "lord_strategy_why_not",
    []],

  [plyr|anyone, "lord_strategy_follow_up",
    [],
    "I see....",
    "lord_talk_ask_something_again",
    []],

  [plyr|anyone, "lord_strategy_follow_up",
    [
      (eq, "$g_talk_troop_disagrees_with_marshal", 1),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Would you say, then, that {s4} should no longer be marshal?",
    "lord_talk_replace_marshal",
    []],

  [anyone, "lord_talk_replace_marshal",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 64),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (str_store_party_name, s4, ":var0"),
    ],
    "I believe that our realm should resolve the issue of {s4} before we begin to debate replacing the marshal.",
    "lord_talk_ask_something_again",
    []],

  [anyone, "lord_talk_replace_marshal",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 64, 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 154),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 8),
      (neq, ":var0", ":var1"),
      (try_begin),
        (gt, ":var0", -1),
        (str_store_troop_name, s4, ":var0"),
      (else_try),
        (str_store_string, s4, "str_i"),
      (try_end),
      (str_store_troop_name, s5, ":var1"),
    ],
    "Yes. I have already made my position on this matter clear. I believe that {s4} should be marshal instead of {s5}.",
    "lord_talk_ask_something_again",
    []],

  [anyone, "lord_talk_replace_marshal",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (assign, ":var1", reg0),
      (gt, ":var1", "$g_talk_troop_effective_relation"),
    ],
    "I will make up my mind on this matter without your persuasion, {reg63?sir:my lady}.",
    "lord_talk_ask_something_again",
    []],

  [anyone, "lord_talk_replace_marshal",
    [],
    "Hmm...",
    "lord_talk_replace_marshal_decision",
    [
      (faction_set_slot, "$g_talk_troop_faction", 64, 1),
    ]],

  [anyone, "lord_talk_replace_marshal_decision",
    [
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 8, ":var0"),
      (call_script, "script_troop_describes_troop_to_s15", "$g_talk_troop", ":var0"),
    ],
    "Yes, I would say that. At this point, I would be tempted to say that I support {s15} instead. I am glad that you and I had this discussion, so that I know that we are of the same mind on this matter.",
    "lord_talk_ask_something_again",
    [
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (troop_set_slot, "$g_talk_troop", 154, ":var0"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 8),
      (troop_get_slot, ":var2", ":var1", 150),
      (val_add, ":var2", 5),
      (troop_set_slot, ":var1", 150, ":var2"),
      (call_script, "script_troop_describes_troop_to_s15", "$g_talk_troop", ":var0"),
    ]],

  [anyone, "lord_talk_replace_marshal_decision",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Not necessarily. It is possible for {s4} and I have to have an honest disagreement over strategy, without my seeking to replace him.",
    "lord_talk_ask_something_again",
    []],

  [anyone, "lord_strategy_why_not",
    [],
    "Yes?",
    "lord_strategy_why_not_select",
    []],

  [plyr|anyone, "lord_strategy_why_not_select",
    [],
    "Never mind.",
    "lord_talk_ask_something_again",
    []],

  [plyr|anyone, "lord_strategy_why_not_select",
    [
      (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 3),
      (faction_slot_eq, "$g_talk_troop_faction", 4, 2),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 5),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 8),
      (gt, ":var1", -1),
      (call_script, "script_find_center_to_attack_alt", ":var1", 1, 0),
      (neq, reg0, ":var0"),
      (str_store_party_name, s4, ":var0"),
    ],
    "..planning to continue with the attack on {s4}?",
    "lord_strategy_why_not_reason",
    []],

  [repeat_for_parties|plyr|anyone, "lord_strategy_why_not_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "$g_talk_troop_faction"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 5, ":var0"),
      (neq, "$g_target_after_gathering", ":var0"),
      (party_slot_ge, ":var0", 67, 1),
      (str_store_party_name, s4, ":var0"),
    ],
    "..defending {s4}?",
    "lord_strategy_why_not_reason",
    [
      (store_repeat_object, "$temp"),
    ]],

  [repeat_for_parties|plyr|anyone, "lord_strategy_why_not_select",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$g_talk_troop_faction"),
      (lt, ":var2", 0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 5, ":var0"),
      (str_store_party_name, s4, ":var0"),
    ],
    "..attacking {s4}?",
    "lord_strategy_why_not_reason",
    [
      (store_repeat_object, "$temp"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (store_sub, ":var0", "$g_talk_troop_faction", "fac_player_supporters_faction"),
        (val_add, ":var0", 350),
        (store_current_hours, ":var1"),
        (party_get_slot, ":var2", "$temp", ":var0"),
        (val_sub, ":var1", ":var2"),
      (try_end),
    ]],

  [anyone, "lord_strategy_why_not_reason",
    [
      (assign, ":var0", "$temp"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "$g_talk_troop_faction"),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 8),
      (call_script, "script_find_center_to_defend", ":var2"),
      (assign, ":var3", reg0),
      (assign, ":var4", reg1),
      (assign, ":var5", reg2),
      (try_begin),
        (call_script, "script_find_center_to_attack_alt", ":var2", 1, 0),
        (assign, ":var6", reg1),
        (call_script, "script_find_center_to_attack_alt", ":var2", 1, 1),
        (assign, ":var7", reg1),
        (try_begin),
          (ge, ":var7", ":var6"),
          (assign, ":var8", ":var7"),
        (else_try),
          (assign, ":var8", ":var6"),
        (try_end),
        (gt, ":var8", ":var4"),
        (assign, reg4, ":var6"),
        (assign, reg5, ":var4"),
        (str_store_string, s9, "str_reason_1"),
      (else_try),
        (assign, ":var9", 0),
        (try_begin),
          (is_between, ":var0", "p_village_1", "p_salt_mine"),
          (is_between, ":var3", "p_town_1", "p_village_1"),
          (assign, ":var9", 1),
        (try_end),
        (try_begin),
          (is_between, ":var0", "p_castle_1", "p_village_1"),
          (is_between, ":var3", "p_town_1", "p_castle_1"),
          (assign, ":var9", 1),
        (try_end),
        (eq, ":var9", 1),
        (str_store_party_name, s8, ":var3"),
        (str_store_string, s9, "str_reason_2"),
      (else_try),
        (neq, ":var3", ":var0"),
        (str_store_party_name, s8, ":var3"),
        (str_store_string, s9, "str_reason_3"),
      (else_try),
        (troop_get_slot, ":var10", ":var2", 10),
        (party_is_active, ":var10"),
        (party_get_slot, ":var11", ":var10", 56),
        (party_get_slot, ":var12", ":var10", 59),
        (store_add, ":var13", ":var11", ":var12"),
        (ge, ":var5", ":var13"),
        (assign, reg4, ":var5"),
        (assign, reg5, ":var13"),
        (str_store_string, s9, "str_reason_4"),
      (else_try),
        (str_store_string, s9, "str_reason_5"),
      (try_end),
    ],
    "{s9}",
    "lord_talk_why_not_repeat",
    []],

  [anyone, "lord_strategy_why_not_reason",
    [
      (assign, ":var0", "$temp"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 8),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 5),
      (call_script, "script_npc_decision_checklist_evaluate_enemy_center_for_attack", ":var1", ":var2", 1, 0),
      (assign, "$g_faction_object_score", reg0),
      (assign, "$g_do_not_skip_other_than_current_ai_object", 1),
      (call_script, "script_npc_decision_checklist_evaluate_enemy_center_for_attack", ":var1", ":var0", 1, 0),
      (assign, "$g_do_not_skip_other_than_current_ai_object", 0),
      (lt, reg0, 0),
      (assign, ":var3", reg1),
      (try_begin),
        (eq, "$g_use_current_ai_object_as_s8", 0),
        (str_store_party_name, s8, ":var0"),
      (else_try),
        (str_store_party_name, s8, ":var2"),
      (try_end),
      (str_store_string, s9, ":var3"),
      (str_clear, s10),
      (str_store_troop_name, s11, ":var1"),
    ],
    "Our marshal {s11} believes that {s8} {s9}{s10}",
    "lord_talk_why_not_repeat",
    []],

  [anyone, "lord_strategy_why_not_reason",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 5),
      (call_script, "script_npc_decision_checklist_evaluate_enemy_center_for_attack", ":var0", ":var1", 1, 0),
      (assign, ":var2", reg2),
      (call_script, "script_npc_decision_checklist_evaluate_enemy_center_for_attack", ":var0", "$temp", 1, 0),
      (assign, ":var3", reg2),
      (try_begin),
        (eq, ":var3", 0),
        (str_store_string, s7, "str_reason_6"),
      (else_try),
        (lt, ":var3", 200),
        (str_store_string, s7, "str_reason_7"),
      (else_try),
        (is_between, ":var3", 200, 300),
        (str_store_string, s7, "str_reason_8"),
      (else_try),
        (ge, ":var3", 300),
        (str_store_string, s7, "str_reason_9"),
      (else_try),
        (str_store_string, s7, "str_error_string"),
      (try_end),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s8, "str_reason_6"),
      (else_try),
        (lt, ":var2", 200),
        (str_store_string, s8, "str_reason_7"),
      (else_try),
        (is_between, ":var2", 200, 300),
        (str_store_string, s8, "str_reason_8"),
      (else_try),
        (ge, ":var2", 300),
        (str_store_string, s8, "str_reason_9"),
      (else_try),
        (str_store_string, s8, "str_error_string"),
      (try_end),
      (try_begin),
        (ge, ":var1", 0),
        (str_store_party_name, s4, ":var1"),
      (else_try),
        (ge, "$g_target_after_gathering", 0),
        (str_store_party_name, s4, "$g_target_after_gathering"),
      (else_try),
        (str_store_party_name, s4, "str_error_string"),
      (try_end),
      (str_store_troop_name, s5, ":var0"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (store_sub, ":var4", "$g_talk_troop_faction", "fac_player_supporters_faction"),
        (val_add, ":var4", 350),
        (store_current_hours, ":var5"),
        (party_get_slot, ":var6", "$temp", ":var4"),
        (val_sub, ":var5", ":var6"),
        (store_sub, ":var4", "$g_talk_troop_faction", "fac_player_supporters_faction"),
        (val_add, ":var4", 350),
        (store_current_hours, ":var5"),
        (party_get_slot, ":var6", ":var1", ":var4"),
        (val_sub, ":var5", ":var6"),
      (try_end),
      (try_begin),
        (assign, ":var7", 0),
        (try_begin),
          (party_slot_eq, "$g_talk_troop_party", 4, 1),
          (lt, "$g_target_after_gathering", 0),
          (assign, ":var7", 1),
        (try_end),
        (this_or_next|eq, ":var7", 1),
        (this_or_next|faction_slot_eq, "$g_talk_troop_faction", 4, 2),
        (faction_slot_eq, "$g_talk_troop_faction", 4, 3),
        (str_store_string, s3, "str_has_decided_that_an_attack_on_"),
        (str_store_string, s6, "str_this_would_be_better_worth_the_effort"),
      (else_try),
        (str_store_string, s3, "str_has_decided_to_defend_"),
        (str_store_party_name, s9, "$temp"),
        (str_store_string, s6, "str_before_going_offensive_we_should_protect_our_lands_if_there_is_any_threat_so_this_can_be_reason_marshall_choosed_defending_s4"),
        (str_clear, s8),
      (try_end),
    ],
    "We could go there. {s7} However, {s5} {s3} {s4}. {s6} {s8}.",
    "lord_talk_why_not_repeat",
    []],

  [anyone, "lord_talk_why_not_repeat",
    [],
    "Did you have any similar questions? Why we are not...",
    "lord_strategy_why_not_select",
    []],

  [anyone, "lord_talk_ask_marriage_1",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "You will not take offense if I tell you that, as a king, I have other plans for my children.",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_marriage_1",
    [
      (assign, "$marriage_candidate", -1),
      (try_begin),
        (troop_get_type, ":var0", "trp_player"),
        (neq, ":var0", 0),
        (neq, ":var0", 3),
        (neq, ":var0", 4),
        (troop_slot_eq, "$g_talk_troop", 30, -1),
        (assign, "$marriage_candidate", "$g_talk_troop"),
      (else_try),
        (troop_get_type, ":var0", "trp_player"),
        (eq, ":var0", 0),
        (assign, "$marriage_candidate", -1),
        (try_for_range, ":var1", "trp_knight_1_1_wife", "trp_heroes_end"),
          (troop_slot_eq, ":var1", 30, -1),
          (troop_slot_eq, ":var1", 34, -1),
          (call_script, "script_get_kingdom_lady_social_determinants", ":var1"),
          (eq, reg0, "$g_talk_troop"),
          (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
          (assign, "$marriage_candidate", ":var1"),
          (str_store_troop_name, s14, "$marriage_candidate"),
          (str_store_string, s15, "str_it_is_our_custom_to_seal_any_such_alliances_with_marriage_and_in_fact_we_have_been_looking_for_a_suitable_groom_for_my_s11_s14"),
        (try_end),
      (try_end),
      (eq, "$marriage_candidate", -1),
    ],
    "It is our custom to seal any such alliances with marriage. Unfortunately, no one in my household is eligible to wed.",
    "lord_pretalk",
    []],

  [anyone, "lord_talk_ask_marriage_1",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "{s15}",
    "lord_courtship_pre_permission",
    []],

  [anyone, "lord_talk_ask_marriage_1",
    [
      (eq, "$marriage_candidate", "$g_talk_troop"),
    ],
    "Are you proposing that you and I marry?",
    "lord_marriage_proposal_female_pc_confirm",
    []],

  [plyr|anyone, "lord_courtship_pre_permission",
    [
      (neg|troop_slot_ge, "trp_player", 30, 1),
      (neg|troop_slot_ge, "trp_player", 34, 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
      (str_clear, s15),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 38, -1),
        (str_store_string, s15, "str_once_again_"),
      (try_end),
    ],
    "May I {s15}suggest that I be considered as a groom?",
    "lord_courtship_permission",
    []],

  [plyr|anyone, "lord_courtship_pre_permission",
    [
      (eq, "$cheat_mode", 2),
    ],
    "CHEAT -- Start engagement",
    "lord_marriage_permission_engagement_date",
    [
      (setup_quest_text, "qst_formal_marriage_proposal"),
      (str_store_string, s2, "str_cheat__marriage_proposal"),
      (call_script, "script_start_quest", "qst_formal_marriage_proposal", "$marriage_candidate"),
      (quest_set_slot, "qst_formal_marriage_proposal", 6, "$marriage_candidate"),
    ]],

  [plyr|anyone, "lord_courtship_pre_permission",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_marriage_proposal_female_pc_confirm",
    [],
    "Yes. That is my proposal.",
    "lord_marriage_proposal_female_pc_reax",
    []],

  [plyr|anyone, "lord_marriage_proposal_female_pc_confirm",
    [],
    "No, I think you have misunderstood me.",
    "lord_pretalk",
    []],

  [anyone, "lord_marriage_proposal_female_pc_reax",
    [
      (call_script, "script_npc_decision_checklist_marry_female_pc", "$g_talk_troop"),
      (le, reg0, 0),
    ],
    "{s14}",
    "lord_pretalk",
    []],

  [anyone, "lord_marriage_proposal_female_pc_reax",
    [
      (call_script, "script_npc_decision_checklist_marry_female_pc", "$g_talk_troop"),
      (eq, reg0, 2),
    ],
    "{s14}",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 5, 2),
    ]],

  [anyone, "lord_marriage_proposal_female_pc_reax",
    [],
    "{s14}",
    "lord_marriage_proposal_female_pc_next_step",
    []],

  [anyone, "lord_marriage_proposal_female_pc_next_step",
    [],
    "I suppose the next step would be for me to send a message to your family, asking for their permission to marry you, but I suppose that you make your own decisions.",
    "lord_marriage_proposal_female_pc_next_step_4",
    []],

  [plyr|anyone, "lord_marriage_proposal_female_pc_next_step_4",
    [],
    "You assume correctly.",
    "lord_marriage_proposal_female_pc_next_step_5",
    []],

  [anyone, "lord_marriage_proposal_female_pc_next_step_5",
    [],
    "Very well, then. As there are no obstacles to our marriage, should we then consider ourselves engaged to be wed? I will organize a great feast, and we can exchange our vows before all the lords of the realm. If you are willing, that is...",
    "lord_marriage_proposal_female_pc_confirm_engagement",
    []],

  [plyr|anyone, "lord_marriage_proposal_female_pc_confirm_engagement",
    [],
    "I am willing.",
    "lord_marriage_proposal_female_pc_confirm_engagement_yes",
    [
      (troop_set_slot, "$g_talk_troop", 34, "trp_player"),
      (troop_set_slot, "trp_player", 34, "$g_talk_troop"),
      (assign, "$g_other_quest", 0),
      (try_begin),
        (store_partner_quest, ":var0", "$g_talk_troop"),
        (gt, ":var0", 0),
        (assign, "$g_other_quest", ":var0"),
      (try_end),
      (str_store_troop_name, s4, "$g_talk_troop"),
      (setup_quest_text, "qst_wed_betrothed_female"),
      (str_store_string, s2, "str_you_plan_to_marry_s4_as_you_have_no_family_in_calradia_he_will_organize_the_wedding_feast"),
      (call_script, "script_start_quest", "qst_wed_betrothed_female", "$g_talk_troop"),
      (quest_set_slot, "qst_wed_betrothed_female", 23, 120),
      (quest_set_slot, "qst_wed_betrothed_female", 6, "$g_talk_troop"),
    ]],

  [plyr|anyone, "lord_marriage_proposal_female_pc_confirm_engagement",
    [],
    "Actually, I would like to reconsider.",
    "lord_marriage_proposal_female_pc_confirm_engagement_no",
    []],

  [anyone, "lord_marriage_proposal_female_pc_confirm_engagement_yes",
    [
      (str_clear, s12),
      (try_begin),
        (gt, "$g_other_quest", 0),
        (call_script, "script_succeed_quest", "$g_other_quest"),
        (call_script, "script_end_quest", "$g_other_quest"),
        (str_store_string, s12, "str_cancel_fiancee_quest"),
      (try_end),
    ],
    "Very well. Hopefully, a little over a month from now, we shall be wed.{s12}",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_marriage_proposal_female_pc_confirm_engagement_no",
    [],
    "Take whatever time you need, my lady.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$talk_context", 2),
      (lt, "$g_encountered_party_relation", 0),
      (str_store_troop_name, s4, "$g_talk_troop"),
    ],
    "I say this only once, {s4}! Surrender or die!",
    "party_encounter_lord_hostile_ultimatum_surrender",
    []],

  [anyone, "party_encounter_lord_hostile_ultimatum_surrender",
    [],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_challenged_default"),
      (call_script, "script_make_kingdom_hostile_to_player", "$g_encountered_party_faction", -3),
      (try_begin),
        (gt, "$g_talk_troop_relation", -10),
        (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (try_end),
      (assign, "$encountered_party_hostile", 1),
      (assign, "$encountered_party_friendly", 0),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$talk_context", 2),
      (neq, "$g_encountered_party_faction", "$players_kingdom"),
      (ge, "$g_encountered_party_relation", 0),
    ],
    "I'm here to deliver you my demands!",
    "lord_predemand",
    []],

  [anyone, "lord_predemand",
    [],
    "Eh? What do you want?",
    "lord_demand",
    []],

  [plyr|anyone, "lord_demand",
    [
      (neq, "$g_encountered_party_faction", "$players_kingdom"),
      (ge, "$g_encountered_party_relation", 0),
    ],
    "I offer you one chance to surrender or die.",
    "lord_ultimatum_surrender",
    []],

  [anyone, "lord_ultimatum_surrender",
    [
      (ge, "$g_encountered_party_relation", 0),
    ],
    "{s43}",
    "lord_attack_verify",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_unprovoked_attack_default"),
      (try_begin),
        (faction_slot_ge, "$g_encountered_party_faction", 120, 1),
        (str_store_faction_name, s34, "$g_encountered_party_faction"),
        (str_store_string, s43, "str_s43_just_so_you_know_if_you_attack_me_you_will_be_in_violation_of_the_truce_you_signed_with_the_s34"),
      (try_end),
      (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
        (str_store_string, s43, "str_s43_also_you_should_know_that_an_unprovoked_assault_is_declaration_of_war"),
      (try_end),
    ]],

  [plyr|anyone, "lord_attack_verify",
    [],
    "That is none of your business. Prepare to fight!",
    "lord_attack_verify_commit",
    []],

  [plyr|anyone, "lord_attack_verify",
    [],
    "Forgive me sir. I don't know what I was thinking.",
    "lord_attack_verify_cancel",
    []],

  [anyone, "lord_attack_verify_cancel",
    [],
    "Be gone, then.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ultimatum_surrender",
    [],
    "{s43}",
    "lord_attack_verify_b",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_unnecessary_attack_default"),
      (call_script, "script_make_kingdom_hostile_to_player", "$g_encountered_party_faction", -3),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
      (assign, "$encountered_party_hostile", 1),
      (assign, "$encountered_party_friendly", 0),
    ]],

  [plyr|anyone, "lord_attack_verify_b",
    [],
    "Forgive me sir. I don't know what I was thinking.",
    "lord_attack_verify_cancel",
    []],

  [plyr|anyone, "lord_attack_verify_b",
    [],
    "I stand my ground. Prepare to fight!",
    "lord_attack_verify_commit",
    []],

  [anyone, "lord_attack_verify_commit",
    [],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_challenged_default"),
      (try_begin),
        (ge, "$g_encountered_party_relation", 0),
        (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
      (try_end),
      (try_begin),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_make_kingdom_hostile_to_player", "$g_encountered_party_faction", -3),
      (else_try),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_diplomacy_start_war_between_kingdoms", "fac_player_supporters_faction", "$g_encountered_party_faction", 1),
      (try_end),
      (assign, "$encountered_party_hostile", 1),
      (assign, "$encountered_party_friendly", 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -30),
    ]],

  [plyr|anyone, "lord_demand",
    [],
    "Forgive me. It's nothing.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_talk",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (troop_slot_eq, "$g_talk_troop", 78, 0),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var1", 14, "$g_talk_troop_faction"),
        (assign, ":var0", ":var1"),
      (try_end),
      (troop_slot_ge, ":var0", 5, 1),
      (str_store_troop_name, s45, ":var0"),
      (troop_get_type, reg3, ":var0"),
    ],
    "I have met in my travels one who calls {reg3?herself:himself} {s45}...",
    "liege_defends_claim_1",
    []],

  [anyone, "liege_defends_claim_1",
    [],
    "Oh really? It is not everyone who dares mention that name in my presence. I am not sure whether to reward your bravery, or punish you for your impudence.",
    "liege_defends_claim_2",
    [
      (troop_set_slot, "$g_talk_troop", 78, 1),
    ]],

  [anyone, "liege_defends_claim_2",
    [],
    "Very well. I will indulge your curiosity. But listen closely, because I do not wish to speak of this matter again.",
    "liege_defends_claim_3",
    []],

  [anyone, "liege_defends_claim_3",
    [],
    "{s48}",
    "liege_defends_claim_4",
    [
      (store_sub, ":var0", "$g_talk_troop_faction", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_monarch_response_1"),
      (str_store_string, s48, ":var0"),
    ]],

  [anyone, "liege_defends_claim_4",
    [],
    "{s48}",
    "lord_talk",
    [
      (store_sub, ":var0", "$g_talk_troop_faction", "fac_kingdom_1"),
      (val_add, ":var0", "str_swadian_rebellion_monarch_response_2"),
      (str_store_string, s48, ":var0"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 8),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (neg|party_slot_eq, ":var0", 7, "trp_player"),
      (neq, "$talk_context", 18),
    ],
    "I've come to break you out of here.",
    "lord_prison_break_chains",
    []],

  [anyone, "lord_prison_break_chains",
    [],
    "Thank the heavens you came! However, I'm not going anywhere with these chains on my legs. You'll need to get the key away from the guard somehow.",
    "close_window",
    []],

  [plyr|anyone, "lord_talk",
    [
      (ge, "$cheat_mode", 1),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "{!}CHEAT - Take the following action.",
    "lord_suggest_action_ask",
    []],

  [anyone, "lord_tell_objective",
    [
      (troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "What am I doing? What does it look like I'm doing?! I'm a prisoner here!",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_objective",
    [
      (troop_slot_eq, "$g_talk_troop", 10, -1),
    ],
    "I am not commanding any men at the moment.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 7),
      (party_get_attached_to, ":var0", "$g_talk_troop_party"),
      (try_begin),
        (lt, ":var0", 0),
        (party_get_cur_town, ":var0", "$g_talk_troop_party"),
      (try_end),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
    ],
    "We are resting at {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 7),
    ],
    "We are travelling to {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (try_begin),
        (lt, ":var0", 1),
        (str_store_string, s1, "@nowhere"),
      (else_try),
        (str_store_party_name, s1, ":var0"),
      (try_end),
    ]],

  [auto_proceed|anyone, "lord_tell_objective",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 8, "$g_talk_troop"),
      (party_slot_eq, "$g_talk_troop_party", 4, 16),
    ],
    "{!}Warning: This line should never display.",
    "lord_tell_objective_2",
    []],

  [anyone, "lord_tell_objective_2",
    [],
    "I am heading to the vicinity of {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 16),
    ],
    "We are recruiting new soldiers from {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 4),
    ],
    "We are scouting for the enemy around {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 5),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ],
    "We are laying waste to the village of {s1}. {s14}{s15}",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 14),
    ],
    "We are retreating to {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 1),
    ],
    "We are besieging {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 10),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (party_is_active, ":var0"),
    ],
    "We are fighting against {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 12),
    ],
    "I am screening {s1}'s advance. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (str_store_troop_name, s1, ":var1"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (party_slot_eq, "$g_talk_troop_party", 4, 11),
    ],
    "We are accompanying {s1}. {s14}{s15}",
    "lord_pretalk",
    [
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "lord_tell_objective",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 8, "$g_talk_troop"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 4, 6),
    ],
    "I am leading the army of the realm.",
    "lord_talk_ask_about_strategy",
    []],

  [anyone, "lord_tell_objective",
    [
      (assign, ":var0", 0),
      (try_begin),
        (party_slot_eq, "$g_talk_troop_party", 4, -1),
        (assign, ":var0", 1),
      (else_try),
        (party_slot_eq, "$g_talk_troop_party", 4, 10),
        (party_get_slot, ":var1", "$g_talk_troop_party", 5),
        (neg|party_is_active, ":var1"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "We are reconsidering our next objective.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_objective",
    [],
    "I don't know: {reg1} {s1} (ERROR)",
    "lord_pretalk",
    [
      (party_get_slot, reg1, "$g_talk_troop_party", 4),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (str_store_party_name, s1, ":var0"),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (eq, "$talk_context", 2),
      (eq, 1, 0),
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (party_slot_eq, "$g_encountered_party", 31, 0),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 8, "trp_player"),
    ],
    "Will you follow me? I have a plan.",
    "lord_ask_follow",
    []],

  [anyone, "lord_ask_follow",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 33),
      (store_current_hours, ":var1"),
      (lt, ":var1", ":var0"),
    ],
    "I enjoy your company, {playername}, but there are other things I must attend to. Perhaps in a few days I can ride with you again.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_follow",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 7),
      (troop_get_slot, ":var1", "trp_player", 7),
      (val_mul, ":var0", 3),
      (val_div, ":var0", 4),
      (lt, ":var1", ":var0"),
    ],
    "That would hardly be proper, {playername}. Why don't you follow me instead?",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_follow",
    [
      (lt, "$g_talk_troop_effective_relation", 25),
    ],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_follow_refusal_default"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_follow",
    [],
    "Lead the way, {playername}! Let us bring death and defeat to all our enemies.",
    "close_window",
    [
      (party_set_slot, "$g_talk_troop_party", 30, "p_main_party"),
      (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", reg0, reg1),
      (store_current_hours, ":var0"),
      (store_add, ":var1", 30, "$g_talk_troop_relation"),
      (val_div, ":var1", 2),
      (val_add, ":var0", ":var1"),
      (party_set_slot, "$g_encountered_party", 32, ":var0"),
      (party_set_slot, "$g_encountered_party", 31, 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_talk_preoffer",
    [],
    "Yes?",
    "lord_talk_offer",
    []],

  [plyr|anyone, "lord_talk_offer",
    [
      (eq, 1, 0),
    ],
    "I wish to ransom one of your prisoners.",
    "knight_offer_join",
    []],

  [plyr|anyone, "lord_talk_offer",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "knight_offer_join",
    [
      (call_script, "script_cf_is_quest_troop", "$g_talk_troop"),
    ],
    "I fear I cannot join you at the moment, {playername}, I've important business to attend to and it cannot wait.",
    "hero_pretalk",
    []],

  [anyone, "knight_offer_join",
    [
      (lt, "$g_talk_troop_relation", 5),
      (store_character_level, ":var0", "trp_player"),
      (store_character_level, ":var1", "$g_talk_troop"),
      (val_mul, ":var0", 2),
      (lt, ":var0", ":var1"),
    ],
    "You forget your place, {reg63?sir:madam}. I do not take orders from the likes of you.",
    "hero_pretalk",
    []],

  [anyone, "knight_offer_join",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_heroes_end"),
        (troop_slot_eq, ":var1", 2, 5),
        (val_add, ":var0", 1),
      (try_end),
      (assign, reg5, ":var0"),
      (store_add, reg6, reg5, 1),
      (val_mul, reg6, reg6),
      (val_mul, reg6, 1000),
      (gt, reg6, 0),
    ],
    "I would be glad to fight at your side, my friend, but there is a problem... The thing is, I've found myself in a bit of debt that I must repay very soon. {reg6} denars altogether, and I am honor-bound to return every coin. Unless you've got {reg6} denars with you that you can spare, I've to keep my mind on getting this weight off my neck.",
    "knight_offer_join_2",
    []],

  [anyone, "knight_offer_join",
    [
      (gt, reg6, 100000),
    ],
    "Join you? I think not.",
    "close_window",
    []],

  [anyone, "knight_offer_join",
    [],
    "Aye, my friend, I'll be happy to join you.",
    "knight_offer_join_2",
    []],

  [plyr|anyone, "knight_offer_join_2",
    [
      (gt, reg6, 0),
      (store_troop_gold, ":var0", "trp_player"),
      (gt, ":var0", reg6),
    ],
    "Here, take it, all {reg6} denars you need. 'Tis only money.",
    "knight_offer_join_accept",
    [
      (troop_remove_gold, "trp_player", reg6),
    ]],

  [plyr|anyone, "knight_offer_join_2",
    [
      (le, reg6, 0),
    ],
    "Then let us ride together, my friend.",
    "knight_offer_join_accept",
    []],

  [plyr|anyone, "knight_offer_join_2",
    [
      (eq, "$talk_context", 8),
    ],
    "That's good to know. I will think on it.",
    "close_window",
    []],

  [plyr|anyone, "knight_offer_join_2",
    [
      (neq, "$talk_context", 8),
    ],
    "That's good to know. I will think on it.",
    "hero_pretalk",
    []],

  [anyone, "knight_offer_join_accept",
    [
      (troop_slot_ge, "$g_talk_troop", 10, 1),
    ],
    "I've some trusted men in my band who could be of use to you. What do you wish to do with them?",
    "knight_offer_join_accept_party",
    []],

  [anyone, "knight_offer_join_accept",
    [],
    "Ah, certainly, it might be fun!",
    "close_window",
    [
      (call_script, "script_recruit_troop_as_companion", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "knight_offer_join_accept_party",
    [],
    "You may disband your men. I've no need for other troops.",
    "knight_join_party_disband",
    []],

  [plyr|anyone, "knight_offer_join_accept_party",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 10),
      (party_can_join_party, ":var0", "p_main_party"),
    ],
    "Your men may join as well. We need every soldier we can muster.",
    "knight_join_party_join",
    []],

  [plyr|anyone, "knight_offer_join_accept_party",
    [
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
    ],
    "Lead your men out of the town. I shall catch up with you on the road.",
    "knight_join_party_lead_out",
    []],

  [plyr|anyone, "knight_offer_join_accept_party",
    [
      (neg|is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
    ],
    "Keep doing what you were doing. I'll catch up with you later.",
    "knight_join_party_lead_out",
    []],

  [anyone, "knight_join_party_disband",
    [],
    "Ah... Very well, {playername}. Much as I dislike losing good men, the decision is yours. I'll disband my troops and join you.",
    "close_window",
    [
      (call_script, "script_recruit_troop_as_companion", "$g_talk_troop"),
      (troop_get_slot, ":var0", "$g_talk_troop", 10),
      (party_detach, ":var0"),
      (remove_party, ":var0"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "knight_join_party_join",
    [],
    "Excellent. My lads and I will ride with you.",
    "close_window",
    [
      (call_script, "script_recruit_troop_as_companion", "$g_talk_troop"),
      (party_remove_members, "p_main_party", "$g_talk_troop", 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 10),
      (assign, "$g_move_heroes", 1),
      (call_script, "script_party_add_party", "p_main_party", ":var0"),
      (party_detach, ":var0"),
      (remove_party, ":var0"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "knight_join_party_lead_out",
    [],
    "Very well then. I shall maintain a patrol of this area. Return if you have further orders for me.",
    "close_window",
    [
      (call_script, "script_recruit_troop_as_companion", "$g_talk_troop"),
      (party_remove_members, "p_main_party", "$g_talk_troop", 1),
      (troop_get_slot, ":var0", "$g_talk_troop", 10),
      (party_set_faction, ":var0", "fac_player_supporters_faction"),
      (party_detach, ":var0"),
      (party_set_ai_behavior, ":var0", ai_bhvr_patrol_location),
      (party_set_flags, ":var0", 65536, 0),
    ]],

  [anyone, "lord_enter_service_reject",
    [
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
    ],
    "Indeed.... Did you offer vassalage, then, just to buy time? Very well -- you shall have time to reconsider, but if you are toying with me, it will do your reputation no credit.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_give_oath_give_up",
    [
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
    ],
    "Indeed.... Did you offer vassalage, then, just to buy time? Very well -- you shall have time to reconsider, but if you are toying with me, it will do your reputation no credit.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_enter_service_reject",
    [],
    "What pigswill! And to think I would offer you a place among my nobles. Begone, beggar, before I lose my temper!",
    "close_window",
    [
      (try_begin),
        (store_partner_quest, ":var0"),
        (eq, ":var0", "qst_join_faction"),
        (call_script, "script_abort_quest", "qst_join_faction", 1),
      (try_end),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      (assign, "$g_invite_offered_center", 0),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_enter_service",
    [
      (gt, "$players_kingdom", 0),
      (neq, "$players_kingdom", "$g_talk_troop_faction"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (neq, ":var0", "trp_player"),
      (str_store_troop_name, s5, ":var0"),
    ],
    "You are already oath-bound to serve {s5}, are you not?",
    "lord_give_oath_under_oath_already",
    []],

  [plyr|anyone, "lord_give_oath_under_oath_already",
    [],
    "Indeed I am, {s65}. Forgive my rambling.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_enter_service",
    [
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (str_store_string, s1, "@I accept oaths only from those I can trust to keep them, {playername}."),
      (this_or_next|ge, "$player_right_to_rule", 30),
      (this_or_next|lt, "$g_talk_troop_effective_relation", -5),
      (gt, reg0, 0),
      (try_begin),
        (gt, reg0, 0),
        (str_store_string, s1, "@I accept oaths only from those who have no stolen fiefs, {playername}."),
      (try_end),
    ],
    "{s1}",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_enter_service",
    [
      (eq, 0, 1),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var0", 7, "trp_player"),
        (assign, "$bypass_female_vassal_explanation", 1),
      (try_end),
      (eq, "$bypass_female_vassal_explanation", 0),
    ],
    "My lady, you seem to have the makings of a good war leader. For a woman to show such skill is an uncommon thing in Pendor, but not completely without precedent. Noblewomen have often taken command of armies after their husbands or fathers were slain or captured, for example.",
    "lord_ask_enter_service_female_2",
    [
      (assign, "$bypass_female_vassal_explanation", 1),
    ]],

  [anyone, "lord_ask_enter_service_female_2",
    [],
    "However, I have never heard of a king who granted a fief to a woman, no matter how valorous, simply because he needed an extra vassal. Were I to do such a thing, I would raise eyebrows across Pendor. Men would say that I was besotted or bewitched, or that I aimed to overturn the natural order of things. As much as I regret it, I cannot afford to grant you a fief.",
    "lord_ask_enter_service_female_response",
    []],

  [plyr|anyone, "lord_ask_enter_service_female_response",
    [],
    "What if I were to take one of your enemy's castles by force?",
    "lord_ask_enter_service_female_solution_capture",
    []],

  [plyr|anyone, "lord_ask_enter_service_female_response",
    [
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
    ],
    "What if I were to marry one of your lords?",
    "lord_ask_enter_service_female_solution_marriage",
    []],

  [plyr|anyone, "lord_ask_enter_service_female_response",
    [],
    "Perhaps one of your competitors will prove to be more open-minded.",
    "lord_ask_enter_service_female_solution_competitor",
    []],

  [plyr|anyone, "lord_ask_enter_service_female_response",
    [],
    "I would be willing to fight for you, even without the fief.",
    "lord_ask_enter_service",
    []],

  [plyr|anyone, "lord_ask_enter_service_female_response",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_enter_service_female_solution_marriage",
    [],
    "Well, I still would not be willing to grant you any fiefs. However, you would no doubt have the use of your husband's properties, which would allow you to act as one of my vassals in all but name. Did you have an other questions?",
    "lord_ask_enter_service_female_response",
    []],

  [anyone, "lord_ask_enter_service_female_solution_competitor",
    [],
    "Oh, perhaps you might find someone who was truly desperate -- but then, I would think, they would not have many fiefs to bestow. Did you have an other questions?",
    "lord_ask_enter_service_female_response",
    []],

  [anyone, "lord_ask_enter_service_female_solution_capture",
    [],
    "Well, in that case, depending on the circumstances, I might be inclined to let you keep it. Did you have an other questions?",
    "lord_ask_enter_service_female_response",
    []],

  [anyone, "lord_ask_enter_service",
    [
      (assign, "$g_invite_offered_center", -1),
      (troop_get_slot, ":var0", "trp_player", 7),
      (store_mul, ":var1", "$g_talk_troop_effective_relation", 5),
      (val_add, ":var1", ":var0"),
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (assign, ":var2", reg0),
      (store_mul, ":var3", ":var2", 50),
      (val_add, ":var1", ":var3"),
      (ge, ":var1", 150),
      (try_begin),
        (eq, ":var2", 0),
        (call_script, "script_get_poorest_village_of_faction", "$g_talk_troop_faction"),
        (gt, reg0, 0),
        (assign, "$g_invite_offered_center", reg0),
      (try_end),
    ],
    "You are known as a brave {reg63?man-at-arms:warrior} and a fine leader of men, {playername}. I shall be pleased to accept your sword into my service and bestow vassalage upon you, if you are ready to swear homage to me.",
    "lord_give_oath_1",
    []],

  [anyone, "lord_ask_enter_service",
    [],
    "You've yet to show yourself as a competent commander, {playername}. Take your sword to my enemies and prove to me that you are worthy of becoming my vassal. Then we may speak more of this.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_give_oath_1",
    [],
    "I am ready, {s65}.",
    "lord_give_oath_2",
    []],

  [plyr|anyone, "lord_give_oath_1",
    [],
    "Forgive me, {s65}, I must give the matter more thought first...",
    "lord_give_oath_give_up",
    []],

  [anyone, "lord_give_oath_give_up",
    [
      (troop_get_type, ":var0", "trp_player"),
      (neq, ":var0", 0),
    ],
    "Take whatever time you need, my lady.",
    "lord_pretalk",
    []],

  [anyone, "lord_give_oath_give_up",
    [],
    "What are you playing at, {playername}? Go and make up your mind, and stop wasting my time.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_give_oath_2",
    [],
    "Good. Then repeat the words of the oath with me: I swear homage to you as lawful ruler of the {s41}.",
    "lord_give_oath_3",
    [
      (str_store_faction_name, s41, "$g_talk_troop_faction"),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (neg|troop_slot_eq, "$g_talk_troop", 2, 2),
        (troop_get_slot, ":var0", "$g_talk_troop", 14),
        (str_store_faction_name, s41, ":var0"),
      (try_end),
    ]],

  [plyr|anyone, "lord_give_oath_3",
    [],
    "I pledge homage to you as lawful ruler of the {s41}.",
    "lord_give_oath_4",
    []],

  [plyr|anyone, "lord_give_oath_3",
    [],
    "Excuse me, {reg65?my lady:sir}. But I feel I need to think about this.",
    "lord_give_oath_give_up",
    []],

  [anyone, "lord_give_oath_4",
    [],
    "I will remain as your loyal and devoted {reg63?man:follower} as long as my breath remains....",
    "lord_give_oath_5",
    []],

  [plyr|anyone, "lord_give_oath_5",
    [],
    "I will remain as your loyal and devoted {reg63?man:follower} as long as my breath remains...",
    "lord_give_oath_6",
    []],

  [plyr|anyone, "lord_give_oath_5",
    [],
    "{reg65?My lady:Sir}, may I ask for some time to think about this?",
    "lord_give_oath_give_up",
    []],

  [anyone, "lord_give_oath_6",
    [],
    "...and I will be at your side to fight your enemies should you need my sword.",
    "lord_give_oath_7",
    []],

  [plyr|anyone, "lord_give_oath_7",
    [],
    "...and I will be at your side to fight your enemies should you need my sword.",
    "lord_give_oath_8",
    []],

  [plyr|anyone, "lord_give_oath_7",
    [],
    "{reg65?My lady:My lord}, please give me more time to think about this.",
    "lord_give_oath_give_up",
    []],

  [anyone, "lord_give_oath_8",
    [],
    "Finally, I will uphold your lawful claims and those of your legitimate heirs.",
    "lord_give_oath_9",
    []],

  [plyr|anyone, "lord_give_oath_9",
    [],
    "Finally, I will uphold your lawful claims and those of your legitimate heirs.",
    "lord_give_oath_10",
    []],

  [plyr|anyone, "lord_give_oath_9",
    [],
    "{reg65?My lady:Sir}, I must have more time to consider this.",
    "lord_give_oath_give_up",
    []],

  [anyone, "lord_give_oath_10",
    [],
    "Very well. You have given me your solemn oath, {playername}. May you uphold it always, with proper courage and devotion.",
    "lord_give_oath_go_on_2",
    []],

  [anyone, "lord_give_oath_go_on_2",
    [
      (assign, reg1, 1),
      (try_begin),
        (le, "$g_invite_offered_center", 0),
        (assign, reg1, 0),
      (else_try),
        (str_store_party_name, s1, "$g_invite_offered_center"),
      (try_end),
    ],
    "Let it be known that from this day forward, you are my sworn {reg63?man:follower} and vassal. I give you my protection and grant you the right to bear arms in my name, and I pledge that I shall not deprive you of your life, liberty or properties except by the lawful judgement of your peers or by the law and custom of the land.{reg1? Furthermore I give you the fief of {s1} with all its rents and revenues.:}",
    "lord_give_oath_go_on_3",
    []],

  [anyone, "lord_give_oath_go_on_3",
    [],
    "You have done a wise thing, {playername}. Serve me well and I promise, you will rise high.",
    "lord_give_conclude",
    []],

  [plyr|anyone, "lord_give_conclude",
    [
      (troop_get_type, reg39, "$g_talk_troop"),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 30, "trp_player"),
        (str_store_string, s41, "str_very_well__you_are_now_my_liege_as_well_as_my_husband"),
      (else_try),
        (str_store_string, s41, "str_i_thank_you_reg39my_ladylord"),
      (try_end),
    ],
    "{s41}",
    "lord_give_conclude_2",
    [
      (assign, ":var0", 0),
      (try_begin),
        (this_or_next|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (troop_slot_eq, "$g_talk_troop", 30, "trp_player"),
        (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
        (assign, ":var0", 1),
        (assign, "$supported_pretender", "$g_talk_troop"),
        (troop_get_slot, "$supported_pretender_old_faction", "$g_talk_troop", 14),
        (troop_set_faction, "$g_talk_troop", "fac_player_supporters_faction"),
        (faction_set_slot, "fac_player_supporters_faction", 11, "$g_talk_troop"),
        (assign, "$g_talk_troop_faction", "fac_player_supporters_faction"),
        (quest_set_slot, "qst_rebel_against_kingdom", 6, "$g_talk_troop"),
        (quest_set_slot, "qst_rebel_against_kingdom", 3, "$supported_pretender_old_faction"),
        (str_store_faction_name_link, s14, "$supported_pretender_old_faction"),
        (str_store_troop_name_link, s13, "$g_talk_troop"),
        (setup_quest_text, "qst_rebel_against_kingdom"),
        (str_store_string, s2, "@You promised to help {s13} claim the throne of {s14}."),
        (call_script, "script_start_quest", "qst_rebel_against_kingdom", "$g_talk_troop"),
      (try_end),
      (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_deactivate_player_faction"),
        (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var2", ":var1"),
          (eq, ":var2", "fac_player_supporters_faction"),
          (troop_slot_eq, ":var1", 2, 2),
          (call_script, "script_change_troop_faction", ":var1", "$g_talk_troop_faction"),
        (try_end),
      (try_end),
      (try_begin),
        (is_between, "$players_oath_renounced_against_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, "$players_oath_renounced_against_kingdom", "$g_talk_troop_faction"),
        (store_relation, ":var3", "fac_player_supporters_faction", "$players_oath_renounced_against_kingdom"),
        (val_min, ":var3", -40),
        (call_script, "script_set_player_relation_with_faction", "$players_oath_renounced_against_kingdom", ":var3"),
        (call_script, "script_update_all_notes"),
        (assign, "$g_recalculate_ais", 1),
      (try_end),
      (try_begin),
        (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (neq, "$players_kingdom", "$g_talk_troop_faction"),
        (faction_get_slot, ":var4", "$players_kingdom", 11),
        (call_script, "script_add_log_entry", 23, "trp_player", -1, ":var4", "$players_kingdom"),
        (try_begin),
          (eq, ":var0", 1),
          (call_script, "script_activate_player_faction", "$g_talk_troop"),
        (try_end),
        (call_script, "script_player_leave_faction", 0),
      (try_end),
      (call_script, "script_player_join_faction", "$g_talk_troop_faction"),
      (try_begin),
        (gt, "$g_invite_offered_center", 0),
        (call_script, "script_give_center_to_lord", "$g_invite_offered_center", "trp_player", 0),
        (try_begin),
          (faction_slot_eq, "$players_kingdom", 64, "$g_invite_offered_center"),
          (faction_set_slot, "$players_kingdom", 64, -1),
        (try_end),
      (try_end),
      (call_script, "script_add_log_entry", 21, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
      (call_script, "script_update_troop_notes", "trp_player"),
      (try_begin),
        (check_quest_active, "qst_join_faction"),
        (eq, "$g_invite_faction_lord", "$g_talk_troop"),
        (call_script, "script_end_quest", "qst_join_faction"),
      (else_try),
        (check_quest_active, "qst_join_faction"),
        (call_script, "script_abort_quest", "qst_join_faction", 0),
      (try_end),
      (assign, "$player_has_homage", 1),
      (assign, "$g_player_banner_granted", 1),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      (assign, "$g_invite_offered_center", 0),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_give_conclude_2",
    [
      (troop_slot_eq, "$g_talk_troop", 30, "trp_player"),
    ],
    "So be it, my wife. May all my vassals be as valiant and loyal as you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_give_conclude_2",
    [],
    "I have great hopes for you {playername}. I know you shall prove yourself worthy of the trust I have placed in you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_enter_service",
    [
      (str_store_faction_name, s5, "$g_talk_troop_faction"),
    ],
    "Heh, a wise move, {playername}. With loyal service, a {reg63?man:woman} in my service could become wealthy and powerful, and our enemies... Well, our enemies are as wheat before a scythe. However, to enter my service you must first renounce all worldly oaths and bonds, and swear to serve only the {s5}.",
    "lord_enter_service_swear",
    []],

  [plyr|anyone, "lord_enter_service_swear",
    [],
    "I do so swear, {s65}.",
    "lord_enter_service_swear_accepted",
    []],

  [plyr|anyone, "lord_enter_service_swear",
    [],
    "I need some time to think about this.",
    "lord_enter_service_swear_denied",
    []],

  [anyone, "lord_enter_service_swear_denied",
    [],
    "Are you having me on? I've no time for games, {playername}. Make up your mind and stop wasting my time.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_enter_service_swear_accepted",
    [
      (str_store_faction_name, s5, "$g_talk_troop_faction"),
    ],
    "Then it is my pleasure to welcome you to the service of my house. From this day on, {playername}, you are a soldier of the {s5} with all the duties and privileges that come with it.",
    "lord_enter_service_swear_accepted_2",
    []],

  [anyone, "lord_enter_service_swear_accepted_2",
    [
      (str_store_faction_name, s5, "$g_talk_troop_faction"),
    ],
    "I charge you with rooting out and destroying the forces of our enemies wherever you may find them. Moreover, I will have special tasks for you from time to time, as may some of my other vassal lords. Serve, fight, and honor your oaths. These things will take you far, if you've a mind for promotion. May God grant us long lives and many victories to toast in my hall!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_ask_leave_service",
    [
      (ge, "$g_talk_troop_relation", 1),
    ],
    "Hrm. Has your oath become burdensome, {playername}? It is unusual to request release from homage, but in respect of your fine service, I will not hold you if you truly wish to end it. Though you would be sorely missed.",
    "lord_ask_leave_service_verify",
    []],

  [anyone, "lord_ask_leave_service",
    [],
    "Release from homage? Hmm, perhaps it would be for the best... However, {playername}, you must be sure that release is what you desire. This is not a thing done lightly.",
    "lord_ask_leave_service_verify",
    []],

  [plyr|anyone, "lord_ask_leave_service_verify",
    [],
    "It is something I must do, {s65}.",
    "lord_ask_leave_service_2",
    []],

  [plyr|anyone, "lord_ask_leave_service_verify",
    [],
    "You are right, {s65}. My place is here.",
    "lord_ask_leave_service_giveup",
    []],

  [anyone, "lord_ask_leave_service_giveup",
    [],
    "I am pleased to hear it, {playername}. I hope you'll banish such unworthy thoughts from your mind from now on.",
    "lord_pretalk",
    []],

  [anyone, "lord_ask_leave_service_2",
    [],
    "Then you are sure? Also, be aware that if you leave my services, you will be surrendering to me all the fiefs which you hold in my name.",
    "lord_ask_leave_service_verify_again",
    []],

  [plyr|anyone, "lord_ask_leave_service_verify_again",
    [],
    "Yes, {s65}.",
    "lord_ask_leave_service_3",
    []],

  [plyr|anyone, "lord_ask_leave_service_verify_again",
    [],
    "Of course not, {s65}. I am ever your loyal vassal.",
    "lord_ask_leave_service_giveup",
    []],

  [anyone, "lord_ask_leave_service_3",
    [],
    "As you wish. I hereby declare your oaths to be null and void. You will no longer hold land or titles in my name, and you are released from your duties to my house. You are free, {playername}.",
    "lord_ask_leave_service_end",
    [
      (call_script, "script_add_log_entry", 23, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
      (call_script, "script_player_leave_faction", 1),
    ]],

  [plyr|anyone, "lord_ask_leave_service_end",
    [],
    "Thank you, sir. It was an honor to serve you..",
    "lord_ask_leave_service_end_2",
    []],

  [plyr|anyone, "lord_ask_leave_service_end",
    [],
    "My thanks. It feels good to be {reg63?a free man:free} once again.",
    "lord_ask_leave_service_end_2",
    []],

  [anyone, "lord_ask_leave_service_end_2",
    [],
    "Farewell then, {playername}, and good luck go with you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_active_mission_1",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_lend_companion"),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_lend_companion"),
      (quest_slot_eq, "qst_lend_companion", 6, "$g_talk_troop"),
      (store_current_day, ":var1"),
      (quest_get_slot, ":var2", "qst_lend_companion", 10),
      (ge, ":var1", ":var2"),
    ],
    "Oh, you want your companion back? I see...",
    "lord_lend_companion_end",
    []],

  [anyone, "lord_active_mission_1",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_lend_companion"),
    ],
    "{playername}, I must beg your patience, I still have need of your companion. Please return later when things have settled.",
    "lord_pretalk",
    []],

  [anyone, "lord_active_mission_1",
    [],
    "Yes, have you made any progress on it?",
    "lord_active_mission_2",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_capture_prisoners"),
      (quest_slot_eq, "qst_capture_prisoners", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_capture_prisoners", 10),
      (quest_get_slot, ":var1", "qst_capture_prisoners", 2),
      (party_count_prisoners_of_type, ":var2", "p_main_party", ":var1"),
      (ge, ":var2", ":var0"),
      (assign, reg1, ":var0"),
      (str_store_troop_name_plural, s1, ":var1"),
    ],
    "Indeed. I brought you {reg1} {s1} as prisoners.",
    "lord_generic_mission_thank",
    [
      (quest_get_slot, ":var0", "qst_capture_prisoners", 10),
      (quest_get_slot, ":var1", "qst_capture_prisoners", 2),
      (party_remove_prisoners, "p_main_party", ":var1", ":var0"),
      (party_add_prisoners, "$g_encountered_party", ":var1", ":var0"),
      (call_script, "script_finish_quest", "qst_capture_prisoners", 100),
    ]],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_capture_enemy_hero"),
      (assign, ":var1", 0),
      (quest_get_slot, ":var2", "qst_capture_enemy_hero", 3),
      (party_get_num_prisoner_stacks, ":var3", "p_main_party"),
      (try_for_range, ":var4", 0, ":var3"),
        (party_prisoner_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
        (troop_is_hero, ":var5"),
        (store_troop_faction, ":var6", ":var5"),
        (eq, ":var2", ":var6"),
        (troop_slot_eq, ":var5", 2, 2),
        (assign, ":var1", 1),
        (quest_set_slot, "qst_capture_enemy_hero", 2, ":var5"),
      (try_end),
      (eq, ":var1", 1),
      (str_store_faction_name, s13, ":var2"),
    ],
    "Oh, indeed. I've captured a lord from {s13} for you.",
    "capture_enemy_hero_thank",
    []],

  [anyone, "capture_enemy_hero_thank",
    [],
    "Many thanks, my friend. He will serve very well for a bargain. You've done a fine work here. Please accept these {reg5} denars for your help.",
    "capture_enemy_hero_thank_2",
    [
      (quest_get_slot, ":var0", "qst_capture_enemy_hero", 2),
      (quest_get_slot, ":var1", "qst_capture_enemy_hero", 3),
      (party_remove_prisoners, "p_main_party", ":var0", 1),
      (store_relation, ":var2", "$g_encountered_party_faction", ":var1"),
      (try_begin),
        (lt, ":var2", 0),
        (party_add_prisoners, "$g_encountered_party", ":var0", 1),
      (else_try),
        (troop_set_slot, ":var0", 8, -1),
      (try_end),
      (call_script, "script_finish_quest_simple", "qst_capture_enemy_hero", 100),
      (quest_get_slot, ":var3", "qst_capture_enemy_hero", 22),
      (assign, reg5, ":var3"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 4),
    ]],

  [plyr|anyone, "capture_enemy_hero_thank_2",
    [],
    "Certainly, {s65}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "capture_enemy_hero_thank_2",
    [],
    "It was nothing.",
    "lord_pretalk",
    []],

  [plyr|anyone, "capture_enemy_hero_thank_2",
    [],
    "Give me more of a challenge next time.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_raise_troops"),
      (quest_get_slot, ":var1", ":var0", 2),
      (quest_get_slot, ":var2", ":var0", 10),
      (party_count_companions_of_type, ":var3", "p_main_party", ":var1"),
      (ge, ":var3", ":var2"),
      (assign, reg1, ":var2"),
      (str_store_troop_name_plural, s13, ":var1"),
    ],
    "Indeed. I have raised {reg1} {s13}. You can take them.",
    "lord_raise_troops_thank",
    [
      (quest_get_slot, ":var0", "qst_raise_troops", 2),
      (quest_get_slot, ":var1", "qst_raise_troops", 10),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
      (party_remove_members, "p_main_party", ":var0", ":var1"),
      (call_script, "script_finish_quest_simple", "qst_raise_troops", 100),
      (troop_get_slot, ":var2", "$g_talk_troop", 10),
      (gt, ":var2", 0),
      (party_add_members, ":var2", ":var0", ":var1"),
    ]],

  [anyone, "lord_raise_troops_thank",
    [],
    "These men may well turn the tide in my plans, {playername}. I am confident you've trained them well. My thanks and my compliments to you.",
    "lord_raise_troops_thank_2",
    []],

  [plyr|anyone, "lord_raise_troops_thank_2",
    [],
    "Well, the lads are at your command now, sir. I am sure you will take good care of them.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_collect_taxes"),
      (quest_slot_eq, "qst_collect_taxes", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_collect_taxes"),
      (eq, "$qst_collect_taxes_halve_taxes", 0),
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (store_mul, ":var1", ":var0", 8),
      (val_div, ":var1", 10),
      (store_troop_gold, ":var2", "trp_player"),
      (ge, ":var2", ":var1"),
      (assign, reg19, ":var0"),
      (quest_get_slot, ":var3", "qst_collect_taxes", 1),
      (str_store_party_name, s3, ":var3"),
    ],
    "Here are all the taxes from {s3}. It comes up to {reg19} denars.",
    "lord_collect_taxes_success",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_collect_taxes"),
      (quest_slot_eq, "qst_collect_taxes", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_collect_taxes"),
      (eq, "$qst_collect_taxes_halve_taxes", 1),
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (store_mul, ":var1", ":var0", 95),
      (val_div, ":var1", 100),
      (store_troop_gold, ":var2", "trp_player"),
      (ge, ":var2", ":var1"),
      (assign, reg19, ":var0"),
      (quest_get_slot, ":var3", "qst_collect_taxes", 1),
      (str_store_party_name, s3, ":var3"),
    ],
    "Here are the taxes from {s3}. It comes up to {reg19} denars.",
    "lord_collect_taxes_half_success",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (check_quest_active, "qst_collect_taxes"),
      (quest_slot_eq, "qst_collect_taxes", 6, "$g_talk_troop"),
      (check_quest_failed, "qst_collect_taxes"),
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", ":var0"),
      (assign, reg19, ":var0"),
      (quest_get_slot, ":var2", "qst_collect_taxes", 1),
      (str_store_party_name, s3, ":var2"),
    ],
    "Unfortunately, a revolt broke up while I was collecting the taxes. I could only collect {reg19} denars.",
    "lord_collect_taxes_fail",
    []],

  [anyone, "lord_collect_taxes_success",
    [
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (store_mul, ":var1", ":var0", 8),
      (val_div, ":var1", 10),
      (assign, reg20, ":var1"),
      (store_sub, reg21, ":var0", ":var1"),
    ],
    "Well done, {playername}, very well done indeed! You were truly the right {reg63?man:person} for the job. I promised you a fifth of the taxes, so that amounts to {reg21} denars. If you give me {reg20} denars, you may keep the difference. A good result for everyone, eh?",
    "lord_pretalk",
    [
      (troop_remove_gold, "trp_player", reg20),
      (quest_set_slot, "qst_collect_taxes", 22, 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_finish_quest_simple", "qst_collect_taxes", 100),
    ]],

  [anyone, "lord_collect_taxes_half_success",
    [
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (val_mul, ":var0", 95),
      (val_div, ":var0", 100),
      (assign, reg20, ":var0"),
    ],
    "What?! Is this some scheme of yours, {playername}? That's less than half the taxes I'm owed! You have let them get away with murder as well as my money. What a farce! You can forget the money I promised you, I'm taking {reg20} denars from what you collected, and you're lucky I'm leaving you a few coins for honor's sake.",
    "lord_pretalk",
    [
      (troop_remove_gold, "trp_player", reg20),
      (quest_set_slot, "qst_collect_taxes", 22, 0),
      (call_script, "script_finish_quest_simple", "qst_collect_taxes", 33),
    ]],

  [anyone, "lord_collect_taxes_fail",
    [],
    "God, what a bloody mess you've gotten us into, {playername}.This could turn very ugly if I do not take immediate action.I certainly hope you're not here expecting to be paid for failure.Hand over my {reg19} denars, if you please, and end our business together.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (quest_get_slot, ":var0", "qst_collect_taxes", 22),
      (troop_remove_gold, "trp_player", ":var0"),
      (quest_set_slot, "qst_collect_taxes", 22, 0),
      (call_script, "script_finish_quest_simple", "qst_collect_taxes", 10),
    ]],

  [plyr|anyone, "lord_active_mission_2",
    [
      (check_quest_active, "qst_hunt_down_fugitive"),
      (quest_slot_eq, "qst_hunt_down_fugitive", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_hunt_down_fugitive"),
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 1),
      (str_store_party_name, s3, ":var0"),
      (quest_get_slot, ":var1", "qst_hunt_down_fugitive", 13),
      (call_script, "script_get_name_from_dna_to_s50", ":var1"),
      (str_store_string, s4, s50),
    ],
    "I found {s4} hiding at {s3} and gave him his punishment.",
    "lord_hunt_down_fugitive_success",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [
      (check_quest_active, "qst_hunt_down_fugitive"),
      (quest_slot_eq, "qst_hunt_down_fugitive", 6, "$g_talk_troop"),
      (check_quest_failed, "qst_hunt_down_fugitive"),
    ],
    "I'm afraid he got away.",
    "lord_hunt_down_fugitive_fail",
    []],

  [anyone, "lord_hunt_down_fugitive_success",
    [],
    "And we'll all be a lot better off without him! Thank you, {playername}, for removing this long-festering thorn from my side. 'Tis good to know you can be trusted to handle things with an appropriate level of tactfulness. A bounty I promised, and a bounty you shall have. {reg33} denars and not a copper less!",
    "lord_hunt_down_fugitive_success_2",
    [
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 22),
      (assign, reg33, ":var0"),
    ]],

  [plyr|anyone, "lord_hunt_down_fugitive_success_2",
    [],
    "Let me take the money, {s65}. Thank you.",
    "lord_hunt_down_fugitive_reward_accept",
    []],

  [plyr|anyone, "lord_hunt_down_fugitive_success_2",
    [],
    "This is blood money. I can't accept it.",
    "lord_hunt_down_fugitive_reward_reject",
    []],

  [anyone, "lord_hunt_down_fugitive_reward_accept",
    [],
    "Of course, {playername}. Here you are. Once again, you've my thanks for ridding me of that {s43}.",
    "lord_pretalk",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_insult_default"),
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 21),
      (add_xp_as_reward, ":var0"),
      (quest_get_slot, ":var1", "qst_hunt_down_fugitive", 22),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (call_script, "script_end_quest", "qst_hunt_down_fugitive"),
    ]],

  [anyone, "lord_hunt_down_fugitive_reward_reject",
    [],
    "You are a {reg63?man:woman} for whom justice is its own reward, eh? As you wish it, {playername}, as you wish it. An honorable sentiment, to be true. Regardless, you've my thanks for ridding me of that {s43}.",
    "lord_pretalk",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_insult_default"),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 21),
      (add_xp_as_reward, ":var0"),
      (call_script, "script_end_quest", "qst_hunt_down_fugitive"),
    ]],

  [anyone, "lord_hunt_down_fugitive_fail",
    [],
    "It is a sad day when that {s43} manages to avoid the hand of justice yet again. I thought you would be able to do this, {playername}. Clearly I was wrong.",
    "lord_pretalk",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_insult_default"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (call_script, "script_end_quest", "qst_hunt_down_fugitive"),
    ]],

  [plyr|anyone, "lord_active_mission_2",
    [],
    "I am still working on it.",
    "lord_active_mission_3",
    []],

  [plyr|anyone, "lord_active_mission_2",
    [],
    "I am afraid I won't be able to do this quest.",
    "lord_mission_failed",
    []],

  [anyone, "lord_active_mission_3",
    [],
    "Good. Remember, I am counting on you.",
    "lord_pretalk",
    []],

  [anyone, "lord_mission_failed",
    [],
    "{s43}",
    "lord_pretalk",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_mission_failed_default"),
      (store_partner_quest, ":var0"),
      (call_script, "script_abort_quest", ":var0", 1),
    ]],

  [anyone, "lord_suggest_action_ask",
    [],
    "{!}What do you suggest?",
    "lord_suggest_action",
    []],

  [plyr|anyone, "lord_suggest_action",
    [],
    "{!}CHEAT: I want to join your faction.",
    "lord_suggest_join_faction",
    []],

  [anyone, "lord_suggest_join_faction",
    [],
    "{!}Alright then.",
    "lord_give_oath_5",
    []],

  [plyr|anyone, "lord_suggest_action",
    [],
    "{!}CHEAT: I want to know your leaded party ID.",
    "lord_suggest_learn_party_id",
    []],

  [anyone, "lord_suggest_learn_party_id",
    [
      (assign, reg1, "$g_encountered_party"),
      (troop_get_slot, reg0, "$g_talk_troop", 10),
    ],
    "{!}It is {reg0}. Encountered party is {reg1}",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_suggest_action",
    [],
    "{!}CHEAT: I want to know your AI initiative.",
    "lord_suggest_learn_ai_initiative",
    []],

  [anyone, "lord_suggest_learn_ai_initiative",
    [
      (1638, reg0, "$g_encountered_party"),
    ],
    "{!}It is {reg0}.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (eq, "$players_kingdom", "$g_talk_troop_faction"),
    ],
    "{!}CHEAT: I want to be your kingdom's marshall.",
    "lord_suggest_become_marshall",
    []],

  [anyone, "lord_suggest_become_marshall",
    [],
    "{!}Alright then.",
    "lord_pretalk",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 8),
      (try_begin),
        (ge, ":var0", 0),
        (troop_get_slot, ":var1", ":var0", 10),
        (party_is_active, ":var1"),
        (1604, ":var1", 0),
      (try_end),
      (faction_set_slot, "$g_talk_troop_faction", 8, "trp_player"),
      (faction_set_slot, "$g_talk_troop_faction", 4, 0),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Let us attack an enemy town or castle.",
    "lord_suggest_attack_enemy_castle",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Let us return back to a friendly town.",
    "lord_suggest_go_to_friendly_town",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Let us attack an enemy war party.",
    "lord_suggest_attack_enemy_party",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (eq, "$talk_context", 4),
    ],
    "{!}CHEAT: Let us lift this siege.",
    "lord_suggest_lift_siege",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Follow me.",
    "lord_suggest_follow_me",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Follow someone.",
    "lord_suggest_follow_other",
    []],

  [plyr|anyone, "lord_suggest_action",
    [
      (neq, "$talk_context", 4),
    ],
    "{!}CHEAT: Raid a village.",
    "lord_suggest_raid_village",
    []],

  [plyr|anyone, "lord_suggest_action",
    [],
    "{!}CHEAT: Like me.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 20),
    ]],

  [anyone, "lord_suggest_lift_siege",
    [],
    "{!}As you wish, {playername}.",
    "close_window",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", -1),
      (party_leave_cur_battle, "$g_talk_troop_party"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_suggest_go_to_friendly_town",
    [],
    "{!}Hmm. Which town or castle do you suggest we go to?",
    "lord_suggest_go_to_friendly_town2",
    []],

  [repeat_for_parties|plyr|anyone, "lord_suggest_go_to_friendly_town2",
    [
      (store_repeat_object, ":var0"),
      (this_or_next|party_slot_eq, ":var0", 0, 2),
      (party_slot_eq, ":var0", 0, 3),
      (neq, ":var0", "$g_encountered_party"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "$g_talk_troop_faction"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{!}CHEAT: {s1}",
    "lord_suggest_go_to_friendly_town3",
    [
      (store_repeat_object, "$town_suggested_to_go_to"),
    ]],

  [plyr|anyone, "lord_suggest_go_to_friendly_town2",
    [],
    "{!}CHEAT: Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_suggest_go_to_friendly_town3",
    [
      (str_store_party_name, s1, "$town_suggested_to_go_to"),
    ],
    "{!}Very well, we go to {s1}.",
    "lord_pretalk",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", 7, "$town_suggested_to_go_to"),
    ]],

  [anyone, "lord_suggest_attack_enemy_party",
    [],
    "{!}Hmm. Which party do you suggest we attack?",
    "lord_suggest_attack_enemy_party2",
    []],

  [repeat_for_parties|plyr|anyone, "lord_suggest_attack_enemy_party2",
    [
      (store_repeat_object, ":var0"),
      (party_slot_eq, ":var0", 0, 13),
      (party_is_active, ":var0"),
      (store_faction_of_party, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$g_talk_troop_faction"),
      (le, ":var2", -10),
      (call_script, "script_get_closest_walled_center", ":var0"),
      (assign, ":var3", reg0),
      (str_store_party_name, s3, ":var3"),
      (str_store_faction_name, s2, ":var1"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{!}CHEAT: {s1} of {s2} around {s3}",
    "lord_suggest_attack_enemy_party3",
    [
      (store_repeat_object, "$suggested_to_attack_party"),
    ]],

  [plyr|anyone, "lord_suggest_attack_enemy_party2",
    [],
    "{!}CHEAT: Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_suggest_attack_enemy_party3",
    [
      (str_store_party_name, s1, "$suggested_to_attack_party"),
    ],
    "{!}As you wish, we will attack {s1}.",
    "lord_pretalk",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", 10, "$suggested_to_attack_party"),
    ]],

  [anyone, "lord_suggest_attack_enemy_castle",
    [],
    "{!}Hmm. Which one do you suggest we attack?",
    "lord_suggets_attack_enemy_castle2",
    []],

  [repeat_for_parties|plyr|anyone, "lord_suggets_attack_enemy_castle2",
    [
      (store_repeat_object, ":var0"),
      (this_or_next|party_slot_eq, ":var0", 0, 2),
      (party_slot_eq, ":var0", 0, 3),
      (store_faction_of_party, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$g_talk_troop_faction"),
      (le, ":var2", -10),
      (str_store_faction_name, s2, ":var1"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{!}CHEAT: {s1} of {s2}",
    "lord_suggets_attack_enemy_castle3",
    [
      (store_repeat_object, "$suggested_to_attack_center"),
    ]],

  [plyr|anyone, "lord_suggets_attack_enemy_castle2",
    [],
    "{!}CHEAT: Never mind my lord.",
    "lord_pretalk",
    []],

  [anyone, "lord_suggets_attack_enemy_castle3",
    [
      (str_store_party_name, s1, "$suggested_to_attack_center"),
    ],
    "That should be possible. Very well, we'll attack {s1}.",
    "lord_pretalk",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", 1, "$suggested_to_attack_center"),
    ]],

  [anyone, "lord_suggest_raid_village",
    [],
    "{!}Hmm. Which village do you suggest we attack?",
    "lord_suggest_raid_village_2",
    []],

  [repeat_for_parties|plyr|anyone, "lord_suggest_raid_village_2",
    [
      (store_repeat_object, ":var0"),
      (party_slot_eq, ":var0", 0, 4),
      (store_faction_of_party, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$g_talk_troop_faction"),
      (le, ":var2", -10),
      (str_store_faction_name, s2, ":var1"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{!}CHEAT: {s1} of {s2}",
    "lord_suggest_raid_village_3",
    [
      (store_repeat_object, "$suggested_to_attack_center"),
    ]],

  [plyr|anyone, "lord_suggest_raid_village_2",
    [],
    "{!}CHEAT: Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_suggest_raid_village_3",
    [
      (str_store_party_name, s1, "$suggested_to_attack_center"),
    ],
    "{!}That should be possible. Very well, we'll attack {s1}.",
    "lord_pretalk",
    [
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", 5, "$suggested_to_attack_center"),
    ]],

  [anyone, "lord_suggest_follow_me",
    [],
    "{!}Aye, I'll follow you.",
    "lord_pretalk",
    [
      (party_set_slot, "$g_talk_troop_party", 30, "p_main_party"),
      (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", reg0, reg1),
    ]],

  [anyone, "lord_suggest_follow_other",
    [],
    "{!}Who do you want me to follow?",
    "lord_suggest_follow_other_2",
    []],

  [repeat_for_parties|plyr|anyone, "lord_suggest_follow_other_2",
    [
      (store_repeat_object, ":var0"),
      (party_slot_eq, ":var0", 0, 13),
      (neq, ":var0", "$g_talk_troop"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "$g_talk_troop_faction"),
      (str_store_party_name, s1, ":var0"),
    ],
    "{!}CHEAT: {s1}",
    "lord_suggest_follow_other_3",
    [
      (store_repeat_object, "$town_suggested_to_go_to"),
    ]],

  [plyr|anyone, "lord_suggest_follow_other_2",
    [],
    "{!}CHEAT: Never mind.",
    "lord_pretalk",
    []],

  [anyone, "lord_suggest_follow_other_3",
    [
      (str_store_party_name, s1, "$town_suggested_to_go_to"),
    ],
    "{!}As you wish, I shall be accompanying {s1}.",
    "lord_pretalk",
    [
      (party_set_slot, "$g_talk_troop_party", 30, "$town_suggested_to_go_to"),
      (call_script, "script_npc_decision_checklist_party_ai", "$g_talk_troop"),
      (call_script, "script_party_set_ai_state", "$g_talk_troop_party", reg0, reg1),
    ]],

  [plyr|anyone, "lord_suggest_action",
    [],
    "{!}CHEAT: Nothing, {s65}. It's not important.",
    "lord_pretalk",
    []],

  [auto_proceed|anyone, "lord_request_mission_ask",
    [
      (eq, "$players_kingdom", 0),
      (ge, "$g_talk_troop_faction_relation", 0),
      (ge, "$g_talk_troop_relation", 0),
      (troop_slot_ge, "trp_player", 7, 30),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 31),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, "$g_talk_troop_faction", 21, 0),
        (store_relation, ":var3", "$g_talk_troop_faction", ":var2"),
        (lt, ":var3", 0),
        (val_add, ":var1", 1),
      (try_end),
      (ge, ":var1", 1),
      (store_current_hours, ":var4"),
      (store_add, ":var5", ":var0", 168),
      (val_add, ":var0", 24),
      (ge, ":var4", ":var0"),
      (store_random_in_range, ":var6", 0, 100),
      (this_or_next|lt, ":var6", 20),
      (ge, ":var4", ":var5"),
    ],
    "{!}Warning: This line should never display.",
    "lord_propose_mercenary",
    [
      (store_current_hours, ":var0"),
      (faction_set_slot, "$g_talk_troop_faction", 31, ":var0"),
    ]],

  [anyone, "lord_propose_mercenary",
    [
      (call_script, "script_get_mercenary_money_offer"),
      (assign, ":var0", reg0),
      (call_script, "script_round_value", ":var0"),
      (assign, ":var0", reg0),
      (assign, "$temp", ":var0"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 11),
      (neq, ":var1", "$g_talk_troop"),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
      (str_store_troop_name, s10, ":var1"),
      (troop_get_type, ":var2", "trp_player"),
      (try_begin),
        (eq, ":var2", 100),
        (troop_slot_eq, "$g_talk_troop", 52, 1),
        (str_store_string, s11, "str_now_some_might_say_that_women_have_no_business_leading_mercenary_companies_but_i_suspect_that_you_would_prove_them_wrong_what_do_you_say"),
      (else_try),
        (str_store_string, s11, "@What do you say to entering the service of {s9} as a mercenary captain? I have no doubt that you would be up to the task."),
      (try_end),
    ],
    "As it happens, {playername}, I promised {s10} that I would hire a company of mercenaries for an upcoming campaign. What do you say to entering the service of {s9} as a mercenary captain?",
    "companion_comment_mercenary_service",
    []],

  [anyone|other(trp_npc_kassim), "companion_comment_mercenary_service",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_kassim"),
      (neg|troop_is_wounded, "trp_npc_kassim"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 20),
    ],
    "{s4}",
    "lord_mercenary_service_interject",
    [
      (str_store_string, s4, "str_npc_kassim_to_lord_f"),
      (play_sound, "snd_kassim_to_lord_f"),
    ]],

  [anyone|other(trp_npc_riva), "companion_comment_mercenary_service",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_riva"),
      (neg|troop_is_wounded, "trp_npc_riva"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 30),
    ],
    "{s4}",
    "lord_mercenary_service_interject",
    [
      (str_store_string, s4, "str_npc_riva_to_lord_f"),
      (play_sound, "snd_riva_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_mercenary_service",
    [],
    "This should not show",
    "lord_mercenary_service_interject",
    []],

  [anyone, "lord_mercenary_service_interject",
    [],
    "I've no doubt that you would be up to the task.",
    "lord_mercenary_service",
    []],

  [plyr|anyone, "lord_mercenary_service",
    [],
    "Aye, I'll join {s9}.",
    "lord_mercenary_service_accept",
    []],

  [plyr|anyone, "lord_mercenary_service",
    [],
    "I'm interested. Please tell me more.",
    "lord_mercenary_elaborate_pay",
    []],

  [plyr|anyone, "lord_mercenary_service",
    [],
    "I'm not interested, thank you.",
    "lord_mercenary_service_reject",
    []],

  [anyone, "lord_mercenary_service_accept",
    [
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ],
    "Perfect. Of course you shall have to make a formal declaration of allegiance, and give your oath that you and your company will remain in service to {s9} for a period of no less than one month.",
    "lord_mercenary_service_verify",
    []],

  [plyr|anyone, "lord_mercenary_service_verify",
    [],
    "As you wish. Your enemies are my enemies.",
    "lord_mercenary_service_verify_2",
    []],

  [plyr|anyone, "lord_mercenary_service_verify",
    [],
    "On second thought, forget it.",
    "lord_mercenary_service_reject",
    []],

  [anyone, "lord_mercenary_service_verify_2",
    [],
    "That will do. You've made a wise choice, my friend. {s9} does well by its loyal fighters, you will receive many rewards for your service.",
    "lord_mercenary_service_accept_3",
    [
      (call_script, "script_troop_add_gold", "trp_player", "$temp"),
      (store_current_day, ":var0"),
      (store_add, "$mercenary_service_next_renew_day", ":var0", 30),
      (call_script, "script_player_join_faction", "$g_talk_troop_faction"),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ]],

  [anyone, "lord_mercenary_service_accept_3",
    [],
    "Now, I suggest you prepare for a serious campaign. Train and equip your soldiers as best you can in the meantime, and respond quickly when you are summoned for duty.",
    "lord_pretalk",
    []],

  [anyone, "lord_mercenary_service_reject",
    [
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ],
    "I'm very sorry to hear that. You'll find no better place than {s9}, be sure of that.",
    "lord_pretalk",
    []],

  [anyone, "lord_mercenary_elaborate_pay",
    [
      (assign, reg12, "$temp"),
    ],
    "I can offer you a contract for one month. At the end of this period, it can be extended on a monthly basis. An initial sum of {reg12} denars will be paid to you to seal the contract. After that, you'll receive wages from {s10} each week, according to the number and quality of the soldiers in your company. You still have your rights to battlefield loot and salvage, as well as any prisoners you capture. War can be very profitable at times...",
    "lord_mercenary_elaborate_1",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s10, ":var0"),
    ]],

  [anyone, "lord_mercenary_service_elaborate_duty",
    [],
    "Duties... There are only a few, none of them difficult. The very first thing is to declare your allegiance. An oath of loyalty to our cause. Once that's done, you shall be required to fulfill certain responsibilities. You'll participate in military campaigns, fulfill any duties given to you by your commanders, and most of all you shall attack the enemies of our kingdom wherever you might find them.",
    "lord_mercenary_elaborate_1",
    [
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 11),
      (str_store_troop_name, s10, ":var0"),
    ]],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [],
    "And what about my duties as a mercenary?",
    "lord_mercenary_service_elaborate_duty",
    []],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [],
    "Can I hold on to any castles I take?",
    "lord_mercenary_elaborate_castle",
    []],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [
      (neg|troop_slot_ge, "trp_player", 13, 1),
    ],
    "Can I fly my own banner?",
    "lord_mercenary_elaborate_banner",
    []],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [],
    "How much will you pay me for my service?",
    "lord_mercenary_elaborate_pay",
    []],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [],
    "Sounds good. I wish to enter your service as a mercenary.",
    "lord_mercenary_service_accept",
    []],

  [plyr|anyone, "lord_mercenary_elaborate_1",
    [],
    "Apologies, my sword is not for hire.",
    "lord_mercenary_service_reject",
    []],

  [anyone, "lord_mercenary_elaborate_castle",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, 0, 1),
      (eq, ":var0", 1),
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Only my loyal vassals can own lands and castles in my realm -- and all my vassals are men.\I am not inclined to depart from this tradition without a very good reason. If you prove yourself in battle, you can swear an oath of homage to me and become my vassal.\We may then discuss how you may obtain a castle.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_mercenary_elaborate_castle",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, 0, 1),
      (eq, ":var0", 1),
    ],
    "Hmm... Only loyal vassals of {s10} can own lands and castles. While kings will sometimes accept vassalage from men who prove themselves in battle, and grant them land, I have never heard of a king who gave fiefs to women. You had best discuss that issue with {s10} himself.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_mercenary_elaborate_castle",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Only my loyal vassals can own lands and castles in my realm. A mercenary can not be trusted with such a responsibility. However, after serving for some time, you can swear homage to me and become my vassal. Then you will be rewarded with a fief.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_mercenary_elaborate_castle",
    [],
    "Only loyal vassals of {s10} can own lands and castles. You understand, a simple mercenary cannot be trusted with such responsibility. However, after serving for some time, you may earn the right to swear homage to {s10} and become his vassal. Then you would be rewarded with a fief.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_mercenary_elaborate_banner",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Only my noble vassals have the honor of carrying their own banners. However, after some time in mercenary service, you may earn the opportunity to swear homage to me and become my vassal, gaining the right to choose a banner of your own and fight under it in battle.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_mercenary_elaborate_banner",
    [],
    "Only noble vassals of {s10} have the honor of carrying their own banners. However, after some time of mercenary service, perhaps you can earn the opportunity to swear homage to {s10} and become his vassal, gaining the right to choose a banner of your own and fight under it in battle.",
    "lord_mercenary_elaborate_1",
    []],

  [anyone, "lord_request_mission_ask",
    [
      (store_partner_quest, ":var0"),
      (ge, ":var0", 0),
    ],
    "You still haven't finished the last job I gave you, {playername}. You should be working on that, not asking me for other things to do.",
    "lord_pretalk",
    []],

  [anyone, "lord_request_mission_ask",
    [
      (troop_slot_eq, "$g_talk_troop", 20, 1),
    ],
    "I don't have any other jobs for you right now.",
    "lord_pretalk",
    []],

  [auto_proceed|anyone, "lord_request_mission_ask",
    [],
    "A task?",
    "companion_comment_mission",
    [
      (call_script, "script_get_quest", "$g_talk_troop"),
      (assign, "$random_quest_no", reg0),
    ]],

  [anyone|other(trp_npc_adonja), "companion_comment_mission",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_adonja"),
      (neg|troop_is_wounded, "trp_npc_adonja"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 10),
    ],
    "{s4}",
    "lord_tell_mission",
    [
      (str_store_string, s4, "str_npc_adonja_to_lord_f"),
      (play_sound, "snd_adonja_to_lord_f"),
    ]],

  [anyone|other(trp_npc_julia), "companion_comment_mission",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_julia"),
      (neg|troop_is_wounded, "trp_npc_julia"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 15),
    ],
    "{s4}",
    "lord_tell_mission",
    [
      (str_store_string, s4, "str_npc_julia_to_lord_f"),
      (play_sound, "snd_julia_to_lord_f"),
    ]],

  [anyone|other(trp_npc_diev), "companion_comment_mission",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_diev"),
      (neg|troop_is_wounded, "trp_npc_diev"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 20),
    ],
    "{s4}",
    "lord_tell_mission",
    [
      (str_store_string, s4, "str_npc_diev_to_lord_f"),
      (play_sound, "snd_diev_to_lord_f"),
    ]],

  [anyone|other(trp_npc_alyssa), "companion_comment_mission",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_alyssa"),
      (neg|troop_is_wounded, "trp_npc_alyssa"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 25),
    ],
    "{s4}",
    "lord_tell_mission",
    [
      (str_store_string, s4, "str_npc_alyssa_to_lord_f"),
      (play_sound, "snd_alyssa_to_lord_f"),
    ]],

  [anyone|other(trp_npc_boadice), "companion_comment_mission",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_boadice"),
      (neg|troop_is_wounded, "trp_npc_boadice"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 30),
    ],
    "{s4}",
    "lord_tell_mission",
    [
      (str_store_string, s4, "str_npc_boadice_to_lord_f"),
      (play_sound, "snd_boadice_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_mission",
    [],
    "This should not show",
    "lord_tell_mission",
    []],

  [anyone, "lord_request_mission_ask",
    [
      (this_or_next|troop_slot_eq, "$g_talk_troop", 5, 2),
      (troop_slot_eq, "trp_player", 34, "$g_talk_troop"),
      (troop_get_type, ":var0", "trp_player"),
      (ge, ":var0", 1),
    ],
    "My lady, by the traditions of courtship, I should be offering my services to you. Unfortunately, I have little time right now, so I beg you to take this declaration of my esteem in its place.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_mission",
    [
      (eq, "$player_has_homage", 1),
      (neq, "$random_quest_no", "qst_rescue_prisoner"),
      (neq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (neq, "$random_quest_no", "qst_raise_troops"),
      (neq, "$random_quest_no", "qst_escort_lady"),
      (neq, "$random_quest_no", "qst_lend_companion"),
      (neq, "$random_quest_no", "qst_capture_enemy_hero"),
      (neq, "$random_quest_no", "qst_cause_provocation"),
    ],
    "There are some minor errands which I need completed, but it would be more appropriate to give them to one of my own men, not to a sworn vassal of the realm.",
    "lord_tell_mission_sworn_vassal",
    []],

  [anyone, "lord_tell_mission_sworn_vassal",
    [
      (this_or_next|party_slot_eq, "$g_talk_troop_party", 4, 1),
      (party_slot_eq, "$g_talk_troop_party", 4, 5),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (str_store_party_name, s4, ":var0"),
    ],
    "If you are looking for action against our foes, you may join our attack on {s4}. The enemy may come in force to oppose us, so it is good to have as many men as possible.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_mission_sworn_vassal",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (party_get_slot, ":var0", "$g_talk_troop_party", 5),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 55),
      (party_is_active, ":var1"),
      (store_faction_of_party, ":var2", ":var1"),
      (store_relation, ":var3", ":var2", "$g_talk_troop_faction"),
      (lt, ":var3", 0),
      (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (str_store_party_name, s4, ":var0"),
      (str_store_faction_name, s5, ":var2"),
    ],
    "If you are looking for action against our foes, you may try venturing out to {s4}. We have received word that a force of the {s5} is in the area, and I am going there myself. I cannot guarantee that our enemies will be there when you arrive, of course.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_mission_sworn_vassal",
    [
      (eq, "$g_talk_troop_faction", "$players_kingdom"),
      (assign, ":var0", -1),
      (assign, ":var1", 9999),
      (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var3", ":var2"),
        (eq, ":var3", "$g_talk_troop_faction"),
        (party_get_slot, ":var4", ":var2", 55),
        (party_is_active, ":var4"),
        (store_faction_of_party, ":var5", ":var4"),
        (is_between, ":var5", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (store_relation, ":var6", ":var5", "$g_talk_troop_faction"),
        (lt, ":var6", 0),
        (store_distance_to_party_from_party, ":var7", ":var2", "p_main_party"),
        (lt, ":var7", ":var1"),
        (assign, ":var0", ":var2"),
        (assign, ":var1", ":var7"),
        (str_store_faction_name, s5, ":var5"),
      (try_end),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (str_store_party_name, s4, ":var0"),
    ],
    "If you are looking for action against our foes, you may try venturing out to {s4}. We have received word that a force of the {s5} is in the area. I am not currently headed that way, but others may be. I cannot guarantee that our enemies will be there when you arrive, of course.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_mission_sworn_vassal",
    [],
    "If a worthy task presents itself, however, I may have a favor to ask of you at a later date.",
    "lord_pretalk",
    []],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (str_store_troop_name_plural, s4, ":var1"),
    ],
    "Yes -- there is something you can do for us. We have heard reports that a group of {s4} have established a hideout in this area, and have been attacking travelers. If you could find their lair and destroy it, we would be very grateful.",
    "destroy_lair_quest_brief",
    []],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_rescue_prisoner"),
    ],
    "My {s11}, {s13}, has been taken prisoner by {s14} of the {s15}. Normally, honorable nobles will grant prisoners of gentle blood the privilege of parole, and treat them as honored guests so long as they give their word that they will not attempt to escape, until such time as a ransom can be paid. But {s14}, instead of granting {s13} parole, has consigned my {s11} to his dungeons - no doubt in the hope that he can demand more from us.",
    "lord_mission_rescue_prisoner",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (troop_get_slot, ":var1", ":var0", 8),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s24, ":var1"),
      (party_get_slot, ":var2", ":var1", 7),
      (str_store_troop_name, s14, ":var2"),
      (store_faction_of_party, ":var3", ":var1"),
      (str_store_faction_name, s15, ":var3"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "str_s9_asked_you_to_rescue_s13_who_is_prisoner_at_s24"),
    ]],

  [anyone, "lord_mission_rescue_prisoner",
    [],
    "We need you to get him out of prison. You may be able to pay a ransom - in which case we could cover your expenses, up to 5000 denars. If you have connections within {s24}, you may be able to use them to sneak him out. Or, you may try a more direct approach - walk up to the gaoler, take the keys by force, and then fight your way out. Can you do this for us?",
    "lord_mission_rescue_prisoner_confirm",
    []],

  [plyr|anyone, "lord_mission_rescue_prisoner_confirm",
    [],
    "I can try.",
    "lord_mission_rescue_prisoner_accepted",
    []],

  [plyr|anyone, "lord_mission_rescue_prisoner_confirm",
    [],
    "I don't think that I can help you.",
    "lord_mission_rescue_prisoner_rejected",
    []],

  [anyone, "lord_mission_rescue_prisoner_rejected",
    [],
    "It would not have been an easy task. Perhaps we will find another way.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_rescue_prisoner_accepted",
    [],
    "We are most grateful. Could I ask you how you were planning to proceed?",
    "lord_mission_rescue_prisoner_method",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "lord_mission_rescue_other_ideas",
    [],
    "Did you have any other ideas which you wished to discuss?",
    "lord_mission_rescue_prisoner_method",
    []],

  [plyr|anyone, "lord_mission_rescue_prisoner_method",
    [],
    "I am thinking of breaking into the prison in {s24}, finding {s13}, and fighting my way out.",
    "lord_mission_rescue_prisoner_method_prisonbreak",
    []],

  [plyr|anyone, "lord_mission_rescue_prisoner_method",
    [],
    "I am thinking of taking {s24} by storm.",
    "lord_mission_rescue_prisoner_method_siege",
    []],

  [plyr|anyone, "lord_mission_rescue_prisoner_method",
    [],
    "I have done enough planning. Time to act!",
    "lord_mission_rescue_prisoner_planning_end",
    []],

  [anyone, "lord_mission_rescue_prisoner_planning_end",
    [],
    "May the heavens protect you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_rescue_prisoner_method_prisonbreak",
    [],
    "I had discussed this idea with some of my men. One could enter {s24}, either in disguise or openly, then walk up to the prison guard and try to take the keys by force. However, getting out may be difficult. The garrison may be slow to react, but even so, you are likely to find yourself fighting a half dozen or more of the enemy at once, with limited space in which to maneuver. If you can fight your way past them, though, you can probably get out.",
    "lord_mission_rescue_prisoner_method_prisonbreak_2",
    []],

  [anyone, "lord_mission_rescue_prisoner_method_prisonbreak_2",
    [],
    "You may find it useful to create a distraction, to divert the attention of some of the garrison. If you have any connections in the villages near {s24}, this may be a time to put them to use.",
    "lord_mission_rescue_other_ideas",
    []],

  [anyone, "lord_mission_rescue_prisoner_method_siege",
    [],
    "Well, that is certainly the most direct approach.",
    "lord_mission_rescue_other_ideas",
    []],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_deliver_message"),
    ],
    "I need to send a letter to {s13} who should be currently at {s4}. If you will be heading towards there, would you deliver it to him? The letter needs to be in his hands in 30 days.",
    "lord_mission_deliver_message",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (quest_get_slot, ":var1", "$random_quest_no", 1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s4, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to take a message to {s13}. {s13} was believed to be at {s4} when you were given this quest."),
    ]],

  [plyr|anyone, "lord_mission_deliver_message",
    [],
    "Certainly, I intend to pass by {s4} and it would be no trouble.",
    "lord_mission_deliver_message_accepted",
    []],

  [plyr|anyone, "lord_mission_deliver_message",
    [],
    "I doubt I'll be seeing {s13} anytime soon, {s65}. You'd best send it with someone else.",
    "lord_mission_deliver_message_rejected",
    []],

  [plyr|anyone, "lord_mission_deliver_message",
    [],
    "I am no errand boy, sir. Hire a courier for your trivialities.",
    "lord_mission_deliver_message_rejected_rudely",
    []],

  [anyone, "lord_mission_deliver_message_accepted",
    [],
    "I appreciate it, {playername}. Here's the letter, and a small sum to cover your travel expenses. Give my regards to {s13} when you see him.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_troop_add_gold", "trp_player", 30),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_deliver_message_rejected",
    [],
    "Ah, all right then. Well, I am sure I will find someone else.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_mission_deliver_message_rejected_rudely",
    [],
    "Hm, is this how you respond to a polite request for a small favor? A poor show, {playername}. I didn't know you would take offence.",
    "lord_mission_deliver_message_rejected_rudely_2",
    []],

  [plyr|anyone, "lord_mission_deliver_message_rejected_rudely_2",
    [],
    "Then you shall know better from now on.",
    "lord_mission_deliver_message_rejected_rudely_3",
    []],

  [plyr|anyone, "lord_mission_deliver_message_rejected_rudely_2",
    [],
    "Forgive my temper, {s65}. I'll deliver your letter.",
    "lord_mission_deliver_message_accepted",
    []],

  [anyone, "lord_mission_deliver_message_rejected_rudely_3",
    [],
    "All right. I will remember that.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -4),
      (quest_set_slot, "$random_quest_no", 25, 150),
      (troop_set_slot, "$g_talk_troop", 20, 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_deliver_message_to_enemy_lord"),
    ],
    "I need to deliver a letter to {s13} of {s15}, who must be at {s4} currently. If you are going towards there, would you deliver my letter to him? The letter needs to reach him in 40 days.",
    "lord_mission_deliver_message",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (quest_get_slot, ":var1", "$random_quest_no", 1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s4, ":var1"),
      (store_troop_faction, ":var2", ":var0"),
      (str_store_faction_name_link, s15, ":var2"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to take a message to {s13} of {s15}. {s13} was believed to be at {s4} when you were given this quest."),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_escort_lady"),
    ],
    "There is a small thing... My {s17} {s13} is due for a visit to her relatives at {s14}. The visit has been postponed several times already with all the trouble on the roads, but this time she is adamant about going. So, I want to at least make sure she's well-guarded. I trust you well, {playername} so I would be very grateful if you could escort her to {s14}.",
    "companion_comment_escort_lady",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 4),
      (quest_get_slot, ":var1", "$random_quest_no", 1),
      (try_begin),
        (troop_slot_eq, ":var0", 31, "$g_talk_troop"),
        (str_store_string, s17, "str_daughter"),
      (else_try),
        (str_store_string, s17, "str_wife"),
      (try_end),
      (str_store_troop_name_link, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s14, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s11} asked you to escort his {s17} {s13} to {s14}."),
    ]],

  [anyone|other(trp_npc_sigismund), "companion_comment_escort_lady",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_sigismund"),
      (neg|troop_is_wounded, "trp_npc_sigismund"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "companion_comment_escort_lady_interject",
    [
      (str_store_string, s4, "str_npc_siggy_to_lord_f"),
      (play_sound, "snd_siggy_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_escort_lady",
    [],
    "This should not show",
    "companion_comment_escort_lady_interject",
    []],

  [anyone, "companion_comment_escort_lady_interject",
    [],
    "Make sure she arrives safe and sound.",
    "lord_mission_told",
    []],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_deal_with_bandits_at_lords_village"),
    ],
    "A group of bandits have taken refuge in my village of {s15}. They are plundering nearby farms, and killing villagers at whim and feasting on my cattle.I'd like nothing better than to go out there and teach them a lesson.",
    "companion_comment_deal_with_bandits",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s15, ":var0"),
      (str_store_troop_name_link, s13, "$g_talk_troop"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s13} asked you to deal with the bandits who are occupying the village of {s15} and then report back to him."),
    ]],

  [anyone|other(trp_npc_alistair), "companion_comment_deal_with_bandits",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_alistair"),
      (neg|troop_is_wounded, "trp_npc_alistair"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "companion_comment_deal_with_bandits_interject",
    [
      (str_store_string, s4, "str_npc_alistair_to_lord_f"),
      (play_sound, "snd_alistair_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_deal_with_bandits",
    [],
    "This should not show",
    "companion_comment_deal_with_bandits_interject",
    []],

  [anyone, "companion_comment_deal_with_bandits_interject",
    [],
    "I have my hands full at the moment, so I can't do anything about it.",
    "lord_mission_deal_with_bandits_told",
    []],

  [plyr|anyone, "lord_mission_deal_with_bandits_told",
    [],
    "Worry not, I can go to {s15} and deal with these scum for you.",
    "lord_mission_deal_with_bandits_accepted",
    []],

  [plyr|anyone, "lord_mission_deal_with_bandits_told",
    [],
    "You shall have to find help elsewhere, I am too busy.",
    "lord_mission_deal_with_bandits_rejected",
    []],

  [anyone, "lord_mission_deal_with_bandits_accepted",
    [],
    "Will you do that? Know that, I will be grateful to you. Here is some money for the expenses of your campaign. Make an example of those {s43}s.",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_insult_default"),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_troop_add_gold", "trp_player", 200),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_deal_with_bandits_rejected",
    [],
    "Ah... Very well then, forget I brought it up.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_raise_troops"),
    ],
    "No lord should have to admit this, {playername}, but I was inspecting my soldiers the other day and there are men here who don't know which end of a sword to hold. {s43} You are a warrior of renown, {playername}. Will you train some troops for me? I would be grateful to you.",
    "companion_comment_raise_troops",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_troop_train_request_default"),
    ]],

  [anyone|other(trp_npc_donavan), "companion_comment_raise_troops",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_donavan"),
      (neg|troop_is_wounded, "trp_npc_donavan"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "lord_tell_mission_raise_troops",
    [
      (str_store_string, s4, "str_npc_donavan_to_lord_f"),
      (play_sound, "snd_donavan_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_raise_troops",
    [],
    "This should not show",
    "lord_tell_mission_raise_troops",
    []],

  [plyr|anyone, "lord_tell_mission_raise_troops",
    [],
    "How many men do you need?",
    "lord_tell_mission_raise_troops_2",
    []],

  [anyone, "lord_tell_mission_raise_troops_2",
    [],
    "If you can raise {reg1} {s14} and bring them to me, that will probably be enough.",
    "lord_mission_raise_troops_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (quest_get_slot, reg1, "$random_quest_no", 10),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_plural, s14, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to raise {reg1} {s14} and bring them to him."),
    ]],

  [plyr|anyone, "lord_mission_raise_troops_told",
    [
      (quest_get_slot, reg1, "$random_quest_no", 10),
    ],
    "Of course, {s65}. Give me {reg1} fresh recruits and I'll train them to be {s14}.",
    "lord_mission_raise_troops_accepted",
    []],

  [plyr|anyone, "lord_mission_raise_troops_told",
    [],
    "I am too busy these days to train anyone.",
    "lord_mission_raise_troops_rejected",
    []],

  [anyone, "lord_mission_raise_troops_accepted",
    [],
    "You've taken a weight off my shoulders, {playername}. I shall tell my sergeants to send you the recruits and attach them to your command. Also, I'll advance you some money to help with expenses. Here, this purse should do it. Thank you for your help.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_troop_add_gold", "trp_player", 100),
      (quest_get_slot, ":var0", "$random_quest_no", 4),
      (quest_get_slot, ":var1", "$random_quest_no", 10),
      (party_add_members, "p_main_party", ":var0", ":var1"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_raise_troops_rejected",
    [],
    "Oh, of course. I had expected as much. Well, good luck to you then.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_collect_taxes"),
      (assign, reg9, 0),
      (try_begin),
        (quest_get_slot, ":var0", "$random_quest_no", 1),
        (party_slot_eq, ":var0", 0, 3),
        (assign, reg9, 1),
      (try_end),
    ],
    "You probably know that I am the lord of the {reg9?town:village} of {s3}. However, it has been months since {s3} has delivered the taxes and rents due me as its rightful lord. Apparently the populace there has grown unruly lately and I need someone to go there and remind them of their obligations. And to... persuade them if they won't listen.",
    "companion_comment_collect_taxes",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s3, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to collect taxes from {s3}. He offered to leave you one-fifth of all the money you collect there."),
    ]],

  [anyone|other(trp_npc_frederick), "companion_comment_collect_taxes",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_frederick"),
      (neg|troop_is_wounded, "trp_npc_frederick"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "lord_mission_collect_taxes_told_interject",
    [
      (str_store_string, s4, "str_npc_fred_to_lord_f"),
      (play_sound, "snd_fred_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_collect_taxes",
    [],
    "This should not show",
    "lord_mission_collect_taxes_told_interject",
    []],

  [anyone, "lord_mission_collect_taxes_told_interject",
    [],
    "If you go there and raise the taxes they owe me, I will grant you one-fifth of everything you collect.",
    "lord_mission_collect_taxes_told",
    []],

  [plyr|anyone, "lord_mission_collect_taxes_told",
    [],
    "A fair offer, {s65}. We have an agreement.",
    "lord_mission_collect_taxes_accepted",
    []],

  [plyr|anyone, "lord_mission_collect_taxes_told",
    [],
    "Forgive me, I don't have the time.",
    "lord_mission_collect_taxes_rejected",
    []],

  [anyone, "lord_mission_collect_taxes_accepted",
    [],
    "Welcome news, {playername}. I will entrust this matter to you. Remember, those {reg9?townsmen:peasants} are foxy beasts, they will make every excuse not to pay me my rightful incomes. Do not let them fool you.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
      (assign, reg9, 0),
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (try_begin),
        (party_slot_eq, ":var0", 0, 3),
        (assign, reg9, 1),
      (try_end),
    ]],

  [anyone, "lord_mission_collect_taxes_rejected",
    [],
    "Oh, yes. Well, good luck to you then.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_hunt_down_fugitive"),
    ],
    "I have something you could help with, an issue with the lawless villain known as {s4}.  He murdered one of my men and has been on the run from his judgment ever since. I can't let him get away with avoiding justice, so I've put a bounty of {reg33} denars on his head. Friends of the murdered man reckon that this assassin may have taken refuge with his kinsmen at {s3}.",
    "companion_comment_hunt_down_fugitive",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (quest_get_slot, ":var1", "$random_quest_no", 13),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s3, ":var0"),
      (call_script, "script_get_name_from_dna_to_s50", ":var1"),
      (str_store_string, s4, s50),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to hunt down a fugitive named {s4}. He is currently believed to be at {s3}."),
      (quest_get_slot, ":var2", "qst_hunt_down_fugitive", 22),
      (assign, reg33, ":var2"),
    ]],

  [anyone|other(trp_npc_jocelyn), "companion_comment_hunt_down_fugitive",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_jocelyn"),
      (neg|troop_is_wounded, "trp_npc_jocelyn"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s5}",
    "companion_comment_hunt_down_fugitive_interject",
    [
      (str_store_string, s5, "str_npc_jocelyn_to_lord_f"),
      (play_sound, "snd_jocelyn_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_hunt_down_fugitive",
    [],
    "This should not show",
    "companion_comment_hunt_down_fugitive_interject",
    []],

  [anyone, "companion_comment_hunt_down_fugitive_interject",
    [],
    "You might be able to hunt him down and give him what he deserves, and claim the bounty for yourself.",
    "lord_mission_hunt_down_fugitive_told",
    []],

  [plyr|anyone, "lord_mission_hunt_down_fugitive_told",
    [],
    "Then I will hunt him down and execute the law.",
    "lord_mission_hunt_down_fugitive_accepted",
    []],

  [plyr|anyone, "lord_mission_hunt_down_fugitive_told",
    [],
    "I am too busy to go after him at the moment.",
    "lord_mission_hunt_down_fugitive_rejected",
    []],

  [anyone, "lord_mission_hunt_down_fugitive_accepted",
    [],
    "That's excellent, {playername}. I will be grateful to you and so will the family of the man he murdered. And of course the bounty on his head will be yours if you can get him. Well, good hunting to you.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_mission_hunt_down_fugitive_rejected",
    [],
    "As you wish, {playername}.I suppose there are plenty of bounty hunters around to get the job done...",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_kill_local_merchant"),
    ],
    "The wretched truth is that I owe a considerable sum of money to one of the merchants here in {s3}. I've no intention of paying it back, of course, but that loud-mouthed fool is making a terrible fuss about it. He even had the audacity to come and threaten me -- me! -- with a letter of complaint to the trade guilds and bankers. Why, he'd ruin my good reputation! So I need a {reg63?man:woman} I can trust, someone who will guarantee the man's silence. For good.",
    "lord_mission_told_kill_local_merchant",
    [
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s3, "$current_town"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to assassinate a local merchant at {s3}."),
    ]],

  [plyr|anyone, "lord_mission_told_kill_local_merchant",
    [],
    "Worry not, he shan't breathe a word.",
    "lord_mission_accepted_kill_local_merchant",
    []],

  [plyr|anyone, "lord_mission_told_kill_local_merchant",
    [],
    "I'm no common murderer, sir. Find someone else for your dirty job.",
    "lord_mission_rejected",
    []],

  [anyone, "lord_mission_accepted_kill_local_merchant",
    [],
    "Very good. I trust in your skill and discretion, {playername}. Do not disappoint me. Go now and wait for my word, I'll send you a message telling when and where you can catch the merchant. Dispose of him for me and I shall reward you generously.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (assign, "$g_leave_town", 1),
      (assign, "$qst_kill_local_merchant_center", "$current_town"),
      (rest_for_hours, 10, 4, 0),
      (finish_mission),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_meet_spy_in_enemy_town"),
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name, s13, ":var0"),
      (store_faction_of_party, ":var1"),
      (str_store_faction_name, s14, ":var1"),
    ],
    "I have a sensitive matter which needs tending to, {playername}, and no trustworthy retainers to take care of it. The fact is that I have a spy in {s13} to keep an eye on things for me, and report anything that might warrant my attention. Every week I send someone to collect the spy's reports and bring them back to me. The job's yours if you wish it.",
    "lord_mission_told_meet_spy_in_enemy_town",
    []],

  [plyr|anyone, "lord_mission_told_meet_spy_in_enemy_town",
    [],
    "I don't mind a bit of skullduggery. Count me in.",
    "quest_meet_spy_in_enemy_town_accepted",
    []],

  [plyr|anyone, "lord_mission_told_meet_spy_in_enemy_town",
    [],
    "I must decline. This cloak-and-dagger work isn't fit for me.",
    "quest_meet_spy_in_enemy_town_rejected",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_accepted",
    [],
    "Excellent! Make your way to {s13} as soon as you can, the spy will be waiting.",
    "quest_meet_spy_in_enemy_town_accepted_response",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (quest_get_slot, ":var1", "$random_quest_no", 10),
      (store_sub, ":var2", ":var1", "str_secret_sign_1"),
      (val_add, ":var2", "str_countersign_1"),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_string, s11, ":var1"),
      (str_store_string, s12, ":var2"),
      (str_store_party_name_link, s13, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} has asked you to meet with a spy in {s13}."),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_cf_center_get_free_walker", ":var0"),
      (call_script, "script_center_set_walker_to_type", ":var0", reg0, 3),
      (str_store_item_name, s14, "$spy_item_worn"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "quest_meet_spy_in_enemy_town_accepted_response",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s13, ":var0"),
    ],
    "{s13} is heavily defended. How can I get close without being noticed?",
    "quest_meet_spy_in_enemy_town_accepted_2",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_accepted_2",
    [],
    "You shall have to use stealth. Take care to avoid enemy strongholds, villages and patrols, and don't bring too many men with you. If you fail to sneak in the first time, give it a while for the garrison to lower its guard again, or you may have a difficult time infiltrating the town.",
    "quest_meet_spy_in_enemy_town_accepted_response",
    []],

  [plyr|anyone, "quest_meet_spy_in_enemy_town_accepted_response",
    [],
    "How will I recognize the spy?",
    "quest_meet_spy_in_enemy_town_accepted_3",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_accepted_3",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s13, ":var0"),
      (troop_get_type, reg7, "$spy_quest_troop"),
      (quest_get_slot, ":var1", "$random_quest_no", 10),
      (store_sub, ":var2", ":var1", "str_secret_sign_1"),
      (val_add, ":var2", "str_countersign_1"),
      (str_store_string, s11, ":var1"),
      (str_store_string, s12, ":var2"),
    ],
    "Once you get to {s13} you must talk to the locals, the spy will be one of them. If you think you've found the spy, say the phrase '{s11}' The spy will respond with the phrase '{s12}' Thus you will know the other, and {reg7?she:he} will give you any information {reg7?she:he}'s gathered in my service.",
    "quest_meet_spy_in_enemy_town_accepted_response",
    []],

  [plyr|anyone, "quest_meet_spy_in_enemy_town_accepted_response",
    [],
    "Will I be paid?",
    "quest_meet_spy_in_enemy_town_accepted_4",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_accepted_4",
    [],
    "Of course, I have plenty of silver in my coffers for loyal {reg63?men:women} like you. Do well by me, {playername}, and you'll rise high.",
    "quest_meet_spy_in_enemy_town_accepted_response",
    []],

  [plyr|anyone, "quest_meet_spy_in_enemy_town_accepted_response",
    [],
    "I know what to do. Farewell, my lord.",
    "quest_meet_spy_in_enemy_town_accepted_end",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_accepted_end",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 10),
      (store_sub, ":var1", ":var0", "str_secret_sign_1"),
      (val_add, ":var1", "str_countersign_1"),
      (str_store_string, s11, ":var0"),
      (str_store_string, s12, ":var1"),
    ],
    "Good luck, {playername}. Remember, the secret phrase is '{s11}' The counterphrase is '{s12}' Bring any reports back to me, and I'll compensate you for your trouble.",
    "lord_pretalk",
    []],

  [anyone, "quest_meet_spy_in_enemy_town_rejected",
    [],
    "As you wish, {playername}, but I strongly advise you to forget anything I told you about any spies. They do not exist, have never existed, and no one will ever find them. Remember that.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_cause_provocation"),
      (quest_get_slot, ":var0", "$random_quest_no", 3),
      (str_store_faction_name_link, s13, ":var0"),
    ],
    "This peace with {s13} ill suits me, {playername}. We've let those swine have their way for far too long. Now they get stronger with each passing and their arrogance knows no bounds. I say, we must wage war on them before it's too late! Unfortunately, some of the bleeding hearts among our realm's lords are blocking a possible declaration of war.",
    "companion_comment_raid_caravan_war",
    []],

  [anyone|other(trp_npc_rayne), "companion_comment_raid_caravan_war",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_rayne"),
      (neg|troop_is_wounded, "trp_npc_rayne"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "companion_comment_raid_caravan_war_interject",
    [
      (str_store_string, s4, "str_npc_rayne_to_lord_f"),
      (play_sound, "snd_rayne_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_raid_caravan_war",
    [],
    "This should not show",
    "companion_comment_raid_caravan_war_interject",
    []],

  [anyone, "companion_comment_raid_caravan_war_interject",
    [],
    "Witless cowards with no stomach for blood.",
    "lord_mission_told_raid_caravan_to_start_war",
    []],

  [plyr|anyone, "lord_mission_told_raid_caravan_to_start_war",
    [],
    "You are right, {s65}, but what can we do?",
    "lord_mission_tell_raid_caravan_to_start_war_2",
    []],

  [plyr|anyone, "lord_mission_told_raid_caravan_to_start_war",
    [],
    "I disagree, sir. It is better that there be peace.",
    "quest_raid_caravan_to_start_war_rejected_1",
    []],

  [anyone, "lord_mission_tell_raid_caravan_to_start_war_2",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 3),
      (str_store_faction_name_link, s13, ":var0"),
      (str_store_faction_name, s14, "$g_talk_troop_faction"),
    ],
    "Ah, 'tis good to hear someone who understands! As a matter of fact, there is something we can do, {playername}. A little bit of provocation ... If one of our war parties managed to enter their territory and pillage one of their caravans, or raided one of their villages, and perhaps left behind a little token or two of the {s14}, they would have ample cause to declare war on us. And then, well, even the cowards among us must rise to defend themselves. So what do you say? Are you interested?",
    "lord_mission_tell_raid_caravan_to_start_war_3",
    []],

  [plyr|anyone, "lord_mission_tell_raid_caravan_to_start_war_3",
    [],
    "An excellent plan. Count me in.",
    "quest_raid_caravan_to_start_war_accepted",
    []],

  [plyr|anyone, "lord_mission_tell_raid_caravan_to_start_war_3",
    [],
    "Why don't you do that yourself?",
    "lord_mission_tell_raid_caravan_to_start_war_4",
    []],

  [anyone, "lord_mission_tell_raid_caravan_to_start_war_4",
    [],
    "Well, {playername}, some of the lords in our kingdom won't like the idea of someone inciting a war without their consent. They are already looking for an excuse to get at me, and if I did this they could make me pay for it dearly. You, on the other hand, are young, well-liked, and daring, so you might just get away with it. And of course I will back you up and defend your actions against your opponents. All in all, a few lords might be upset at your endeavor, but I am sure you won't be bothered with that.",
    "lord_mission_tell_raid_caravan_to_start_war_5",
    []],

  [plyr|anyone, "lord_mission_tell_raid_caravan_to_start_war_5",
    [],
    "That seems reasonable. I am willing to do this.",
    "quest_raid_caravan_to_start_war_accepted",
    []],

  [plyr|anyone, "lord_mission_tell_raid_caravan_to_start_war_5",
    [],
    "I don't like this. Find yourself someone else to take the blame for your schemes.",
    "quest_raid_caravan_to_start_war_rejected_2",
    []],

  [anyone, "quest_raid_caravan_to_start_war_accepted",
    [],
    "Very good! A raid on a caravan, or, if you can't manage that, an attack on one of their villages, should do the trick. Now, good luck and good hunting. Go set the borders aflame!",
    "close_window",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 3),
      (quest_get_slot, ":var1", "$random_quest_no", 10),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_faction_name_link, s13, ":var0"),
      (assign, reg13, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "str_s9_asked_you_to_attack_a_village_or_some_caravans_as_to_provoke_a_war_with_s13"),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "quest_raid_caravan_to_start_war_rejected_1",
    [],
    "Ah, you think so? But how long will your precious peace last? Not long, believe me.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "quest_raid_caravan_to_start_war_rejected_2",
    [],
    "Hm. As you wish, {playername}. I thought you had some fire in you, but it seems I was wrong.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_bring_back_runaway_serfs"),
    ],
    "Well, some of the serfs working my fields in {s4} have run away. The ungrateful swine, I let them plough my fields and rent my cottages, and this is how they repay me! From what I've been hearing, they're running to {s3} as fast as they can, and have split up into three groups to try and avoid capture. I want you to capture all three groups and fetch them back to {s4} by whatever means necessary. I should really have them hanged for attempting to escape, but we need hands for the upcoming harvest, so I'll let them go off this time with a good beating.",
    "lord_mission_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (quest_get_slot, ":var1", "$random_quest_no", 7),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s3, ":var0"),
      (str_store_party_name_link, s4, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "str_s9_asked_you_to_catch_the_three_groups_of_runaway_serfs_and_bring_them_back_to_s4_alive_and_breathing_he_said_that_all_three_groups_are_heading_towards_s3"),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_follow_spy"),
    ],
    "I have good information that a man in this very town is actually an enemy spy. He should be seized and hanged for his impudence, but we also believe that very soon he will leave town to meet with his master, the man to whom the spy feeds all his little whispers. The spy himself is of little import, but the master is a dangerous man, and could tell us a great deal if we could only get our hands on him...",
    "lord_tell_mission_follow_spy",
    []],

  [anyone, "lord_tell_mission_follow_spy",
    [],
    "I want you to wait here until the spy leaves town. Then you must follow him, stealthily, to the meeting place. You must take absolute care not to be seen by the spy on your way, else he may suspect foul play and turn back. When the master appears, you must ambush and arrest them and bring the pair back to me. Alive, if you please.",
    "lord_tell_mission_follow_spy_2",
    []],

  [plyr|anyone, "lord_tell_mission_follow_spy_2",
    [],
    "I'll do it, {s65}.",
    "lord_tell_mission_follow_spy_accepted",
    []],

  [plyr|anyone, "lord_tell_mission_follow_spy_2",
    [],
    "No, this skulking is not for me.",
    "lord_tell_mission_follow_spy_rejected",
    []],

  [anyone, "lord_tell_mission_follow_spy_accepted",
    [],
    "Good, I'm sure you'll do a fine job of it. One of my men will point the spy out to you when he leaves, so you will know the man to follow. Remember, I want them both, and I want them alive.",
    "close_window",
    [
      (str_store_troop_name_link, s11, "$g_talk_troop"),
      (str_store_party_name_link, s12, "$g_encountered_party"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s11} asked you to follow the spy that will leave {s12}. Be careful not to let the spy see you on the way, or he may get suspicious and turn back. Once the spy meets with his accomplice, you are to capture them and bring them back to {s11}."),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (spawn_around_party, "p_main_party", "pt_spy_partners"),
      (assign, "$qst_follow_spy_spy_partners_party", reg0),
      (store_character_level, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 35),
        (store_random_in_range, ":var1", 3, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_hired_blade", ":var1"),
        (store_random_in_range, ":var2", 4, 5),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sharp", ":var2"),
        (store_random_in_range, ":var3", 1, 2),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sergeants", ":var3"),
      (else_try),
        (ge, ":var0", 30),
        (store_random_in_range, ":var1", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_hired_blade", ":var1"),
        (store_random_in_range, ":var2", 3, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sharp", ":var2"),
        (store_random_in_range, ":var3", 2, 3),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sergeants", ":var3"),
      (else_try),
        (ge, ":var0", 25),
        (store_random_in_range, ":var1", 1, 3),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_hired_blade", ":var1"),
        (store_random_in_range, ":var2", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sharp", ":var2"),
        (store_random_in_range, ":var3", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_sergeants", ":var3"),
      (else_try),
        (ge, ":var0", 20),
        (store_random_in_range, ":var1", 1, 2),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_hired_blade", ":var1"),
        (store_random_in_range, ":var2", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_armcrossbow", ":var2"),
        (store_random_in_range, ":var3", 3, 5),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_swordsman", ":var3"),
      (else_try),
        (ge, ":var0", 15),
        (store_random_in_range, ":var1", 2, 3),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_cavalry", ":var1"),
        (store_random_in_range, ":var2", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_armcrossbow", ":var2"),
        (store_random_in_range, ":var3", 2, 4),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_swordsman", ":var3"),
      (else_try),
        (store_random_in_range, ":var1", 0, 2),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_cavalry", ":var1"),
        (store_random_in_range, ":var2", 1, 3),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_mercenary_crossbowman", ":var2"),
        (store_random_in_range, ":var3", 3, 6),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_caravan_guard", ":var3"),
      (try_end),
      (store_add, ":var4", ":var1", ":var2"),
      (val_add, ":var4", ":var3"),
      (try_begin),
        (lt, ":var4", 8),
        (store_sub, ":var5", 8, ":var4"),
        (party_add_members, "$qst_follow_spy_spy_partners_party", "trp_caravan_guard", ":var5"),
      (try_end),
      (party_set_position, "$qst_follow_spy_spy_partners_party", pos63),
      (party_set_ai_behavior, "$qst_follow_spy_spy_partners_party", ai_bhvr_hold),
      (party_set_flags, "$qst_follow_spy_spy_partners_party", 65536, 0),
      (set_spawn_radius, 0),
      (spawn_around_party, "$g_encountered_party", "pt_spy"),
      (assign, "$qst_follow_spy_spy_party", reg0),
      (party_set_ai_behavior, "$qst_follow_spy_spy_party", ai_bhvr_travel_to_party),
      (party_set_ai_object, "$qst_follow_spy_spy_party", "$qst_follow_spy_spy_partners_party"),
      (party_set_flags, "$qst_follow_spy_spy_party", 65536, 0),
      (assign, "$g_leave_town", 1),
      (rest_for_hours, 2, 4, 0),
    ]],

  [anyone, "lord_tell_mission_follow_spy_rejected",
    [],
    "A shame. Well, carry on as you were, {playername}...",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_capture_enemy_hero"),
    ],
    "There is a difficult job I need done, {playername}, and you may be the {reg63?man:one} who can carry it off. I need someone to capture one of the noble lords of {s13} and bring him to me. Afterwards, I'll be able to exchange him in return for a relative of mine held by {s13}. It is a simple enough job, but whomever you choose will be guarded by an elite band of personal retainers. Are you up for a fight?",
    "lord_tell_mission_capture_enemy_hero",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 3),
      (str_store_faction_name, s13, ":var0"),
    ]],

  [plyr|anyone, "lord_tell_mission_capture_enemy_hero",
    [],
    "Consider it done, {s65}.",
    "lord_tell_mission_capture_enemy_hero_accepted",
    []],

  [plyr|anyone, "lord_tell_mission_capture_enemy_hero",
    [],
    "I must refuse, {s65}. I am not a kidnapper.",
    "lord_tell_mission_capture_enemy_hero_rejected",
    []],

  [anyone, "lord_tell_mission_capture_enemy_hero_accepted",
    [],
    "I like your spirit! Go and bring me one of our enemies, and I'll toast your name in my hall when you return! And reward you for your efforts, of course...",
    "close_window",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 3),
      (str_store_troop_name_link, s11, "$g_talk_troop"),
      (str_store_faction_name_link, s13, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s11} asked you to capture a lord from {s13}, any lord, and then drag your victim back to {s11} for safekeeping."),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_tell_mission_capture_enemy_hero_rejected",
    [],
    "Clearly you lack the mettle I had thought you possessed. Very well, {playername}, I will find someone else.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_lend_companion"),
    ],
    "I don't have a job for you right now, but your companion {s3} is a skilled {reg3?lass:fellow} and I need someone with {reg3?her:his} talents. Will you lend {reg3?her:him} to me for a while?",
    "companion_comment_lend_companion",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (quest_get_slot, ":var1", "$random_quest_no", 10),
      (val_add, ":var1", 1),
      (assign, reg1, ":var1"),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name, s3, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (troop_get_type, reg3, ":var0"),
      (str_store_string, s2, "@{s9} asked you to lend your companion {s3} to him for a week."),
    ]],

  [anyone|other(trp_npc_sara), "companion_comment_lend_companion",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_sara"),
      (neg|troop_is_wounded, "trp_npc_sara"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "lord_tell_mission_lend_companion",
    [
      (str_store_string, s4, "str_npc_sara_to_lord_f"),
      (play_sound, "snd_sara_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_lend_companion",
    [],
    "This should not show",
    "lord_tell_mission_lend_companion",
    []],

  [plyr|anyone, "lord_tell_mission_lend_companion",
    [],
    "How long will you be needing {reg3?her:him}?",
    "lord_tell_mission_lend_companion_2",
    []],

  [anyone, "lord_tell_mission_lend_companion_2",
    [],
    "Just a few days, a week at most.",
    "lord_mission_lend_companion_told",
    []],

  [plyr|anyone, "lord_mission_lend_companion_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (str_store_troop_name, s3, ":var0"),
    ],
    "Then I will leave {s3} with you for one week.",
    "lord_tell_mission_lend_companion_accepted",
    []],

  [plyr|anyone, "lord_mission_lend_companion_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (str_store_troop_name, s3, ":var0"),
    ],
    "I am sorry, but I cannot do without {s3} for a whole week.",
    "lord_tell_mission_lend_companion_rejected",
    []],

  [anyone, "lord_tell_mission_lend_companion_accepted",
    [],
    "I cannot thank you enough, {playername}. Worry not, your companion shall be returned to you with due haste.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (party_remove_members, "p_main_party", ":var0", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_tell_mission_lend_companion_rejected",
    [],
    "Well, that's damned unfortunate, but I suppose I cannot force you or {s3} to agree. I shall have to make do without.",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_collect_debt"),
    ],
    "Some time ago, I loaned out a considerable sum of money to {s3}. {reg4} denars, to be precise. He was supposed to pay it back within a month but I haven't received a copper from him since. That was months ago. If you could collect the debt from him on my behalf, I would be grateful indeed. I would even let you keep one fifth of the money for your trouble. What do you say?",
    "companion_comment_collect_debt",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (quest_get_slot, ":var1", "$random_quest_no", 1),
      (quest_get_slot, reg4, "$random_quest_no", 10),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_link, s3, ":var0"),
      (str_store_party_name_link, s4, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} asked you to collect the debt of {reg4} denars {s3} owes to him. {s3} was at {s4} when you were given this quest."),
    ]],

  [anyone|other(trp_npc_leslie), "companion_comment_collect_debt",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_leslie"),
      (neg|troop_is_wounded, "trp_npc_leslie"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s5}",
    "lord_tell_mission_collect_debt",
    [
      (str_store_string, s5, "str_npc_leslie_to_lord_f"),
      (play_sound, "snd_leslie_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_collect_debt",
    [],
    "This should not show",
    "lord_tell_mission_collect_debt",
    []],

  [plyr|anyone, "lord_tell_mission_collect_debt",
    [],
    "Do you know where I can find {s3}, {s65}?",
    "lord_tell_mission_collect_debt_2",
    []],

  [anyone, "lord_tell_mission_collect_debt_2",
    [],
    "If you leave now, you should be able to find him at {s4}. I've no doubt that he will be suitably embarassed by his conduct and give you all the money he owes me.",
    "lord_tell_mission_collect_debt_3",
    []],

  [plyr|anyone, "lord_tell_mission_collect_debt_3",
    [],
    "Then I will talk to {s3} on your behalf.",
    "lord_tell_mission_collect_debt_accepted",
    []],

  [plyr|anyone, "lord_tell_mission_collect_debt_3",
    [],
    "Forgive me, {s65}, but I doubt I would be more successful than yourself.",
    "lord_tell_mission_collect_debt_rejected",
    []],

  [anyone, "lord_tell_mission_collect_debt_accepted",
    [],
    "You made me very happy by accepting this {playername}. Please, talk to {s3} and don't leave him without my money.",
    "close_window",
    [
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "lord_tell_mission_collect_debt_rejected",
    [],
    "Perhaps not, {playername}. I suppose I'm never getting that money back...",
    "lord_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_incriminate_loyal_commander"),
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 2),
      (quest_get_slot, ":var1", "qst_incriminate_loyal_commander", 4),
      (quest_get_slot, ":var2", "qst_incriminate_loyal_commander", 1),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s14, ":var2"),
      (str_store_troop_name_link, s15, ":var1"),
    ],
    "I tell you, that blubbering fool {s13} is not fit to rule {s14}. God knows he would be divested of his lands in an instant were it not for one of his loyal vassals, {s15}. As long as he has his vassal aiding him, it will be a difficult job beating him. So I need to get {s15} out of the picture, and I have a plan just to do that... With your help, naturally.",
    "lord_tell_mission_incriminate_commander",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander",
    [],
    "{s66}, I am all ears.",
    "lord_tell_mission_incriminate_commander_2",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander",
    [],
    "I don't wish to involve myself in anything dishonorable against {s15}.",
    "lord_tell_mission_incriminate_commander_rejected",
    []],

  [anyone, "lord_tell_mission_incriminate_commander_rejected",
    [],
    "Dishonorable? Bah! I was hoping I could count on you, {playername}, but you've shown me what a fool I was. I shall have to find someone whose loyalty I can trust.",
    "lord_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -5),
    ]],

  [anyone, "lord_tell_mission_incriminate_commander_2",
    [],
    "I have written a fake letter to {s15}, bearing my own seal, which implicates him in a conspiracy with us to stage a coup in {s14}, in my favor. If we can make {s13} believe the letter is genuine, he will deal with {s15} very swiftly. Of course, the challenge there is to convince {s13} that the letter is indeed real...",
    "lord_tell_mission_incriminate_commander_3",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_3",
    [],
    "Please continue, {s65}...",
    "lord_tell_mission_incriminate_commander_4",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_3",
    [],
    "No, I will not sully myself with this dishonorable scheme.",
    "lord_tell_mission_incriminate_commander_rejected",
    []],

  [anyone, "lord_tell_mission_incriminate_commander_4",
    [],
    "This is where you come into play. You'll take the letter to {s14}, then give it to one of your soldiers and instruct him to take it to {s15}. I will have one of my spies inform the town garrison so that your man will be arrested on his way. The guards will then find the letter and take it to {s13}. They'll torture your man, of course, to try and get the truth out of him, but all he knows is that you ordered the letter to be delivered to {s15} under the utmost secrecy. {s13} knows you serve me, and the fool will certainly believe the whole charade.",
    "lord_tell_mission_incriminate_commander_5",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_5",
    [],
    "Is that all?",
    "lord_tell_mission_incriminate_commander_7",
    []],

  [anyone, "lord_tell_mission_incriminate_commander_7",
    [
      (str_store_troop_name, s8, "$incriminate_quest_sacrificed_troop"),
      (str_store_troop_name_plural, s9, "$incriminate_quest_sacrificed_troop"),
    ],
    "There is one more thing... Your messenger must be someone trustworthy. If you sent the letter with a simple peasant, someone expendable, {s13} might suspect a plot. He may have the wits of a snail, but even a snail can see the obvious. Give the letter to someone of rank. One of your {s9}, perhaps.",
    "lord_tell_mission_incriminate_commander_8",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_8",
    [],
    "What? I can't send one of my trusted {s9} to his death!",
    "lord_tell_mission_incriminate_commander_9",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_8",
    [],
    "Then a {s8} it will be.",
    "lord_tell_mission_incriminate_commander_fin",
    []],

  [anyone, "lord_tell_mission_incriminate_commander_9",
    [],
    "Come now, {playername}. There is a place for sentimentality, but this is not it. Believe me, you shall be generously compensated, and what is the purpose of soldiers if not to die at our say-so?",
    "lord_tell_mission_incriminate_commander_10",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_10",
    [],
    "A {s8} it is.",
    "lord_tell_mission_incriminate_commander_fin",
    []],

  [plyr|anyone, "lord_tell_mission_incriminate_commander_10",
    [],
    "No, I'll not sacrifice one of my chosen men.",
    "lord_tell_mission_incriminate_commander_rejected",
    []],

  [anyone, "lord_tell_mission_incriminate_commander_fin",
    [],
    "I can't tell you how pleased I am to hear that, {playername}. You are removing one of the greatest obstacles in my path. Here is the letter, as well as 300 denars for your expenses. Remember, there'll be more once you succeed. Much, much more...",
    "lord_pretalk",
    [
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 2),
      (quest_get_slot, ":var1", "qst_incriminate_loyal_commander", 4),
      (quest_get_slot, ":var2", "qst_incriminate_loyal_commander", 1),
      (call_script, "script_troop_add_gold", "trp_player", 300),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (str_store_troop_name_link, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_party_name_link, s14, ":var2"),
      (str_store_troop_name_plural, s15, "$incriminate_quest_sacrificed_troop"),
      (str_store_troop_name_link, s16, ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s11} gave you a fake letter to fool {s13} into banishing his vassal {s16}. You are to go near {s14}, give the letter to one of your {s15} and send him into the town as a messenger, believing his orders to be genuine."),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_capture_prisoners"),
    ],
    "A group of my soldiers were captured in a recent skirmish with the enemy. Thankfully we have a mutual agreement of prisoner exchange, and they will release my men, but they want us to give them prisoners of equal rank and number. Prisoners I don't currently have. So, I need a good {reg63?man:warrior} to find me {reg1} {s3} as prisoners, that I may exchange them.",
    "lord_mission_told",
    [
      (quest_get_slot, ":var0", "qst_capture_prisoners", 2),
      (quest_get_slot, ":var1", "qst_capture_prisoners", 10),
      (assign, reg1, ":var1"),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_troop_name_by_count, s3, ":var0", ":var1"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s9} has requested you to bring him {reg1} {s3} as prisoners."),
    ]],

  [anyone, "lord_tell_mission",
    [],
    "No {playername}. I do not need your help at this time.",
    "lord_pretalk",
    []],

  [plyr|anyone, "lord_mission_told",
    [],
    "You can count on me, {s65}.",
    "lord_mission_accepted",
    []],

  [plyr|anyone, "lord_mission_told",
    [],
    "I fear I cannot accept such a mission at the moment.",
    "lord_mission_rejected",
    []],

  [anyone, "lord_mission_accepted",
    [],
    "Excellent, {playername}, excellent. I have every confidence in you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (try_begin),
        (eq, "$random_quest_no", "qst_escort_lady"),
        (quest_get_slot, ":var0", "$random_quest_no", 4),
        (troop_set_slot, ":var0", 12, 0),
        (troop_join, ":var0"),
      (else_try),
        (eq, "$random_quest_no", "qst_deliver_message_to_enemy_lord"),
        (call_script, "script_troop_add_gold", "trp_player", 10),
      (else_try),
        (eq, "$random_quest_no", "qst_bring_back_runaway_serfs"),
        (quest_get_slot, ":var1", "$random_quest_no", 12),
        (quest_get_slot, ":var2", "$random_quest_no", 1),
        (quest_get_slot, ":var3", "$random_quest_no", 9),
        (set_spawn_radius, 3),
        (spawn_around_party, ":var1", ":var3"),
        (assign, "$qst_bring_back_runaway_serfs_party_1", reg0),
        (party_set_ai_behavior, "$qst_bring_back_runaway_serfs_party_1", ai_bhvr_travel_to_party),
        (party_set_ai_object, "$qst_bring_back_runaway_serfs_party_1", ":var2"),
        (party_set_flags, "$qst_bring_back_runaway_serfs_party_1", 65536, 0),
        (spawn_around_party, ":var1", ":var3"),
        (assign, "$qst_bring_back_runaway_serfs_party_2", reg0),
        (party_set_ai_behavior, "$qst_bring_back_runaway_serfs_party_2", ai_bhvr_travel_to_party),
        (party_set_ai_object, "$qst_bring_back_runaway_serfs_party_2", ":var2"),
        (party_set_flags, "$qst_bring_back_runaway_serfs_party_2", 65536, 0),
        (spawn_around_party, ":var1", ":var3"),
        (assign, "$qst_bring_back_runaway_serfs_party_3", reg0),
        (party_set_ai_behavior, "$qst_bring_back_runaway_serfs_party_3", ai_bhvr_travel_to_party),
        (party_set_ai_object, "$qst_bring_back_runaway_serfs_party_3", ":var2"),
        (party_set_flags, "$qst_bring_back_runaway_serfs_party_3", 65536, 0),
        (rest_for_hours, 1, 4),
      (try_end),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (try_begin),
        (eq, "$random_quest_no", "qst_lend_surgeon"),
        (assign, "$g_leave_town_outside", 1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (rest_for_hours, 4),
        (assign, "$lord_requested_to_talk_to", "$g_talk_troop"),
      (try_end),
    ]],

  [anyone, "lord_mission_rejected",
    [],
    "Is that so? Well, I suppose you're just not up to the task. I shall have to look for somebody with more mettle.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (try_begin),
        (quest_slot_eq, "$random_quest_no", 25, 0),
        (quest_set_slot, "$random_quest_no", 25, 1),
      (try_end),
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 8, 0),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (this_or_next|eq, "$g_talk_troop_faction", "fac_player_faction"),
      (eq, "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (troop_get_slot, ":var0", "$g_talk_troop", 8),
      (assign, reg44, ":var0"),
      (store_faction_of_party, ":var1", ":var0"),
      (this_or_next|eq, ":var1", "fac_player_faction"),
      (eq, ":var1", "fac_player_supporters_faction"),
    ],
    "You are free to go.",
    "defeat_lord_answer_2",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_add_log_entry", 13, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
      (call_script, "script_remove_troop_from_prison", "$g_talk_troop"),
      (party_remove_prisoners, reg44, "$g_talk_troop", 1),
    ]],

  [plyr|anyone, "lord_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "I must leave now.",
    "lord_leave_prison",
    []],

  [plyr|anyone, "lord_talk",
    [
      (lt, "$g_talk_troop_faction_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "This audience is over. I leave now.",
    "lord_leave",
    []],

  [plyr|anyone, "lord_talk",
    [
      (ge, "$g_talk_troop_faction_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
    ],
    "I must beg my leave.",
    "lord_leave",
    []],

  [anyone, "lord_leave",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (lt, "$g_talk_troop_faction_relation", 0),
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
      (troop_slot_eq, "$g_talk_troop", 20, 0),
      (call_script, "script_get_quest", "$g_talk_troop"),
      (assign, "$random_quest_no", reg0),
      (ge, "$random_quest_no", 0),
      (this_or_next|eq, "$random_quest_no", "qst_lend_surgeon"),
      (eq, 2, 1),
    ],
    "Before you go, {playername}, I have something to ask of you... We may be enemies in this war, but I pray that you believe, as I do, that we can still be civil towards each other. Thus I hoped that you would be kind enough to assist me in something important to me.",
    "lord_leave_give_quest",
    []],

  [plyr|anyone, "lord_leave_give_quest",
    [],
    "I am listening.",
    "enemy_lord_tell_mission",
    []],

  [anyone, "enemy_lord_tell_mission",
    [
      (eq, "$random_quest_no", "qst_lend_surgeon"),
    ],
    "I have a friend here, an old warrior, who is very sick. Pestilence has infected an old battle wound, and unless he is seen to by a surgeon soon, he will surely die. This man is dear to me, {playername}, but he's also stubborn as a hog and refuses to have anyone look at his injury because he doesn't trust the physicians here. I have heard that you've a capable surgeon with you. If you would let your surgeon come here and have a look, {reg3?she:he} may be able to convince him to give his consent to an operation. Please, I will be deeply indebted to you if you grant me this request.",
    "lord_mission_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 4),
      (str_store_troop_name_link, s1, "$g_talk_troop"),
      (str_store_troop_name, s3, ":var0"),
      (troop_get_type, reg3, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@Lend your experienced surgeon {s3} to {s1}."),
    ]],

  [anyone, "enemy_lord_tell_mission",
    [
      (str_store_quest_name, s7, "$random_quest_no"),
    ],
    "{!}ERROR: MATCHED WITH QUEST: {s7}.",
    "close_window",
    []],

  [anyone, "lord_leave_prison",
    [],
    "We'll meet again.",
    "close_window",
    []],

  [auto_proceed|anyone, "lord_leave",
    [
      (troop_get_type, ":var0", "trp_player"),
      (ge, ":var0", 1),
      (troop_get_type, ":var1", "$g_talk_troop"),
      (eq, ":var1", 0),
      (call_script, "script_troop_get_romantic_chemistry_with_troop", "trp_player", "$g_talk_troop"),
      (gt, reg0, 7),
      (ge, "$g_talk_troop_relation", 0),
      (neg|troop_slot_ge, "$g_talk_troop", 34, "trp_npc_adonja"),
      (neg|troop_slot_ge, "$g_talk_troop", 30, "trp_npc_adonja"),
      (neg|troop_slot_ge, "trp_player", 34, "trp_npc_adonja"),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Farewell, my lady. I shall remain your most ardent admirer.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "lord_leave",
    [
      (faction_slot_eq, "$g_talk_troop_faction", 11, "$g_talk_troop"),
    ],
    "Of course, {playername}. Farewell.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "lord_leave",
    [
      (ge, "$g_talk_troop_relation", 10),
    ],
    "Good journeys to you, {playername}.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "lord_leave",
    [
      (ge, "$g_talk_troop_faction_relation", 0),
    ],
    "Yes, yes. Farewell.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [auto_proceed|anyone, "lord_leave",
    [],
    "We will meet again.",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "member_chat",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
    ],
    "Are you enjoying the journey, {s65}?",
    "lady_journey_1",
    []],

  [anyone, "lady_journey_1",
    [],
    "I am doing quite fine, {playername}. Thank you for your concern.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "Yes, my husband?",
    "spouse_talk",
    []],

  [plyr|anyone, "spouse_talk",
    [
      (eq, "$g_player_minister", "$g_talk_troop"),
    ],
    "As you are my chief minister, I wish to speak to about affairs of state.",
    "minister_issues",
    []],

  [plyr|anyone, "spouse_talk",
    [
      (assign, "$political_quest_to_cancel", -1),
      (try_begin),
        (check_quest_active, "qst_offer_gift"),
        (quest_slot_eq, "qst_offer_gift", 6, "$g_talk_troop"),
        (assign, "$political_quest_to_cancel", "qst_offer_gift"),
        (str_store_string, s10, "str_offer_gift_description"),
      (else_try),
        (check_quest_active, "qst_resolve_dispute"),
        (quest_slot_eq, "qst_resolve_dispute", 6, "$g_talk_troop"),
        (assign, "$political_quest_to_cancel", "qst_resolve_dispute"),
        (str_store_string, s10, "str_resolve_dispute_description"),
      (try_end),
      (gt, "$political_quest_to_cancel", 0),
    ],
    "Let's abandon our plan to {s10}.",
    "spouse_cancel_political_quest",
    []],

  [anyone, "spouse_cancel_political_quest",
    [],
    "Are you sure you want to drop that idea?",
    "spouse_cancel_political_quest_confirm",
    []],

  [plyr|anyone, "spouse_cancel_political_quest_confirm",
    [],
    "Yes, I am sure. Let's abandon that idea.",
    "spouse_pretalk",
    [
      (call_script, "script_abort_quest", "$political_quest_to_cancel", 1),
    ]],

  [plyr|anyone, "spouse_cancel_political_quest_confirm",
    [],
    "Actually, never mind.",
    "spouse_pretalk",
    []],

  [plyr|anyone, "spouse_talk",
    [],
    "Let us think of a way to improve our standing in this realm.",
    "combined_political_quests",
    [
      (call_script, "script_get_political_quest", "$g_talk_troop"),
      (assign, "$political_quest_found", reg0),
      (assign, "$political_quest_target_troop", reg1),
      (assign, "$political_quest_object_troop", reg2),
    ]],

  [plyr|anyone, "spouse_talk",
    [
      (neg|check_quest_active, "qst_organize_feast"),
      (this_or_next|party_slot_eq, "$g_encountered_party", 7, "trp_player"),
      (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
    ],
    "I was thinking that perhaps we could host a feast.",
    "spouse_organize_feast",
    []],

  [plyr|anyone, "spouse_talk",
    [],
    "Let us take inventory of our household possessions.",
    "spouse_household_possessions",
    [
      (change_screen_loot, "trp_household_possessions"),
    ]],

  [anyone, "spouse_household_possessions",
    [],
    "Anyway, that is the content of our larder.",
    "spouse_pretalk",
    []],

  [plyr|anyone, "spouse_talk",
    [
      (troop_get_type, ":var0", "$g_talk_troop"),
      (eq, ":var0", 0),
      (player_has_item, "itm_royal_crown"),
      (assign, ":var1", 1),
      (troop_get_inventory_capacity, ":var2", "$g_talk_troop"),
      (try_for_range, ":var3", 0, ":var2"),
        (troop_get_inventory_slot, ":var4", "$g_talk_troop", ":var3"),
        (eq, ":var4", "itm_royal_crown"),
        (assign, ":var1", 0),
      (try_end),
      (eq, ":var1", 1),
    ],
    "Please accept this crown, my husband.",
    "husband_outfit",
    []],

  [anyone, "husband_outfit",
    [],
    "Of course, my ... Queen.",
    "spouse_pretalk",
    [
      (troop_remove_item, "trp_player", "itm_royal_crown"),
      (troop_add_item, "$g_talk_troop", "itm_royal_crown"),
    ]],

  [plyr|anyone, "spouse_talk",
    [
      (troop_get_type, ":var0", "$g_talk_troop"),
      (this_or_next|eq, ":var0", 1),
      (eq, ":var0", 2),
    ],
    "Could you reconsider your outfit?",
    "wife_outfit",
    []],

  [anyone, "wife_outfit",
    [
      (store_free_inventory_capacity, ":var0", "trp_household_possessions"),
      (le, ":var0", 0),
    ],
    "I can't at this time, I have too much goods on me at the moment.^^^^^(the 'household possessions' storage area is full)",
    "spouse_pretalk",
    []],

  [anyone, "wife_outfit",
    [
      (store_free_inventory_capacity, ":var0", "trp_household_possessions"),
      (gt, ":var0", 0),
    ],
    "Of course dear. If you could excuse the room I will put on something new.^^^^^(first allowed hat/dress/boots, from the top row in the 'household possessions' storage, will be put on)",
    "close_window",
    [
      (troop_get_inventory_slot, ":var0", "$g_talk_troop", ek_head),
      (assign, ":var1", -1),
      (store_add, ":var2", 10, 3),
      (try_for_range, ":var3", 10, ":var2"),
        (troop_get_inventory_slot, ":var4", "trp_household_possessions", ":var3"),
        (this_or_next|is_between, ":var4", "itm_khergit_lady_hat", "itm_straw_hat"),
        (eq, ":var4", "itm_royal_crown"),
        (neq, ":var4", "itm_head_wrappings"),
        (assign, ":var1", ":var3"),
        (assign, ":var2", ":var3"),
      (try_end),
      (try_begin),
        (ge, ":var1", 10),
        (troop_get_inventory_slot, ":var5", "trp_household_possessions", ":var1"),
        (troop_set_inventory_slot, "$g_talk_troop", ek_head, ":var5"),
        (try_begin),
          (ge, ":var0", 0),
          (troop_set_inventory_slot, "trp_household_possessions", ":var1", ":var0"),
        (else_try),
          (troop_set_inventory_slot, "trp_household_possessions", ":var1", -1),
        (try_end),
      (try_end),
      (troop_get_inventory_slot, ":var6", "$g_talk_troop", ek_body),
      (assign, ":var7", -1),
      (store_add, ":var2", 10, 3),
      (try_for_range, ":var3", 10, ":var2"),
        (troop_get_inventory_slot, ":var4", "trp_household_possessions", ":var3"),
        (this_or_next|is_between, ":var4", "itm_dress", "itm_nobleman_outfit"),
        (this_or_next|eq, ":var4", "itm_fur_coat"),
        (this_or_next|eq, ":var4", "itm_nomad_robe"),
        (this_or_next|eq, ":var4", "itm_nomad_vest"),
        (eq, ":var4", "itm_merchant_outfit_2"),
        (assign, ":var7", ":var3"),
        (assign, ":var2", ":var3"),
      (try_end),
      (try_begin),
        (ge, ":var7", 10),
        (troop_get_inventory_slot, ":var8", "trp_household_possessions", ":var7"),
        (troop_set_inventory_slot, "$g_talk_troop", ek_body, ":var8"),
        (try_begin),
          (ge, ":var6", 0),
          (troop_set_inventory_slot, "trp_household_possessions", ":var7", ":var6"),
        (else_try),
          (troop_set_inventory_slot, "trp_household_possessions", ":var7", -1),
        (try_end),
      (try_end),
      (troop_get_inventory_slot, ":var9", "$g_talk_troop", ek_foot),
      (assign, ":var10", -1),
      (store_add, ":var2", 10, 3),
      (try_for_range, ":var3", 10, ":var2"),
        (troop_get_inventory_slot, ":var4", "trp_household_possessions", ":var3"),
        (this_or_next|is_between, ":var4", "itm_wrapping_boots", "itm_common_rus_shoes"),
        (this_or_next|eq, ":var4", "itm_ankle_boots"),
        (this_or_next|eq, ":var4", "itm_looter_boots"),
        (eq, ":var4", "itm_leather_boots"),
        (assign, ":var10", ":var3"),
        (assign, ":var2", ":var3"),
      (try_end),
      (try_begin),
        (ge, ":var10", 10),
        (troop_get_inventory_slot, ":var11", "trp_household_possessions", ":var10"),
        (troop_set_inventory_slot, "$g_talk_troop", ek_foot, ":var11"),
        (try_begin),
          (ge, ":var9", 0),
          (troop_set_inventory_slot, "trp_household_possessions", ":var10", ":var9"),
        (else_try),
          (troop_set_inventory_slot, "trp_household_possessions", ":var10", -1),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "spouse_talk",
    [
      (troop_get_type, ":var0", "$g_talk_troop"),
      (this_or_next|eq, ":var0", 1),
      (eq, ":var0", 2),
      (troop_get_inventory_slot, ":var1", "$g_talk_troop", ek_head),
      (ge, ":var1", 0),
    ],
    "May I see you without your hat?",
    "hat_issue",
    []],

  [anyone, "hat_issue",
    [
      (store_free_inventory_capacity, ":var0", "trp_household_possessions"),
      (le, ":var0", 0),
    ],
    "I don't have any free space to store it, my dear.^^^^^(the 'household possessions' storage area is full)",
    "spouse_pretalk",
    []],

  [anyone, "hat_issue",
    [
      (store_free_inventory_capacity, ":var0", "trp_household_possessions"),
      (gt, ":var0", 0),
    ],
    "Maybe on your next visit, my dear.",
    "spouse_pretalk",
    [
      (troop_get_inventory_slot, ":var0", "$g_talk_troop", ek_head),
      (troop_remove_item, "$g_talk_troop", ":var0"),
      (troop_add_item, "trp_household_possessions", ":var0"),
    ]],

  [plyr|anyone, "spouse_talk",
    [],
    "We shall speak later, my {reg63?wife:husband}.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "wedding_ceremony_bride_vow",
    [],
    "My husband, I hereby pledge to be your wife, to stand with you in good times and bad. May the heavens smile upon us and bless us with children, livestock, and land.",
    "wedding_ceremony_player_vow",
    [
      (quest_get_slot, ":var0", "qst_wed_betrothed", 2),
      (2197, ":var0"),
    ]],

  [plyr|anyone, "wedding_ceremony_player_vow",
    [],
    "I pledge the same. Let us be husband and wife.",
    "wedding_ceremony_vows_complete",
    []],

  [plyr|anyone, "wedding_ceremony_player_vow",
    [],
    "Wait -- hold on... I'm not quite ready for this.",
    "close_window",
    []],

  [anyone, "wedding_ceremony_vows_complete",
    [],
    "I now declare you and {s3} to be husband and wife. Go now to the chamber prepared for you, and we shall make arrangements for your bride to join you in your hall in {s11}.",
    "close_window",
    [
      (call_script, "script_courtship_event_bride_marry_groom", "$g_player_bride", "trp_player", 0),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_player_bride"),
      (str_store_troop_name, s3, "$g_player_bride"),
      (try_begin),
        (neq, reg0, "trp_player"),
        (str_store_string, s11, "str_error__player_not_logged_as_groom"),
      (else_try),
        (str_store_party_name, s11, reg1),
        (troop_set_slot, "$g_player_bride", 12, reg1),
      (try_end),
    ]],

  [anyone, "spouse_pretalk",
    [],
    "Is there anything else, my {reg63?husband:wife}?",
    "spouse_talk",
    []],

  [anyone, "spouse_organize_feast",
    [
      (faction_slot_eq, "$players_kingdom", 4, 6),
      (faction_slot_eq, "$players_kingdom", 5, "$g_encountered_party"),
    ],
    "A splendid idea, my {reg63?husband:wife}. However, let us wait for the current feast here to conclude, before organizing another.",
    "spouse_pretalk",
    []],

  [anyone, "spouse_organize_feast",
    [
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (neg|is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
    ],
    "A splendid idea, my {reg63?husband:wife}. However, we must establish a court before hosting a feast.",
    "spouse_pretalk",
    []],

  [anyone, "spouse_organize_feast",
    [
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (store_current_hours, ":var0"),
      (faction_get_slot, ":var1", "$players_kingdom", 94),
      (val_sub, ":var0", ":var1"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg4, ":var0"),
        (str_store_faction_name, s4, "$players_kingdom"),
        (display_message, "@{!}DEBUG -- {reg4} hours since last feast for {s4}"),
      (try_end),
      (lt, ":var0", 120),
      (store_sub, ":var2", 168, ":var0"),
      (val_div, ":var2", 24),
      (assign, reg3, ":var2"),
    ],
    "A splendid idea, my {reg63?husband:wife}. However, our realm has recently had a feast. Perhaps we should wait another {reg3} days before we organize another one.",
    "spouse_pretalk",
    []],

  [anyone, "spouse_organize_feast",
    [],
    "A splendid idea, my {reg63?husband:wife}. However, to not insult our guests, we must make sure that we can provide a large and varied repast, for the lords, their families, and their retinues. All told, we should count on a couple of hundred mouths to feed, over several days. Let us take an inventory of our household possessions...",
    "spouse_evaluate_larder_for_feast",
    []],

  [anyone, "spouse_evaluate_larder_for_feast",
    [
      (call_script, "script_internal_politics_rate_feast_to_s9", "trp_household_possessions", 600, "$players_kingdom", 0),
      (assign, "$feast_quality", reg0),
    ],
    "{s9}",
    "spouse_feast_confirm",
    []],

  [plyr|anyone, "spouse_feast_confirm",
    [],
    "Let me add more items to our storehouses.",
    "spouse_feast_added_items",
    [
      (change_screen_loot, "trp_household_possessions"),
    ]],

  [anyone, "spouse_feast_added_items",
    [],
    "All right -- let me reevaluate what is there...",
    "spouse_evaluate_larder_for_feast",
    []],

  [plyr|anyone, "spouse_feast_confirm",
    [
      (gt, "$feast_quality", 1),
    ],
    "Let us dispatch the invitations.",
    "spouse_feast_confirm_yes",
    []],

  [plyr|anyone, "spouse_feast_confirm",
    [],
    "Let us wait, then.",
    "spouse_pretalk",
    []],

  [anyone, "spouse_feast_confirm_yes",
    [
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
    ],
    "I shall send word, then, that we will host a feast as soon as conditions in the realm permit. You perhaps should continue to stock our larder, so that we may do justice to our reputation for hospitality.",
    "spouse_pretalk",
    [
      (assign, ":var0", -1),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_village_1"),
        (this_or_next|party_slot_eq, "$g_encountered_party", 7, "trp_player"),
        (party_slot_eq, "$g_encountered_party", 7, "$g_talk_troop"),
        (assign, ":var0", "$g_encountered_party"),
      (else_try),
        (try_for_range, ":var1", "p_town_1", "p_village_1"),
          (eq, ":var0", -1),
          (this_or_next|party_slot_eq, ":var1", 7, "trp_player"),
          (party_slot_eq, ":var1", 7, "$g_talk_troop"),
          (assign, ":var0", ":var1"),
        (try_end),
      (else_try),
        (is_between, "$g_encountered_party", "p_town_1", "p_village_1"),
        (assign, ":var0", "$g_encountered_party"),
      (try_end),
      (str_store_party_name, s9, ":var0"),
      (setup_quest_text, "qst_organize_feast"),
      (str_store_string, s2, "str_you_intend_to_bring_goods_to_s9_in_preparation_for_the_feast_which_will_be_held_as_soon_as_conditions_permit"),
      (quest_set_slot, "qst_organize_feast", 1, ":var0"),
      (quest_set_slot, "qst_organize_feast", 23, 30),
      (call_script, "script_start_quest", "qst_organize_feast", "$g_talk_troop"),
    ]],

  [anyone, "spouse_feast_confirm_yes",
    [],
    "Very well, then. Let the feast begin immediately at our court {reg4?here:} in {s9}. You perhaps should continue to stock our larder, so that we may do justice to our reputation for hospitality. You may declare the feast to be concluded at any time, either by beginning a campaign or by letting it be known that the vassals can return to their homes.",
    "spouse_pretalk",
    [
      (str_store_party_name, s9, "$g_player_court"),
      (setup_quest_text, "qst_organize_feast"),
      (str_store_string, s2, "str_you_intend_to_bring_goods_to_s9_in_preparation_for_the_feast_which_will_be_held_as_soon_as_conditions_permit"),
      (quest_set_slot, "qst_organize_feast", 1, "$g_player_court"),
      (quest_set_slot, "qst_organize_feast", 23, 30),
      (call_script, "script_start_quest", "qst_organize_feast", "$g_talk_troop"),
      (faction_set_slot, "$players_kingdom", 4, 6),
      (faction_set_slot, "$players_kingdom", 5, "$g_player_court"),
      (assign, "$player_marshal_ai_state", 6),
      (assign, "$player_marshal_ai_object", "$g_player_court"),
      (assign, "$g_recalculate_ais", 1),
      (assign, reg4, 1),
      (try_begin),
        (neq, "$g_encountered_party", "$g_player_court"),
        (assign, reg4, 0),
      (try_end),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_wed_betrothed"),
      (quest_slot_eq, "qst_wed_betrothed", 2, "$g_talk_troop"),
      (quest_slot_ge, "qst_wed_betrothed", 23, 2),
    ],
    "How wonderful it is... In a short while we shall be married! However, I should point out that, in the remaining few days, it is not customary for us to speak too much together.",
    "close_window",
    [
      (try_begin),
        (check_quest_active, "qst_visit_lady"),
        (quest_slot_eq, "qst_visit_lady", 6, "$g_talk_troop"),
        (call_script, "script_end_quest", "qst_visit_lady"),
      (try_end),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_wed_betrothed"),
      (quest_slot_eq, "qst_wed_betrothed", 2, "$g_talk_troop"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (troop_get_slot, ":var1", ":var0", 10),
      (party_is_active, ":var1"),
      (party_get_attached_to, ":var2", ":var1"),
      (eq, ":var2", "$g_encountered_party"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Em, {playername}, you might not be used to our wedding customs, but I had hoped that someone would tell you... Speak first to my {s11}, {s4}.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_wed_betrothed"),
      (quest_slot_eq, "qst_wed_betrothed", 2, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_wed_betrothed", 6),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s10, ":var0"),
    ],
    "I do not know where to find my {s11} {s10}, who by tradition should preside over our wedding. Perhaps we should wait until he can be found...",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (party_get_slot, ":var0", "$g_encountered_party"),
      (ge, ":var0", "trp_npc_adonja"),
      (str_store_troop_name, s12, ":var0"),
    ],
    "The honorable {s12} has agreed to allow us to return home to our families. We shall be departing shortly.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
      (gt, "$g_time_since_last_talk", 24),
    ],
    "So great is my loneliness! How I miss my family!",
    "kingdom_lady_captive",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
      (lt, "$g_talk_troop_relation", 1),
    ],
    "You are a cad, {reg63?sir:madame}, to hold a lady like this...",
    "kingdom_lady_captive",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
      (lt, "$g_talk_troop_relation", 11),
    ],
    "It is strange. On occasion you have shown me such kindness, and yet you continue to hold me here against my will.",
    "kingdom_lady_captive",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 8, "$g_encountered_party"),
    ],
    "Why haven't my family paid my ransom? You may hold me as prisoner, but it seems that you care for me more than they do!",
    "kingdom_lady_captive",
    []],

  [auto_proceed|anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 12, "$g_encountered_party"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (store_troop_faction, ":var1", ":var0"),
      (neq, ":var1", "$g_encountered_party_faction"),
    ],
    "{!}.",
    "lady_stranded_next",
    []],

  [anyone, "lady_stranded_next",
    [],
    "Greetings, {reg63?sir:my lady}. The tides of war have left me stranded here in this fortress, but I will shortly be departing. ",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_slot_eq, "$g_talk_troop", 12, "$g_encountered_party"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (store_troop_faction, ":var1", ":var0"),
      (neq, ":var1", "$g_encountered_party_faction"),
    ],
    "{playername} -- I assume that you, as a {reg63?man:lady} of honor, will accord gentle-born ladies such as ourselves the right to return to our families, and not demand a ransom.",
    "lady_talk_refugee",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_escort_lady"),
      (eq, "$talk_context", 10),
      (quest_slot_eq, "qst_escort_lady", 4, "$g_talk_troop"),
    ],
    "Thank you for escorting me here, {playername}. Please accept this gift as a token of my gratitude. I hope we shall meet again sometime in the future.",
    "lady_escort_lady_succeeded",
    [
      (quest_get_slot, ":var0", "qst_escort_lady", 1),
      (call_script, "script_finish_quest_simple", "qst_escort_lady", 100),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (troop_set_slot, "$g_talk_troop", 12, ":var0"),
      (remove_member_from_party, "$g_talk_troop"),
    ]],

  [plyr|anyone, "lady_escort_lady_succeeded",
    [],
    "It was an honor to serve you, {s65}.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (neg|troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (neq, "$g_talk_troop_faction", "$g_encountered_party_faction"),
      (troop_get_slot, ":var0", "$g_talk_troop", 12),
      (str_clear, s5),
      (try_begin),
        (is_between, ":var0", "p_town_1", "p_salt_mine"),
        (str_store_party_name, s4, ":var0"),
        (str_store_string, s5, "str_for_s4"),
      (try_end),
    ],
    "We will shortly depart{s5}. It is good to know that some people in this world retain a sense of honor.",
    "close_window",
    []],

  [plyr|anyone, "lady_talk_refugee",
    [],
    "Of course, my lady",
    "close_window",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 12),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var1", reg1),
      (troop_set_slot, "$g_talk_troop", 12, ":var1"),
      (try_begin),
        (neq, ":var0", ":var1"),
        (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 1),
      (try_end),
    ]],

  [plyr|anyone, "lady_talk_refugee",
    [],
    "You assume wrong, my lady!",
    "lady_captive_talk",
    []],

  [anyone, "lady_captive_talk",
    [],
    "What?! What infamy is this?",
    "lady_captive_confirm",
    []],

  [plyr|anyone, "lady_captive_confirm",
    [],
    "My apologies - you must have misunderstood me. Of course you may leave.",
    "close_window",
    []],

  [plyr|anyone, "lady_captive_confirm",
    [],
    "Contact your family to arrange for a ransom, my lady.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 8, "$g_encountered_party"),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -10),
    ]],

  [plyr|anyone, "kingdom_lady_captive",
    [],
    "Then write to your family, and ask them to hurry up with the ransom!",
    "close_window",
    []],

  [plyr|anyone, "kingdom_lady_captive",
    [],
    "I have changed my mind -- you are free to go",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 8, -1),
      (troop_set_slot, "$g_talk_troop", 5, 1),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_failed, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (str_store_troop_name, s10, ":var0"),
      (lt, "$g_talk_troop_relation", 0),
    ],
    "Well, {playername} -- you fought a duel with {s10}, and lost. According to our custom and tradition, I should no longer receive you. Farewell, {playername}.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
      (troop_set_slot, "$g_talk_troop", 5, 4),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_failed, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (str_store_troop_name, s10, ":var0"),
    ],
    "Oh {playername} -- I heard of your duel with {s10}. I wish now that you had never fought him, for our honor and tradition demand that, having lost to him, you now break off your suit with me. Farewell, {playername}.",
    "lady_duel_lost",
    [
      (troop_set_slot, "$g_talk_troop", 5, 4),
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
    ]],

  [plyr|anyone, "lady_duel_lost",
    [],
    "Very well - we must do as tradition demands... Farewell, my lady",
    "close_window",
    []],

  [plyr|anyone, "lady_duel_lost",
    [],
    "Let honor and tradition hang!",
    "lady_duel_lost_flaunt_conventions",
    []],

  [anyone, "lady_duel_lost_flaunt_conventions",
    [],
    "Oh, {playername}! Although people will talk, it would so break my heart to no longer be able to see you. We shall ignore this silly, cruel tradition.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 5, 2),
      (call_script, "script_change_player_honor", -5),
    ]],

  [anyone, "lady_duel_lost_flaunt_conventions",
    [],
    "No, {playername} -- I cannot afford to fritter away my good name, and neither can you.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_succeeded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (lt, reg0, 0),
      (str_store_troop_name_link, s10, ":var0"),
    ],
    "Oh, {playername} -- I have heard that you won your duel with {s10}. I'm grateful that you have delivered me from that man's attentions!",
    "lady_start",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 3),
      (add_xp_as_reward, 1000),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_succeeded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (troop_slot_eq, "$g_talk_troop", 52, 24),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (str_store_troop_name_link, s10, ":var0"),
    ],
    "Well, {playername} -- you won your duel with {s10}. Clearly, he was not worthy of my affections.",
    "lady_start",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 2),
      (add_xp_as_reward, 1000),
    ]],

  [auto_proceed|anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_succeeded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (troop_slot_eq, "$g_talk_troop", 52, 21),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (str_store_troop_name_link, s10, ":var0"),
    ],
    "{!}.",
    "lady_duel_rep_1",
    []],

  [anyone, "lady_duel_rep_1",
    [],
    "Well, {playername} -- you won your duel with {s10}. Oh, such foolishness, that men should fight over me! Sigh... But it is a bit romantic, I suppose.",
    "lady_start",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", 1),
      (add_xp_as_reward, 1000),
    ]],

  [auto_proceed|anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_courtship_rival"),
      (check_quest_succeeded, "qst_duel_courtship_rival"),
      (quest_slot_eq, "qst_duel_courtship_rival", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_duel_courtship_rival", 2),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (str_store_troop_name_link, s10, ":var0"),
    ],
    "{!}.",
    "lady_duel_rep_2",
    []],

  [anyone, "lady_duel_rep_2",
    [],
    "Well, {playername} -- you won your duel with {s10}. Honor now demands that he and I no longer meet... I was fond of him, you know. You did me no service by fighting him, sir.",
    "lady_start",
    [
      (call_script, "script_end_quest", "qst_duel_courtship_rival"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -2),
      (add_xp_as_reward, 1000),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_for_lady"),
      (check_quest_succeeded, "qst_duel_for_lady"),
      (quest_slot_eq, "qst_duel_for_lady", 6, "$g_talk_troop"),
      (le, "$talk_context", 4),
      (quest_get_slot, ":var0", "qst_duel_for_lady", 2),
      (str_store_troop_name_link, s13, ":var0"),
    ],
    "My dear {playername}, how joyous to see you again! I heard you gave that vile {s13} a well-deserved lesson. I hope he never forgets his humiliation. I've a reward for you, but I fear it's little compared to what you've done for me.",
    "lady_qst_duel_for_lady_succeeded_1",
    []],

  [plyr|anyone, "lady_qst_duel_for_lady_succeeded_1",
    [],
    "Oh, it will just have to do.",
    "lady_qst_duel_for_lady_succeeded_2",
    [
      (str_store_string, s10, "@Then take it, with my eternal thanks. You are a noble {reg63?man:woman}. I will never forget that you helped me in my time of need."),
    ]],

  [plyr|anyone, "lady_qst_duel_for_lady_succeeded_1",
    [],
    "{s66}, this is far too much!",
    "lady_qst_duel_for_lady_succeeded_2",
    [
      (str_store_string, s10, "@Forgive me, {playername}, but I must insist you accept it. The money means little to me, and I owe you so much. Here, take it, and let us speak no more of this."),
      (call_script, "script_change_player_honor", 1),
    ]],

  [plyr|anyone, "lady_qst_duel_for_lady_succeeded_1",
    [],
    "Please, {s65}, no reward is necessary.",
    "lady_qst_duel_for_lady_succeeded_2",
    [
      (str_store_string, s10, "@{playername}, what a dear {reg63?man:woman} you are, but I will not allow you to refuse this. I owe you far more than I can say, and I am sure you can put this money to far better use than I."),
      (call_script, "script_change_player_honor", 2),
    ]],

  [anyone, "lady_qst_duel_for_lady_succeeded_2",
    [],
    "{s10}",
    "lady_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 10),
      (add_xp_as_reward, 1000),
      (call_script, "script_troop_add_gold", "trp_player", 2000),
      (call_script, "script_end_quest", "qst_duel_for_lady"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_duel_for_lady"),
      (check_quest_failed, "qst_duel_for_lady"),
      (quest_slot_eq, "qst_duel_for_lady", 6, "$g_talk_troop"),
      (le, "$talk_context", 4),
      (quest_get_slot, ":var0", "qst_duel_for_lady", 2),
      (str_store_troop_name_link, s13, ":var0"),
    ],
    "I was told that you sought satisfaction from {s13} to prove my innocence, {playername}. It was a fine gesture, and I thank you for your efforts.",
    "lady_qst_duel_for_lady_failed",
    []],

  [plyr|anyone, "lady_qst_duel_for_lady_failed",
    [],
    "I beg your forgiveness for my defeat, {s65}...",
    "lady_qst_duel_for_lady_failed_2",
    []],

  [anyone, "lady_qst_duel_for_lady_failed_2",
    [],
    "It matters not, dear {playername}. You tried. The truth cannot be proven at the point of a sword, but you willingly put your life at stake for my honor. That alone will convince many of my innocence.",
    "lady_pretalk",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 6),
      (add_xp_as_reward, 400),
      (call_script, "script_end_quest", "qst_duel_for_lady"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_set_slot, "$g_talk_troop", 37, 0),
      (check_quest_active, "qst_visit_lady"),
      (quest_slot_eq, "qst_visit_lady", 6, "$g_talk_troop"),
    ],
    "Ah {playername} - you must have received my message. How happy I am that you could come!",
    "lady_start",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 1),
      (call_script, "script_end_quest", "qst_visit_lady"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_formal_marriage_proposal"),
      (quest_slot_eq, "qst_formal_marriage_proposal", 6, "$g_talk_troop"),
      (neg|check_quest_succeeded, "qst_formal_marriage_proposal"),
      (neg|check_quest_failed, "qst_formal_marriage_proposal"),
    ],
    "{playername} - is there any word from my family?",
    "lady_proposal_pending",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_formal_marriage_proposal"),
      (quest_slot_eq, "qst_formal_marriage_proposal", 6, "$g_talk_troop"),
      (check_quest_failed, "qst_formal_marriage_proposal"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "I hear that my {s11} has refused your request to marry me. Does that mean that we must part?",
    "lady_betrothed",
    [
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (le, "$talk_context", 4),
      (check_quest_active, "qst_rescue_lord_by_replace"),
      (check_quest_succeeded, "qst_rescue_lord_by_replace"),
      (quest_slot_eq, "qst_rescue_lord_by_replace", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_rescue_lord_by_replace", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Oh, {playername}, you brought him back to me! Thank you ever so much for rescuing my {s11}. Please, take this as some small repayment for your noble deed.",
    "lady_generic_mission_succeeded",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 8),
      (add_xp_as_reward, 2000),
      (call_script, "script_troop_add_gold", "trp_player", 1500),
      (call_script, "script_end_quest", "qst_rescue_lord_by_replace"),
    ]],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (check_quest_active, "qst_rescue_prisoner"),
      (check_quest_succeeded, "qst_rescue_prisoner"),
      (quest_slot_eq, "qst_rescue_prisoner", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_rescue_prisoner", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Oh, {playername}, you brought him back to me! Thank you ever so much for rescuing my {s11}. Please, take this as some small repayment for your noble deed.",
    "rescue_prisoner_succeed_1",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 8),
      (call_script, "script_finish_quest_simple", "qst_rescue_prisoner", 100),
    ]],

  [plyr|anyone, "rescue_prisoner_succeed_1",
    [],
    "Always an honor to serve, {s65}.",
    "lady_pretalk",
    []],

  [anyone, "start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 11),
      (is_between, ":var0", 0, 4),
    ],
    "Why do you approach me? I have not been properly introduced to you.",
    "ghostlover_start_response",
    []],

  [plyr|anyone, "ghostlover_start_response",
    [],
    "I crave your pardon, Lady. I will not trouble you further.",
    "close_window",
    []],

  [plyr|anyone, "ghostlover_start_response",
    [
      (this_or_next|quest_slot_eq, "qst_ghost_lady", 11, 2),
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "I am {playername}, in search of the person who murdered Lady Alienor.",
    "ghostlover_backstory_intro",
    []],

  [anyone, "ghostlover_backstory_intro",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
    ],
    "She was murdered? Why question me? I had nothing to do with her death. I was not here when she died. I am here merely to console {s4} in his grief. We have been friends since childhood, and I love him dearly.",
    "ghostlover_backstory_response",
    []],

  [plyr|anyone, "ghostlover_backstory_response",
    [],
    "I ask because you are staying in her castle, umm, 'grieving' with her lord.",
    "ghostlover_backstory_a",
    []],

  [anyone, "ghostlover_backstory_a",
    [],
    "How dare you?! I am nothing more than a companion to my friend in his grief. I have known him since he was a young squire in my father's castle. We were dear friends then, and remain so. I confess I wish we could have been more, but once he set eyes upon Alienor he fell top over tail in love and never looked at another woman again. I was angry at them once, but my anger passed long ago. I grieve deeply for him as well as for her. She was my friend, too.",
    "ghostlover_backstory_a_response",
    []],

  [plyr|anyone, "ghostlover_backstory_a_response",
    [],
    "Yes, it is patently obvious how you are 'consoling' him.",
    "ghostlover_backstory_b",
    []],

  [anyone, "ghostlover_backstory_b",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Certainly not! In fact, I am betrothed and due to marry next month a Lord whom I esteem greatly. As I could not win the love of {s4}, I looked elsewhere and found my own true love. But you say Alienor was murdered? I know I did not kill her, so who did and how?",
    "ghostlover_backstory_b_response",
    []],

  [plyr|anyone, "ghostlover_backstory_b_response",
    [],
    "Hmm, so you then had no desire or reason to eliminate a rival?",
    "ghostlover_backstory_c",
    []],

  [anyone, "ghostlover_backstory_c",
    [],
    "I will listen to this nonsense no longer. If you discover a murderer, then I will listen to you. Until then, get out of my sight.",
    "ghostlover_backstory_c_response",
    []],

  [plyr|anyone, "ghostlover_backstory_c_response",
    [],
    "She was poisoned. I will inform you by whom when I find her killer.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (neq, ":var0", 15),
      (val_or, ":var0", 8),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 15),
      (quest_set_slot, "qst_ghost_lady", 11, 3),
      (str_store_string, s60, "@You have decided which of the suspects is guilty and now it is time to confront the murderer."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|anyone, "ghostlover_start_response",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "A slut like you is surely capable of murdering a rival. I accuse you of killing the lady!",
    "ghostlover_accuse",
    []],

  [anyone, "ghostlover_accuse",
    [],
    "What an epic failure you are, you cretin. I am not the guilty party!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (quest_set_slot, "qst_ghost_lady", 11, 5),
      (str_store_troop_name, s60, "$g_talk_troop"),
      (str_store_string, s60, "@You have wrongfully accused {s60}, talk to the Ghost Lady again."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (str_clear, s60),
      (add_quest_note_from_sreg, "qst_ghost_lady", 1, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 2, s60, 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 3, s60, 0),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -10),
    ]],

  [anyone, "start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (check_quest_succeeded, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (assign, ":var1", 0),
      (store_and, ":var1", ":var0", 8),
      (eq, ":var1", 0),
    ],
    "You again. Are you back with more ridiculous accusations?",
    "ghostlover_success_response",
    []],

  [plyr|anyone, "ghostlover_success_response",
    [],
    "My lady, I wrongly suspected you of murdering Lady Alienor. Her true killer, the scribe, has paid for his crime.",
    "ghostlover_end",
    []],

  [anyone, "ghostlover_end",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s5, ":var0"),
    ],
    "High time you admitted I was telling the truth! I may enjoy bedding {s5}, but he is not so talented that I'd kill his wife merely to continue warming his bed. Besides, I am growing bored with him.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 5),
      (val_or, ":var0", 8),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 14),
      (call_script, "script_end_quest", "qst_ghost_lady"),
      (quest_set_slot, "qst_ghost_lady", 11, 8),
    ]],

  [anyone, "start",
    [
      (check_quest_active, "qst_ghost_lady"),
      (quest_slot_eq, "qst_ghost_lady", 6, "$g_talk_troop"),
    ],
    "Please leave me alone.",
    "ghostlover_start_go_away",
    []],

  [plyr|anyone, "ghostlover_start_go_away",
    [],
    "I will ... for now.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (eq, "$g_talk_troop_met", 0),
      (gt, "$g_player_tournament_placement", 4),
      (str_clear, s8),
    ],
    "You must be {playername}. We have just had the honor of watching you distinguish yourself in the recent tournament{s8}.",
    "lady_meet_end",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (eq, "$g_talk_troop_met", 0),
      (le, "$talk_context", 4),
      (assign, ":var0", 0),
      (str_clear, s15),
      (try_for_range, ":var1", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
        (gt, reg0, 5),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var1"),
        (gt, reg0, 10),
        (str_store_string, s15, s11),
        (str_store_troop_name, s16, ":var1"),
        (assign, ":var0", ":var1"),
      (try_end),
      (gt, ":var0", 0),
    ],
    "You must be {playername}. My {s15} {s16} has spoken most highly of you. I am delighted to make your acquaintance.",
    "lady_meet_end",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (eq, "$g_talk_troop_met", 0),
      (le, "$talk_context", 4),
    ],
    "I say, you don't look familiar...",
    "lady_premeet",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 4),
      (lt, "$g_talk_troop_relation", 0),
    ],
    "Ah, {playername}. How good it is to see you again. However, I believe that I am required elsewhere.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 4),
    ],
    "{playername} -- how good it is to see you. (Whispers:) I still remember your visits fondly.",
    "lady_start",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (eq, "$g_talk_troop_met", 0),
      (gt, "$g_player_tournament_placement", 4),
      (ge, "$g_talk_troop_relation", 0),
    ],
    "Ah, {playername}. How spendid it was to see you distinguish yourself in the recent tournament.",
    "lady_meet_end",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (str_store_string, s12, "str_hello_playername"),
    ],
    "{s12}",
    "lady_start",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_slot_ge, "$g_talk_troop", 5, 2),
      (neg|troop_slot_eq, "$g_talk_troop", 5, 4),
      (troop_get_slot, ":var0", "$g_talk_troop", 34),
      (gt, ":var0", -1),
      (neq, ":var0", "trp_player"),
      (str_store_troop_name, s5, ":var0"),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
      (lt, reg0, 0),
      (ge, "$g_talk_troop_relation", 10),
    ],
    "I have sad news. I have become betrothed to {s5} -- against my will, I should say! Oh {playername} - I would so much rather be wed to you!",
    "lady_betrothed",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_slot_ge, "$g_talk_troop", 5, 2),
      (troop_get_slot, ":var0", "$g_talk_troop", 34),
      (gt, ":var0", -1),
      (neq, ":var0", "trp_player"),
      (str_store_troop_name, s5, ":var0"),
    ],
    "Good {playername} -- I have become betrothed to {s5}. It is now no longer seemly for us to see each other like this.",
    "lady_betrothed",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (neg|troop_slot_eq, "$g_talk_troop", 5, 4),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (neg|troop_slot_ge, "$g_talk_troop", 30, "trp_npc_adonja"),
      (gt, "$g_talk_troop_relation", 0),
      (assign, "$romantic_rival", -1),
      (try_for_range, ":var0", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (this_or_next|troop_slot_eq, ":var0", 35, "$g_talk_troop"),
        (this_or_next|troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
        (le, reg0, -4),
        (this_or_next|troop_slot_eq, ":var0", 52, 5),
        (this_or_next|troop_slot_eq, ":var0", 52, 2),
        (this_or_next|troop_slot_eq, ":var0", 52, 8),
        (troop_slot_eq, ":var0", 52, 3),
        (assign, "$romantic_rival", ":var0"),
      (try_end),
      (gt, "$romantic_rival", 0),
    ],
    "I must tell you -- there is another lord who has been paying me attentions, although I cannot abide him. I fear he has designs on me, and may try to force me to wed against my will.",
    "lady_other_suitor",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (lt, "$g_time_since_last_talk", 24),
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (gt, "$g_talk_troop_relation", 0),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 22),
        (str_store_string, s11, "str_i_do_enjoy_speaking_to_you_but_i_am_sure_you_understand_that_our_people_cluck_their_tongues_at_a_woman_to_spend_too_long_conversing_with_a_man_outside_her_family__although_the_heavens_know_its_never_the_man_who_is_held_to_blame_"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 24),
        (str_store_string, s11, "str_as_much_as_i_enjoy_speaking_to_you_i_do_not_care_to_be_gossiped_about_by_others_who_might_lack_my_grace_and_beauty_"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 25),
        (str_store_string, s11, "str_i_do_so_enjoy_speaking_to_you_but_as_a_daughter_of_one_of_the_great_families_of_this_land_i_must_set_an_example_of_propriety_"),
      (else_try),
        (str_store_string, s11, "str_i_do_so_enjoy_speaking_to_you_but_as_a_daughter_of_good_family_i_must_protect_my_reputation_"),
      (try_end),
    ],
    "{s11}It is probably not suitable for us to tarry too long here in conversation, but I would hope to see you again soon.",
    "lady_talk",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (lt, "$g_time_since_last_talk", 24),
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 22),
        (str_store_string, s11, "str_although_it_is_kind_of_you_to_pay_me_such_attentions_i_suspect_that_you_might_find_other_ladies_who_may_be_more_inclined_to_return_your_affection"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 24),
        (str_store_string, s11, "str_as_flattered_as_i_am_by_your_attentions_perhaps_you_should_seek_out_another_lady_of_somewhat_shall_we_say_different_tastes"),
      (else_try),
        (str_store_string, s11, "str_as_flattered_as_i_am_by_your_attentions_i_am_a_daughter_of_good_family_and_must_be_aware_of_my_reputation_it_is_not_seemly_that_i_converse_too_much_at_one_time_with_one_man_i_am_sure_you_understand_now_if_you_will_excuse_me"),
      (try_end),
    ],
    "{s11}",
    "lady_talk",
    []],

  [anyone, "lady_start",
    [
      (eq, "$lady_flirtation_location", "$g_encountered_party"),
      (troop_slot_eq, "$g_talk_troop", 5, 1),
    ],
    "I was planning to retire for a little while, but perhaps we may have a chance to speak more later...",
    "lady_talk",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (gt, "$g_talk_troop_relation", 0),
      (str_clear, s12),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 5, 2),
        (gt, "$g_talk_troop_relation", 0),
        (gt, "$g_time_since_last_talk", 24),
        (try_begin),
          (troop_slot_eq, "$g_talk_troop", 52, 23),
          (str_store_string, s12, "str_ah_my_gentle_playername_how_much_good_it_does_my_heart_to_see_you_again"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 22),
          (str_store_string, s12, "str_playername__i_am_so_glad_to_see_you_again_i_must_say_i_do_envy_your_freedom_to_ride_out_and_experience_the_world"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 25),
          (str_store_string, s12, "str_playername__i_am_so_glad_to_see_you_i_trust_that_you_have_been_behaving_honorably_since_last_we_met"),
        (else_try),
          (troop_slot_eq, "$g_talk_troop", 52, 24),
          (str_store_string, s12, "str_greetings_playername__it_is_good_to_see_you_i_hope_that_you_have_had_success_in_your_efforts_to_make_your_name_in_the_world"),
        (else_try),
          (str_store_string, s12, "str_playername__i_am_so_glad_that_you_were_able_to_come"),
        (try_end),
      (try_end),
    ],
    "It is so delightful to have a chance to spend some time together.{s12}",
    "lady_talk",
    []],

  [anyone, "lady_start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 6),
    ],
    "What brings you here today?",
    "lady_talk",
    []],

  [plyr|anyone, "lady_proposal_pending",
    [],
    "No word so far...",
    "close_window",
    []],

  [plyr|anyone, "lady_proposal_pending",
    [],
    "On second thought, now is not the time for us to marry",
    "lady_proposal_pending_end",
    []],

  [anyone, "lady_proposal_pending_end",
    [
      (try_begin),
        (gt, "$g_talk_troop_effective_relation", 19),
        (str_store_string, s11, "str_very_well__i_will_let_you_choose_the_time"),
      (else_try),
        (str_store_string, s11, "str_good_i_am_glad_that_you_have_abandoned_the_notion_of_pushing_me_into_marriage_before_i_was_ready"),
      (try_end),
    ],
    "{s11}",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    ]],

  [plyr|anyone, "lady_betrothed",
    [],
    "Never! We must elope together at once!",
    "lady_suggest_elope",
    []],

  [plyr|anyone, "lady_betrothed",
    [
      (troop_slot_eq, "$g_talk_troop", 34, -1),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (call_script, "script_troop_get_family_relation_to_troop", reg0, "$g_talk_troop"),
    ],
    "Perhaps I may still be able to change your {s11}'s mind",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_betrothed",
    [],
    "So be it -- let us then part",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 21),
    ],
    "Good {playername} -- you are a good and kind man, but a lady cannot defy her family. Such things are not done!",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (assign, "$romantic_rival", -1),
      (try_for_range, ":var0", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (this_or_next|troop_slot_eq, ":var0", 35, "$g_talk_troop"),
        (this_or_next|troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var0"),
          (display_message, "str_rival_found_s4_reg0_relation"),
        (try_end),
        (gt, reg0, "$g_talk_troop_relation"),
        (assign, "$romantic_rival", ":var0"),
      (try_end),
      (gt, "$romantic_rival", -1),
    ],
    "Sir -- as you may know, I have been entertaining offers from a number of gentlemen such as yourself. I am not yet at a stage where I can commit to any of them.",
    "lady_other_suitor",
    []],

  [anyone, "lady_suggest_elope",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 24),
      (neg|troop_slot_ge, "trp_player", 7, 350),
    ],
    "Ah {playername}, you must realize. You are still finding your way in the world. I have great affection for you, {playername}, but I will not consign myself to obscurity.",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 25),
      (lt, "$player_honor", 20),
    ],
    "Ah {playername}, although you are kind to me, I am not certain enough of your moral fiber to risk such a thing. Although I bare little affection for my husband, it would be a weighty thing to go against my family's wishes, and I am not certain enough of you to take that step.",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (le, "$g_talk_troop_effective_relation", 20),
    ],
    "Good {playername} -- to elope would be to throw away my ties with my family, which are everything to me! I have a considerable affection for you, but I am not sure that I am prepared to risk that.",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (assign, "$home_for_spouse", -1),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (eq, "$home_for_spouse", -1),
        (party_slot_eq, ":var0", 7, "trp_player"),
        (is_between, ":var0", "p_town_1", "p_village_1"),
        (assign, "$home_for_spouse", ":var0"),
      (try_end),
      (eq, "$home_for_spouse", -1),
    ],
    "Good {playername} -- I am not used to the hardships of campaigning as you are. I want a home to call my own. If you were lord of a castle or town with a great hall, I would gladly go there as your wife, to be mistress of the household. But I do not wish to live like a hunted animal.",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_suggest_elope",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (call_script, "script_troop_get_family_relation_to_troop", reg0, "$g_talk_troop"),
    ],
    "Elope with you? Yes -- we could do that. It is a great step to defy my family -- but a loveless marriage, and life without you, might be a far worse thing! But be warned -- this will be a terrible blow to my {s11}'s prestige, and he will do everything in his power to bring you down.",
    "lady_elope_agree",
    []],

  [plyr|anyone, "lady_elope_agree",
    [],
    "Quickly, then! There is no time to lose.",
    "lady_elope_agree_nurse",
    []],

  [plyr|anyone, "lady_elope_agree",
    [],
    "Everything in his power, you say? Em... Let me think about this...",
    "close_window",
    []],

  [anyone, "lady_elope_agree_nurse",
    [],
    "Your lordship... Your ladyship... Would you like me to witness your exchange of vows?",
    "lady_elope_agree_lady_vows",
    [
      (2197, 1080),
    ]],

  [anyone, "lady_elope_agree_lady_vows",
    [
      (str_store_troop_name, s4, "$g_talk_troop"),
    ],
    "Yes, do that. For my part, I make the following vow: I, {s4}, do swear that I accept {playername} as my husband, according to the ancient law and custom of our land...",
    "lady_elope_agree_nurse_2",
    []],

  [anyone, "lady_elope_agree_nurse_2",
    [],
    "Very good. Do you, {playername}, swear similarly to accept {s4} as your wife?",
    "lady_elope_agree_player_vows",
    [
      (2197, 1080),
    ]],

  [plyr|anyone, "lady_elope_agree_player_vows",
    [],
    "I do.",
    "close_window",
    [
      (call_script, "script_courtship_event_bride_marry_groom", "$g_talk_troop", "trp_player", 1),
    ]],

  [plyr|anyone, "lady_elope_agree_player_vows",
    [],
    "Eh, what? This is all moving too fast...",
    "close_window",
    []],

  [plyr|anyone, "lady_elope_agree",
    [],
    "Oh, really? My dear -- I could never separate a lady from her family like that...",
    "lady_conclude_relationship",
    []],

  [anyone, "lady_conclude_relationship",
    [],
    "So I suppose our time together must come to an end...",
    "lady_conclude_relationship_confirm",
    []],

  [plyr|anyone, "lady_conclude_relationship_confirm",
    [],
    "Yes -- it must be...",
    "lady_conclude_relationship_confirm_yes",
    []],

  [plyr|anyone, "lady_conclude_relationship_confirm",
    [],
    "Wait -- perhaps there is still a chance for us!",
    "lady_conclude_relationship_confirm_no",
    []],

  [anyone, "lady_conclude_relationship_confirm_yes",
    [],
    "Farewell, {playername}. We will see each other, in the courts and castles of this realm, but we must keep our distance from each other. I will remember these days fondly, nonetheless.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 5, 4),
    ]],

  [anyone, "lady_conclude_relationship_confirm_no",
    [],
    "In that case, we shall see what the future brings.",
    "close_window",
    []],

  [plyr|anyone, "lady_generic_mission_succeeded",
    [],
    "Always an honor to serve, {s65}.",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_premeet",
    [],
    "I am {playername}.",
    "lady_meet",
    []],

  [plyr|anyone, "lady_premeet",
    [],
    "My name is {playername}. At your service.",
    "lady_meet",
    []],

  [anyone, "lady_meet",
    [
      (troop_slot_ge, "trp_player", 7, 200),
    ],
    "Of course. How splendid to finally make your acquaintance.",
    "lady_meet_end",
    []],

  [anyone, "lady_meet",
    [],
    "{playername}? I do not believe I've heard of you before.",
    "lady_meet_end",
    []],

  [anyone, "lady_meet_end",
    [
      (eq, "$lady_flirtation_location", "$g_encountered_party"),
    ],
    "I am about to retire for a little while, but perhaps we may have a chance to speak more later...",
    "lady_talk",
    []],

  [anyone, "lady_meet_end",
    [
      (troop_slot_eq, "$g_talk_troop", 30, -1),
      (call_script, "script_troop_get_romantic_chemistry_with_troop", "$g_talk_troop", "trp_player"),
      (le, reg0, 0),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (le, reg0, 0),
    ],
    "Now, if you will excuse me...",
    "lady_talk",
    []],

  [anyone, "lady_meet_end",
    [],
    "Can I help you with anything?",
    "lady_talk",
    []],

  [plyr|anyone, "lady_talk",
    [
      (neg|troop_slot_ge, "$g_talk_troop", 8, 0),
      (ge, "$g_encountered_party_relation", 0),
    ],
    "I want to know the location of someone.",
    "lord_talk_ask_location",
    []],

  [anyone, "lady_pretalk",
    [
      (troop_slot_eq, "$g_talk_troop", 30, -1),
      (call_script, "script_troop_get_romantic_chemistry_with_troop", "$g_talk_troop", "trp_player"),
      (le, reg0, 0),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (le, reg0, 0),
    ],
    "Now, if you will excuse me...",
    "lady_talk",
    []],

  [anyone, "lady_pretalk",
    [],
    "Is there anything else?",
    "lady_talk",
    []],

  [plyr|anyone, "lady_talk",
    [],
    "May I have the honor of knowing more about you, my lady?",
    "lady_relations",
    []],

  [anyone, "lady_relations",
    [
      (str_store_string, s12, "str_i_am"),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "trp_npc_adonja", "trp_heroes_end"),
        (call_script, "script_troop_get_family_relation_to_troop", "$g_talk_troop", ":var2"),
        (this_or_next|gt, reg0, 5),
        (party_slot_eq, "$g_encountered_party", 7, ":var2"),
        (gt, reg0, 0),
        (str_store_troop_name, s14, ":var2"),
        (try_begin),
          (eq, ":var0", 1),
          (str_store_string, s12, "str_s12"),
        (try_end),
        (str_store_string, s12, "str_s12_s11_to_s14"),
        (assign, ":var0", 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 7, ":var2"),
          (assign, ":var1", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s12, "str_s12"),
      (else_try),
        (eq, ":var1", 0),
        (faction_slot_eq, "$g_talk_troop_faction", 4, 6),
        (faction_slot_eq, "$g_talk_troop_faction", 5, "$g_encountered_party"),
        (str_store_string, s12, "str_s12_i_am_here_for_the_feast"),
      (else_try),
        (str_store_string, s12, "str_s12"),
      (try_end),
    ],
    "{s12}",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_talk",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
      (troop_slot_eq, "$g_talk_troop", 5, 1),
      (troop_slot_eq, "$g_talk_troop", 30, -1),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (neq, "$lady_flirtation_location", "$g_encountered_party"),
    ],
    "My lady, I would like to profess myself your most ardent admirer",
    "lady_profess_admiration",
    [
      (call_script, "script_troop_get_romantic_chemistry_with_troop", "$g_talk_troop", "trp_player"),
      (assign, ":var0", reg0),
      (val_div, ":var0", 2),
      (val_max, ":var0", -2),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", ":var0"),
      (assign, "$g_time_to_spare", 0),
    ]],

  [plyr|anyone, "lady_talk",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
      (gt, "$g_player_tournament_placement", 3),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
    ],
    "My lady, I would like to dedicate my successes in this recent tournament to you",
    "lady_tournament_dedication_reaction",
    [
      (try_begin),
        (gt, "$g_player_tournament_placement", 3),
        (val_sub, "$g_player_tournament_placement", 3),
        (val_mul, "$g_player_tournament_placement", 2),
      (else_try),
        (assign, "$g_player_tournament_placement", 0),
      (try_end),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 40, 1),
        (val_div, "$g_player_tournament_placement", 3),
        (str_store_string, s9, "str_another_tournament_dedication_oh_i_suppose_it_is_always_flattering"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 21),
        (val_mul, "$g_player_tournament_placement", 2),
        (str_store_string, s9, "str_do_you_why_what_a_most_gallant_thing_to_say"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 25),
        (val_div, "$g_player_tournament_placement", 2),
        (str_store_string, s9, "str_hmm_i_cannot_say_that_i_altogether_approve_of_such_frivolity_but_i_must_confess_myself_a_bit_flattered"),
      (else_try),
        (str_store_string, s9, "str_why_thank_you_you_are_most_kind_to_do_so"),
      (try_end),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", "$g_player_tournament_placement"),
      (assign, "$g_player_tournament_placement", 0),
      (troop_set_slot, "$g_talk_troop", 40, 1),
    ]],

  [anyone, "lady_tournament_dedication_reaction",
    [],
    "{s9}",
    "lady_pretalk",
    []],

  [anyone, "lady_profess_admiration",
    [
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (gt, reg0, 0),
      (try_begin),
        (troop_slot_eq, "$g_talk_troop", 52, 25),
        (str_store_string, s11, "str_you_are_most_courteous_and_courtesy_is_a_fine_virtue_"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 24),
        (str_store_string, s11, "str_hmm_youre_a_bold_one_but_i_like_that_"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 22),
        (str_store_string, s11, "str_ah_well_they_all_say_that_but_no_matter_a_compliment_well_delivered_is_at_least_a_good_start_"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 23),
        (str_store_string, s11, "str_oh_do_you_mean_that_such_a_kind_thing_to_say"),
      (else_try),
        (str_store_string, s11, "str_you_are_a_most_gallant_young_man_"),
      (try_end),
    ],
    "{s11}I would like it very much if we could see more of each other.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 5, 2),
      (assign, "$lady_flirtation_location", "$g_encountered_party"),
    ]],

  [anyone, "lady_profess_admiration",
    [],
    "Ah... You are too kind... My, the hour is getting rather late, isn't it? I really must be going.",
    "lady_pretalk",
    [
      (troop_set_slot, "$g_talk_troop", 5, 2),
    ]],

  [plyr|anyone, "lady_talk",
    [
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (eq, "$g_time_to_spare", 1),
      (eq, "$talk_context", 16),
    ],
    "Do you like poetry, my lady?",
    "lady_recite_poetry",
    [
      (assign, "$g_time_to_spare", 0),
    ]],

  [anyone, "lady_recite_poetry",
    [],
    "That would depend on the poem. Did you intend to recite a verse?",
    "lady_recite_poetry",
    []],

  [plyr|anyone, "lady_recite_poetry",
    [
      (gt, "$tragic_poem_recitations", 0),
      (troop_slot_eq, "$g_talk_troop", 78, 0),
    ],
    "The wind that blows the dry steppe dust...",
    "lady_recite_poetry_response",
    [
      (assign, "$poem_selected", 1),
      (troop_set_slot, "$g_talk_troop", 78, 1),
    ]],

  [plyr|anyone, "lady_recite_poetry",
    [
      (gt, "$comic_poem_recitations", 0),
      (troop_slot_eq, "$g_talk_troop", 76, 0),
    ],
    "All the silks of Ethos/All the furs of Poinsbruk...",
    "lady_recite_poetry_response",
    [
      (assign, "$poem_selected", 3),
      (troop_set_slot, "$g_talk_troop", 76, 1),
    ]],

  [plyr|anyone, "lady_recite_poetry",
    [
      (gt, "$mystic_poem_recitations", 0),
      (troop_slot_eq, "$g_talk_troop", 77, 0),
    ],
    "You are the first and the last/the outer and the inner...",
    "lady_recite_poetry_response",
    [
      (assign, "$poem_selected", 4),
      (troop_set_slot, "$g_talk_troop", 77, 1),
    ]],

  [plyr|anyone, "lady_recite_poetry",
    [
      (gt, "$heroic_poem_recitations", 0),
      (troop_slot_eq, "$g_talk_troop", 74, 0),
    ],
    "A light pierced the gloom over Windholm cliffs...",
    "lady_recite_poetry_response",
    [
      (assign, "$poem_selected", 2),
      (troop_set_slot, "$g_talk_troop", 74, 1),
    ]],

  [plyr|anyone, "lady_recite_poetry",
    [
      (gt, "$allegoric_poem_recitations", 0),
      (troop_slot_eq, "$g_talk_troop", 75, 0),
    ],
    "I deflected her skeptical questioning darts/with armor made of purest devotion...",
    "lady_recite_poetry_response",
    [
      (assign, "$poem_selected", 5),
      (troop_set_slot, "$g_talk_troop", 75, 1),
    ]],

  [plyr|anyone, "lady_recite_poetry",
    [],
    "Actually, I can't think of any that I would care to recite...",
    "lady_pretalk",
    []],

  [anyone, "lady_recite_poetry_response",
    [
      (call_script, "script_courtship_poem_reactions", "$g_talk_troop", "$poem_selected"),
    ],
    "{s11}",
    "lady_private_conversation_end",
    [
      (assign, ":var0", reg0),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", ":var0"),
      (call_script, "script_courtship_poem_reactions", "$g_talk_troop", "$poem_selected"),
    ]],

  [anyone, "lady_private_conversation_end",
    [
      (str_clear, s11),
      (try_begin),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
        (gt, reg0, 0),
        (str_store_string, s11, "str__do_come_and_see_me_again_soon"),
      (try_end),
    ],
    "Time is passing quickly, and we cannot linger here too long.",
    "lady_pretalk",
    [
      (assign, "$g_time_to_spare", 0),
    ]],

  [plyr|anyone, "lady_talk",
    [
      (neg|check_quest_active, "qst_formal_marriage_proposal"),
      (neg|troop_slot_ge, "trp_player", 34, "trp_npc_adonja"),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
      (troop_slot_eq, "$g_talk_troop", 5, 2),
      (eq, "$talk_context", 16),
    ],
    "Do you think that we may have a future together, my lady?",
    "lady_marriage_discussion",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (assign, "$romantic_rival", -1),
      (try_for_range, ":var0", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (this_or_next|troop_slot_eq, ":var0", 35, "$g_talk_troop"),
        (this_or_next|troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (troop_slot_eq, ":var0", 36, "$g_talk_troop"),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", ":var0"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var0"),
          (display_message, "str_rival_found_s4_reg0_relation"),
        (try_end),
        (gt, reg0, "$g_talk_troop_relation"),
        (assign, "$romantic_rival", ":var0"),
      (try_end),
      (gt, "$romantic_rival", -1),
    ],
    "Sir -- as you may know, I have been entertaining offers from a number of gentlemen such as yourself. I am not yet at a stage where I can commit to any of them.",
    "lady_other_suitor",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 24),
      (neg|troop_slot_ge, "trp_player", 7, 350),
    ],
    "It is good to hear that you are thinking seriously about the future. However, I would like to see you rise a little further in the world before I am ready to commit to marrying you.",
    "lady_proposal_refused",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 25),
      (lt, "$player_honor", 10),
    ],
    "It is good to hear that your intentions are honorable. However, I have resolved only to marry a man of the strongest moral fiber. I would like you to prove yourself more in that regard.",
    "lady_proposal_refused",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (lt, "$g_talk_troop_relation", 20),
    ],
    "Sir -- it is comforting to hear that your intentions towards me are honorable. But perhaps we should take the time to get to allow our affections for each other to grow a little stronger, before making any such decision.",
    "lady_proposal_refused",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (troop_slot_eq, ":var0", 38, -1),
      (str_store_troop_name, s4, reg0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Oh {playername}, how happy that would make me! But my {s11} {s4} would never allow it... Perhaps it is best that we part...",
    "lady_betrothed",
    []],

  [anyone, "lady_marriage_discussion",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Oh {playername}, how happy that would make me! Go ask my {s11} {s4} for permission!",
    "close_window",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (str_store_troop_name, s12, ":var0"),
      (str_store_troop_name, s15, "$g_talk_troop"),
      (setup_quest_text, "qst_formal_marriage_proposal"),
      (str_store_string, s2, "str_you_intend_to_ask_s12_for_permission_to_marry_s15"),
      (quest_set_slot, "qst_formal_marriage_proposal", 2, ":var0"),
      (quest_set_slot, "qst_formal_marriage_proposal", 23, 30),
      (quest_set_slot, "qst_formal_marriage_proposal", 11, 0),
      (call_script, "script_start_quest", "qst_formal_marriage_proposal", "$g_talk_troop"),
      (quest_set_slot, "qst_formal_marriage_proposal", 6, "$g_talk_troop"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ]],

  [plyr|anyone, "lady_proposal_refused",
    [
      (is_between, "$g_talk_troop_relation", 12, 20),
      (neg|this_or_next|troop_slot_eq, "$g_talk_troop", 52, 24),
      (troop_slot_ge, "trp_player", 7, 350),
      (neg|this_or_next|troop_slot_eq, "$g_talk_troop", 52, 25),
      (ge, "$player_honor", 10),
    ],
    "Perhaps I can persuade you to delay no further.",
    "lady_proposal_refused_persuade_check",
    []],

  [anyone, "lady_proposal_refused_persuade_check",
    [],
    "What do you have to say?",
    "lady_proposal_refused_persuade_player_response",
    [
      (assign, reg4, 20),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (assign, ":var0", reg0),
      (assign, reg5, ":var0"),
      (assign, reg9, 1),
      (store_skill_level, ":var1", skl_persuasion, "trp_player"),
      (store_sub, ":var2", 20, ":var0"),
      (val_mul, ":var1", 2),
      (try_begin),
        (gt, ":var2", ":var1"),
        (assign, "$g_persuasion_failure_chance", 100),
      (else_try),
        (store_mul, "$g_persuasion_failure_chance", ":var2", 100),
        (val_div, "$g_persuasion_failure_chance", ":var1"),
      (try_end),
      (assign, reg8, "$g_persuasion_failure_chance"),
      (store_sub, reg7, 100, "$g_persuasion_failure_chance"),
      (dialog_box, "str_persuasion_opportunity"),
    ]],

  [plyr|anyone, "lady_proposal_refused_persuade_player_response",
    [],
    "Love is as a rose, my lady. Left unplucked, it may wither.",
    "lady_proposal_refused_persuade_result",
    []],

  [plyr|anyone, "lady_proposal_refused_persuade_player_response",
    [],
    "Oh, never mind.",
    "lady_pretalk",
    []],

  [anyone, "lady_proposal_refused_persuade_result",
    [
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", "$g_persuasion_failure_chance"),
    ],
    "Enough, sir! I shall not be rushed into marriage, with you or with anyone else! You have made me very cross. Please, leave me alone for a while. I shall let you know when I am ready to speak to you again.",
    "close_window",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", -1),
      (jump_to_menu, "mnu_town"),
      (finish_mission),
    ]],

  [anyone, "lady_proposal_refused_persuade_result",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (troop_slot_eq, ":var0", 38, -1),
      (str_store_troop_name, s4, reg0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Oh {playername}, I could never allow that to happen! Oh, if only we could be wed! But my {s11} {s4} would never give his permission... Perhaps it is best that we part...",
    "lady_betrothed",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 5),
    ]],

  [anyone, "lady_proposal_refused_persuade_result",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Oh {playername}, I could never allow that to happen! Go ask my {s11} {s4} his permission for us to be wed!",
    "close_window",
    [
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 5),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (str_store_troop_name, s12, ":var0"),
      (str_store_troop_name, s15, "$g_talk_troop"),
      (setup_quest_text, "qst_formal_marriage_proposal"),
      (str_store_string, s2, "str_you_intend_to_ask_s12_for_permission_to_marry_s15"),
      (quest_set_slot, "qst_formal_marriage_proposal", 2, ":var0"),
      (quest_set_slot, "qst_formal_marriage_proposal", 23, 30),
      (quest_set_slot, "qst_formal_marriage_proposal", 11, 0),
      (call_script, "script_start_quest", "qst_formal_marriage_proposal", "$g_talk_troop"),
      (quest_set_slot, "qst_formal_marriage_proposal", 6, "$g_talk_troop"),
    ]],

  [plyr|anyone, "lady_proposal_refused",
    [],
    "Very well -- I shall continue to strive to be worthy of your esteem!",
    "close_window",
    []],

  [plyr|anyone, "lady_proposal_refused",
    [
      (eq, 1, 0),
      (neg|check_quest_active, "qst_formal_marriage_proposal"),
    ],
    "I am tired of these games! I will speak to your family about arranging a wedding immediately..",
    "lady_player_threatens_compel",
    []],

  [anyone, "lady_player_threatens_compel",
    [],
    "What? Do you mean that?",
    "lady_player_threatens_compel_2",
    []],

  [plyr|anyone, "lady_player_threatens_compel_2",
    [],
    "No, of couse not. Please forgive my burst of temper",
    "lady_private_conversation_end",
    []],

  [plyr|anyone, "lady_player_threatens_compel_2",
    [],
    "Yes -- you clearly do not know what is in your best interests.",
    "close_window",
    [
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (str_store_troop_name, s10, "$g_talk_troop"),
      (str_store_troop_name, s12, ":var0"),
      (setup_quest_text, "qst_formal_marriage_proposal"),
      (str_store_string, s2, "str_you_intend_to_ask_s12_to_pressure_s10_to_marry_you"),
      (quest_set_slot, "qst_formal_marriage_proposal", 2, ":var0"),
      (quest_set_slot, "qst_formal_marriage_proposal", 23, 30),
      (quest_set_slot, "qst_formal_marriage_proposal", 11, 0),
      (call_script, "script_start_quest", "qst_formal_marriage_proposal", "$g_talk_troop"),
      (quest_set_slot, "qst_formal_marriage_proposal", 6, "$g_talk_troop"),
    ]],

  [plyr|anyone, "lady_other_suitor",
    [],
    "It grieves me to hear that, my lady, but such things must be",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_other_suitor",
    [],
    "Who is the miscreant! Tell me his name!",
    "lady_other_suitor_challenge",
    []],

  [plyr|anyone, "lady_other_suitor",
    [
      (eq, 1, 0),
    ],
    "I am tired of these games! I will demand that your family compel you to marry me..",
    "lady_player_threatens_compel",
    []],

  [anyone, "lady_other_suitor_challenge",
    [
      (check_quest_active, "qst_duel_courtship_rival"),
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "$romantic_rival"),
      (lt, reg0, 0),
    ],
    "I would be so grateful! But from what I understand, you already have a duel on your hands. He is not honor-bound to fight you, if you are committed to another combat. Please, conclude your other business in a hurry, to rescue me from that man's attentions!.",
    "lady_pretalk",
    []],

  [anyone, "lady_other_suitor_challenge",
    [
      (check_quest_active, "qst_duel_courtship_rival"),
    ],
    "Ah! Such talk. But from what I hear, you already have a duel on your hands. Finish one before you start another! Sigh... You men can be so silly...",
    "lady_pretalk",
    []],

  [anyone, "lady_other_suitor_challenge",
    [
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "$romantic_rival"),
      (lt, reg0, 0),
      (str_store_troop_name, s5, "$romantic_rival"),
    ],
    "It is {s5}. Please, rescue me from that man's attentions!",
    "lady_other_suitor_challenge_confirm",
    []],

  [anyone, "lady_other_suitor_challenge",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 24),
      (str_store_troop_name, s5, "$romantic_rival"),
    ],
    "Will you now? This should be interesting. Very well. Your rival is {s5}. Let us see which of you has the greater mettle.",
    "lady_other_suitor_challenge_confirm",
    [
      (assign, "$quarrel_penalty", 0),
    ]],

  [anyone, "lady_other_suitor_challenge",
    [
      (troop_slot_eq, "$g_talk_troop", 52, 21),
      (str_store_troop_name, s5, "$romantic_rival"),
    ],
    "Oh, fie! I wish that this were not a matter of honor, so I could refuse such a request. But alas, I feel compelled to tell you that your rival is {s5}. I wish that heaven had not granted me such a fair visage, so that I would not inspire such passions in men!",
    "lady_other_suitor_challenge_confirm",
    [
      (assign, "$quarrel_penalty", -1),
    ]],

  [anyone, "lady_other_suitor_challenge",
    [
      (str_store_troop_name, s5, "$romantic_rival"),
    ],
    "I will have none of such talk! It is nonsense for you and {s5} to fight over -- whoops! I beg of you, sir, forget the name that just escaped my lips...",
    "lady_other_suitor_challenge_confirm",
    [
      (assign, "$quarrel_penalty", -3),
    ]],

  [plyr|anyone, "lady_other_suitor_challenge_confirm",
    [],
    "So be it! I shall challenge him to a trial of arms!",
    "lady_other_suitor_challenge_confirm_yes",
    []],

  [plyr|anyone, "lady_other_suitor_challenge_confirm",
    [],
    "On second thought, I let my passions run away with me there. Never mind.",
    "lady_other_suitor_challenge_confirm_no",
    []],

  [anyone, "lady_other_suitor_challenge_confirm_yes",
    [
      (try_begin),
        (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "$romantic_rival"),
        (lt, reg0, 0),
        (str_store_string, s15, "str_do_be_careful_i_am_so_much_endebted_to_you_for_this"),
      (else_try),
        (troop_slot_eq, "$g_talk_troop", 52, 24),
        (str_store_string, s15, "str_go_then__we_shall_see_which_of_you_triumphs"),
      (else_try),
        (str_store_string, s15, "str_sigh_i_will_never_truly_understand_men_and_their_rash_actions"),
      (try_end),
    ],
    "{s15}",
    "lady_pretalk",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", "$quarrel_penalty"),
      (str_store_troop_name, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, "$romantic_rival"),
      (setup_quest_text, "qst_duel_courtship_rival"),
      (str_store_string, s2, "str_you_intend_to_challenge_s13_to_force_him_to_relinquish_his_suit_of_s11"),
      (call_script, "script_start_quest", "qst_duel_courtship_rival", "$g_talk_troop"),
      (quest_set_slot, "qst_duel_courtship_rival", 2, "$romantic_rival"),
      (quest_set_slot, "qst_duel_courtship_rival", 21, 400),
      (quest_set_slot, "qst_duel_courtship_rival", 23, 60),
      (quest_set_slot, "qst_duel_courtship_rival", 11, 0),
    ]],

  [anyone, "lady_other_suitor_challenge_confirm_no",
    [],
    "Good. You are wise not to let your temper guide you.",
    "lady_private_conversation_end",
    []],

  [plyr|anyone, "lady_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 30, 0),
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
    ],
    "Is there anything I can do to win your favor?",
    "lady_ask_for_quest",
    [
      (call_script, "script_get_quest", "$g_talk_troop"),
      (assign, "$random_quest_no", reg0),
    ]],

  [anyone, "lady_ask_for_quest",
    [
      (troop_slot_eq, "$g_talk_troop", 20, 1),
    ],
    "I don't have anything else for you to do right now.",
    "lady_pretalk",
    []],

  [anyone, "lady_ask_for_quest",
    [
      (this_or_next|eq, "$random_quest_no", "qst_rescue_lord_by_replace"),
      (eq, "$random_quest_no", "qst_rescue_prisoner"),
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
      (str_store_string, s17, s11),
    ],
    "Oh, I fear I may never see my {s17}, {s13}, again... He is a prisoner in the dungeon of {s14}. We have tried to negotiate his ransom, but it has been set too high. We can never hope to raise that much money without selling everything we own, and God knows {s13} would rather spend his life in prison than make us destitute. Instead I came up with a plan to get him out of there, but it requires someone to make a great sacrifice, and so far my pleas have fallen on deaf ears...",
    "lady_mission_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (quest_get_slot, ":var1", "$random_quest_no", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var1", "$g_talk_troop"),
      (str_store_string, s17, s11),
      (str_store_troop_name, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var1"),
      (str_store_party_name_link, s14, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (try_begin),
        (eq, "$random_quest_no", "qst_rescue_lord_by_replace"),
        (str_store_string, s2, "@{s11} asked you to rescue her {s17}, {s13}, from {s14} by switching clothes and taking his place in prison."),
      (else_try),
        (str_store_string, s2, "@{s11} asked you to rescue her {s17}, {s13}, from {s14}."),
      (try_end),
    ]],

  [anyone, "lady_ask_for_quest",
    [
      (eq, "$random_quest_no", "qst_deliver_message_to_prisoner_lord"),
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "My poor {s11}, {s13}, is a prisoner in the {s14} dungeons. The only way we can talk to each other is by exchanging letters whenever we can, but the journey is so dangerous that we get little chance to do so. Please, would you deliver one for me?",
    "lady_mission_told",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (quest_get_slot, ":var1", "$random_quest_no", 2),
      (str_store_troop_name, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var1"),
      (str_store_party_name_link, s14, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@{s11} asked you to deliver a message to {s13}, who is imprisoned at {s14}."),
    ]],

  [anyone, "lady_ask_for_quest",
    [
      (eq, "$random_quest_no", "qst_duel_for_lady"),
    ],
    "Dear {playername}, you are kind to ask, but you know little of my troubles and I can't possibly ask you to throw yourself into danger on my behalf.",
    "lady_quest_duel_for_lady",
    []],

  [plyr|anyone, "lady_quest_duel_for_lady",
    [],
    "Tell me what the problem is, and I can make my own decision.",
    "lady_quest_duel_for_lady_2",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (str_store_troop_name, s11, "$g_talk_troop"),
      (str_store_troop_name_link, s13, ":var0"),
      (str_store_string, s2, "@You agreed to challenge {s13} to defend {s11}'s honor."),
      (setup_quest_text, "$random_quest_no"),
    ]],

  [anyone, "lady_quest_duel_for_lady_2",
    [],
    "Very well, as you wish it... My husband has made certain enemies in his life, {playername}. One of the most insidious is {s13}. He is going around making terrible accusations against me, impugning my honor at every turn! Because he cannot harm my husband directly, he is using me as a target to try and stain our name. You should hear the awful things he's said! I only wish there was someone brave enough to make him recant his slander, but {s13} is a very fine swordsman, and he's widely feared...",
    "lady_quest_duel_for_lady_3",
    []],

  [plyr|anyone, "lady_quest_duel_for_lady_3",
    [],
    "I fear him not, {s65}. I will make him take back his lies.",
    "lady_quest_duel_for_lady_3_accepted",
    []],

  [anyone, "lady_quest_duel_for_lady_3_accepted",
    [],
    "Oh! I can't ask that of you, {playername}, but... I would be forever indebted to you, and you are so sure. It would mean so much if you would defend my honor. Thank you a thousand times, all my prayers and my favor go with you.",
    "close_window",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
      (call_script, "script_report_quest_troop_positions", "$random_quest_no", ":var0", 3),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 3),
    ]],

  [plyr|anyone, "lady_quest_duel_for_lady_3",
    [],
    "If he's that dangerous, perhaps maybe it would be better to ignore him...",
    "lady_quest_duel_for_lady_3_rejected",
    []],

  [anyone, "lady_quest_duel_for_lady_3_rejected",
    [],
    "Oh... Perhaps you're right, {playername}. I should let go of these silly childhood ideas of chivalry and courage. {reg63?Men:People} are not like that, not anymore. Good day to you.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
    ]],

  [anyone, "lady_ask_for_quest",
    [],
    "No, {playername}, I've no need for a champion right now.",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_mission_told",
    [],
    "As you wish it, {s65}, it shall be done.",
    "lady_mission_accepted",
    []],

  [plyr|anyone, "lady_mission_told",
    [],
    "{s66}, I fear I cannot help you right now.",
    "lady_mission_rejected",
    []],

  [anyone, "lady_mission_accepted",
    [],
    "You are a true {reg63?gentleman:lady}, {playername}. Thank you so much for helping me",
    "close_window",
    [
      (try_begin),
        (eq, "$random_quest_no", "qst_deliver_message_to_prisoner_lord"),
        (call_script, "script_troop_add_gold", "trp_player", 10),
      (try_end),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "lady_mission_rejected",
    [],
    "You'll not help a woman in need? You should be ashamed, {playername}... Please leave me, I have some important embroidery to catch up.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -1),
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [plyr|anyone, "lady_talk",
    [
      (troop_slot_ge, "$g_talk_troop", 30, 0),
    ],
    "I want to improve my relation with a lord. Can you help me?",
    "lady_restore_relation",
    []],

  [anyone, "lady_restore_relation",
    [
      (le, "$g_talk_troop_relation", 0),
    ],
    "{playername}, I don't know you well enough to act on your behalf. I am sorry.",
    "lady_pretalk",
    []],

  [anyone, "lady_restore_relation",
    [],
    "Hmm. I guess you got on the wrong side of somebody. Very well, who do you want to restore your relation with?",
    "lady_restore_relation_2",
    []],

  [repeat_for_troops|plyr|anyone, "lady_restore_relation_2",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, "$g_talk_troop_faction", ":var1"),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (lt, reg0, 0),
      (str_store_troop_name, s1, ":var0"),
    ],
    "{s1}",
    "lady_restore_relation_2b",
    [
      (store_repeat_object, "$troop_to_restore_relations_with"),
    ]],

  [plyr|anyone, "lady_restore_relation_2",
    [],
    "Never mind. I get along with everyone well enough.",
    "lady_pretalk",
    []],

  [anyone, "lady_restore_relation_2b",
    [
      (str_store_troop_name, s10, "$troop_to_restore_relations_with"),
    ],
    "Well I can try to help you there. I am sure a few expensive gifts will make {s10} look at you more favorably.",
    "lady_restore_relation_3",
    []],

  [anyone, "lady_restore_relation_3",
    [
      (str_store_troop_name, s10, "$troop_to_restore_relations_with"),
      (assign, "$lady_restore_cost_1", 1000),
      (assign, "$lady_restore_cost_2", 2000),
      (assign, "$lady_restore_cost_3", 3000),
      (assign, reg10, "$lady_restore_cost_1"),
      (assign, reg11, "$lady_restore_cost_2"),
      (assign, reg12, "$lady_restore_cost_3"),
      (troop_get_type, reg4, "$troop_to_restore_relations_with"),
    ],
    "You can improve your relation with {s10} by sending {reg4?her:him} a gift worth {reg10} denars. But if you can afford spending {reg11} denars on the gift, it would make a good impression on {reg4?her:him}. And if you can go up to {reg12} denars, that would really help smooth things out.",
    "lady_restore_relation_4",
    []],

  [plyr|anyone, "lady_restore_relation_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$lady_restore_cost_1"),
      (assign, reg10, "$lady_restore_cost_1"),
    ],
    "I think a gift of {reg10} denars will do.",
    "lady_restore_relation_5",
    [
      (assign, "$temp", 1),
      (assign, "$temp_2", "$lady_restore_cost_1"),
    ]],

  [plyr|anyone, "lady_restore_relation_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$lady_restore_cost_2"),
      (assign, reg11, "$lady_restore_cost_2"),
    ],
    "Maybe I can afford {reg11} denars.",
    "lady_restore_relation_5",
    [
      (assign, "$temp", 2),
      (assign, "$temp_2", "$lady_restore_cost_2"),
    ]],

  [plyr|anyone, "lady_restore_relation_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$lady_restore_cost_3"),
      (assign, reg12, "$lady_restore_cost_3"),
    ],
    "In that case, I am ready to spend {reg12} denars.",
    "lady_restore_relation_5",
    [
      (assign, "$temp", 3),
      (assign, "$temp_2", "$lady_restore_cost_3"),
    ]],

  [plyr|anyone, "lady_restore_relation_4",
    [],
    "I don't think I can afford a gift at the moment.",
    "lady_restore_relation_cant_afford",
    []],

  [anyone, "lady_restore_relation_5",
    [],
    "Excellent. Then I'll choose an appropriate gift for you and send it to {s10} with your compliments. I am sure {reg4?she:he} will appreciate the gesture.",
    "lady_restore_relation_6",
    [
      (troop_remove_gold, "trp_player", "$temp_2"),
      (call_script, "script_change_player_relation_with_troop", "$troop_to_restore_relations_with", "$temp"),
      (troop_get_type, reg4, "$troop_to_restore_relations_with"),
    ]],

  [plyr|anyone, "lady_restore_relation_6",
    [],
    "Thank you for your help, madame.",
    "lady_pretalk",
    []],

  [anyone, "lady_restore_relation_cant_afford",
    [],
    "I am afraid, I can't be of much help in that case, {playername}. I am sorry.",
    "lady_pretalk",
    []],

  [plyr|anyone, "lady_talk",
    [],
    "I must beg my leave.",
    "lady_leave",
    []],

  [auto_proceed|anyone, "lady_leave",
    [
      (call_script, "script_troop_get_relation_with_troop", "$g_talk_troop", "trp_player"),
      (try_begin),
        (lt, reg0, 0),
        (str_store_string, s12, "str_farewell"),
      (else_try),
        (str_store_string, s12, "str_farewell_playername"),
      (try_end),
    ],
    "{s12}",
    "close_window",
    [
      (eq, "$talk_context", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "convince_begin",
    [],
    "I still don't see why I should accept what you're asking of me.",
    "convince_options",
    [
      (quest_get_slot, "$convince_value", "$g_convince_quest", 19),
    ]],

  [plyr|anyone, "convince_options",
    [
      (assign, reg8, "$convince_value"),
    ],
    "Then I'll make it worth your while. ({reg8} denars)",
    "convince_bribe",
    []],

  [plyr|anyone, "convince_options",
    [
      (store_div, "$convince_relation_penalty", "$convince_value", 300),
      (val_add, "$convince_relation_penalty", 1),
      (assign, reg9, "$convince_relation_penalty"),
    ],
    "Please, do it for the sake of our friendship. (-{reg9} to relation)",
    "convince_friendship",
    []],

  [plyr|anyone, "convince_options",
    [],
    "Let me try and convince you. (Persuasion)",
    "convince_persuade_begin",
    []],

  [plyr|anyone, "convince_options",
    [],
    "Never mind.",
    "lord_pretalk",
    []],

  [anyone, "convince_bribe",
    [],
    "Mmm, a generous gift to my coffers would certainly help matters... {reg8} denars should do it. If you agree, then I'll go with your suggestion.",
    "convince_bribe_verify",
    []],

  [plyr|anyone, "convince_bribe_verify",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", "$convince_value"),
    ],
    "I'm afraid my finances will not allow for such a gift.",
    "convince_bribe_cant_afford",
    []],

  [plyr|anyone, "convince_bribe_verify",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$convince_value"),
    ],
    "Very well, please accept these {reg8} denars as a token of my gratitude.",
    "convince_bribe_goon",
    []],

  [plyr|anyone, "convince_bribe_verify",
    [],
    "Let me think about this some more.",
    "convince_begin",
    []],

  [anyone, "convince_bribe_cant_afford",
    [],
    "Ah. In that case, there is little I can do, unless you have some further argument to make.",
    "convince_options",
    []],

  [anyone, "convince_bribe_goon",
    [],
    "My dear {playername}, your generous gift has led me to reconsider what you ask, and I have come to appreciate the wisdom of your proposal.",
    "convince_accept",
    [
      (troop_remove_gold, "trp_player", "$convince_value"),
    ]],

  [anyone, "convince_friendship",
    [
      (store_add, ":var0", 5, "$convince_relation_penalty"),
      (ge, "$g_talk_troop_effective_relation", ":var0"),
    ],
    "You've done well by me in the past, {playername}, and for that I will go along with your request, but know that I do not like you using our relationship this way.",
    "convince_friendship_verify",
    []],

  [plyr|anyone, "convince_friendship_verify",
    [],
    "I am sorry, my friend, but I need your help in this.",
    "convince_friendship_go_on",
    []],

  [plyr|anyone, "convince_friendship_verify",
    [],
    "If it will not please you, then I'll try something else.",
    "lord_pretalk",
    []],

  [anyone, "convince_friendship_go_on",
    [],
    "All right then, {playername}, I will accept this for your sake. But remember, you owe me for this.",
    "convince_accept",
    [
      (store_sub, ":var0", 0, "$convince_relation_penalty"),
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", ":var0"),
    ]],

  [anyone, "convince_friendship",
    [
      (ge, "$g_talk_troop_relation", -5),
    ],
    "I don't think I owe you such a favor {playername}. I see no reason to accept this for you.",
    "lord_pretalk",
    []],

  [anyone, "convince_friendship",
    [],
    "Is this a joke? You've some nerve asking me for favours, {playername}, and let me assure you you'll get none.",
    "lord_pretalk",
    []],

  [anyone, "convince_persuade_begin",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 26),
      (store_current_hours, ":var1"),
      (store_add, ":var2", ":var0", 24),
      (gt, ":var1", ":var2"),
    ],
    "Very well. Make your case.",
    "convince_persuade_begin_2",
    []],

  [plyr|anyone, "convince_persuade_begin_2",
    [],
    "[Attempt to persuade]",
    "convince_persuade",
    [
      (try_begin),
        (store_random_in_range, ":var0", 0, 100),
        (lt, ":var0", 30),
        (store_current_hours, ":var1"),
        (troop_set_slot, "$g_talk_troop", 26, ":var1"),
      (try_end),
      (store_skill_level, ":var2", skl_persuasion, "trp_player"),
      (store_add, ":var3", ":var2", 5),
      (store_random_in_range, ":var4", 0, ":var3"),
      (store_random_in_range, ":var5", 0, ":var3"),
      (store_add, ":var0", ":var4", ":var5"),
      (assign, ":var6", "$convince_value"),
      (convert_to_fixed_point, ":var6"),
      (store_sqrt, ":var6", ":var6"),
      (convert_from_fixed_point, ":var6"),
      (val_div, ":var6", 10),
      (val_add, ":var6", 4),
      (store_sub, "$persuasion_strength", ":var0", ":var6"),
      (val_mul, "$persuasion_strength", 20),
      (assign, reg5, "$persuasion_strength"),
      (val_sub, "$convince_value", "$persuasion_strength"),
      (quest_set_slot, "$g_convince_quest", 19, "$convince_value"),
      (str_store_troop_name, s50, "$g_talk_troop"),
      (troop_get_type, reg51, "$g_talk_troop"),
      (try_begin),
        (lt, "$persuasion_strength", -30),
        (str_store_string, s5, "str_persuasion_summary_very_bad"),
      (else_try),
        (lt, "$persuasion_strength", -10),
        (str_store_string, s5, "str_persuasion_summary_bad"),
      (else_try),
        (lt, "$persuasion_strength", 10),
        (str_store_string, s5, "str_persuasion_summary_average"),
      (else_try),
        (lt, "$persuasion_strength", 30),
        (str_store_string, s5, "str_persuasion_summary_good"),
      (else_try),
        (str_store_string, s5, "str_persuasion_summary_very_good"),
      (try_end),
      (dialog_box, "@{s5} (Persuasion strength: {reg5})", "@Persuasion Attempt"),
    ]],

  [plyr|anyone, "convince_persuade_begin_2",
    [],
    "Wait, perhaps there is another way to convince you.",
    "convince_begin",
    []],

  [anyone, "convince_persuade_begin",
    [],
    "By God's grace, {playername}! Haven't we talked enough already? I am tired of listening to you, and I do not want to hear any more of it right now.",
    "lord_pretalk",
    []],

  [anyone, "convince_persuade",
    [
      (le, "$convince_value", 0),
    ],
    "All right, all right. You have persuaded me to it. I'll go ahead with what you suggest.",
    "convince_accept",
    []],

  [anyone, "convince_persuade",
    [
      (gt, "$persuasion_strength", 5),
    ],
    "You've a point, {playername}, I'll admit that much. However I am not yet convinced I should do as you bid.",
    "convince_options",
    []],

  [anyone, "convince_persuade",
    [
      (gt, "$persuasion_strength", -5),
    ],
    "Enough, {playername}. You've a lot of arguments, but I find none of them truly convincing. I stand by what I said before.",
    "convince_options",
    []],

  [anyone, "convince_persuade",
    [],
    "Truthfully, {playername}, I fail to see the virtue of your reasoning. What you ask for makes even less sense now than it did before.",
    "convince_options",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 7),
      (eq, "$talk_context", 12),
      (str_store_party_name, s1, "$g_encountered_party"),
    ],
    "I must congratulate you on your victory, my {reg63?lord:lady}. Welcome to {s1}. We, the housekeepers of this castle, are at your service.",
    "siege_won_seneschal_1",
    []],

  [plyr|anyone, "siege_won_seneschal_1",
    [],
    "Are you the seneschal?",
    "siege_won_seneschal_2",
    []],

  [anyone, "siege_won_seneschal_2",
    [],
    "Indeed I am, my {reg63?lord:lady}. I have always served the masters of {s1} to the best of my ability, whichever side they might be on. Thus you may count on my utmost loyalty for as long as you are the {reg63?lord:lady} of this place. Now, do you intend to keep me on as the seneschal? I promise you will not be disappointed.",
    "siege_won_seneschal_3",
    []],

  [plyr|anyone, "siege_won_seneschal_3",
    [],
    "Very well, you may keep your post for the time being.",
    "siege_won_seneschal_4",
    []],

  [plyr|anyone, "siege_won_seneschal_3",
    [],
    "You can stay, but I shall be keeping a close watch on you.",
    "siege_won_seneschal_4",
    []],

  [anyone, "siege_won_seneschal_4",
    [],
    "Thank you, my {reg63?lord:lady}. If you do not mind my impudence, may I inquire as to what you wish to do with the castle?",
    "siege_won_seneschal_5",
    []],

  [plyr|anyone, "siege_won_seneschal_5",
    [],
    "I will sell it to another lord.",
    "siege_won_seneschal_6",
    []],

  [plyr|anyone, "siege_won_seneschal_5",
    [],
    "I intend to claim it for myself.",
    "siege_won_seneschal_6",
    []],

  [plyr|anyone, "siege_won_seneschal_5",
    [],
    "I haven't given it much thought. What are my options?",
    "siege_won_seneschal_list_options",
    []],

  [anyone, "siege_won_seneschal_list_options",
    [],
    "According to our laws and traditions, you can do one of several things. First, you could station a garrison here to protect the castle from any immediate counterattacks, then request an audience with some wealthy lord and ask him to make you an offer. It would be worth a tidy sum, believe you me. If you do not wish to sell, then you will have to find yourself a liege lord and protector who would accept homage from you. Without a royal investiture and an army at your back, you would have a difficult time holding on to the castle. Both you and {s1} would become great big targets for any man with a few soldiers and a scrap of ambition. ",
    "siege_won_seneschal_list_options_2",
    []],

  [plyr|anyone, "siege_won_seneschal_list_options_2",
    [],
    "What do you mean, a liege lord and protector? I won this place by my own hand, I don't need anyone else!",
    "siege_won_seneschal_list_options_3",
    []],

  [anyone, "siege_won_seneschal_list_options_3",
    [],
    "Of course you don't, my {reg63?lord:lady}. However, no lord in the land will recognize your claim to the castle unless it is verified by royal decree. They would call {s1} an outlaw stronghold and take it from you at the earliest opportunity. Surely not even you could stand against a whole army.",
    "siege_won_seneschal_list_options_4",
    []],

  [plyr|anyone, "siege_won_seneschal_list_options_4",
    [],
    "Hmm. I'll give it some thought.",
    "siege_won_seneschal_6",
    []],

  [anyone, "siege_won_seneschal_6",
    [],
    "I am very pleased to hear it, my {reg63?lord:lady}. I am only trying to serve you to the best of my ability. Now, if at any time you find you have further need of me, I will be in the great hall arranging a smooth handover of the castle to your forces. ",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 7),
      (eq, "$g_talk_troop_met", 0),
      (str_store_party_name, s1, "$g_encountered_party"),
    ],
    "Good day, {reg63?sir:madam}. I do not believe I've seen you here before. Let me extend my welcome to you as the seneschal of {s1}.",
    "seneschal_intro_1",
    []],

  [plyr|anyone, "seneschal_intro_1",
    [],
    "A pleasure to meet you, {s65}.",
    "seneschal_intro_1a",
    []],

  [anyone, "seneschal_intro_1a",
    [],
    "How can I help you?",
    "seneschal_talk",
    []],

  [plyr|anyone, "seneschal_intro_1",
    [],
    "What exactly do you do here?",
    "seneschal_intro_1b",
    []],

  [anyone, "seneschal_intro_1b",
    [],
    "Ah, a seneschal's duties are many, good {reg63?sir:woman}. For example, I collect the rents from my lord's estates, I manage the castle's storerooms, I deal with the local peasantry, I take care of castle staff, I arrange supplies for the garrison... All mundane matters on this fief are my responsibility, on behalf of my lord. Everything except commanding the soldiers themselves.",
    "seneschal_talk",
    []],

  [anyone, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 7),
    ],
    "Good day, {reg63?sir:madam}.",
    "seneschal_talk",
    []],

  [anyone, "seneschal_pretalk",
    [],
    "Anything else?",
    "seneschal_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (eq, "$pop_teleport_player_to_pos59", 1),
      (call_script, "script_find_item_to_upgrade", "$g_pop_upgrade_troop"),
      (assign, "$pop_item", reg0),
      (assign, "$pop_item_slot", reg1),
      (neq, "$pop_item_slot", -1),
      (eq, "$pop_item", -1),
      (assign, "$pop_teleport_player_to_pos59", 0),
      (troop_get_inventory_slot, ":var0", "$g_pop_upgrade_troop", "$pop_item_slot"),
      (str_store_item_name_plural, s9, ":var0"),
    ],
    "You want to remove the {s9}, I see.^This will forfeit any costs we had in obtaining them.^Are you sure you want to do this, {reg63?Sir:Madam}?",
    "pop2_remove_equip_confirm",
    []],

  [plyr|anyone, "pop2_remove_equip_confirm",
    [],
    "Yes, it is necessary.",
    "pop2_war_room_menu",
    [
      (troop_set_inventory_slot, "$g_pop_upgrade_troop", "$pop_item_slot", -1),
      (try_begin),
        (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
        (assign, ":var0", "trp_player_knight_save"),
      (else_try),
        (assign, ":var0", "trp_player_sergeant_save"),
      (try_end),
      (troop_set_inventory_slot, ":var0", "$pop_item_slot", -1),
    ]],

  [plyr|anyone, "pop2_remove_equip_confirm",
    [],
    "No, I've changed my mind.",
    "pop2_war_room_menu",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (eq, "$pop_teleport_player_to_pos59", 1),
      (eq, "$pop_item", -2),
      (assign, "$pop_teleport_player_to_pos59", 0),
    ],
    "I am but a simple steward, please remove, replace or add one item at once. Shall we try again?",
    "pop2_war_room_menu",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (eq, "$pop_teleport_player_to_pos59", 1),
      (eq, "$pop_item_slot", -1),
      (assign, "$pop_teleport_player_to_pos59", 0),
    ],
    "No new equipment is needed, I see. Anything else?",
    "pop2_war_room_menu",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (eq, "$pop_teleport_player_to_pos59", 1),
      (call_script, "script_get_item_upgrade_cost_and_time", "$pop_item"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (str_store_item_name_plural, s10, "$pop_item"),
      (try_begin),
        (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
        (assign, ":var2", "trp_player_knight_save"),
      (else_try),
        (assign, ":var2", "trp_player_sergeant_save"),
      (try_end),
      (troop_get_inventory_slot, ":var3", ":var2", "$pop_item_slot"),
      (try_begin),
        (eq, ":var3", -1),
        (str_store_string, s2, "@purchase {s10}"),
      (else_try),
        (call_script, "script_get_item_upgrade_cost_and_time", ":var3"),
        (store_mul, ":var4", reg0, 9),
        (val_div, ":var4", 10),
        (store_sub, reg0, ":var0", ":var4"),
        (val_max, reg0, 1000),
        (store_mul, ":var5", reg1, 9),
        (val_div, ":var5", 10),
        (store_sub, reg1, ":var1", ":var5"),
        (val_max, reg1, 1),
        (str_store_item_name_plural, s9, ":var3"),
        (str_store_string, s2, "@replace the {s9} with {s10}"),
      (try_end),
      (store_troop_gold, ":var6", "trp_player"),
      (gt, reg0, ":var6"),
      (assign, "$pop_teleport_player_to_pos59", 0),
    ],
    "You want to {s2}, I see.^Unfortunately this will cost us {reg0} in gold and you don't have that much in the treasury.^Shall we look for something more affordable?",
    "pop2_war_room_menu",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (eq, "$pop_teleport_player_to_pos59", 1),
      (assign, "$pop_teleport_player_to_pos59", 0),
      (call_script, "script_get_item_upgrade_cost_and_time", "$pop_item"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (str_store_item_name_plural, s10, "$pop_item"),
      (try_begin),
        (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
        (assign, ":var2", "trp_player_knight_save"),
      (else_try),
        (assign, ":var2", "trp_player_sergeant_save"),
      (try_end),
      (troop_get_inventory_slot, ":var3", ":var2", "$pop_item_slot"),
      (try_begin),
        (eq, ":var3", -1),
        (str_store_string, s2, "@purchase {s10}"),
      (else_try),
        (call_script, "script_get_item_upgrade_cost_and_time", ":var3"),
        (store_mul, ":var4", reg0, 9),
        (val_div, ":var4", 10),
        (store_sub, reg0, ":var0", ":var4"),
        (val_max, reg0, 1000),
        (store_mul, ":var5", reg1, 9),
        (val_div, ":var5", 10),
        (store_sub, reg1, ":var1", ":var5"),
        (val_max, reg1, 1),
        (str_store_item_name_plural, s9, ":var3"),
        (str_store_string, s2, "@replace the {s9} with {s10}"),
      (try_end),
      (assign, "$temp", reg0),
      (assign, "$temp_2", reg1),
    ],
    "You want to {s2}, I see.^This will cost {reg0} in gold and will take {reg1} days.^Shall I notify the Order quartermaster?",
    "pop2_upgrade_equip_confirm",
    []],

  [plyr|anyone, "pop2_upgrade_equip_confirm",
    [],
    "Yes, give the order.",
    "pop2_war_room_menu",
    [
      (assign, ":var0", "$temp"),
      (assign, ":var1", "$temp_2"),
      (try_begin),
        (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
        (assign, "$g_pop_upgrade_knight_item", "$pop_item"),
        (assign, "$g_pop_upgrade_knight_slot", "$pop_item_slot"),
        (assign, "$g_pop_upgrade_knight_days", ":var1"),
      (else_try),
        (assign, "$g_pop_upgrade_squire_item", "$pop_item"),
        (assign, "$g_pop_upgrade_squire_slot", "$pop_item_slot"),
        (assign, "$g_pop_upgrade_squire_days", ":var1"),
      (try_end),
      (troop_remove_gold, "trp_player", ":var0"),
    ]],

  [plyr|anyone, "pop2_upgrade_equip_confirm",
    [],
    "No, I've changed my mind.",
    "pop2_war_room_menu",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (str_store_party_name, s9, "$current_town"),
      (eq, "$g_talk_troop_met", 0),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Good Day {playername}. Welcome to {s9}. I am the Seneschal of the town. When you are ready, I am at your service to manage this location.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (str_store_party_name, s9, "$current_town"),
      (eq, "$g_talk_troop_met", 0),
    ],
    "Good Day {playername}. Welcome to {s9}. I am the Seneschal of the town and serve the Lord here with day to day tasks. Perhaps one day, when you are a Lord of a fief, you will engage the services of your steward as well.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_seneschal", "trp_town_1_arena_master"),
      (str_store_party_name, s9, "$current_town"),
      (eq, "$g_talk_troop_met", 1),
    ],
    "Good Day My {reg63?Lord:Lady} {playername}. What may I do for you?",
    "steward_menu",
    []],

  [plyr|anyone, "steward_menu",
    [],
    "Thank you. That is all.",
    "close_window",
    []],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "I wish to go to the War room.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (is_between, "$current_town", "p_town_1", "p_castle_1"),
    ],
    "Let us hold a tournament.",
    "pop_diplomacy_menu_sub_tourney",
    []],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (val_mul, ":var0", 15),
      (assign, reg1, ":var0"),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", ":var0"),
    ],
    "Let us hold a great feast to raise the spirits of my men.",
    "castle_feast",
    []],

  [plyr|anyone, "steward_menu",
    [],
    "What news has reached your ears?",
    "steward_gossip",
    [
      (store_conversation_troop, ":var0"),
      (call_script, "script_random_rumor_talk", 5, ":var0"),
    ]],

  [anyone, "steward_gossip",
    [],
    "{s3}",
    "town_steward_gossip_talk",
    []],

  [plyr|anyone, "town_steward_gossip_talk",
    [],
    "Very good. Good-bye.",
    "close_window",
    []],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (store_current_day, ":var0"),
      (neg|party_slot_ge, "$current_town", 94, ":var0"),
    ],
    "Send your quartermaster to recruit from my surrounding villages for a month.",
    "steward_menu2",
    [
      (store_current_day, ":var0"),
      (val_add, ":var0", 30),
      (party_set_slot, "$current_town", 94, ":var0"),
      (try_for_range, ":var1", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 120, "$current_town"),
        (call_script, "script_update_volunteer_troops_in_village", ":var1"),
      (try_end),
    ]],

  [plyr|anyone, "steward_menu",
    [
      (eq, "$g_talk_troop_met", 1),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Give me a general report of this location.",
    "pop2_loc_status_center",
    []],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Tell me of your skills.",
    "steward_menu2",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (party_slot_eq, "$current_town", 295, 0),
      (party_get_slot, ":var0", "$current_town", 293),
      (call_script, "script_pop_check_steward_skills", ":var0"),
      (eq, reg0, 1),
    ],
    "I wish to schedule a training session with you to update your skill set.",
    "steward_menu3",
    [
      (party_set_slot, "$current_town", 295, 1),
    ]],

  [plyr|anyone, "steward_menu",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (party_slot_eq, "$current_town", 269, 1),
    ],
    "I wish you to close your current mine.",
    "mine_close_confirm",
    []],

  [plyr|anyone, "mine_close_confirm1",
    [],
    "Yes, close the mine.",
    "steward_menu2",
    [
      (call_script, "script_center_base_income_change", "$current_town", 269, 20),
    ]],

  [plyr|anyone, "mine_close_confirm1",
    [],
    "Perhaps we should reconsider.",
    "steward_menu2",
    []],

  [anyone, "steward_menu1",
    [],
    "Very well, my {reg63?Lord:Lady}. Let us go to the Great Hall.",
    "steward_menu",
    []],

  [anyone, "steward_menu2",
    [],
    "Very good, my {reg63?Lord:Lady}. Will there be anything else?",
    "steward_menu",
    []],

  [anyone, "mine_close_confirm",
    [
      (party_get_slot, ":var0", "$current_town", 291),
      (assign, reg9, ":var0"),
    ],
    "Closing the current mine will reduce our base income by {reg9}, but will allow us to send out prospectors that may find a more valuable site. Are you sure you wish to close the current mine?",
    "mine_close_confirm1",
    []],

  [anyone, "steward_menu3",
    [],
    "As you say my {reg63?Lord:Lady}. The arrangements for the training session have been made. May I be of any further assistance?",
    "steward_menu",
    []],

  [anyone, "castle_feast",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (val_mul, ":var0", 10),
      (assign, reg1, ":var0"),
    ],
    "Ah! Yes, my {reg63?Lord:Lady}, we can accomplish that for our troops. We can do that for {reg1} gold!",
    "castle_feast",
    []],

  [plyr|anyone, "castle_feast",
    [],
    "Very good... take {reg1} gold from my treasury!",
    "steward_menu2",
    [
      (troop_remove_gold, "trp_player", reg1),
      (call_script, "script_change_player_party_morale", 30),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_get_slot, ":var1", ":var0", 69),
        (val_div, ":var1", 10),
        (troop_set_slot, ":var0", 69, ":var1"),
      (try_end),
      (display_message, "@Your entire party is happier.", 0x50FF50),
    ]],

  [plyr|anyone, "castle_feast",
    [],
    "That is too expensive, we must do with hard cheese and stale bread.",
    "steward_menu2",
    []],

  [anyone, "pop_diplomacy_menu_sub_tourney",
    [],
    "Very well {reg63?Sir:Madame}! Just as a reminder, you must have a positive honor rating, and a fair amount of denars in order to hold a tournament. The event will take some days to set up - the more you spend, the longer it will take. How much shall we spend on preperations?",
    "pop_diplomacy_menu_sub_tourney_1",
    []],

  [plyr|anyone, "pop_diplomacy_menu_sub_tourney_1",
    [
      (party_slot_eq, "$current_town", 156, 0),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 5000),
      (ge, "$player_honor", 3),
    ],
    "A modest sum.. 5000 denars. (+1 Honor +5 Renown)",
    "steward_menu2",
    [
      (troop_remove_gold, "trp_player", 5000),
      (store_random_in_range, ":var0", 15, 20),
      (party_set_slot, "$current_town", 156, ":var0"),
      (assign, ":var1", 1),
      (call_script, "script_change_player_honor", ":var1"),
      (troop_get_slot, ":var2", "trp_player", 7),
      (val_add, ":var2", 5),
      (troop_set_slot, "trp_player", 7, ":var2"),
    ]],

  [plyr|anyone, "pop_diplomacy_menu_sub_tourney_1",
    [
      (party_slot_eq, "$current_town", 156, 0),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 5000),
      (ge, "$player_honor", 5),
    ],
    "We should have a Grand Tournament.. 10000 denars (+2 Honor +10 Renown +10 Prosperity)",
    "steward_menu2",
    [
      (troop_remove_gold, "trp_player", 10000),
      (store_random_in_range, ":var0", 20, 30),
      (party_set_slot, "$current_town", 156, ":var0"),
      (assign, ":var1", 2),
      (call_script, "script_change_player_honor", ":var1"),
      (troop_get_slot, ":var2", "trp_player", 7),
      (val_add, ":var2", 10),
      (troop_set_slot, "trp_player", 7, ":var2"),
      (party_get_slot, ":var3", "$current_town", 50),
      (val_add, ":var3", 10),
      (party_set_slot, "$current_town", 50, ":var3"),
    ]],

  [plyr|anyone, "pop_diplomacy_menu_sub_tourney_1",
    [
      (party_slot_eq, "$current_town", 156, 0),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 20000),
      (ge, "$player_honor", 10),
    ],
    "Spare no expense, 20000 denars! (+3 Honor +25 Renown +20 Prosperity, Base income raise of 1 to 10)",
    "steward_menu2",
    [
      (troop_remove_gold, "trp_player", 20000),
      (store_random_in_range, ":var0", 30, 45),
      (party_set_slot, "$current_town", 156, ":var0"),
      (assign, ":var1", 3),
      (call_script, "script_change_player_honor", ":var1"),
      (troop_get_slot, ":var2", "trp_player", 7),
      (val_add, ":var2", 25),
      (troop_set_slot, "trp_player", 7, ":var2"),
      (party_get_slot, ":var3", "$current_town", 50),
      (val_add, ":var3", 20),
      (party_set_slot, "$current_town", 50, ":var3"),
      (party_get_slot, ":var3", "$current_town", 290),
      (store_random_in_range, ":var4", 10, 50),
      (val_mod, ":var4", 5),
      (val_add, ":var3", ":var4"),
      (party_set_slot, "$current_town", 290, ":var3"),
    ]],

  [plyr|anyone, "pop_diplomacy_menu_sub_tourney_1",
    [],
    "Perhaps this is not the best idea right now, let us move on.",
    "steward_menu2",
    []],

  [anyone, "pop_change_color1",
    [],
    "Very well {reg63?sir:madame}, I shall call for the Artists.. please select your color.",
    "pop_change_color",
    []],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Buff",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 15785090),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Yellow",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16772864),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Violet",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 15631086),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Sea Shell Tan",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16774638),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Purple",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 9109759),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Turquoise",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 3200456),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Terra Cotta",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 14840411),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Teal",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 32896),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Sandy Brown",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16032864),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Tangerine",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 15893760),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Steel Blue",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 4620980),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Salmon",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16747625),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Spring Green",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 65407),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Black",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 0),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Dark Blue",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 13209),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Blue green",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 56797),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to White",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16777215),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Royal Blue",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 4286945),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Red-Violet",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 13047173),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Ravenstern Blue",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 6001381),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Empire Yellow",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16763904),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Sarleon Red",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 16711680),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to D'Shar Brown",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 12759680),
    ]],

  [plyr|anyone, "pop_change_color",
    [],
    "Change the color to Fierdsvain Green",
    "minister_pretalk",
    [
      (faction_set_color, "fac_player_supporters_faction", 245820),
    ]],

  [anyone, "pop_change_culture1",
    [],
    "{reg63?Sire:Madame}... are you sure you want to do this? The people...",
    "pop_change_culture_confirm",
    []],

  [plyr|anyone, "pop_change_culture_confirm",
    [],
    "Don't question my wisdom! Of course I am sure! This is for the best of the people!",
    "pop_change_culture2",
    []],

  [plyr|anyone, "pop_change_culture_confirm",
    [],
    "Hmmm... you are right, I may have been too rash. Let us discuss other issues.",
    "minister_pretalk",
    []],

  [anyone, "pop_change_culture2",
    [],
    "Very well {reg63?Sire:Madame}, I shall prepare the Chalice but there is a price to pay, and some of our people may become unhappy...",
    "pop_change_culture",
    [
      (troop_remove_gold, "trp_player", 300000),
      (call_script, "script_change_player_honor", -20),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (store_random_in_range, ":var2", 0, 10),
        (is_between, ":var2", 1, 8),
        (val_mul, ":var2", -1),
        (call_script, "script_change_player_relation_with_center", ":var0", ":var2"),
      (try_end),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_6"),
    ],
    "I take this Chalice as a symbol of my divine right, and declare that our culture will follow the Old Kings of Pendor.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_6"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_6"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_1"),
    ],
    "I take this Crown as a symbol of my divine right, and declare that our culture will follow the Kingdom of Sarleon.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_1"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_1"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_2"),
    ],
    "I take this Sword as a symbol of my divine right, and declare that our culture will follow the Kingdom of Ravenstern.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_2"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_2"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_4"),
    ],
    "I take this Axe as a symbol of my divine right, and declare that our culture will follow the Fierdsvain.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_4"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_4"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_3"),
    ],
    "I take this Bow as a symbol of my divine right, and declare that our culture will follow the D'Shar.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_3"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_3"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [plyr|anyone, "pop_change_culture",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 10),
      (neq, ":var0", "fac_culture_5"),
    ],
    "I take this Spear as a symbol of my divine right, and declare that our culture will follow the Empire.",
    "minister_pretalk",
    [
      (faction_set_slot, "fac_player_supporters_faction", 10, "fac_culture_5"),
      (faction_set_slot, "fac_player_faction", 10, "fac_culture_5"),
      (call_script, "script_initialize_faction_troop_types_player_kingdom_only"),
    ]],

  [anyone, "pop2_war_room_menu",
    [
      (party_slot_ge, "$current_town", 289, 1),
      (party_get_slot, ":var0", "$current_town", 289),
      (store_troop_faction, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "fac_player_faction"),
      (le, ":var2", -20),
      (str_store_faction_name, s16, ":var1"),
    ],
    "Terrible news, my {reg63?Lord:Lady}! The {s16} Order, appalled at your actions, decided to leave!",
    "pop2_order_goes_player",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (party_set_slot, "$current_town", 289, 0),
      (try_begin),
        (troop_slot_eq, "trp_player", 162, ":var0"),
        (troop_set_slot, "trp_player", 162, 0),
        (call_script, "script_change_player_honor", -10),
      (try_end),
    ]],

  [plyr|anyone, "pop2_order_goes_player",
    [],
    "I never trusted them anyway. Let's proceed with other business.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_order_goes_player",
    [],
    "Hmph, attacking their patrols might not have been a good idea. Well, too late now.",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_menu",
    [],
    "Very well my {reg63?Lord:Lady}, let us go to the War Room.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 500),
      (store_current_day, ":var1"),
      (party_get_slot, ":var2", "$current_town", 294),
      (val_add, ":var2", 14),
      (this_or_next|le, ":var2", ":var1"),
      (party_slot_eq, "$current_town", 294, 0),
    ],
    "We need to field an army. Prepare a Baggage Train immediately. (once per 14 game days)...",
    "steward_menu2",
    [
      (troop_remove_gold, "trp_player", 500),
      (troop_add_item, "trp_player", "itm_baggage_train", imod_plain),
      (store_current_day, ":var0"),
      (party_set_slot, "$current_town", 294, ":var0"),
    ]],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_eq, "$current_town", 274, 1),
      (try_begin),
        (party_slot_eq, "$current_town", 349, 0),
        (str_store_string, s15, "@Do NOT train garrison."),
      (else_try),
        (party_slot_eq, "$current_town", 349, 1),
        (str_store_string, s15, "@Start training garrison."),
      (try_end),
    ],
    "{s15}",
    "pop2_war_room_menu",
    [
      (try_begin),
        (party_slot_eq, "$current_town", 349, 0),
        (party_set_slot, "$current_town", 349, 1),
      (else_try),
        (party_slot_eq, "$current_town", 349, 1),
        (party_set_slot, "$current_town", 349, 0),
      (try_end),
    ]],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (faction_slot_ge, "fac_player_faction", 70, 1),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to view our noble recruits.",
    "pop2_war_room_noble_recruits",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_eq, "$current_town", 289, 0),
    ],
    "I want to create a chapter of a Knighthood Order...",
    "pop2_war_room_create_order",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (is_between, ":var0", "trp_dragon_knight", "trp_zombie"),
    ],
    "I want to induct my troops into a Knighthood Order...",
    "pop2_war_room_train_order_troops",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_eq, "$current_town", 289, "trp_player_knight"),
      (str_store_troop_name_plural, s1, "trp_player_knight"),
    ],
    "I want to improve the equipment of my {s1}.",
    "pop2_war_room_equip_player_order_troops",
    [
      (assign, "$g_pop_upgrade_troop", "trp_player_knight"),
    ]],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_eq, "$current_town", 289, "trp_player_knight"),
      (str_store_troop_name_plural, s1, "trp_player_sergeant"),
    ],
    "I want to improve the equipment of my {s1}.",
    "pop2_war_room_equip_player_order_troops",
    [
      (assign, "$g_pop_upgrade_troop", "trp_player_sergeant"),
    ]],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (gt, ":var0", 0),
      (str_store_troop_name_plural, s1, ":var0"),
    ],
    "I want to improve the quality of the {s1}.",
    "pop2_war_room_improve_troops",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_ge, "$current_town", 289, 1),
    ],
    "I want to dismantle the Knighthood Order that is established here.",
    "dismantle_ko_confirm",
    []],

  [anyone, "dismantle_ko_confirm",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (call_script, "script_get_knighthood_order_info", ":var0"),
      (str_store_troop_name, s14, ":var0"),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1", "p_village_1"),
        (party_slot_eq, ":var2", 7, "trp_player"),
        (party_slot_eq, ":var2", 289, ":var0"),
        (val_add, ":var1", 1),
      (try_end),
      (val_sub, ":var1", 1),
      (assign, reg8, ":var1"),
      (try_begin),
        (assign, reg7, 1),
        (eq, reg8, 1),
        (assign, reg7, 0),
      (try_end),
      (str_store_string, s15, "@{reg8?{reg8}:no} other {s14} order{reg7?s:} currently established, {reg63?m'Lord:m'Lady}"),
      (str_store_party_name, s16, "$current_town"),
      (assign, reg9, 0),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (assign, reg9, 1),
      (try_end),
    ],
    "You have {s15}. Are you sure you want to dismantle the {s14} order here {reg9?in:at} {s16}?",
    "dismantle_ko_confirm1",
    []],

  [plyr|anyone, "dismantle_ko_confirm1",
    [],
    "Yes, proceed with dismantling the {s14} order.",
    "pop2_war_room_menu",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (store_troop_faction, ":var1", ":var0"),
      (call_script, "script_change_rank_points_with_order", ":var1", -20),
      (call_script, "script_change_player_relation_with_faction", ":var1", -10),
      (party_set_slot, "$current_town", 289, 0),
    ]],

  [plyr|anyone, "dismantle_ko_confirm1",
    [],
    "No. Leave the {s14} order in place.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to transfer all my troops to the garrison.",
    "steward_menu2",
    [
      (party_clear, "p_temp_party"),
      (party_get_num_companion_stacks, ":var0", "p_main_party"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (neg|troop_is_hero, ":var2"),
        (party_stack_get_size, ":var3", "p_main_party", ":var1"),
        (party_add_members, "p_temp_party", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_main_party", ":var1"),
        (party_wound_members, "p_temp_party", ":var2", ":var4"),
        (party_remove_members, "p_main_party", ":var2", ":var3"),
      (try_end),
      (party_get_num_companion_stacks, ":var0", "p_temp_party"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_temp_party", ":var1"),
        (party_stack_get_size, ":var3", "p_temp_party", ":var1"),
        (party_add_members, "$g_encountered_party", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_temp_party", ":var1"),
        (party_wound_members, "$g_encountered_party", ":var2", ":var4"),
        (party_remove_members, "p_temp_party", ":var2", ":var3"),
      (try_end),
    ]],

  [plyr|anyone, "pop2_war_room_menu",
    [
      (party_slot_eq, "$current_town", 289, "trp_player_knight"),
      (str_store_troop_name_plural, s1, "trp_player_knight"),
    ],
    "I want to speak about recruits of the {s1}.",
    "pop37_male_female",
    []],

  [anyone, "pop37_male_female",
    [],
    "My {reg63?Lord:Lady}, what would you like to change?",
    "pop37_male_female_1",
    []],

  [plyr|anyone, "pop37_male_female_1",
    [],
    "The Order should accept only male knights.",
    "pop37_male_female_2",
    [
      (call_script, "script_select_cko_gender", "trp_player_knight", 0),
    ]],

  [plyr|anyone, "pop37_male_female_1",
    [],
    "The Order should accept only female knights.",
    "pop37_male_female_2",
    [
      (call_script, "script_select_cko_gender", "trp_player_knight", 2),
    ]],

  [plyr|anyone, "pop37_male_female_1",
    [],
    "The Order should accept only male sergeants.",
    "pop37_male_female_2",
    [
      (call_script, "script_select_cko_gender", "trp_player_sergeant", 0),
    ]],

  [plyr|anyone, "pop37_male_female_1",
    [],
    "The Order should accept only female sergeants.",
    "pop37_male_female_2",
    [
      (call_script, "script_select_cko_gender", "trp_player_sergeant", 2),
    ]],

  [plyr|anyone, "pop37_male_female_1",
    [],
    "I need more time to decide.",
    "pop2_war_room_menu",
    []],

  [anyone, "pop37_male_female_2",
    [],
    "It is done my {reg63?Lord:Lady}, The requirements of {s1} have been changed. ^In the meantime, what else can I do for you?",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_menu",
    [],
    "Let us adjourn to the great hall.",
    "steward_menu2",
    []],

  [anyone, "pop2_war_room_noble_recruits",
    [
      (faction_slot_eq, "fac_player_faction", 70, 0),
    ],
    "I'm sorry, {reg63?M'Lord:m'Lady}, but there are no Nobles wishing to join your court. Maybe we should wait for a week or so.^In the meantime, what else can I do for you?",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_noble_recruits",
    [
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (eq, ":var0", 0),
    ],
    "I'm sorry, {reg63?M'Lord:m'Lady}, but you have no place in your party to hire more Nobles. I'd suggest disposing of some of the rabble there, if I may be so bold.^In the meantime, what else can I do for you?",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_noble_recruits",
    [
      (party_slot_eq, "$current_town", 274, 0),
      (str_store_party_name, s9, "$current_town"),
    ],
    "I'm sorry, {reg63?M'Lord:m'Lady}, but we have no Training Grounds in {s9}. We should build one if you want to train your Nobles here.^In the meantime, what else can I do for you?",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_noble_recruits",
    [
      (faction_get_slot, reg1, "fac_player_faction", 70),
    ],
    "Very good, {reg63?M'Lord:m'Lady}. It takes 500 crowns for each Noble that you accept into your court. It also requires that you have a training ground present at this location. Each Noble can then be put onto the path to be trained into an elite defender of the realm, and the type of Noble will be based upon our culture. ^^There are {reg1} Nobles willing to join you.",
    "pop2_war_room_noble_recruits",
    []],

  [plyr|anyone, "pop2_war_room_noble_recruits",
    [
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (gt, ":var0", 0),
      (gt, "$players_kingdom", 0),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", 500),
      (party_slot_eq, "$current_town", 274, 1),
      (faction_slot_ge, "fac_player_faction", 70, 1),
      (faction_get_slot, ":var2", "$players_kingdom", 10),
      (try_begin),
        (eq, ":var2", "fac_culture_1"),
        (assign, ":var3", "trp_sarleon_nobleman"),
      (else_try),
        (eq, ":var2", "fac_culture_2"),
        (assign, ":var3", "trp_rav_nobleman"),
      (else_try),
        (eq, ":var2", "fac_culture_3"),
        (assign, ":var3", "trp_dshar_nobleman"),
      (else_try),
        (eq, ":var2", "fac_culture_4"),
        (assign, ":var3", "trp_fierd_noblewoman"),
      (else_try),
        (eq, ":var2", "fac_culture_5"),
        (assign, ":var3", "trp_empire_nobleman"),
      (else_try),
        (eq, ":var2", "fac_culture_6"),
        (assign, ":var3", "trp_pendor_nobleman"),
      (else_try),
        (assign, ":var3", "trp_farmer"),
      (try_end),
      (assign, reg20, ":var3"),
      (str_store_troop_name, s17, ":var3"),
    ],
    "Accept 1x {s17} into your court for 500 denars.",
    "pop2_war_room_noble_recruits",
    [
      (troop_remove_gold, "trp_player", 500),
      (faction_get_slot, ":var0", "fac_player_faction", 70),
      (val_sub, ":var0", 1),
      (faction_set_slot, "fac_player_faction", 70, ":var0"),
      (party_add_members, "p_main_party", reg20, 1),
    ]],

  [plyr|anyone, "pop2_war_room_noble_recruits",
    [
      (gt, "$players_kingdom", 0),
      (party_slot_eq, "$current_town", 274, 1),
      (faction_get_slot, ":var0", "fac_player_faction", 70),
      (ge, ":var0", 10),
      (party_get_free_companions_capacity, ":var1", "p_main_party"),
      (ge, ":var1", 10),
      (store_troop_gold, ":var2", "trp_player"),
      (ge, ":var2", 5000),
    ],
    "Accept 10x {s17} into your court for 5000 denars.",
    "pop2_war_room_noble_recruits",
    [
      (troop_remove_gold, "trp_player", 5000),
      (faction_get_slot, ":var0", "fac_player_faction", 70),
      (val_sub, ":var0", 10),
      (faction_set_slot, "fac_player_faction", 70, ":var0"),
      (party_add_members, "p_main_party", reg20, 10),
    ]],

  [plyr|anyone, "pop2_war_room_noble_recruits",
    [
      (gt, "$players_kingdom", 0),
      (party_slot_eq, "$current_town", 274, 1),
      (faction_get_slot, ":var0", "fac_player_faction", 70),
      (ge, ":var0", 2),
      (party_get_free_companions_capacity, ":var1", "p_main_party"),
      (ge, ":var1", 2),
      (store_troop_gold, ":var2", "trp_player"),
      (ge, ":var2", 1000),
      (try_begin),
        (gt, ":var0", ":var1"),
        (assign, ":var0", ":var1"),
      (try_end),
      (store_mul, ":var3", ":var0", 500),
      (try_begin),
        (lt, ":var2", ":var3"),
        (store_div, ":var0", ":var2", 500),
        (store_mul, ":var3", ":var0", 500),
      (try_end),
      (gt, ":var0", 0),
      (gt, ":var3", 0),
      (assign, reg40, ":var0"),
      (assign, reg41, ":var3"),
    ],
    "Accept {reg40}x {s17} into your court for {reg41} denars.",
    "pop2_war_room_noble_recruits",
    [
      (troop_remove_gold, "trp_player", reg41),
      (faction_get_slot, ":var0", "fac_player_faction", 70),
      (val_sub, ":var0", reg40),
      (faction_set_slot, "fac_player_faction", 70, ":var0"),
      (party_add_members, "p_main_party", reg20, reg40),
    ]],

  [plyr|anyone, "pop2_war_room_noble_recruits",
    [],
    "Return to the war-room discussion.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_noble_recruits",
    [],
    "Let's return to the Great Hall.",
    "steward_menu1",
    []],

  [anyone, "pop2_war_room_equip_player_order_troops",
    [
      (try_begin),
        (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
        (assign, ":var0", "$g_pop_upgrade_knight_days"),
        (assign, ":var1", "$g_pop_upgrade_knight_item"),
      (else_try),
        (assign, ":var0", "$g_pop_upgrade_squire_days"),
        (assign, ":var1", "$g_pop_upgrade_squire_item"),
      (try_end),
      (gt, ":var0", 0),
      (str_store_troop_name_plural, s1, "$g_pop_upgrade_troop"),
      (str_store_item_name_plural, s11, ":var1"),
      (assign, reg0, ":var0"),
    ],
    "I am sorry, {reg63?M'Lord:M'Lady}, your {s1} are already busy re-equipping with {s11} and will take about {reg0} more days to be ready. Let us wait for them to complete that task first.^Anything else?",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_equip_player_order_troops",
    [
      (str_store_troop_name_plural, s1, "$g_pop_upgrade_troop"),
    ],
    "{reg63?M'Lord:M'Lady}, how do you want to improve your {s1}?^I can send the quartermaster to purchase new horses, armor or weapons.",
    "pop2_war_room_equip_choose",
    []],

  [plyr|anyone, "pop2_war_room_equip_choose",
    [
      (str_store_troop_name_plural, s1, "$g_pop_upgrade_troop"),
    ],
    "I want to purchase new mounts for my {s1}.",
    "pop2_war_room_buy_horses",
    []],

  [plyr|anyone, "pop2_war_room_equip_choose",
    [
      (str_store_troop_name_plural, s1, "$g_pop_upgrade_troop"),
    ],
    "My {s1} certainly deserve better armor.",
    "pop2_war_room_buy_armor",
    []],

  [plyr|anyone, "pop2_war_room_equip_choose",
    [],
    "Better weapons, that's what we need right now.",
    "pop2_war_room_buy_weapons",
    []],

  [plyr|anyone, "pop2_war_room_equip_choose",
    [],
    "Never mind, let's get back to the War Room.",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_war_room_buy_horses",
    [],
    "Very well, {reg63?Sire:Madam}. Choose one of the horses on the right and drag it to replace the old one on the LEFTMOST troop.",
    "close_window",
    [
      (assign, "$g_pop_upgrade_type", 1),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
      (assign, "$menu_control", 0),
      (get_player_agent_no, ":var0"),
      (agent_get_position, pos59, ":var0"),
      (jump_to_menu, "mnu_upgrade_screen"),
      (finish_mission),
      (store_troop_gold, ":var1", "trp_player"),
      (store_troop_gold, ":var2", "trp_wardrobe"),
      (val_sub, ":var1", ":var2"),
      (troop_add_gold, "trp_wardrobe", ":var1"),
      (set_player_troop, "trp_wardrobe"),
    ]],

  [anyone, "pop2_war_room_buy_armor",
    [],
    "What type of armor did you have in mind, {reg63?Sire:Madam}?",
    "pop2_war_room_buy_armor_choice",
    []],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Exceptional body armor.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 13),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 7200),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Quality body armor.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 13),
      (assign, "$g_pop_upgrade_max_price", 7199),
      (assign, "$g_pop_upgrade_min_price", 3800),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Fine body armor.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 13),
      (assign, "$g_pop_upgrade_max_price", 3799),
      (assign, "$g_pop_upgrade_min_price", 750),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Affordable armor and clothes.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 13),
      (assign, "$g_pop_upgrade_max_price", 749),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Exceptional helms and caps.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 12),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1950),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Quality helms and caps.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 12),
      (assign, "$g_pop_upgrade_max_price", 1949),
      (assign, "$g_pop_upgrade_min_price", 1450),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Fine helms and caps.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 12),
      (assign, "$g_pop_upgrade_max_price", 1449),
      (assign, "$g_pop_upgrade_min_price", 625),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Affordable helms and caps.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 12),
      (assign, "$g_pop_upgrade_max_price", 624),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Boots and greaves.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 14),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_armor_choice",
    [],
    "Gloves and gauntlets.",
    "pop2_war_room_buy_armor_steward",
    [
      (assign, "$g_pop_upgrade_type", 15),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [anyone, "pop2_war_room_buy_armor_steward",
    [],
    "Very well, {reg63?Sire:Madam}. Choose one of the armor pieces on the right and drag it to replace the old one on the LEFTMOST troop.",
    "close_window",
    [
      (assign, "$menu_control", 0),
      (get_player_agent_no, ":var0"),
      (agent_get_position, pos59, ":var0"),
      (jump_to_menu, "mnu_upgrade_screen"),
      (finish_mission),
      (store_troop_gold, ":var1", "trp_player"),
      (store_troop_gold, ":var2", "trp_wardrobe"),
      (val_sub, ":var1", ":var2"),
      (troop_add_gold, "trp_wardrobe", ":var1"),
      (set_player_troop, "trp_wardrobe"),
    ]],

  [anyone, "pop2_war_room_buy_weapons",
    [],
    "What type of weapons did you have in mind, {reg63?Sire:Madam}?",
    "pop2_war_room_buy_weapons_choice",
    []],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Quality one-handed weapons.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 2),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 150),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "One-handed weapons.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 2),
      (assign, "$g_pop_upgrade_max_price", 150),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Two-handed weapons.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 3),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Polearms.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 4),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Durable shields.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 7),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 150),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Shields.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 7),
      (assign, "$g_pop_upgrade_max_price", 150),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Bows.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 8),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Arrows.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 5),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Crossbows.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 9),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Bolts.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 6),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Thrown weapons.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 10),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Muskets.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 17),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [plyr|anyone, "pop2_war_room_buy_weapons_choice",
    [],
    "Bullets.",
    "pop2_war_room_buy_weapons_steward",
    [
      (assign, "$g_pop_upgrade_type", 18),
      (assign, "$g_pop_upgrade_max_price", 10000000),
      (assign, "$g_pop_upgrade_min_price", 1),
    ]],

  [anyone, "pop2_war_room_buy_weapons_steward",
    [],
    "Very well, {reg63?Sire:Madam}. Choose one of weapons on the right and drag it to replace the old one on the LEFTMOST troop.",
    "close_window",
    [
      (assign, "$menu_control", 0),
      (get_player_agent_no, ":var0"),
      (agent_get_position, pos59, ":var0"),
      (jump_to_menu, "mnu_upgrade_screen"),
      (finish_mission),
      (store_troop_gold, ":var1", "trp_player"),
      (store_troop_gold, ":var2", "trp_wardrobe"),
      (val_sub, ":var1", ":var2"),
      (troop_add_gold, "trp_wardrobe", ":var1"),
      (set_player_troop, "trp_wardrobe"),
    ]],

  [anyone, "pop2_war_room_improve_troops",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (troop_get_slot, ":var1", ":var0", 162),
      (assign, reg29, 30),
      (assign, reg30, 10000),
      (try_for_range, ":var2", 0, ":var1"),
        (val_mul, reg29, 3),
        (val_div, reg29, 2),
        (val_mul, reg30, 2),
      (try_end),
    ],
    "{reg63?M'Lord:M'Lady}, for {reg30} gold and {reg29} Prestige you will raise your Honor Troops' Strength and Agility by 2 each, and increase all weapon proficiencies by 20.",
    "pop2_war_room_improve_troops_response",
    []],

  [plyr|anyone, "pop2_war_room_improve_troops_response",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (troop_get_slot, ":var1", "trp_player", 156),
      (troop_get_slot, ":var2", "trp_player", 7),
      (val_sub, ":var2", ":var1"),
      (ge, ":var2", reg29),
      (ge, ":var0", reg30),
      (party_get_slot, ":var3", "$current_town", 289),
      (gt, ":var3", 0),
      (str_store_troop_name_plural, s1, ":var3"),
    ],
    "Improve the {s1}.",
    "pop2_war_room_improve_troops_done",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (troop_get_slot, ":var1", ":var0", 162),
      (val_add, ":var1", 1),
      (troop_set_slot, ":var0", 162, ":var1"),
      (troop_remove_gold, "trp_player", reg30),
      (troop_raise_attribute, ":var0", ca_strength, 2),
      (troop_raise_attribute, ":var0", ca_agility, 2),
      (troop_raise_proficiency_linear, ":var0", wpt_one_handed_weapon, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_two_handed_weapon, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_polearm, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_crossbow, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_archery, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_throwing, 20),
      (troop_raise_proficiency_linear, ":var0", wpt_firearm, 20),
      (try_begin),
        (eq, ":var0", "trp_player_knight"),
        (call_script, "script_copy_complete_troop", "trp_player_knight", "trp_player_knight_save", 0),
      (try_end),
      (try_begin),
        (is_between, ":var0", 419, 426),
        (store_sub, ":var2", "trp_custom_knight_1_save", 419),
        (store_add, ":var3", ":var0", ":var2"),
        (call_script, "script_copy_complete_troop", ":var0", ":var3", 0),
      (try_end),
      (troop_get_slot, ":var4", "trp_player", 156),
      (val_add, ":var4", reg29),
      (troop_set_slot, "trp_player", 156, ":var4"),
    ]],

  [plyr|anyone, "pop2_war_room_improve_troops_response",
    [],
    "Return to the war-room discussion.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_improve_troops_response",
    [],
    "Let's return to the Great Hall.",
    "steward_menu1",
    []],

  [anyone, "pop2_war_room_improve_troops_done",
    [],
    "The training has been completed and their attributes and proficiencies raised!",
    "pop2_war_room_improve_troops",
    []],

  [anyone, "pop2_war_room_train_order_troops",
    [],
    "{s2}.",
    "pop2_war_room_train_order_troops",
    [
      (str_clear, s2),
      (troop_get_slot, ":var0", "trp_player", 156),
      (assign, reg4, "$player_honor"),
      (troop_get_slot, ":var1", "trp_player", 7),
      (val_sub, ":var1", ":var0"),
      (assign, reg29, ":var1"),
      (party_get_slot, ":var2", "$current_town", 289),
      (call_script, "script_get_knighthood_order_info", ":var2"),
      (store_sub, reg2, 450, "$player_honor"),
      (try_begin),
        (this_or_next|eq, ":var2", "trp_lady_valkyrie"),
        (this_or_next|eq, ":var2", "trp_falcon_knight"),
        (this_or_next|eq, ":var2", "trp_shadow_centurion"),
        (this_or_next|eq, ":var2", "trp_phoenix_knight"),
        (eq, ":var2", "trp_kraken_knight"),
        (val_mul, reg2, 130),
        (val_div, reg2, 100),
      (else_try),
        (this_or_next|eq, ":var2", "trp_lion_knight"),
        (this_or_next|eq, ":var2", "trp_ebony_gauntlet"),
        (this_or_next|eq, ":var2", "trp_silvermist_ranger"),
        (eq, ":var2", "trp_scorpion_assassin_knight"),
        (val_mul, reg2, 120),
        (val_div, reg2, 100),
      (else_try),
        (this_or_next|eq, ":var2", "trp_empire_immortal"),
        (this_or_next|eq, ":var2", "trp_dshar_windrider"),
        (this_or_next|eq, ":var2", "trp_griffon_knight"),
        (eq, ":var2", "trp_dawn_knight"),
        (val_mul, reg2, 110),
        (val_div, reg2, 100),
      (try_end),
      (store_sub, reg3, 280, "$player_honor"),
      (try_begin),
        (eq, ":var2", "trp_eventide_knight"),
        (val_mul, reg3, 150),
        (val_div, reg3, 100),
      (else_try),
        (this_or_next|eq, ":var2", "trp_griffon_knight"),
        (this_or_next|eq, ":var2", "trp_radiant_cross_knight"),
        (eq, ":var2", "trp_phoenix_knight"),
        (val_mul, reg3, 140),
        (val_div, reg3, 100),
      (else_try),
        (this_or_next|eq, ":var2", "trp_lion_knight"),
        (this_or_next|eq, ":var2", "trp_ebony_gauntlet"),
        (eq, ":var2", "trp_kraken_knight"),
        (val_mul, reg3, 130),
        (val_div, reg3, 100),
      (else_try),
        (this_or_next|eq, ":var2", "trp_lady_valkyrie"),
        (this_or_next|eq, ":var2", "trp_raven_spear_knight"),
        (eq, ":var2", "trp_dawn_knight"),
        (val_mul, reg3, 120),
        (val_div, reg3, 100),
      (else_try),
        (eq, ":var2", "trp_falcon_knight"),
        (val_mul, reg3, 110),
        (val_div, reg3, 100),
      (try_end),
      (try_begin),
        (eq, ":var2", "trp_player_knight"),
        (val_mul, reg2, 125),
        (val_div, reg2, 100),
        (val_mul, reg3, 125),
        (val_div, reg3, 100),
      (else_try),
        (store_troop_faction, ":var3", ":var2"),
        (store_relation, ":var4", "fac_player_supporters_faction", ":var3"),
        (store_sub, ":var5", 200, ":var4"),
        (val_div, ":var5", 2),
        (val_mul, reg2, ":var5"),
        (val_div, reg2, 100),
        (val_mul, reg3, ":var5"),
        (val_div, reg3, 100),
      (try_end),
      (val_div, reg2, 10),
      (val_clamp, reg2, 10, 46),
      (val_div, reg3, 6),
      (val_clamp, reg3, 4, 36),
      (str_store_string, s2, "@You can train a ^{s7}^and {s8}^You have {reg29} Prestige available and with an Honor of {reg4},^Knight Honor troops will cost {reg2} Prestige, while Sergeant troops will cost {reg3} Prestige."),
    ]],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (gt, ":var0", 0),
      (ge, reg29, reg2),
      (party_count_companions_of_type, ":var1", "p_main_party", reg21),
      (gt, ":var1", 0),
      (str_store_troop_name, s11, ":var0"),
      (str_store_troop_name, s12, reg21),
    ],
    "Train one {s12} to {s11}.",
    "pop2_war_room_train_order_troops",
    [
      (party_remove_members, "p_main_party", reg21, 1),
      (party_get_slot, ":var0", "$current_town", 289),
      (party_add_members, "p_main_party", ":var0", 1),
      (troop_get_slot, ":var1", "trp_player", 156),
      (val_add, ":var1", reg2),
      (troop_set_slot, "trp_player", 156, ":var1"),
    ]],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (gt, ":var0", 0),
      (party_count_companions_of_type, ":var1", "p_main_party", reg21),
      (gt, ":var1", 1),
      (store_mul, ":var2", reg2, ":var1"),
      (ge, reg29, ":var2"),
      (str_store_troop_name_plural, s11, ":var0"),
      (str_store_troop_name_by_count, s12, reg21, ":var1"),
      (assign, reg1, ":var1"),
    ],
    "Train all {reg1} {s12} to {s11}.",
    "pop2_war_room_train_order_troops",
    [
      (party_count_companions_of_type, ":var0", "p_main_party", reg21),
      (party_remove_members, "p_main_party", reg21, ":var0"),
      (party_get_slot, ":var1", "$current_town", 289),
      (party_add_members, "p_main_party", ":var1", ":var0"),
      (troop_get_slot, ":var2", "trp_player", 156),
      (store_mul, ":var3", reg2, ":var0"),
      (val_add, ":var2", ":var3"),
      (troop_set_slot, "trp_player", 156, ":var2"),
    ]],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (gt, ":var0", 0),
      (ge, reg29, reg3),
      (party_count_companions_of_type, ":var1", "p_main_party", reg22),
      (gt, ":var1", 0),
      (str_store_troop_name, s11, reg23),
      (str_store_troop_name, s12, reg22),
    ],
    "Train one {s12} to {s11}.",
    "pop2_war_room_train_order_troops",
    [
      (party_remove_members, "p_main_party", reg22, 1),
      (party_add_members, "p_main_party", reg23, 1),
      (troop_get_slot, ":var0", "trp_player", 156),
      (val_add, ":var0", reg3),
      (troop_set_slot, "trp_player", 156, ":var0"),
    ]],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [
      (party_get_slot, ":var0", "$current_town", 289),
      (gt, ":var0", 0),
      (party_count_companions_of_type, ":var1", "p_main_party", reg22),
      (gt, ":var1", 1),
      (store_mul, ":var2", reg3, ":var1"),
      (ge, reg29, ":var2"),
      (str_store_troop_name_plural, s11, reg23),
      (str_store_troop_name_by_count, s12, reg22, ":var1"),
      (assign, reg1, ":var1"),
    ],
    "Train all {reg1} {s12} to {s11}.",
    "pop2_war_room_train_order_troops",
    [
      (party_count_companions_of_type, ":var0", "p_main_party", reg22),
      (party_remove_members, "p_main_party", reg22, ":var0"),
      (party_add_members, "p_main_party", reg23, ":var0"),
      (troop_get_slot, ":var1", "trp_player", 156),
      (store_mul, ":var2", reg3, ":var0"),
      (val_add, ":var1", ":var2"),
      (troop_set_slot, "trp_player", 156, ":var1"),
    ]],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [],
    "Return to the war-room discussion.",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_train_order_troops",
    [],
    "Let's return to the Great Hall.",
    "steward_menu1",
    []],

  [anyone, "pop2_war_room_create_order",
    [],
    "Ah! Then let's see what options we have available. ^^Note that most knighthood orders require between 5 and 30 honor (-20 for Eventide) as well as 20000 to 30000 gold to create.^Also note that each order enables an upgrade from the specified troop.",
    "pop2_war_room_create_order",
    []],

  [repeat_for_troops|plyr|anyone, "pop2_war_room_create_order",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_dragon_knight", "trp_zombie"),
      (store_troop_faction, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "fac_player_faction"),
      (ge, ":var2", -10),
      (store_troop_gold, ":var3", "trp_player"),
      (assign, ":var4", 0),
      (try_begin),
        (this_or_next|eq, ":var0", "trp_ebony_gauntlet"),
        (this_or_next|eq, ":var0", "trp_shadow_centurion"),
        (this_or_next|eq, ":var0", "trp_silvermist_ranger"),
        (this_or_next|eq, ":var0", "trp_phoenix_knight"),
        (this_or_next|eq, ":var0", "trp_shadowwolves_knight"),
        (this_or_next|eq, ":var0", "trp_scorpion_assassin_knight"),
        (this_or_next|eq, ":var0", "trp_kraken_knight"),
        (eq, ":var0", "trp_player_knight"),
        (ge, ":var3", 20000),
        (assign, ":var4", 1),
      (else_try),
        (this_or_next|eq, ":var0", "trp_dragon_knight"),
        (this_or_next|eq, ":var0", "trp_empire_immortal"),
        (this_or_next|eq, ":var0", "trp_dshar_windrider"),
        (this_or_next|eq, ":var0", "trp_griffon_knight"),
        (this_or_next|eq, ":var0", "trp_falcon_knight"),
        (this_or_next|eq, ":var0", "trp_raven_spear_knight"),
        (this_or_next|eq, ":var0", "trp_radiant_cross_knight"),
        (this_or_next|eq, ":var0", "trp_clarion_ranger"),
        (eq, ":var0", "trp_dawn_knight"),
        (ge, ":var3", 25000),
        (assign, ":var4", 1),
      (else_try),
        (this_or_next|eq, ":var0", "trp_lion_knight"),
        (this_or_next|eq, ":var0", "trp_lady_valkyrie"),
        (eq, ":var0", "trp_eventide_knight"),
        (ge, ":var3", 30000),
        (assign, ":var4", 1),
      (try_end),
      (eq, ":var4", 1),
      (assign, ":var5", 5),
      (try_begin),
        (this_or_next|eq, ":var0", "trp_shadow_centurion"),
        (this_or_next|eq, ":var0", "trp_shadowwolves_knight"),
        (this_or_next|eq, ":var0", "trp_empire_immortal"),
        (this_or_next|eq, ":var0", "trp_dshar_windrider"),
        (this_or_next|eq, ":var0", "trp_clarion_ranger"),
        (this_or_next|eq, ":var0", "trp_lion_knight"),
        (eq, ":var0", "trp_lady_valkyrie"),
        (assign, ":var5", 10),
      (else_try),
        (this_or_next|eq, ":var0", "trp_phoenix_knight"),
        (this_or_next|eq, ":var0", "trp_kraken_knight"),
        (this_or_next|eq, ":var0", "trp_dragon_knight"),
        (eq, ":var0", "trp_falcon_knight"),
        (assign, ":var5", 15),
      (else_try),
        (this_or_next|eq, ":var0", "trp_radiant_cross_knight"),
        (this_or_next|eq, ":var0", "trp_silvermist_ranger"),
        (this_or_next|eq, ":var0", "trp_griffon_knight"),
        (eq, ":var0", "trp_dawn_knight"),
        (assign, ":var5", 20),
      (else_try),
        (eq, ":var0", "trp_player_knight"),
        (assign, ":var5", 30),
      (else_try),
        (eq, ":var0", "trp_eventide_knight"),
        (assign, ":var5", -20),
      (try_end),
      (assign, ":var6", 0),
      (try_begin),
        (neq, ":var0", "trp_eventide_knight"),
        (ge, "$player_honor", ":var5"),
        (assign, ":var6", 1),
      (else_try),
        (le, "$player_honor", ":var5"),
        (assign, ":var6", 1),
      (try_end),
      (eq, ":var6", 1),
      (assign, ":var7", 0),
      (store_faction_of_party, ":var8", "$current_town"),
      (try_begin),
        (eq, ":var0", "trp_dragon_knight"),
        (this_or_next|eq, ":var8", "fac_kingdom_2"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_2"),
        (eq, "$current_town", "p_town_13"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Dragon"),
      (else_try),
        (eq, ":var0", "trp_lion_knight"),
        (this_or_next|eq, ":var8", "fac_kingdom_1"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_1"),
        (eq, "$current_town", "p_town_6"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Lion"),
      (else_try),
        (eq, ":var0", "trp_empire_immortal"),
        (this_or_next|eq, ":var8", "fac_kingdom_5"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_5"),
        (eq, "$current_town", "p_town_5"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Immortals Chapter"),
      (else_try),
        (eq, ":var0", "trp_dshar_windrider"),
        (this_or_next|eq, ":var8", "fac_kingdom_3"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_3"),
        (eq, "$current_town", "p_town_10"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Windriders Chapter"),
      (else_try),
        (eq, ":var0", "trp_lady_valkyrie"),
        (this_or_next|eq, ":var8", "fac_kingdom_4"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_4"),
        (eq, "$current_town", "p_town_1"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Valkyrie Sisterhood"),
      (else_try),
        (eq, ":var0", "trp_griffon_knight"),
        (try_begin),
          (this_or_next|main_party_has_troop, "trp_kingdom_1_pretender"),
          (eq, "$background_answer_4", 24),
          (assign, ":var7", 1),
          (str_store_string, s9, "@Order of the Griffon"),
        (else_try),
          (eq, "$pop_kingdom", 1),
          (faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_6"),
          (faction_slot_eq, "fac_player_faction", 10, "fac_culture_6"),
          (player_has_item, "itm_qualis"),
          (assign, ":var7", 1),
          (str_store_string, s9, "@Order of the Griffon"),
        (try_end),
      (else_try),
        (eq, ":var0", "trp_falcon_knight"),
        (this_or_next|main_party_has_troop, "trp_kingdom_2_pretender"),
        (main_party_has_troop, "trp_npc_rayne"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Falcon"),
      (else_try),
        (eq, ":var0", "trp_raven_spear_knight"),
        (party_slot_eq, "p_town_9", 7, "trp_player"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Raven Spear"),
      (else_try),
        (eq, ":var0", "trp_radiant_cross_knight"),
        (party_slot_eq, "p_town_3", 7, "trp_player"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Radiant Cross"),
      (else_try),
        (eq, ":var0", "trp_clarion_ranger"),
        (this_or_next|eq, ":var8", "fac_kingdom_1"),
        (this_or_next|faction_slot_eq, "fac_player_supporters_faction", 10, "fac_culture_1"),
        (party_slot_eq, "p_town_4", 7, "trp_player"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Clarion Call"),
      (else_try),
        (eq, ":var0", "trp_dawn_knight"),
        (party_slot_eq, "p_town_2", 7, "trp_player"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Dawn"),
      (else_try),
        (eq, ":var0", "trp_ebony_gauntlet"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Ebony Gauntlet"),
      (else_try),
        (eq, ":var0", "trp_shadow_centurion"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Shadow Legion"),
      (else_try),
        (eq, ":var0", "trp_silvermist_ranger"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Silvermist Rangers"),
      (else_try),
        (eq, ":var0", "trp_eventide_knight"),
        (main_party_has_troop, "trp_npc_alistair"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of Eventide"),
      (else_try),
        (eq, ":var0", "trp_phoenix_knight"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Phoenix"),
      (else_try),
        (eq, ":var0", "trp_shadowwolves_knight"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Shadow Wolves"),
      (else_try),
        (eq, ":var0", "trp_scorpion_assassin_knight"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Scorpion Assassins"),
      (else_try),
        (eq, ":var0", "trp_kraken_knight"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_string, s9, "@Order of the Kraken Cultists"),
      (else_try),
        (eq, ":var0", "trp_player_knight"),
        (player_has_item, "itm_qualis"),
        (assign, ":var7", 1),
        (str_store_faction_name, s9, "fac_player_knights"),
      (try_end),
      (eq, ":var7", 1),
      (call_script, "script_get_knighthood_order_info", ":var0"),
      (str_store_troop_name, s8, reg21),
      (str_store_string, s7, "@{s9} (from {s8})"),
    ],
    "Create {s7}",
    "pop2_war_room_create_order_after",
    [
      (store_repeat_object, ":var0"),
      (try_begin),
        (this_or_next|eq, ":var0", "trp_ebony_gauntlet"),
        (this_or_next|eq, ":var0", "trp_shadow_centurion"),
        (this_or_next|eq, ":var0", "trp_silvermist_ranger"),
        (this_or_next|eq, ":var0", "trp_phoenix_knight"),
        (this_or_next|eq, ":var0", "trp_shadowwolves_knight"),
        (this_or_next|eq, ":var0", "trp_scorpion_assassin_knight"),
        (this_or_next|eq, ":var0", "trp_kraken_knight"),
        (eq, ":var0", "trp_player_knight"),
        (troop_remove_gold, "trp_player", 20000),
      (else_try),
        (this_or_next|eq, ":var0", "trp_dragon_knight"),
        (this_or_next|eq, ":var0", "trp_empire_immortal"),
        (this_or_next|eq, ":var0", "trp_dshar_windrider"),
        (this_or_next|eq, ":var0", "trp_griffon_knight"),
        (this_or_next|eq, ":var0", "trp_falcon_knight"),
        (this_or_next|eq, ":var0", "trp_raven_spear_knight"),
        (this_or_next|eq, ":var0", "trp_radiant_cross_knight"),
        (this_or_next|eq, ":var0", "trp_clarion_ranger"),
        (eq, ":var0", "trp_dawn_knight"),
        (troop_remove_gold, "trp_player", 25000),
      (else_try),
        (this_or_next|eq, ":var0", "trp_lion_knight"),
        (this_or_next|eq, ":var0", "trp_lady_valkyrie"),
        (eq, ":var0", "trp_eventide_knight"),
        (troop_remove_gold, "trp_player", 30000),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var0", "trp_ebony_gauntlet"),
        (this_or_next|eq, ":var0", "trp_shadow_centurion"),
        (this_or_next|eq, ":var0", "trp_silvermist_ranger"),
        (this_or_next|eq, ":var0", "trp_phoenix_knight"),
        (this_or_next|eq, ":var0", "trp_shadowwolves_knight"),
        (this_or_next|eq, ":var0", "trp_scorpion_assassin_knight"),
        (this_or_next|eq, ":var0", "trp_kraken_knight"),
        (eq, ":var0", "trp_player_knight"),
        (troop_remove_items, "trp_player", "itm_qualis", 1),
      (else_try),
        (eq, ":var0", "trp_griffon_knight"),
        (neg|main_party_has_troop, "trp_kingdom_1_pretender"),
        (neq, "$background_answer_4", 24),
        (troop_remove_items, "trp_player", "itm_qualis", 1),
      (try_end),
      (party_set_slot, "$current_town", 289, ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (call_script, "script_change_player_relation_with_faction", ":var1", 10),
      (call_script, "script_change_rank_points_with_order", ":var1", 20),
      (faction_get_slot, ":var2", ":var1", 100),
      (try_begin),
        (gt, ":var2", 0),
        (call_script, "script_change_player_relation_with_faction", ":var2", -20),
      (try_end),
      (faction_get_slot, ":var2", ":var1", 101),
      (try_begin),
        (gt, ":var2", 0),
        (call_script, "script_change_player_relation_with_faction", ":var2", -20),
      (try_end),
    ]],

  [plyr|anyone, "pop2_war_room_create_order",
    [],
    "Return to the war-room discussion..",
    "pop2_war_room_menu",
    []],

  [plyr|anyone, "pop2_war_room_create_order",
    [],
    "Let's return to the Great Hall.",
    "steward_menu2",
    []],

  [anyone, "pop2_war_room_create_order_after",
    [
      (party_slot_eq, "$current_town", 289, "trp_player_knight"),
      (eq, "$players_order_name_set", 0),
    ],
    "Excellent, my Liege. Since you founded the Order, it is your right to provide suitable names for it and its members.",
    "close_window",
    [
      (jump_to_menu, "mnu_auto_name_order"),
      (finish_mission),
      (assign, "$menu_control", -1),
    ]],

  [anyone, "pop2_war_room_create_order_after",
    [],
    "Excellent, my Liege. I will see to it personally.^Anything else?",
    "pop2_war_room_menu",
    []],

  [anyone, "pop2_loc_status_center",
    [
      (party_get_slot, reg52, "$current_town", 290),
      (party_get_slot, reg1, "$current_town", 291),
      (party_get_slot, reg2, "$current_town", 50),
      (ge, reg52, -900),
    ],
    "The Base income value here is {reg52}, and the current prosperity is {reg2}. In addition, the mineral value here is {reg1}.",
    "steward_menu",
    []],

  [plyr|anyone, "seneschal_talk",
    [
      (store_relation, ":var0", "fac_player_supporters_faction", "$g_encountered_party_faction"),
      (ge, ":var0", 0),
    ],
    "I would like to ask you a question...",
    "seneschal_ask_something",
    []],

  [plyr|anyone, "seneschal_talk",
    [
      (store_relation, ":var0", "fac_player_supporters_faction", "$g_encountered_party_faction"),
      (ge, ":var0", 0),
    ],
    "I wish to know more about someone...",
    "seneschal_ask_about_someone",
    []],

  [anyone, "seneschal_ask_about_someone",
    [],
    "Perhaps I may be able to help. Whom did you have in mind?",
    "seneschal_ask_about_someone_2",
    []],

  [plyr|anyone, "seneschal_ask_about_someone_2",
    [],
    "Never mind.",
    "seneschal_pretalk",
    []],

  [plyr|anyone, "seneschal_talk",
    [],
    "I must take my leave of you now. Farewell.",
    "close_window",
    []],

  [anyone, "seneschal_ask_something",
    [],
    "I'll do what I can to help, of course. What did you wish to ask?",
    "seneschal_ask_something_2",
    []],

  [plyr|anyone, "seneschal_ask_something_2",
    [],
    "Perhaps you know where to find someone...",
    "seneschal_ask_location",
    []],

  [anyone, "seneschal_ask_location",
    [],
    "Well, a man in my position does hear a lot of things. Of whom were you thinking?",
    "seneschal_ask_location_2",
    []],

  [repeat_for_troops|plyr|anyone, "seneschal_ask_location_2",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_heroes_end"),
      (store_troop_faction, ":var1", ":var0"),
      (eq, "$g_encountered_party_faction", ":var1"),
      (str_store_troop_name, s1, ":var0"),
    ],
    "{s1}",
    "seneschal_ask_location_3",
    [
      (store_repeat_object, "$hero_requested_to_learn_location"),
    ]],

  [plyr|anyone, "seneschal_ask_location_2",
    [],
    "Never mind.",
    "seneschal_pretalk",
    []],

  [anyone, "seneschal_ask_location_3",
    [
      (call_script, "script_get_information_about_troops_position", "$hero_requested_to_learn_location", 0),
    ],
    "{s1}",
    "seneschal_pretalk",
    []],

  [anyone, "start",
    [
      (eq, "$caravan_escort_state", 1),
      (eq, "$g_encountered_party", "$caravan_escort_party_id"),
      (le, "$talk_context", 2),
      (store_distance_to_party_from_party, reg0, "$caravan_escort_destination_town", "$caravan_escort_party_id"),
      (lt, reg0, 5),
      (str_store_party_name, s3, "$caravan_escort_destination_town"),
      (assign, reg3, "$caravan_escort_agreed_reward"),
    ],
    "There! I can see the walls of {s3} in the distance. We've made it safely. Here, take this purse of {reg3} denars, as I promised. I hope we can travel together again someday.",
    "close_window",
    [
      (assign, "$caravan_escort_state", 0),
      (call_script, "script_troop_add_gold", "trp_player", "$caravan_escort_agreed_reward"),
      (assign, reg4, "$caravan_escort_agreed_reward"),
      (val_mul, reg4, 1),
      (add_xp_as_reward, reg4),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$caravan_escort_state", 1),
      (eq, "$g_encountered_party", "$caravan_escort_party_id"),
      (eq, "$talk_context", 2),
    ],
    "We've made it this far... Is everything clear up ahead?",
    "talk_caravan_escort",
    []],

  [plyr|anyone, "talk_caravan_escort",
    [],
    "There might be bandits nearby. Stay close.",
    "talk_caravan_escort_2a",
    []],

  [anyone, "talk_caravan_escort_2a",
    [],
    "Trust me, {playername}, we're already staying as close to you as we can. Lead the way.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "talk_caravan_escort",
    [],
    "No sign of trouble, we can breathe easy.",
    "talk_caravan_escort_2b",
    []],

  [anyone, "talk_caravan_escort_2b",
    [],
    "I'll breathe easy when we reach {s1} and not a moment sooner. Let's keep moving.",
    "close_window",
    [
      (str_store_party_name, s1, "$caravan_escort_destination_town"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_type", 11),
      (party_slot_ge, "$g_encountered_party", 52, "$g_current_hours"),
    ],
    "What do you want? We paid our toll to you less than three days ago.",
    "merchant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_type", 11),
      (ge, "$g_encountered_party_relation", 0),
    ],
    "Hail, friend.",
    "merchant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_type", 11),
      (lt, "$g_encountered_party_relation", 0),
      (eq, "$g_encountered_party_faction", "fac_merchants"),
    ],
    "What do you want? We are but simple merchants, we've no quarrel with you, so leave us alone.",
    "merchant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_type", 11),
      (lt, "$g_encountered_party_relation", 0),
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s9, ":var0"),
    ],
    "Be warned, knave! This caravan is under the protection of {s9}. Step out of our way or you will face his fury!",
    "merchant_talk",
    []],

  [anyone, "start",
    [
      (party_slot_eq, "$g_encountered_party", 0, 11),
      (this_or_next|eq, "$talk_context", 2),
      (eq, "$talk_context", 0),
    ],
    "Yes? What do you want?",
    "merchant_talk",
    []],

  [anyone, "merchant_pretalk",
    [],
    "Anything else?",
    "merchant_talk",
    []],

  [plyr|anyone, "merchant_talk",
    [
      (le, "$talk_context", 2),
      (check_quest_active, "qst_cause_provocation"),
      (neg|check_quest_concluded, "qst_cause_provocation"),
      (quest_slot_eq, "qst_cause_provocation", 3, "$g_encountered_party_faction"),
      (quest_get_slot, ":var0", "qst_cause_provocation", 6),
      (store_troop_faction, ":var1", ":var0"),
      (str_store_faction_name, s17, ":var1"),
    ],
    "You are trespassing in the territory of the {s17}. I am confiscating this caravan and all its goods!",
    "caravan_start_war_quest_1",
    []],

  [anyone, "caravan_start_war_quest_1",
    [
      (quest_get_slot, ":var0", "qst_cause_provocation", 6),
      (store_troop_faction, ":var1", ":var0"),
      (str_store_faction_name, s17, ":var1"),
    ],
    "What? What nonsense is this? We are at peace with the {s17}, and are free to cross its lands!",
    "caravan_start_war_quest_2",
    []],

  [plyr|anyone, "caravan_start_war_quest_2",
    [],
    "We'll see about that! Defend yourselves!",
    "merchant_attack",
    []],

  [plyr|anyone, "caravan_start_war_quest_2",
    [],
    "Hmm. Maybe this was all a misunderstanding. Farewell.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "merchant_talk",
    [
      (le, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
    ],
    "I have an offer for you.",
    "merchant_talk_offer",
    []],

  [anyone, "merchant_talk_offer",
    [],
    "What is it?",
    "merchant_talk_offer_2",
    []],

  [plyr|anyone, "merchant_talk_offer_2",
    [
      (eq, "$talk_context", 2),
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
    ],
    "I can escort you to your destination for a price.",
    "caravan_offer_protection",
    []],

  [plyr|anyone, "merchant_talk_offer_2",
    [],
    "Nothing. Forget it",
    "merchant_pretalk",
    []],

  [plyr|anyone, "merchant_talk",
    [
      (check_quest_active, "qst_track_down_bandits"),
    ],
    "I am hunting a group of bandits with the following description... Have you seen them?",
    "merchant_bandit_information",
    []],

  [anyone, "merchant_bandit_information",
    [
      (call_script, "script_get_manhunt_information_to_s15", "qst_track_down_bandits"),
    ],
    "{s15}",
    "merchant_pretalk",
    []],

  [plyr|anyone, "merchant_talk",
    [
      (eq, "$talk_context", 2),
    ],
    "Tell me about your journey",
    "merchant_trip_explanation",
    []],

  [anyone, "merchant_trip_explanation",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 126),
      (party_get_slot, ":var1", "$g_encountered_party", 5),
      (str_store_party_name, s11, ":var0"),
      (str_store_party_name, s12, ":var1"),
      (str_store_string, s14, "str___we_believe_that_there_is_money_to_be_made_selling_"),
      (store_sub, ":var2", 301, "itm_spice"),
      (assign, ":var3", 0),
      (try_for_range, ":var4", "itm_spice", "itm_baggage_train"),
        (store_add, ":var5", ":var4", ":var2"),
        (party_get_slot, ":var6", ":var0", ":var5"),
        (party_get_slot, ":var7", ":var1", ":var5"),
        (gt, ":var7", ":var6"),
        (store_sub, ":var8", ":var7", ":var6"),
        (gt, ":var8", 200),
        (str_store_item_name, s15, ":var4"),
        (str_store_string, s14, "str_s14s15_"),
        (assign, ":var3", 1),
      (try_end),
      (try_begin),
        (eq, ":var3", 0),
        (str_store_string, s14, "str__we_carry_a_selection_of_goods_although_the_difference_in_prices_for_each_is_not_so_great_we_hope_to_make_a_profit_off_of_the_whole"),
      (else_try),
        (str_store_string, s14, "str_s14and_other_goods"),
      (try_end),
    ],
    "We are coming from {s11} and heading to {s12}.{s14}",
    "merchant_pretalk",
    []],

  [plyr|anyone, "merchant_talk",
    [
      (eq, "$talk_context", 2),
      (neg|party_slot_ge, "$g_encountered_party", 52, "$g_current_hours"),
    ],
    "I demand something from you!",
    "merchant_demand",
    []],

  [anyone, "merchant_demand",
    [
      (eq, "$talk_context", 2),
    ],
    "What do you want?",
    "merchant_demand_2",
    []],

  [plyr|anyone, "merchant_demand_2",
    [
      (neq, "$g_encountered_party_faction", "$players_kingdom"),
    ],
    "There is a toll for free passage here!",
    "merchant_demand_toll",
    []],

  [anyone, "merchant_demand_toll",
    [
      (gt, "$g_strength_ratio", 70),
      (store_div, reg6, "$g_ally_strength", 10),
      (val_add, reg6, 40),
      (assign, "$temp", reg6),
    ],
    "Please, I don't want any trouble. I can give you {reg6} denars, just let us go.",
    "merchant_demand_toll_2",
    []],

  [anyone, "merchant_demand_toll",
    [
      (store_div, reg6, "$g_ally_strength", 20),
      (val_add, reg6, 10),
      (assign, "$temp", reg6),
    ],
    "I don't want any trouble. I can give you {reg6} denars if you'll let us go.",
    "merchant_demand_toll_2",
    []],

  [plyr|anyone, "merchant_demand_toll_2",
    [],
    "Agreed, hand it over and you may go in peace.",
    "merchant_demand_toll_accept",
    []],

  [anyone, "merchant_demand_toll_accept",
    [
      (assign, reg6, "$temp"),
    ],
    "Very well then. Here's {reg6} denars. ",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_troop_add_gold", "trp_player", "$temp"),
      (store_add, ":var0", "$g_current_hours", 72),
      (party_set_slot, "$g_encountered_party", 52, ":var0"),
      (try_begin),
        (ge, "$g_encountered_party_relation", -5),
        (store_relation, ":var1", "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (try_begin),
          (gt, ":var1", 0),
          (val_sub, ":var1", 1),
        (try_end),
        (val_sub, ":var1", 1),
        (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var1"),
      (try_end),
      (call_script, "script_add_log_entry", 3, "trp_player", -1, -1, "$g_encountered_party_faction"),
      (assign, reg6, "$temp"),
      (call_script, "script_change_player_honor", -1),
    ]],

  [plyr|anyone, "merchant_demand_toll_2",
    [],
    "I changed my mind, I can't take your money.",
    "merchant_pretalk",
    []],

  [plyr|anyone, "merchant_demand_toll_2",
    [],
    "No, I want everything you have! [Attack]",
    "merchant_attack",
    []],

  [plyr|anyone, "merchant_demand_2",
    [
      (neq, "$g_encountered_party_faction", "$players_kingdom"),
    ],
    "Hand over your gold and valuables now!",
    "merchant_attack_begin",
    []],

  [plyr|anyone, "merchant_demand_2",
    [],
    "Nothing. Forget it.",
    "merchant_pretalk",
    []],

  [anyone, "merchant_attack_begin",
    [],
    "Are you robbing us?{s11}",
    "merchant_attack_verify",
    [
      (str_clear, s11),
      (try_begin),
        (faction_slot_ge, "$g_encountered_party_faction", 120, 1),
        (str_store_string, s11, "str__have_you_not_signed_a_truce_with_our_lord"),
      (try_end),
    ]],

  [plyr|anyone, "merchant_attack_verify",
    [],
    "Robbing you? No, no! It was a joke.",
    "merchant_attack_verify_norob",
    []],

  [anyone, "merchant_attack_verify_norob",
    [],
    "God, don't joke about that, {reg63?lad:lass}. For a moment I thought we were in real trouble.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "merchant_attack_verify",
    [],
    "Of course I'm robbing you. Now hand over your goods.",
    "merchant_attack",
    [
      (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
    ]],

  [anyone, "merchant_attack",
    [],
    "Damn you, you won't get anything from us without a fight!",
    "close_window",
    [
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (try_begin),
        (ge, ":var0", 0),
        (call_script, "script_change_player_honor", -3),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (val_sub, ":var0", 10),
      (try_end),
      (val_sub, ":var0", 5),
      (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
      (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
      (val_add, "$g_caravans_raided", 1),
    ]],

  [anyone, "caravan_offer_protection",
    [],
    "These roads are dangerous indeed. One can never have enough protection.",
    "caravan_offer_protection_2",
    [
      (get_party_ai_object, ":var0", "$g_encountered_party"),
      (store_distance_to_party_from_party, "$caravan_distance_to_target", ":var0", "$g_encountered_party"),
      (assign, "$caravan_escort_offer", "$caravan_distance_to_target"),
      (val_sub, "$caravan_escort_offer", 10),
      (call_script, "script_party_calculate_strength", "p_main_party", 0),
      (assign, ":var1", reg0),
      (val_min, ":var1", 450),
      (val_add, ":var1", 20),
      (val_mul, "$caravan_escort_offer", ":var1"),
      (val_div, "$caravan_escort_offer", 50),
      (val_max, "$caravan_escort_offer", 60),
    ]],

  [anyone, "caravan_offer_protection_2",
    [
      (lt, "$caravan_distance_to_target", 10),
    ],
    "An escort? We're almost there already! Thank you for the offer, though.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "caravan_offer_protection_2",
    [
      (get_party_ai_object, ":var0", "$g_encountered_party"),
      (str_store_party_name, s1, ":var0"),
      (assign, reg2, "$caravan_escort_offer"),
    ],
    "We are heading to {s1}. I will pay you {reg2} denars if you escort us there.",
    "caravan_offer_protection_3",
    []],

  [plyr|anyone, "caravan_offer_protection_3",
    [],
    "Agreed.",
    "caravan_offer_protection_4",
    []],

  [anyone, "caravan_offer_protection_4",
    [],
    "I want you to stay close to us along the way. We'll need your help if we get ambushed by bandits.",
    "caravan_offer_protection_5",
    []],

  [plyr|anyone, "caravan_offer_protection_5",
    [],
    "Don't worry, you can trust me.",
    "caravan_offer_protection_6",
    []],

  [anyone, "caravan_offer_protection_6",
    [
      (get_party_ai_object, ":var0", "$g_encountered_party"),
      (str_store_party_name, s1, ":var0"),
    ],
    "Good. Come and collect your money when we're within sight of {s1}. For now, let's just get underway.",
    "close_window",
    [
      (get_party_ai_object, ":var0", "$g_encountered_party"),
      (assign, "$caravan_escort_destination_town", ":var0"),
      (assign, "$caravan_escort_party_id", "$g_encountered_party"),
      (assign, "$caravan_escort_agreed_reward", "$caravan_escort_offer"),
      (assign, "$caravan_escort_state", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "caravan_offer_protection_3",
    [],
    "Forget it.",
    "caravan_offer_protection_4b",
    []],

  [anyone, "caravan_offer_protection_4b",
    [],
    "Perhaps another time, then.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "merchant_talk",
    [
      (eq, "$talk_context", 2),
      (lt, "$g_talk_troop_faction_relation", 0),
    ],
    "Not so fast. First, hand over all your goods and money.",
    "talk_caravan_enemy_2",
    []],

  [anyone, "talk_caravan_enemy_2",
    [],
    "Never. It is our duty to protect these goods. You shall have to fight us, brigand!",
    "close_window",
    [
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (val_min, ":var0", 0),
      (val_sub, ":var0", 4),
      (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
      (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
      (val_add, "$g_caravans_raided", 1),
    ]],

  [plyr|anyone, "merchant_talk",
    [],
    "Leave.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 51, "$g_talk_troop"),
      (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (party_slot_eq, "$g_encountered_party", 7, "trp_player"),
    ],
    "Good day, my {reg63?lord:lady}. Will you be visiting the prison?",
    "prison_guard_players",
    []],

  [plyr|anyone, "prison_guard_players",
    [],
    "Yes. Unlock the door.",
    "close_window",
    [
      (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
    ]],

  [plyr|anyone, "prison_guard_players",
    [],
    "No, not now.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 51, "$g_talk_troop"),
    ],
    "Yes? What do you want?",
    "prison_guard_talk",
    []],

  [plyr|anyone, "prison_guard_talk",
    [],
    "Who is imprisoned here?",
    "prison_guard_ask_prisoners",
    []],

  [plyr|anyone, "prison_guard_talk",
    [],
    "I want to speak with a prisoner.",
    "prison_guard_visit_prison",
    []],

  [anyone, "prison_guard_ask_prisoners",
    [],
    "Currently, {s50} {reg1?are:is} imprisoned here.{s49}",
    "prison_guard_talk",
    [
      (party_clear, "p_temp_party"),
      (party_clear, "p_temp_party_2"),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (party_get_num_prisoner_stacks, ":var2", "$g_encountered_party"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_prisoner_stack_get_troop_id, ":var4", "$g_encountered_party", ":var3"),
        (troop_is_hero, ":var4"),
        (try_begin),
          (call_script, "script_cf_prisoner_offered_parole", ":var4"),
          (party_add_members, "p_temp_party_2", ":var4", 1),
          (val_add, ":var1", 1),
        (else_try),
          (party_add_members, "p_temp_party", ":var4", 1),
          (val_add, ":var0", 1),
        (try_end),
      (try_end),
      (call_script, "script_print_party_members", "p_temp_party"),
      (str_store_string, s50, "str_s51"),
      (try_begin),
        (gt, ":var0", 1),
        (assign, reg1, 1),
      (else_try),
        (assign, reg1, 0),
      (try_end),
      (str_clear, s49),
      (try_begin),
        (ge, ":var1", 1),
        (call_script, "script_print_party_members", "p_temp_party_2"),
        (try_begin),
          (ge, ":var1", 2),
          (assign, reg2, 1),
        (else_try),
          (assign, reg2, 0),
        (try_end),
        (str_store_string, s49, "str__meanwhile_s51_reg2areis_being_held_in_the_castle_but_reg2havehas_made_pledges_not_to_escape_and_reg2areis_being_held_in_more_comfortable_quarters"),
      (try_end),
    ]],

  [anyone, "prison_guard_visit_prison",
    [
      (this_or_next|faction_slot_eq, "$g_encountered_party_faction", 8, "trp_player"),
      (this_or_next|party_slot_eq, "$g_encountered_party", 7, "trp_player"),
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
    ],
    "Of course, {reg63?sir:madam}. Go in.",
    "close_window",
    [
      (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
    ]],

  [anyone, "prison_guard_visit_prison",
    [
      (assign, ":var0", 0),
      (party_get_num_prisoner_stacks, ":var1", "$g_encountered_party"),
      (assign, ":var2", ":var1"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_prisoner_stack_get_troop_id, ":var4", "$g_encountered_party", ":var3"),
        (troop_is_hero, ":var4"),
        (try_begin),
          (call_script, "script_cf_prisoner_offered_parole", ":var4"),
        (else_try),
          (val_add, ":var0", 1),
          (assign, ":var2", 0),
        (try_end),
      (try_end),
      (ge, ":var0", 1),
    ],
    "You need to get permission from the lord to talk to prisoners.",
    "prison_guard_visit_prison_2",
    []],

  [anyone, "prison_guard_visit_prison",
    [],
    "There is nobody inside, therefore you can freely go inside and look around.",
    "prison_guard_visit_prison_nobody",
    []],

  [plyr|anyone, "prison_guard_visit_prison_nobody",
    [],
    "All right then. I'll take a look at the prison.",
    "close_window",
    [
      (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
    ]],

  [plyr|anyone, "prison_guard_visit_prison_nobody",
    [],
    "I have more important business to do.",
    "close_window",
    []],

  [plyr|anyone, "prison_guard_visit_prison_2",
    [],
    "All right then. I'll try that.",
    "close_window",
    []],

  [plyr|anyone, "prison_guard_visit_prison_2",
    [],
    "Come on now. I thought you were the boss here.",
    "prison_guard_visit_prison_3",
    []],

  [anyone, "prison_guard_visit_prison_3",
    [],
    "Heh-heh. You got that right. Still, I can't let you into the prison.",
    "prison_guard_visit_prison_4",
    []],

  [plyr|anyone, "prison_guard_visit_prison_4",
    [],
    "All right then. I'll leave now.",
    "close_window",
    []],

  [plyr|anyone, "prison_guard_visit_prison_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 100),
    ],
    "I found a purse with 100 denars a few paces away. I reckon it belongs to you.",
    "prison_guard_visit_prison_5",
    []],

  [anyone, "prison_guard_visit_prison_5",
    [],
    "Ah! I was looking for this all day. How good of you to bring it back {reg63?sir:madam}. Well, now that I know what an honest {reg63?man:lady} you are, there can be no harm in letting you inside for a look. Go in... Just so you know, though, I'll be hanging onto the keys, in case you were thinking about undoing anyone's chains.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", 100),
      (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
    ]],

  [plyr|anyone, "prison_guard_visit_prison_4",
    [],
    "Give me the keys to the cells -- now!",
    "prison_guard_visit_break",
    []],

  [anyone, "prison_guard_visit_break",
    [],
    "Help! Help! Prison break!",
    "close_window",
    [
      (call_script, "script_activate_town_guard"),
      (assign, "$g_main_attacker_agent", "$g_talk_agent"),
      (assign, "$talk_context", 18),
      (assign, ":var0", "trp_heroes_end"),
      (try_for_range, ":var1", "trp_npc_adonja", ":var0"),
        (troop_set_slot, ":var1", 149, 0),
      (try_end),
    ]],

  [plyr|anyone, "prison_guard_talk",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 52, "$g_talk_troop"),
      (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (party_slot_eq, "$g_encountered_party", 7, "trp_player"),
    ],
    "Your orders, {reg63?Lord:Lady}?",
    "castle_guard_players",
    []],

  [plyr|anyone, "castle_guard_players",
    [],
    "Open the door. I'll go in.",
    "close_window",
    [
      (call_script, "script_enter_court", "$current_town"),
    ]],

  [plyr|anyone, "castle_guard_players",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 52, "$g_talk_troop"),
      (eq, "$sneaked_into_town", 1),
      (gt, "$g_time_since_last_talk", 0),
    ],
    "Get out of my sight, beggar! You stink!",
    "castle_guard_sneaked_intro_1",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 52, "$g_talk_troop"),
      (eq, "$sneaked_into_town", 1),
    ],
    "Get lost before I lose my temper you vile beggar!",
    "close_window",
    []],

  [plyr|anyone, "castle_guard_sneaked_intro_1",
    [],
    "I want to enter the hall and speak to the lord.",
    "castle_guard_sneaked_intro_2",
    []],

  [plyr|anyone, "castle_guard_sneaked_intro_1",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "castle_guard_sneaked_intro_2",
    [],
    "Are you out of your mind, {reg63?man:woman}? Beggars are not allowed into the hall. Now get lost or I'll beat you bloody.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (faction_slot_eq, "$g_encountered_party_faction", 52, "$g_talk_troop"),
    ],
    "What do you want?",
    "castle_guard_intro_1",
    []],

  [plyr|anyone, "castle_guard_intro_1",
    [],
    "I want to enter the hall and speak to the lord.",
    "castle_guard_intro_2",
    []],

  [plyr|anyone, "castle_guard_intro_1",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "castle_guard_intro_2",
    [
      (faction_slot_eq, "$g_encountered_party_faction", 4, 6),
      (faction_slot_eq, "$g_encountered_party_faction", 5, "$current_town"),
      (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
      (neg|troop_slot_ge, "trp_player", 7, 50),
      (neg|troop_slot_ge, "trp_player", 7, 125),
      (neq, "$g_player_eligible_feast_center_no", "$current_town"),
      (neg|check_quest_active, "qst_wed_betrothed"),
      (neg|check_quest_active, "qst_wed_betrothed_female"),
      (neg|troop_slot_ge, "trp_player", 30, 1),
    ],
    "I'm afraid there is a feast in progress, and you are not invited.",
    "close_window",
    []],

  [anyone, "castle_guard_intro_2",
    [],
    "You can go in after leaving your weapons with me. No one is allowed to carry arms into the lord's hall.",
    "castle_guard_intro_3",
    []],

  [plyr|anyone, "castle_guard_intro_3",
    [],
    "Here, take my arms. I'll go in.",
    "close_window",
    [
      (call_script, "script_enter_court", "$current_town"),
    ]],

  [plyr|anyone, "castle_guard_intro_3",
    [],
    "No, I give my arms to no one.",
    "castle_guard_intro_2b",
    []],

  [anyone, "castle_guard_intro_2b",
    [],
    "Then you can't go in.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 3),
    ],
    "What do you want?",
    "castle_gate_guard_talk",
    []],

  [anyone, "castle_gate_guard_pretalk",
    [],
    "Yes?",
    "castle_gate_guard_talk",
    []],

  [plyr|anyone, "castle_gate_guard_talk",
    [
      (ge, "$g_encountered_party_relation", 0),
    ],
    "We need shelter for the night. Will you let us in?",
    "castle_gate_open",
    []],

  [plyr|anyone, "castle_gate_guard_talk",
    [
      (party_slot_ge, "$g_encountered_party", 7, 1),
    ],
    "I want to speak with the lord of the castle.",
    "request_meeting_castle_lord",
    []],

  [plyr|anyone, "castle_gate_guard_talk",
    [],
    "I want to speak with someone in the castle.",
    "request_meeting_other",
    []],

  [plyr|anyone, "castle_gate_guard_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "request_meeting_castle_lord",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (call_script, "script_get_troop_attached_party", ":var0"),
      (eq, "$g_encountered_party", reg0),
      (str_store_troop_name, s2, ":var0"),
      (assign, "$lord_requested_to_talk_to", ":var0"),
    ],
    "Wait here. {s2} will see you.",
    "close_window",
    []],

  [anyone, "request_meeting_castle_lord",
    [],
    "My lord is not here now.",
    "castle_gate_guard_pretalk",
    []],

  [anyone, "request_meeting_other",
    [],
    "Who is that?",
    "request_meeting_3",
    []],

  [repeat_for_troops|plyr|anyone, "request_meeting_3",
    [
      (store_repeat_object, ":var0"),
      (troop_is_hero, ":var0"),
      (troop_slot_eq, ":var0", 2, 2),
      (call_script, "script_get_troop_attached_party", ":var0"),
      (eq, "$g_encountered_party", reg0),
      (str_store_troop_name, s3, ":var0"),
    ],
    "{s3}",
    "request_meeting_4",
    [
      (store_repeat_object, "$lord_requested_to_talk_to"),
    ]],

  [plyr|anyone, "request_meeting_3",
    [],
    "Never mind.",
    "close_window",
    [
      (assign, "$lord_requested_to_talk_to", 0),
    ]],

  [anyone, "request_meeting_4",
    [],
    "Wait there. I'll send him your request.",
    "request_meeting_5",
    []],

  [plyr|anyone, "request_meeting_5",
    [],
    "I'm waiting...",
    "request_meeting_6",
    []],

  [anyone, "request_meeting_6",
    [
      (call_script, "script_troop_get_player_relation", "$lord_requested_to_talk_to"),
      (assign, ":var0", reg0),
      (gt, ":var0", -20),
    ],
    "All right. {s2} will talk to you now.",
    "close_window",
    [
      (str_store_troop_name, s2, "$lord_requested_to_talk_to"),
    ]],

  [anyone, "request_meeting_6",
    [
      (str_store_troop_name, s2, "$lord_requested_to_talk_to"),
    ],
    "{s2} says he will not see you. Begone now.",
    "close_window",
    []],

  [anyone, "castle_gate_open",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (call_script, "script_get_troop_attached_party", ":var0"),
      (eq, "$g_encountered_party", reg0),
      (ge, "$g_encountered_party_relation", 0),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (assign, ":var1", reg0),
      (ge, ":var1", 5),
      (str_store_troop_name, s2, ":var0"),
    ],
    "My lord {s2} will be happy to see you {reg63?sir:madam}. Come on in. I am opening the gates for you.",
    "close_window",
    [
      (assign, "$g_permitted_to_center", 1),
    ]],

  [anyone, "castle_gate_open",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (call_script, "script_get_troop_attached_party", ":var0"),
      (neq, "$g_encountered_party", reg0),
      (ge, "$g_encountered_party_relation", 0),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (assign, ":var1", reg0),
      (ge, ":var1", 5),
      (str_store_troop_name, s2, ":var0"),
    ],
    "My lord {s2} is not in the castle now. But I think he would approve of you taking shelter here. Come on in. I am opening the gates for you.",
    "close_window",
    [
      (assign, "$g_permitted_to_center", 1),
    ]],

  [anyone, "castle_gate_open",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (assign, ":var1", reg0),
      (ge, ":var1", -2),
    ],
    "Come on in. I am opening the gates for you.",
    "close_window",
    [
      (assign, "$g_permitted_to_center", 1),
    ]],

  [anyone, "castle_gate_open",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (assign, ":var1", reg0),
      (ge, ":var1", -19),
      (str_store_troop_name, s2, ":var0"),
    ],
    "Come on in. But make sure your men behave sensibly within the walls. My lord {s2} does not want trouble here.",
    "close_window",
    [
      (assign, "$g_permitted_to_center", 1),
    ]],

  [anyone, "castle_gate_open",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (str_store_troop_name, s2, ":var0"),
    ],
    "My lord {s2} does not want you here. Begone now.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 5),
    ],
    "You have come just in time. Let us join our forces now and teach our enemy a lesson.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 6),
    ],
    "You are making a big mistake by fighting against us.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (eq, "$g_talk_troop_met", 0),
      (ge, "$g_talk_troop_relation", 17),
    ],
    "I don't think we have met properly, my friend. You just saved my life out there, and I still don't know your name...",
    "ally_thanks_meet",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (eq, "$g_talk_troop_met", 0),
      (ge, "$g_talk_troop_relation", 5),
      (str_store_troop_name, s1, "$g_talk_troop"),
    ],
    "Your help was most welcome stranger. My name is {s1}. Can I learn yours?",
    "ally_thanks_meet",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (eq, "$g_talk_troop_met", 0),
      (ge, "$g_talk_troop_relation", 0),
      (str_store_troop_name, s1, "$g_talk_troop"),
    ],
    "Thanks for your help, stranger. We haven't met properly yet, have we? What is your name?",
    "ally_thanks_meet",
    []],

  [plyr|anyone, "ally_thanks_meet",
    [],
    "My name is {playername}.",
    "ally_thanks_meet_2",
    []],

  [anyone, "ally_thanks_meet_2",
    [
      (ge, "$g_talk_troop_relation", 15),
      (str_store_troop_name, s1, "$g_talk_troop"),
    ],
    "Well met indeed {playername}. My name is {s1} and I am forever in your debt. If there is ever anything I can help you with, just let me know...",
    "close_window",
    []],

  [anyone, "ally_thanks_meet_2",
    [
      (ge, "$g_talk_troop_relation", 5),
    ],
    "Well met {playername}. I am in your debt for what you just did. I hope one day I will find a way to repay it.",
    "close_window",
    []],

  [anyone, "ally_thanks_meet_2",
    [],
    "Well met {playername}. I am {s1}. Thanks for your help, and I hope we meet again.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (ge, "$g_talk_troop_relation", 30),
      (ge, "$g_relation_boost", 10),
    ],
    "Again you save our necks, {playername}! Truly, you are the best of friends. {s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_default"),
      (try_begin),
        (party_stack_get_troop_id, ":var0", "p_encountered_party_backup", 0),
        (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (call_script, "script_add_log_entry", 17, "trp_player", -1, ":var0", -1),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (ge, "$g_talk_troop_relation", 20),
      (ge, "$g_relation_boost", 5),
    ],
    "You arrived just in the nick of time! {playername}. You have my deepest thanks! {s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_default"),
      (call_script, "script_add_log_entry", 17, "trp_player", -1, "$g_talk_troop", -1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (ge, "$g_talk_troop_relation", 0),
      (ge, "$g_relation_boost", 3),
    ],
    "You turned up just in time, {playername}. I will not forget your help. {s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_default"),
      (call_script, "script_add_log_entry", 17, "trp_player", -1, "$g_talk_troop", -1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (ge, "$g_talk_troop_relation", -5),
    ],
    "Good to see you here, {playername}. {s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_default"),
      (call_script, "script_troop_change_relation_with_troop", "$g_talk_troop", "trp_player", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
      (ge, "$g_relation_boost", 4),
    ],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_grudging_default"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (troop_is_hero, "$g_talk_troop"),
    ],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_battle_won_unfriendly_default"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (ge, "$g_relation_boost", 10),
      (party_get_num_companions, reg42, "$g_encountered_party"),
      (val_sub, reg42, 1),
    ],
    "Thank you for your help, {reg63?sir:madam}. You saved {reg42?our lives:my life} out there.",
    "close_window",
    [
      (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var1", ":var0", 122),
        (eq, ":var1", "$g_encountered_party"),
        (call_script, "script_change_player_relation_with_center", ":var0", 1),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
      (ge, "$g_relation_boost", 5),
    ],
    "Thank you for your help {reg63?sir:madam}. Things didn't look very well for us but then you came up and everything changed.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 13),
    ],
    "Thank you for your help, {reg63?sir:madam}. It was fortunate to have you nearby.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 8),
      (store_conversation_troop, ":var0"),
      (eq, ":var0", "trp_kidnapped_girl"),
    ],
    "Oh {reg63?sir:madam}. Thank you so much for rescuing me. Will you take me to my family now?",
    "kidnapped_girl_liberated_battle",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 8),
    ],
    "I am in your debt for freeing me, friend.",
    "freed_hero_answer",
    []],

  [plyr|anyone, "freed_hero_answer",
    [],
    "You're not going anywhere. You'll be my prisoner now!",
    "freed_hero_answer_1",
    [
      (store_conversation_troop, ":var0"),
      (party_add_prisoners, "p_main_party", ":var0", 1),
    ]],

  [anyone, "freed_hero_answer_1",
    [],
    "Alas. Will my luck never change?",
    "close_window",
    []],

  [plyr|anyone, "freed_hero_answer",
    [],
    "You're free to go, {s65}.",
    "freed_hero_answer_2",
    []],

  [anyone, "freed_hero_answer_2",
    [],
    "Thank you, good {reg63?sir:lady}. I never forget someone who's done me a good turn.",
    "close_window",
    []],

  [plyr|anyone, "freed_hero_answer",
    [],
    "Would you like to join me?",
    "freed_hero_answer_3",
    []],

  [anyone, "freed_hero_answer_3",
    [
      (store_random_in_range, ":var0", 0, 2),
      (eq, ":var0", 0),
    ],
    "All right, I will join you.",
    "close_window",
    [
      (store_conversation_troop, ":var0"),
      (party_add_members, "p_main_party", ":var0", 1),
    ]],

  [anyone, "freed_hero_answer_3",
    [],
    "No, I want to go on my own.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 9),
    ],
    "You'll not live long to enjoy your victory. My kinsmen will soon wipe out the stain of this defeat.",
    "defeat_hero_answer",
    []],

  [plyr|anyone, "defeat_hero_answer",
    [],
    "You are my prisoner now.",
    "defeat_hero_answer_1",
    [
      (troop_set_slot, "$g_talk_troop", 8, "p_main_party"),
      (party_force_add_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_event_hero_taken_prisoner_by_player", "$g_talk_troop"),
    ]],

  [anyone, "defeat_hero_answer_1",
    [],
    "Damn you. You will regret this.",
    "close_window",
    []],

  [plyr|anyone, "defeat_hero_answer",
    [],
    "You're free to go this time, but don't cross my path again.",
    "defeat_hero_answer_2",
    []],

  [anyone, "defeat_hero_answer_2",
    [],
    "We will meet again.",
    "close_window",
    []],

  [anyone, "combined_political_quests",
    [
      (eq, "$political_quest_found", "qst_resolve_dispute"),
    ],
    "{s9}",
    "political_quest_suggested",
    [
      (quest_set_slot, "qst_resolve_dispute", 2, "$political_quest_target_troop"),
      (quest_set_slot, "qst_resolve_dispute", 4, "$political_quest_object_troop"),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (str_store_troop_name, s4, ":var0"),
      (str_store_troop_name, s5, ":var1"),
      (faction_get_slot, ":var2", "$players_kingdom", 11),
      (str_store_troop_name, s7, ":var2"),
      (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
        (str_store_string, s9, "str_you_may_be_aware_my_lord_of_the_quarrel_between_s4_and_s5_which_is_damaging_the_unity_of_this_realm_and_sapping_your_authority_if_you_could_persuade_the_lords_to_reconcile_it_would_boost_your_own_standing_however_in_taking_this_on_you_run_the_risk_of_one_the_lords_deciding_that_you_have_taken_the_rivals_side"),
      (else_try),
        (str_store_string, s9, "str_you_may_be_aware_my_lord_of_the_quarrel_between_s4_and_s5_which_is_damaging_the_unity_of_this_realm_and_sapping_your_authority_if_you_could_persuade_the_lords_to_reconcile_i_imagine_that_s7_would_be_most_pleased_however_in_taking_this_on_you_run_the_risk_of_one_the_lords_deciding_that_you_have_taken_the_rivals_side"),
      (try_end),
    ]],

  [anyone, "political_quest_follow_on",
    [
      (eq, "$political_quest_found", "qst_resolve_dispute"),
    ],
    "I think that is a wise move. Good luck to you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (setup_quest_text, "qst_resolve_dispute"),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (str_store_troop_name_link, s11, ":var0"),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (str_store_troop_name_link, s12, ":var1"),
      (str_store_string, s2, "str_resolve_the_dispute_between_s11_and_s12"),
      (call_script, "script_start_quest", "qst_resolve_dispute", -1),
      (quest_set_slot, "qst_resolve_dispute", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_resolve_dispute", 16, 0),
      (quest_set_slot, "qst_resolve_dispute", 17, 0),
      (quest_get_slot, ":var0", "qst_resolve_dispute", 2),
      (str_store_troop_name, s11, ":var0"),
      (quest_get_slot, ":var1", "qst_resolve_dispute", 4),
      (str_store_troop_name, s12, ":var1"),
    ]],

  [anyone, "combined_political_quests",
    [
      (eq, "$political_quest_found", "qst_offer_gift"),
      (quest_set_slot, "qst_offer_gift", 2, "$political_quest_target_troop"),
      (quest_get_slot, ":var0", "qst_offer_gift", 2),
      (str_store_troop_name, s4, ":var0"),
      (troop_get_type, reg4, ":var0"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var0", "$g_talk_troop"),
    ],
    "Your relations with {s4} are not all that they could be. As {reg4?she:he} is my {s11}, I can mediate to attempt to mend your quarrel. Perhaps the best way for me to do this would be to send {reg4?her:him} a gift -- a fur-trimmed velvet robe, perhaps. If you can provide me with a bolt of velvet and a length of furs, I can have one made and sent to {reg4?her:him.}",
    "political_quest_suggested",
    [
      (quest_get_slot, ":var0", "qst_offer_gift", 2),
      (troop_get_type, reg4, ":var0"),
    ]],

  [anyone, "political_quest_follow_on",
    [
      (eq, "$political_quest_found", "qst_offer_gift"),
    ],
    "Splendid. I shall await the materials.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (setup_quest_text, "qst_offer_gift"),
      (quest_get_slot, ":var0", "qst_offer_gift", 2),
      (str_store_troop_name, s14, ":var0"),
      (str_store_troop_name, s12, "$g_talk_troop"),
      (troop_get_type, reg4, "$g_talk_troop"),
      (str_store_string, s2, "str_you_intend_to_bring_gift_for_s14"),
      (call_script, "script_start_quest", "qst_offer_gift", "$g_talk_troop"),
    ]],

  [anyone, "combined_political_quests",
    [
      (eq, "$political_quest_found", "qst_denounce_lord"),
      (this_or_next|eq, "$g_talk_troop", "$g_player_minister"),
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
      (str_store_troop_name, s4, "$political_quest_target_troop"),
      (troop_get_type, reg4, "$political_quest_target_troop"),
      (str_store_faction_name, s5, "$players_kingdom"),
      (troop_get_slot, ":var0", "$political_quest_target_troop", 52),
      (val_add, ":var0", "str_lord_derogatory_default"),
      (str_store_string, s7, ":var0"),
      (troop_get_slot, ":var0", "$political_quest_target_troop", 52),
      (val_add, ":var0", "str_lord_derogatory_result"),
      (str_store_string, s8, ":var0"),
    ],
    "As you may realize, {s4} has many enemies among the lords of the {s5}. In particular, they feel that {reg4?she:he} is {s7}, and worry that {reg4?she:he} will {s8}. Were you to denounce {s4} to {reg4?her:his} face, you may reap much popularity -- although, of course, you would make an enemy of {reg4?her:him}, and risk being challenged to a duel.",
    "political_quest_suggested",
    []],

  [anyone, "combined_political_quests",
    [
      (eq, "$political_quest_found", "qst_denounce_lord"),
      (troop_get_type, reg4, "$political_quest_target_troop"),
      (str_clear, s9),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", "$g_talk_troop"),
      (assign, ":var0", reg0),
      (str_store_troop_name, s4, "$political_quest_target_troop"),
      (try_begin),
        (ge, ":var0", 2),
        (neg|troop_slot_eq, "$g_talk_troop", 52, 5),
        (neg|troop_slot_eq, "$g_talk_troop", 52, 2),
        (str_store_string, s9, "str_i_realize_that_you_are_on_good_terms_with_s4_but_we_ask_you_to_do_this_for_the_good_of_the_realm"),
      (else_try),
        (ge, ":var0", 2),
        (str_store_string, s9, "str_i_realize_that_you_are_on_good_terms_with_s4_but_the_blow_will_hurt_him_more"),
      (try_end),
      (str_store_faction_name, s5, "$players_kingdom"),
      (str_store_troop_name, s4, "$political_quest_target_troop"),
      (troop_get_slot, ":var1", "$political_quest_target_troop", 52),
      (val_add, ":var1", "str_lord_derogatory_default"),
      (str_store_string, s7, ":var1"),
      (troop_get_slot, ":var1", "$political_quest_target_troop", 52),
      (val_add, ":var1", "str_lord_derogatory_result"),
      (str_store_string, s8, ":var1"),
    ],
    "As you may realize, many of us in the peerage of the {s5} consider {s4} to be {s7}, and a liability to our cause. We worry that {reg4?she:he} will {s8}. People know my views on {s4} already, but if you were to denounce {reg4?her:him} to {reg4?her:his} face, you would further erode his standing -- and discourage our liege from entrusting {reg4?her:him} with any more power or responsibility. Of course, you would make an enemy of {reg4?her:him}, and risk being challenged to a duel.{s9}",
    "political_quest_suggested",
    []],

  [anyone, "political_quest_follow_on",
    [
      (eq, "$political_quest_found", "qst_denounce_lord"),
      (this_or_next|eq, "$g_talk_troop", "$g_player_minister"),
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "We appreciate what you are doing. I find such intrigues distasteful, but it is all for the good of the {s5}.",
    "close_window",
    [
      (quest_set_slot, "qst_denounce_lord", 2, "$political_quest_target_troop"),
      (quest_get_slot, ":var0", "qst_denounce_lord", 2),
      (str_store_troop_name_link, s14, ":var0"),
      (str_store_troop_name_link, s12, "$g_talk_troop"),
      (str_store_string, s2, "str_you_intend_to_denounce_s14_to_his_face_on_behalf_of_s14"),
      (setup_quest_text, "qst_denounce_lord"),
      (call_script, "script_start_quest", "$political_quest_found", "$g_talk_troop"),
      (str_store_faction_name, s5, "$players_kingdom"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "political_quest_follow_on",
    [
      (eq, "$political_quest_found", "qst_denounce_lord"),
    ],
    "Very well. It is always risky to involve yourself in intrigues of this sort, but in this case, I think you will benefit.",
    "close_window",
    [
      (quest_set_slot, "qst_denounce_lord", 2, "$political_quest_target_troop"),
      (quest_get_slot, ":var0", "qst_denounce_lord", 2),
      (str_store_troop_name_link, s14, ":var0"),
      (str_store_troop_name_link, s12, "$g_talk_troop"),
      (str_store_string, s2, "str_you_intend_to_denounce_s14_to_his_face_on_behalf_of_s14"),
      (setup_quest_text, "qst_denounce_lord"),
      (call_script, "script_start_quest", "$political_quest_found", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "combined_political_quests",
    [
      (eq, "$political_quest_found", "qst_intrigue_against_lord"),
      (str_store_troop_name, s4, "$political_quest_target_troop"),
      (troop_get_type, reg4, "$political_quest_target_troop"),
      (str_store_faction_name, s5, "$players_kingdom"),
      (troop_get_slot, ":var0", "$political_quest_target_troop", 52),
      (val_add, ":var0", "str_lord_derogatory_default"),
      (str_store_string, s7, ":var0"),
      (troop_get_slot, ":var1", "$political_quest_target_troop", 52),
      (val_add, ":var1", "str_lord_derogatory_result"),
      (str_store_string, s8, ":var1"),
      (faction_get_slot, ":var2", "$players_kingdom", 11),
      (str_store_troop_name, s9, ":var2"),
    ],
    "You and I have a common interest in seeking to curtail the rise of {s4}. I feel that {reg4?she:he} is {s7}, and worry that {reg4?she:he} will {s8}. Were you to tell our liege {s9} your opinion of {s4}, it might discourage {s9} from granting {s4} any further powers or responsibilities, at least for a while, and I would be much obliged to you.",
    "political_quest_suggested",
    []],

  [anyone, "political_quest_follow_on",
    [
      (eq, "$political_quest_found", "qst_intrigue_against_lord"),
      (str_store_faction_name, s5, "$players_kingdom"),
    ],
    "We appreciate what you are doing. I find such intrigues distasteful, but it is all for the good of the {s5}.",
    "close_window",
    [
      (quest_set_slot, "qst_intrigue_against_lord", 2, "$political_quest_target_troop"),
      (quest_get_slot, ":var0", "qst_intrigue_against_lord", 2),
      (store_troop_faction, ":var1", ":var0"),
      (faction_get_slot, ":var2", ":var1", 11),
      (str_store_troop_name_link, s14, ":var0"),
      (str_store_troop_name_link, s13, ":var2"),
      (str_store_troop_name_link, s12, "$g_talk_troop"),
      (str_store_string, s2, "str_you_intend_to_denounce_s14_to_s13_on_behalf_of_s12"),
      (setup_quest_text, "qst_intrigue_against_lord"),
      (call_script, "script_start_quest", "$political_quest_found", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "combined_political_quests",
    [],
    "I cannot think of anything right now, but we will have some items of mutual interest in the future.",
    "political_quest_suggested",
    []],

  [plyr|anyone, "political_quest_suggested",
    [
      (gt, "$political_quest_found", 0),
    ],
    "I like that idea.",
    "political_quest_follow_on",
    []],

  [plyr|anyone, "political_quest_suggested",
    [
      (gt, "$political_quest_found", 0),
    ],
    "Hmm ... Maybe you can think of something else?",
    "combined_political_quests",
    [
      (quest_set_slot, "$political_quest_found", 25, 3),
      (call_script, "script_get_political_quest", "$g_talk_troop"),
      (assign, "$political_quest_found", reg0),
      (assign, "$political_quest_target_troop", reg1),
      (assign, "$political_quest_object_troop", reg2),
    ]],

  [plyr|anyone, "political_quest_suggested",
    [],
    "Let us discuss another topic",
    "political_quests_end",
    []],

  [anyone, "political_quests_end",
    [
      (troop_slot_eq, "$g_talk_troop", 2, 2),
    ],
    "Very well.",
    "lord_pretalk",
    []],

  [anyone, "political_quests_end",
    [
      (troop_slot_eq, "trp_player", 30, "$g_talk_troop"),
    ],
    "Very well.",
    "spouse_pretalk",
    []],

  [anyone, "political_quests_end",
    [
      (eq, "$g_talk_troop", "$g_player_minister"),
    ],
    "Very well.",
    "minister_pretalk",
    []],

  [anyone, "political_quests_end",
    [],
    "Very well.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [trp_local_merchant, "start",
    [],
    "Mercy! Please don't kill me!",
    "local_merchant_mercy",
    []],

  [plyr|anyone, "local_merchant_mercy",
    [
      (quest_get_slot, ":var0", "qst_kill_local_merchant", 6),
      (str_store_troop_name, s2, ":var0"),
    ],
    "I have nothing against you, man. But {s2} wants you dead. Sorry.",
    "local_merchant_mercy_no",
    []],

  [anyone, "local_merchant_mercy_no",
    [],
    "Damn you! May you burn in Hell!",
    "close_window",
    []],

  [plyr|anyone, "local_merchant_mercy",
    [],
    "I'll let you live, if you promise me...",
    "local_merchant_mercy_yes",
    []],

  [anyone, "local_merchant_mercy_yes",
    [],
    "Of course, I promise, I'll do anything. Just spare my life... ",
    "local_merchant_mercy_yes_2",
    []],

  [plyr|anyone, "local_merchant_mercy_yes_2",
    [],
    "You are going to forget about {s2}'s debt to you. And you will sign a paper stating that he owes you nothing.",
    "local_merchant_mercy_yes_3",
    []],

  [anyone, "local_merchant_mercy_yes_3",
    [],
    "Yes, of course. I'll do as you say.",
    "local_merchant_mercy_yes_4",
    []],

  [plyr|anyone, "local_merchant_mercy_yes_4",
    [],
    "And if my lord hears so much of a hint of a complaint about this issue, then I'll come back for you, and it won't matter how much you scream for mercy then. Do you understand me?",
    "local_merchant_mercy_yes_5",
    []],

  [anyone, "local_merchant_mercy_yes_5",
    [],
    "Yes, {reg63?sir:madam}. Don't worry. I won't make any complaint.",
    "local_merchant_mercy_yes_6",
    []],

  [plyr|anyone, "local_merchant_mercy_yes_6",
    [],
    "Good. Go now, before I change my mind.",
    "close_window",
    [
      (quest_set_slot, "qst_kill_local_merchant", 11, 2),
      (call_script, "script_succeed_quest", "qst_kill_local_merchant"),
      (finish_mission),
    ]],

  [trp_fugitive, "start",
    [],
    "What do you want?",
    "fugitive_1",
    []],

  [plyr|trp_fugitive, "fugitive_1",
    [
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 13),
      (call_script, "script_get_name_from_dna_to_s50", ":var0"),
      (str_store_string, s4, s50),
    ],
    "I am looking for a murderer by the name of {s4}. You fit his description.",
    "fugitive_2",
    []],

  [plyr|trp_fugitive, "fugitive_1",
    [],
    "Nothing. Sorry to trouble you.",
    "close_window",
    []],

  [trp_fugitive, "fugitive_2",
    [],
    "I don't understand, {reg63?sir:madam}. I've never killed anyone. I think you've got the wrong man.",
    "fugitive_3",
    []],

  [plyr|trp_fugitive, "fugitive_3",
    [],
    "Then drop your sword. If you are innocent, you have nothing to fear. We'll go now and talk to your neighbours, and if they verify your story, I'll go on my way.",
    "fugitive_4",
    []],

  [anyone, "fugitive_4",
    [],
    "I'm not going anywhere, friend. You're going to have to fight for your silver today.",
    "fugitive_5",
    []],

  [plyr|trp_fugitive, "fugitive_5",
    [],
    "No problem. I really just need your head, anyway.",
    "fugitive_fight_start",
    []],

  [plyr|trp_fugitive, "fugitive_5",
    [],
    "I come not for money, but to execute the law!",
    "fugitive_fight_start",
    []],

  [plyr|trp_fugitive, "fugitive_5",
    [],
    "Alas, that you cannot be made to see reason.",
    "fugitive_fight_start",
    []],

  [anyone, "fugitive_fight_start",
    [],
    "Die, dog!",
    "close_window",
    [
      (set_party_battle_mode),
      (quest_set_slot, "qst_hunt_down_fugitive", 11, 1),
      (call_script, "script_activate_tavern_attackers"),
    ]],

  [anyone, "member_chat",
    [
      (check_quest_active, "qst_incriminate_loyal_commander"),
      (quest_slot_eq, "qst_incriminate_loyal_commander", 11, 0),
      (store_conversation_troop, "$g_talk_troop"),
      (eq, "$g_talk_troop", "$incriminate_quest_sacrificed_troop"),
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 1),
      (store_distance_to_party_from_party, ":var1", "p_main_party", ":var0"),
      (lt, ":var1", 10),
    ],
    "Yes {reg63?sir:madam}?",
    "sacrificed_messenger_1",
    []],

  [plyr|anyone, "sacrificed_messenger_1",
    [
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 1),
      (str_store_party_name, s1, ":var0"),
      (quest_get_slot, ":var1", "qst_incriminate_loyal_commander", 4),
      (str_store_troop_name, s2, ":var1"),
    ],
    "Take this letter to {s1} and give it to {s2}.",
    "sacrificed_messenger_2",
    []],

  [plyr|anyone, "sacrificed_messenger_1",
    [],
    "Nothing. Nothing at all.",
    "close_window",
    []],

  [anyone, "sacrificed_messenger_2",
    [],
    "Yes {reg63?sir:madam}. You can trust me. I will not fail you.",
    "sacrificed_messenger_3",
    []],

  [plyr|anyone, "sacrificed_messenger_3",
    [],
    "Good. I will not forget your service. You will be rewarded when you return.",
    "close_window",
    [
      (party_remove_members, "p_main_party", "$g_talk_troop", 1),
      (set_spawn_radius, 0),
      (spawn_around_party, "p_main_party", "pt_sacrificed_messenger"),
      (assign, ":var0", reg0),
      (party_add_members, ":var0", "$g_talk_troop", 1),
      (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
      (quest_get_slot, ":var1", "qst_incriminate_loyal_commander", 1),
      (party_set_ai_object, ":var0", ":var1"),
      (party_set_flags, ":var0", 65536, 0),
      (quest_set_slot, "qst_incriminate_loyal_commander", 11, 2),
      (quest_set_slot, "qst_incriminate_loyal_commander", 8, ":var0"),
    ]],

  [plyr|anyone, "sacrificed_messenger_3",
    [],
    "Arggh! I can't do this. I can't send you to your own death!",
    "sacrificed_messenger_cancel",
    []],

  [anyone, "sacrificed_messenger_cancel",
    [],
    "What do you mean {reg63?sir:madam}",
    "sacrificed_messenger_cancel_2",
    []],

  [plyr|anyone, "sacrificed_messenger_cancel_2",
    [
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 6),
      (str_store_troop_name, s3, ":var0"),
    ],
    "There's a trap set up for you in the town. {s3} ordered me to sacrifice one of my chosen warriors to fool the enemy, but he will just need to find another way.",
    "sacrificed_messenger_cancel_3",
    [
      (quest_get_slot, ":var0", "qst_incriminate_loyal_commander", 6),
      (quest_set_slot, "qst_incriminate_loyal_commander", 11, 1),
      (call_script, "script_change_player_relation_with_troop", ":var0", -5),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_fail_quest", "qst_incriminate_loyal_commander"),
    ]],

  [anyone, "sacrificed_messenger_cancel_3",
    [],
    "Thank you, {reg63?sir:madam}. I would follow you to the gates of hell, but this would not be a good death.",
    "close_window",
    []],

  [party_tpl|pt_sacrificed_messenger, "start",
    [],
    "Don't worry, {reg63?sir:madam}, I'm on my way.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_spy, "start",
    [],
    "Good day {reg63?sir:madam}. Such fine weather don't you think? If you'll excuse me now I must go on my way.",
    "follow_spy_talk",
    []],

  [plyr|anyone, "follow_spy_talk",
    [
      (quest_get_slot, ":var0", "qst_follow_spy", 6),
      (str_store_troop_name, s1, ":var0"),
    ],
    "In the name of {s1}, you are under arrest!",
    "follow_spy_talk_2",
    []],

  [anyone, "follow_spy_talk_2",
    [],
    "You won't get me alive!",
    "close_window",
    []],

  [plyr|anyone, "follow_spy_talk",
    [],
    "Never mind me. I was just passing by.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_spy_partners, "start",
    [],
    "Greetings.",
    "spy_partners_talk",
    []],

  [plyr|anyone, "spy_partners_talk",
    [
      (quest_get_slot, ":var0", "qst_follow_spy", 6),
      (str_store_troop_name, s1, ":var0"),
    ],
    "In the name of {s1} You are under arrest!",
    "spy_partners_talk_2",
    []],

  [anyone, "spy_partners_talk_2",
    [],
    "You will have to fight us first!",
    "close_window",
    []],

  [plyr|anyone, "spy_partners_talk",
    [],
    "Never mind me. I was just passing by.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_runaway_serfs, "start",
    [
      (party_slot_eq, "$g_encountered_party", 10, 0),
    ],
    "Good day {reg63?sir:madam}.",
    "runaway_serf_intro_1",
    [
      (party_set_slot, "$g_encountered_party", 10, 1),
    ]],

  [plyr|anyone, "runaway_serf_intro_1",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 6),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I have been sent by your {s4} whom you are running from. He will not punish you if you return now.",
    "runaway_serf_intro_2",
    []],

  [anyone, "runaway_serf_intro_2",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 1),
      (str_store_party_name, s6, ":var0"),
      (quest_get_slot, ":var1", "qst_bring_back_runaway_serfs", 7),
      (str_store_party_name, s1, ":var1"),
    ],
    "My good {reg63?sir:madam}. Our lives at our village {s1} was unbearable. We worked all day long and still went to bed hungry. We are going to {s6} to start a new life, where we will be treated like humans.",
    "runaway_serf_intro_3",
    []],

  [plyr|anyone, "runaway_serf_intro_3",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (str_store_party_name, s1, ":var0"),
    ],
    "You have gone against our laws by running from your bondage. You will go back to {s1} now!",
    "runaway_serf_go_back",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", -3),
    ]],

  [plyr|anyone, "runaway_serf_intro_3",
    [],
    "Well, maybe you are right. All right then. If anyone asks, I haven't seen you.",
    "runaway_serf_let_go",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", 2),
    ]],

  [party_tpl|pt_runaway_serfs, "runaway_serf_go_back",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (str_store_party_name, s5, ":var0"),
    ],
    "All right {reg63?sir:madam}. As you wish. We'll head back to {s5} now.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (party_set_ai_object, "$g_encountered_party", ":var0"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "runaway_serf_let_go",
    [],
    "God bless you, {reg63?sir:madam}. We will not forget your help.",
    "close_window",
    [
      (party_set_slot, "$g_encountered_party", 11, 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_runaway_serfs, "start",
    [
      (party_slot_eq, "$g_encountered_party", 11, 1),
    ],
    "Good day {reg63?sir:madam}. Don't worry. If anyone asks, we haven't seen you.",
    "runaway_serf_reconsider",
    []],

  [plyr|anyone, "runaway_serf_reconsider",
    [],
    "I have changed my mind. You must back to your village!",
    "runaway_serf_go_back",
    [
      (party_set_slot, "$g_encountered_party", 11, 0),
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", -5),
    ]],

  [plyr|anyone, "runaway_serf_reconsider",
    [],
    "Good. Go quickly now before I change my mind.",
    "runaway_serf_let_go",
    []],

  [party_tpl|pt_runaway_serfs, "start",
    [
      (party_slot_eq, "$g_encountered_party", 11, 0),
      (get_party_ai_object, ":var0"),
      (quest_get_slot, ":var1", "qst_bring_back_runaway_serfs", 7),
      (neq, ":var1", ":var0"),
    ],
    "Good day {reg63?sir:madam}. We were heading back to {s5}, but I am afraid we lost our way.",
    "runaway_serf_talk_caught",
    []],

  [plyr|anyone, "runaway_serf_talk_caught",
    [],
    "Do not test my patience. You are going back now!",
    "runaway_serf_go_back",
    []],

  [plyr|anyone, "runaway_serf_talk_caught",
    [],
    "Well, if you are that eager to go, then go.",
    "runaway_serf_let_go",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (call_script, "script_change_player_relation_with_center", ":var0", 1),
    ]],

  [party_tpl|pt_runaway_serfs, "start",
    [
      (quest_get_slot, ":var0", "qst_bring_back_runaway_serfs", 7),
      (str_store_party_name, s5, ":var0"),
    ],
    "We are on our way back to {s5} {reg63?sir:madam}.",
    "runaway_serf_talk_again_return",
    []],

  [plyr|anyone, "runaway_serf_talk_again_return",
    [],
    "Make haste now. The sooner you return the better.",
    "runaway_serf_talk_again_return_2",
    []],

  [plyr|anyone, "runaway_serf_talk_again_return",
    [],
    "Good. Keep going.",
    "runaway_serf_talk_again_return_2",
    []],

  [plyr|anyone, "runaway_serf_talk_again_return_2",
    [],
    "Yes {reg63?sir:madam}. As you wish.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (check_quest_active, "qst_track_down_bandits"),
      (quest_slot_eq, "qst_track_down_bandits", 8, "$g_encountered_party"),
      (neg|is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
    ],
    "This must be your unlucky day, mate. We're just about the worst people you could run into, in these parts.",
    "troublesome_bandits_intro_1",
    []],

  [plyr|anyone, "troublesome_bandits_intro_1",
    [],
    "Heh. For me, you are nothing more than walking money bags. A merchant in {s1} offered me good money for your heads.",
    "troublesome_bandits_intro_2",
    [
      (quest_get_slot, ":var0", "qst_track_down_bandits", 12),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "troublesome_bandits_intro_2",
    [],
    "A bounty hunter! Kill {reg63?him:her}! Kill {reg63?him:her} now!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_jatu_quest_army, "start",
    [
      (check_quest_active, "qst_marauding_jatu"),
      (quest_slot_eq, "qst_marauding_jatu", 8, "$g_encountered_party"),
    ],
    "We hunt for Noldor, and their god-cursed dwelling in the woods. Tell me all you know, now!",
    "marauding_jatu_intro_1",
    []],

  [plyr|party_tpl|pt_jatu_quest_army, "marauding_jatu_intro_1",
    [],
    "And we are hunting for you, thieving tribals. We'll cleanse the woods of your filth!",
    "marauding_jatu_intro_2",
    []],

  [party_tpl|pt_jatu_quest_army, "marauding_jatu_intro_2",
    [],
    "HAZAH Jatu! Prepare to Fight! Prepare to Die!",
    "close_window",
    [
      (play_sound, "snd_encounter_Jatu_prepare_2_die"),
      (encounter_attack),
    ]],

  [party_tpl|pt_deserters, "start",
    [
      (eq, "$talk_context", 2),
      (party_get_slot, ":var0", "$g_encountered_party", 3),
      (store_current_hours, ":var1"),
      (store_sub, ":var2", ":var0", ":var1"),
      (gt, ":var2", 0),
    ],
    "What do you want? You want to pay us some more money?",
    "deserter_paid_talk",
    []],

  [plyr|anyone, "deserter_paid_talk",
    [],
    "Sorry to trouble you. I'll be on my way now.",
    "deserter_paid_talk_2a",
    []],

  [anyone, "deserter_paid_talk_2a",
    [],
    "Yeah. Stop fooling around and go make some money. I want to see that purse full next time I see you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "deserter_paid_talk",
    [],
    "No. It's your turn to pay me this time.",
    "deserter_paid_talk_2b",
    []],

  [anyone, "deserter_paid_talk_2b",
    [],
    "What nonsense are you talking about? You want trouble? You got it.",
    "close_window",
    [
      (party_set_slot, "$g_encountered_party", 3, 0),
      (party_ignore_player, "$g_encountered_party", 0),
    ]],

  [party_tpl|pt_deserters, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "We are free warriors! We will fight only for ourselves, and to take what we want and when we want. Now give us your gold, or taste our steel.",
    "deserter_talk",
    []],

  [plyr|anyone, "deserter_talk",
    [],
    "When I'm done with you, you'll regret ever leaving your army.",
    "close_window",
    []],

  [plyr|anyone, "deserter_talk",
    [],
    "There's no need to fight. I am ready to pay for free passage.",
    "deserter_barter",
    []],

  [anyone, "deserter_barter",
    [],
    "Good. You are clever. Now, having a look at your baggage, I reckon a fellow like you could pretty easily afford {reg5} denars. We wouldn't want to be too greedy, now would we? Pay us, and then you can go.",
    "deserter_barter_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (troop_get_inventory_capacity, ":var1", "trp_player"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_get_inventory_slot, ":var3", "trp_player", ":var2"),
        (ge, ":var3", 0),
        (try_begin),
          (is_between, ":var3", "itm_spice", "itm_baggage_train"),
          (store_item_value, ":var4", ":var3"),
          (val_add, ":var0", ":var4"),
        (try_end),
      (try_end),
      (store_div, "$deserter_tribute", ":var0", 10),
      (val_max, "$deserter_tribute", 10),
      (assign, reg5, "$deserter_tribute"),
    ]],

  [plyr|anyone, "deserter_barter_2",
    [
      (store_troop_gold, reg2),
      (ge, reg2, "$deserter_tribute"),
      (assign, reg5, "$deserter_tribute"),
    ],
    "All right here's your {reg5} denars.",
    "deserter_barter_3a",
    [
      (troop_remove_gold, "trp_player", "$deserter_tribute"),
    ]],

  [plyr|anyone, "deserter_barter_2",
    [],
    "I don't have that much money with me",
    "deserter_barter_3b",
    []],

  [anyone, "deserter_barter_3b",
    [],
    "Too bad. Then we'll have to sell you to the slavers.",
    "close_window",
    []],

  [anyone, "deserter_barter_3a",
    [],
    "Heh. That wasn't difficult, now, was it? All right. Go now.",
    "close_window",
    [
      (store_current_hours, ":var0"),
      (val_add, ":var0", 72),
      (party_set_slot, "$g_encountered_party", 3, ":var0"),
      (party_ignore_player, "$g_encountered_party", 72),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (store_conversation_troop, reg1),
      (ge, reg1, "trp_town_1_tavernkeeper"),
      (lt, reg1, "trp_town_1_merchant"),
      (assign, reg45, 0),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ],
    "Good day dear {reg63?sir:madam}. How can I help you?",
    "tavernkeeper_talk",
    []],

  [anyone, "tavernkeeper_pretalk",
    [],
    "Anything else?",
    "tavernkeeper_talk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (quest_slot_eq, "qst_horse_armor", 11, 1),
      (quest_get_slot, ":var0", "qst_horse_armor", 1),
      (eq, "$current_town", ":var0"),
    ],
    "Do you know anyone who breeds war horses?",
    "tavernkeeper_talk_horse_armor_1",
    []],

  [anyone, "tavernkeeper_talk_horse_armor_1",
    [],
    "Hmm... many different people visit my tavern... it is, quite extraordinarily hard, to remember all of them... (the keeper cleans a mug, glancing at nearby denars on the bar)",
    "tavernkeeper_talk_horse_armor_2",
    []],

  [plyr|anyone, "tavernkeeper_talk_horse_armor_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 100),
    ],
    "Maybe few coins will improve your memory?",
    "tavernkeeper_talk_horse_armor_3",
    [
      (troop_remove_gold, "trp_player", 100),
    ]],

  [plyr|anyone, "tavernkeeper_talk_horse_armor_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", 100),
    ],
    "Maybe this blade will improve your memory?",
    "tavernkeeper_talk_horse_armor_3",
    []],

  [anyone, "tavernkeeper_talk_horse_armor_3",
    [],
    "Woah, woah, okay, okay! I know only one man... who breeds farm horses ...",
    "tavernkeeper_talk_horse_armor_4",
    []],

  [plyr|anyone, "tavernkeeper_talk_horse_armor_4",
    [],
    "'WAR', I said 'WAR' horses!",
    "tavernkeeper_talk_horse_armor_5",
    []],

  [anyone, "tavernkeeper_talk_horse_armor_5",
    [],
    "Oh... in that case I really don't know... maybe visit local market. It is quite crowded today and I'm sure someone may know something.",
    "tavernkeeper_pretalk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (val_mul, ":var0", 10),
      (assign, reg1, ":var0"),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", ":var0"),
    ],
    "I want to bring my lads here for ale and lively entertainment, so we can improve morale.",
    "tavernkeeper_feast",
    []],

  [anyone, "tavernkeeper_feast",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (val_mul, ":var0", 10),
      (assign, reg1, ":var0"),
    ],
    "I think we can do that for {reg1} gold!",
    "tavernkeeper_feast",
    []],

  [plyr|anyone, "tavernkeeper_feast",
    [],
    "Very good. Here is {reg1} gold.",
    "tavernkeeper_pretalk",
    [
      (troop_remove_gold, "trp_player", reg1),
      (call_script, "script_change_player_party_morale", 15),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_get_slot, ":var1", ":var0", 69),
        (val_div, ":var1", 4),
        (troop_set_slot, ":var0", 69, ":var1"),
      (try_end),
      (display_message, "@Your whole party is happier.", 0x50FF50),
    ]],

  [plyr|anyone, "tavernkeeper_feast",
    [],
    "That is too expensive, they can stay in the stables and drink water!",
    "tavernkeeper_pretalk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (check_quest_active, "qst_deliver_wine"),
      (quest_slot_eq, "qst_deliver_wine", 1, "$g_encountered_party"),
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 10),
      (store_item_kind_count, ":var2", ":var0"),
      (ge, ":var2", ":var1"),
      (assign, reg9, ":var1"),
      (str_store_item_name, s4, ":var0"),
    ],
    "I was told to deliver to you {reg9} units of {s4}.",
    "tavernkeeper_deliver_wine",
    []],

  [anyone, "tavernkeeper_deliver_wine",
    [],
    "At last! My stock was almost depleted. I had paid the cost of the {s4} in advance. Here, take these {reg5} denars. That should cover your pay. And give {s9} my regards. I'll put in a good word for you next time I deal with him.",
    "tavernkeeper_pretalk",
    [
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 10),
      (quest_get_slot, ":var2", "qst_deliver_wine", 22),
      (quest_get_slot, ":var3", "qst_deliver_wine", 6),
      (troop_remove_items, "trp_player", ":var0", ":var1"),
      (assign, reg5, ":var2"),
      (str_store_item_name, s4, ":var0"),
      (str_store_troop_name, s9, ":var3"),
      (quest_get_slot, ":var4", "qst_deliver_wine", 12),
      (call_script, "script_change_player_relation_with_center", ":var4", 2),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_finish_quest_simple", "qst_deliver_wine", 100),
    ]],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (check_quest_active, "qst_deliver_wine"),
      (quest_slot_eq, "qst_deliver_wine", 1, "$g_encountered_party"),
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 10),
      (store_item_kind_count, ":var2", ":var0"),
      (lt, ":var2", ":var1"),
      (gt, ":var2", 0),
      (assign, reg9, ":var1"),
      (str_store_item_name, s4, ":var0"),
    ],
    "I was told to deliver you {reg9} units of {s4}, but I lost some of the cargo on the way.",
    "tavernkeeper_deliver_wine_incomplete",
    []],

  [anyone, "tavernkeeper_deliver_wine_incomplete",
    [],
    "Attacked by bandits eh? You are lucky they left you alive. Anyway, I can pay you no more than {reg5} denars for this. And I will let {s1} know that my order was delivered less than completely, so you will probably be charged for this loss.",
    "tavernkeeper_pretalk",
    [
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 10),
      (quest_get_slot, ":var2", "qst_deliver_wine", 22),
      (quest_get_slot, ":var3", "qst_deliver_wine", 6),
      (store_item_kind_count, ":var4", ":var0"),
      (troop_remove_items, "trp_player", ":var0", ":var4"),
      (val_mul, ":var2", ":var4"),
      (val_div, ":var2", ":var1"),
      (call_script, "script_troop_add_gold", "trp_player", ":var2"),
      (assign, reg5, ":var2"),
      (assign, ":var5", ":var2"),
      (val_mul, ":var5", 4),
      (add_xp_as_reward, ":var5"),
      (str_store_troop_name, s1, ":var3"),
      (assign, ":var6", "$qst_deliver_wine_debt"),
      (store_sub, ":var7", ":var1", ":var4"),
      (val_mul, ":var6", ":var7"),
      (val_div, ":var6", ":var1"),
      (val_add, "$debt_to_merchants_guild", ":var6"),
      (quest_get_slot, ":var8", "qst_deliver_wine", 12),
      (call_script, "script_change_player_relation_with_center", ":var8", 1),
      (call_script, "script_end_quest", "qst_deliver_wine"),
    ]],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (check_quest_active, "qst_deliver_wine"),
      (quest_slot_eq, "qst_deliver_wine", 1, "$g_encountered_party"),
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (store_item_kind_count, ":var1", ":var0"),
      (eq, ":var1", 0),
      (quest_get_slot, reg9, "qst_deliver_wine", 10),
      (str_store_item_name, s4, ":var0"),
    ],
    "I was told to deliver you {reg9} units of {s4}, but I lost the cargo on the way.",
    "tavernkeeper_deliver_wine_lost",
    []],

  [anyone, "tavernkeeper_deliver_wine_lost",
    [],
    "What? I was waiting for that {s4} for weeks! And now you are telling me that you lost it? You may rest assured that I will let {s1} know about this.",
    "tavernkeeper_pretalk",
    [
      (add_xp_as_reward, 40),
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 6),
      (str_store_item_name, s4, ":var0"),
      (str_store_troop_name, s1, ":var1"),
      (val_add, "$debt_to_merchants_guild", "$qst_deliver_wine_debt"),
      (call_script, "script_end_quest", "qst_deliver_wine"),
    ]],

  [plyr|anyone, "tavernkeeper_talk",
    [],
    "What are people talking about in town?",
    "tavernkeeper_rumors",
    [
      (store_conversation_troop, ":var0"),
      (call_script, "script_random_rumor_talk", 1, ":var0"),
    ]],

  [anyone, "tavernkeeper_rumors",
    [],
    "{s3}",
    "bar_post_rumor",
    []],

  [plyr|anyone, "bar_post_rumor",
    [],
    "Very good, thank you.",
    "tavernkeeper_pretalk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (store_current_hours, ":var0"),
      (val_sub, ":var0", 24),
      (gt, ":var0", "$buy_drinks_last_time"),
    ],
    "I'd like to buy every man who comes in here tonight a jar of your best wine.",
    "tavernkeeper_buy_drinks",
    []],

  [anyone, "tavernkeeper_buy_drinks",
    [],
    "Of course, {reg63?my lord:my lady}. I reckon {reg5} denars should be enough for that. What should I tell the lads?",
    "tavernkeeper_buy_drinks_2",
    [
      (assign, "$temp", 1000),
      (assign, reg5, "$temp"),
    ]],

  [plyr|anyone, "tavernkeeper_buy_drinks_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$temp"),
      (str_store_party_name, s10, "$current_town"),
    ],
    "Let everyone know of the generosity of {playername} to the people of {s10}.",
    "tavernkeeper_buy_drinks_end",
    []],

  [anyone, "tavernkeeper_buy_drinks_end",
    [],
    "Don't worry {reg63?sir:madam}. Your name will be cheered and toasted here all night.",
    "tavernkeeper_pretalk",
    [
      (troop_remove_gold, "trp_player", "$temp"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (store_current_hours, ":var0"),
      (assign, "$buy_drinks_last_time", ":var0"),
    ]],

  [plyr|anyone, "tavernkeeper_buy_drinks_2",
    [],
    "Actually, cancel that order.",
    "tavernkeeper_pretalk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [
      (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
    ],
    "Have you heard of anyone in this realm who might have a job for a {reg63?man:woman} like myself? ",
    "tavernkeeper_job_ask",
    []],

  [anyone, "tavernkeeper_job_ask",
    [
      (eq, "$background_answer_3", 16),
      (eq, reg45, 0),
      (assign, ":var0", 0),
      (try_begin),
        (troop_has_item_equipped, "trp_player", "itm_lute"),
        (assign, ":var0", 1),
      (else_try),
        (troop_has_item_equipped, "trp_player", "itm_lyre"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
      (store_random_in_range, ":var1", 3, 103),
      (store_current_day, ":var2"),
      (assign, reg46, ":var1"),
      (store_sub, ":var3", ":var2", "$g_bard_job"),
      (assign, reg47, ":var3"),
      (try_begin),
        (lt, ":var1", 60),
        (gt, ":var3", 1),
        (assign, reg45, ":var1"),
        (store_random_in_range, ":var4", 1, 4),
        (try_begin),
          (eq, ":var4", 1),
          (str_store_string, s9, "str_cb5_s_bard_yes_1"),
        (else_try),
          (eq, ":var4", 2),
          (str_store_string, s9, "str_cb5_s_bard_yes_2"),
        (else_try),
          (eq, ":var4", 3),
          (str_store_string, s9, "str_cb5_s_bard_yes_3"),
        (try_end),
      (else_try),
        (str_store_string, s9, "str_cb5_s_bard_no"),
        (assign, reg45, 1),
      (try_end),
    ],
    "{s9} ",
    "tavern_bard_talk",
    []],

  [plyr|anyone, "tavern_bard_talk",
    [
      (gt, reg45, 1),
    ],
    "Yes, I will take the Job!.",
    "close_window",
    [
      (store_random_in_range, ":var0", 15, 40),
      (party_get_slot, ":var1", "$current_town", 50),
      (val_div, ":var1", 20),
      (store_skill_level, ":var2", skl_persuasion, "trp_player"),
      (val_add, ":var0", ":var1"),
      (store_mul, ":var3", ":var0", ":var2"),
      (val_add, ":var3", ":var1"),
      (troop_add_gold, "trp_player", ":var3"),
      (assign, reg1, ":var3"),
      (display_log_message, "@ You begin entertaining in the Tavern and receive {reg1} gold."),
      (store_div, ":var4", ":var2", 3),
      (call_script, "script_change_player_party_morale", ":var4"),
      (play_cue_track, "track_bard", 1),
      (store_current_day, ":var5"),
      (assign, "$g_bard_job", ":var5"),
      (assign, reg45, 0),
      (assign, "$g_leave_town", 1),
      (rest_for_hours, 3, 3, 0),
      (finish_mission),
    ]],

  [plyr|anyone, "tavern_bard_talk",
    [],
    "Not right now. I will be back!",
    "close_window",
    []],

  [plyr|anyone, "tavern_bard_talk",
    [
      (eq, reg45, 1),
    ],
    "Yes, please tell me.",
    "tavernkeeper_job_ask",
    []],

  [anyone, "tavernkeeper_job_ask",
    [
      (str_store_string, s9, "str__of_course_the_land_is_currently_at_peace_so_you_may_have_better_luck_in_other_realms"),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (store_relation, ":var1", "$g_encountered_party_faction", ":var0"),
        (lt, ":var1", 0),
        (str_clear, s9),
      (try_end),
      (faction_get_slot, ":var2", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s10, ":var2"),
    ],
    "Hmm... Well, {s10} is often looking for mercenaries to fight in his wars.{s9}",
    "tavernkeeper_job_search",
    [
      (assign, "$g_troop_list_no", 0),
    ]],

  [anyone, "tavernkeeper_job_search",
    [],
    "Let me think some more...",
    "tavernkeeper_job_result",
    [
      (call_script, "script_npc_find_quest_for_player_to_s11", "$g_encountered_party_faction"),
      (assign, ":var0", reg0),
      (call_script, "script_get_dynamic_quest", ":var0"),
      (assign, ":var1", reg0),
      (try_begin),
        (gt, ":var0", -1),
        (str_store_troop_name, s7, ":var0"),
        (str_clear, s9),
        (assign, ":var2", -1),
        (try_begin),
          (troop_slot_eq, ":var0", 2, 2),
          (troop_get_slot, ":var3", ":var0", 10),
          (party_is_active, ":var3"),
          (party_get_attached_to, ":var2", ":var3"),
        (else_try),
          (is_between, ":var0", "trp_town_1_mayor", "trp_village_1_elder"),
          (try_for_range, ":var4", "p_town_1", "p_castle_1"),
            (party_slot_eq, ":var4", 25, ":var0"),
            (assign, ":var2", ":var4"),
          (try_end),
        (try_end),
        (try_begin),
          (gt, ":var2", -1),
          (try_begin),
            (eq, ":var2", "$g_encountered_party"),
            (str_store_string, s8, "str_here"),
          (else_try),
            (str_store_string, s8, "str_over"),
          (try_end),
          (str_store_party_name, s12, ":var2"),
          (str_store_string, s9, "str_s8_in_s12"),
        (try_end),
        (try_begin),
          (eq, ":var1", "qst_track_down_bandits"),
          (str_store_string, s10, "str__has_put_together_a_bounty_on_some_bandits_who_have_been_attacking_travellers_in_the_area"),
        (else_try),
          (eq, ":var1", "qst_destroy_bandit_lair"),
          (str_store_string, s10, "str__has_been_worried_about_bandits_establishing_a_hideout_near_his_home"),
        (else_try),
          (eq, ":var1", "qst_retaliate_for_border_incident"),
          (str_store_string, s10, "str__is_looking_for_a_way_to_avoid_an_impending_war"),
        (else_try),
          (eq, ":var1", "qst_rescue_prisoner"),
          (str_store_string, s10, "str__may_need_help_rescuing_an_imprisoned_family_member"),
        (else_try),
          (eq, ":var1", "qst_cause_provocation"),
          (str_store_string, s10, "str__has_been_asking_around_for_someone_who_might_want_work_id_watch_yourself_with_him_though"),
        (else_try),
          (str_store_string, s10, "str_tavernkeeper_invalid_quest"),
        (try_end),
        (troop_get_type, reg4, ":var0"),
      (try_end),
    ]],

  [anyone, "tavernkeeper_job_result",
    [
      (store_sub, ":var0", "trp_village_1_elder", 1),
      (lt, "$g_troop_list_no", ":var0"),
    ],
    "I have heard that {s7} {s9}{s10} You may want to speak with {reg4?her:him}.",
    "tavernkeeper_job_search",
    []],

  [anyone, "tavernkeeper_job_result",
    [
      (store_sub, ":var0", "trp_village_1_elder", 1),
      (ge, "$g_troop_list_no", ":var0"),
    ],
    "There may be other work, of course -- lords and guildmasters often have other tasks which we don't hear about. Also, the villages around here frequently need help, although they'd be more likely to pay you with a wedge of cheese and goodwill than with cold hard denars.",
    "tavernkeeper_job_result_2",
    []],

  [anyone, "tavernkeeper_job_result_2",
    [],
    "I'll keep my ears open for other opportunities. You may want to ask again from time to time.",
    "close_window",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [],
    "Any news about invading armies?",
    "tavernkeeper_spawned_armies",
    []],

  [anyone, "tavernkeeper_spawned_armies",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", 2000),
    ],
    "Maybe, but you don't have enough gold to buy this type of information.",
    "close_window",
    []],

  [anyone, "tavernkeeper_spawned_armies",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 2000),
      (str_clear, s54),
      (assign, ":var1", 0),
      (try_for_parties, ":var2"),
        (party_get_template_id, ":var3", ":var2"),
        (this_or_next|is_between, ":var3", "pt_wolfbode", "pt_refugees"),
        (this_or_next|eq, ":var3", "pt_sea_raider_army"),
        (this_or_next|eq, ":var3", "pt_heretics_army"),
        (this_or_next|eq, ":var3", "pt_snake_cult_army"),
        (this_or_next|eq, ":var3", "pt_mystmountain_army"),
        (this_or_next|eq, ":var3", "pt_jatu_army"),
        (this_or_next|eq, ":var3", "pt_inquisition_army"),
        (eq, ":var3", "pt_peasant_army"),
        (assign, ":var4", "p_salt_mine"),
        (try_for_range, ":var5", "p_town_1", ":var4"),
          (assign, ":var6", 3),
          (try_begin),
            (is_currently_night),
            (assign, ":var6", 2),
          (try_end),
          (try_begin),
            (party_slot_eq, ":var5", 253, 1),
            (val_mul, ":var6", 2),
          (else_try),
            (neg|is_between, ":var5", "p_village_1", "p_salt_mine"),
            (val_add, ":var6", 1),
            (val_mul, ":var6", 2),
          (try_end),
          (store_distance_to_party_from_party, ":var7", ":var2", ":var5"),
          (le, ":var7", ":var6"),
          (val_add, ":var1", 1),
          (str_store_party_name, s52, ":var2"),
          (str_store_party_name, s53, ":var5"),
          (str_store_string, s54, "@{!}{s52} - {s53}^{s54}"),
          (assign, ":var4", ":var5"),
        (try_end),
      (try_end),
      (gt, ":var1", 0),
    ],
    "Yes, I have heard something interesting and could share it with you for ... a 2000 shiny gold pieces.",
    "tavernkeeper_spawned_armies_1",
    []],

  [anyone, "tavernkeeper_spawned_armies",
    [],
    "No, I haven't heard anything.",
    "close_window",
    []],

  [plyr|anyone, "tavernkeeper_spawned_armies_1",
    [],
    "That is way too much. Goodbye.",
    "close_window",
    []],

  [plyr|anyone, "tavernkeeper_spawned_armies_1",
    [],
    "You filthy ... here is your gold.",
    "tavernkeeper_spawned_armies_2",
    []],

  [anyone, "tavernkeeper_spawned_armies_2",
    [
      (troop_remove_gold, "trp_player", 2000),
    ],
    "Business is business. That is what have reached my ears:^ {s54}",
    "close_window",
    [
      (display_message, "@{s54}", 0xFF2222),
    ]],

  [plyr|anyone, "tavernkeeper_talk",
    [],
    "I am looking for supplies.",
    "tavernkeeper_supplies",
    [
      (assign, reg33, 0),
      (try_begin),
        (player_has_item, "itm_baggage_train"),
        (assign, reg33, 1),
      (else_try),
        (eq, reg33, 0),
        (try_for_range, ":var0", 737, "trp_town_1_arena_master"),
          (eq, reg33, 0),
          (troop_get_inventory_capacity, ":var1", ":var0"),
          (try_for_range, ":var2", 0, ":var1"),
            (troop_get_inventory_slot, ":var3", ":var0", ":var2"),
            (eq, ":var3", "itm_baggage_train"),
            (assign, reg33, 1),
            (assign, ":var1", 0),
          (try_end),
        (try_end),
        (eq, reg33, 0),
        (try_for_range, ":var4", "trp_town_1_armorer", 1060),
          (eq, reg33, 0),
          (troop_get_inventory_capacity, ":var1", ":var4"),
          (try_for_range, ":var5", 0, ":var1"),
            (troop_get_inventory_slot, ":var6", ":var4", ":var5"),
            (eq, ":var6", "itm_baggage_train"),
            (assign, reg33, 1),
            (assign, ":var1", 0),
          (try_end),
        (try_end),
        (eq, reg33, 0),
        (troop_get_inventory_capacity, ":var1", "trp_quigfen"),
        (try_for_range, ":var5", 0, ":var1"),
          (troop_get_inventory_slot, ":var6", "trp_quigfen", ":var5"),
          (eq, ":var6", "itm_baggage_train"),
          (assign, reg33, 1),
          (assign, ":var1", 0),
        (try_end),
        (eq, reg33, 0),
        (troop_get_inventory_capacity, ":var1", "trp_noldor_merchant"),
        (try_for_range, ":var5", 0, ":var1"),
          (troop_get_inventory_slot, ":var6", "trp_noldor_merchant", ":var5"),
          (eq, ":var6", "itm_baggage_train"),
          (assign, reg33, 1),
          (assign, ":var1", 0),
        (try_end),
        (eq, reg33, 0),
        (try_for_range, ":var4", 1195, 1198),
          (eq, reg33, 0),
          (troop_get_inventory_capacity, ":var1", ":var4"),
          (try_for_range, ":var5", 0, ":var1"),
            (troop_get_inventory_slot, ":var6", ":var4", ":var5"),
            (eq, ":var6", "itm_baggage_train"),
            (assign, reg33, 1),
            (assign, ":var1", 0),
          (try_end),
        (try_end),
        (eq, reg33, 0),
        (try_for_range, ":var4", 496, 499),
          (eq, reg33, 0),
          (troop_get_inventory_capacity, ":var1", ":var4"),
          (try_for_range, ":var5", 0, ":var1"),
            (troop_get_inventory_slot, ":var6", ":var4", ":var5"),
            (eq, ":var6", "itm_baggage_train"),
            (assign, reg33, 1),
            (assign, ":var1", 0),
          (try_end),
        (try_end),
      (try_end),
    ]],

  [anyone, "tavernkeeper_supplies",
    [
      (eq, reg33, 1),
    ],
    "Your party seems to already have enough supplies for a campaign. ^^^^^^(at least one Baggage Train already present in the game)",
    "tavernkeeper_pretalk",
    []],

  [anyone, "tavernkeeper_supplies",
    [
      (eq, reg33, 0),
      (store_item_kind_count, ":var0", "itm_loot"),
      (lt, ":var0", 2),
    ],
    "You will need more spoils of war, if you want to make a fair deal. ^^^^^^(requires 2x Various Loot)",
    "tavernkeeper_pretalk",
    []],

  [anyone, "tavernkeeper_supplies",
    [
      (eq, reg33, 0),
      (store_item_kind_count, ":var0", "itm_loot"),
      (ge, ":var0", 2),
    ],
    "We will get you the proper supplies. It will be shipped to you shortly. ^^^^^^(Baggage Train uses 2x Various Loot)",
    "tavernkeeper_supplies_1",
    []],

  [plyr|anyone, "tavernkeeper_supplies_1",
    [],
    "Very well.",
    "close_window",
    [
      (troop_remove_items, "trp_player", "itm_loot", 2),
      (troop_add_item, "trp_player", "itm_baggage_train", imod_plain),
    ]],

  [plyr|anyone, "tavernkeeper_supplies_1",
    [],
    "Maybe later.",
    "tavernkeeper_pretalk",
    []],

  [plyr|anyone, "tavernkeeper_talk",
    [],
    "I guess I should leave now.",
    "close_window",
    []],

  [trp_quigfen, "start",
    [
      (eq, "$g_talk_troop_met", 0),
    ],
    "Hail and well met M'{reg63?Lord:Lady}. To what do I owe your interest?",
    "quigfen_intro",
    [
      (troop_set_slot, "$g_talk_troop", 5, 1),
    ]],

  [trp_quigfen, "start",
    [
      (neg|check_quest_finished, "qst_marauding_jatu"),
      (neg|check_quest_active, "qst_marauding_jatu"),
      (quest_slot_eq, "qst_marauding_jatu", 11, 0),
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (ge, ":var0", 15),
    ],
    "You seem to wish to befriend the Noldor. However, you must prove your good intentions in order to gain their trust. There is a marauding Jatu army roaming the Laria woods, attacking Noldor patrols, searching for their hidden castle. If you can defeat it, the Noldor will be very grateful for your help. What do you say?",
    "quest_offered",
    [
      (quest_set_slot, "qst_marauding_jatu", 11, 1),
    ]],

  [trp_quigfen, "start",
    [
      (check_quest_active, "qst_marauding_jatu"),
      (check_quest_succeeded, "qst_marauding_jatu"),
    ],
    "My friends in the woods tell me you have destroyed the marauding Jatu! In addition to 3000 denars, you are now granted access to Elacrai, the hidden Noldor castle on the north shore of the lake in the woods of Laria.",
    "response_success",
    [
      (call_script, "script_troop_add_gold", "trp_player", 3000),
      (add_xp_as_reward, 5000),
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (val_add, ":var0", 15),
      (val_max, ":var0", 30),
      (quest_set_slot, "qst_marauding_jatu", 11, 3),
      (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", ":var0"),
      (call_script, "script_change_troop_renown", "trp_player", 20),
      (call_script, "script_end_quest", "qst_marauding_jatu"),
    ]],

  [plyr|trp_quigfen, "response_success",
    [],
    "I'm glad to have been of assistance and will surely look for the castle.",
    "quigfen_process_1",
    []],

  [plyr|trp_quigfen, "quest_offered",
    [],
    "Very well. I will destroy the Jatu army.",
    "quest_taken",
    [
      (set_spawn_radius, 7),
      (spawn_around_party, "p_noldor_elves_spawn_point", "pt_jatu_quest_army"),
      (quest_set_slot, "qst_marauding_jatu", 8, reg0),
      (setup_quest_text, "qst_marauding_jatu"),
      (str_store_string, s2, "@Quigfen of Laria asked you to destroy the marauding Jatu army in the Laria woods."),
      (call_script, "script_start_quest", "qst_marauding_jatu", "$g_talk_troop"),
    ]],

  [trp_quigfen, "quest_taken",
    [],
    "Very good. Remember that the Noldor have unique ways of expressing gratitude.",
    "close_window",
    [
      (quest_set_slot, "qst_marauding_jatu", 11, 2),
    ]],

  [plyr|trp_quigfen, "quest_offered",
    [],
    "Sorry. I don't have time for this right now.",
    "quigfen_process_1",
    []],

  [trp_quigfen, "start",
    [
      (eq, "$g_talk_troop_met", 1),
    ],
    "Hail and well met M'{reg63?Lord:Lady}. I hope you have fared well since our last meeting. ",
    "quigfen_response_1",
    []],

  [plyr|trp_quigfen, "quigfen_intro",
    [],
    "You strike me as somehow out of place. Who are you and what do you do?",
    "quigfen_intro_2",
    []],

  [plyr|trp_quigfen, "quigfen_response_1",
    [],
    "I have indeed Quigfen, thank you for asking. I am here to discuss business.",
    "quigfen_process_1",
    []],

  [trp_quigfen, "quigfen_intro_2",
    [],
    "To the point, I like that. I am called Quigfen, an odd name to your ears, of that there is no doubt, eh?  As to who I am? Well, I am... a merchant of sorts. Perhaps in your language a Broker would be close to the truth of the matter. I stay here in Laria and sell Noldor goods to those who... how do we put this delicately? To those who are friendly to the Noldor and their plight.  I sell arms, armor, and a variety of trinkets. I also at times broker the service of Noldor Rangers into the service of very select companies.  I see that I have your interest.",
    "quigfen_intro_3_talk",
    []],

  [plyr|trp_quigfen, "quigfen_intro_3_talk",
    [],
    "Hmm... yes, I am interested. Tell me more.",
    "quigfen_process_1",
    []],

  [trp_quigfen, "quigfen_process_1",
    [],
    "Remember, you must be on good terms with the Noldor to engage me in business. I offer you two choices. The first is to purchase from me Noldor armor and weapons. The second is to retain Noldor adventurers to fight by your side in your quest to unite this land and push back the followers of the Dark Goddess.",
    "quigfen_process_2",
    []],

  [plyr|trp_quigfen, "quigfen_process_2",
    [
      (quest_slot_eq, "qst_marauding_jatu", 11, 1),
      (neg|check_quest_active, "qst_marauding_jatu"),
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (ge, ":var0", 15),
    ],
    "Tell me about the quest again.",
    "start",
    [
      (quest_set_slot, "qst_marauding_jatu", 11, 0),
    ]],

  [plyr|trp_quigfen, "quigfen_process_2",
    [],
    "I am interested in Noldor Arms and Armor.",
    "quigfen_arms",
    []],

  [plyr|trp_quigfen, "quigfen_process_2",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I am interested in hiring Noldor Adventurers.",
    "quigfen_warrior",
    []],

  [plyr|trp_quigfen, "quigfen_process_2",
    [],
    "What do you do again?",
    "quigfen_intro_2",
    []],

  [plyr|trp_quigfen, "quigfen_process_2",
    [],
    "Neither, I must be going, perhaps later.",
    "close_window",
    []],

  [trp_quigfen, "quigfen_arms",
    [
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (lt, ":var0", 1),
    ],
    "It seems that the Noldor do not yet trust you enough to allow me to sell items to you. Go and improve your relationship with them and then return and we can do business.",
    "quigfen_process_2",
    []],

  [trp_quigfen, "quigfen_arms",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 1),
    ],
    "Ah, yes M'{reg63?Lord:Lady}, here we are, the Noldor Emporium.",
    "quigfen_ending_trade",
    [
      (change_screen_trade),
    ]],

  [trp_quigfen, "quigfen_arms",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Very well M'{reg63?Lord:Lady}, do you have a Dragon Tear to open the store up with? ",
    "quigfen_arms_gem",
    []],

  [plyr|trp_quigfen, "quigfen_arms_gem",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Yes, here it is.",
    "quigfen_arms",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
      (troop_remove_item, "trp_player", "itm_qualis"),
    ]],

  [plyr|trp_quigfen, "quigfen_arms_gem",
    [],
    "No, not with me.",
    "quigfen_process_1",
    []],

  [trp_quigfen, "quigfen_warrior",
    [
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (lt, ":var0", 1),
    ],
    "It seems that the Noldor do not yet trust you enough to follow you in battle. Go and improve your relationship with them and then return. Perhaps then some of the Elven Warriors will join you. ",
    "quigfen_process_2",
    []],

  [trp_quigfen, "quigfen_warrior",
    [
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (ge, ":var0", 1),
    ],
    "Very well M'{reg63?Lord:Lady}. Do you have a Dragon Tear to sway the hearts of the elves to join you? Or maybe some of their rare pottery?",
    "quigfen_warrior_gem",
    []],

  [plyr|trp_quigfen, "quigfen_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (neg|player_has_item, "itm_noldor_goods"),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (assign, reg24, ":var0"),
    ],
    "Yes, I have Qualis Gem (and space for {reg24} units).",
    "quigfen_warrior_choose",
    [
      (assign, reg25, 12),
      (try_begin),
        (lt, reg24, reg25),
        (assign, reg25, reg24),
      (try_end),
      (assign, reg26, 10),
      (try_begin),
        (lt, reg24, reg26),
        (assign, reg26, reg24),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg27, 0),
      (else_try),
        (assign, reg27, 8),
        (try_begin),
          (lt, reg24, reg27),
          (assign, reg27, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg28, 0),
      (else_try),
        (assign, reg28, 5),
        (try_begin),
          (lt, reg24, reg28),
          (assign, reg28, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg29, 0),
      (else_try),
        (assign, reg29, 3),
        (try_begin),
          (lt, reg24, reg29),
          (assign, reg29, reg24),
        (try_end),
      (try_end),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_noldor_goods"),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (assign, reg24, ":var0"),
    ],
    "Yes, I have Qualis Gem and this beautiful vase (and space for {reg24} units).",
    "quigfen_warrior_choose",
    [
      (assign, reg25, 15),
      (try_begin),
        (lt, reg24, reg25),
        (assign, reg25, reg24),
      (try_end),
      (assign, reg26, 12),
      (try_begin),
        (lt, reg24, reg26),
        (assign, reg26, reg24),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg27, 0),
      (else_try),
        (assign, reg27, 10),
        (try_begin),
          (lt, reg24, reg27),
          (assign, reg27, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg28, 0),
      (else_try),
        (assign, reg28, 6),
        (try_begin),
          (lt, reg24, reg28),
          (assign, reg28, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg29, 0),
      (else_try),
        (assign, reg29, 4),
        (try_begin),
          (lt, reg24, reg29),
          (assign, reg29, reg24),
        (try_end),
      (try_end),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (neg|player_has_item, "itm_noldor_goods"),
    ],
    "Yes, but I don't want to trade it for now.",
    "close_window",
    []],

  [plyr|trp_quigfen, "quigfen_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_noldor_goods"),
    ],
    "Yes, but I don't want to trade them for now.",
    "close_window",
    []],

  [plyr|trp_quigfen, "quigfen_warrior_gem",
    [
      (neg|player_has_item, "itm_qualis"),
    ],
    "No, not with me.",
    "close_window",
    []],

  [trp_quigfen, "quigfen_warrior_choose",
    [
      (gt, reg24, 0),
    ],
    "Excellent. Please select one of the options below.",
    "quigfen_warrior_select",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (try_begin),
        (player_has_item, "itm_noldor_goods"),
        (troop_remove_item, "trp_player", "itm_noldor_goods"),
      (try_end),
    ]],

  [trp_quigfen, "quigfen_warrior_choose",
    [
      (eq, reg24, 0),
    ],
    "Excellent, but ... there is no room in your party.",
    "close_window",
    []],

  [plyr|trp_quigfen, "quigfen_warrior_select",
    [],
    "{reg25}x Noldor Warrior.",
    "quigfen_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_warrior", reg25),
      (display_log_message, "@ {reg25}x Noldor Warrior have joined your party."),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_select",
    [],
    "{reg26}x Noldor Ranger.",
    "quigfen_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_ranger", reg26),
      (display_log_message, "@ {reg26}x Noldor Ranger have joined your party."),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_select",
    [
      (gt, reg27, 0),
    ],
    "{reg27}x Noldor Maiden Ranger.",
    "quigfen_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_maiden", reg27),
      (display_log_message, "@ {reg27}x Noldor Maiden Ranger have joined your party."),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_select",
    [
      (gt, reg28, 0),
    ],
    "{reg28}x Noldor Noble.",
    "quigfen_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_noble", reg28),
      (display_log_message, "@ {reg28}x Noldor Noble have joined your party."),
    ]],

  [plyr|trp_quigfen, "quigfen_warrior_select",
    [
      (gt, reg29, 0),
    ],
    "{reg29}x Noldor Twilight Knight.",
    "quigfen_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_knight", reg29),
      (display_log_message, "@ {reg29}x Noldor Twilight Knight have joined your party."),
    ]],

  [trp_quigfen, "quigfen_ending_trade",
    [],
    "Very good. Will there be anything else M'{reg63?Lord:Lady}?",
    "quigfen_process_2",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_ransom_broker_1", "trp_tavern_traveler_1"),
      (eq, "$g_talk_troop_met", 0),
    ],
    "Greetings to you, {reg63?sir:madam}. You look like someone who should get to know me.",
    "ransom_broker_intro",
    [
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [plyr|anyone, "ransom_broker_intro",
    [],
    "Why is that?",
    "ransom_broker_intro_2",
    []],

  [plyr|anyone, "ransom_broker_intro",
    [],
    "Ah, I know of your sort already. No need to tell me who you are.",
    "ransom_broker_pretalk",
    []],

  [anyone, "ransom_broker_intro_2",
    [],
    "I am with the local Red Brotherhood and I broker ransoms for the poor wretches who are captured in these endless wars. Normally I travel between the interior towns and the slave markets on the coast, on commission from those whose relatives have gone missing. But if I'm out on my errands of mercy, and I come across a fellow dragging around a captive or two, well, there's no harm in a little speculative investment, is there? And you look like the type who might have a prisoner to sell. ^^Additionally, I can let you hire some of the mercenaries we employ. In which some are veterans as well. For a lovely donation of course.",
    "ransom_broker_info_talk",
    [
      (assign, "$ransom_broker_families_told", 0),
      (assign, "$ransom_broker_prices_told", 0),
      (assign, "$ransom_broker_ransom_me_told", 0),
    ]],

  [plyr|anyone, "ransom_broker_info_talk",
    [
      (eq, "$ransom_broker_families_told", 0),
    ],
    "What if their families can't pay?",
    "ransom_broker_families",
    []],

  [anyone, "ransom_broker_families",
    [],
    "Oh, then I spin them a few heartwarming tales of life on the galleys. You'd be surprised what sorts of treasures a peasant can dig out of his cowshed or wheedle out of his cousins, assuming he's got the proper motivation! And if in the end they cannot come up with the silver, then there are always slave merchants who are looking for galley slaves. One cannot do Heaven's work with an empty purse, you see.",
    "ransom_broker_info_talk",
    [
      (assign, "$ransom_broker_families_told", 1),
    ]],

  [plyr|anyone, "ransom_broker_info_talk",
    [
      (eq, "$ransom_broker_prices_told", 0),
    ],
    "What can I get for a prisoner?",
    "ransom_broker_prices",
    []],

  [anyone, "ransom_broker_prices",
    [],
    "It varies. I fancy that I have a fine eye for assessing a ransom. There are a dozen little things about a man that will tell you whether he goes to bed hungry, or dines each night on soft dumplings and goose. The real money of course is in the gentry, and if you ever want to do my job you'll want to learn about every landowning family in Pendor, their estates, their heraldry, their offspring both lawful and bastard, and, of course, their credit with the merchants.",
    "ransom_broker_info_talk",
    [
      (assign, "$ransom_broker_prices_told", 1),
    ]],

  [plyr|anyone, "ransom_broker_info_talk",
    [
      (eq, "$ransom_broker_ransom_me_told", 0),
    ],
    "Would you be able to ransom me if I were taken?",
    "ransom_broker_ransom_me",
    []],

  [anyone, "ransom_broker_ransom_me",
    [],
    "Of course. I'm welcome in every court in Pendor. There's not many who can say that! So always be sure to keep a pot of denars buried somewhere, and a loyal servant who can find it in a hurry.",
    "ransom_broker_info_talk",
    [
      (assign, "$ransom_broker_ransom_me_told", 1),
    ]],

  [plyr|anyone, "ransom_broker_info_talk",
    [],
    "That's all I need to know. Thanks.",
    "ransom_broker_pretalk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_ransom_broker_1", "trp_tavern_traveler_1"),
    ],
    "Greetings. If you have any prisoners, I will be happy to buy them from you. Or I could organize some mercenaries, if needed. ",
    "ransom_broker_talk",
    []],

  [anyone, "ransom_broker_pretalk",
    [],
    "Very well, if you have any prisoners, I will be happy to buy them from you. Or I could organize some mercenaries, if needed.",
    "ransom_broker_talk",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 10),
    ],
    "Have you heard any rumors of interest? (Must pay 10 denars)",
    "ransom_broker_rumors",
    [
      (troop_remove_gold, "trp_player", 10),
      (store_conversation_troop, ":var0"),
      (assign, reg33, 0),
      (call_script, "script_random_rumor_talk", 3, ":var0"),
    ]],

  [anyone, "ransom_broker_rumors",
    [
      (ge, reg33, 70),
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "{s3} -- Which reminds me - I have an opportunity to discuss if you are interested.",
    "ransom_broker_post_rumor_bonus",
    []],

  [anyone, "ransom_broker_rumors",
    [],
    "{s3}",
    "ransom_broker_post_rumor",
    []],

  [plyr|anyone, "ransom_broker_post_rumor_bonus",
    [],
    "Perhaps, what is this opportunity?",
    "ransom_broker_post_rumor_bonus_troops",
    []],

  [plyr|anyone, "ransom_broker_post_rumor_bonus",
    [],
    "No, I must leave now.",
    "close_window",
    []],

  [anyone, "ransom_broker_post_rumor_bonus_troops",
    [
      (assign, ":var0", 125),
      (assign, ":var1", 130),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (lt, ":var2", 5),
        (assign, reg8, "trp_bearclaw_berserker"),
        (store_random_in_range, ":var3", 3, 5),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ The Goddess of Fate smiles upon you, my friend! In a recent northern raid, my colleagues managed to capture {reg7} Bearclaw Berserkers that I might be willing to sell to you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 10),
        (assign, reg8, "trp_rav_highlander"),
        (store_random_in_range, ":var3", 3, 5),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ This must be your lucky day, my friend! In a recent Northern trip, I purchased {reg7} Ravenstern Highlanders that I might be willing to sell them to you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 20),
        (assign, reg8, "trp_omen_seeker"),
        (store_random_in_range, ":var3", 3, 5),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ This must be your lucky day, my friend! In a recent Southern trip, I purchased {reg7} Omen Seekers from a Singalian raiding party. I would be willing to sell them to you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 30),
        (assign, reg8, "trp_melitine_merc"),
        (store_random_in_range, ":var3", 15, 20),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ This may be your lucky day, friend. I have {reg7} warriors from distant Melitine that I am trying to unload. They will follow you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 40),
        (assign, reg8, "trp_refugee"),
        (store_random_in_range, ":var3", 3, 12),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ It seems that I have too many laborers on my hands, and no way to feed them. If you are interested, I have {reg7} Refugees that would be happy to exchange their current lot to serve you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 45),
        (assign, reg8, "trp_follower_woman"),
        (store_random_in_range, ":var3", 2, 8),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ Unfortunately I have been stuck with some prisoners who are not fitting as pleasure slaves and not worth much else unless it be to bash my brains in at the first opportunity. If you are interested, I have {reg7} Maiden Scouts that would be happy to exchange their current lot to serve you for {reg41} denars."),
      (else_try),
        (lt, ":var2", 50),
        (assign, reg8, "trp_singalian_spearman"),
        (store_random_in_range, ":var3", 4, 12),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ My bad luck has saddled me with a small company of {reg7} Singalian Foreign Spearmen who are in my employ. Due to some bad business ventures, I cannot pay them. For {reg41} denars, I can order them to follow you. Interested?"),
      (else_try),
        (lt, ":var2", 60),
        (assign, reg8, "trp_barclay_adventurer"),
        (store_random_in_range, ":var3", 15, 20),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ My bad luck has saddled me with a small company of {reg7} Barclay Aventuriers, who are in my employ. Due to some bad business ventures, I cannot pay them. For {reg41} denars, I can order them to follow you. Are you interested?"),
      (else_try),
        (lt, ":var2", 70),
        (assign, reg8, "trp_mett_avonteurer"),
        (store_random_in_range, ":var3", 15, 20),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ This must be your lucky day! I employ {reg7} formidable soldiers from distant Mettenheim, but I don't need them anymore. For {reg41} denars, I can order them to follow you. Interested?"),
      (else_try),
        (lt, ":var2", 80),
        (assign, reg8, "trp_rogue_squire"),
        (store_random_in_range, ":var3", 2, 4),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ Through some, shall we say, sub-optimal business decisions, I have {reg7} armed Squires, that I am unable to neither ransom nor feed. For {reg41} gold, I am sure they would leave their current situation and serve you. Do we have a deal?"),
      (else_try),
        (lt, ":var2", 90),
        (assign, reg8, "trp_slave_hunter"),
        (store_random_in_range, ":var3", 4, 12),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ My bad luck has saddled me with a small company of {reg7} Bounty Hunters who are in my employ. Due to unforseen events, I am unable to pay them. For {reg41} denars, I can order them into your service. Is this of interest to you?"),
      (else_try),
        (lt, ":var2", 95),
        (store_random_in_range, ":var4", "trp_dragon_knight", "trp_player_knight"),
        (try_begin),
          (eq, ":var4", "trp_griffon_knight"),
          (assign, ":var5", 0),
          (assign, ":var6", "p_village_1"),
          (try_for_range, ":var7", "p_town_1", ":var6"),
            (party_get_slot, ":var8", ":var7", 289),
            (eq, ":var8", "trp_griffon_knight"),
            (assign, ":var5", 1),
            (assign, ":var6", "p_town_1"),
          (try_end),
          (try_begin),
            (eq, ":var5", 0),
            (assign, ":var4", "trp_lion_knight"),
          (try_end),
        (try_end),
        (str_store_troop_name, s1, ":var4"),
        (assign, reg8, ":var4"),
        (store_random_in_range, ":var3", 1, 3),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ My bad luck just has no end. I have tried to ransom a good fellow, {s1} ,who had some misfortune on the road. The Order refused to pay a ransom and he certainly is worth more than a Galley Slave. Perhaps for {reg41} denars you could take him off my hands. I am sure he would follow you in your journey."),
      (else_try),
        (lt, ":var2", 97),
        (assign, reg8, "trp_noldor_ranger"),
        (store_random_in_range, ":var3", 1, 2),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ Should my bad luck continue, I will be out of business. I recently acquired a fellow who was captured and it seems that he is some sort of outcast as his people are not willing to ransom him. He is fairly dangerous, I must warn you. He is an elf, you see, and they can be... unpredictable. We have a deal. He gets half of the gold that I sell him for as long as he is able to fight. He is some kind of tracker I think, maybe a warrior, it is hard to tell. Would you be interested in taking him into your company and paying me {reg41} for my trouble? "),
      (else_try),
        (assign, reg8, "trp_maiden_adventurer"),
        (store_random_in_range, ":var3", 2, 4),
        (assign, reg7, ":var3"),
        (call_script, "script_game_get_join_cost_selectable", reg8, ":var0", ":var1"),
        (store_mul, reg41, ":var3", reg0),
        (str_store_string, s3, "@ It has been my misfortune to have recently captured {reg7} Maiden Adventurers as they tried to free one of their friends from an associate's slave galley. While these Maidens could have had possible futures as pleasure slaves, their martial training makes them much too dangerous for so delicate a role. Perhaps you can take them in, and put their aggressive tendencies to more constructive work for, say, {reg41} denars? "),
      (try_end),
      (party_get_free_companions_capacity, ":var9", "p_main_party"),
      (assign, reg42, 0),
      (try_begin),
        (gt, ":var3", ":var9"),
        (assign, reg42, 1),
      (try_end),
    ],
    "{s3} ",
    "ransom_broker_post_rumor_bonus_troop_response",
    []],

  [plyr|anyone, "ransom_broker_post_rumor_bonus_troop_response",
    [
      (eq, reg42, 0),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg41),
    ],
    "Yes, here are {reg41} denars, and I will take these people off your hands.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg41),
      (party_add_members, "p_main_party", reg8, reg7),
    ]],

  [plyr|anyone, "ransom_broker_post_rumor_bonus_troop_response",
    [
      (str_clear, s3),
      (try_begin),
        (eq, reg42, 1),
        (str_store_string, s3, "@ No, I have no room in my party."),
      (else_try),
        (str_store_string, s3, "@ No, I am not interested."),
      (try_end),
    ],
    "{s3} ",
    "close_window",
    []],

  [plyr|anyone, "ransom_broker_post_rumor",
    [],
    "Very good, thank you.",
    "ransom_broker_pretalk",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [
      (store_num_regular_prisoners, reg0),
      (ge, reg0, 1),
    ],
    "Then you'd better bring your purse. I have got prisoners to sell.",
    "ransom_broker_sell_prisoners",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [
      (store_num_regular_prisoners, reg0),
      (ge, reg0, 1),
    ],
    "I want to sell all my prisoners.",
    "ransom_broker_sell_prisoners_all",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [],
    "Tell me about what you do, again?",
    "ransom_broker_intro_2",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [],
    "I wish to ransom one of my companions.",
    "ransom_broker_ransom_companion",
    []],

  [anyone, "ransom_broker_ransom_companion",
    [],
    "Whom do you wish to ransom?",
    "ransom_broker_ransom_companion_choose",
    []],

  [repeat_for_troops|plyr|anyone, "ransom_broker_ransom_companion_choose",
    [
      (store_repeat_object, ":var0"),
      (neg|troop_slot_eq, ":var0", 2, 2),
      (is_between, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_ge, ":var0", 8, "p_town_1"),
      (str_store_troop_name, s4, ":var0"),
    ],
    "{s4}",
    "ransom_broker_ransom_companion_name_sum",
    [
      (store_repeat_object, "$companion_to_be_ransomed"),
    ]],

  [plyr|anyone, "ransom_broker_ransom_companion_choose",
    [],
    "Never mind",
    "ransom_broker_pretalk",
    []],

  [anyone, "ransom_broker_ransom_companion_name_sum",
    [],
    "Let me check my ledger, here... Yes. Your friend is being held in the dungeon at {s7}. How interesting! I remember hearing that the rats down there are unusually large -- like mastiffs, they say... Now... For the very reasonable sum of {reg5} denars, which includes both the ransom and my commission and expenses, we can arrange it so that {s5} can once again enjoy {reg4?her:his} freedom. What do you say?",
    "ransom_broker_ransom_companion_verify",
    [
      (str_store_troop_name, s5, "$companion_to_be_ransomed"),
      (troop_get_type, reg4, "$companion_to_be_ransomed"),
      (troop_get_slot, ":var0", "$companion_to_be_ransomed", 8),
      (str_store_party_name, s7, ":var0"),
      (store_character_level, ":var1", "$companion_to_be_ransomed"),
      (store_add, "$companion_ransom_amount", ":var1", 20),
      (val_mul, "$companion_ransom_amount", ":var1"),
      (val_mul, "$companion_ransom_amount", 5),
      (assign, reg5, "$companion_ransom_amount"),
    ]],

  [plyr|anyone, "ransom_broker_ransom_companion_verify",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$companion_ransom_amount"),
    ],
    "Here's your money.",
    "ransom_broker_ransom_companion_accept",
    [
      (troop_remove_gold, "trp_player", "$companion_ransom_amount"),
      (troop_set_slot, "$companion_to_be_ransomed", 2, 5),
      (troop_set_slot, "$companion_to_be_ransomed", 152, 8),
      (troop_set_slot, "$companion_to_be_ransomed", 151, 1),
      (try_begin),
        (troop_get_slot, ":var0", "$companion_to_be_ransomed", 8),
        (party_count_prisoners_of_type, ":var1", ":var0", "$companion_to_be_ransomed"),
        (gt, ":var1", 0),
        (party_remove_prisoners, ":var0", "$companion_to_be_ransomed", 1),
      (try_end),
      (troop_set_slot, "$companion_to_be_ransomed", 8, -1),
      (troop_set_slot, "$companion_to_be_ransomed", 77, 0),
      (troop_set_slot, "$companion_to_be_ransomed", 69, 0),
    ]],

  [plyr|anyone, "ransom_broker_ransom_companion_verify",
    [],
    "I can't afford that right now.",
    "ransom_broker_ransom_companion_refuse",
    []],

  [anyone, "ransom_broker_ransom_companion_accept",
    [],
    "Splendid! In a few days, I would think, you should find {s5} riding to rejoin you, blinking in the sunlight and no doubt very grateful! Is there any other way in which I can help you?",
    "ransom_broker_talk",
    [
      (str_store_troop_name, s5, "$companion_to_be_ransomed"),
    ]],

  [anyone, "ransom_broker_ransom_companion_refuse",
    [],
    "Of course, of course... Never mind what they say about the rats, by the way -- I've never actually seen one myself, on account of the pitch-black darkness. Anyway, I'm sure that {s5} will understand why it's important for you to control expenditures. Now... Was there anything else?",
    "ransom_broker_talk",
    [
      (str_store_troop_name, s5, "$companion_to_be_ransomed"),
    ]],

  [plyr|anyone, "ransom_broker_talk",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "Mercenaries you said?",
    "ransom_broker_common_mercenaries_1",
    []],

  [anyone, "ransom_broker_common_mercenaries_1",
    [
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (eq, ":var0", 0),
    ],
    "Indeed, the mercenaries I'm in contact with will work for admirable pay. Unfortunately, you have no space in your party.",
    "close_window",
    []],

  [anyone, "ransom_broker_common_mercenaries_1",
    [
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (gt, ":var0", 0),
      (assign, reg44, 0),
    ],
    "Yes, indeed. ^^Yes, indeed. Hmm... You wouldn't by any chance have a gold bar in your inventory? If so, I can put it to far better use. A gold bar will convince mercenary captains I know to let you hire some of their best troops, but the price will remain high for them.",
    "ransom_broker_common_mercenaries_2",
    []],

  [plyr|anyone, "ransom_broker_common_mercenaries_2",
    [
      (player_has_item, "itm_gold"),
    ],
    "It just so happens that I do. [hand over gold bar]",
    "ransom_broker_common_mercenaries_3",
    [
      (assign, reg44, 2),
    ]],

  [plyr|anyone, "ransom_broker_common_mercenaries_2",
    [
      (player_has_item, "itm_gold"),
    ],
    "I don't seem to have any gold bars on me this moment. [lie]",
    "ransom_broker_common_mercenaries_3",
    [
      (assign, reg44, 1),
    ]],

  [plyr|anyone, "ransom_broker_common_mercenaries_2",
    [
      (player_has_item, "itm_gold"),
    ],
    "I do have a gold bar. However, I feel that I can't part with it right now. Farewell.",
    "close_window",
    []],

  [plyr|anyone, "ransom_broker_common_mercenaries_2",
    [
      (neg|player_has_item, "itm_gold"),
    ],
    "No, I don't have any gold bars on me. Let's focus on those mercenaries you were talking about.",
    "ransom_broker_common_mercenaries_3",
    [
      (assign, reg44, 1),
    ]],

  [plyr|anyone, "ransom_broker_common_mercenaries_2",
    [
      (neg|player_has_item, "itm_gold"),
    ],
    "I have to go. Goodbye.",
    "close_window",
    []],

  [anyone, "ransom_broker_common_mercenaries_3",
    [
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (gt, ":var0", 0),
      (val_min, ":var0", 30),
      (assign, reg34, ":var0"),
      (assign, ":var1", 0),
      (call_script, "script_game_get_join_cost", "trp_caravan_guard"),
      (assign, ":var2", reg0),
      (assign, ":var3", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_crossbowman"),
      (assign, ":var4", reg0),
      (assign, ":var5", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_swordsman"),
      (assign, ":var6", reg0),
      (assign, ":var7", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_armcrossbow"),
      (assign, ":var8", reg0),
      (assign, ":var9", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_cavalry"),
      (assign, ":var10", reg0),
      (assign, ":var11", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_sergeants"),
      (assign, ":var12", reg0),
      (assign, ":var13", 0),
      (call_script, "script_game_get_join_cost", "trp_mercenary_sharp"),
      (assign, ":var14", reg0),
      (assign, ":var15", 0),
      (call_script, "script_game_get_join_cost", "trp_hired_blade"),
      (assign, ":var16", reg0),
      (assign, ":var17", 0),
      (try_begin),
        (eq, reg44, 1),
        (try_for_range, ":var18", 0, ":var0"),
          (store_random_in_range, ":var19", 1, 100),
          (try_begin),
            (le, ":var19", 15),
            (val_add, ":var1", 1),
            (assign, ":var20", ":var2"),
          (else_try),
            (le, ":var19", 30),
            (val_add, ":var3", 1),
            (assign, ":var20", ":var4"),
          (else_try),
            (le, ":var19", 43),
            (val_add, ":var5", 1),
            (assign, ":var20", ":var6"),
          (else_try),
            (le, ":var19", 56),
            (val_add, ":var7", 1),
            (assign, ":var20", ":var8"),
          (else_try),
            (le, ":var19", 69),
            (val_add, ":var9", 1),
            (assign, ":var20", ":var10"),
          (else_try),
            (le, ":var19", 79),
            (val_add, ":var11", 1),
            (assign, ":var20", ":var12"),
          (else_try),
            (le, ":var19", 89),
            (val_add, ":var13", 1),
            (assign, ":var20", ":var14"),
          (else_try),
            (val_add, ":var15", 1),
            (assign, ":var20", ":var16"),
          (try_end),
          (val_add, ":var17", ":var20"),
        (try_end),
      (else_try),
        (eq, reg44, 2),
        (try_for_range, ":var18", 0, ":var0"),
          (store_random_in_range, ":var19", 1, 100),
          (try_begin),
            (le, ":var19", 33),
            (val_add, ":var11", 1),
            (assign, ":var20", ":var12"),
          (else_try),
            (le, ":var19", 66),
            (val_add, ":var13", 1),
            (assign, ":var20", ":var14"),
          (else_try),
            (val_add, ":var15", 1),
            (assign, ":var20", ":var16"),
          (try_end),
          (val_add, ":var17", ":var20"),
        (try_end),
      (try_end),
      (val_mul, ":var17", 140),
      (val_div, ":var17", 100),
      (assign, reg43, ":var17"),
      (assign, reg35, ":var1"),
      (assign, reg36, ":var3"),
      (assign, reg37, ":var5"),
      (assign, reg38, ":var7"),
      (assign, reg39, ":var9"),
      (assign, reg40, ":var11"),
      (assign, reg41, ":var13"),
      (assign, reg42, ":var15"),
      (store_sub, reg45, ":var0", 1),
    ],
    "I've reached out to one of my mercenary captain contacts who would be willing to let you hire {reg45?{reg34} men:one man} for the price of {reg43} denars.",
    "ransom_broker_common_mercenaries_4",
    []],

  [plyr|anyone, "ransom_broker_common_mercenaries_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg43),
    ],
    "This deal is fair. Here is your {reg43} denars. Have them meet me outside the town.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg43),
      (try_begin),
        (eq, reg44, 2),
        (player_has_item, "itm_gold"),
        (troop_remove_item, "trp_player", "itm_gold"),
      (try_end),
      (try_begin),
        (gt, reg35, 0),
        (party_add_members, "p_main_party", trp_caravan_guard, reg35),
      (try_end),
      (try_begin),
        (gt, reg36, 0),
        (party_add_members, "p_main_party", trp_mercenary_crossbowman, reg36),
      (try_end),
      (try_begin),
        (gt, reg37, 0),
        (party_add_members, "p_main_party", trp_mercenary_swordsman, reg37),
      (try_end),
      (try_begin),
        (gt, reg38, 0),
        (party_add_members, "p_main_party", trp_mercenary_armcrossbow, reg38),
      (try_end),
      (try_begin),
        (gt, reg39, 0),
        (party_add_members, "p_main_party", trp_mercenary_cavalry, reg39),
      (try_end),
      (try_begin),
        (gt, reg40, 0),
        (party_add_members, "p_main_party", trp_mercenary_sergeants, reg40),
      (try_end),
      (try_begin),
        (gt, reg41, 0),
        (party_add_members, "p_main_party", trp_mercenary_sharp, reg41),
      (try_end),
      (try_begin),
        (gt, reg42, 0),
        (party_add_members, "p_main_party", trp_hired_blade, reg42),
      (try_end),
      (display_log_message, "@{reg34} Mercenaries have joined your party."),
    ]],

  [plyr|anyone, "ransom_broker_common_mercenaries_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg43),
    ],
    "Though this is a fair deal, it is such that I do not wish to spend this many denars. Farewell.",
    "close_window",
    []],

  [plyr|anyone, "ransom_broker_common_mercenaries_4",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", reg43),
    ],
    "That is way too much! Farewell.",
    "close_window",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [
      (eq, "$g_talk_troop", "trp_ransom_broker_1"),
      (troop_slot_ge, "trp_player", 30, 1),
      (troop_get_slot, ":var0", "trp_player", 30),
      (neg|troop_slot_eq, ":var0", 2, 2),
    ],
    "What else do you offer?",
    "ransom_broker_special",
    []],

  [anyone, "ransom_broker_special",
    [],
    "I have amassed a surplus of stripped clothing of all those who have passed in my care. Most of it is ragged and torn, however I have some from ladies who were unfortunate to be traded.",
    "ransom_broker_special_1",
    []],

  [plyr|anyone, "ransom_broker_special_1",
    [],
    "Actually I am looking for a gift for my lady. Show me what do you have.",
    "ransom_broker_special_2",
    []],

  [plyr|anyone, "ransom_broker_special_1",
    [],
    "Maybe next time.",
    "close_window",
    []],

  [anyone, "ransom_broker_special_2",
    [],
    "They're in the back, follow me.",
    "ransom_broker_special_3",
    [
      (troop_clear_inventory, "$g_talk_troop"),
      (try_for_range, ":var0", "itm_dress", "itm_nobleman_outfit"),
        (troop_add_item, "$g_talk_troop", ":var0", imod_plain),
      (try_end),
      (troop_add_item, "$g_talk_troop", "itm_fur_coat", imod_plain),
      (troop_add_item, "$g_talk_troop", "itm_nomad_robe", imod_plain),
      (troop_add_item, "$g_talk_troop", "itm_nomad_vest", imod_plain),
      (troop_add_item, "$g_talk_troop", "itm_merchant_outfit_2", imod_plain),
      (try_for_range, ":var0", "itm_wrapping_boots", "itm_common_rus_shoes"),
        (troop_add_item, "$g_talk_troop", ":var0", imod_plain),
      (try_end),
      (troop_add_item, "$g_talk_troop", "itm_ankle_boots", imod_plain),
      (troop_add_item, "$g_talk_troop", "itm_looter_boots", imod_plain),
      (troop_add_item, "$g_talk_troop", "itm_leather_boots", imod_plain),
      (try_for_range, ":var0", "itm_khergit_lady_hat", "itm_straw_hat"),
        (neq, ":var0", "itm_head_wrappings"),
        (troop_add_item, "$g_talk_troop", ":var0", imod_plain),
      (try_end),
      (change_screen_trade),
    ]],

  [anyone, "ransom_broker_special_3",
    [],
    "Anything else?",
    "ransom_broker_talk",
    []],

  [plyr|anyone, "ransom_broker_talk",
    [],
    "Not at this time. Good-bye.",
    "close_window",
    []],

  [anyone, "ransom_broker_sell_prisoners",
    [],
    "Let me see what do you have...",
    "ransom_broker_sell_prisoners_2",
    [
      (change_screen_trade_prisoners),
    ]],

  [anyone, "ransom_broker_sell_prisoners_all",
    [],
    "Let me see what you have...",
    "ransom_broker_sell_prisoners_2",
    [
      (call_script, "script_sell_all_prisoners"),
    ]],

  [anyone, "ransom_broker_sell_prisoners_2",
    [],
    "I will be staying here for a few days. Let me know if you need my services.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
      (str_store_troop_name, s10, "$g_talk_troop"),
      (eq, "$g_spy_talk_cb5", 0),
      (try_begin),
        (eq, "$background_answer_4", 20),
        (str_store_string, s9, "str_cb5_revenge_fiancee"),
      (else_try),
        (eq, "$background_answer_4", 21),
        (str_store_string, s9, "str_cb5_all_loss"),
      (else_try),
        (this_or_next|eq, "$background_answer_5", 38),
        (eq, "$background_answer_5", 18),
        (str_store_string, s9, "str_cb5_death_of_fiancee"),
      (else_try),
        (eq, "$background_answer_5", 40),
        (str_store_string, s9, "str_cb5_event_troubadour"),
      (else_try),
        (eq, "$background_answer_5", 41),
        (str_store_string, s9, "str_cb5_event_physician"),
      (else_try),
        (eq, "$background_answer_5", 42),
        (str_store_string, s9, "str_cb5_merchant_trade"),
      (else_try),
        (eq, "$background_answer_5", 49),
        (str_store_string, s9, "str_cb5_enemies_craftsmen"),
      (else_try),
        (eq, "$background_answer_5", 44),
        (str_store_string, s9, "str_cb5_event_poacher"),
      (else_try),
        (this_or_next|eq, "$background_answer_5", 45),
        (this_or_next|eq, "$background_answer_5", 46),
        (eq, "$background_answer_5", 47),
        (str_store_string, s9, "str_cb5_death_of_barclay_duke"),
      (else_try),
        (this_or_next|eq, "$background_answer_5", 48),
        (eq, "$background_answer_5", 50),
        (str_store_string, s9, "str_cb5_statue_lookalike"),
      (else_try),
        (eq, "$background_answer_4", 24),
        (str_store_string, s9, "str_cb5_statue_lookalike"),
      (else_try),
        (str_store_string, s9, "str_cb5_background_default"),
      (try_end),
    ],
    "Greetings, friend. You look like the kind of {reg63?man:person} who'd do well to know me. I travel a great deal all across Pendor, and keep an open ear for interesting information that you may find useful.^^ {s9} ",
    "tavern_background_talk",
    [
      (assign, "$traveler_land_asked", 0),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (eq, "$background_answer_5", 44),
    ],
    "Yes, I will take on these two Bounty Hunters.",
    "tavern_traveler_rumors_end1",
    [
      (party_add_members, "p_main_party", "trp_slave_hunter", 2),
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (eq, "$background_answer_5", 44),
    ],
    "No, that will not be necessary, thanks anyway.",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (this_or_next|eq, "$background_answer_5", 41),
      (this_or_next|eq, "$background_answer_5", 42),
      (eq, "$background_answer_5", 40),
    ],
    "Thank you kindly for the tip. I may come back and ask about work.",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (eq, "$background_answer_5", 42),
    ],
    "Thank you kindly for the information. That is good news indeed!",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (this_or_next|eq, "$background_answer_5", 38),
      (this_or_next|eq, "$background_answer_4", 20),
      (eq, "$background_answer_5", 39),
    ],
    "Thank you for your words. I must be going now.",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_background_encounter", 1),
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (this_or_next|eq, "$background_answer_5", 48),
      (this_or_next|eq, "$background_answer_5", 50),
      (eq, "$background_answer_4", 21),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 30),
    ],
    "Yes, here is your gold. I trust you will keep silent? (You must pay 30 denars)",
    "tavern_traveler_rumors_end1",
    [
      (troop_remove_gold, "trp_player", 30),
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (this_or_next|eq, "$background_answer_5", 48),
      (this_or_next|eq, "$background_answer_5", 50),
      (eq, "$background_answer_4", 21),
    ],
    "I will pay you nothing. Goodbye.",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_background_encounter", 1),
      (assign, "$g_spy_talk_cb5", 1),
    ]],

  [plyr|anyone, "tavern_background_talk",
    [
      (eq, "$g_spy_talk_cb5", 0),
    ],
    "That is nice to know. I should be leaving now, goodbye.",
    "tavern_traveler_rumors_end1",
    [
      (assign, "$g_background_encounter", 1),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
      (str_store_troop_name, s10, "$g_talk_troop"),
      (eq, "$g_talk_troop_met", 0),
      (try_begin),
        (try_begin),
          (eq, "$background_answer_4", 20),
          (str_store_string, s9, "str_cb5_revenge_fiancee"),
        (else_try),
          (eq, "$background_answer_4", 21),
          (str_store_string, s9, "str_empty_string"),
        (else_try),
          (this_or_next|eq, "$background_answer_5", 38),
          (eq, "$background_answer_5", 18),
          (str_store_string, s9, "str_cb5_death_of_fiancee"),
        (else_try),
          (eq, "$background_answer_5", 40),
          (str_store_string, s9, "str_cb5_event_troubadour"),
        (else_try),
          (eq, "$background_answer_5", 41),
          (str_store_string, s9, "str_cb5_event_physician"),
        (else_try),
          (eq, "$background_answer_5", 42),
          (str_store_string, s9, "str_cb5_merchant_trade"),
        (else_try),
          (this_or_next|eq, "$background_answer_5", 49),
          (eq, "$background_answer_5", 49),
          (str_store_string, s9, "str_empty_string"),
        (else_try),
          (eq, "$background_answer_5", 44),
          (str_store_string, s9, "str_empty_string"),
        (else_try),
          (this_or_next|eq, "$background_answer_5", 45),
          (this_or_next|eq, "$background_answer_5", 46),
          (eq, "$background_answer_5", 47),
          (str_store_string, s9, "str_cb5_death_of_barclay_duke"),
        (else_try),
          (this_or_next|eq, "$background_answer_5", 48),
          (eq, "$background_answer_5", 50),
          (str_store_string, s9, "str_cb5_statue_lookalike"),
        (else_try),
          (eq, "$background_answer_4", 24),
          (str_store_string, s9, "str_cb5_statue_lookalike"),
        (try_end),
      (else_try),
        (str_store_string, s9, "str_cb5_background_default"),
      (try_end),
    ],
    "Greetings, friend. You look like the kind of {reg63?man:person} who'd do well to know me. I travel a great deal all across Pendor, and keep an open ear for interesting information that you may might find useful. {s9} ",
    "tavern_traveler_talk",
    [
      (assign, "$traveler_land_asked", 0),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
      (gt, "$last_lost_companion", 0),
      (assign, ":var0", -1),
      (troop_get_slot, ":var0", "$last_lost_companion", 12),
      (is_between, ":var0", "p_town_1", "p_castle_1"),
      (str_store_troop_name, s10, "$last_lost_companion"),
      (str_store_party_name, s11, ":var0"),
    ],
    "Greetings, {playername}. I saw your companion {s10} at a tavern in {s11} some days ago. I thought you might like to know.",
    "tavern_traveler_lost_companion_thanks",
    [
      (assign, "$last_lost_companion", 0),
    ]],

  [plyr|anyone, "tavern_traveler_lost_companion_thanks",
    [
      (troop_get_type, reg3, "$last_lost_companion"),
    ],
    "Thanks. I'll go and find {reg3?her:him} there.",
    "tavern_traveler_pretalk",
    []],

  [plyr|anyone, "tavern_traveler_lost_companion_thanks",
    [],
    "Thanks, but I don't really care.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
    ],
    "Greetings, {playername}.",
    "tavern_traveler_talk",
    [
      (assign, "$traveler_land_asked", 0),
      (assign, reg45, 0),
    ]],

  [anyone, "tavern_traveler_pretalk",
    [
      (assign, reg45, 0),
    ],
    "Yes?",
    "tavern_traveler_talk",
    []],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (eq, "$traveler_land_asked", 0),
    ],
    "What can you tell me about this land?",
    "tavern_traveler_tell_kingdoms",
    [
      (assign, "$traveler_land_asked", 1),
    ]],

  [anyone, "tavern_traveler_tell_kingdoms",
    [],
    "Pendor is divided into rival kingdoms, which can neither manage to live in peace with their neighbours, nor completely eliminate them. As a result, there's seldom a break to the bitter wars which plague this land and drain its life blood. Well, at least this must be a good place to be for an adventurer such as yourself. With some luck and skill, you can make a name for yourself here, amass a fortune perhaps, or gain great power. Opportunities are endless and so are the rewards, if you are willing to risk your life for them.",
    "tavern_traveler_tell_kingdoms_2",
    []],

  [plyr|anyone, "tavern_traveler_tell_kingdoms_2",
    [],
    "Tell me more about these opportunities.",
    "tavern_traveler_tell_kingdoms_3",
    []],

  [plyr|anyone, "tavern_traveler_tell_kingdoms_2",
    [],
    "Thank you. That was all I needed to know",
    "close_window",
    []],

  [anyone, "tavern_traveler_tell_kingdoms_3",
    [
      (gt, "$player_has_homage", 0),
    ],
    "Well, you probably know everything I could tell you already. You seem to be doing pretty well.",
    "tavern_traveler_tell_kingdoms_4",
    []],

  [anyone, "tavern_traveler_tell_kingdoms_3",
    [],
    "The kingdoms will pay good money for mercenaries if they are engaged in a war. If you have done a bit of fighting, speaking with one of their lords will probably result in being offered a mercenary contract. However the real rewards come if you can manage to become a vassal to a king. A vassal can own villages, castles and towns and get rich with the taxes and revenues of these estates. Normally, only nobles of the realm own land in this way, but in time of war, a king will not hesitate to accept someone who distinguishes {reg63?himself:herself} on the battlefield as a vassal, and grant {reg63?him:her} the right to own land.",
    "tavern_traveler_tell_kingdoms_4a",
    []],

  [anyone, "tavern_traveler_tell_kingdoms_4a",
    [],
    "It is not unheard-of for adventurers to renounce allegiance to a Pendorian king altogether, declare themselves kings, and claim land in their own name. This is a difficult path, however, as the great nobles of the land, with their long ancestries, are not likely to accept such upstarts as their monarch. Such rulers would need to be very careful in establishing their right to rule, or they would be set upon from all sides.",
    "tavern_traveler_tell_kingdoms_4",
    []],

  [anyone, "tavern_traveler_tell_kingdoms_4",
    [],
    "It might be easier for an adventurer like yourself to pledge support to an existing king's rival.  There are many such pretenders in Pendor -- those who are born to the right family, who go around and stir up trouble saying they have a better claim to the throne than the current king. If those claim holders could find supporters, they could easily start civil wars and perhaps even replace the king one day.",
    "tavern_traveler_tell_kingdoms_5",
    []],

  [plyr|anyone, "tavern_traveler_tell_kingdoms_5",
    [],
    "Interesting. Where can I find these claim holders?",
    "tavern_traveler_tell_kingdoms_6",
    []],

  [plyr|anyone, "tavern_traveler_tell_kingdoms_5",
    [],
    "I guess I heard enough already. Thank you.",
    "close_window",
    []],

  [anyone, "tavern_traveler_tell_kingdoms_6",
    [],
    "A claim holder's life would be in danger in his own country, of course. Therefore, they usually stay at rival courts, raising support and hoping to find someone willing to champion their cause. I usually hear news about some of them, and may be able to tell you their location with some precision. But of course, I would ask for a little something for such a service.",
    "tavern_traveler_pretalk",
    [
      (assign, "$traveller_claimants_mentioned", 1),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (eq, "$traveller_claimants_mentioned", 1),
    ],
    "I want to know the location of a claimant.",
    "tavern_traveler_pretender_location",
    []],

  [anyone, "tavern_traveler_pretender_location",
    [],
    "Whose location do you want to know?",
    "tavern_traveler_pretender_location_ask",
    []],

  [repeat_for_troops|plyr|anyone, "tavern_traveler_pretender_location_ask",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (neg|troop_slot_eq, ":var0", 2, 2),
      (troop_slot_ge, ":var0", 12, 1),
      (str_store_troop_name, s11, ":var0"),
      (neq, ":var0", "$supported_pretender"),
    ],
    "{s11}",
    "tavern_traveler_pretender_location_ask_2",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "tavern_traveler_pretender_location_ask",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_pretender_location_ask_2",
    [],
    "I can reveal this information to you for a small price - let's say 300 denars.",
    "tavern_traveler_pretender_location_ask_money",
    []],

  [plyr|anyone, "tavern_traveler_pretender_location_ask_money",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "All right. Here are 300 denars.",
    "tavern_traveler_pretender_location_tell",
    [
      (troop_remove_gold, "trp_player", 300),
    ]],

  [plyr|anyone, "tavern_traveler_pretender_location_ask_money",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_pretender_location_tell",
    [],
    "{s15} is currently at {s11}.",
    "tavern_traveler_pretalk",
    [
      (str_store_troop_name, s15, "$temp"),
      (troop_get_slot, ":var0", "$temp", 12),
      (str_store_party_name, s11, ":var0"),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 10),
    ],
    "What news can you share of your travels? (You must pay 10 denars)",
    "tavern_traveler_rumors",
    [
      (troop_remove_gold, "trp_player", 10),
      (store_conversation_troop, ":var0"),
      (assign, reg33, 0),
      (call_script, "script_random_rumor_talk", 2, ":var0"),
    ]],

  [anyone, "tavern_traveler_rumors",
    [
      (lt, reg33, 80),
    ],
    "{s3} ",
    "trav_post_rumor",
    []],

  [anyone, "tavern_traveler_rumors",
    [
      (ge, reg33, 80),
    ],
    "{s3} -- Which reminds me I have an opportunity to discuss if you are interested.",
    "trav_post_rumor_bonus",
    []],

  [plyr|anyone, "trav_post_rumor_bonus",
    [],
    "Perhaps. What is it?",
    "trav_post_rumor_bonus_offer",
    []],

  [plyr|anyone, "trav_post_rumor_bonus",
    [],
    "No, your story is quite enough.",
    "tavern_traveler_rumors_end1",
    []],

  [anyone, "trav_post_rumor_bonus_offer",
    [],
    "{s3}",
    "trav_post_rumor_bonus_offer_reply",
    [
      (store_num_parties_of_template, ":var0", "pt_treasure_lair"),
      (assign, ":var1", "$event_rand_0"),
      (val_abs, ":var1"),
      (try_begin),
        (eq, ":var0", 0),
        (store_mod, ":var2", ":var1", 12),
      (else_try),
        (store_mod, ":var2", ":var1", 10),
      (try_end),
      (try_begin),
        (lt, ":var2", 5),
        (assign, reg55, "trp_bonus_chest_1"),
      (else_try),
        (lt, ":var2", 10),
        (assign, reg55, "trp_bonus_chest_3"),
      (else_try),
        (assign, reg55, "trp_bonus_chest_2"),
      (try_end),
      (store_add, ":var3", ":var2", "str_rumor_bonus_traveler_1"),
      (str_store_string, s3, ":var3"),
    ]],

  [plyr|anyone, "trav_post_rumor_bonus_offer_reply",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 200),
    ],
    "Yes I would part with 200 denars for that.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", 200),
      (assign, ":var0", 1),
      (try_begin),
        (eq, reg55, "trp_bonus_chest_2"),
        (assign, ":var0", 2),
      (try_end),
      (store_random_in_range, ":var1", 1, 6),
      (val_mul, ":var1", ":var0"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_add_item, reg55, "itm_loot", imod_plain),
      (try_end),
      (reset_item_probabilities, 100),
      (set_merchandise_modifier_quality, 250),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_body_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_body_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_head_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_head_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_foot_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_foot_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_hand_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_body_armor, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_one_handed_wpn, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_one_handed_wpn, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_two_handed_wpn, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_two_handed_wpn, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_shield, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_shield, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_polearm, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_bow, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_crossbow, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_thrown, 1),
      (try_end),
      (store_random_in_range, ":var3", 0, 100),
      (val_div, ":var3", ":var0"),
      (try_begin),
        (lt, ":var3", 10),
        (troop_add_merchandise, reg55, itp_type_arrows, 1),
      (try_end),
      (try_begin),
        (eq, reg55, "trp_bonus_chest_1"),
        (display_log_message, "@ Search Rane for a hidden chest or cache of treasure."),
      (else_try),
        (eq, reg55, "trp_bonus_chest_3"),
        (display_log_message, "@ Search Valonbray for a hidden chest or cache of treasure"),
      (else_try),
        (eq, reg55, "trp_bonus_chest_2"),
        (store_random_in_range, ":var4", "p_village_1", "p_salt_mine"),
        (str_store_party_name_link, s9, ":var4"),
        (set_spawn_radius, 4),
        (spawn_around_party, ":var4", "pt_treasure_lair"),
        (display_log_message, "@ Search for a bandit treasure cache near {s9}!"),
      (try_end),
    ]],

  [plyr|anyone, "trav_post_rumor_bonus_offer_reply",
    [],
    "No thanks, not right now.",
    "tavern_traveler_talk",
    []],

  [plyr|anyone, "trav_post_rumor",
    [],
    "Thank you, that was interesting.",
    "tavern_traveler_rumors_end1",
    []],

  [anyone, "tavern_traveler_rumors_end1",
    [],
    "Is there anything else I can help you with?",
    "tavern_traveler_talk",
    []],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (eq, "$background_answer_3", 19),
      (eq, "$g_spy_talk_cb5", 1),
    ],
    "Do you know of anyone in need of a healer?",
    "tavern_traveler_healer_start",
    []],

  [anyone, "tavern_traveler_healer_start",
    [
      (neq, reg45, 0),
    ],
    "No, not at this time. Try later.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_healer_start",
    [
      (eq, reg45, 0),
      (store_random_in_range, ":var0", 3, 103),
      (store_current_day, ":var1"),
      (assign, reg46, ":var0"),
      (store_sub, ":var2", ":var1", "$g_bard_job"),
      (assign, reg47, ":var2"),
      (assign, reg45, ":var0"),
      (lt, ":var0", 90),
      (try_begin),
        (lt, ":var0", 90),
        (gt, ":var2", 1),
        (store_random_in_range, ":var3", 1, 4),
        (try_begin),
          (eq, ":var3", 1),
          (str_store_string, s9, "str_cb5_s_medic_yes_1"),
        (else_try),
          (eq, ":var3", 2),
          (str_store_string, s9, "str_cb5_s_medic_yes_2"),
        (else_try),
          (str_store_string, s9, "str_cb5_s_medic_yes_3"),
        (try_end),
      (else_try),
        (assign, reg45, 1),
        (str_store_string, s9, "str_cb5_s_medic_no"),
      (try_end),
    ],
    "{s9}",
    "tavern_traveler_medic_accept",
    []],

  [plyr|anyone, "tavern_traveler_medic_accept",
    [
      (lt, reg45, 3),
    ],
    "Very well. Perhaps later then.",
    "tavern_traveler_pretalk",
    []],

  [plyr|anyone, "tavern_traveler_medic_accept",
    [
      (gt, reg45, 1),
    ],
    "Show me to the Patient...",
    "close_window",
    [
      (store_random_in_range, ":var0", 15, 40),
      (party_get_slot, ":var1", "$current_town", 50),
      (val_div, ":var1", 20),
      (store_skill_level, ":var2", skl_first_aid, "trp_player"),
      (val_add, ":var0", ":var1"),
      (store_mul, ":var3", ":var0", ":var2"),
      (val_add, ":var3", ":var1"),
      (troop_add_gold, "trp_player", ":var3"),
      (assign, reg1, ":var3"),
      (display_log_message, "@ You work several hours tending to your patient and are paid {reg1} denars for your trouble."),
      (store_div, ":var4", ":var2", 3),
      (call_script, "script_change_player_party_morale", ":var4"),
      (play_track, "track_bard", 1),
      (store_current_day, ":var5"),
      (assign, "$g_bard_job", ":var5"),
      (assign, reg45, 0),
      (assign, "$g_leave_town", 1),
      (rest_for_hours, 2, 2, 0),
      (finish_mission),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [],
    "I am looking for one of my companions...",
    "tavern_traveler_companion_location",
    []],

  [anyone, "tavern_traveler_companion_location",
    [],
    "Maybe I can help you. Who are you looking for?",
    "tavern_traveler_companion_location_ask",
    []],

  [repeat_for_troops|plyr|anyone, "tavern_traveler_companion_location_ask",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_slot_ge, ":var0", 82, 1),
      (assign, ":var1", 0),
      (try_begin),
        (this_or_next|troop_slot_ge, ":var0", 12, 1),
        (troop_slot_ge, ":var0", 8, 0),
        (assign, ":var1", 1),
      (try_end),
      (eq, ":var1", 1),
      (str_store_troop_name, s11, ":var0"),
    ],
    "{s11}",
    "tavern_traveler_companion_location_ask_2",
    [
      (store_repeat_object, "$temp"),
    ]],

  [plyr|anyone, "tavern_traveler_companion_location_ask",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_companion_location_ask_2",
    [
      (str_store_troop_name, s15, "$temp"),
    ],
    "I guess I know where {s15} is. For 30 denars, I'll tell you.",
    "tavern_traveler_companion_location_ask_money",
    []],

  [plyr|anyone, "tavern_traveler_companion_location_ask_money",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 30),
    ],
    "All right. Here is 30 denars.",
    "tavern_traveler_companion_location_tell",
    [
      (troop_remove_gold, "trp_player", 30),
    ]],

  [plyr|anyone, "tavern_traveler_companion_location_ask_money",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_companion_location_tell",
    [],
    "{s15} is currently at {s11}.{s12}",
    "tavern_traveler_pretalk",
    [
      (str_store_troop_name, s15, "$temp"),
      (try_begin),
        (troop_slot_ge, "$temp", 12, 1),
        (troop_get_slot, ":var0", "$temp", 12),
        (str_store_string, s12, "str_space"),
      (else_try),
        (troop_get_slot, ":var0", "$temp", 8),
        (try_begin),
          (is_between, ":var0", "p_town_1", "p_castle_1"),
          (str_store_string, s13, "str_town"),
        (else_try),
          (str_store_string, s13, "str_castle"),
        (try_end),
        (troop_get_type, reg4, "$temp"),
        (str_store_string, s12, "str__but_he_is_holding_there_as_a_prisoner_at_dungeon_of_s13"),
      (try_end),
      (try_begin),
        (party_is_active, ":var0"),
        (str_store_party_name, s11, ":var0"),
      (else_try),
        (str_store_party_name, s11, "str_prisoner_at_large"),
      (try_end),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [],
    "I am looking for traveling peddlers...",
    "tavern_traveler_peddler_location",
    []],

  [anyone, "tavern_traveler_peddler_location",
    [],
    "Maybe I can help you. Who are you looking for?",
    "tavern_traveler_peddler_location_ask",
    []],

  [plyr|anyone, "tavern_traveler_peddler_location_ask",
    [],
    "Finneas de Digit.",
    "tavern_traveler_peddler_location_ask_2",
    [
      (assign, "$temp", "trp_tavern_bookseller_1"),
    ]],

  [plyr|anyone, "tavern_traveler_peddler_location_ask",
    [],
    "Brother Randalf.",
    "tavern_traveler_peddler_location_ask_2",
    [
      (assign, "$temp", "trp_tavern_bookseller_2"),
    ]],

  [plyr|anyone, "tavern_traveler_peddler_location_ask",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_peddler_location_ask_2",
    [
      (str_store_troop_name, s15, "$temp"),
    ],
    "I guess I know where {s15} is. For 50 denars, I'll tell you.",
    "tavern_traveler_peddler_location_ask_money",
    []],

  [plyr|anyone, "tavern_traveler_peddler_location_ask_money",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 50),
    ],
    "All right. Here are 50 denars.",
    "tavern_traveler_peddler_location_tell",
    [
      (troop_remove_gold, "trp_player", 50),
    ]],

  [plyr|anyone, "tavern_traveler_peddler_location_ask_money",
    [],
    "Never mind.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "tavern_traveler_peddler_location_tell",
    [],
    "{s15} is currently at {s16}.",
    "tavern_traveler_pretalk",
    [
      (str_store_troop_name, s15, "$temp"),
      (str_store_string, s16, "@a hidden outpost far from here"),
      (try_for_range, ":var0", "p_town_1", "p_castle_1"),
        (party_slot_eq, ":var0", 98, "$temp"),
        (str_store_party_name, s16, ":var0"),
      (try_end),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (check_quest_active, "qst_order_grandmaster"),
      (quest_slot_eq, "qst_order_grandmaster", 11, 2),
    ],
    "Have you heard anything unusual about the Snake Cult recently?",
    "traveler_snakes",
    []],

  [anyone, "traveler_snakes",
    [
      (store_add, ":var0", "$g_talk_troop", "$current_town"),
      (val_mod, ":var0", 5),
      (neq, ":var0", 0),
    ],
    "I wouldn't know anything about the damned Snakes. Not in front of everyone here, at any rate.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "traveler_snakes",
    [],
    "Please, keep your voice down... For a few coins I might know something of interest. I'm risking my good health here, so don't be cross if I ask for a mere 100 gold. It's worth every coin.",
    "traveler_snakes_pay",
    []],

  [plyr|anyone, "traveler_snakes_pay",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 100),
    ],
    "This better be worth it. Here are 100 denars.",
    "traveler_snakes_quest",
    [
      (troop_remove_gold, "trp_player", 100),
    ]],

  [plyr|anyone, "traveler_snakes_pay",
    [],
    "Sorry, that's not what it's worth to me.",
    "tavern_traveler_pretalk",
    []],

  [anyone, "traveler_snakes_quest",
    [],
    "Now, listen closely for it's quite an extraordinary tale.^A week ago my cousin happened to travel near {s8}. The roads there should be safe, or so he thought. He was having a lunch in the small woods by the roadside, when suddenly a small party of Snakes rode down the road, screeching and hissing as is their wont.^He quickly hid from view, but was able to discern a few utterings as they rode by - something about 'Grandmaster sacrifice' and 'hidden stronghold' - I can't make the heads or tails of it, but someone learned may be able to help. Perhaps Order scribes?^Anyway, they are up to no good and I hope you can stop them.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_order_grandmaster", 12),
      (assign, ":var1", 1000000),
      (assign, ":var2", -1),
      (store_add, ":var3", "p_stronghold_pos1", 6),
      (try_for_range, ":var4", "p_stronghold_pos1", ":var3"),
        (store_distance_to_party_from_party, ":var5", ":var0", ":var4"),
        (lt, ":var5", ":var1"),
        (assign, ":var1", ":var5"),
        (assign, ":var2", ":var4"),
      (try_end),
      (party_get_position, pos0, ":var2"),
      (party_set_position, "p_snake_stronghold", pos0),
      (assign, ":var1", 1000000),
      (assign, ":var6", -1),
      (try_for_range, ":var7", "p_town_1", "p_salt_mine"),
        (store_distance_to_party_from_party, ":var5", ":var7", "p_snake_stronghold"),
        (lt, ":var5", ":var1"),
        (assign, ":var1", ":var5"),
        (assign, ":var6", ":var7"),
      (try_end),
      (quest_set_slot, "qst_order_grandmaster", 1, ":var6"),
      (str_store_party_name, s8, ":var6"),
      (quest_set_slot, "qst_order_grandmaster", 11, 3),
      (str_store_string, s3, "@Report back to the Order with your findings about Cult activity near {s8}."),
      (add_quest_note_from_sreg, "qst_order_grandmaster", 2, s3, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|anyone, "tavern_traveler_talk",
    [
      (eq, "$g_talk_troop", "trp_tavern_traveler_8"),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 400),
      (troop_get_inventory_slot, ":var1", "trp_player", ek_body),
      (gt, ":var1", -1),
      (call_script, "script_armor_has_cape_capeless_version", ":var1"),
      (gt, reg33, -1),
      (gt, reg34, -1),
      (assign, reg35, ":var1"),
    ],
    "What else do you offer?",
    "traveler_cape_1",
    []],

  [anyone, "traveler_cape_1",
    [
      (str_clear, s59),
      (try_begin),
        (eq, reg35, reg33),
        (str_store_string, s59, "@It just so happens I outfit many lords, many of whom wear regal-like adornments. I also happen to be one of the finest seamstresses in the entire land. For a small price I can fashion you a glorious cape to match your armor."),
      (else_try),
        (this_or_next|eq, reg35, "itm_griffon_captain_armor_cape_white"),
        (eq, reg35, "itm_griffon_captain_armor_cape_black"),
        (assign, reg33, "itm_griffon_captain_armor"),
        (str_store_string, s59, "@Well, as it so happens, bandits or those rapscallion Red Brotherhood have been sacking caravans from merchants I purchase silk from. If it causes you no worry, if you are interested, would you be willing to part ways with your cape so I may complete other orders? I would pay you for your troubles of course. Considering my talents, if you decide to change your mind after our transaction, I should be able to form you another cape with previous ones you have sold to me."),
      (else_try),
        (eq, reg35, reg34),
        (str_store_string, s59, "@Well, as it so happens, bandits or those rapscallion Red Brotherhood have been sacking caravans from merchants I purchase silk from. If it causes you no worry, if you are interested, would you be willing to part ways with your cape so I may complete other orders? I would pay you for your troubles of course. Considering my talents, if you decide to change your mind after our transaction, I should be able to form you another cape with previous ones you have sold to me."),
      (try_end),
    ],
    "{s59}",
    "traveler_cape_2",
    []],

  [plyr|anyone, "traveler_cape_2",
    [
      (neq, reg35, "itm_griffon_captain_armor"),
    ],
    "Sounds good.",
    "traveler_cape_3",
    [
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", ek_body),
      (troop_set_inventory_slot, "trp_player", ek_body, -1),
      (try_begin),
        (eq, reg35, reg33),
        (troop_remove_gold, "trp_player", 400),
        (troop_set_inventory_slot, "trp_player", ek_body, reg34),
        (troop_set_inventory_slot_modifier, "trp_player", ek_body, ":var0"),
      (else_try),
        (this_or_next|eq, reg35, reg34),
        (this_or_next|eq, reg35, "itm_griffon_captain_armor_cape_white"),
        (eq, reg35, "itm_griffon_captain_armor_cape_black"),
        (troop_add_gold, "trp_player", 100),
        (troop_set_inventory_slot, "trp_player", ek_body, reg33),
        (troop_set_inventory_slot_modifier, "trp_player", ek_body, ":var0"),
      (try_end),
      (troop_clear_inventory, "trp_temp_troop"),
      (change_screen_loot, "trp_temp_troop"),
    ]],

  [plyr|anyone, "traveler_cape_2",
    [
      (eq, reg35, "itm_griffon_captain_armor"),
    ],
    "Sounds good. White cape please.",
    "traveler_cape_3",
    [
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", ek_body),
      (troop_set_inventory_slot, "trp_player", ek_body, -1),
      (try_begin),
        (troop_remove_gold, "trp_player", 400),
        (troop_set_inventory_slot, "trp_player", ek_body, "itm_griffon_captain_armor_cape_white"),
        (troop_set_inventory_slot_modifier, "trp_player", ek_body, ":var0"),
      (try_end),
      (troop_clear_inventory, "trp_temp_troop"),
      (change_screen_loot, "trp_temp_troop"),
    ]],

  [plyr|anyone, "traveler_cape_2",
    [
      (eq, reg35, "itm_griffon_captain_armor"),
    ],
    "Black cape looks better.",
    "traveler_cape_3",
    [
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", ek_body),
      (troop_set_inventory_slot, "trp_player", ek_body, -1),
      (try_begin),
        (troop_remove_gold, "trp_player", 400),
        (troop_set_inventory_slot, "trp_player", ek_body, "itm_griffon_captain_armor_cape_black"),
        (troop_set_inventory_slot_modifier, "trp_player", ek_body, ":var0"),
      (try_end),
      (troop_clear_inventory, "trp_temp_troop"),
      (change_screen_loot, "trp_temp_troop"),
    ]],

  [plyr|anyone, "traveler_cape_2",
    [],
    "Maybe next time.",
    "close_window",
    []],

  [anyone, "traveler_cape_3",
    [],
    "Thank you.",
    "close_window",
    []],

  [plyr|anyone, "tavern_traveler_talk",
    [],
    "Farewell.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
      (party_get_slot, ":var0", "$g_encountered_party", 97),
      (str_store_faction_name, s17, ":var0"),
    ],
    "Greetings. They say you're the kind of {reg63?man:woman} who'd be interested to hear that I travel frequently to {s17}. I'll tell you all I know for a mere 100 denars.",
    "tavern_traveler_answer",
    []],

  [plyr|anyone, "tavern_traveler_answer",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 100),
    ],
    "Here's 100 denars. Tell me what you know.",
    "tavern_traveler_continue",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 97),
      (call_script, "script_update_faction_traveler_notes", ":var0"),
      (change_screen_notes, 2, ":var0"),
    ]],

  [plyr|anyone, "tavern_traveler_answer",
    [],
    "Sorry friend. I am not interested.",
    "close_window",
    []],

  [anyone, "tavern_traveler_continue",
    [],
    "Well, that's all I can tell you. Good bye.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", 100),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_bookseller_1", "trp_tavern_minstrel_1"),
    ],
    "Good day {reg63?sir:madam}, will you be looking at my books or perhaps something else may interest you?",
    "bookseller_talk",
    [
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [plyr|anyone, "bookseller_talk",
    [],
    "Yes. Show me what goods do you have for sale.",
    "bookseller_buy",
    []],

  [plyr|anyone, "bookseller_talk",
    [
      (eq, "$g_talk_troop", "trp_tavern_bookseller_3"),
    ],
    "What news can you share of your travels?",
    "bookseller_3_rumors",
    []],

  [plyr|anyone, "bookseller_talk",
    [],
    "What else do you offer?",
    "bookseller_special",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var1", 82, 0),
        (troop_slot_ge, ":var1", 12, 1),
        (val_add, ":var0", 1),
      (try_end),
      (assign, "$temp", ":var0"),
    ]],

  [plyr|anyone, "bookseller_talk",
    [
      (check_quest_active, "qst_old_tale_part_1"),
      (quest_slot_eq, "qst_old_tale_part_1", 11, 4),
      (quest_slot_eq, "qst_old_tale_part_1", 6, "$g_talk_troop"),
    ],
    "I have found the ruins and discovered some information.",
    "bookseller_3_quest_end_1",
    []],

  [anyone, "bookseller_buy",
    [],
    "Of course {reg63?sir:madam}.",
    "book_trade_completed",
    [
      (change_screen_trade),
    ]],

  [anyone, "bookseller_special",
    [
      (eq, "$g_talk_troop", "trp_tavern_bookseller_2"),
      (try_begin),
        (party_is_active, "p_salt_mine"),
        (str_store_string, s2, "@I have already shown you the location of the mines of Al-Aziz, there is nothing else I have to trade to you besides my books!"),
      (else_try),
        (str_store_string, s2, "@I can show you where the hidden mines of Al-Aziz are located in exchange for a Large Pouch of Diamonds.^ I will show you on your map so you can enter and explore it."),
      (try_end),
    ],
    "{s2}",
    "azziz_map_trade",
    []],

  [plyr|anyone, "azziz_map_trade",
    [
      (try_begin),
        (party_is_active, "p_salt_mine"),
        (str_store_string, s5, "@Oh! Yes, that's right. Too much strong drink has affected my memory. Who are you again?"),
      (else_try),
        (neg|player_has_item, "itm_diamond_large"),
        (str_store_string, s5, "@I do not have such a gems to trade."),
      (else_try),
        (str_store_string, s5, "@No, I am not interested in that map at the moment."),
      (try_end),
    ],
    "{s5}",
    "special_fail",
    []],

  [plyr|anyone, "azziz_map_trade",
    [
      (player_has_item, "itm_diamond_large"),
      (neg|party_is_active, "p_salt_mine"),
    ],
    "Yes! Here are the gems. Show me where the hidden mines are located.",
    "book_trade_completed",
    [
      (disable_party, "p_salt_mine"),
      (store_random_in_range, ":var0", 0, 40),
      (try_begin),
        (lt, ":var0", 10),
        (party_get_position, pos1, "p_ringer_1_spawn_point"),
        (position_get_y, reg1, pos1),
        (try_begin),
          (gt, reg1, 13600),
          (position_set_y, pos1, 13400),
          (party_set_position, "p_ringer_1_spawn_point", pos1),
        (try_end),
        (party_relocate_near_party, "p_salt_mine", "p_ringer_1_spawn_point", 0),
      (else_try),
        (lt, ":var0", 20),
        (party_relocate_near_party, "p_salt_mine", "p_ringer_2_spawn_point", 0),
      (else_try),
        (lt, ":var0", 30),
        (party_relocate_near_party, "p_salt_mine", "p_ringer_3_spawn_point", 0),
      (else_try),
        (party_relocate_near_party, "p_salt_mine", "p_ringer_4_spawn_point", 0),
      (try_end),
      (enable_party, "p_salt_mine"),
      (troop_remove_item, "trp_player", "itm_diamond_large"),
      (display_log_message, "@ You have discovered the hidden location of Al-Aziz!"),
    ]],

  [anyone, "bookseller_special",
    [
      (eq, "$g_talk_troop", "trp_tavern_bookseller_1"),
      (str_clear, s12),
      (try_begin),
        (ge, "$g_elixir_uses", 3),
        (str_store_string, s12, "@^Unfortunately, after three uses of any combination, these wondrous alchemical marvels will lose their potency on you and their effects are halved."),
      (try_end),
    ],
    "For a single rare gem, a Qualis gem to be exact, I can offer you either an elixir of Arkon, a potion of Janus or the Dust of Twilight. The Elixir of Arkon will enhance your combat proficiency, as well as increase your strength, agility and charisma. It will also improve your luck and make you feel much younger. The Potion of Janus will increase your knowledge of all things and the Dust of Twilight will help your companions. {s12}",
    "elixir_trade",
    []],

  [plyr|anyone, "elixir_trade",
    [
      (neg|player_has_item, "itm_qualis"),
    ],
    "I do not have such a gem to trade.",
    "special_fail",
    []],

  [plyr|anyone, "elixir_trade",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Yes! Here is the Gem and I will drink the elixir now!",
    "book_trade_completed",
    [
      (assign, ":var0", 2),
      (assign, ":var1", 30),
      (try_begin),
        (ge, "$g_elixir_uses", 3),
        (assign, ":var0", 1),
        (assign, ":var1", 15),
      (try_end),
      (val_add, "$g_elixir_uses", 1),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_raise_attribute, "trp_player", ca_strength, ":var0"),
      (troop_raise_attribute, "trp_player", ca_agility, ":var0"),
      (troop_raise_attribute, "trp_player", ca_charisma, ":var0"),
      (troop_raise_proficiency_linear, "trp_player", wpt_one_handed_weapon, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_two_handed_weapon, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_polearm, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_crossbow, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_archery, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_throwing, ":var1"),
      (troop_raise_proficiency_linear, "trp_player", wpt_firearm, ":var1"),
      (val_add, "$g_player_luck", ":var1"),
      (assign, reg2, ":var0"),
      (assign, reg3, ":var1"),
      (display_log_message, "@ Your Strength, Agility and Charisma have increased by {reg2}."),
      (display_log_message, "@ Your weapon proficiencies have increased by {reg3}."),
    ]],

  [plyr|anyone, "elixir_trade",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Yes! Here is the Gem and I will drink the Potion of Janus now!",
    "book_trade_completed",
    [
      (assign, ":var0", 2),
      (try_begin),
        (ge, "$g_elixir_uses", 3),
        (assign, ":var0", 1),
      (try_end),
      (val_add, "$g_elixir_uses", 1),
      (assign, reg2, ":var0"),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (troop_raise_attribute, "trp_player", ca_intelligence, ":var0"),
      (display_log_message, "@ Your Intelligence has been increased by {reg2}."),
    ]],

  [plyr|anyone, "elixir_trade",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Yes! Here is the Gem and I will use the Dust of Twilight right now!",
    "book_trade_completed",
    [
      (assign, ":var0", 2),
      (assign, ":var1", 40),
      (try_begin),
        (ge, "$g_elixir_uses", 3),
        (assign, ":var0", 1),
        (assign, ":var1", 20),
      (try_end),
      (assign, reg2, ":var0"),
      (assign, reg3, ":var1"),
      (val_add, "$g_elixir_uses", 1),
      (troop_remove_item, "trp_player", "itm_qualis"),
      (party_get_num_companion_stacks, ":var2", "p_main_party"),
      (try_for_range, ":var3", 1, ":var2"),
        (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
        (try_begin),
          (troop_is_hero, ":var4"),
          (str_store_troop_name, s5, ":var4"),
          (store_random_in_range, ":var5", 1, 7),
          (try_begin),
            (lt, ":var5", 3),
            (troop_raise_attribute, ":var4", ca_strength, ":var0"),
            (troop_raise_attribute, ":var4", ca_agility, ":var0"),
            (troop_raise_attribute, ":var4", ca_charisma, ":var0"),
            (display_log_message, "@ {s5}'s Strength, Agility and Charisma have increased!."),
          (else_try),
            (lt, ":var5", 6),
            (troop_raise_attribute, ":var4", ca_intelligence, ":var0"),
            (display_log_message, "@ {s5}'s Intelligence has increased!."),
          (else_try),
            (troop_raise_proficiency_linear, ":var4", wpt_one_handed_weapon, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_two_handed_weapon, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_polearm, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_crossbow, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_archery, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_throwing, ":var1"),
            (troop_raise_proficiency_linear, ":var4", wpt_firearm, ":var1"),
            (display_log_message, "@ {s5}'s weapon proficiencies has increased!."),
          (try_end),
        (try_end),
      (try_end),
    ]],

  [plyr|anyone, "elixir_trade",
    [
      (player_has_item, "itm_qualis"),
    ],
    "No, I am not interested in this now.",
    "special_fail",
    []],

  [anyone, "bookseller_3_rumors",
    [
      (quest_slot_eq, "qst_old_tale_part_1", 11, 0),
      (str_clear, s54),
      (str_store_party_name_link, s54, "p_village_69"),
    ],
    "Ah, something I recall a few weeks ago. I was traveling to Sarleon. On my way there I arrived to the village of {s54}, beautiful lands there. During the evening at the local tavern, just as the light faded, the farmers and locals began trickling in for spirits and food. Many resided in the center as I tuckered in at the corner. Unwanted attention has its flaws you know. A few elderly stock joined nearby, already very drunk. They began talking about a castle or ruins, rather. Distorted by the noise I also heard things like 'betrayal', 'massacre', 'fortress' ...",
    "bookseller_3_quest_1",
    []],

  [plyr|anyone, "bookseller_3_quest_1",
    [],
    "'Fortress' you said?",
    "bookseller_3_quest_2",
    []],

  [anyone, "bookseller_3_quest_2",
    [],
    "... Hmm, yes. I was so intrigued by their discussion that once I got to Sarleon I immediately went to the Great Library and tried to find more information. I found nothing. Nothing in their history books and no maps show any castles near {s54}. I have even asked a nearby Lions chronicler only to be told that what I heard was drunken nonsense and,  furthermore, that I shouldn't waste my time on it.^^But what those men described was so convincing, it seems like a missed opportunity to not investigate further.^^Would you be interested in a good old archaeological hunt?",
    "bookseller_3_quest_3",
    []],

  [plyr|anyone, "bookseller_3_quest_3",
    [],
    "I got some time on my hands, I'd be glad to discover these so called ruins, if they exist!",
    "book_trade_completed",
    [
      (quest_set_slot, "qst_old_tale_part_1", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_old_tale_part_1", 23, 0),
      (quest_set_slot, "qst_old_tale_part_1", 24, 0),
      (call_script, "script_reward_for_quest_per_player_level", 250, 100, 0, 0),
      (quest_set_slot, "qst_old_tale_part_1", 21, reg33),
      (quest_set_slot, "qst_old_tale_part_1", 22, reg34),
      (quest_set_slot, "qst_old_tale_part_1", 11, 1),
      (quest_set_slot, "qst_old_tale_part_1", 1, "p_old_ruins"),
      (party_get_slot, ":var0", "p_village_69", 25),
      (quest_set_slot, "qst_old_tale_part_1", 2, ":var0"),
      (str_clear, s54),
      (str_store_party_name_link, s54, "p_village_69"),
      (str_clear, s2),
      (str_store_string, s2, "@The scribe asked you to investigate the old tale of the lost {s54}'s castle."),
      (call_script, "script_start_quest", "qst_old_tale_part_1", "$g_talk_troop"),
      (str_clear, s3),
      (str_store_string, s3, "@Speak with the village elder to find out more."),
      (add_quest_note_from_sreg, "qst_old_tale_part_1", 3, s3, 0),
    ]],

  [plyr|anyone, "bookseller_3_quest_3",
    [],
    "No, I am not interested in this right now.",
    "special_fail",
    []],

  [anyone, "bookseller_3_quest_end_1",
    [],
    "Great news! Tell me what have you found.",
    "bookseller_3_quest_end_2",
    []],

  [plyr|anyone, "bookseller_3_quest_end_2",
    [
      (str_clear, s54),
      (str_store_party_name_link, s54, "p_village_69"),
    ],
    "At the beginning I visited {s54} and spoken with the elder. The elder was forward in noting that there were no other castles in the area, but only ruins. He mentioned they were located at the base of the nearby range, where the river first starts.",
    "bookseller_3_quest_end_3",
    []],

  [anyone, "bookseller_3_quest_end_3",
    [],
    "Very interesting, were his instructions clear?",
    "bookseller_3_quest_end_4",
    []],

  [plyr|anyone, "bookseller_3_quest_end_4",
    [],
    "Yes, I  decided to go follow the river and travel. Finding it wasn't easy, but as I got closer the mountain a path began appearing, a very old and worn path; still covered by forest and dense brush. Not much left by now. There are what I assume was once a castle which included remains of a gatehouse, foundations of few bigger houses and towers. It seems that some time ago a battle took place there. After further examination I have found old weapons and various rusty armor pieces, some with still a visible griffon heraldry. Upon further searching, I found a chest.",
    "bookseller_3_quest_end_5",
    []],

  [anyone, "bookseller_3_quest_end_5",
    [],
    "A chest? What was inside?!",
    "bookseller_3_quest_end_6",
    []],

  [plyr|anyone, "bookseller_3_quest_end_6",
    [],
    "Under a pile of rubble I discovered slightly damp oak chest. Inside was some equipment, which held a worn griffon symbol accompanied by an old book. To be more specific: the diary of a long forgotten knight ...",
    "bookseller_3_quest_end_7",
    []],

  [anyone, "bookseller_3_quest_end_7",
    [],
    "A knight you say? Interesting ...",
    "bookseller_3_quest_end_8",
    []],

  [plyr|anyone, "bookseller_3_quest_end_8",
    [],
    "It seems that those ruins were once a castle, which 60 Griffon Knights called 'home'.^^The last few pages described preparations to a feast organized by the commander, who was to host for the Lion's grandmaster. A 300 or so strong delegation was expected.^^Based on what I have seen on site and knowing some history of both orders, it is not hard to imagine what had unfolded there.",
    "bookseller_3_quest_end_9",
    []],

  [anyone, "bookseller_3_quest_end_9",
    [],
    "I am familiar with this story, the Gairbolt Massacre. In summary, it explains of the vanquishing of the royal Griffon Knights, still loyal to the non-existent Pendorian Monarchy. It was known that the Griffons had rough relations with the Lions. Furthermore, Lions have recorded that they indeed did wipe the remaining Order. No one knows when or where exactly, those details were expunged from records ... ^^So where is the book? I'd like to inspect it's contents for authenticity and archival reasons of course!",
    "bookseller_3_quest_end_10",
    []],

  [plyr|anyone, "bookseller_3_quest_end_10",
    [],
    "Erm ... As I said it was an old book and was very fragile. I was very careful, but it simply fell apart, turned into dust.",
    "bookseller_3_quest_end_11",
    []],

  [anyone, "bookseller_3_quest_end_11",
    [],
    "It would be hard to know if this place you found was the sight of the massacre and, with no evidence of a primary source, it cannot be authenticated. Maybe for the best ... ^^I think it best we drop this anyway. It would be rather dangerous to spread information like this as Order of the Lion may take offense. We don't need unnecessary attention anyway.",
    "bookseller_3_quest_end_12",
    [
      (quest_set_slot, "qst_old_tale_part_1", 11, 5),
      (call_script, "script_finish_quest_simple", "qst_old_tale_part_1", 100),
    ]],

  [plyr|anyone, "bookseller_3_quest_end_12",
    [],
    "Perhaps you are right. Creating rumors may only come back to bite us in the end. But something tells me there is more to this place, almost as if it draws me there.",
    "bookseller_3_quest_end_13",
    []],

  [anyone, "bookseller_3_quest_end_13",
    [],
    "I have been thinking ... It seems to be quite well hidden and, in fact, not many people know about its location. Perhaps you could use it for something?",
    "bookseller_3_quest_end_14",
    []],

  [plyr|anyone, "bookseller_3_quest_end_14",
    [],
    "Actually, I have an idea.",
    "close_window",
    [
      (quest_set_slot, "qst_old_tale_part_2", 6, "trp_player"),
      (quest_set_slot, "qst_old_tale_part_2", 23, 0),
      (quest_set_slot, "qst_old_tale_part_2", 24, 0),
      (call_script, "script_reward_for_quest_per_player_level", 400, 100, 0, 0),
      (quest_set_slot, "qst_old_tale_part_2", 21, reg33),
      (quest_set_slot, "qst_old_tale_part_2", 22, reg34),
      (quest_set_slot, "qst_old_tale_part_2", 11, 1),
      (quest_set_slot, "qst_old_tale_part_2", 1, "p_old_ruins"),
      (party_get_slot, ":var0", "p_village_69", 25),
      (quest_set_slot, "qst_old_tale_part_2", 2, ":var0"),
      (str_clear, s2),
      (str_store_string, s2, "@Vorador further suggested the valley is located in the central region of Pendor, but at the same time is quite remote, which in turn not many people know about its existence. It seems to be a good place to establish a small permanent base."),
      (call_script, "script_start_quest", "qst_old_tale_part_2", "trp_player"),
      (str_clear, s54),
      (str_store_party_name_link, s54, "p_village_69"),
      (str_clear, s3),
      (str_store_string, s3, "@The valley need some work to make it more hospitable. Skilled manpower needs to be organized and {s54} seems to be a good place to start."),
      (add_quest_note_from_sreg, "qst_old_tale_part_2", 3, s3, 0),
      (finish_mission),
    ]],

  [plyr|anyone, "bookseller_3_quest_end_14",
    [],
    "No, this is something I won't pursue. (decision is final)",
    "close_window",
    []],

  [anyone, "bookseller_3_rumors",
    [
      (this_or_next|party_is_active, "p_old_ruins"),
      (quest_slot_ge, "qst_old_tale_part_1", 11, 1),
      (store_random_in_range, "$temp", 0, 100),
      (str_clear, s2),
      (try_begin),
        (lt, "$temp", 20),
        (store_random_in_range, ":var0", 0, 20),
        (store_add, ":var1", ":var0", "str_bookseller_3_rumor_1"),
        (str_store_string, s2, ":var1"),
      (else_try),
        (store_random_in_range, ":var0", 0, 3),
        (store_add, ":var1", ":var0", "str_bookseller_3_rumor_nonews_1"),
        (str_store_string, s2, ":var1"),
      (try_end),
    ],
    "{s2}",
    "bookseller_3_rumors_1",
    []],

  [plyr|anyone, "bookseller_3_rumors_1",
    [
      (str_clear, s2),
      (try_begin),
        (lt, "$temp", 20),
        (store_random_in_range, ":var0", 0, 3),
        (store_add, ":var1", ":var0", "str_bookseller_3_rumor_resp_1"),
        (str_store_string, s2, ":var1"),
      (else_try),
        (str_store_string, s2, "str_bookseller_3_rumor_resp_4"),
      (try_end),
    ],
    "{s2}",
    "book_trade_completed",
    []],

  [anyone, "bookseller_special",
    [
      (eq, "$g_talk_troop", "trp_tavern_bookseller_3"),
      (eq, "$temp", 0),
    ],
    "I believe I have no information to offer, at this time. Anything else?",
    "bookseller_talk",
    []],

  [anyone, "bookseller_special",
    [
      (eq, "$g_talk_troop", "trp_tavern_bookseller_3"),
      (gt, "$temp", 0),
    ],
    "For a ... hmm ... small and gracious voluntary donation for our University, I could share my knowledge about locations of some truly remarkable people. Some of whom you may know.",
    "get_info",
    []],

  [plyr|anyone, "get_info",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", 300),
    ],
    "Unfortunately I do not have any spare denars.",
    "special_fail",
    []],

  [plyr|anyone, "get_info",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "Please accept my 'totally voluntary donation' of 300 denars.",
    "book_trade_completed",
    [
      (troop_remove_gold, "trp_player", 300),
      (str_clear, s54),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (troop_slot_eq, ":var0", 82, 0),
        (troop_slot_ge, ":var0", 12, 1),
        (troop_get_slot, ":var1", ":var0", 12),
        (str_store_troop_name, s52, ":var0"),
        (str_store_party_name, s53, ":var1"),
        (str_store_string, s54, "@{!}{s52} - {s53}^{s54}"),
      (try_end),
      (display_message, "@{s54}", 0xFF2222),
    ]],

  [plyr|anyone, "get_info",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "No, I am not interested in this now.",
    "special_fail",
    []],

  [anyone, "special_fail",
    [],
    "That is unfortunate. Perhaps then I can help with something else?",
    "bookseller_talk",
    []],

  [anyone, "book_trade_completed",
    [],
    "Anything else?",
    "bookseller_talk",
    []],

  [plyr|anyone, "bookseller_talk",
    [],
    "Nothing. Thanks.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_tavern_minstrel_1", "trp_kingdom_heroes_including_player_begin"),
    ],
    "Greetings to you, {reg63?most noble sir:most noble lady}.",
    "minstrel_1",
    []],

  [plyr|anyone, "minstrel_1",
    [
      (eq, "$minstrels_introduced", 0),
    ],
    "What is it you do?",
    "minstrel_job_description",
    [
      (assign, "$minstrels_introduced", 1),
    ]],

  [plyr|anyone, "minstrel_1",
    [
      (eq, "$minstrels_introduced", 1),
    ],
    "I have some questions about courtship in Pendor",
    "minstrel_courtship_questions",
    []],

  [plyr|anyone, "minstrel_1",
    [
      (eq, "$minstrels_introduced", 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Can you teach me any poems?",
    "minstrel_courtship_poem",
    []],

  [anyone, "minstrel_courtship_poem",
    [
      (eq, "$allegoric_poem_recitations", 0),
      (this_or_next|eq, "$g_talk_troop", "trp_tavern_minstrel_1"),
      (eq, "$g_talk_troop", "trp_tavern_minstrel_5"),
    ],
    "I can teach you the poem, 'The Storming of the Castle of Love.' It is short enough to be easily learned. It is an allegoric poem, replete with symbols and metaphor. It describes how a brave but rough warrior wins the heart of his lady by learning the virtues of chivalry, becoming a true and noble knight. Its theme -- that the role of a woman is to inspire but also civilize a man -- is appreciated by some noble ladies, but not all.",
    "minstrel_courtship_poem_teach",
    [
      (assign, "$poem_selected", 5),
    ]],

  [anyone, "minstrel_courtship_poem",
    [
      (eq, "$mystic_poem_recitations", 0),
      (this_or_next|eq, "$g_talk_troop", "trp_tavern_minstrel_3"),
      (eq, "$g_talk_troop", "trp_tavern_minstrel_1"),
    ],
    "I can teach you the poem, 'The Heart's Desire.' It is a lyrical poem, which can be interpreted either erotically or spiritually. The lover realizes the majesty of the divine by gazing upon the body of his beloved. I believe that it appeals to women of a certain romantic temperament, but you risk scandalizing or boring others.",
    "minstrel_courtship_poem_teach",
    [
      (assign, "$poem_selected", 4),
    ]],

  [anyone, "minstrel_courtship_poem",
    [
      (eq, "$tragic_poem_recitations", 0),
      (this_or_next|eq, "$g_talk_troop", "trp_tavern_minstrel_3"),
      (eq, "$g_talk_troop", "trp_tavern_minstrel_2"),
    ],
    "I can teach you the tale of Kais and Layala. It is a sad and simple story -- the shepherd boy Kais and the nobleman's daughter Layala love each other, but they can never marry. The poem is Kais' lament as he wanders alone, unwilling to forget his true love, driving himself mad with longing. Some ladies melt at the sweetness of his sorrows; others glaze over at his self-pity.",
    "minstrel_courtship_poem_teach",
    [
      (assign, "$poem_selected", 1),
    ]],

  [anyone, "minstrel_courtship_poem",
    [
      (eq, "$heroic_poem_recitations", 0),
      (this_or_next|eq, "$g_talk_troop", "trp_tavern_minstrel_4"),
      (eq, "$g_talk_troop", "trp_tavern_minstrel_2"),
    ],
    "I can teach you part of the saga of Helgerad and Kara. It is a heroic tale, full of blood and battle. The shieldmaiden Kara chooses the warrior Helgered as her lover, as he is the only man who can defeat her in combat. Her father, who pledged her to another, comes with his sons and his huscarls to kill Helgered. They fight, and Helgered and Kara slaughter the entire host except for Kara's beloved younger brother -- who, alas, grows up to avenge his father by slaying Helgered. The depiction of warrior and shieldmaiden as equals will appeal to some women, but a mail-wearing, blood-spattered heroine will shock and repulse others.",
    "minstrel_courtship_poem_teach",
    [
      (assign, "$poem_selected", 2),
    ]],

  [anyone, "minstrel_courtship_poem",
    [
      (eq, "$comic_poem_recitations", 0),
      (this_or_next|eq, "$g_talk_troop", "trp_tavern_minstrel_5"),
      (eq, "$g_talk_troop", "trp_tavern_minstrel_4"),
    ],
    "I can teach you the poem, 'An Argument in the Garden' It is a comic poem, which satirizes the conventions of courtly love. A lover steals into a garden in Ethos, and plies his lover with lots of witty lines to persuade her to submit to his embraces. She shoots down all of his advances one by one, then when he is downcast, she takes him in her arms and tells him that she wanted him all along, except on her terms, not his. A lady with a sense of humor may find it amusing, but others might feel that they are the ones being mocked.",
    "minstrel_courtship_poem_teach",
    [
      (assign, "$poem_selected", 3),
    ]],

  [anyone, "minstrel_courtship_poem_teach",
    [],
    "To teach it to you, I will need some hours of your time -- and, of course, a small fee for my services. About 300 denars would suffice.",
    "minstrel_courtship_poem_teach_2",
    []],

  [anyone, "minstrel_courtship_poem",
    [],
    "I believe you already know the poems I am best equipped to teach.",
    "minstrel_pretalk",
    []],

  [plyr|anyone, "minstrel_courtship_poem_teach_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "Yes -- teach me that one",
    "minstrel_courtship_poem_teach_3",
    []],

  [plyr|anyone, "minstrel_courtship_poem_teach_2",
    [],
    "Never mind",
    "minstrel_pretalk",
    []],

  [anyone, "minstrel_courtship_poem_teach_3",
    [
      (eq, "$poem_selected", 5),
    ],
    "Very well -- repeat after me:^   I deflected her skeptical questioning darts^   with armor made of purest devotion^   purged in the forge of my heart^   from the slag of any baser emotion",
    "minstrel_courtship_poem_teach_4",
    []],

  [anyone, "minstrel_courtship_poem_teach_3",
    [
      (eq, "$poem_selected", 4),
    ],
    "Very well -- repeat after me:^   You are the first and the last^   the outer and the inner^   When I drink from the cup of love^   I escape the tread of time^   A moment in solitude with you^   Would have no beginning and no end",
    "minstrel_courtship_poem_teach_4",
    []],

  [anyone, "minstrel_courtship_poem_teach_3",
    [
      (eq, "$poem_selected", 1),
    ],
    "Very well -- repeat after me:^  The wind that blows the dry steppe dust^  Stirs the curtains in your tower^  The moon that lights my drunken path home^  Looks on you sleeping in your bower^  If I cried out to the wind^  Could it carry a message from my lips?^  If I wept before the moon^  Would it grant me just a glimpse?",
    "minstrel_courtship_poem_teach_4",
    []],

  [anyone, "minstrel_courtship_poem_teach_3",
    [
      (eq, "$poem_selected", 2),
    ],
    "Very well -- repeat after me:^   A light pierced the gloom over Windholm cliffs...^   Where charge of surf broke on shieldwall of shore^   Grey-helmed and grey-cloaked the maiden stood^   On wave-steed's prow, the sailcloth snapping^   Over din of oars, of timbers cracking^   She cried out to her hearth-brothers, arrayed for war",
    "minstrel_courtship_poem_teach_4",
    []],

  [anyone, "minstrel_courtship_poem_teach_3",
    [
      (eq, "$poem_selected", 3),
    ],
    "Very well -- repeat after me:^All the silks of Ethos, all the furs of Poinsbruk^Would buy you not the briefest kiss^What I bestow, I bestow for love^And the sake of my own happiness^But brought you a gift? Let us see! Let us see!^Or should I tell my father how you came to see me?",
    "minstrel_courtship_poem_teach_4",
    []],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [
      (eq, "$poem_selected", 5),
    ],
    "'I deflected her skeptical questioning darts...'",
    "minstrel_learn_poem_continue",
    [
      (troop_remove_gold, "trp_player", 300),
      (val_add, "$allegoric_poem_recitations", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [
      (eq, "$poem_selected", 4),
    ],
    "'You are the first and the last..'",
    "minstrel_learn_poem_continue",
    [
      (troop_remove_gold, "trp_player", 300),
      (val_add, "$mystic_poem_recitations", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [
      (eq, "$poem_selected", 1),
    ],
    "'The wind that blows the dry steppe dust...'",
    "minstrel_learn_poem_continue",
    [
      (troop_remove_gold, "trp_player", 300),
      (val_add, "$tragic_poem_recitations", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [
      (eq, "$poem_selected", 2),
    ],
    "'A light pierced the gloom over Windholm cliffs...'",
    "minstrel_learn_poem_continue",
    [
      (troop_remove_gold, "trp_player", 300),
      (val_add, "$heroic_poem_recitations", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [
      (eq, "$poem_selected", 3),
    ],
    "'All the silks of Ethos...'",
    "minstrel_learn_poem_continue",
    [
      (troop_remove_gold, "trp_player", 300),
      (val_add, "$comic_poem_recitations", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_poem_teach_4",
    [],
    "Pshaw... What kind of doggerel is that?",
    "minstrel_courtship_poem_teach_reject",
    []],

  [anyone, "minstrel_courtship_poem_teach_reject",
    [],
    "Very well. If the poem is not to your taste, then keep your money. But remember -- with poets and with lovers, what is important is not what pleases you. What is important is what your pleases your audience. If you wish to learn the poem, I am still willing to teach.",
    "minstrel_pretalk",
    []],

  [anyone, "minstrel_learn_poem_continue",
    [],
    "Very good -- but there are many stanzas to go. Now, listen closely...",
    "close_window",
    [
      (try_begin),
        (try_begin),
          (eq, "$poem_selected", 4),
          (371, 38, 0, 1),
        (else_try),
          (eq, "$poem_selected", 1),
          (371, 38, 1, 1),
        (else_try),
          (eq, "$poem_selected", 2),
          (371, 38, 2, 1),
        (else_try),
          (eq, "$poem_selected", 3),
          (371, 38, 3, 1),
        (else_try),
          (eq, "$poem_selected", 5),
          (371, 38, 4, 1),
        (try_end),
        (assign, ":var0", 0),
        (try_for_range, ":var1", 0, 5),
          (370, ":var2", 38, ":var1"),
          (eq, ":var2", 1),
          (val_add, ":var0", 1),
        (try_end),
        (try_begin),
          (ge, ":var0", 3),
          (372, 38),
        (try_end),
        (try_begin),
          (gt, "$tragic_poem_recitations", 0),
          (gt, "$comic_poem_recitations", 0),
          (gt, "$mystic_poem_recitations", 0),
          (gt, "$heroic_poem_recitations", 0),
          (gt, "$allegoric_poem_recitations", 0),
          (item_slot_eq, "itm_lyre", 65, 0),
          (call_script, "script_unlock_item_for_custom_troops", "itm_lyre"),
          (call_script, "script_unlock_item_for_custom_troops", "itm_lute"),
        (try_end),
      (try_end),
      (assign, "$g_leave_town", 1),
      (rest_for_hours, 2, 2, 0),
      (finish_mission),
    ]],

  [plyr|anyone, "minstrel_1",
    [
      (eq, "$minstrels_introduced", 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Can you tell me anything about the eligible maidens in this realm?",
    "minstrel_gossip",
    []],

  [anyone, "minstrel_gossip",
    [],
    "About whom did you wish to know?",
    "minstrel_gossip_select",
    []],

  [plyr|anyone, "minstrel_gossip_select",
    [],
    "Just tell me the latest piece of gossip",
    "minstrel_gossip_maiden_selected_2",
    [
      (assign, "$lady_selected", -1),
      (assign, "$romantic_rival", -1),
      (try_for_range, ":var0", 0, "$num_log_entries"),
        (troop_get_slot, ":var1", "trp_log_array_actor", ":var0"),
        (is_between, ":var1", "trp_knight_1_1_wife", "trp_heroes_end"),
        (neg|troop_slot_eq, "trp_player", 30, ":var1"),
        (troop_get_slot, ":var2", "trp_log_array_entry_type", ":var0"),
        (is_between, ":var2", 50, 65),
        (store_troop_faction, ":var3", ":var1"),
        (store_faction_of_party, ":var4", "$g_encountered_party"),
        (eq, ":var3", ":var4"),
        (assign, "$lady_selected", ":var1"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var1"),
          (troop_get_slot, reg4, "trp_log_array_entry_type", ":var0"),
          (assign, reg5, "$num_log_entries"),
          (display_message, "str_log_entry_type_reg4_for_s4_total_entries_reg5"),
        (try_end),
      (try_end),
    ]],

  [repeat_for_troops|plyr|anyone, "minstrel_gossip_select",
    [
      (store_repeat_object, "$temp"),
      (troop_slot_eq, "$temp", 2, 6),
      (troop_slot_eq, "$temp", 30, -1),
      (store_troop_faction, ":var0", "$temp"),
      (store_faction_of_party, ":var1", "$g_encountered_party"),
      (eq, ":var0", ":var1"),
      (str_store_troop_name, s10, "$temp"),
    ],
    "{s10}",
    "minstrel_gossip_maiden_selected",
    [
      (store_repeat_object, "$lady_selected"),
    ]],

  [plyr|anyone, "minstrel_gossip_select",
    [],
    "Never mind",
    "minstrel_pretalk",
    []],

  [anyone, "minstrel_gossip_maiden_selected",
    [
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg3, "$lady_selected"),
        (display_message, "@{!}DEBUG: Gossip for troop {reg3}"),
        (gt, reg3, -1),
        (display_message, "@{!}DEBUG: {s3}"),
      (try_end),
      (try_begin),
        (gt, "$lady_selected", -1),
        (str_store_troop_name, s9, "$lady_selected"),
        (str_store_string, s10, "str_error__reputation_type_for_s9_not_within_range"),
        (try_begin),
          (troop_slot_eq, "$lady_selected", 52, 21),
          (str_store_string, s16, "str_they_say_that_s9_is_a_most_conventional_maiden__devoted_to_her_family_of_a_kind_and_gentle_temperament_a_lady_in_all_her_way"),
        (else_try),
          (troop_slot_eq, "$lady_selected", 52, 23),
          (str_store_string, s16, "str_they_say_that_s9_is_a_bit_of_a_romantic_a_dreamer__of_a_gentle_temperament_yet_unpredictable_she_is_likely_to_be_led_by_her_passions_and_will_be_trouble_for_her_family_ill_wager"),
        (else_try),
          (troop_slot_eq, "$lady_selected", 52, 24),
          (str_store_string, s16, "str_they_say_that_s9_is_determined_to_marry_well_and_make_her_mark_in_the_world_she_may_be_a_tremendous_asset_for_her_husband__provided_he_can_satisfy_her_ambition"),
        (else_try),
          (troop_slot_eq, "$lady_selected", 52, 22),
          (str_store_string, s16, "str_they_say_that_s9_loves_to_hunt_and_ride_maybe_she_wishes_she_were_a_man_whoever_she_marries_will_have_a_tough_job_keeping_the_upper_hand_i_would_say"),
        (else_try),
          (troop_slot_eq, "$lady_selected", 52, 25),
          (str_store_string, s16, "str_they_say_that_s9_is_a_lady_of_the_highest_moral_standards_very_admirable_very_admirable__and_very_hard_to_please_ill_warrant"),
        (try_end),
        (try_begin),
          (troop_get_type, ":var0", "$lady_selected"),
          (eq, ":var0", 2),
          (str_store_string, s16, "@{s16} They also say she is renowned for her beauty."),
        (try_end),
        (call_script, "script_add_rumor_string_to_troop_notes", "$lady_selected", -1, 16),
      (try_end),
    ],
    "{s16}",
    "minstrel_gossip_maiden_selected_2",
    []],

  [anyone, "minstrel_gossip_maiden_selected_2",
    [
      (troop_slot_eq, "trp_player", 30, "$lady_selected"),
      (is_between, "$lady_selected", "trp_knight_1_1_wife", "trp_heroes_end"),
    ],
    "She is married to you, of course! Clearly, no one would dream that she would do anything to engender gossip.",
    "minstrel_postgossip",
    []],

  [anyone, "minstrel_gossip_maiden_selected_2",
    [
      (gt, "$lady_selected", -1),
      (assign, ":var0", "$lady_selected"),
      (neg|troop_slot_ge, ":var0", 30, "trp_npc_adonja"),
      (troop_get_slot, ":var1", ":var0", 34),
      (is_between, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (str_store_troop_name, s9, ":var0"),
      (str_store_troop_name, s11, ":var1"),
      (str_store_string, s12, "str_s9_is_now_betrothed_to_s11_soon_we_believe_there_shall_be_a_wedding"),
      (try_begin),
        (troop_slot_eq, ":var0", 5, 2),
        (assign, "$romantic_rival", ":var1"),
      (try_end),
    ],
    "{s12}.",
    "minstrel_postgossip",
    []],

  [anyone, "minstrel_gossip_maiden_selected_2",
    [
      (try_begin),
        (is_between, "$lady_selected", "trp_knight_1_1_wife", "trp_heroes_end"),
        (str_store_string, s12, "str_i_have_not_heard_any_news_about_her"),
        (str_store_troop_name, s9, "$lady_selected"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (display_message, "str_searching_for_rumors_for_s9"),
        (try_end),
        (assign, "$romantic_rival", -1),
        (assign, ":var0", 0),
        (try_for_range, ":var1", 0, "$num_log_entries"),
          (troop_slot_eq, "trp_log_array_actor", ":var1", "$lady_selected"),
          (troop_get_slot, ":var2", "trp_log_array_troop_object", ":var1"),
          (str_clear, s11),
          (try_begin),
            (is_between, ":var2", 0, "trp_heroes_end"),
            (str_store_troop_name, s11, ":var2"),
          (try_end),
          (troop_get_slot, ":var3", "trp_log_array_center_object", ":var1"),
          (str_clear, s10),
          (try_begin),
            (is_between, ":var3", 0, "trp_heroes_end"),
            (str_store_troop_name, s10, ":var3"),
          (try_end),
          (assign, ":var4", "$lady_selected"),
          (try_begin),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 51),
            (str_store_string, s12, "str_they_say_that_s9_has_shown_favor_to_s11_perhaps_it_will_not_be_long_until_they_are_betrothed__if_her_family_permits"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
            (try_begin),
              (troop_slot_eq, ":var4", 5, 2),
              (this_or_next|troop_slot_eq, ":var2", 35, ":var4"),
              (this_or_next|troop_slot_eq, ":var2", 36, ":var4"),
              (troop_slot_eq, ":var2", 37, ":var4"),
              (assign, "$romantic_rival", ":var2"),
            (try_end),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 53),
            (str_store_string, s12, "str_they_say_that_s9_has_been_forced_by_her_family_into_betrothal_with_s11"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
            (try_begin),
              (troop_slot_eq, ":var4", 5, 2),
              (assign, "$romantic_rival", ":var2"),
            (try_end),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 52),
            (str_store_string, s12, "str_they_say_that_s9_has_agreed_to_s11s_suit_and_the_two_are_now_betrothed"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
            (try_begin),
              (troop_slot_eq, ":var4", 5, 2),
              (this_or_next|troop_slot_eq, ":var2", 35, ":var4"),
              (this_or_next|troop_slot_eq, ":var2", 36, ":var4"),
              (troop_slot_eq, ":var2", 37, ":var4"),
              (assign, "$romantic_rival", ":var2"),
            (try_end),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 59),
            (str_store_string, s12, "str_they_say_that_s9_under_pressure_from_her_family_has_agreed_to_betrothal_with_s11"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
            (try_begin),
              (troop_slot_eq, ":var4", 5, 2),
              (this_or_next|troop_slot_eq, ":var2", 35, ":var4"),
              (this_or_next|troop_slot_eq, ":var2", 36, ":var4"),
              (troop_slot_eq, ":var2", 37, ":var4"),
              (assign, "$romantic_rival", ":var2"),
            (try_end),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 54),
            (str_store_string, s12, "str_they_say_that_s9_has_refused_s11s_suit"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 58),
            (str_store_string, s12, "str_they_say_that_s11_has_tired_of_pursuing_s9"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 55),
            (str_store_string, s12, "str_they_say_that_s9s_family_has_forced_her_to_renounce_s11_whom_she_much_loved"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 57),
            (str_store_string, s12, "str_they_say_that_s9_has_run_away_with_s11_causing_her_family_much_grievance"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
          (else_try),
            (troop_slot_eq, "trp_log_array_entry_type", ":var1", 56),
            (str_store_string, s12, "str_they_say_that_s9_and_s11_have_wed"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
          (else_try),
            (troop_get_slot, ":var2", ":var4", 38),
            (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
            (str_store_troop_name, s11, ":var2"),
            (str_store_string, s12, "str_they_say_that_s9_was_recently_visited_by_s11_who_knows_where_that_might_lead"),
            (assign, ":var0", ":var4"),
            (assign, ":var5", ":var2"),
            (try_begin),
              (troop_slot_eq, ":var4", 5, 2),
              (this_or_next|troop_slot_eq, ":var2", 35, ":var4"),
              (this_or_next|troop_slot_eq, ":var2", 36, ":var4"),
              (troop_slot_eq, ":var2", 37, ":var4"),
              (assign, "$romantic_rival", ":var2"),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (neq, ":var5", "$romantic_rival"),
          (assign, "$romantic_rival", -1),
        (try_end),
        (try_begin),
          (gt, ":var0", 0),
          (call_script, "script_add_rumor_string_to_troop_notes", ":var0", ":var5", 12),
        (try_end),
      (else_try),
        (eq, "$lady_selected", -1),
        (str_store_string, s12, "str_there_is_not_much_to_tell_but_it_is_still_early_in_the_season"),
      (else_try),
        (assign, reg4, "$lady_selected"),
        (str_store_troop_name, s9, "$lady_selected"),
        (str_store_string, s12, "str_error_lady_selected_=_s9"),
      (try_end),
    ],
    "{s12}.",
    "minstrel_postgossip",
    []],

  [plyr|anyone, "minstrel_postgossip",
    [],
    "Very interesting -- but let us speak of something else.",
    "minstrel_pretalk",
    []],

  [plyr|anyone, "minstrel_postgossip",
    [],
    "Very interesting -- is there any more news?",
    "minstrel_gossip",
    []],

  [plyr|anyone, "minstrel_postgossip",
    [
      (is_between, "$romantic_rival", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (neg|check_quest_active, "qst_duel_courtship_rival"),
      (neg|troop_slot_ge, "trp_player", 30, "trp_knight_1_1_wife"),
    ],
    "What? I'll make that miscreant face my sword",
    "minstrel_duel_confirm",
    []],

  [anyone, "minstrel_duel_confirm",
    [
      (str_store_troop_name, s11, "$romantic_rival"),
    ],
    "Do you mean that? {s11} will be honor-bound to fight you, but challenging a lord to duel over a woman is seen as a bit hot-headed, even in this warlike age.",
    "minstrel_duel_confirm_2",
    []],

  [plyr|anyone, "minstrel_duel_confirm_2",
    [
      (str_store_troop_name, s11, "$romantic_rival"),
      (str_store_troop_name, s12, "$lady_selected"),
    ],
    "Yes -- I intend to force {s11} to relinquish his suit of {s12}!",
    "minstrel_duel_issued",
    []],

  [plyr|anyone, "minstrel_duel_confirm_2",
    [],
    "No -- I let my passions run away with me, there.",
    "minstrel_pretalk",
    []],

  [anyone, "minstrel_duel_issued",
    [],
    "As you wish. I'll spead the word of your intentions, so that {s13} does not try to back out...",
    "minstrel_pretalk",
    [
      (str_store_troop_name, s11, "$lady_selected"),
      (str_store_troop_name_link, s13, "$romantic_rival"),
      (str_store_string, s2, "str_you_intend_to_challenge_s13_to_force_him_to_relinquish_his_suit_of_s11"),
      (setup_quest_text, "qst_duel_courtship_rival"),
      (call_script, "script_start_quest", "qst_duel_courtship_rival", "$lady_selected"),
      (quest_set_slot, "qst_duel_courtship_rival", 6, "$lady_selected"),
      (quest_set_slot, "qst_duel_courtship_rival", 2, "$romantic_rival"),
      (quest_set_slot, "qst_duel_courtship_rival", 21, 400),
      (quest_set_slot, "qst_duel_courtship_rival", 23, 60),
      (quest_set_slot, "qst_duel_courtship_rival", 11, 0),
    ]],

  [plyr|anyone, "minstrel_1",
    [
      (eq, "$minstrels_introduced", 1),
    ],
    "Do you know of any ongoing feasts?",
    "minstrel_courtship_locations",
    []],

  [anyone, "minstrel_courtship_locations",
    [
      (str_clear, s12),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 4, 6),
        (assign, ":var0", 1),
        (faction_get_slot, ":var2", ":var1", 5),
        (str_store_party_name, s4, ":var2"),
        (str_store_faction_name, s3, ":var1"),
        (store_current_hours, ":var3"),
        (store_sub, ":var4", ":var3", 72),
        (faction_get_slot, ":var5", ":var1", 94),
        (val_add, ":var4", ":var5"),
        (try_begin),
          (gt, ":var4", 48),
          (str_store_string, s12, "str_s12there_is_a_feast_of_the_s3_in_progress_at_s4_but_it_has_been_going_on_for_a_couple_of_days_and_is_about_to_end_"),
        (else_try),
          (gt, ":var4", 24),
          (str_store_string, s12, "str_s12there_is_a_feast_of_the_s3_in_progress_at_s4_which_should_last_for_at_least_another_day_"),
        (else_try),
          (str_store_string, s12, "str_s12there_is_a_feast_of_the_s3_in_progress_at_s4_which_has_only_just_begun_"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s12, "str_not_at_this_time_no"),
      (else_try),
        (str_store_string, s12, "str_s12the_great_lords_bring_their_daughters_and_sisters_to_these_occasions_to_see_and_be_seen_so_they_represent_an_excellent_opportunity_to_make_a_ladys_acquaintance"),
      (try_end),
    ],
    "{s12}",
    "minstrel_pretalk",
    []],

  [plyr|anyone, "minstrel_1",
    [],
    "Good-bye.",
    "close_window",
    []],

  [anyone, "minstrel_courtship_questions",
    [],
    "What do you wish to know?",
    "minstrel_courtship_questions_2",
    []],

  [anyone, "minstrel_courtship_prequestions",
    [],
    "Can I answer any other questions for you?",
    "minstrel_courtship_questions_2",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [
      (eq, "$minstrels_discussed_love", 1),
    ],
    "Is there a place for me in the game of love?",
    "minstrel_player_role",
    [
      (assign, "$minstrels_discussed_player_role", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [
      (eq, "$minstrels_discussed_player_role", 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "How would a suitor meet a lady?",
    "minstrel_player_advice_meet",
    [
      (assign, "$minstrels_discussed_meetings", 1),
    ]],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [
      (eq, "$minstrels_discussed_meetings", 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Having met a lady, how would the suitor woo her?",
    "minstrel_player_advice_woo",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [],
    "Please tell me about marriage and love among the nobility of Pendor",
    "minstrel_nobles",
    [
      (assign, "$minstrels_discussed_love", 1),
    ]],

  [anyone, "minstrel_nobles",
    [
      (troop_get_type, ":var0", "trp_player"),
      (ge, ":var0", 1),
    ],
    "Nobles are an odd lot. In Pendor, a daughter is a political asset, to be given away to a lord with whom her father wishes to make an alliance. Of course, this does not apply for their sons. The sons are lords and commanders who will be seeking suitable wives. A lady such as yourself will find it hard to marry a suitable husband, but if you persevere and are lucky you will find a good husband among the nobility.",
    "minstrel_prequestions",
    []],

  [anyone, "minstrel_nobles",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Nobles are an odd lot. In Pendor, a daughter is a political asset, to be given away to a lord with whom her father wishes to make an alliance. Yet the great families of this land idealize pure love between man and woman, and I have seen many a hardened warrior weep copious tears at the doomed ardour of Sahira and Janun in the songs -- even as he made plans to break his own daughter's heart.",
    "minstrel_nobles_2",
    []],

  [anyone, "minstrel_nobles_2",
    [],
    "Fathers differ, of course. Some Pendorian nobles will let their daughters choose a husband who pleases them. Others, however, feel that to allow their daughters any choice at all would be to diminish their own authority, and insist on imposing a groom whether she likes it or not.",
    "minstrel_nobles_3",
    []],

  [anyone, "minstrel_nobles_3",
    [],
    "But the majority will steer a middle course -- they will want to make the final decision about a groom, but will weigh their daughter's preferences heavily. Among other factors, a happy marriage is more likely to produce heirs. So, there is a place for courtship, and for the use of skill and passion to win a lady's heart.",
    "minstrel_prequestions",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [
      (eq, "$minstrels_discussed_love", 1),
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "What if a lady and her father disagree about a suitor?",
    "minstrel_daughter_father",
    []],

  [anyone, "minstrel_daughter_father",
    [],
    "It happens sometimes that a lord's daughter elopes. This is a major blow to the father's prestige, leading to lasting enmities. Indeed, it is possible that a war may be fought over a forbidden marriage. Now, that is a fine topic for a song.",
    "minstrel_daughter_father_2",
    []],

  [anyone, "minstrel_daughter_father_2",
    [],
    "In the end, however, most daughters will submit to their parents' choice. A noblewoman's family is everything to her, and few are brave enough to risk disapproval for the sake of an unknown suitor. One may pine for a lover, but yet obey parental orders -- and without tragic love, what would we have to sing about?",
    "minstrel_prequestions",
    []],

  [anyone, "minstrel_player_role",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Of course! Pendorian lords make a great deal of lineage, but in the end, lands and money speak louder than one's ancestors. Even though you are a foreigner, if you are coming up in the world, then many parents will consider you a fine catch.",
    "minstrel_player_role_2",
    []],

  [anyone, "minstrel_player_role_2",
    [],
    "You will have to compete with many others of the realm, however, who will have an advantage -- they have known these {reg63?ladies:lords} from childhood, and will have been sized up as {reg63?grooms:brides} by carefully discerning mothers and aunts. Some {reg63?ladies:lords} may be fascinated by the strange, yet opt for the familiar.",
    "minstrel_player_role_3",
    []],

  [anyone, "minstrel_player_role_3",
    [],
    "Keep this in mind -- you may well break your heart in pursuit of love. However, refusing to love for fear of heartbreak is like refusing to lead your men into battle from fear of the enemy's arrows. Be brave, and shrug off ignorant lords' snotty little comments, and victory shall surely be yours.",
    "minstrel_prequestions",
    []],

  [anyone, "minstrel_player_role",
    [],
    "Milady, I must speak candidly. Many of the lords of this land are traditionalists, not to say chauvenists, ha ha. They look only for a pretty little twit with demure manners and skin as fair as snow. They would feel threatened by a warrior maid who looks them in the eye as an equal; one who may well be smarter and more skilled at combat than they are. They want a maiden whose voice is soft as bells, not a woman who can fight bravely beside them, with a voice hoarse from commanding men successfully in battle. Most lords seeking to marry will want heirs, and a warrior woman such as yourself may not wish to give up conquest to furnish her lord an heir.",
    "minstrel_female_player_3",
    []],

  [anyone, "minstrel_female_player_3",
    [],
    "However, not all lords will prove so foolishly blind to the advantages of marriage to a warrior lady with battle renown. We poets sing of shield maidens and of huntresses, of women who forged their own path without having sacrificed a chance for love. You must work to find a devoted husband who can accept your ways, but that is by no means impossible here in Pendor, as it assuredly would be in a more backward land.",
    "minstrel_prequestions",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [
      (eq, "$minstrels_discussed_love", 1),
    ],
    "What advantage is there in seeking a {reg63?wife:husband}?",
    "minstrel_spouse_benefits",
    []],

  [anyone, "minstrel_spouse_benefits",
    [
      (troop_get_type, ":var0", "trp_player"),
      (eq, ":var0", 0),
    ],
    "Ah! You are quite the romantic, I see! Well, aside from the obvious benefits of love, companionship and other, em, domestic matters, to marry among the nobility brings great assets. You may forge a strong alliance with the bride's family, and a wife may also assist you in manipulating the politics of the realm to your advantage.",
    "minstrel_wife_benefits_2",
    []],

  [anyone, "minstrel_wife_benefits_2",
    [],
    "What's more, most of the great families of Pendor have at some point intermarried with royalty, which would boost your own claim to rule -- should you ever choose to assert it...",
    "minstrel_prequestions",
    []],

  [anyone, "minstrel_spouse_benefits",
    [
      (troop_get_type, ":var0", "trp_player"),
      (ge, ":var0", 1),
    ],
    "Ah! You are quite the romantic, I see! Well, aside from the obvious benefits of love, companionship and other, em, domestic matters, to marry among the nobility brings great assets. You may have access to the groom's castles and properties, and be able to work with him to advance both of your standings in the realm.",
    "minstrel_wife_benefits_2",
    []],

  [anyone, "minstrel_player_advice_meet",
    [],
    "Every so often, a king or great lord of Pendor will hold a feast. In towns they will often be accompanied by tournaments, and in castles they will be accompanied by hunts. These feasts provide a chance for the lords to repair some of the rivalries that may undermine the strength of the realm. They also provide an opportunity for families to show off their eligible daughters, and ladies will often be allowed to mingle unsupervised with the guests.",
    "minstrel_player_advice_meet_2",
    []],

  [anyone, "minstrel_player_advice_meet_2",
    [],
    "If you have the opportunity, you may attempt to pay the lady a compliment. This indicates to her that you are a potential suitor, and she will usually know if she wishes you to continue your suit. Incidentally, if you come to her fresh from having distinguished yourself in the tournament or in the hunt, then you may make a stronger first impression than otherwise.",
    "minstrel_prequestions",
    []],

  [anyone, "minstrel_player_advice_woo",
    [],
    "To woo a lady takes a certain amount of time and patience, and several meetings spaced over a period of months. A lady who is interested in you will often find ways of letting you know if she wishes you to come visit her. Alternately, you may simply go and ask her father or brother for permission. If you do not have permission from her guardian, it may be possible to arrange an assignation through other means.",
    "minstrel_player_advice_woo_2",
    []],

  [anyone, "minstrel_player_advice_woo_2",
    [],
    "Having arranged an assignment, you may then attempt to charm her and win her favor. Perhaps one of the most difficult aspects of this is finding a topic of conversation. Most Pendorian noblewomen lead a cloistered life, at least until they are married, and thus will have little to say that will interest you. On other hand, she will soon tire of hearing of your own deeds in the outside world.",
    "minstrel_player_advice_woo_3",
    []],

  [anyone, "minstrel_player_advice_woo_3",
    [],
    "One time-tested mode of courtship is simply to recite a popular poem, and discuss it. This way, you are both on an equal footing, and neither will have an advantage in knowledge or experience. Of course, different ladies will have different tastes in poetry.",
    "minstrel_player_advice_woo_4",
    []],

  [anyone, "minstrel_player_advice_woo_4",
    [],
    "At some point, you will be able to discuss directly the issue of marriage. She will then let you know if you measure up to what she wants in a husband. Some ladies will coolly assess who is the most prestigious of her suitors, others will be guided by their passions. Some will look to your companions, to see whether you are the kind of husband who will treat her as an equal, while others will follow the lead of their fathers.",
    "minstrel_player_advice_woo_5",
    []],

  [anyone, "minstrel_player_advice_woo_5",
    [],
    "At any rate, it is a challenging business -- and do not forget, you may find that your suit prospers with a lady, only to have it falter on a father's political ambitions. So you must ask yourself: are you willing to risk disappointment and heartbreak? Alternately, are you willing to throw away your standing in society, to make enemies of allies, in pursuit of a forbidden love? Because if you are, then perhaps some day we will write poems about you.",
    "minstrel_prequestions",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [],
    "What is it that you poets and musicians do, again?",
    "minstrel_job_description",
    []],

  [anyone, "minstrel_job_description",
    [],
    "I compose and write songs for the lords of the land, and their ladies. Sometimes I sing about war, sometimes about the virtues of kings, and sometimes, for the more sophisticated audiences, about the virtues of wine. For most audiences, however, I sing of love.",
    "minstrel_courtship_prequestions",
    []],

  [plyr|anyone, "minstrel_courtship_questions_2",
    [],
    "No, that is all.",
    "minstrel_pretalk",
    []],

  [anyone, "minstrel_prequestions",
    [],
    "Do you have any other questions?",
    "minstrel_courtship_questions_2",
    []],

  [anyone, "minstrel_pretalk",
    [],
    "Is there anything else?",
    "minstrel_1",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 14),
      (eq, "$g_talk_troop", "trp_farmer_from_bandit_village"),
      (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
      (neg|check_quest_active, "qst_deal_with_bandits_at_lords_village"),
      (assign, ":var0", "p_salt_mine"),
      (try_for_range, ":var1", "p_village_1", ":var0"),
        (party_slot_eq, ":var1", 120, "$g_encountered_party"),
        (party_slot_ge, ":var1", 39, 1),
        (str_store_party_name, s1, ":var1"),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 1, ":var1"),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 11, 0),
        (party_get_slot, ":var2", ":var1", 25),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 6, ":var2"),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 12, ":var1"),
        (call_script, "script_reward_for_quest_per_player_level", 0, 110, 10, 0),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 21, reg33),
        (quest_set_slot, "qst_eliminate_bandits_infesting_village", 22, reg34),
        (assign, ":var0", 0),
      (try_end),
    ],
    "{reg63?My lord:Madam}, you look like a {reg63?man:lady} of the sword and someone who could help us. Will you hear my plea?",
    "farmer_from_bandit_village_1",
    []],

  [plyr|anyone, "farmer_from_bandit_village_1",
    [],
    "What is the matter, my good man?",
    "farmer_from_bandit_village_2",
    []],

  [plyr|anyone, "farmer_from_bandit_village_1",
    [],
    "What are you rambling on about, peasant? Speak up.",
    "farmer_from_bandit_village_2",
    []],

  [anyone, "farmer_from_bandit_village_2",
    [],
    "A band of brigands have taken refuge in our village. They take everything we have, force us to serve them, and do us much evil. If one of us so much as breathes a word of protest, they kill the poor soul on the spot right away. Our lives have become unbearable. I risked my skin and ran away to find someone who can help us.",
    "farmer_from_bandit_village_3",
    []],

  [plyr|anyone, "farmer_from_bandit_village_3",
    [],
    "Why don't you go to the lord of your village? He should take care of the vermin.",
    "farmer_from_bandit_village_4",
    []],

  [anyone, "farmer_from_bandit_village_4",
    [],
    "I did, {reg63?sir:madam}, but our lord's men did not let me see him and said he was occupied with more important matters, and that we should deal with our own problem ourselves. Please {reg63?sir:madam}, you look like a {reg63?man:lady} of valor and a fearsome warrior, and you have no doubt many friends and soldiers at your service. If there is anyone who can help us, it's you.",
    "farmer_from_bandit_village_5",
    [
      (assign, "$temp", 0),
    ]],

  [plyr|anyone, "farmer_from_bandit_village_5",
    [],
    "Very well, I'll help you. Where is this village?",
    "farmer_from_bandit_village_accepted",
    []],

  [plyr|anyone, "farmer_from_bandit_village_5",
    [],
    "I can't be bothered with this right now.",
    "farmer_from_bandit_village_denied",
    []],

  [plyr|anyone, "farmer_from_bandit_village_5",
    [
      (eq, "$temp", 0),
    ],
    "Why would I fight these bandits? What's in it for me?",
    "farmer_from_bandit_village_barter",
    []],

  [anyone, "farmer_from_bandit_village_accepted",
    [],
    "God bless you, {reg63?sir:madam}. Our village is {s7}. It is not too far from here.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_eliminate_bandits_infesting_village", 1),
      (str_store_party_name_link, s7, ":var0"),
      (setup_quest_text, "qst_eliminate_bandits_infesting_village"),
      (str_store_string, s2, "@A villager from {s7} begged you to save their village from the bandits that took refuge there."),
      (call_script, "script_start_quest", "qst_eliminate_bandits_infesting_village", "$g_talk_troop"),
    ]],

  [anyone, "farmer_from_bandit_village_denied",
    [],
    "As you say {reg63?sir:madam}. Forgive me for bothering you.",
    "close_window",
    []],

  [anyone, "farmer_from_bandit_village_barter",
    [],
    "We are but poor farmers {reg63?sir:madam}, and the bandits have already got most of what we have on this world. but we'll be glad to share with you whatever we have got. And we'll always be in your gratitude if you help us.",
    "farmer_from_bandit_village_5",
    [
      (assign, "$temp", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 14),
      (eq, "$g_talk_troop", "trp_farmer_from_bandit_village"),
      (check_quest_active, "qst_eliminate_bandits_infesting_village"),
    ],
    "Thank you for helping us {reg63?sir:madam}. Crush those bandits!",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 14),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_player_knight"),
    ],
    "Greetings {reg63?Sir:Madam}. Care to share some ale with a travel-weary Knight?",
    "ask_order_rumor",
    []],

  [plyr|anyone, "ask_order_rumor",
    [],
    "I'd like to learn more about your Order.",
    "start_order_rumor",
    [
      (store_sub, reg33, "$g_talk_troop", "trp_dragon_knight"),
    ]],

  [plyr|anyone, "ask_order_rumor",
    [],
    "Thank you, sir Knight, but I have urgent business to attend to.",
    "close_window",
    []],

  [plyr|anyone, "start_order_rumor",
    [],
    "{s4}",
    "order_rumor_1",
    [
      (store_add, ":var0", reg33, "str_player_ask_drag_1"),
      (str_store_string, s4, ":var0"),
    ]],

  [anyone, "order_rumor_1",
    [],
    "{s4}",
    "order_rumor_2",
    [
      (store_add, ":var0", reg33, "str_drag_response_1"),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "order_rumor_2",
    [],
    "{s4}",
    "order_rumor_3",
    [
      (store_add, ":var0", reg33, "str_player_ask_drag_2"),
      (str_store_string, s4, ":var0"),
    ]],

  [anyone, "order_rumor_3",
    [],
    "{s4}",
    "order_rumor_4",
    [
      (store_add, ":var0", reg33, "str_drag_response_2"),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "order_rumor_4",
    [],
    "{s4}",
    "order_rumor_5",
    [
      (store_add, ":var0", reg33, "str_player_ask_drag_3"),
      (str_store_string, s4, ":var0"),
    ]],

  [anyone, "order_rumor_5",
    [],
    "{s4}",
    "order_rumor_6",
    [
      (store_add, ":var0", reg33, "str_drag_response_3"),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "order_rumor_6",
    [],
    "Thank you for clearing that up for me.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 14),
      (neg|troop_is_hero, "$g_talk_troop"),
      (neg|is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (party_get_slot, ":var0", "$g_encountered_party", 90),
      (party_get_slot, ":var1", "$g_encountered_party", 91),
      (gt, ":var1", 0),
      (store_sub, reg3, ":var1", 1),
      (store_sub, reg4, reg3, 1),
      (call_script, "script_game_get_join_cost", ":var0"),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
      (assign, ":var2", reg0),
      (store_mul, reg5, ":var1", reg0),
      (party_get_free_companions_capacity, ":var3", "p_main_party"),
      (val_min, ":var1", ":var3"),
      (store_troop_gold, ":var4", "trp_player"),
      (try_begin),
        (gt, ":var2", 0),
        (val_div, ":var4", ":var2"),
        (val_min, ":var1", ":var4"),
      (try_end),
      (assign, "$temp", ":var1"),
    ],
    "{s4} ^^ We'll join you for {reg5} denars.",
    "mercenary_tavern_talk",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 90),
      (try_begin),
        (eq, ":var0", "trp_slave_hunter"),
        (str_store_string, s4, "@If ye be looking for Manhunters, {reg63?sir:madam}. {reg3?Me and {reg4?{reg3} of my mates:one of my mates} are:I am} looking for a capable leader."),
      (else_try),
        (eq, ":var0", "trp_singalian_spearman"),
        (str_store_string, s4, "@Well met my {reg63?Lord:Lady}. If you are looking for some Warriors then look no further! {reg3?I and {reg4?{reg3} of my comrades:one of my comrades} are:I am} looking for good pay and the chance to use {reg3?our spears:my spear} to make some coin."),
      (else_try),
        (is_between, ":var0", "trp_noble_foreign", "trp_vanskerry_marauder"),
        (str_store_string, s4, "@Well met my {reg63?Lord:Lady}. {reg3?I and {reg4?{reg3} of my friends:one of my friends} are:I am} looking for adventure and a capable Captain to provide it."),
      (else_try),
        (eq, ":var0", "trp_vanskerry_marauder"),
        (str_store_string, s4, "@Aye {reg63?Lord:Lady}. {reg3?I and {reg4?{reg3} of my axe brothers:one of my axebrothers} are:I am} looking for a Jarl to fill {reg3?our bellies:my belly} with wine and our pockets with gold."),
      (else_try),
        (eq, ":var0", "trp_jatu_merc"),
        (str_store_string, s4, "@We are Jatu {reg63?Lord:Lady}. {reg3?I and {reg4?{reg3} of my Hunt Brothers:one of my Hunt Brothers} are:I am} looking for a Ride Master to lead {reg3?our lances:my lance} to glory."),
      (else_try),
        (eq, ":var0", "trp_highlander_merc"),
        (str_store_string, s4, "@Well met {reg63?Lord:Lady} Eorl. {reg3?I and {reg4?{reg3} of my Highland Brothers:one of my Highland Brothers} are:I am} seeking to serve a captain who is worthy of commanding {reg3?our:my} steel."),
      (else_try),
        (eq, ":var0", "trp_looter_merc"),
        (str_store_string, s4, "@Aya good {reg63?Lord:Lady}. {reg3?I and {reg4?{reg3} of my mates:one of my mates} are:I am} looking to improve our lot in life. {reg3?We:I}'d gladly follow you if you gave {reg3?us:me} a chance."),
      (else_try),
        (is_between, ":var0", "trp_follower_woman", "trp_mercenaries_end"),
        (str_store_string, s4, "@Hail good {reg63?Lord:Lady}. {reg3?I and {reg4?{reg3} of my sisters:one of my sisters} are:I am} looking to serve a capable Captain."),
      (else_try),
        (eq, ":var0", "trp_mett_avonteurer"),
        (str_store_string, s4, "@Hai {reg63?Lord:Lady} Captain! {reg3?I and {reg4?{reg3} of my companions:one of my companions} are:I am} looking to serve under a renowned adventurer who can lead {reg3?us:me} to glory in these strange lands."),
      (else_try),
        (eq, ":var0", "trp_vecavi_man_hunter"),
        (str_store_string, s4, "@Salute {reg63?Lord:Lady} Captain! {reg3?I and {reg4?{reg3} of my sisters:one of my sisters} are:I am} looking to follow a worthy captain so {reg3?we:I} may earn enough to purchase {reg3?our:my} bed thralls."),
      (else_try),
        (eq, ":var0", "trp_melitine_merc"),
        (str_store_string, s4, "@Oi! Sein Captain! {reg3?I and {reg4?{reg3} of my free brothers:one of my free brothers} are:I am} looking to follow a charismatic and, shall we say, profitable captain! {reg3?We:I} seek to use {reg3?our:my} prowess to earn gold for wine, women and song!"),
      (else_try),
        (eq, ":var0", "trp_barclay_adventurer"),
        (str_store_string, s4, "@Salutations camarada! {reg3?I and {reg4?{reg3} of my fellow soldats:one of my fellow soldat} are:I am} looking to join a party of thrill-seeking adventurers and to follow a cunning commandant! Whom {reg3?we:I} hope can follow an old saying from Barclay: Conquest, Glory, and Gold!"),
      (else_try),
        (str_store_string, s4, "@Do you have a need for hired swords, {reg63?sir:madam}. {reg3?Me and {reg4?{reg3} of my mates:one of my mates} are:I am} looking for a captain."),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 14),
    ],
    "Any orders, {reg63?sir:madam}?",
    "mercenary_after_recruited",
    []],

  [plyr|anyone, "mercenary_after_recruited",
    [],
    "Make your preparations. We'll be moving at dawn.",
    "mercenary_after_recruited_2",
    []],

  [plyr|anyone, "mercenary_after_recruited",
    [],
    "Take your time. We'll be staying in this town for a while.",
    "mercenary_after_recruited_2",
    []],

  [anyone, "mercenary_after_recruited_2",
    [],
    "Yes {reg63?sir:madam}. We'll be ready when you tell us to leave.",
    "close_window",
    []],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (check_quest_active, "qst_order_challenge"),
      (neg|check_quest_succeeded, "qst_order_challenge"),
      (neg|check_quest_failed, "qst_order_challenge"),
      (assign, "$temp", -1),
    ],
    "That sounds good. But I'm on a special mission right now.",
    "tavern_mercenary_cant_lead",
    []],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 91),
      (eq, ":var0", "$temp"),
      (party_get_slot, ":var1", "$g_encountered_party", 90),
      (call_script, "script_game_get_join_cost", ":var1"),
      (store_mul, reg5, "$temp", reg0),
    ],
    "All right. I will hire all of you. Here are {reg5} denars.",
    "mercenary_tavern_talk_hire",
    []],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 91),
      (lt, "$temp", ":var0"),
      (gt, "$temp", 0),
      (assign, reg6, "$temp"),
      (party_get_slot, ":var1", "$g_encountered_party", 90),
      (call_script, "script_game_get_join_cost", ":var1"),
      (store_mul, reg5, "$temp", reg0),
    ],
    "All right, but I can only hire {reg6} of you. Here are {reg5} denars.",
    "mercenary_tavern_talk_hire",
    []],

  [anyone, "mercenary_tavern_talk_hire",
    [
      (store_random_in_range, ":var0", 0, 4),
      (try_begin),
        (eq, ":var0", 0),
        (gt, "$temp", 1),
        (str_store_string, s17, "@You chose well, {reg63?sir:madam}. My lads know how to keep their word and earn their pay."),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s17, "@Well done, {reg63?sir:madam}. Keep the money and wine coming our way, and there's no foe in Pendor you need fear."),
      (else_try),
        (eq, ":var0", 2),
        (str_store_string, s17, "@We are at your service, {reg63?sir:madam}. Point us in the direction of battle, and we'll do the rest."),
      (else_try),
        (str_store_string, s17, "str_you_will_not_be_disappointed_sirmadam_you_will_not_find_better_warriors_in_all_calradia"),
      (try_end),
    ],
    "{s17}",
    "close_window",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 90),
      (call_script, "script_game_get_join_cost", ":var0"),
      (store_mul, ":var1", "$temp", reg0),
      (troop_remove_gold, "trp_player", ":var1"),
      (party_add_members, "p_main_party", ":var0", "$temp"),
      (party_set_slot, "$g_encountered_party", 91, 0),
    ]],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (eq, "$temp", 0),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (ge, ":var0", 1),
    ],
    "That sounds good, but I can't afford to hire any more men right now.",
    "tavern_mercenary_cant_lead",
    []],

  [anyone, "tavern_mercenary_cant_lead",
    [],
    "That's a pity. Well, {reg3?we will:I will} be lingering around here for a while, if you need to hire anyone.",
    "close_window",
    []],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (eq, "$temp", 0),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (eq, ":var0", 0),
    ],
    "That sounds good, but I can't lead any more men right now.",
    "tavern_mercenary_cant_lead",
    []],

  [plyr|anyone, "mercenary_tavern_talk",
    [
      (neq, "$temp", -1),
    ],
    "Sorry. I don't need any other men right now.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_trainer_1", "trp_ransom_broker_1"),
      (eq, "$g_talk_troop_met", 0),
    ],
    "Good day to you {reg63?lad:lass}. You look like another adventurer who has come to try {reg63?his:her} chance in these lands. Well, trust my word, you won't be able to survive long here unless you know how to fight yourself out of a tight spot.",
    "trainer_intro_1",
    []],

  [plyr|anyone, "trainer_intro_1",
    [],
    "Thank you for your advice. This place looks like a training field. Maybe I can learn about fighting here?",
    "trainer_intro_2",
    []],

  [anyone, "trainer_intro_2",
    [],
    "Indeed you can. I am a veteran soldier... fought a good deal in the wars in my time. But these days, I train young novices in this area. I can find you some opponents to practice with if you like. Or if you have any questions about the theory of combat, feel free to ask.",
    "trainer_intro_3",
    []],

  [plyr|anyone, "trainer_intro_3",
    [],
    "Yes, I do have a few questions.",
    "trainer_intro_4a",
    []],

  [plyr|anyone, "trainer_intro_3",
    [],
    "Actually, I can move on to practice.",
    "trainer_intro_4b",
    []],

  [anyone, "trainer_intro_4a",
    [],
    "Well, ask anything you like.",
    "trainer_talk_combat",
    []],

  [anyone, "trainer_intro_4b",
    [],
    "Good. It's good to find someone eager for practice. Let's see what you will do.",
    "trainer_practice_1",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_trainer_1", "trp_ransom_broker_1"),
      (neq, "$waiting_for_training_fight_result", 0),
      (neq, "$training_fight_won", 0),
    ],
    "That was a good fight. ",
    "trainer_practice_1",
    [
      (val_sub, "$num_opponents_to_beat_in_a_row", 1),
      (assign, "$waiting_for_training_fight_result", 0),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_trainer_1", "trp_ransom_broker_1"),
      (neq, "$waiting_for_training_fight_result", 0),
    ],
    "Ha! Looks like you've developed a bit of a limp there. Don't worry, even losses have their value, provided you learn from them. Shake the stars out of your eyes and get back in there. There's no other way to win.",
    "trainer_practice_1",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (assign, "$waiting_for_training_fight_result", 0),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_trainer_1", "trp_ransom_broker_1"),
    ],
    "Good day. Ready for some training today?",
    "trainer_talk",
    []],

  [anyone, "trainer_pretalk",
    [],
    "Ah, are you ready for some training?",
    "trainer_talk",
    []],

  [plyr|anyone, "trainer_talk",
    [],
    "I am ready for some practice.",
    "trainer_practice_1",
    []],

  [plyr|anyone, "trainer_talk",
    [],
    "First, tell me something about combat...",
    "trainer_combat_begin",
    []],

  [plyr|anyone, "trainer_talk",
    [],
    "I need to leave now. Farewell.",
    "close_window",
    []],

  [anyone, "trainer_combat_begin",
    [],
    "What do you want to know?",
    "trainer_talk_combat",
    []],

  [anyone, "trainer_combat_pretalk",
    [],
    "What else do you want to know?",
    "trainer_talk_combat",
    []],

  [plyr|anyone, "trainer_talk_combat",
    [],
    "Tell me about defending myself.",
    "trainer_explain_defense",
    []],

  [plyr|anyone, "trainer_talk_combat",
    [],
    "Tell me about attacking with weapons.",
    "trainer_explain_attack",
    []],

  [plyr|anyone, "trainer_talk_combat",
    [],
    "Tell me about fighting on horseback.",
    "trainer_explain_horseback",
    []],

  [plyr|anyone, "trainer_talk_combat",
    [
      (player_has_item, "itm_salt"),
      (eq, 0, 1),
    ],
    "Tell me about Pendor.",
    "close_window",
    [
      (party_count_members_of_type, ":var0", "p_main_party", "trp_noldor_knight"),
      (party_count_members_of_type, ":var1", "p_main_party", "trp_noldor_maiden"),
      (val_add, ":var0", ":var1"),
      (party_count_members_of_type, ":var2", "p_main_party", "trp_noldor_ranger"),
      (val_add, ":var0", ":var2"),
      (party_count_members_of_type, ":var3", "p_main_party", "trp_noldor_warrior"),
      (val_add, ":var0", ":var3"),
      (party_count_members_of_type, ":var4", "p_main_party", "trp_pendor_knight"),
      (val_add, ":var0", ":var4"),
      (troop_remove_item, "trp_player", "itm_salt"),
      (troop_remove_item, "trp_player", "itm_salt"),
      (troop_remove_item, "trp_player", "itm_salt"),
      (try_begin),
        (this_or_next|player_has_item, "itm_qualis"),
        (gt, ":var0", 0),
      (else_try),
        (try_begin),
          (player_has_item, "itm_spice"),
          (call_script, "script_change_troop_renown", "trp_player", 200),
          (call_script, "script_change_player_honor", 4),
          (troop_add_item, "trp_player", "itm_baggage_train", imod_plain),
          (troop_add_gold, "trp_player", 100000),
          (troop_add_item, "trp_player", "itm_qualis", imod_plain),
        (try_end),
        (party_add_members, "p_main_party", "trp_noldor_maiden", 5),
        (party_add_members, "p_main_party", "trp_noldor_knight", 5),
        (party_add_members, "p_main_party", "trp_noldor_ranger", 5),
        (party_add_members, "p_main_party", "trp_noldor_warrior", 5),
        (party_add_members, "p_main_party", "trp_pendor_knight", 5),
        (disable_party, "p_training_ground_1"),
        (disable_party, "p_training_ground_2"),
        (disable_party, "p_training_ground_3"),
        (disable_party, "p_training_ground_4"),
        (disable_party, "p_training_ground_5"),
      (try_end),
    ]],

  [plyr|anyone, "trainer_talk_combat",
    [],
    "I guess I know all the theory I need. Let's talk about something else.",
    "trainer_pretalk",
    []],

  [anyone, "trainer_explain_defense",
    [],
    "Good question. The first thing you should know as a fighter is how to defend yourself. Keeping yourself out of harm's way is the first rule of combat, and it is much more important than giving harm to others. Everybody can swing a sword around and hope to cut some flesh, but only those fighters that are experts at defense live to tell of it.",
    "trainer_explain_defense_2",
    []],

  [anyone, "trainer_explain_defense_2",
    [],
    "Now. Defending yourself is easiest if you are equipped with a shield. Just block with your shield. [Hold down the right mouse button to defend yourself with the shield.] In this state, you will be able to deflect all attacks that come from your front. However, you will still be open to strikes from your sides or your back.",
    "trainer_explain_defense_3",
    []],

  [plyr|anyone, "trainer_explain_defense_3",
    [],
    "What if I don't have a shield?",
    "trainer_explain_defense_4",
    []],

  [anyone, "trainer_explain_defense_4",
    [],
    "Then you will have to use your weapon to block your opponent. This is a bit more difficult than defending with a shield. Defending with a weapon, you can block against only ONE attack direction. That is, you block against either overhead swings, side swings or thrusts. Therefore you must watch your opponent carefully and start to block AFTER he starts his attack. In this way you will be able to block against the direction of his current attack. If you start to block BEFORE he makes his move, he may just attack in another direction than the one you are blocking against and score a hit.",
    "trainer_combat_pretalk",
    []],

  [anyone, "trainer_explain_attack",
    [],
    "Good question. Attacking is the best defence, they say. A tactic fighters find useful is taking an offensive stance and readying your weapon for attack, waiting for the right moment for swinging it. [You can ready your weapon for attack by pressing and holding down the left mouse button.]",
    "trainer_explain_attack_2",
    []],

  [plyr|anyone, "trainer_explain_attack_2",
    [],
    "That sounds useful.",
    "trainer_explain_attack_3",
    []],

  [anyone, "trainer_explain_attack_3",
    [],
    "It is a good tactic, but remember that, your opponent may see that and take a defensive stance against the direction you are swinging your weapon. If that happens, you must break your attack and quickly attack from another direction [You may cancel your current attack by quickly tapping the right mouse button].",
    "trainer_explain_attack_4",
    []],

  [plyr|anyone, "trainer_explain_attack_4",
    [],
    "If my opponent is defending against the direction I am attacking from, I will break and use another direction.",
    "trainer_explain_attack_5",
    []],

  [anyone, "trainer_explain_attack_5",
    [],
    "Yes, selecting the direction you swing your weapon is a crucial skill. There are four main directions you may use: right swing, left swing, overhead swing and thrust. You must use each one wisely. [to control your swing direction with default controls, move your mouse in the direction you want to swing from as you press the left mouse button].",
    "trainer_combat_pretalk",
    []],

  [anyone, "trainer_explain_horseback",
    [],
    "Very good question. A horse may be a warrior's most powerful weapon in combat. It gives you speed, height, power and initiative. A lot of deadly weapons will become even deadlier on horseback. However you must pay particular attention to horse-mounted enemies couching their lances, as they may take down any opponent in one hit. [To use the couched lance yourself, wield a lance or similar weapon, and speed up your horse without pressing attack or defense buttons. after you reach a speed, you'll lower your lance. Then try to target your enemies by maneuvering your horse.]",
    "trainer_combat_pretalk",
    []],

  [anyone, "trainer_practice_1",
    [
      (eq, "$training_system_explained", 0),
    ],
    "I train novices in four stages, each tougher than the one before. To finish a stage and advance to the next one, you have to win three fights in a row.",
    "trainer_practice_1",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (assign, "$novicemaster_opponent_troop", "trp_novice_fighter"),
      (assign, "$training_system_explained", 1),
    ]],

  [anyone, "trainer_practice_1",
    [
      (ge, "$novice_training_difficulty", 4),
    ],
    "You have passed all stages of training - though, if you want, you can still practice. Are you ready?",
    "novicemaster_are_you_ready",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 99999),
    ]],

  [anyone, "trainer_practice_1",
    [
      (eq, "$num_opponents_to_beat_in_a_row", 0),
      (eq, "$novice_training_difficulty", 0),
    ],
    "Way to go {reg63?lad:lass}. With this victory, you have advanced to the next training level. From now on your opponents will be regular fighters, not the riff-raff off the street, so be on your toes.",
    "trainer_practice_1",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (val_add, "$novice_training_difficulty", 1),
      (add_xp_to_troop, 100),
      (assign, "$novicemaster_opponent_troop", "trp_regular_fighter"),
    ]],

  [anyone, "trainer_practice_1",
    [
      (eq, "$num_opponents_to_beat_in_a_row", 0),
      (eq, "$novice_training_difficulty", 1),
    ],
    "Way to go {reg63?lad:lass}. Welcome to the third training level. From now on your opponents will be veteran fighters; soldiers and arena regulars and the like. These guys know some dirty tricks, so keep your defense up.",
    "trainer_practice_1",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (val_add, "$novice_training_difficulty", 1),
      (add_xp_to_troop, 100),
      (assign, "$novicemaster_opponent_troop", "trp_veteran_fighter"),
    ]],

  [anyone, "trainer_practice_1",
    [
      (eq, "$num_opponents_to_beat_in_a_row", 0),
      (eq, "$novice_training_difficulty", 2),
    ],
    "You've got the heart of a champion, {reg63?lad:lass}, and the sword arm to match. From now on your opponents will be champion fighters. These are the cream of the crop, the finest warriors I have trained. If you can best three of them in a row, you will join their ranks.",
    "trainer_practice_1",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (val_add, "$novice_training_difficulty", 1),
      (add_xp_to_troop, 100),
      (assign, "$novicemaster_opponent_troop", "trp_champion_fighter"),
    ]],

  [anyone, "trainer_practice_1",
    [
      (eq, "$num_opponents_to_beat_in_a_row", 0),
      (eq, "$novice_training_difficulty", 3),
    ],
    "It does my heart good to see such a promising talent. You have passed all tiers of training. You can now tell everyone that you have been trained by the master of the training field.",
    "novicemaster_finish_training",
    [
      (assign, "$num_opponents_to_beat_in_a_row", 3),
      (val_add, "$novice_training_difficulty", 1),
      (add_xp_to_troop, 300),
    ]],

  [plyr|anyone, "novicemaster_finish_training",
    [],
    "Thank you master.",
    "novicemaster_finish_training_2",
    []],

  [anyone, "novicemaster_finish_training_2",
    [],
    "I wish you good luck in the tournaments. And, don't forget,  if you want to practice your swordwork anytime, just come and say the word.",
    "close_window",
    []],

  [anyone, "trainer_practice_1",
    [
      (assign, reg8, "$num_opponents_to_beat_in_a_row"),
      (str_store_troop_name, s9, "$novicemaster_opponent_troop"),
    ],
    "Your next opponent will be a {s9}. You need to win {reg8} more fights in a row to advance to the next stage. Are you ready?",
    "novicemaster_are_you_ready",
    []],

  [plyr|anyone, "novicemaster_are_you_ready",
    [],
    "Yes I am.",
    "novicemaster_ready_to_fight",
    []],

  [anyone, "novicemaster_ready_to_fight",
    [],
    "Here you go then. Good luck.",
    "close_window",
    [
      (assign, "$training_fight_won", 0),
      (assign, "$waiting_for_training_fight_result", 1),
      (modify_visitors_at_site, "$g_training_ground_melee_training_scene"),
      (reset_visitors),
      (assign, reg0, 0),
      (assign, reg1, 1),
      (assign, reg2, 2),
      (assign, reg3, 3),
      (shuffle_range, 0, 4),
      (set_visitor, reg0, "trp_player"),
      (set_visitor, reg1, "$novicemaster_opponent_troop"),
      (set_visitor, 4, "$g_talk_troop"),
      (set_jump_mission, "mt_training_ground_trainer_training"),
      (jump_to_scene, "$g_training_ground_melee_training_scene"),
    ]],

  [plyr|anyone, "novicemaster_are_you_ready",
    [],
    "Just a minute. I am not ready yet.",
    "novicemaster_not_ready",
    []],

  [anyone, "novicemaster_not_ready",
    [],
    "Hey, you will never make it if you don't practice.",
    "close_window",
    []],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_master_craftsman", "trp_zendar_chest"),
      (party_get_slot, ":var0", "$g_encountered_party", 139),
      (ge, ":var0", 2),
      (assign, reg4, ":var0"),
    ],
    "{!}.",
    "start_craftsman_soon",
    []],

  [anyone, "start_craftsman_soon",
    [],
    "Good day, my {reg63?lord:lady}. We hope to begin production in about {reg4} days.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_master_craftsman", "trp_zendar_chest"),
    ],
    "Good day, my {reg63?lord:lady}. We are honored that you have chosen to visit us. What do you require?",
    "master_craftsman_talk",
    []],

  [anyone, "master_craftsman_pretalk",
    [],
    "Very good, my {reg63?lord:lady}. Do you require anything else?",
    "master_craftsman_talk",
    []],

  [plyr|anyone, "master_craftsman_talk",
    [],
    "Let's go over the accounts.",
    "master_craftsman_accounts",
    []],

  [plyr|anyone, "master_craftsman_talk",
    [],
    "Let's check the inventories.",
    "master_craftsman_pretalk",
    [
      (change_screen_loot, "$g_talk_troop"),
    ]],

  [plyr|anyone, "master_craftsman_talk",
    [
      (party_slot_eq, "$g_encountered_party", 138, 1),
    ],
    "I'd like you to sell goods as they are produced.",
    "master_craftsman_pretalk",
    [
      (party_set_slot, "$g_encountered_party", 138, 0),
    ]],

  [plyr|anyone, "master_craftsman_talk",
    [
      (party_slot_eq, "$g_encountered_party", 138, 0),
    ],
    "I'd like you to keep all goods in the warehouse until I arrive.",
    "master_craftsman_pretalk",
    [
      (party_set_slot, "$g_encountered_party", 138, 1),
    ]],

  [anyone, "master_craftsman_accounts",
    [],
    "We currently produce {s3} worth {reg1} denars each week, while the quantity of {s4} needed to manufacture it costs {reg2}, and labor and upkeep are {reg3}.{s9} This means that we theoretically make a {s12} of {reg0} denars a week, assuming that we have no raw materials in the inventories, and that we sell directly to the market.",
    "master_craftsman_pretalk",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 137),
      (call_script, "script_process_player_enterprise", ":var0", "$g_encountered_party"),
      (try_begin),
        (ge, reg0, 0),
        (str_store_string, s12, "str_profit"),
      (else_try),
        (str_store_string, s12, "str_loss"),
      (try_end),
      (str_store_item_name, s3, ":var0"),
      (item_get_slot, ":var1", ":var0", 50),
      (str_store_item_name, s4, ":var1"),
      (item_get_slot, ":var2", ":var0", 57),
      (str_clear, s9),
      (try_begin),
        (gt, ":var2", 0),
        (str_store_item_name, s11, ":var2"),
        (str_store_string, s9, "str_describe_secondary_input"),
      (try_end),
    ]],

  [plyr|anyone, "master_craftsman_talk",
    [],
    "Could you explain my options related to production?",
    "master_craftsman_production_options",
    []],

  [anyone, "master_craftsman_production_options",
    [
      (str_store_party_name, s5, "$g_encountered_party"),
    ],
    "Certainly, my {reg63?lord:lady}. Most of the time, the most profitable thing for you to do would be to let us buy raw materials and sell the finished goods directly to the market. Because of our longstanding relations with the local merchants, we can usually get a very good price.",
    "master_craftsman_production_options_2",
    []],

  [anyone, "master_craftsman_production_options_2",
    [
      (str_store_party_name, s5, "$g_encountered_party"),
    ],
    "However, if you find that you can acquire raw materials cheaper outside {s5}, you may place them in the inventories, and we will use them instead of buying from the market. Likewise, if you feel that you can get a better price for the finished goods elsewhere, then you may ask us to deposit what we produce in our warehouses for you to take.",
    "master_craftsman_pretalk",
    []],

  [plyr|anyone, "master_craftsman_talk",
    [],
    "It will no longer be possible for me to continue operating this enterprise.",
    "master_craftsman_auction_price",
    []],

  [anyone, "master_craftsman_auction_price",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 137),
      (item_get_slot, ":var1", ":var0", 53),
      (item_get_slot, ":var2", ":var0", 55),
      (store_mul, "$liquidation_price", ":var1", ":var2"),
      (val_mul, "$liquidation_price", 4),
      (troop_get_inventory_capacity, ":var3", "$g_talk_troop"),
      (try_for_range, ":var4", 0, ":var3"),
        (troop_get_inventory_slot, ":var5", "$g_talk_troop", ":var4"),
        (gt, ":var5", 0),
        (item_get_slot, ":var6", ":var5", 53),
        (store_sub, ":var7", ":var5", "itm_spice"),
        (val_add, ":var7", 301),
        (party_get_slot, ":var8", "$g_encountered_party", ":var7"),
        (val_mul, ":var6", ":var8"),
        (val_div, ":var6", 1200),
        (val_add, "$liquidation_price", ":var6"),
      (try_end),
      (assign, reg4, "$liquidation_price"),
    ],
    "A pity, my {reg63?lord:lady}. If we sell the land and the equipment, and liquidate the inventories, I estimate that we can get {reg4} denars.",
    "master_craftsman_auction_decide",
    []],

  [plyr|anyone, "master_craftsman_auction_decide",
    [],
    "That sounds reasonable. Please proceed with the sale.",
    "master_craftsman_liquidation",
    [
      (troop_add_gold, "trp_player", "$liquidation_price"),
      (troop_clear_inventory, "$g_talk_troop"),
      (party_set_slot, "$g_encountered_party", 137, 0),
      (party_set_slot, "$g_encountered_party", 138, 0),
    ]],

  [plyr|anyone, "master_craftsman_auction_decide",
    [],
    "Hmm. Let's hold off on that.",
    "master_craftsman_pretalk",
    []],

  [anyone, "master_craftsman_liquidation",
    [],
    "As you wish. It was an honor to have been in your employ.",
    "close_window",
    [
      (finish_mission),
    ]],

  [plyr|anyone, "master_craftsman_talk",
    [
      (eq, 1, 0),
    ],
    "{!}As you wish, {reg63?sir:my lady}. It was an honor to work in your employ.",
    "close_window",
    []],

  [plyr|anyone, "master_craftsman_talk",
    [],
    "That is all for now.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_mayor", "trp_village_1_elder"),
      (eq, "$g_talk_troop_met", 1),
      (this_or_next|eq, "$players_kingdom", "$g_encountered_party_faction"),
      (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ],
    "Good day, {reg63?my Lord:my Lady}",
    "mayor_begin",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_mayor", "trp_village_1_elder"),
      (eq, "$g_talk_troop_met", 0),
      (str_store_party_name, s9, "$current_town"),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ],
    "Hello stranger, you seem to be new to {s9}. I am the guild master of the town.",
    "mayor_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_mayor", "trp_village_1_elder"),
    ],
    "Good day, {playername}.",
    "mayor_begin",
    [
      (try_begin),
        (eq, "$merchant_offered_quest", "qst_persuade_lords_to_make_peace"),
        (party_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 3),
        (party_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 15),
        (store_relation, ":var2", ":var0", ":var1"),
        (ge, ":var2", 0),
        (assign, "$merchant_quest_last_offerer", -1),
        (assign, "$merchant_offered_quest", -1),
      (try_end),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_persuade_lords_to_make_peace"),
      (quest_slot_eq, "qst_persuade_lords_to_make_peace", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_persuade_lords_to_make_peace"),
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 2),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (val_mul, ":var0", -1),
      (val_mul, ":var1", -1),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var3", "qst_persuade_lords_to_make_peace", 15),
      (str_store_troop_name, s12, ":var0"),
      (str_store_troop_name, s13, ":var1"),
      (str_store_faction_name, s14, ":var2"),
      (str_store_faction_name, s15, ":var3"),
      (str_store_party_name, s19, "$current_town"),
    ],
    "{playername}, it was an incredible feat to get {s14} and {s15} make peace, and you made it happen. Your involvement has not only saved our town from disaster, but it has also saved thousands of lives, and put an end to all the grief this bitter war has caused. As the townspeople of {s19}, know that we'll be good on our word, and we are ready to pay the {reg12} denars we promised.",
    "lord_persuade_lords_to_make_peace_completed",
    [
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 15),
      (assign, "$g_force_peace_faction_1", ":var0"),
      (assign, "$g_force_peace_faction_2", ":var1"),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 22),
      (assign, reg12, ":var2"),
    ]],

  [plyr|anyone, "lord_persuade_lords_to_make_peace_completed",
    [],
    "Thank you. Let me have the money.",
    "lord_persuade_lords_to_make_peace_pay",
    []],

  [plyr|anyone, "lord_persuade_lords_to_make_peace_completed",
    [],
    "No need for a payment. I only did what was right.",
    "lord_persuade_lords_to_make_peace_no_pay",
    []],

  [anyone, "lord_persuade_lords_to_make_peace_pay",
    [],
    "Oh, yes, of course. We had already got the money for you. Here, please accept these {reg12} denars together with our most sincere thanks. Me and the people of our town will not forget your help.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 22),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_finish_quest_simple", "qst_persuade_lords_to_make_peace", 100),
      (assign, reg12, ":var0"),
    ]],

  [anyone, "lord_persuade_lords_to_make_peace_no_pay",
    [],
    "You are indeed an extraordinary person, {reg63?sir:madame}, and it is an honor for me to have known you. You not only did what was impossible and put an end to this terrible war, but you won't even accept a reward for it. Very well, I will not insist on the matter, but please know that you will have our eternal respect and gratitude.",
    "close_window",
    [
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_player_relation_with_center", "$current_town", 8),
      (add_xp_as_reward, 3000),
      (call_script, "script_end_quest", "qst_persuade_lords_to_make_peace"),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_deal_with_night_bandits"),
      (quest_slot_eq, "qst_deal_with_night_bandits", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_deal_with_night_bandits"),
    ],
    "Very nice work, {playername}, you made short work of those lawless curs. Thank you kindly for all your help, and please accept this bounty of {reg33} denars.",
    "lord_deal_with_night_bandits_completed",
    [
      (quest_get_slot, ":var0", "qst_deal_with_night_bandits", 22),
      (assign, reg33, ":var0"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_finish_quest_simple", "qst_deal_with_night_bandits", 100),
    ]],

  [plyr|anyone, "lord_deal_with_night_bandits_completed",
    [],
    "It was my pleasure, {s65}.",
    "close_window",
    []],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_deal_with_looters"),
      (quest_slot_eq, "qst_deal_with_looters", 6, "$g_talk_troop"),
    ],
    "Ah, {playername}. Have you any progress to report?",
    "mayor_looters_quest_response",
    []],

  [plyr|anyone, "mayor_looters_quest_response",
    [
      (store_num_parties_destroyed_by_player, ":var0", "pt_looters_quest"),
      (party_template_get_slot, ":var1", "pt_looters_quest", 1),
      (val_sub, ":var0", ":var1"),
      (quest_get_slot, ":var2", "qst_deal_with_looters", 11),
      (lt, ":var2", ":var0"),
    ],
    "I've killed some looters.",
    "mayor_looters_quest_destroyed",
    []],

  [plyr|anyone, "mayor_looters_quest_response",
    [
      (eq, 1, 0),
    ],
    "I've brought you some goods.",
    "mayor_looters_quest_goods",
    []],

  [plyr|anyone, "mayor_looters_quest_response",
    [],
    "Not yet, sir. Farewell.",
    "close_window",
    []],

  [anyone, "mayor_looters_quest_destroyed",
    [],
    "Aye, my scouts saw the whole thing. That should make anyone else think twice before turning outlaw! The bounty is 200 denars for every band, so that makes {reg1} in total. Here is your money, as promised.",
    "mayor_looters_quest_destroyed_2",
    [
      (store_num_parties_destroyed_by_player, ":var0", "pt_looters_quest"),
      (party_template_get_slot, ":var1", "pt_looters_quest", 1),
      (val_sub, ":var0", ":var1"),
      (quest_get_slot, ":var2", "qst_deal_with_looters", 11),
      (store_sub, ":var3", ":var0", ":var2"),
      (val_mul, ":var3", 200),
      (assign, reg1, ":var3"),
      (call_script, "script_troop_add_gold", "trp_player", ":var3"),
      (assign, ":var2", ":var0"),
      (quest_set_slot, "qst_deal_with_looters", 11, ":var2"),
    ]],

  [anyone, "mayor_looters_quest_destroyed_2",
    [
      (quest_get_slot, ":var0", "qst_deal_with_looters", 10),
      (quest_slot_ge, "qst_deal_with_looters", 11, ":var0"),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_finish_quest_simple", "qst_deal_with_looters", 100),
      (try_for_parties, ":var1"),
        (party_get_template_id, ":var2", ":var1"),
        (eq, ":var2", "pt_looters_quest"),
        (party_set_flags, ":var1", 262144, 0),
      (try_end),
    ],
    "And that's not the only good news! Thanks to you, the looters have ceased to be a threat. We've not had a single attack reported for some time now.   If there are any of them left, they've either run off or gone deep into hiding. That's good for business,   and what's good for business is good for the town!   I think that concludes our arrangement, {playername}. Please accept this silver as a token of my gratitude. Thank you, and farewell.",
    "close_window",
    []],

  [anyone, "mayor_looters_quest_destroyed_2",
    [],
    "Anything else you need?",
    "mayor_looters_quest_response",
    []],

  [anyone, "mayor_looters_quest_goods",
    [
      (quest_get_slot, reg1, "qst_deal_with_looters", 14),
    ],
    "Hah, I knew I could count on you! Just tell me which item to take from your baggage, and I'll send some men to collect it. I still need {reg1} denars' worth of goods.",
    "mayor_looters_quest_goods_response",
    []],

  [repeat_for_100|plyr|anyone, "mayor_looters_quest_goods_response",
    [
      (store_repeat_object, ":var0"),
      (val_add, ":var0", "itm_spice"),
      (is_between, ":var0", "itm_spice", "itm_baggage_train"),
      (player_has_item, ":var0"),
      (str_store_item_name, s5, ":var0"),
    ],
    "{s5}.",
    "mayor_looters_quest_goods_2",
    [
      (store_repeat_object, ":var0"),
      (val_add, ":var0", "itm_spice"),
      (troop_remove_items, "trp_player", ":var0", 1),
      (assign, ":var1", reg0),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
      (quest_get_slot, ":var2", "qst_deal_with_looters", 14),
      (val_sub, ":var2", ":var1"),
      (quest_set_slot, "qst_deal_with_looters", 14, ":var2"),
      (str_store_item_name, s6, ":var0"),
    ]],

  [plyr|anyone, "mayor_looters_quest_goods_response",
    [],
    "Nothing at the moment, sir.",
    "mayor_looters_quest_goods_3",
    []],

  [anyone, "mayor_looters_quest_goods_3",
    [],
    "Anything else you need?",
    "mayor_looters_quest_response",
    []],

  [anyone, "mayor_looters_quest_goods_2",
    [
      (quest_slot_ge, "qst_deal_with_looters", 14, 1),
      (quest_get_slot, reg1, "qst_deal_with_looters", 14),
    ],
    "Excellent, here is the money for your {s6}. Do you have any more goods to give me? I still need {reg1} denars' worth of goods.",
    "mayor_looters_quest_goods_response",
    []],

  [anyone, "mayor_looters_quest_goods_2",
    [
      (neg|quest_slot_ge, "qst_deal_with_looters", 14, 1),
      (quest_get_slot, ":var0", "qst_deal_with_looters", 21),
      (quest_get_slot, ":var1", "qst_deal_with_looters", 22),
      (add_xp_as_reward, ":var0"),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_end_quest", "qst_deal_with_looters"),
      (try_for_parties, ":var2"),
        (party_get_template_id, ":var3", ":var2"),
        (eq, ":var3", "pt_looters_quest"),
        (party_set_flags, ":var2", 262144, 0),
      (try_end),
    ],
    "Well done, {playername}, that's the last of the goods I need. Here is the money for your {s6}, and a small bonus for helping me out. I'm afraid I won't be paying for any more goods, nor bounties on looters, but you're welcome to keep hunting the bastards if any remain. Thank you for your help, I won't forget it.",
    "close_window",
    []],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_move_cattle_herd"),
      (quest_slot_eq, "qst_move_cattle_herd", 6, "$g_talk_troop"),
      (check_quest_succeeded, "qst_move_cattle_herd"),
    ],
    "Good to see you again {playername}. I have heard that you have delivered the cattle successfully. I will tell the merchants how reliable you are. And here is your pay, {reg8} denars.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_move_cattle_herd", 22),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_finish_quest_simple", "qst_move_cattle_herd", 100),
      (assign, reg8, ":var0"),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_move_cattle_herd"),
      (quest_slot_eq, "qst_move_cattle_herd", 6, "$g_talk_troop"),
      (check_quest_failed, "qst_move_cattle_herd"),
    ],
    "I heard that you have lost the cattle herd on your way to {s9}. I had a very difficult time explaining your failure to the owner of that herd, {reg63?sir:madam}. Do you have anything to say?",
    "move_cattle_herd_failed",
    []],

  [plyr|anyone, "move_cattle_herd_failed",
    [],
    "I am sorry. But I was attacked on the way.",
    "move_cattle_herd_failed_2",
    []],

  [plyr|anyone, "move_cattle_herd_failed",
    [],
    "I am sorry. The stupid animals wandered off during the night.",
    "move_cattle_herd_failed_2",
    []],

  [anyone, "move_cattle_herd_failed_2",
    [],
    "Well, it was your responsibility to deliver that herd safely, no matter what. You should know that the owner of the herd demanded to be compensated for his loss, and I had to pay him 5000 denars. So you now owe me that money.",
    "merchant_ask_for_debts",
    [
      (assign, "$debt_to_merchants_guild", 5000),
      (call_script, "script_end_quest", "qst_move_cattle_herd"),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_kidnapped_girl"),
      (quest_slot_eq, "qst_kidnapped_girl", 11, 4),
      (quest_slot_eq, "qst_kidnapped_girl", 6, "$g_talk_troop"),
    ],
    "{playername} -- I am in your debt for bringing back my friend's daughter.  Please take these {reg8} denars that I promised you.  My friend wished he could give more but paying that ransom brought him to his knees.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 22),
      (assign, reg8, ":var0"),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_finish_quest_simple", "qst_kidnapped_girl", 100),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_track_down_bandits"),
      (check_quest_succeeded, "qst_track_down_bandits"),
      (quest_slot_eq, "qst_track_down_bandits", 6, "$g_talk_troop"),
    ],
    "Well -- it sounds like you were able to track down the bandits, and show them what happens to those who would disrupt the flow of commerce. Here is your reward: {reg5} denars. It is well earned, and we are most grateful.",
    "mayor_friendly_pretalk",
    [
      (quest_get_slot, ":var0", "qst_track_down_bandits", 22),
      (call_script, "script_troop_add_gold", "trp_player", ":var0"),
      (assign, reg5, ":var0"),
      (quest_get_slot, ":var1", "qst_track_down_bandits", 21),
      (add_xp_as_reward, ":var1"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_end_quest", "qst_track_down_bandits"),
    ]],

  [anyone, "mayor_begin",
    [
      (check_quest_active, "qst_troublesome_bandits"),
      (check_quest_succeeded, "qst_troublesome_bandits"),
      (quest_slot_eq, "qst_troublesome_bandits", 6, "$g_talk_troop"),
    ],
    "I have heard about your deeds. You have given those bandits the punishment they deserved. You are really as good as they say. Here is your reward: {reg5} denars. I would like to give more but those bandits almost brought me to bankruptcy.",
    "mayor_friendly_pretalk",
    [
      (quest_get_slot, ":var0", "qst_troublesome_bandits", 22),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_finish_quest", "qst_troublesome_bandits", 100),
      (assign, reg5, ":var0"),
    ]],

  [anyone, "mayor_begin",
    [
      (ge, "$debt_to_merchants_guild", 50),
    ],
    "According to my accounts, you owe the merchants guild {reg1} denars. I'd better collect that now.",
    "merchant_ask_for_debts",
    [
      (assign, reg1, "$debt_to_merchants_guild"),
    ]],

  [plyr|anyone, "merchant_ask_for_debts",
    [
      (store_troop_gold, reg5, "trp_player"),
      (ge, reg5, "$debt_to_merchants_guild"),
    ],
    "Alright. I'll pay my debt to you.",
    "merchant_debts_paid",
    [
      (troop_remove_gold, "trp_player", "$debt_to_merchants_guild"),
      (assign, "$debt_to_merchants_guild", 0),
    ]],

  [anyone, "merchant_debts_paid",
    [],
    "Excellent. I'll let my fellow merchants know that you are clear of any debts.",
    "mayor_pretalk",
    []],

  [plyr|anyone, "merchant_ask_for_debts",
    [],
    "I'm afraid I can't pay that sum now.",
    "merchant_debts_not_paid",
    []],

  [anyone, "merchant_debts_not_paid",
    [
      (assign, reg1, "$debt_to_merchants_guild"),
    ],
    "In that case, I am afraid, I can't deal with you. Guild rules... Come back when you can pay the {reg1} denars. And know that we'll be charging an interest to your debt. So the sooner you pay it, the better.",
    "close_window",
    []],

  [anyone, "mayor_begin",
    [],
    "What can I do for you?",
    "mayor_talk",
    []],

  [anyone, "mayor_friendly_pretalk",
    [],
    "Now... What else may I do for you?",
    "mayor_talk",
    []],

  [anyone, "mayor_pretalk",
    [],
    "Yes?",
    "mayor_talk",
    []],

  [plyr|anyone, "mayor_talk",
    [
      (quest_slot_eq, "qst_horse_armor", 11, 1),
      (quest_get_slot, ":var0", "qst_horse_armor", 1),
      (eq, "$current_town", ":var0"),
    ],
    "I am looking for some information about an old horse breed.",
    "mayor_info_horse_armor_1",
    []],

  [anyone, "mayor_info_horse_armor_1",
    [],
    "I won't be able to help you as I don't have any knowledge about this subject. Maybe try your luck in the local tavern or the merchants.",
    "mayor_talk",
    []],

  [plyr|anyone, "mayor_talk",
    [],
    "Can you tell me about what you do?",
    "mayor_info_begin",
    []],

  [plyr|anyone, "mayor_talk",
    [
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
      (neq, "$merchant_quest_last_offerer", "$g_talk_troop"),
    ],
    "Do you happen to have a job for me?",
    "merchant_quest_requested",
    [
      (assign, "$merchant_quest_last_offerer", "$g_talk_troop"),
      (call_script, "script_get_quest", "$g_talk_troop"),
      (assign, "$random_merchant_quest_no", reg0),
      (assign, "$merchant_offered_quest", "$random_merchant_quest_no"),
    ]],

  [plyr|anyone, "mayor_talk",
    [
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
      (eq, "$merchant_quest_last_offerer", "$g_talk_troop"),
      (gt, "$merchant_offered_quest", 0),
    ],
    "About that job you offered me...",
    "merchant_quest_last_offered_job",
    [
      (eq, "$random_merchant_quest_no", "qst_track_down_bandits"),
      (quest_get_slot, ":var0", "qst_track_down_bandits", 8),
      (assign, "$qst_track_down_bandits_exists", 0),
      (try_begin),
        (party_is_active, ":var0"),
        (assign, "$qst_track_down_bandits_exists", 1),
      (try_end),
    ]],

  [plyr|anyone, "mayor_talk",
    [
      (store_partner_quest, reg2),
      (ge, reg2, 0),
    ],
    "About the job you gave me...",
    "merchant_quest_about_job",
    []],

  [plyr|anyone, "mayor_talk",
    [],
    "I have some questions of a political nature.",
    "mayor_political_talk",
    []],

  [plyr|anyone, "mayor_talk",
    [],
    "How is trade around here?",
    "mayor_economy_report_1",
    [
      (call_script, "script_merchant_road_info_to_s42", "$g_encountered_party"),
    ]],

  [plyr|anyone, "mayor_talk",
    [],
    "How does the wealth of this region compare with the rest of Pendor?",
    "mayor_wealth_comparison_1",
    []],

  [plyr|anyone, "mayor_talk",
    [
      (item_slot_ge, "itm_velvet", 57, "itm_raw_dyes"),
    ],
    "I wish to buy land in this town for a productive enterprise.",
    "mayor_investment_possible",
    []],

  [anyone, "mayor_investment_possible",
    [
      (party_slot_ge, "$g_encountered_party", 137, 1),
      (party_get_slot, ":var0", "$g_encountered_party", 137),
      (call_script, "script_get_enterprise_name", ":var0"),
      (str_store_string, s4, reg0),
    ],
    "You already operate a {s4} here. There probably aren't enough skilled tradesmen to start a second enterprise.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_investment_possible",
    [
      (ge, "$cheat_mode", 3),
    ],
    "{!}CHEAT: Yes, we're playtesting this feature, and you're in cheat mode. Go right ahead.",
    "mayor_investment_advice",
    []],

  [anyone, "mayor_investment_possible",
    [
      (lt, "$g_encountered_party_relation", 0),
      (str_store_string, s9, "str_enterprise_enemy_realm"),
    ],
    "{s9}",
    "mayor_pretalk",
    []],

  [anyone, "mayor_investment_possible",
    [
      (party_slot_eq, "$g_encountered_party", 7, "trp_player"),
    ],
    "Of course, {reg63?sir:my lady}. You are the lord of this town, and no one is going to stop you.",
    "mayor_investment_advice",
    []],

  [anyone, "mayor_investment_possible",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 7),
      (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
      (assign, ":var1", reg0),
      (lt, ":var1", 0),
      (str_store_troop_name, s4, ":var0"),
    ],
    "Well... Given your relationship with our liege, {s4}, I think that you will not find many here who are brave enough to sell you any land.",
    "mayor_investment",
    []],

  [auto_proceed|anyone, "mayor_investment",
    [],
    "{!}.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_investment_possible",
    [
      (neg|party_slot_ge, "$current_town", 26, 0),
    ],
    "Well... To be honest, I think that we in the guild would like to know you a little better. We can be very particular about outsiders coming in here and buying land.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_investment_possible",
    [],
    "Very good, {reg63?sir:my lady}. We in the guild know and trust you, and I think I could find someone to sell you the land you need.",
    "mayor_investment_advice",
    []],

  [anyone, "mayor_investment_advice",
    [],
    "A couple of things to keep in mind -- skilled laborers are always at a premium, so I doubt that you will be able to open up more than one enterprise here. In order to make a profit for yourself, you should choose a commodity which is in relatively short supply, but for which the raw materials are cheap. What sort of enterprise would you like to start?",
    "investment_choose_enterprise",
    []],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A mill and bakery, to make bread from grain",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_bread"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A brewery, to make ale from grain",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_ale"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A tannery, to make leather from hides",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_leatherwork"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A wine press, to make wine from grapes",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_wine"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "An oil press, to make oil from olives",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_oil"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "An ironworks, to make tools from iron",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_tools"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A weavery and dyeworks, to make velvet from silk and dye",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_velvet"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A weavery, to make wool cloth from wool",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_wool_cloth"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "A weavery, to make linen from flax",
    "investment_summary",
    [
      (assign, "$enterprise_production", "itm_linen"),
    ]],

  [plyr|anyone, "investment_choose_enterprise",
    [],
    "Never mind",
    "mayor_pretalk",
    []],

  [anyone, "investment_summary",
    [],
    "Very good, sir. The land and the materials on which you may build your {s3} will cost you {reg7} denars. Right now, your {s3} will produce {s4} worth {reg1} denars each week, while the {s6} needed to manufacture that batch will be {reg2} and labor and upkeep will be {reg3}.{s9} I should guess that your profit would be {reg0} denars a week. This assumes, of course, that prices remain constant -- which, I can virtually guarantee, they will not. Do you wish to proceed?",
    "mayor_investment_confirm",
    [
      (item_get_slot, "$enterprise_cost", "$enterprise_production", 58),
      (assign, reg7, "$enterprise_cost"),
      (str_store_item_name, s4, "$enterprise_production"),
      (call_script, "script_get_enterprise_name", "$enterprise_production"),
      (str_store_string, s3, reg0),
      (call_script, "script_process_player_enterprise", "$enterprise_production", "$g_encountered_party"),
      (item_get_slot, ":var0", "$enterprise_production", 50),
      (str_store_item_name, s6, ":var0"),
      (str_clear, s9),
      (assign, ":var1", reg10),
      (try_begin),
        (gt, ":var1", 0),
        (item_get_slot, ":var2", "$enterprise_production", 57),
        (str_store_item_name, s11, ":var2"),
        (str_store_string, s9, "str_describe_secondary_input"),
      (try_end),
    ]],

  [plyr|anyone, "mayor_investment_confirm",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$enterprise_cost"),
    ],
    "Yes. Here is money for the land.",
    "mayor_investment_purchase",
    [
      (party_set_slot, "$g_encountered_party", 137, "$enterprise_production"),
      (party_set_slot, "$g_encountered_party", 139, 7),
      (troop_remove_gold, "trp_player", "$enterprise_cost"),
      (store_sub, ":var0", "$current_town", "p_town_1"),
      (store_add, ":var1", ":var0", "trp_town_1_master_craftsman"),
      (try_begin),
        (eq, "$enterprise_production", "itm_bread"),
        (1501, ":var1", "str_master_miller"),
      (else_try),
        (eq, "$enterprise_production", "itm_ale"),
        (1501, ":var1", "str_master_brewer"),
      (else_try),
        (eq, "$enterprise_production", "itm_oil"),
        (1501, ":var1", "str_master_presser"),
      (else_try),
        (eq, "$enterprise_production", "itm_tools"),
        (1501, ":var1", "str_master_smith"),
      (else_try),
        (eq, "$enterprise_production", "itm_wool_cloth"),
        (1501, ":var1", "str_master_weaver"),
      (else_try),
        (eq, "$enterprise_production", "itm_linen"),
        (1501, ":var1", "str_master_weaver"),
      (else_try),
        (eq, "$enterprise_production", "itm_leatherwork"),
        (1501, ":var1", "str_master_tanner"),
      (else_try),
        (eq, "$enterprise_production", "itm_velvet"),
        (1501, ":var1", "str_master_dyer"),
      (else_try),
        (eq, "$enterprise_production", "itm_wine"),
        (1501, ":var1", "str_master_vinter"),
      (try_end),
    ]],

  [plyr|anyone, "mayor_investment_confirm",
    [],
    "No -- that is not economical for me at the moment.",
    "mayor_investment_advice",
    []],

  [anyone, "mayor_investment_purchase",
    [],
    "Very good. Your enterprise should be up and running in about a week. When next you come, and thereafter, you should speak to your {s4} about its operations.",
    "mayor_pretalk",
    [
      (store_sub, ":var0", "$current_town", "p_town_1"),
      (store_add, ":var1", ":var0", "trp_town_1_master_craftsman"),
      (str_store_troop_name, s4, ":var1"),
    ]],

  [plyr|anyone, "mayor_talk",
    [],
    "I would like to exchange diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
      (party_get_slot, "$temp", "$g_encountered_party", 26),
    ]],

  [anyone, "mayor_exchange_diamonds_1",
    [
      (lt, "$temp", 0),
    ],
    "This town offers wide selection of extra services only for our friends.",
    "mayor_pretalk",
    [
      (assign, reg40, "$temp"),
      (display_message, "@current relations with town: {reg40}"),
    ]],

  [anyone, "mayor_exchange_diamonds_1",
    [
      (ge, "$temp", 0),
    ],
    "As you wish {reg63?sir:madam}. This town offers wide selection of extra services for our friends.",
    "mayor_exchange_diamonds_2",
    []],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [],
    "Buy Small Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_buy_diamonds", "itm_diamond_small", 10000),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (ge, "$temp", 10),
    ],
    "Buy Medium Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_buy_diamonds", "itm_diamond_medium", 50000),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (ge, "$temp", 15),
    ],
    "Buy Large Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_buy_diamonds", "itm_diamond_large", 100000),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (player_has_item, "itm_diamond_small"),
    ],
    "Sell Small Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_sell_diamonds", "itm_diamond_small", 9750, 0, 1),
      (troop_add_gold, "trp_player", reg0),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (ge, "$temp", 10),
      (player_has_item, "itm_diamond_medium"),
    ],
    "Sell Medium Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_sell_diamonds", "itm_diamond_medium", 48750, 10, 1),
      (troop_add_gold, "trp_player", reg0),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (ge, "$temp", 15),
      (player_has_item, "itm_diamond_large"),
    ],
    "Sell Large Pouch of Diamonds.",
    "mayor_exchange_diamonds_1",
    [
      (call_script, "script_cf_sell_diamonds", "itm_diamond_large", 97500, 15, 1),
      (troop_add_gold, "trp_player", reg0),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [
      (this_or_next|player_has_item, "itm_diamond_small"),
      (this_or_next|player_has_item, "itm_diamond_medium"),
      (player_has_item, "itm_diamond_large"),
    ],
    "Sell all Diamonds.",
    "mayor_pretalk",
    [
      (assign, ":var0", 0),
      (try_begin),
        (call_script, "script_cf_sell_diamonds", "itm_diamond_small", 9750, 0, 0),
        (val_add, ":var0", reg0),
      (try_end),
      (try_begin),
        (call_script, "script_cf_sell_diamonds", "itm_diamond_medium", 48750, 10, 0),
        (val_add, ":var0", reg0),
      (try_end),
      (try_begin),
        (call_script, "script_cf_sell_diamonds", "itm_diamond_large", 97500, 15, 0),
        (val_add, ":var0", reg0),
      (try_end),
      (troop_add_gold, "trp_player", ":var0"),
    ]],

  [plyr|anyone, "mayor_exchange_diamonds_2",
    [],
    "Leave.",
    "mayor_pretalk",
    []],

  [plyr|anyone, "mayor_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "mayor_info_begin",
    [
      (str_store_party_name, s9, "$current_town"),
    ],
    "I am the guildmaster of {s9}. You can say I work closely with the Castle Steward    as I am the leader of the good people and craftsmen of {s9}. I can help you find a job if you are looking for some honest work.",
    "mayor_info_talk",
    [
      (assign, "$mayor_info_lord_told", 0),
    ]],

  [plyr|anyone, "mayor_info_talk",
    [
      (eq, "$mayor_info_lord_told", 0),
    ],
    "Who rules this town?",
    "mayor_info_lord",
    []],

  [anyone, "mayor_info_lord",
    [
      (party_get_slot, ":var0", "$current_town", 7),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s10, "str_your_excellency"),
      (else_try),
        (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (str_store_troop_name, s10, ":var0"),
      (else_try),
        (faction_get_slot, ":var1", "$g_encountered_party_faction", 11),
        (str_store_troop_name, s10, ":var1"),
      (try_end),
    ],
    "Our town's lord and protector is {s10}. He owns the castle and sometimes resides there, and collects taxes from the town. However we regulate ourselves in most of the matters that concern ourselves. As the town's guildmaster I have the authority to decide those things.",
    "mayor_info_talk",
    [
      (assign, "$mayor_info_lord_told", 1),
    ]],

  [anyone, "mayor_info_lord",
    [
      (party_get_slot, ":var0", "$current_town", 7),
      (str_store_troop_name, s10, ":var0"),
      (eq, ":var0", "trp_player"),
    ],
    "Ahh... {reg63?M'Lord:M'Lady}? Unless something happened of which I am completely unaware, which I assure you is most certainly not the case,   you are the beloved and belelovent liege of this town. Your word is law and your arm protects us. ",
    "mayor_info_talk",
    [
      (assign, "$mayor_info_lord_told", 1),
    ]],

  [plyr|anyone, "mayor_info_talk",
    [],
    "That's all I need to know. Thanks.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_political_talk",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s10, ":var0"),
      (party_get_slot, ":var1", "$current_town", 7),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (str_store_string, s10, "str_your_excellency"),
      (else_try),
        (is_between, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (neq, ":var1", ":var0"),
        (str_store_troop_name, s11, ":var1"),
        (neq, ":var1", ":var0"),
        (str_store_string, s10, "str_s10_and_s11"),
      (try_end),
    ],
    "Politics? Good heavens, the guild has nothing to do with politics. We are loyal servants of {s10}. We merely govern our own affairs, and pass on the townspeople's concerns to our lords and masters, and maybe warn them from time to time against evil advice. Anyway, what did you wish to ask?",
    "mayor_political_questions",
    []],

  [anyone, "mayor_prepolitics",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_string, s9, "str_your_loyal_subjects"),
      (else_try),
        (str_store_troop_name, s10, ":var0"),
        (str_store_string, s9, "str_loyal_subjects_of_s10"),
      (try_end),
    ],
    "Did I mention that we here are all {s9}? Because I can't stress that enough... Anyway... Is there anything else?",
    "mayor_political_questions",
    []],

  [plyr|anyone, "mayor_political_questions",
    [],
    "What is the cause of all these wars in Pendor?",
    "mayor_war_description_1",
    []],

  [anyone, "mayor_war_description_1",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s10, ":var0"),
      (str_store_string, s22, "str_the"),
      (try_begin),
        (eq, "$g_encountered_party_faction", "fac_kingdom_5"),
        (str_store_string, s22, "str_we"),
      (try_end),
      (val_max, "$g_mayor_given_political_dialog", 1),
    ],
    "Well, to answer your question generally, each monarch claims to be the rightful heir to the old Pendorian emperors. Some of these claims are based on forgotten dynastic marriages and others are based on obscure promises, while {s22} invoke the empire's unwritten constitution. So in theory, any one realm has the right to declare war on any other realm at any time.",
    "mayor_war_description_2",
    []],

  [anyone, "mayor_war_description_2",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s10, ":var0"),
      (troop_get_type, reg4, ":var0"),
    ],
    "In practice, to make war is exhausting work. It is easy enough to lay waste to the enemy's farmland, but crops will grow back, and it is a far different matter to capture an enemy stronghold and to hold it. So the monarchs of Pendor will fight a little, sign a truce, fight a little more, and so on and so forth. Often, a monarch will go to war when another realm provokes them. At such times, some bad influences who look to enrich themselves with ransoms and pillage will clamor for retribution, and thus the damage caused by war to a monarch's treasury is less than the damage caused by doing nothing would be to his authority... I'm of course not talking about {s10}, as no one would ever question {reg4?her:his} authority",
    "mayor_war_description_3",
    []],

  [anyone, "mayor_war_description_3",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (troop_get_type, reg4, ":var0"),
    ],
    "I would stress again that we in the guild have nothing to do with politics. But if {s10} were to ask for my advice on these matters, as a loyal subject, I would tell {reg4?her:him} that while {reg4?her:his} claim to all of Pendor is truly just, even the most legitimate claim must be backed by armed men, and armed men want money, and money comes from trade, and war ruins trade, so sometimes the best way to push a claim is to not push it, if you know what I mean...",
    "mayor_war_description_4",
    []],

  [anyone, "mayor_war_description_4",
    [
      (str_store_party_name, s4, "$g_encountered_party"),
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (troop_get_type, reg4, ":var0"),
    ],
    "You may tell {s10} this if you see {reg4?her:him}. Don't mention my name specifically -- just say 'the people of {s4}' told you this. Our personal opinion, of course, as to what would be in {s10}'s best interests. None of us would ever dream of questioning a monarch's sovereign right to push {reg4?her:his} legitimate claims.",
    "mayor_prepolitics",
    []],

  [plyr|anyone, "mayor_political_questions",
    [
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s10, ":var0"),
      (ge, "$g_mayor_given_political_dialog", 1),
    ],
    "What is {s10}'s policy in regards to the other realms of Pendor?",
    "mayor_politics_assess",
    []],

  [anyone, "mayor_politics_assess",
    [],
    "Which realm did you have in mind?",
    "mayor_politics_assess_realm",
    []],

  [repeat_for_factions|plyr|anyone, "mayor_politics_assess_realm",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (neq, ":var0", "$g_encountered_party_faction"),
      (str_store_faction_name, s11, ":var0"),
    ],
    "{s11}",
    "mayor_politics_give_realm_assessment",
    [
      (store_repeat_object, "$faction_selected"),
    ]],

  [plyr|anyone, "mayor_politics_assess_realm",
    [],
    "That is all. Thank you.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_politics_give_realm_assessment",
    [],
    "{s14}",
    "mayor_prepolitics",
    [
      (call_script, "script_npc_decision_checklist_peace_or_war", "$g_encountered_party_faction", "$faction_selected", -1),
    ]],

  [plyr|anyone, "mayor_political_questions",
    [],
    "What can you say about the internal politics of the realms?",
    "mayor_internal_politics",
    []],

  [anyone, "mayor_internal_politics",
    [
      (str_store_faction_name, s4, "$g_encountered_party_faction"),
      (faction_get_slot, ":var0", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s5, ":var0"),
      (troop_get_type, reg4, ":var0"),
    ],
    "Well, here in the {s4} we are all united by our love for {s5} and support for {reg4?her:his} legitimate claim to the rulership of all Pendor. But I have heard some talk of internal bickering in other realms...",
    "mayor_internal_politics_2",
    []],

  [anyone, "mayor_internal_politics_2",
    [],
    "The lords of a realm often have very different ideas about honor, strategy, and the way a nobleman should behave. In addition, they compete with each other for the ruler's favor, and are constantly weighing up their position -- how they stand, how their friends and family stand, and how their enemies stand.",
    "mayor_internal_politics_3",
    []],

  [anyone, "mayor_internal_politics_3",
    [],
    "Underlying all the tensions is the possibility that a lord may abandon his liege, and pledge vassalhood to another. In theory, each lord has sworn an oath of vassalage, but in practice, a vassal can always find an excuse to absolve himself. The vassal may claim that the liege has failed to hold up his end of the bargain, to protect the vassal and treat him justly. Or, the vassal may claim that his liege is in fact a usurper, and another has a better claim to the kingship.",
    "mayor_internal_politics_4",
    []],

  [anyone, "mayor_internal_politics_4",
    [],
    "Lieges and vassals still watch each other carefully. If a king believes that his vassal is going to change sides or rebel, he may indict the vassal for treason and seize his properties. Likewise, if a vassal fears that he will be indicted, he may rebel. Usually, whoever makes the first move will be able to control the vassal's fortresses.",
    "mayor_internal_politics_5",
    []],

  [anyone, "mayor_internal_politics_5",
    [],
    "Now, men do not trust a vassal who turns coat easily, nor do they trust a king who lightly throws around charges of treason. Those two factors can keep a realm together. But if relations between a vassal and a liege deteriorate far enough, things can become very tense indeed... In other lands, of course. These things could never happen here in the {s4}.",
    "mayor_prepolitics",
    []],

  [plyr|anyone, "mayor_political_questions",
    [],
    "That is all. Thank you.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_about_job",
    [],
    "What about it?",
    "merchant_quest_about_job_2",
    []],

  [plyr|anyone, "merchant_quest_about_job_2",
    [],
    "What if I can't finish it?",
    "merchant_quest_what_if_fail",
    []],

  [plyr|anyone, "merchant_quest_about_job_2",
    [],
    "Well, I'm still working on it.",
    "merchant_quest_about_job_working",
    []],

  [anyone, "merchant_quest_about_job_working",
    [],
    "Good. I'm sure you will be able to handle it.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_last_offered_job",
    [
      (eq, "$random_merchant_quest_no", "qst_track_down_bandits"),
      (eq, "$qst_track_down_bandits_exists", 0),
    ],
    "There is talk that another party has defeated the bandits.",
    "close_window",
    [
      (quest_set_slot, "qst_track_down_bandits", 25, 1),
      (assign, "$merchant_quest_last_offerer", 0),
    ]],

  [anyone, "merchant_quest_last_offered_job",
    [
      (eq, "$random_merchant_quest_no", "qst_track_down_bandits"),
      (eq, "$qst_track_down_bandits_exists", 1),
    ],
    "Eh, you want to reconsider that. Good....",
    "merchant_quest_brief",
    [
      (assign, "$random_merchant_quest_no", "$merchant_offered_quest"),
    ]],

  [anyone, "merchant_quest_last_offered_job",
    [
      (neq, "$random_merchant_quest_no", "qst_track_down_bandits"),
    ],
    "Eh, you want to reconsider that. Good...",
    "merchant_quest_brief",
    [
      (assign, "$random_merchant_quest_no", "$merchant_offered_quest"),
    ]],

  [anyone, "merchant_quest_what_if_fail",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Do you like games of Chance? I will flip a coin. Heads I get your Qualis gem, tails you keep it. In return, either way you obtain some well armed warriors who would be willing to help you. Like all elite troops, they cost a bit for their upkeep, but are worth the gold. Are you game?^^^^(up to 20 warriors)",
    "mayor_troops",
    []],

  [anyone, "merchant_quest_what_if_fail",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deliver_wine"),
    ],
    "I hope you don't fail. In that case, I'll have to ask for the price of the cargo you were carrying.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_what_if_fail",
    [],
    "Well, just do your best to finish it.",
    "mayor_pretalk",
    []],

  [plyr|anyone, "mayor_troops",
    [
      (player_has_item, "itm_qualis"),
    ],
    "Yes... ",
    "mayor_pretalk",
    [
      (store_random_in_range, ":var0", 1, 12),
      (try_begin),
        (eq, ":var0", 1),
        (player_has_item, "itm_qualis"),
        (party_add_members, "p_main_party", "trp_heroine_adventurer", 1),
        (party_add_members, "p_main_party", "trp_maiden_cavalry", 8),
        (party_add_members, "p_main_party", "trp_maiden_adventurer", 4),
      (else_try),
        (eq, ":var0", 2),
        (party_add_members, "p_main_party", "trp_pendor_gray_archer", 10),
        (party_add_members, "p_main_party", "trp_pendor_cavalry", 6),
      (else_try),
        (eq, ":var0", 3),
        (party_add_members, "p_main_party", "trp_singalian_horseman", 12),
        (party_add_members, "p_main_party", "trp_singalian_temptress", 2),
      (else_try),
        (eq, ":var0", 4),
        (party_add_members, "p_main_party", "trp_young_northern", 12),
        (party_add_members, "p_main_party", "trp_rav_ranger", 8),
      (else_try),
        (eq, ":var0", 5),
        (party_add_members, "p_main_party", "trp_fierd_berserker", 12),
      (else_try),
        (eq, ":var0", 6),
        (party_add_members, "p_main_party", "trp_noldor_knight", 2),
        (party_add_members, "p_main_party", "trp_noldor_ranger", 6),
      (else_try),
        (eq, ":var0", 7),
        (party_add_members, "p_main_party", "trp_jatu_lancer", 16),
      (else_try),
        (eq, ":var0", 8),
        (party_add_members, "p_main_party", "trp_omen_seeker", 12),
      (else_try),
        (eq, ":var0", 8),
        (party_add_members, "p_main_party", "trp_empire_knight", 16),
      (else_try),
        (eq, ":var0", 9),
        (party_add_members, "p_main_party", "trp_knight_foreign", 16),
      (else_try),
        (eq, ":var0", 10),
        (party_add_members, "p_main_party", "trp_veccavi_horse", 6),
        (party_add_members, "p_main_party", "trp_veccavi_archer", 10),
      (else_try),
        (party_add_members, "p_main_party", "trp_jatu_merc", 20),
      (try_end),
      (val_add, "$g_player_egg", 1),
      (store_random_in_range, ":var1", 1, 100),
      (try_begin),
        (this_or_next|lt, ":var1", 50),
        (ge, "$g_player_egg", 3),
        (troop_remove_item, "trp_player", "itm_qualis"),
      (try_end),
    ]],

  [plyr|anyone, "mayor_troops",
    [
      (player_has_item, "itm_qualis"),
    ],
    "No, thank you.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_taken",
    [],
    "Excellent. I am counting on you then. Good luck.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_stall",
    [],
    "Well, the job will be available for a few more days, I guess. Tell me if you decide to take it.",
    "mayor_pretalk",
    []],

  [anyone, "mayor_economy_report_1",
    [],
    "{s32}",
    "mayor_economy_report_2",
    []],

  [anyone, "mayor_economy_report_2",
    [],
    "{s42}",
    "mayor_economy_report_3",
    []],

  [anyone, "mayor_economy_report_3",
    [],
    "{s47}",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_deal_with_looters"),
    ],
    "Well, you look able enough. I think I might have something you could do.",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_deal_with_looters"),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (str_store_string, s5, "@town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (str_store_string, s5, "@village"),
      (try_end),
    ],
    "We've had some fighting near the {s5} lately, with all the chaos that comes with it, and that's led some of our less upstanding locals to try and make their fortune out of looting the shops and farms during the confusion. A lot of valuable goods were taken. I need somebody to teach those bastards a lesson. Sound like your kind of work?",
    "merchant_quest_looters_choice",
    []],

  [plyr|anyone, "merchant_quest_looters_choice",
    [],
    "Aye, I'll do it.",
    "merchant_quest_looters_brief",
    []],

  [plyr|anyone, "merchant_quest_looters_choice",
    [],
    "I'm afraid I can't take the job at the moment.",
    "merchant_quest_stall",
    []],

  [anyone, "merchant_quest_looters_brief",
    [
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (str_store_string, s5, "@town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (str_store_string, s5, "@village"),
      (try_end),
      (store_random_in_range, ":var0", 3, 7),
      (quest_set_slot, "qst_deal_with_looters", 10, ":var0"),
      (try_for_range, ":var1", 0, ":var0"),
        (store_random_in_range, ":var2", 5, 14),
        (set_spawn_radius, ":var2"),
        (spawn_around_party, "$g_encountered_party", "pt_looters_quest"),
        (party_set_ai_behavior, reg0, ai_bhvr_patrol_location),
        (party_set_ai_patrol_radius, reg0, 2),
        (party_get_position, pos0, reg0),
        (party_set_ai_target_position, reg0, pos0),
      (try_end),
      (str_store_troop_name_link, s9, "$g_talk_troop"),
      (str_store_party_name_link, s13, "$g_encountered_party"),
      (str_store_party_name, s4, "$g_encountered_party"),
      (setup_quest_text, "qst_deal_with_looters"),
      (str_store_string, s2, "@The Guildmaster of {s13} has asked you to deal with looters in the surrounding countryside."),
      (call_script, "script_start_quest", "qst_deal_with_looters", "$g_talk_troop"),
      (assign, "$g_leave_encounter", 1),
    ],
    "Excellent! You'll find the looters roaming around the countryside, probably trying to rob more good people. Kill or capture the bastards, I don't care what you do with them. I'll pay you a bounty of 200 denars on every band of looters you destroy, until all the looters are dealt with.",
    "close_window",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_retaliate_for_border_incident"),
      (quest_get_slot, ":var0", "qst_retaliate_for_border_incident", 3),
      (call_script, "script_faction_get_adjective_to_s10", ":var0"),
      (faction_get_slot, ":var1", "$g_encountered_party_faction", 11),
      (str_store_troop_name, s5, ":var1"),
    ],
    "Well, there is a very great favor which you could do us ... As you may have heard, some {s10}s have come across the border to attack our people. {s5} is under great pressure from some of the more bellicose of his vassals to respond with a declaration of war. Unfortunately, while the great lords of this land grow rich from bloodshed, we of the commons will be caught in the middle, and will suffer.",
    "merchant_quest_explain_2",
    []],

  [anyone, "merchant_quest_explain_2",
    [
      (eq, "$random_merchant_quest_no", "qst_retaliate_for_border_incident"),
      (quest_get_slot, ":var0", "qst_retaliate_for_border_incident", 2),
      (str_store_troop_name, s7, ":var0"),
    ],
    "We are not saying that {s5} should overlook this aggression - far from it! But if he charges one of his own lords to respond, then the cycle of provocation will necessarily lead to a full-fledged confrontation. Now, if an outsider were to step in and defeat a {s10} lord in battle, then honor would be done, and it would defuse the clamor for war. If the defeated lord were a known troublemaker - {s7} - then the {s10}s might be able to overlook it.",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_retaliate_for_border_incident"),
      (quest_get_slot, ":var0", "qst_retaliate_for_border_incident", 2),
      (str_store_troop_name, s7, ":var0"),
    ],
    "We need such an outsider to attack and defeat {s7}. This will not be an easy task, and that outsider would damage {reg63?his:her} relationship with the {s10}s, but we would be very grateful. We could not acknowledge a connection with that outsider, but we could be sure that {reg63?he:she} would be handsomely rewarded ... Could you think of someone that would do this?",
    "merchant_quest_retaliate_confirm",
    []],

  [plyr|anyone, "merchant_quest_retaliate_confirm",
    [],
    "Aye, I am sure I can think of someone.",
    "merchant_quest_track_bandits_brief",
    [
      (str_store_faction_name, s11, "$g_encountered_party_faction"),
      (setup_quest_text, "qst_retaliate_for_border_incident"),
      (str_store_string, s2, "str_track_down_s7_and_defeat_him_defusing_calls_for_war_within_the_s11"),
      (call_script, "script_start_quest", "qst_retaliate_for_border_incident", "$g_talk_troop"),
    ]],

  [plyr|anyone, "merchant_quest_retaliate_confirm",
    [],
    "I would prefer not to get mixed up in such things",
    "merchant_pretalk",
    []],

  [anyone, "destroy_lair_quest_brief",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_get_template_id, ":var1", ":var0"),
      (eq, ":var1", "pt_sea_raider_lair"),
    ],
    "The raiders are likely to have laid up their ships in a well-concealed cove, somewhere along the coastline, preferably next to a small stream where they have some water. The best way to discover its location would be to find a group of Vanskerries who appear to be heading back to their base to resupply, and follow them.",
    "merchant_quest_track_bandit_lair_choice",
    []],

  [anyone, "destroy_lair_quest_brief",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_get_template_id, ":var1", ":var0"),
      (eq, ":var1", "pt_mountain_bandit_lair"),
    ],
    "Bandits such as these will usually establish a base in the highlands, often on an steep ledge where they have a view of the surrounding countryside. This makes them difficult to surprise. The best way to discover its location would be to find a group of Mystmountain bandits who appear to be heading back to their base to resupply, and follow them.",
    "merchant_quest_track_bandit_lair_choice",
    []],

  [anyone, "destroy_lair_quest_brief",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_get_template_id, ":var1", ":var0"),
      (eq, ":var1", "pt_forest_bandit_lair"),
    ],
    "Bandits such as these will usually set up their encampments deep in the woods, sometimes in the middle of a swamp. The best way to discover its location would be to find a group of forest bandits who appear to be heading back to their base to resupply, and follow them.",
    "merchant_quest_track_bandit_lair_choice",
    []],

  [anyone, "destroy_lair_quest_brief",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_get_template_id, ":var1", ":var0"),
      (eq, ":var1", "pt_steppe_bandit_lair"),
    ],
    "Bandits such as these will usually set up their encampments in the woodland on the steppe, where they have some concealment. The best way to discover its location would be to find a group of D'Shar raiders who appear to be heading back to their base to resupply, and follow them.",
    "merchant_quest_track_bandit_lair_choice",
    []],

  [anyone, "destroy_lair_quest_brief",
    [
      (eq, "$random_quest_no", "qst_destroy_bandit_lair"),
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_get_template_id, ":var1", ":var0"),
      (eq, ":var1", "pt_snake_bandit_lair"),
    ],
    "Snake cultists such as these will usually set up their encampments deep in the woods. The best way to discover its location would be to find a group of Snake cultists who appear to be heading back to their base to resupply, and follow them.",
    "merchant_quest_track_bandit_lair_choice",
    []],

  [plyr|anyone, "merchant_quest_track_bandit_lair_choice",
    [],
    "Aye, I'll do it.",
    "merchant_quest_destroy_lair_brief",
    [
      (quest_get_slot, ":var0", "qst_destroy_bandit_lair", 8),
      (party_set_flags, ":var0", 262144, 1),
      (quest_set_slot, "qst_destroy_bandit_lair", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_destroy_bandit_lair", 12, "$g_encountered_party"),
      (str_store_troop_name_link, s11, "$g_talk_troop"),
      (str_store_party_name, s9, ":var0"),
      (setup_quest_text, "qst_destroy_bandit_lair"),
      (str_store_string, s2, "str_bandit_lair_quest_description"),
      (call_script, "script_start_quest", "qst_destroy_bandit_lair", "$g_talk_troop"),
    ]],

  [plyr|anyone, "merchant_quest_track_bandit_lair_choice",
    [],
    "I'm afraid I can't take the job at the moment.",
    "lord_pretalk",
    [
      (quest_set_slot, "qst_destroy_bandit_lair", 25, 1),
    ]],

  [anyone, "merchant_quest_destroy_lair_brief",
    [],
    "Very good. We will await word of your success.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_track_down_bandits"),
    ],
    "We have heard that {s4}, some travelers on the road {reg4?to:from} {s5} were attacked by {s7}.",
    "merchant_quest_brief",
    [
      (call_script, "script_merchant_road_info_to_s42", "$g_encountered_party"),
      (assign, "$g_bandit_party_for_bounty", reg0),
      (assign, ":var0", reg1),
      (assign, ":var1", reg2),
      (assign, ":var2", reg3),
      (try_begin),
        (lt, ":var2", 24),
        (str_store_string, s4, "str_a_short_while_ago"),
      (else_try),
        (lt, ":var2", 48),
        (str_store_string, s4, "str_one_day_ago"),
      (else_try),
        (lt, ":var2", 72),
        (str_store_string, s4, "str_two_days_day_ago"),
      (else_try),
        (lt, ":var2", 144),
        (str_store_string, s4, "str_earlier_this_week"),
      (else_try),
        (str_store_string, s4, "str_about_a_week_ago"),
      (try_end),
      (try_begin),
        (eq, ":var0", "$g_encountered_party"),
        (str_store_party_name, s5, ":var1"),
        (assign, reg4, 0),
      (else_try),
        (eq, ":var1", "$g_encountered_party"),
        (str_store_party_name, s5, ":var0"),
        (assign, reg4, 1),
      (try_end),
      (str_store_party_name, s7, "$g_bandit_party_for_bounty"),
      (quest_set_slot, "qst_track_down_bandits", 8, "$g_bandit_party_for_bounty"),
    ]],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_track_down_bandits"),
      (quest_get_slot, ":var0", "qst_track_down_bandits", 8),
      (str_store_party_name, s4, ":var0"),
    ],
    "We would like you to track these {s4} down. The merchants of the town were able to get a description of their leader, and have put together a bounty. If you can hunt them down and destroy them, we'll make it worth your while...",
    "merchant_quest_track_bandits_choice",
    []],

  [plyr|anyone, "merchant_quest_track_bandits_choice",
    [],
    "Aye, I'll do it.",
    "merchant_quest_track_bandits_brief",
    [
      (assign, "$merchant_offered_quest", 0),
      (assign, "$merchant_quest_last_offerer", "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_track_down_bandits", 8),
      (party_set_flags, ":var0", 262144, 1),
      (quest_set_slot, "qst_track_down_bandits", 8, "$g_bandit_party_for_bounty"),
      (quest_set_slot, "qst_track_down_bandits", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_track_down_bandits", 12, "$g_encountered_party"),
      (str_store_party_name_link, s8, "$g_encountered_party"),
      (str_store_party_name, s9, ":var0"),
      (setup_quest_text, "qst_track_down_bandits"),
      (str_store_string, s2, "str_track_down_the_s9_who_attacked_travellers_near_s8_then_report_back_to_the_town"),
      (call_script, "script_start_quest", "qst_track_down_bandits", "$g_talk_troop"),
    ]],

  [anyone, "merchant_quest_track_bandits_brief",
    [],
    "Very good. The band may not have lingered long in the area, but chances are that they will be spotted by other travellers on the road.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "merchant_quest_track_bandits_choice",
    [],
    "I'm afraid I can't take the job at the moment.",
    "merchant_quest_stall",
    [
      (quest_set_slot, "qst_track_down_bandits", 25, 1),
    ]],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_deliver_wine"),
    ],
    "You're looking for a job? Actually I was looking for someone to deliver some {s4}. Perhaps you can do that...",
    "merchant_quest_brief",
    [
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (str_store_item_name, s4, ":var0"),
    ]],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_deliver_wine"),
    ],
    "I have a cargo of {s6} that needs to be delivered to the tavern in {s4}. If you can take {reg5} units of {s6} to {s4} in 7 days, you may earn {reg8} denars. What do you say?",
    "merchant_quest_brief_deliver_wine",
    [
      (quest_get_slot, reg5, "qst_deliver_wine", 10),
      (quest_get_slot, reg8, "qst_deliver_wine", 22),
      (quest_get_slot, ":var0", "qst_deliver_wine", 14),
      (quest_get_slot, ":var1", "qst_deliver_wine", 1),
      (str_store_troop_name, s9, "$g_talk_troop"),
      (str_store_party_name_link, s3, "$g_encountered_party"),
      (str_store_party_name_link, s4, ":var1"),
      (str_store_item_name, s6, ":var0"),
      (setup_quest_text, "qst_deliver_wine"),
      (str_store_string, s2, "@{s9} of {s3} asked you to deliver {reg5} units of {s6} to the tavern in {s4} in 7 days."),
    ]],

  [plyr|anyone, "merchant_quest_brief_deliver_wine",
    [
      (store_free_inventory_capacity, ":var0"),
      (quest_get_slot, ":var1", "qst_deliver_wine", 10),
      (ge, ":var0", ":var1"),
    ],
    "Alright. I will make the delivery.",
    "merchant_quest_taken",
    [
      (quest_get_slot, ":var0", "qst_deliver_wine", 10),
      (quest_get_slot, ":var1", "qst_deliver_wine", 14),
      (troop_add_items, "trp_player", ":var1", ":var0"),
      (call_script, "script_start_quest", "qst_deliver_wine", "$g_talk_troop"),
    ]],

  [plyr|anyone, "merchant_quest_brief_deliver_wine",
    [],
    "I am afraid I can't carry all that cargo now.",
    "merchant_quest_stall",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_escort_merchant_caravan"),
    ],
    "You're looking for a job? Actually I was looking for someone to escort a caravan. Perhaps you can do that...",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_escort_merchant_caravan"),
    ],
    "I am going to send a caravan of goods to {s8}. However with all those bandits and deserters on the roads, I don't want to send them out without an escort. If you can lead that caravan to {s8} in 15 days, you will earn {reg8} denars. Of course your party needs to be at least {reg4} strong to offer them any protection.",
    "escort_merchant_caravan_quest_brief",
    [
      (quest_get_slot, reg8, "qst_escort_merchant_caravan", 22),
      (quest_get_slot, reg4, "qst_escort_merchant_caravan", 10),
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 1),
      (str_store_party_name, s8, ":var0"),
    ]],

  [plyr|anyone, "escort_merchant_caravan_quest_brief",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (quest_get_slot, ":var1", "qst_escort_merchant_caravan", 10),
      (ge, ":var0", ":var1"),
    ],
    "Alright. I will escort the caravan.",
    "merchant_quest_taken",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 1),
      (set_spawn_radius, 1),
      (spawn_around_party, "$g_encountered_party", "pt_merchant_caravan"),
      (assign, ":var1", reg0),
      (party_set_ai_behavior, ":var1", ai_bhvr_attack_party),
      (party_set_ai_object, ":var1", "p_main_party"),
      (party_set_flags, ":var1", 65536, 0),
      (quest_set_slot, "qst_escort_merchant_caravan", 8, ":var1"),
      (quest_set_slot, "qst_escort_merchant_caravan", 11, 0),
      (str_store_party_name_link, s8, ":var0"),
      (setup_quest_text, "qst_escort_merchant_caravan"),
      (str_store_string, s2, "@Escort the merchant caravan to the town of {s8}."),
      (call_script, "script_start_quest", "qst_escort_merchant_caravan", "$g_talk_troop"),
    ]],

  [plyr|anyone, "escort_merchant_caravan_quest_brief",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (quest_get_slot, ":var1", "qst_escort_merchant_caravan", 10),
      (lt, ":var0", ":var1"),
    ],
    "I am afraid I don't have that many soldiers with me.",
    "merchant_quest_stall",
    []],

  [plyr|anyone, "escort_merchant_caravan_quest_brief",
    [
      (store_party_size_wo_prisoners, ":var0", "p_main_party"),
      (quest_get_slot, ":var1", "qst_escort_merchant_caravan", 10),
      (ge, ":var0", ":var1"),
    ],
    "Sorry. I can't do that right now",
    "merchant_quest_stall",
    []],

  [party_tpl|pt_merchant_caravan, "start",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 8),
      (eq, "$g_encountered_party", ":var0"),
      (quest_slot_eq, "qst_escort_merchant_caravan", 11, 2),
    ],
    "We can cover the rest of the way ourselves. Thanks.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_merchant_caravan, "start",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 8),
      (eq, "$g_encountered_party", ":var0"),
      (quest_get_slot, ":var1", "qst_escort_merchant_caravan", 1),
      (store_distance_to_party_from_party, ":var2", ":var1", ":var0"),
      (lt, ":var2", 4),
      (quest_slot_eq, "qst_escort_merchant_caravan", 11, 1),
    ],
    "Well, we have almost reached {s21}. We can cover the rest of the way ourselves. Here's your pay... {reg14} denars. Thanks for escorting us. Good luck.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 8),
      (quest_get_slot, ":var1", "qst_escort_merchant_caravan", 1),
      (quest_get_slot, ":var2", "qst_escort_merchant_caravan", 12),
      (quest_get_slot, ":var3", "qst_escort_merchant_caravan", 22),
      (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
      (party_set_ai_object, ":var0", ":var1"),
      (party_set_flags, ":var0", 65536, 0),
      (str_store_party_name, s21, ":var1"),
      (call_script, "script_change_player_relation_with_center", ":var2", 1),
      (call_script, "script_finish_quest_simple", "qst_escort_merchant_caravan", 100),
      (quest_set_slot, "qst_escort_merchant_caravan", 11, 2),
      (assign, reg14, ":var3"),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_merchant_caravan, "start",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 8),
      (eq, "$g_encountered_party", ":var0"),
      (quest_slot_eq, "qst_escort_merchant_caravan", 11, 0),
    ],
    "Greetings. You must be our escort, right?",
    "merchant_caravan_intro_1",
    [
      (quest_set_slot, "qst_escort_merchant_caravan", 11, 1),
    ]],

  [plyr|anyone, "merchant_caravan_intro_1",
    [],
    "Yes. My name is {playername}. I will lead you to {s1}.",
    "merchant_caravan_intro_2",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 1),
      (str_store_party_name, s1, ":var0"),
    ]],

  [anyone, "merchant_caravan_intro_2",
    [],
    "Well, It is good to know we won't travel alone. What do you want us to do now?",
    "escort_merchant_caravan_talk",
    []],

  [party_tpl|pt_merchant_caravan, "start",
    [
      (quest_get_slot, ":var0", "qst_escort_merchant_caravan", 8),
      (eq, "$g_encountered_party", ":var0"),
    ],
    "Eh. We've made it this far... What do you want us to do?",
    "escort_merchant_caravan_talk",
    []],

  [plyr|anyone, "escort_merchant_caravan_talk",
    [],
    "You follow my lead. I'll take you through a safe route.",
    "merchant_caravan_follow_lead",
    []],

  [anyone, "merchant_caravan_follow_lead",
    [],
    "Alright. We'll be right behind you.",
    "close_window",
    [
      (assign, "$escort_merchant_caravan_mode", 0),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "escort_merchant_caravan_talk",
    [],
    "You stay here for a while. I'll go ahead and check the road.",
    "merchant_caravan_stay_here",
    []],

  [anyone, "merchant_caravan_stay_here",
    [],
    "Alright. We'll be waiting here for you.",
    "close_window",
    [
      (assign, "$escort_merchant_caravan_mode", 1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_troublesome_bandits"),
    ],
    "Actually, I was looking for an able adventurer like you. There's this group of particularly troublesome bandits. They have infested the vicinity of our town and are preying on my caravans. They have avoided all the soldiers and the militias up to now. If someone doesn't stop them soon, I am going to be ruined...",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_troublesome_bandits"),
    ],
    "I will pay you {reg8} denars if you hunt down those troublesome bandits. It's dangerous work. But I believe that you are the {reg63?man:one} for it. What do you say?",
    "troublesome_bandits_quest_brief",
    [
      (quest_get_slot, reg8, "qst_troublesome_bandits", 22),
    ]],

  [plyr|anyone, "troublesome_bandits_quest_brief",
    [],
    "Very well. I will hunt down those bandits.",
    "merchant_quest_taken_bandits",
    [
      (set_spawn_radius, 7),
      (quest_get_slot, ":var0", "qst_troublesome_bandits", 12),
      (spawn_around_party, ":var0", "pt_troublesome_bandits"),
      (quest_set_slot, "qst_troublesome_bandits", 8, reg0),
      (store_num_parties_destroyed, "$qst_troublesome_bandits_eliminated", "pt_troublesome_bandits"),
      (store_num_parties_destroyed_by_player, "$qst_troublesome_bandits_eliminated_by_player", "pt_troublesome_bandits"),
      (str_store_troop_name, s9, "$g_talk_troop"),
      (str_store_party_name_link, s4, "$g_encountered_party"),
      (setup_quest_text, "qst_troublesome_bandits"),
      (str_store_string, s2, "@Merchant {s9} of {s4} asked you to hunt down the troublesome bandits in the vicinity of the town."),
      (call_script, "script_start_quest", "qst_troublesome_bandits", "$g_talk_troop"),
    ]],

  [anyone, "merchant_quest_taken_bandits",
    [],
    "You will? I am so happy to hear that. Good luck to you.",
    "close_window",
    []],

  [plyr|anyone, "troublesome_bandits_quest_brief",
    [],
    "Sorry. I don't have time for this right now.",
    "merchant_quest_stall",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_kidnapped_girl"),
    ],
    "Actually, I was looking for a reliable {reg63?man:helper} that can undertake an important mission. A group of bandits have kidnapped the daughter of a friend of mine, and are holding her for ransom. My friend is ready to pay them, but we still need someone to take the money to those rascals and bring the girl back to safety.",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_kidnapped_girl"),
    ],
    "The amount the bandits ask as ransom is {reg12} denars. I will give you that money once you accept the quest. You have 15 days to take the money to the bandits who will be waiting near the village of {s4}. Those bastards said that they are going to kill the poor girl if they don't get the money by that time. You will get your pay of {reg8} denars when you bring the girl safely back here.",
    "kidnapped_girl_quest_brief",
    [
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 1),
      (str_store_party_name, s4, ":var0"),
      (quest_get_slot, reg8, "qst_kidnapped_girl", 22),
      (quest_get_slot, reg12, "qst_kidnapped_girl", 10),
    ]],

  [plyr|anyone, "kidnapped_girl_quest_brief",
    [],
    "All right. I will take the ransom money to the bandits and bring back the girl.",
    "kidnapped_girl_quest_taken",
    [
      (set_spawn_radius, 4),
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 1),
      (quest_get_slot, ":var1", "qst_kidnapped_girl", 10),
      (spawn_around_party, ":var0", "pt_bandits_awaiting_ransom"),
      (assign, ":var2", reg0),
      (quest_set_slot, "qst_kidnapped_girl", 8, ":var2"),
      (party_set_ai_behavior, ":var2", ai_bhvr_hold),
      (party_set_ai_object, ":var2", "p_main_party"),
      (party_set_flags, ":var2", 65536, 0),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
      (assign, reg12, ":var1"),
      (str_store_troop_name, s1, "$g_talk_troop"),
      (str_store_party_name_link, s4, "$g_encountered_party"),
      (str_store_party_name_link, s3, ":var0"),
      (setup_quest_text, "qst_kidnapped_girl"),
      (str_store_string, s2, "@Guildmaster of {s4} gave you {reg12} denars to pay the ransom of a girl kidnapped by bandits. You are to meet the bandits near {s3} and pay them the ransom fee. After that you are to bring the girl back to {s4}."),
      (call_script, "script_start_quest", "qst_kidnapped_girl", "$g_talk_troop"),
    ]],

  [anyone, "kidnapped_girl_quest_taken",
    [],
    "Good. I knew we could trust you at this. Here is the ransom money, {reg12} denars. Count it before taking it. And please, don't attempt to do anything rash. Keep in mind that the girl's well being is more important than anything else...",
    "close_window",
    []],

  [plyr|anyone, "kidnapped_girl_quest_brief",
    [],
    "Sorry. I don't have time for this right now.",
    "merchant_quest_stall",
    []],

  [trp_kidnapped_girl, "start",
    [
      (eq, "$talk_context", 10),
    ],
    "Thank you so much for bringing me back!  I can't wait to see my family. Good-bye.",
    "close_window",
    [
      (remove_member_from_party, "trp_kidnapped_girl"),
      (quest_set_slot, "qst_kidnapped_girl", 11, 4),
    ]],

  [plyr|trp_kidnapped_girl, "kidnapped_girl_liberated_map",
    [],
    "Yes. Come with me. We are going home.",
    "kidnapped_girl_liberated_map_2a",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_map_2a",
    [
      (neg|party_can_join),
    ],
    "Unfortunately, you do not have room in your party for me.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_map_2a",
    [],
    "Oh really? Thank you so much!",
    "close_window",
    [
      (party_join),
      (quest_set_slot, "qst_kidnapped_girl", 11, 3),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|trp_kidnapped_girl, "kidnapped_girl_liberated_map",
    [],
    "Wait here a while longer. I'll come back for you.",
    "kidnapped_girl_liberated_map_2b",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_map_2b",
    [],
    "Oh, please {reg63?sir:madam}, do not leave me here all alone!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [trp_kidnapped_girl, "start",
    [],
    "Oh {reg63?sir:madam}. Thank you so much for rescuing me. Will you take me to my family now?",
    "kidnapped_girl_liberated_map",
    []],

  [plyr|trp_kidnapped_girl, "kidnapped_girl_liberated_battle",
    [],
    "Yes. Come with me. We are going home.",
    "kidnapped_girl_liberated_battle_2a",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_battle_2a",
    [
      (neg|hero_can_join, "p_main_party"),
    ],
    "Unfortunately, you do not have room in your party for me.",
    "kidnapped_girl_liberated_battle_2b",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_battle_2a",
    [],
    "Oh really? Thank you so much!",
    "close_window",
    [
      (party_add_members, "p_main_party", "trp_kidnapped_girl", 1),
      (quest_set_slot, "qst_kidnapped_girl", 11, 3),
    ]],

  [plyr|trp_kidnapped_girl, "kidnapped_girl_liberated_battle",
    [],
    "Wait here a while longer. I'll come back for you.",
    "kidnapped_girl_liberated_battle_2b",
    []],

  [trp_kidnapped_girl, "kidnapped_girl_liberated_battle_2b",
    [],
    "Oh, please {reg63?sir:madam}, do not leave me here all alone!",
    "close_window",
    [
      (add_companion_party, "trp_kidnapped_girl"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [trp_kidnapped_girl, "start",
    [],
    "Can I come with you now?",
    "kidnapped_girl_liberated_map",
    []],

  [party_tpl|pt_bandits_awaiting_ransom, "start",
    [
      (quest_slot_eq, "qst_kidnapped_girl", 11, 0),
    ],
    "Are you the one that brought the ransom? Quick, give us the money now.",
    "bandits_awaiting_ransom_intro_1",
    [
      (quest_set_slot, "qst_kidnapped_girl", 11, 1),
    ]],

  [party_tpl|pt_bandits_awaiting_ransom, "start",
    [
      (quest_slot_eq, "qst_kidnapped_girl", 11, 1),
    ],
    "You came back? Quick, give us the money now.",
    "bandits_awaiting_ransom_intro_1",
    []],

  [plyr|party_tpl|pt_bandits_awaiting_ransom, "bandits_awaiting_ransom_intro_1",
    [
      (store_troop_gold, ":var0"),
      (quest_get_slot, ":var1", "qst_kidnapped_girl", 10),
      (ge, ":var0", ":var1"),
    ],
    "Here, take the money. Just set the girl free.",
    "bandits_awaiting_ransom_pay",
    []],

  [party_tpl|pt_bandits_awaiting_ransom, "bandits_awaiting_ransom_pay",
    [],
    "Heh. You've brought the money, all right. You can take the girl now. It was a pleasure doing business with you...",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 10),
      (quest_get_slot, ":var1", "qst_kidnapped_girl", 8),
      (quest_get_slot, ":var2", "qst_kidnapped_girl", 1),
      (troop_remove_gold, "trp_player", ":var0"),
      (remove_member_from_party, "trp_kidnapped_girl", ":var1"),
      (set_spawn_radius, 1),
      (spawn_around_party, ":var1", "pt_kidnapped_girl"),
      (assign, ":var3", reg0),
      (party_set_ai_behavior, ":var3", ai_bhvr_hold),
      (party_set_flags, ":var3", 65536, 0),
      (quest_set_slot, "qst_kidnapped_girl", 11, 2),
      (party_set_ai_behavior, ":var1", ai_bhvr_travel_to_party),
      (party_set_ai_object, ":var1", ":var2"),
      (party_set_flags, ":var1", 65536, 0),
      (add_gold_to_party, ":var0", ":var1"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "bandits_awaiting_ransom_intro_1",
    [],
    "No way! You release the girl first.",
    "bandits_awaiting_ransom_b",
    []],

  [anyone, "bandits_awaiting_ransom_b",
    [],
    "You fool! Stop playing games and give us the money! ",
    "bandits_awaiting_ransom_b2",
    []],

  [plyr|anyone, "bandits_awaiting_ransom_b2",
    [
      (store_troop_gold, ":var0"),
      (quest_get_slot, ":var1", "qst_kidnapped_girl", 10),
      (ge, ":var0", ":var1"),
    ],
    "All right. Here's your money. Let the girl go now.",
    "bandits_awaiting_ransom_pay",
    []],

  [plyr|anyone, "bandits_awaiting_ransom_b2",
    [],
    "I had left the money in a safe place. Let me go fetch it.",
    "bandits_awaiting_ransom_no_money",
    []],

  [anyone, "bandits_awaiting_ransom_no_money",
    [],
    "Are you testing our patience or something? Go and bring that money here quickly.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "bandits_awaiting_ransom_b2",
    [],
    "I have no intention to pay you anything. I demand that you release the girl now!",
    "bandits_awaiting_ransom_fight",
    []],

  [anyone, "bandits_awaiting_ransom_fight",
    [],
    "You won't be demanding anything when you're dead.",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_bandits_awaiting_ransom, "start",
    [
      (quest_slot_ge, "qst_kidnapped_girl", 11, 2),
    ],
    "What's it? You have given us the money. We have no more business.",
    "bandits_awaiting_remeet",
    []],

  [plyr|anyone, "bandits_awaiting_remeet",
    [],
    "Sorry to bother you. I'll be on my way now.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "bandits_awaiting_remeet",
    [],
    "We have one more business. You'll give the money back to me.",
    "bandits_awaiting_remeet_2",
    []],

  [anyone, "bandits_awaiting_remeet_2",
    [],
    "Oh, that business! Of course. Let us get down to it.",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_kidnapped_girl, "start",
    [],
    "Oh {reg63?sir:madam}. Thank you so much for rescuing me. Will you take me to my family now?",
    "kidnapped_girl_encounter_1",
    []],

  [plyr|anyone, "kidnapped_girl_encounter_1",
    [],
    "Yes. Come with me. I'll take you home.",
    "kidnapped_girl_join",
    []],

  [anyone, "kidnapped_girl_join",
    [
      (neg|party_can_join),
    ],
    "Unfortunately, you do not have room in your party for me.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "kidnapped_girl_join",
    [],
    "Oh, thank you so much!",
    "close_window",
    [
      (party_join),
      (quest_set_slot, "qst_kidnapped_girl", 11, 3),
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "kidnapped_girl_encounter_1",
    [],
    "Wait here a while longer. I'll come back for you.",
    "kidnapped_girl_wait",
    []],

  [anyone, "kidnapped_girl_wait",
    [],
    "Oh, please {reg63?sir:madam}, do not leave me here all alone!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "merchant_quest_about_job_2",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_kidnapped_girl"),
      (quest_slot_eq, "qst_kidnapped_girl", 11, 3),
      (neg|main_party_has_troop, "trp_kidnapped_girl"),
    ],
    "Unfortunately I lost the girl on the way here...",
    "lost_kidnapped_girl",
    []],

  [anyone, "lost_kidnapped_girl",
    [],
    "Oh no! How am I going to tell this to my friend?",
    "lost_kidnapped_girl_2",
    []],

  [plyr|anyone, "lost_kidnapped_girl_2",
    [],
    "I'm sorry. I could do nothing about it.",
    "lost_kidnapped_girl_3",
    []],

  [anyone, "lost_kidnapped_girl_3",
    [],
    "You let me down {playername}. I had trusted you. I will let people know of your incompetence at this task. Also, I want back that {reg8} denars I gave you as the ransom fee.",
    "lost_kidnapped_girl_4",
    [
      (quest_get_slot, reg8, "qst_kidnapped_girl", 10),
      (try_for_parties, ":var0"),
        (party_count_members_of_type, ":var1", ":var0", "trp_kidnapped_girl"),
        (gt, ":var1", 0),
        (party_remove_members, ":var0", "trp_kidnapped_girl", 1),
        (party_remove_prisoners, ":var0", "trp_kidnapped_girl", 1),
      (try_end),
      (call_script, "script_end_quest", "qst_kidnapped_girl"),
      (call_script, "script_change_troop_renown", "trp_player", -5),
    ]],

  [plyr|anyone, "lost_kidnapped_girl_4",
    [
      (store_troop_gold, ":var0"),
      (quest_get_slot, ":var1", "qst_kidnapped_girl", 10),
      (ge, ":var0", ":var1"),
    ],
    "Of course. Here you are...",
    "merchant_quest_about_job_5a",
    [
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 10),
      (troop_remove_gold, "trp_player", ":var0"),
    ]],

  [anyone, "merchant_quest_about_job_5a",
    [],
    "At least you have the decency to return the money.",
    "close_window",
    []],

  [plyr|anyone, "lost_kidnapped_girl_4",
    [],
    "Sorry. I don't have that amount with me.",
    "merchant_quest_about_job_5b",
    []],

  [anyone, "merchant_quest_about_job_5b",
    [],
    "Do you expect me to believe that? You are going to pay that ransom fee back! Go and bring the money now!",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_kidnapped_girl", 10),
      (val_add, "$debt_to_merchants_guild", ":var0"),
    ]],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_persuade_lords_to_make_peace"),
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 2),
      (str_store_troop_name_link, s12, ":var1"),
      (str_store_troop_name_link, s13, ":var2"),
      (str_store_faction_name_link, s14, ":var0"),
      (str_store_faction_name_link, s15, "$g_encountered_party_faction"),
    ],
    "This war between {s15} and {s14} has brought our town to the verge of ruin. Our caravans get raided before they can reach their destination. Our merchants are afraid to leave the safety of the town walls. And as if those aren't enough, the taxes to maintain the war take away the last bits of our savings. If peace does not come soon, we can not hold on for much longer.",
    "merchant_quest_persuade_peace_1",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_1",
    [],
    "You are right. But who can stop this madness called war?",
    "merchant_quest_brief",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_1",
    [],
    "It is your duty to help the nobles in their war effort. You shouldn't complain about it.",
    "merchant_quest_persuade_peace_reject",
    []],

  [anyone, "merchant_quest_persuade_peace_reject",
    [],
    "Hah. The nobles fight their wars for their greed and their dreams of glory, and it is poor, honest folk like us who have to bear the real burden. But you obviously don't want to hear about that.",
    "close_window",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_persuade_lords_to_make_peace"),
    ],
    "There have been attempts to reconcile the two sides and reach a settlement. However, there are powerful lords on both sides whose interests lie in continuing the war. These men urge all others not to heed to the word of sensible men, but to keep fighting. While these leaders remain influential, no peace settlement can be reached.",
    "merchant_quest_persuade_peace_3",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_3",
    [],
    "Who are these warmongers who block the way of peace?",
    "merchant_quest_persuade_peace_4",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_3",
    [],
    "Who are these lords you speak of?",
    "merchant_quest_persuade_peace_4",
    []],

  [anyone, "merchant_quest_persuade_peace_4",
    [],
    "They are {s12} from {s15} and {s13} from {s14}. Until they change their mind or lose their influence, there will be no chance of having peace between the two sides.",
    "merchant_quest_persuade_peace_5",
    [
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 2),
      (str_store_troop_name_link, s12, ":var1"),
      (str_store_troop_name_link, s13, ":var2"),
      (str_store_faction_name_link, s14, ":var0"),
      (str_store_faction_name_link, s15, "$g_encountered_party_faction"),
    ]],

  [plyr|anyone, "merchant_quest_persuade_peace_5",
    [],
    "What can be done about this?",
    "merchant_quest_persuade_peace_6",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_5",
    [],
    "Alas, it seems nothing can be done about it.",
    "merchant_quest_persuade_peace_6",
    []],

  [anyone, "merchant_quest_persuade_peace_6",
    [],
    "There is a way to resolve the issue. A particularly determined person can perhaps persuade one or both of these lords to accept making peace. And even if that fails, it can be possible to see that these lords are defeated by force and taken prisoner. If they are captive, they will lose their influence and they can no longer oppose a settlement... What do you think? Can you do it?",
    "merchant_quest_persuade_peace_7",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_7",
    [],
    "It seems difficult. But I will try.",
    "merchant_quest_persuade_peace_8",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_7",
    [],
    "If the price is right, I may.",
    "merchant_quest_persuade_peace_8",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_7",
    [],
    "Forget it. This is not my problem.",
    "merchant_quest_persuade_peace_8",
    []],

  [anyone, "merchant_quest_persuade_peace_8",
    [],
    "Most of the merchants in the town will gladly open up their purses to support such a plan. I think we can collect {reg12} denars between ourselves. We will be happy to reward you with that sum, if you can work this out. Convince {s12} and {s13} to accept a peace settlement, and if either of them proves too stubborn, make sure he falls captive and can not be ransomed until a peace deal is settled.",
    "merchant_quest_persuade_peace_9",
    [
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 4),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 2),
      (str_store_troop_name_link, s12, ":var0"),
      (str_store_troop_name_link, s13, ":var1"),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 22),
      (assign, reg12, ":var2"),
    ]],

  [plyr|anyone, "merchant_quest_persuade_peace_9",
    [],
    "All right. I will do my best.",
    "merchant_quest_persuade_peace_10",
    []],

  [plyr|anyone, "merchant_quest_persuade_peace_9",
    [],
    "Sorry. I can not do this.",
    "merchant_quest_persuade_peace_no",
    []],

  [anyone, "merchant_quest_persuade_peace_10",
    [],
    "Excellent. You will have our blessings. I hope you can deal with those two old goats. We will be waiting and hoping for the good news.",
    "close_window",
    [
      (str_store_party_name_link, s4, "$g_encountered_party"),
      (quest_get_slot, ":var0", "qst_persuade_lords_to_make_peace", 3),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 2),
      (quest_get_slot, ":var3", "qst_persuade_lords_to_make_peace", 22),
      (assign, reg12, ":var3"),
      (str_store_troop_name_link, s12, ":var1"),
      (str_store_troop_name_link, s13, ":var2"),
      (str_store_faction_name_link, s14, ":var0"),
      (str_store_faction_name_link, s15, "$g_encountered_party_faction"),
      (setup_quest_text, "qst_persuade_lords_to_make_peace"),
      (str_store_string, s2, "@Guildmaster of {s4} promised you {reg12} denars if you can make sure that {s12} and {s13} no longer pose a threat to a peace settlement between {s15} and {s14}. In order to do that, you must either convince them or make sure they fall captive and remain so until a peace agreement is made."),
      (call_script, "script_start_quest", "qst_persuade_lords_to_make_peace", "$g_talk_troop"),
      (quest_get_slot, ":var1", "qst_persuade_lords_to_make_peace", 4),
      (quest_get_slot, ":var2", "qst_persuade_lords_to_make_peace", 2),
      (call_script, "script_report_quest_troop_positions", "qst_persuade_lords_to_make_peace", ":var1", 3),
      (call_script, "script_report_quest_troop_positions", "qst_persuade_lords_to_make_peace", ":var2", 4),
    ]],

  [anyone, "merchant_quest_persuade_peace_no",
    [],
    "Don't say no right away. Think about this for some time. If there is a {reg63?man:lady} who can manage to do this, it is you.",
    "close_window",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_deal_with_night_bandits"),
    ],
    "Do I indeed! There's a group of bandits infesting the town, and I'm at the end of my rope as to how to deal with them. They've been ambushing and robbing townspeople under the cover of night, and then fading away quick as lightning when the guards finally show up. We've not been able to catch a one of them. They only attack lone people, never daring to show themselves when there's a group about. I need someone who can take on these bandits alone and win. That seems to be the only way of bringing them to justice. Are you up to the task?",
    "merchant_quest_deal_with_night_bandits",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_deal_with_night_bandits"),
    ],
    "There's a group of bandits infesting the town, and I'm at the end of my rope as to how to deal with them. They've been ambushing and robbing townspeople under the cover of night, and then fading away quick as lightning when the guards finally show up. We've not been able to catch a one of them. They only attack lone people, never daring to show themselves when there's a group about. I need someone who can take on these bandits alone and win. That seems to be the only way of bringing them to justice. Are you up to the task?",
    "merchant_quest_deal_with_night_bandits",
    []],

  [plyr|anyone, "merchant_quest_deal_with_night_bandits",
    [],
    "Killing bandits? Why, certainly!",
    "deal_with_night_bandits_quest_taken",
    [
      (str_store_party_name_link, s14, "$g_encountered_party"),
      (setup_quest_text, "qst_deal_with_night_bandits"),
      (str_store_string, s2, "@The Guildmaster of {s14} has asked you to deal with a group of bandits terrorizing the streets of {s14}. They only come out at night, and only attack lone travelers on the streets."),
      (call_script, "script_start_quest", "qst_deal_with_night_bandits", "$g_talk_troop"),
    ]],

  [plyr|anyone, "merchant_quest_deal_with_night_bandits",
    [],
    "My apologies, I'm not interested.",
    "merchant_quest_stall",
    []],

  [anyone, "deal_with_night_bandits_quest_taken",
    [],
    "That takes a weight off my shoulders, {playername}. You can expect a fine reward if you come back successful. Just don't get yourself killed, eh?",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_requested",
    [
      (eq, "$random_merchant_quest_no", "qst_move_cattle_herd"),
      (quest_get_slot, ":var0", "qst_move_cattle_herd", 1),
      (str_store_party_name, s13, ":var0"),
    ],
    "One of the merchants here is looking for herdsmen to take his cattle to the market at {s13}.",
    "merchant_quest_brief",
    []],

  [anyone, "merchant_quest_brief",
    [
      (eq, "$random_merchant_quest_no", "qst_move_cattle_herd"),
      (quest_get_slot, reg8, "qst_move_cattle_herd", 22),
      (quest_get_slot, ":var0", "qst_move_cattle_herd", 1),
      (str_store_party_name, s13, ":var0"),
    ],
    "The cattle herd must be at {s13} within 30 days. Sooner is better, much better, but it must be absolutely no later than 30 days. If you can do that, I'd be willing to pay you {reg8} denars for your trouble. Interested?",
    "move_cattle_herd_quest_brief",
    []],

  [plyr|anyone, "move_cattle_herd_quest_brief",
    [],
    "Aye, I can take the herd to {s13}.",
    "move_cattle_herd_quest_taken",
    [
      (call_script, "script_create_cattle_herd", "$g_encountered_party", 0),
      (quest_set_slot, "qst_move_cattle_herd", 8, reg0),
      (str_store_party_name_link, s10, "$g_encountered_party"),
      (quest_get_slot, ":var0", "qst_move_cattle_herd", 1),
      (str_store_party_name_link, s13, ":var0"),
      (quest_get_slot, reg8, "qst_move_cattle_herd", 22),
      (setup_quest_text, "qst_move_cattle_herd"),
      (str_store_string, s2, "@Guildmaster of {s10} asked you to move a cattle herd to {s13}. You will earn {reg8} denars in return."),
      (call_script, "script_start_quest", "qst_move_cattle_herd", "$g_talk_troop"),
    ]],

  [plyr|anyone, "move_cattle_herd_quest_brief",
    [],
    "I am sorry, but no.",
    "merchant_quest_stall",
    []],

  [anyone, "move_cattle_herd_quest_taken",
    [],
    "Splendid. You can find the herd right outside the town. After you take the animals to {s13}, return back to me and I will give you your pay.",
    "mayor_pretalk",
    []],

  [anyone, "merchant_quest_requested",
    [],
    "I am afraid I can't offer you a job right now.",
    "mayor_pretalk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deliver_cattle"),
      (check_quest_succeeded, ":var0"),
      (quest_get_slot, reg5, "qst_deliver_cattle", 10),
    ],
    "My good {reg63?sir:madam}. Our village is grateful for your help. Thanks to the {reg5} heads of cattle you have brought, we can now raise our own herd.",
    "village_elder_deliver_cattle_thank",
    [
      (call_script, "script_change_center_prosperity", "$current_town", 4),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_finish_quest_simple", "qst_deliver_cattle", 100),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
    ]],

  [anyone, "village_elder_deliver_cattle_thank",
    [],
    "My good {reg63?lord:lady}, please, is there anything I can do for you?",
    "village_elder_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_rescue_daughter"),
      (check_quest_succeeded, ":var0"),
    ],
    "Oh, my daughter is back, dearest {reg63?sir:madam}, and she escaped a fate worse than death just in time.^Please accept my prize cow {s5} as a reward, she's worth a dowry for a princess.",
    "village_elder_deliver_cattle_thank",
    [
      (call_script, "script_change_center_prosperity", "$current_town", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 7),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (call_script, "script_finish_quest_simple", "qst_rescue_daughter", 100),
      (party_remove_members, "p_main_party", "trp_kidnapped_daughter", 1),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
      (play_sound, "snd_cow_moo"),
      (call_script, "script_create_cattle_herd", "$current_town", 1),
      (assign, ":var0", reg0),
      (store_random_in_range, ":var1", 0, 4),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s5, "@Pippa"),
      (else_try),
        (eq, ":var1", 1),
        (str_store_string, s5, "@Daisy"),
      (else_try),
        (eq, ":var1", 2),
        (str_store_string, s5, "@Betsy"),
      (else_try),
        (str_store_string, s5, "@Princess"),
      (try_end),
      (party_set_name, ":var0", "@{s5}"),
      (party_set_slot, ":var0", 7, 1),
      (party_set_ai_behavior, ":var0", ai_bhvr_escort_party),
      (party_set_ai_object, ":var0", "p_main_party"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_escort_peasants"),
      (check_quest_succeeded, ":var0"),
    ],
    "I've heard our fellow villagers made it safely to {s5}, my good {reg63?sir:madam}, and our village is grateful. They should make a more honest trade there, and they send their regards.^Please accept some of our famous {s6}, you won't find this quality in the towns.",
    "village_elder_deliver_cattle_thank",
    [
      (call_script, "script_change_center_prosperity", "$current_town", 3),
      (call_script, "script_change_player_relation_with_center", "$current_town", 4),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (call_script, "script_finish_quest_simple", "qst_escort_peasants", 100),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (troop_clear_inventory, "trp_temp_troop"),
      (try_for_range, ":var2", "itm_spice", "itm_baggage_train"),
        (call_script, "script_center_get_production", "$current_town", ":var2"),
        (assign, ":var3", reg0),
        (gt, ":var3", 0),
        (store_sub, ":var4", ":var2", "itm_spice"),
        (val_add, ":var4", 301),
        (party_get_slot, ":var5", "$current_town", ":var4"),
        (try_begin),
          (gt, ":var5", ":var0"),
          (assign, ":var0", ":var5"),
          (assign, ":var1", ":var2"),
        (try_end),
      (try_end),
      (store_div, ":var6", 6000, ":var0"),
      (troop_add_items, "trp_temp_troop", ":var1", ":var6"),
      (str_store_item_name_plural, s6, ":var1"),
      (quest_get_slot, ":var7", "qst_escort_peasants", 1),
      (str_store_party_name, s5, ":var7"),
      (change_screen_loot, "trp_temp_troop"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (eq, "$g_talk_troop_met", 0),
      (str_store_party_name, s9, "$current_town"),
    ],
    "Good day, {reg63?sir:madam}, and welcome to {s9}. I am the elder of this village.",
    "village_elder_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (eq, "$g_talk_troop_met", 0),
      (str_store_party_name, s9, "$current_town"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Welcome to {s9}, my {reg63?lord:lady}. We rejoiced at the news that you are the new {reg63?lord:lady} of our humble village. I am the village elder and I will be honored to serve you in any way I can.",
    "village_elder_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "{reg63?My lord:My lady}, you honor our humble village with your presence.",
    "village_elder_talk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
    ],
    "Good day, {reg63?sir:madam}.",
    "village_elder_talk",
    []],

  [anyone, "village_elder_pretalk",
    [],
    "Is there anything else I can do for you?",
    "village_elder_talk",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (check_quest_active, "qst_hunt_down_fugitive"),
      (neg|check_quest_concluded, "qst_hunt_down_fugitive"),
      (quest_slot_eq, "qst_hunt_down_fugitive", 1, "$current_town"),
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 13),
      (call_script, "script_get_name_from_dna_to_s50", ":var0"),
      (str_store_string, s4, s50),
    ],
    "I am looking for a man by the name of {s4}. I was told he may be hiding here.",
    "village_elder_ask_fugitive",
    []],

  [anyone, "village_elder_ask_fugitive",
    [
      (is_currently_night),
    ],
    "Strangers come and go to our village, {reg63?sir:madam}. But I doubt you'll run into him at this hour of the night. You would have better luck during the day.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_ask_fugitive",
    [],
    "Strangers come and go to our village, {reg63?sir:madam}. If he is hiding here, you will surely find him if you look around.",
    "close_window",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (store_partner_quest, ":var0"),
      (ge, ":var0", 0),
    ],
    "About the task you asked of me...",
    "village_elder_active_mission_1",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (ge, "$g_talk_troop_faction_relation", 0),
      (store_partner_quest, ":var0"),
      (lt, ":var0", 0),
    ],
    "Do you have any tasks I can help you with?",
    "village_elder_request_mission_ask",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "I want a general report...",
    "pop2_village_status_center",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Tell me of your skills.",
    "village_elder_menu2",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (party_slot_eq, "$current_town", 35, 0),
      (party_slot_eq, "$current_town", 295, 0),
      (party_get_slot, ":var0", "$current_town", 293),
      (call_script, "script_pop_check_steward_skills", ":var0"),
      (eq, reg0, 1),
    ],
    "I wish to schedule a training session with you to update your skill set.",
    "village_elder_menu3",
    [
      (party_set_slot, "$current_town", 295, 1),
    ]],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (party_slot_eq, "$current_town", 35, 0),
      (party_slot_eq, "$current_town", 269, 1),
    ],
    "I wish you to close your current mine.",
    "village_mine_close_confirm",
    []],

  [plyr|anyone, "village_mine_close_confirm1",
    [],
    "Yes, close the mine.",
    "village_elder_menu2",
    [
      (call_script, "script_center_base_income_change", "$current_town", 269, 20),
    ]],

  [plyr|anyone, "village_mine_close_confirm1",
    [],
    "Perhaps we should reconsider.",
    "village_elder_menu2",
    []],

  [anyone, "village_elder_menu2",
    [],
    "Very good my {reg63?Lord:Lady}. Will there by anything else?",
    "village_elder_talk",
    []],

  [anyone, "village_mine_close_confirm",
    [
      (party_get_slot, ":var0", "$current_town", 291),
      (assign, reg9, ":var0"),
    ],
    "Closing the current mine will reduce our base income by {reg9}, but will give us the option to send out prospectors that may find a more valuable site.Are you sure you wish to close the current mine?",
    "village_mine_close_confirm1",
    []],

  [anyone, "village_elder_menu3",
    [],
    "As you say, my {reg63?Lord:Lady}. The arrangements for the session have been made. May I be of any further assistance?",
    "village_elder_talk",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 35, 0),
      (neg|party_slot_ge, "$current_town", 39, 1),
    ],
    "I want to buy some supplies. I will pay with gold.",
    "village_elder_trade_begin",
    []],

  [anyone, "village_elder_trade_begin",
    [],
    "Of course, {reg63?sir:madam}. Do you want to buy goods or cattle?",
    "village_elder_trade_talk",
    []],

  [plyr|anyone, "village_elder_trade_talk",
    [],
    "I want to buy food and supplies.",
    "village_elder_trade",
    []],

  [anyone, "village_elder_trade",
    [],
    "We have some food and other supplies in our storehouse. Come have a look.",
    "village_elder_pretalk",
    [
      (change_screen_trade, "$g_talk_troop"),
    ]],

  [plyr|anyone, "village_elder_trade_talk",
    [
      (party_slot_eq, "$current_town", 35, 0),
      (neg|party_slot_ge, "$current_town", 39, 1),
      (assign, ":var0", 0),
      (try_begin),
        (check_quest_active, "qst_deliver_cattle"),
        (quest_slot_eq, "qst_deliver_cattle", 1, "$current_town"),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "I want to buy some cattle.",
    "village_elder_buy_cattle",
    []],

  [plyr|anyone, "village_elder_trade_talk",
    [],
    "I changed my mind. I don't need to buy anything.",
    "village_elder_pretalk",
    []],

  [plyr|anyone, "village_elder_talk",
    [],
    "Have you seen any enemies around here recently?",
    "village_elder_ask_enemies",
    []],

  [anyone, "pop2_village_status_center",
    [
      (party_get_slot, reg52, "$current_town", 290),
      (party_get_slot, reg1, "$current_town", 291),
      (party_get_slot, ":var0", "$current_town", 120),
      (str_store_party_name, s9, ":var0"),
      (party_get_slot, reg2, "$current_town", 50),
      (ge, reg52, -900),
    ],
    "The Base income value here is {reg52}, and the current prosperity is {reg2}. In addition the mineral value here is {reg1}. The village is bound to {s9}.",
    "village_elder_talk",
    []],

  [anyone, "village_elder_ask_enemies",
    [
      (assign, ":var0", 0),
      (party_get_slot, ":var1", "$g_encountered_party", 61),
      (store_relation, ":var2", ":var1", "fac_player_supporters_faction"),
      (try_begin),
        (gt, ":var2", 0),
        (party_slot_ge, "$g_encountered_party", 26, 0),
        (assign, ":var0", 1),
      (else_try),
        (party_slot_ge, "$g_encountered_party", 26, 30),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "I am sorry, {reg63?sir:madam}. We have neither seen nor heard of any war parties in this area.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_ask_enemies",
    [],
    "Hmm. Let me think about it...",
    "village_elder_tell_enemies",
    [
      (assign, "$temp", 0),
    ]],

  [anyone, "village_elder_tell_enemies",
    [
      (assign, ":var0", "$temp"),
      (assign, ":var1", "trp_knight_1_1_wife"),
      (try_for_range, ":var2", "trp_npc_adonja", ":var1"),
        (troop_slot_eq, ":var2", 2, 2),
        (troop_get_slot, ":var3", ":var2", 10),
        (gt, ":var3", 0),
        (store_troop_faction, ":var4", ":var2"),
        (store_relation, ":var5", ":var4", "fac_player_supporters_faction"),
        (lt, ":var5", 0),
        (store_distance_to_party_from_party, ":var6", "$g_encountered_party", ":var3"),
        (lt, ":var6", 10),
        (call_script, "script_get_information_about_troops_position", ":var2", 0),
        (eq, reg0, 1),
        (val_sub, ":var0", 1),
        (lt, ":var0", 0),
        (assign, ":var1", 0),
        (str_store_string, s2, "@He is not commanding any men at the moment."),
        (assign, ":var7", 0),
        (assign, ":var8", 0),
        (party_get_num_companion_stacks, ":var9", ":var3"),
        (try_for_range_backwards, ":var10", 0, ":var9"),
          (party_stack_get_troop_id, ":var11", ":var3", ":var10"),
          (neg|troop_is_hero, ":var11"),
          (party_stack_get_size, ":var12", ":var3", ":var10"),
          (party_stack_get_num_wounded, ":var13", ":var3", ":var10"),
          (val_add, ":var7", ":var12"),
          (val_add, ":var8", ":var13"),
        (try_end),
        (gt, ":var7", 0),
        (call_script, "script_round_value", ":var8"),
        (assign, reg1, reg0),
        (call_script, "script_round_value", ":var7"),
        (str_store_string, s2, "@He currently commands {reg0} men{reg1?, of which around {reg1} are wounded:}."),
      (try_end),
      (eq, ":var1", 0),
    ],
    "{s1} {s2}",
    "village_elder_tell_enemies",
    [
      (val_add, "$temp", 1),
    ]],

  [anyone, "village_elder_tell_enemies",
    [
      (eq, "$temp", 0),
    ],
    "No, {reg63?sir:madam}. We haven't seen any war parties in this area for some time.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_tell_enemies",
    [],
    "Well, I guess that was all.",
    "village_elder_pretalk",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (party_slot_eq, "$current_town", 259, 1),
      (party_slot_ge, "$current_town", 93, 1),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 2000),
      (store_num_parties_of_template, ":var1", "pt_militia"),
      (lt, ":var1", 20),
    ],
    "Tell the Sheriff to gather any village recruits and send them on a patrol around the village. (cost 2000)",
    "village_elder_menu2",
    [
      (spawn_around_party, "$current_town", "pt_militia"),
      (assign, ":var0", reg0),
      (party_set_slot, ":var0", 123, "$current_town"),
      (str_store_party_name, s1, "$current_town"),
      (party_set_name, ":var0", "@{s1} militia patrol"),
      (store_faction_of_party, ":var1", "$current_town"),
      (party_set_faction, ":var0", ":var1"),
      (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
      (party_set_ai_patrol_radius, ":var0", 5),
      (party_set_ai_object, ":var0", "$current_town"),
      (party_set_flags, ":var0", 65536, 0),
      (troop_remove_gold, "trp_player", 2000),
      (party_set_slot, "$current_town", 93, -1),
    ]],

  [plyr|anyone, "village_elder_talk",
    [
      (party_get_slot, ":var0", "$current_town", 120),
      (assign, ":var1", 0),
      (party_get_num_prisoner_stacks, ":var2", ":var0"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
        (troop_is_hero, ":var4"),
        (try_begin),
          (party_add_members, "p_temp_party", ":var4", 1),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (ge, ":var1", 1),
    ],
    "I need you to set a large fire on the outskirts of this village.",
    "village_elder_ask_set_fire",
    []],

  [anyone, "village_elder_ask_set_fire",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 0),
      (party_get_slot, ":var0", "$current_town", 120),
      (party_get_slot, ":var1", ":var0", 240),
      (store_current_hours, ":var2"),
      (ge, ":var1", ":var2"),
    ],
    "We have already agreed upon this, {reg63?sir:my lady}. I will do my best. You can trust me.",
    "close_window",
    []],

  [anyone, "village_elder_ask_set_fire",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 0),
    ],
    "A fire, {reg63?sir:madam}! Fires are dangerous! Why would you want such a thing?",
    "village_elder_ask_set_fire_1",
    []],

  [anyone, "village_elder_ask_set_fire",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 1),
    ],
    "I believe that we have already discussed this issue, {reg63?sir:my lady}.",
    "village_elder_ask_set_fire_5",
    []],

  [anyone, "village_elder_ask_set_fire",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 2),
    ],
    "We talked about this {reg63?sir:madam} before, and your previous offers were low compared to the risk you want me to take.",
    "village_elder_ask_set_fire_5",
    []],

  [plyr|anyone, "village_elder_ask_set_fire_1",
    [],
    "I have my reasons, and you will have yours - a purse of silver. Will you do it, or not?",
    "village_elder_ask_set_fire_2",
    []],

  [plyr|anyone, "village_elder_ask_set_fire_1",
    [],
    "Given the risk you are taking, you are entitled to know my plan.",
    "village_elder_ask_set_fire_explain_plan",
    []],

  [plyr|anyone, "village_elder_ask_set_fire_explain_plan",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 120),
      (str_store_party_name, s4, ":var0"),
    ],
    "I wish to rescue a prisoner from {s4}. When you light the fire, the guards in {s4} will see the smoke, and some of them will rush outside to see what is going on.",
    "village_elder_ask_set_fire_2",
    []],

  [anyone, "village_elder_ask_set_fire_2",
    [
      (gt, "$g_talk_troop_effective_relation", 9),
    ],
    "As you wish, {reg63?sir:my lady}. You have been a good friend to this village, and, even though there is a risk, we should be glad to return the favor. When do you want this fire to start?",
    "village_elder_ask_set_fire_9",
    []],

  [anyone, "village_elder_ask_set_fire_2",
    [
      (lt, "$g_talk_troop_relation", 0),
    ],
    "I'm sorry, {reg63?sir:my lady}. You will forgive me for saying this, but we don't exactly have good reason to trust you. This is too dangerous.",
    "close_window",
    []],

  [anyone, "village_elder_ask_set_fire_2",
    [],
    "As you say, {reg63?sir:my lady}. But in doing this, we are taking a very great risk. What's in it for us?",
    "village_elder_ask_set_fire_3",
    []],

  [plyr|anyone, "village_elder_ask_set_fire_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 100),
    ],
    "I can give you 100 denars.",
    "village_elder_ask_set_fire_4",
    [
      (assign, "$g_last_money_offer_to_elder", 100),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 200),
    ],
    "I can give you 200 denars.",
    "village_elder_ask_set_fire_6",
    [
      (assign, "$g_last_money_offer_to_elder", 200),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_3",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "I can give you 300 denars.",
    "village_elder_ask_set_fire_6",
    [
      (assign, "$g_last_money_offer_to_elder", 300),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_3",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "village_elder_ask_set_fire_4",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 0),
    ],
    "This is madness. I cannot take such a risk.",
    "village_elder_talk",
    [
      (assign, "$g_village_elder_did_not_liked_money_offered", 1),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_5",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 1),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 200),
    ],
    "Then let's increase your reward to 200 denars.",
    "village_elder_ask_set_fire_7",
    [
      (assign, "$g_last_money_offer_to_elder", 200),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_5",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 1),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "Then let's increase your reward to 300 denars.",
    "village_elder_ask_set_fire_6",
    [
      (assign, "$g_last_money_offer_to_elder", 300),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_5",
    [
      (eq, "$g_village_elder_did_not_liked_money_offered", 2),
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "Then let's increase your reward to 300 denars. This is my last offer.",
    "village_elder_ask_set_fire_6",
    [
      (assign, "$g_last_money_offer_to_elder", 300),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_5",
    [],
    "Never mind.",
    "close_window",
    []],

  [anyone, "village_elder_ask_set_fire_6",
    [],
    "Very well. You are asking me to take a very great risk, but I will do it. When do you want this fire to start?",
    "village_elder_ask_set_fire_9",
    [
      (troop_remove_gold, "trp_player", "$g_last_money_offer_to_elder"),
    ]],

  [anyone, "village_elder_ask_set_fire_7",
    [],
    "I cannot do such a dangerous thing for 200 denars.",
    "village_elder_talk",
    [
      (assign, "$g_village_elder_did_not_liked_money_offered", 2),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_9",
    [],
    "Continue with your preparations. One hour from now, I need that fire.",
    "village_elder_ask_set_fire_10",
    [
      (party_get_slot, ":var0", "$current_town", 120),
      (store_current_hours, ":var1"),
      (val_add, ":var1", 1),
      (assign, ":var2", ":var1"),
      (party_set_slot, ":var0", 240, ":var2"),
      (try_begin),
        (is_between, "$next_center_will_be_fired", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var3", "$next_center_will_be_fired", 38),
        (eq, ":var3", 0),
        (party_get_slot, ":var2", "$next_center_will_be_fired", 240),
        (store_current_hours, ":var4"),
        (store_sub, ":var5", ":var4", 4),
        (val_sub, ":var5", 1),
        (ge, ":var2", ":var5"),
        (party_clear_particle_systems, "$next_center_will_be_fired"),
      (try_end),
      (assign, "$next_center_will_be_fired", "$current_town"),
      (assign, "$g_village_elder_did_not_liked_money_offered", 0),
    ]],

  [plyr|anyone, "village_elder_ask_set_fire_9",
    [
      (store_time_of_day, ":var0"),
      (ge, ":var0", 6),
      (lt, ":var0", 23),
    ],
    "Do this in at the stroke of midnight. I will wait exactly one hour.",
    "village_elder_ask_set_fire_11",
    [
      (party_get_slot, ":var0", "$current_town", 120),
      (store_time_of_day, ":var1"),
      (store_current_hours, ":var2"),
      (store_sub, ":var3", 24, ":var1"),
      (store_add, ":var4", ":var2", ":var3"),
      (party_set_slot, ":var0", 240, ":var4"),
      (try_begin),
        (is_between, "$next_center_will_be_fired", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var5", "$next_center_will_be_fired", 38),
        (eq, ":var5", 0),
        (party_get_slot, ":var4", "$next_center_will_be_fired", 240),
        (store_current_hours, ":var6"),
        (store_sub, ":var7", ":var6", 4),
        (val_sub, ":var7", 1),
        (ge, ":var4", ":var7"),
        (party_clear_particle_systems, "$next_center_will_be_fired"),
      (try_end),
      (assign, "$next_center_will_be_fired", "$current_town"),
      (assign, "$g_village_elder_did_not_liked_money_offered", 0),
    ]],

  [anyone, "village_elder_ask_set_fire_10",
    [],
    "Very well, {reg63?sir:my lady}. We will make our preparations. Now you make yours.",
    "close_window",
    [
      (assign, ":var0", -1),
      (try_for_agents, ":var1"),
        (agent_get_troop_id, ":var2", ":var1"),
        (is_between, ":var2", "trp_village_1_elder", "trp_merchants_end"),
        (agent_get_position, pos0, ":var1"),
        (try_for_range, ":var3", 0, 64),
          (entry_point_get_position, pos1, ":var3"),
          (get_distance_between_positions, ":var4", pos0, pos1),
          (gt, ":var4", ":var0"),
          (assign, ":var0", ":var4"),
          (copy_position, pos2, pos1),
          (assign, ":var5", ":var1"),
        (try_end),
        (try_begin),
          (gt, ":var0", -1),
          (agent_set_scripted_destination, ":var5", pos2),
        (try_end),
      (try_end),
    ]],

  [anyone, "village_elder_ask_set_fire_11",
    [],
    "As you wish, {reg63?sir:my lady}. May the heavens protect you.",
    "close_window",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (check_quest_active, "qst_old_tale_part_1"),
      (quest_slot_eq, "qst_old_tale_part_1", 11, 1),
      (quest_get_slot, ":var0", "qst_old_tale_part_1", 2),
      (eq, "$g_talk_troop", ":var0"),
      (str_store_troop_name, s54, ":var0"),
    ],
    "A question {s54}, but are there any castles nearby?",
    "village_elder_old_tale_1",
    []],

  [anyone, "village_elder_old_tale_1",
    [],
    "The closest one is Seven Cross Keep, but it is half a day away, {reg63?sir:madam}. There is nothing in between, only fields and some old ruins.",
    "village_elder_old_tale_2",
    []],

  [plyr|anyone, "village_elder_old_tale_2",
    [],
    "Ruins?",
    "village_elder_old_tale_3",
    []],

  [anyone, "village_elder_old_tale_3",
    [],
    "Yes {reg63?sir:madam}. Some ruins nestled at the base of the mountain range just over that way; where the river begins it's descent. Elderly locals say that they are cursed, but we know how addled the old mind can be.",
    "village_elder_old_tale_4",
    []],

  [plyr|anyone, "village_elder_old_tale_4",
    [],
    "Could you give me instructions on how to get there or at least find it?",
    "village_elder_old_tale_5",
    []],

  [anyone, "village_elder_old_tale_5",
    [],
    "The ruins are not that far from here, {reg63?sir:madam}, but they can be easily missed. Follow river towards the mountain range and follow it inward where the river has carved.",
    "close_window",
    [
      (party_set_flags, "p_old_ruins", 256, 0),
      (quest_set_slot, "qst_old_tale_part_1", 11, 2),
      (str_clear, s54),
      (str_store_party_name_link, s54, "p_village_69"),
      (str_clear, s3),
      (str_store_string, s3, "@There is no castle next to {s54}, but the village elder mentioned old ruins located near the source of the local river, nestled into a very old mountain pass."),
      (add_quest_note_from_sreg, "qst_old_tale_part_1", 4, s3, 0),
    ]],

  [plyr|anyone, "village_elder_talk",
    [
      (check_quest_active, "qst_old_tale_part_2"),
      (quest_slot_eq, "qst_old_tale_part_2", 11, 1),
      (quest_get_slot, ":var0", "qst_old_tale_part_2", 2),
      (eq, "$g_talk_troop", ":var0"),
    ],
    "I am looking for a skilled builder. Do you know of any?",
    "village_elder_hidden_base_1",
    []],

  [anyone, "village_elder_hidden_base_1",
    [
      (str_clear, s2),
      (str_store_troop_name, s2, "trp_old_ruin_camp_master"),
      (str_clear, s54),
      (str_store_party_name, s54, "p_village_60"),
    ],
    "Yes, {reg63?sir:madam}, I do. Two builders live in our village. Normally I would recommend my nephew Gregard, but he is currently visiting our cousins in {s54}. The other one is {s2}.",
    "village_elder_hidden_base_2",
    []],

  [plyr|anyone, "village_elder_hidden_base_2",
    [],
    "I'll hire {s2}. Let him know and give these instructions to the old ruins we had spoken about before.",
    "village_elder_hidden_base_3",
    []],

  [anyone, "village_elder_hidden_base_3",
    [],
    "Of course, I will pass the message, {reg63?sir:madam}.",
    "close_window",
    [
      (quest_set_slot, "qst_old_tale_part_2", 11, 2),
      (str_clear, s54),
      (str_store_party_name, s54, "p_old_ruins"),
      (str_clear, s3),
      (str_store_string, s3, "@You have hired {s2}, a skilled builder, who should be able to help you with construction. Meet him at {s54} during daytime."),
      (add_quest_note_from_sreg, "qst_old_tale_part_2", 4, s3, 0),
    ]],

  [trp_old_ruin_camp_master, "start",
    [
      (check_quest_active, "qst_old_tale_part_2"),
      (quest_slot_eq, "qst_old_tale_part_2", 11, 2),
      (party_get_slot, ":var0", "p_village_69", 25),
    ],
    "Welcome, {reg63?sir:madam}.",
    "camp_master_rebuild_1",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_rebuild_1",
    [
      (str_clear, s2),
      (str_store_troop_name, s2, "trp_old_ruin_camp_master"),
    ],
    "Hello Master {s2}. Good to have you here. What do you think about this place? Could I establish a permanent base here?",
    "camp_master_rebuild_2",
    []],

  [trp_old_ruin_camp_master, "camp_master_rebuild_2",
    [],
    "Valley has potential, {reg63?sir:madam}, but it would require a lot of work and a lot of labor.",
    "camp_master_rebuild_3",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_rebuild_3",
    [],
    "What would you exactly need to make it happen?",
    "camp_master_rebuild_4",
    []],

  [trp_old_ruin_camp_master, "camp_master_rebuild_4",
    [],
    "Judging by the amount of work which needs to be done, 20 men should be enough to make this place up and running within two weeks.^^We would need tools, strong horses for some heavy lifting, food and ... a barrel of ale to keep morale high.",
    "camp_master_rebuild_5",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_rebuild_5",
    [],
    "Sounds reasonable. I will provide everything you need.",
    "close_window",
    [
      (quest_set_slot, "qst_old_tale_part_2", 11, 3),
      (str_clear, s2),
      (str_store_troop_name, s2, "trp_old_ruin_camp_master"),
      (str_clear, s54),
      (str_store_party_name, s54, "p_old_ruins"),
      (str_clear, s3),
      (str_store_string, s3, "@In order to make {s54} more hospitable, {s2} would need: 3 Sumpter Horses, 3 packs of Tools, 5 pieces of Dried Meat and 1 barrel of Ale."),
      (add_quest_note_from_sreg, "qst_old_tale_part_2", 5, s3, 0),
    ]],

  [trp_old_ruin_camp_master, "start",
    [
      (check_quest_active, "qst_old_tale_part_2"),
      (quest_slot_eq, "qst_old_tale_part_2", 11, 3),
    ],
    "Greetings, {reg63?sir:madam}. Do you have all necessary supplies?",
    "camp_master_supplies_1",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_supplies_1",
    [
      (assign, reg33, 0),
      (store_item_kind_count, ":var0", "itm_sumpter_horse", "trp_player"),
      (ge, ":var0", 3),
      (val_add, reg33, 1),
      (store_item_kind_count, ":var1", "itm_tools", "trp_player"),
      (ge, ":var1", 3),
      (val_add, reg33, 1),
      (store_item_kind_count, ":var2", "itm_dried_meat", "trp_player"),
      (ge, ":var2", 5),
      (val_add, reg33, 1),
      (store_item_kind_count, ":var3", "itm_ale", "trp_player"),
      (ge, ":var3", 1),
      (val_add, reg33, 1),
    ],
    "Yes, I have everything with me. Here you go.",
    "camp_master_supplies_2",
    [
      (troop_remove_items, "trp_player", "itm_sumpter_horse", 3),
      (troop_remove_items, "trp_player", "itm_tools", 3),
      (troop_remove_items, "trp_player", "itm_dried_meat", 5),
      (troop_remove_items, "trp_player", "itm_ale", 1),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_supplies_1",
    [
      (neq, reg33, 4),
    ],
    "No, not yet.",
    "close_window",
    []],

  [trp_old_ruin_camp_master, "camp_master_supplies_2",
    [],
    "All we need now is 20 strong men.",
    "close_window",
    [
      (quest_set_slot, "qst_old_tale_part_2", 11, 4),
      (str_clear, s2),
      (str_store_troop_name_plural, s2, "trp_refugee"),
      (str_clear, s3),
      (str_store_string, s3, "@You have provided required supplies. Organize necessary workforce (20 {s2}), then speak with the builder."),
      (add_quest_note_from_sreg, "qst_old_tale_part_2", 5, s3, 0),
      (finish_mission),
    ]],

  [trp_old_ruin_camp_master, "start",
    [
      (check_quest_active, "qst_old_tale_part_2"),
      (quest_slot_eq, "qst_old_tale_part_2", 11, 5),
    ],
    "I have everything to begin construction, {reg63?sir:madam}. We should be ready within two weeks.",
    "camp_master_start_build_1",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_start_build_1",
    [],
    "I will be return.",
    "close_window",
    [
      (quest_set_slot, "qst_old_tale_part_2", 11, 6),
      (store_current_day, "$old_ruins_var"),
      (val_add, "$old_ruins_var", 14),
      (str_clear, s3),
      (str_store_string, s3, "@The construction is in progress. Return after two weeks."),
      (add_quest_note_from_sreg, "qst_old_tale_part_2", 6, s3, 0),
      (finish_mission),
    ]],

  [trp_old_ruin_camp_master, "start",
    [
      (party_slot_eq, "p_old_ruins", 10, "scn_abhuva_pendor_castle_2_base"),
      (party_slot_eq, "p_old_ruins", 268, 0),
    ],
    "Greetings, {reg63?sir:madam}. As you can see the base is up and running. ^^I thought that this place would need few pairs of good eyes, those who could detect enemies on the edge of the camp and raise alarm if necessary. I hired a few good lads - they are young hunters, so they shouldn't cost you a fortune.",
    "camp_master_hire_1",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_hire_1",
    [],
    "You did well. I am impressed by your organizational skills and suspect it wasn't easy to keep the men under control for so long in this forgotten place. In fact I'm so impressed that I have an offer for you. I would like to employ you as the camp master. I will pay you well. ^^What do you think?",
    "camp_master_hire_2",
    []],

  [trp_old_ruin_camp_master, "camp_master_hire_2",
    [],
    "I have enjoyed repairing this place more than building one barn after another. You, {reg63?sir:madam}, treated me fair, much better than my previous employers. I will accept your offer.",
    "close_window",
    [
      (party_set_slot, "p_old_ruins", 268, 1),
      (party_set_flags, "p_old_ruins", 2097152, 0),
    ]],

  [trp_old_ruin_camp_master, "start",
    [
      (party_slot_eq, "p_old_ruins", 268, 1),
      (party_get_num_prisoner_stacks, ":var0", "p_old_ruins"),
      (str_clear, s2),
      (try_begin),
        (gt, ":var0", 0),
        (str_store_string, s2, "@{reg63?Sir:Madam}, as you know we don't have any available cells or jail to keep prisoners in this camp. Food and guards will be a problem as well. I have a few men that I hired, but they scout the nearby region looking for enemies, keeping the area safe. In light of that I will have to release any prisoners you drop off.^^What else can I do for you?"),
      (else_try),
        (str_store_string, s2, "@What can I do for you, {reg63?sir:madam}?"),
      (try_end),
    ],
    "{s2}",
    "camp_master_task_1",
    []],

  [trp_old_ruin_camp_master, "camp_master_pretalk",
    [],
    "Anything else, {reg63?sir:madam}?",
    "camp_master_task_1",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (party_slot_eq, "p_old_ruins", 270, 1),
      (main_party_has_troop, "trp_jatu_merc"),
      (str_clear, s2),
      (str_store_troop_name, s2, "trp_old_ruin_camp_master"),
      (str_clear, s3),
      (str_store_troop_name, s3, "trp_old_ruin_camp_vet"),
      (str_clear, s4),
      (str_store_troop_name_plural, s4, "trp_jatu_merc"),
    ],
    "I have brought you {s3}, one of the {s4}. We have already had a quick chat about his future.",
    "camp_master_upgrades_vet_hire_1",
    []],

  [trp_old_ruin_camp_master, "camp_master_upgrades_vet_hire_1",
    [],
    "Leave the details to me, {reg63?sir:madam}. Come {s3}, let's take a walk.",
    "camp_master_pretalk",
    [
      (party_remove_members, "p_main_party", "trp_jatu_merc", 1),
      (party_set_slot, "p_old_ruins", 270, 2),
      (display_log_message, "@Hidden Base: {s3} was appointed as a horse master.", 0x66CCFF),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I would like to review the garrison.",
    "camp_master_garrison_1",
    []],

  [trp_old_ruin_camp_master, "camp_master_garrison_1",
    [
      (try_begin),
        (party_slot_eq, "p_old_ruins", 251, 1),
        (assign, reg33, 100),
      (else_try),
        (assign, reg33, 50),
      (try_end),
      (party_get_num_companions, reg34, "p_old_ruins"),
      (str_clear, s2),
      (try_begin),
        (eq, reg34, reg33),
        (str_store_string, s2, "@Of course {reg63?sir:madam}. In case you have missed it - the garrison is full."),
      (else_try),
        (lt, reg34, reg33),
        (str_store_string, s2, "@Of course {reg63?sir:madam}. In case you have missed it - there is still some spare room for more soldiers. As of right now we stand at {reg34} strong. We can garrison more for {reg33} in total."),
      (else_try),
        (str_store_string, s2, "@Before you do, {reg63?sir:madam}, you should know that garrison is getting angry. Garrison morale is decreasing rapidly and tension between soldiers are raising. All of that is happening because this place is overcrowded. I think that desertions, even deadly brawls, are only the matter of time. ^^Currently {reg34} are stationed here, but this place can support only {reg33}."),
      (try_end),
    ],
    "{s2}^^Here is the current list ...",
    "camp_master_pretalk",
    [
      (troop_set_slot, "trp_quick_battle_6_player", 406, 12),
      (change_screen_exchange_members, 1),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [],
    "I would like to access camp's vault.",
    "camp_master_storage_1",
    [
      (change_screen_loot, "trp_bonus_chest_6"),
    ]],

  [trp_old_ruin_camp_master, "camp_master_storage_1",
    [],
    "Here is the content of our storage.",
    "camp_master_pretalk",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (eq, "$temp", 0),
    ],
    "I would like to see another fight.",
    "camp_master_arena_1",
    [
      (entry_point_get_position, pos1, 18),
      (try_for_agents, ":var0"),
        (agent_is_alive, ":var0"),
        (agent_is_human, ":var0"),
        (1707, ":var0"),
        (agent_get_position, pos2, ":var0"),
        (get_distance_between_positions, ":var1", pos1, pos2),
        (le, ":var1", 200),
        (1749, ":var0"),
      (try_end),
    ]],

  [trp_old_ruin_camp_master, "camp_master_arena_1",
    [],
    "How long this sparring should last?",
    "camp_master_arena_2",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_arena_2",
    [
      (try_begin),
        (party_slot_eq, "p_old_ruins", 267, 100),
        (str_store_string, s1, "@Standard round should be enough. (100% HP)"),
      (else_try),
        (party_slot_eq, "p_old_ruins", 267, 500),
        (str_store_string, s1, "@Let them have a bit more fun! (500% HP)"),
      (else_try),
        (party_slot_eq, "p_old_ruins", 267, 1000),
        (str_store_string, s1, "@I'd like a long fight! (1000% HP)"),
      (else_try),
        (party_set_slot, "p_old_ruins", 267, 1000),
        (str_store_string, s1, "@I'd like a long fight! (1000% HP)"),
      (try_end),
    ],
    "{s1}",
    "camp_master_arena_1",
    [
      (try_begin),
        (party_slot_eq, "p_old_ruins", 267, 100),
        (party_set_slot, "p_old_ruins", 267, 500),
      (else_try),
        (party_slot_eq, "p_old_ruins", 267, 500),
        (party_set_slot, "p_old_ruins", 267, 1000),
      (else_try),
        (party_slot_eq, "p_old_ruins", 267, 1000),
        (party_set_slot, "p_old_ruins", 267, 100),
      (try_end),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_arena_2",
    [],
    "Let me see what they have learned.",
    "camp_master_arena_3",
    []],

  [trp_old_ruin_camp_master, "camp_master_arena_3",
    [
      (party_get_num_companion_stacks, ":var0", "p_old_ruins"),
      (party_clear, "p_temp_party"),
      (try_for_range, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_old_ruins", ":var1"),
        (party_stack_get_size, ":var3", "p_old_ruins", ":var1"),
        (party_stack_get_num_wounded, ":var4", "p_old_ruins", ":var1"),
        (val_sub, ":var3", ":var4"),
        (party_add_members, "p_temp_party", ":var2", ":var3"),
      (try_end),
      (party_get_num_companion_stacks, ":var0", "p_temp_party"),
      (assign, ":var5", 0),
      (party_stack_get_troop_id, ":var2", "p_temp_party", ":var5"),
      (set_visitor, 18, ":var2"),
      (str_store_troop_name, s1, ":var2"),
      (try_begin),
        (ge, ":var0", 2),
        (val_add, ":var5", 1),
      (try_end),
      (party_stack_get_troop_id, ":var2", "p_temp_party", ":var5"),
      (set_visitor, 19, ":var2"),
      (str_store_troop_name, s2, ":var2"),
      (assign, "$temp", 4),
    ],
    "{s1} ^and ^{s2} ^^should be ready soon. ^^^^(1st and 2nd troop on the garrison list. Advanced Soldier Management keys may be used to rearrange garrisoned troops)",
    "close_window",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (this_or_next|party_slot_eq, "p_old_ruins", 262, 0),
      (this_or_next|party_slot_eq, "p_old_ruins", 270, 0),
      (party_slot_eq, "p_old_ruins", 251, 0),
    ],
    "Could we make some additions here?",
    "camp_master_upgrades_1",
    []],

  [trp_old_ruin_camp_master, "camp_master_upgrades_1",
    [
      (str_clear, s2),
      (str_store_string, s2, "@Otherwise:"),
      (try_begin),
        (party_slot_eq, "p_old_ruins", 262, 0),
        (str_clear, s3),
        (str_store_string, s3, "@- It would be good to have a blacksmith here"),
        (str_store_string, s2, "@{s2}^^{s3}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "p_old_ruins", 251, 0),
        (str_clear, s3),
        (str_store_string, s3, "@- We could make a bit more room for your soldiers"),
        (str_store_string, s2, "@{s2}^^{s3}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "p_old_ruins", 270, 0),
        (str_clear, s3),
        (str_store_string, s3, "@- A designated person who could take care of the horses would be very valuable."),
        (str_store_string, s2, "@{s2}^^{s3}"),
      (try_end),
    ],
    "I have a had a grand idea, such as recreating the stone fortress that was proudly once here. However it is rather costly and time consuming. It also might bring unnecessary attention to this place. {s2}.",
    "camp_master_upgrades_2",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_2",
    [
      (party_slot_eq, "p_old_ruins", 262, 0),
    ],
    "A blacksmith?",
    "camp_master_upgrades_2_blacksmith",
    []],

  [trp_old_ruin_camp_master, "camp_master_upgrades_2_blacksmith",
    [
      (str_clear, s4),
      (str_store_troop_name, s4, "trp_old_ruin_camp_blacksmith"),
    ],
    "This place has remains of what was once an old forge. One that could repair armor, restore weapons to working order, flatten dents in old helmets, and fit horseshoes. I have been looking for an experienced blacksmith in the nearby country. ^^Luckily, it seems that {s4}, one of the men you brought here for work, was a blacksmith's apprentice for a year and he should be able to deal with basic blacksmith requests. All he would need is 3000 denars to buy iron, coal and the required tools. What do you think?",
    "camp_master_upgrades_3_blacksmith",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_blacksmith",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 3000),
    ],
    "Sounds reasonable. Make it happen.",
    "camp_master_pretalk",
    [
      (troop_remove_gold, "trp_player", 3000),
      (party_set_slot, "p_old_ruins", 262, 1),
      (troop_set_slot, "trp_old_ruin_camp_blacksmith", 80, 2),
      (display_log_message, "@Hidden Base: {s4} was appointed as a blacksmith.", 0x66CCFF),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_blacksmith",
    [],
    "My budget is tight at the moment. It will have to wait",
    "camp_master_pretalk",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_2",
    [
      (party_slot_eq, "p_old_ruins", 251, 0),
    ],
    "I think we should invest in a larger barracks, do you agree? Our lodgings are rather small.",
    "camp_master_upgrades_2_room",
    []],

  [trp_old_ruin_camp_master, "camp_master_upgrades_2_room",
    [],
    "Yes, {reg63?sir:madam}, I am aware of that. There is not much space left in which would be suitable for new foundations. The ground is simply too hard, almost entirely rock solid. As you probably remember from my reports, a while ago we discovered two formerly collapsed castle chambers. The smaller one is our vault now, but the other is unused at the moment.^^We could bring that room to its former glory and it should be big enough to accommodate an additional 50 troops. The overall cost shouldn't exceed 15000 denars. What do you think?",
    "camp_master_upgrades_3_room",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_room",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 15000),
    ],
    "Not much for 50 extra beds. It sounds like a good investment.",
    "camp_master_pretalk",
    [
      (troop_remove_gold, "trp_player", 15000),
      (party_set_slot, "p_old_ruins", 251, 1),
      (display_log_message, "@Hidden Base: troops capacity increased by 50.", 0x66CCFF),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_room",
    [],
    "These are very expensive beds. Silky sheets? I don't think so. Maybe next time.",
    "camp_master_pretalk",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_2",
    [
      (party_slot_eq, "p_old_ruins", 270, 0),
    ],
    "Perhaps we can hire some stable workers?",
    "camp_master_upgrades_2_vet",
    []],

  [trp_old_ruin_camp_master, "camp_master_upgrades_2_vet",
    [
      (str_clear, s4),
      (str_store_troop_name_plural, s4, "trp_jatu_merc"),
    ],
    "More than that, {reg63?sir:madam}. Sooner or later we will need someone who can care for the horses as they have their own specific issues that accompany them. I would hate to see a maimed horse be uncured. Otherwise all those magnificent beasts will end up in a delicious stew.^^I think we should hire someone with vast knowledge on horses. The Jatu, I believe they are called, would be a good start. They're famous for their knowledge about horses. It may be quite deadly trying to speak with members of the patrolling warbands, but I heard that sometimes {s4} can be found in the taverns. They are more 'civilized' and we should be able to convince the most suitable one to stay here. ^^Leave negotiations to me, but in the meantime 5000 denars should help me to arrange everything.",
    "camp_master_upgrades_3_vet",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_vet",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 5000),
    ],
    "Not a bad idea. I will try my luck with {s4}.",
    "camp_master_pretalk",
    [
      (troop_remove_gold, "trp_player", 5000),
      (party_set_slot, "p_old_ruins", 270, 1),
      (display_log_message, "@Bring one of the {s4} to the camp master.", 0x66CCFF),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_3_vet",
    [],
    "I have different plans at the moment.",
    "camp_master_pretalk",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_upgrades_2",
    [],
    "I need to think about what you've just said.",
    "camp_master_pretalk",
    []],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I want to leave all my troops here.",
    "camp_master_pretalk",
    [
      (party_clear, "p_temp_party"),
      (party_get_num_companion_stacks, ":var0", "p_main_party"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (neg|troop_is_hero, ":var2"),
        (party_stack_get_size, ":var3", "p_main_party", ":var1"),
        (party_add_members, "p_temp_party", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_main_party", ":var1"),
        (party_wound_members, "p_temp_party", ":var2", ":var4"),
        (party_remove_members, "p_main_party", ":var2", ":var3"),
      (try_end),
      (party_get_num_companion_stacks, ":var0", "p_temp_party"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_temp_party", ":var1"),
        (party_stack_get_size, ":var3", "p_temp_party", ":var1"),
        (party_add_members, "p_old_ruins", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_temp_party", ":var1"),
        (party_wound_members, "p_old_ruins", ":var2", ":var4"),
        (party_remove_members, "p_temp_party", ":var2", ":var3"),
      (try_end),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [
      (neg|check_quest_active, "qst_order_challenge"),
      (call_script, "script_game_get_party_companion_limit"),
      (assign, ":var0", reg0),
      (party_get_num_companions, ":var1", "p_main_party"),
      (party_get_num_companions, ":var2", "p_old_ruins"),
      (store_add, ":var3", ":var1", ":var2"),
      (ge, ":var0", ":var3"),
    ],
    "I want to take all garrisoned troops with me.",
    "camp_master_pretalk",
    [
      (party_clear, "p_temp_party"),
      (party_get_num_companion_stacks, ":var0", "p_old_ruins"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_old_ruins", ":var1"),
        (party_stack_get_size, ":var3", "p_old_ruins", ":var1"),
        (party_add_members, "p_temp_party", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_old_ruins", ":var1"),
        (party_wound_members, "p_temp_party", ":var2", ":var4"),
        (party_remove_members, "p_old_ruins", ":var2", ":var3"),
      (try_end),
      (party_get_num_companion_stacks, ":var0", "p_temp_party"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_temp_party", ":var1"),
        (party_stack_get_size, ":var3", "p_temp_party", ":var1"),
        (party_add_members, "p_main_party", ":var2", ":var3"),
        (party_stack_get_num_wounded, ":var4", "p_temp_party", ":var1"),
        (party_wound_members, "p_main_party", ":var2", ":var4"),
        (party_remove_members, "p_temp_party", ":var2", ":var3"),
      (try_end),
    ]],

  [plyr|trp_old_ruin_camp_master, "camp_master_task_1",
    [],
    "Nevermind. I will talk to you later.",
    "close_window",
    []],

  [trp_old_ruin_camp_blacksmith, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 2),
    ],
    "Greetings Commander. Thank you for allowing me to work in this forge where I can gather more experience and further develop my skills. I won't let you down.",
    "camp_blacksmith_welcome_1",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_welcome_1",
    [],
    "I am sure you won't. ^^We will speak later.",
    "camp_blacksmith_welcome_2",
    []],

  [trp_old_ruin_camp_blacksmith, "camp_blacksmith_welcome_2",
    [],
    "Commander, before you go I have to tell you something. During the construction, workers discovered some remains of what once was a large storage room. The foundation was quite bad. Inside they found an assortment of items. You can see what we found laying on that table behind me. One is this old horse armor that is uniquely shaped. However, what is even more important, is that it's made out of unusual metal: lightweight and strong. I remember that my master once mentioned about a rare ore, which was almost impossible to find. It ran between veins of ebony ore and once it's nature was discovered, was only acquired by royalty.",
    "camp_blacksmith_welcome_3",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_welcome_3",
    [],
    "That is interesting. Is this armor still usable?",
    "camp_blacksmith_welcome_4",
    []],

  [trp_old_ruin_camp_blacksmith, "camp_blacksmith_welcome_4",
    [],
    "Armor is in quite good shape, but it would require some work to restore it to its former glory. ^^There is a bigger problem though. It seems that this piece of equipment was made to fit a very large horse breed, not like the ones we have around here. I adjusted the armor as much as I could, but even after that I couldn't find a single horse that could wear it.",
    "camp_blacksmith_welcome_5",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_welcome_5",
    [],
    "You have mentioned that items made out of this metal were used only by royalty. It is most likely that they have had special horses as well, worthy to wear such a rare barding. I think it would be a good idea to visit the old Pendor capital and try to find out something about these old and large horse breeds.",
    "close_window",
    [
      (quest_set_slot, "qst_horse_armor", 6, "$g_talk_troop"),
      (quest_set_slot, "qst_horse_armor", 23, 0),
      (quest_set_slot, "qst_horse_armor", 24, 0),
      (call_script, "script_reward_for_quest_per_player_level", 500, 100, 0, 0),
      (quest_set_slot, "qst_horse_armor", 21, reg33),
      (quest_set_slot, "qst_horse_armor", 22, reg34),
      (quest_set_slot, "qst_horse_armor", 11, 1),
      (quest_set_slot, "qst_horse_armor", 1, "p_town_6"),
      (party_get_slot, ":var0", "p_town_6", 24),
      (quest_set_slot, "qst_horse_armor", 2, ":var0"),
      (str_clear, s54),
      (str_store_troop_name, s54, "$g_talk_troop"),
      (str_clear, s2),
      (str_store_string, s2, "@Blacksmith {s54} has found a unique horse armor - find a steed worthy to wear it."),
      (call_script, "script_start_quest", "qst_horse_armor", "$g_talk_troop"),
      (str_clear, s3),
      (str_store_string, s3, "@Visit the old Pendor capital and try to find out more about what breed could wear it."),
      (add_quest_note_from_sreg, "qst_horse_armor", 3, s3, 0),
    ]],

  [trp_old_ruin_camp_blacksmith, "start",
    [
      (ge, "$old_ruins_var", 100),
      (store_div, reg1, "$old_ruins_var", 100),
      (party_slot_ge, "p_old_ruins", 262, 2),
      (try_begin),
        (str_clear, s2),
        (gt, reg1, 1),
        (str_store_string, s2, "@{reg1} days time"),
      (else_try),
        (str_store_string, s2, "@1 day time"),
      (try_end),
    ],
    "I'm still working on your order, Commander. It should be ready in {s2}.",
    "close_window",
    []],

  [trp_old_ruin_camp_blacksmith, "start",
    [
      (lt, "$old_ruins_var", 100),
      (party_slot_ge, "p_old_ruins", 262, 2),
      (store_free_inventory_capacity, "$temp", "trp_player"),
      (gt, "$temp", 0),
      (party_get_slot, "$temp_2", "p_old_ruins", 262),
      (val_sub, "$temp_2", 1),
      (str_store_item_name, s2, "$temp_2"),
    ],
    "Commander, I have your {s2} right here.",
    "camp_blacksmith_jobdone_1",
    [
      (troop_add_item, "trp_player", "$temp_2", imod_plain),
      (party_set_slot, "p_old_ruins", 262, 1),
      (try_begin),
        (quest_slot_eq, "qst_horse_armor", 11, 4),
        (eq, "$temp_2", "itm_armored_warhorse_pendor"),
        (quest_set_slot, "qst_horse_armor", 11, 5),
        (call_script, "script_finish_quest_simple", "qst_horse_armor", 100),
        (display_log_message, "@The horse looks at you with an unexplainable mystical bond."),
      (try_end),
    ]],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_jobdone_1",
    [],
    "Looks like new.",
    "close_window",
    []],

  [trp_old_ruin_camp_blacksmith, "start",
    [
      (lt, "$old_ruins_var", 100),
      (party_slot_ge, "p_old_ruins", 262, 2),
      (eq, "$temp", 0),
    ],
    "Commander, your order is ready, but your inventory is full.",
    "close_window",
    []],

  [trp_old_ruin_camp_blacksmith, "start",
    [
      (party_slot_eq, "p_old_ruins", 262, 1),
      (player_has_item, "itm_horse_for_armor"),
      (quest_slot_eq, "qst_horse_armor", 11, 3),
    ],
    "Commander, what an extraordinary horse you have brought here!",
    "camp_blacksmith_quest_ha_1",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_quest_ha_1",
    [],
    "This one belongs to the long line of horses use by Pendor kings long ago. Wasn't easy or cheap to get him, as only a few pedigrees have survived up to this point. ^^Some evidences suggest that the barding found here was made for this pedigree. What do you think?",
    "camp_blacksmith_quest_ha_2",
    []],

  [trp_old_ruin_camp_blacksmith, "camp_blacksmith_quest_ha_2",
    [],
    "Before I answer your question, Commander, let me do a few measurements. I know exactly where the previous horses failed, so it shouldn't take long.",
    "camp_blacksmith_quest_ha_3",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_quest_ha_3",
    [],
    "And?",
    "camp_blacksmith_quest_ha_4",
    []],

  [trp_old_ruin_camp_blacksmith, "camp_blacksmith_quest_ha_4",
    [],
    "This steed and the barding matches almost perfectly! ^^Armor is nearly restored and only few small alterations are needed. I believe everything should be ready within two weeks.",
    "close_window",
    [
      (quest_set_slot, "qst_horse_armor", 11, 4),
      (troop_remove_item, "trp_player", "itm_horse_for_armor"),
      (store_add, ":var0", "itm_armored_warhorse_pendor", 1),
      (party_set_slot, "p_old_ruins", 262, ":var0"),
      (val_add, "$old_ruins_var", 1400),
      (str_clear, s3),
      (str_store_string, s3, "@Horse and barding should be ready within two weeks."),
      (add_quest_note_from_sreg, "qst_horse_armor", 3, s3, 0),
    ]],

  [trp_old_ruin_camp_blacksmith, "start",
    [],
    "Do you need anything, Commander?^^^^^(item from the 1st slot in the main inventory)",
    "camp_blacksmith_task_1",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_1",
    [
      (party_slot_eq, "p_old_ruins", 262, 1),
    ],
    "Yes, repair this item for me.",
    "camp_blacksmith_task_2",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_1",
    [],
    "No, not right now.",
    "close_window",
    []],

  [trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_2",
    [
      (troop_get_inventory_slot, "$temp_2", "trp_player", 10),
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", 10),
      (str_clear, s2),
      (assign, "$temp", 0),
      (try_begin),
        (lt, "$temp_2", 0),
        (str_store_string, s2, "@What item?"),
      (else_try),
        (ge, "$temp_2", 0),
        (item_get_type, ":var1", "$temp_2"),
        (this_or_next|eq, ":var1", 1),
        (this_or_next|eq, ":var1", 11),
        (this_or_next|eq, ":var1", 19),
        (eq, ":var1", 20),
        (try_begin),
          (party_slot_ge, "p_old_ruins", 270, 2),
          (str_store_string, s2, "@I am a blacksmith and don't know how to deal with this type of item. Maybe Derafsh will be able to help you."),
        (else_try),
          (str_store_string, s2, "@I am a blacksmith and don't know how to deal with this type of item. You may need to ask someone with horse knowledge."),
        (try_end),
      (else_try),
        (ge, "$temp_2", 0),
        (this_or_next|eq, ":var0", 0),
        (this_or_next|is_between, ":var0", 8, 21),
        (this_or_next|is_between, ":var0", 24, 42),
        (eq, ":var0", 42),
        (str_store_string, s2, "@I am just an apprentice, I don't have the necessary skills to improve this item any further."),
      (else_try),
        (ge, "$temp_2", 0),
        (str_clear, s3),
        (str_clear, s4),
        (str_clear, s5),
        (str_clear, s6),
        (assign, "$temp_3", 400),
        (try_begin),
          (this_or_next|eq, ":var0", 1),
          (eq, ":var0", 21),
          (val_add, "$temp_3", 100),
          (str_store_string, s3, "@ I have to add one day as it is in a really poor condition."),
        (try_end),
        (item_get_type, ":var1", "$temp_2"),
        (try_begin),
          (eq, ":var1", 13),
          (val_add, "$temp_3", 100),
          (str_store_string, s4, "@ I would need an extra day - armors require more work."),
        (else_try),
          (this_or_next|eq, ":var1", 17),
          (eq, ":var1", 16),
          (val_add, "$temp_3", 300),
          (str_store_string, s5, "@ I am still not too confident working with this new type of weapon and I will have to be very careful."),
        (try_end),
        (assign, "$temp", 1),
        (store_div, reg1, "$temp_3", 100),
        (str_store_item_name, s6, "$temp_2"),
        (str_store_string, s2, "@Your {s6} should be ready within {reg1} days.{s3}{s4}{s5}"),
      (try_end),
    ],
    "{s2}",
    "camp_blacksmith_task_3",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_3",
    [
      (eq, "$temp", 0),
    ],
    "I will speak with you later.",
    "close_window",
    []],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_3",
    [
      (eq, "$temp", 1),
    ],
    "Sounds good to me.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "$temp_2"),
      (store_add, ":var0", "$temp_2", 1),
      (party_set_slot, "p_old_ruins", 262, ":var0"),
      (val_add, "$old_ruins_var", "$temp_3"),
    ]],

  [plyr|trp_old_ruin_camp_blacksmith, "camp_blacksmith_task_3",
    [
      (eq, "$temp", 1),
    ],
    "That is too long. Another time.",
    "close_window",
    []],

  [trp_old_ruin_camp_vet, "start",
    [
      (ge, "$old_ruins_var", 1),
      (store_mod, reg1, "$old_ruins_var", 100),
      (gt, reg1, 0),
      (party_slot_ge, "p_old_ruins", 270, 3),
      (try_begin),
        (str_clear, s2),
        (gt, reg1, 1),
        (str_store_string, s2, "@within {reg1} more days"),
      (else_try),
        (str_store_string, s2, "@within 1 day"),
      (try_end),
    ],
    "The horse is recovering fast, I expect that {s2} it should be fit for a ride.",
    "close_window",
    []],

  [trp_old_ruin_camp_vet, "start",
    [
      (store_mod, ":var0", "$old_ruins_var", 100),
      (eq, ":var0", 0),
      (party_slot_ge, "p_old_ruins", 270, 3),
      (store_free_inventory_capacity, "$temp", "trp_player"),
      (gt, "$temp", 0),
      (party_get_slot, "$temp_2", "p_old_ruins", 270),
      (val_sub, "$temp_2", 2),
      (str_store_item_name, s2, "$temp_2"),
    ],
    "Your {s2} is healthy.",
    "camp_vet_jobdone_1",
    [
      (troop_add_item, "trp_player", "$temp_2", imod_plain),
      (party_set_slot, "p_old_ruins", 270, 2),
    ]],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_jobdone_1",
    [],
    "Looks good to me.",
    "close_window",
    []],

  [trp_old_ruin_camp_vet, "start",
    [
      (store_mod, ":var0", "$old_ruins_var", 100),
      (eq, ":var0", 0),
      (party_slot_ge, "p_old_ruins", 270, 3),
      (eq, "$temp", 0),
    ],
    "Your horse is ready, but your don't have space for it.",
    "close_window",
    []],

  [trp_old_ruin_camp_vet, "start",
    [],
    "What can I do for you?^^^^^(horse from the 1st slot in the main inventory)",
    "camp_vet_task_1",
    []],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_task_1",
    [
      (party_slot_eq, "p_old_ruins", 270, 2),
    ],
    "Could you take a look at this horse?",
    "camp_vet_task_2",
    []],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_task_1",
    [],
    "Nothing right now.",
    "close_window",
    []],

  [trp_old_ruin_camp_vet, "camp_vet_task_2",
    [
      (troop_get_inventory_slot, "$temp_2", "trp_player", 10),
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", 10),
      (str_clear, s2),
      (assign, "$temp", 0),
      (try_begin),
        (lt, "$temp_2", 0),
        (str_store_string, s2, "@What horse are you talking about?"),
      (else_try),
        (ge, "$temp_2", 0),
        (item_get_type, ":var1", "$temp_2"),
        (neq, ":var1", 1),
        (try_begin),
          (party_slot_ge, "p_old_ruins", 262, 1),
          (str_store_string, s2, "@I am busy enough taking care about all these animals. Maybe Harold will be able to help you."),
        (else_try),
          (str_store_string, s2, "@I can help you only with horses. You will have to find someone who can work a forge."),
        (try_end),
      (else_try),
        (ge, "$temp_2", 0),
        (this_or_next|eq, ":var0", 0),
        (this_or_next|eq, ":var0", 18),
        (this_or_next|eq, ":var0", 35),
        (eq, ":var0", 36),
        (str_store_string, s2, "@This animal looks healthy to me. You would need one of the Jatu horse masters to train it further. Problem is they won't work for outsiders."),
      (else_try),
        (ge, "$temp_2", 0),
        (str_clear, s3),
        (str_clear, s4),
        (str_clear, s5),
        (str_clear, s6),
        (assign, "$temp_3", 4),
        (try_begin),
          (eq, ":var0", 31),
          (val_add, "$temp_3", 5),
          (str_store_string, s3, "@ I have to add 5 days as this horse is looking very unwell."),
        (try_end),
        (try_begin),
          (this_or_next|eq, "$temp_2", "itm_jatu_hunter"),
          (this_or_next|eq, "$temp_2", "itm_warhorse_steppe"),
          (this_or_next|eq, "$temp_2", "itm_jatu_warhorse"),
          (eq, "$temp_2", "itm_jatu_warbeast"),
          (try_begin),
            (eq, "$temp_3", 9),
            (val_sub, "$temp_3", 3),
          (else_try),
            (val_sub, "$temp_3", 1),
          (try_end),
          (str_store_string, s4, "@ I have dealt with Jatu horses since I was a child. I have learned few tricks to make them recover faster."),
        (else_try),
          (is_between, "$temp_2", "itm_noldor_pony_horse", "itm_pilgrim_disguise"),
          (val_mul, "$temp_3", 3),
          (str_store_string, s5, "@ This type of mount is new for me and have to deal with it carefully."),
        (try_end),
        (assign, "$temp", 1),
        (store_mod, reg1, "$temp_3", 100),
        (str_store_item_name, s6, "$temp_2"),
        (str_store_string, s2, "@You should be able to ride this {s6} in the next {reg1} days.{s3}{s4}{s5}"),
      (try_end),
    ],
    "{s2}",
    "camp_vet_task_3",
    []],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_task_3",
    [
      (eq, "$temp", 0),
    ],
    "I will speak with you later.",
    "close_window",
    []],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_task_3",
    [
      (eq, "$temp", 1),
    ],
    "Sounds good to me.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "$temp_2"),
      (store_add, ":var0", "$temp_2", 2),
      (party_set_slot, "p_old_ruins", 270, ":var0"),
      (val_add, "$old_ruins_var", "$temp_3"),
    ]],

  [plyr|trp_old_ruin_camp_vet, "camp_vet_task_3",
    [
      (eq, "$temp", 1),
    ],
    "That is too long.",
    "close_window",
    []],

  [trp_old_ruin_camp_guard, "start",
    [
      (eq, "$talk_context", 0),
      (eq, "$current_town", "p_old_ruins"),
      (str_clear, s54),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s54, "@Commander, everything is safe and secured."),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s54, "@Scouts have reported that there are no enemies nearby."),
      (else_try),
        (str_store_string, s54, "@Can't talk. I am on duty, {reg63?sir:madam}."),
      (try_end),
    ],
    "{s54}",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (eq, "$current_town", "p_old_ruins"),
      (str_clear, s54),
      (store_random_in_range, ":var0", 0, 3),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s54, "@We are working hard {reg63?sir:madam}."),
      (else_try),
        (eq, ":var0", 1),
        (str_store_string, s54, "@No time to talk {reg63?sir:madam}."),
      (else_try),
        (str_store_string, s54, "@I better be getting paid for this."),
      (try_end),
    ],
    "{s54}",
    "close_window",
    []],

  [plyr|anyone, "village_elder_talk",
    [
      (call_script, "script_cf_village_recruit_volunteers_cond"),
    ],
    "Are there any lads from this village who might want to seek their fortune in the wars?",
    "village_elder_recruit_start",
    []],

  [plyr|anyone, "village_elder_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "village_elder_buy_cattle",
    [
      (party_get_slot, reg5, "$g_encountered_party", 205),
      (gt, reg5, 0),
      (store_item_value, ":var0", "itm_cattle_meat"),
      (call_script, "script_game_get_item_buy_price_factor", "itm_cattle_meat"),
      (val_mul, ":var0", reg0),
      (val_div, ":var0", 50),
      (assign, "$temp", ":var0"),
      (assign, reg6, ":var0"),
    ],
    "We have {reg5} heads of cattle, each for {reg6} denars. How many do you want to buy?",
    "village_elder_buy_cattle_2",
    []],

  [anyone, "village_elder_buy_cattle",
    [],
    "I am afraid we have no cattle left in the village {reg63?sir:madam}.",
    "village_elder_buy_cattle_2",
    []],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 1),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "One.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 1, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 2),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Two.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 2, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 3),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Three.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 3, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 4),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Four.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 4, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 5),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Five.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 5, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 6),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Six.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 6, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 7),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Seven.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 7, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 8),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Eight.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 8, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 205),
      (ge, ":var0", 9),
      (store_troop_gold, ":var1", "trp_player"),
      (ge, ":var1", "$temp"),
    ],
    "Nine.",
    "village_elder_buy_cattle_complete",
    [
      (call_script, "script_buy_cattle_from_village", "$g_encountered_party", 9, "$temp"),
    ]],

  [plyr|anyone, "village_elder_buy_cattle_2",
    [],
    "Forget it.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_buy_cattle_complete",
    [],
    "I will tell the herders to round up the animals and bring them to you, {reg63?sir:madam}. I am sure you will be satisfied with your purchase.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_recruit_start",
    [
      (party_get_slot, ":var0", "$current_town", 93),
      (party_get_free_companions_capacity, ":var1", "p_main_party"),
      (val_min, ":var0", ":var1"),
      (store_troop_gold, ":var2", "trp_player"),
      (store_div, ":var3", ":var2", 20),
      (val_min, ":var0", ":var3"),
      (le, ":var0", 0),
    ],
    "I don't think anyone would be interested, {reg63?sir:madam}. Is there anything else I can do for you?",
    "village_elder_talk",
    []],

  [anyone, "village_elder_recruit_start",
    [
      (party_get_slot, ":var0", "$current_town", 93),
      (party_get_free_companions_capacity, ":var1", "p_main_party"),
      (val_min, ":var0", ":var1"),
      (store_troop_gold, ":var2", "trp_player"),
      (store_div, ":var3", ":var2", 20),
      (val_min, ":var0", ":var3"),
      (assign, "$temp", ":var0"),
      (assign, reg5, ":var0"),
      (store_add, reg7, ":var0", -1),
    ],
    "I can think of {reg5} whom I suspect would jump at the chance, if you could pay 20 denars {reg7?each for their equipment:for his equipment}. Does that suit you?",
    "village_elder_recruit_decision",
    []],

  [plyr|anyone, "village_elder_recruit_decision",
    [
      (assign, ":var0", "$temp"),
      (ge, ":var0", 1),
      (store_add, reg7, ":var0", -1),
    ],
    "Tell {reg7?them:him} to make ready.",
    "village_elder_pretalk",
    [
      (call_script, "script_village_recruit_volunteers_recruit"),
    ]],

  [plyr|anyone, "village_elder_recruit_decision",
    [
      (party_slot_ge, "$current_town", 93, 1),
    ],
    "No, not now.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_active_mission_1",
    [],
    "Yes {reg63?sir:madam}, have you made any progress on it?",
    "village_elder_active_mission_2",
    []],

  [plyr|anyone, "village_elder_active_mission_2",
    [
      (store_partner_quest, ":var0"),
      (eq, ":var0", "qst_deliver_grain"),
      (quest_get_slot, ":var1", "qst_deliver_grain", 10),
      (call_script, "script_get_troop_item_amount", "trp_player", "itm_grain"),
      (assign, ":var2", reg0),
      (ge, ":var2", ":var1"),
      (assign, reg5, ":var1"),
    ],
    "Indeed. I brought you {reg5} packs of grain.",
    "village_elder_deliver_grain_thank",
    []],

  [anyone, "village_elder_deliver_grain_thank",
    [
      (str_store_party_name, s13, "$current_town"),
    ],
    "My good {reg63?lord:lady}. You have saved us from hunger and desperation. We cannot thank you enough, but you'll always be in our prayers. The village of {s13} will not forget what you have done for us.",
    "village_elder_deliver_grain_thank_2",
    [
      (quest_get_slot, ":var0", "qst_deliver_grain", 10),
      (troop_remove_items, "trp_player", "itm_grain", ":var0"),
      (call_script, "script_change_center_prosperity", "$current_town", 4),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_finish_quest_simple", "qst_deliver_grain", 100),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
    ]],

  [anyone, "village_elder_deliver_grain_thank_2",
    [],
    "My good {reg63?lord:lady}, please, is there anything I can do for you?",
    "village_elder_talk",
    []],

  [plyr|anyone, "village_elder_active_mission_2",
    [],
    "I am still working on it.",
    "village_elder_active_mission_3",
    []],

  [plyr|anyone, "village_elder_active_mission_2",
    [],
    "I am afraid I won't be able to finish it.",
    "village_elder_mission_failed",
    []],

  [anyone, "village_elder_active_mission_3",
    [],
    "Thank you, {reg63?sir:madam}. We are praying for your success everyday.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_mission_failed",
    [],
    "Ah, I am sorry to hear that {reg63?sir:madam}. I'll try to think of something else.",
    "village_elder_pretalk",
    [
      (store_partner_quest, ":var0"),
      (call_script, "script_abort_quest", ":var0", 1),
    ]],

  [anyone, "village_elder_request_mission_ask",
    [
      (store_partner_quest, ":var0"),
      (ge, ":var0", 0),
    ],
    "Well {reg63?sir:madam}, you are already engaged with a task helping us. We cannot ask more from you.",
    "village_elder_pretalk",
    []],

  [anyone, "village_elder_request_mission_ask",
    [
      (troop_slot_eq, "$g_talk_troop", 20, 1),
    ],
    "No {reg63?sir:madam}, We don't have any other tasks for you.",
    "village_elder_pretalk",
    []],

  [auto_proceed|anyone, "village_elder_request_mission_ask",
    [],
    "A task?",
    "village_elder_tell_mission",
    [
      (call_script, "script_get_quest", "$g_talk_troop"),
      (assign, "$random_quest_no", reg0),
    ]],

  [anyone, "village_elder_tell_mission",
    [
      (eq, "$random_quest_no", "qst_deliver_grain"),
    ],
    "{reg63?My good sir:My good lady}, our village has been going through such hardships lately. The harvest has been bad, and recently some merciless bandits took away our seed grain that we had reserved for the planting season. If we cannot find some grain soon, we will not be able to plant our fields and then we will have nothing to eat for the coming year. If you can help us, we would be indebted to you forever.",
    "village_elder_tell_deliver_grain_mission",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s3, ":var0"),
      (quest_get_slot, reg5, "$random_quest_no", 10),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@The elder of the village of {s3} asked you to bring them {reg5} packs of grain."),
    ]],

  [plyr|anyone, "village_elder_tell_deliver_grain_mission",
    [],
    "Hmmm. How much grain do you need?",
    "village_elder_tell_deliver_grain_mission_2",
    []],

  [plyr|anyone, "village_elder_tell_deliver_grain_mission",
    [],
    "I can't be bothered with this. Ask help from someone else.",
    "village_elder_deliver_grain_mission_reject",
    []],

  [anyone, "village_elder_tell_deliver_grain_mission_2",
    [
      (quest_get_slot, reg5, "$random_quest_no", 10),
    ],
    "I think {reg5} packs of grain will let us start the planting. Hopefully, we can find charitable people to help us with the rest.",
    "village_elder_tell_deliver_grain_mission_3",
    []],

  [plyr|anyone, "village_elder_tell_deliver_grain_mission_3",
    [],
    "Then I will go and find you the grain you need.",
    "village_elder_deliver_grain_mission_accept",
    []],

  [plyr|anyone, "village_elder_tell_deliver_grain_mission_3",
    [],
    "I am afraid I don't have time for this. You'll need to find help elsewhere.",
    "village_elder_deliver_grain_mission_reject",
    []],

  [anyone, "village_elder_deliver_grain_mission_accept",
    [],
    "Thank you, {reg63?sir:madam}. We'll be praying for you night and day.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "village_elder_deliver_grain_mission_reject",
    [],
    "Yes {reg63?sir:madam}, of course. I am sorry if I have bothered you with our troubles.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "village_elder_tell_mission",
    [
      (eq, "$random_quest_no", "qst_train_peasants_against_bandits"),
    ],
    "We are suffering greatly at the hands of a group of bandits. They take our food and livestock, and kill anyone who does not obey them immediately. Our men are angry that we cannot defend ourselves, but we are only simple farmers... However, with some help, I think that some of the people here could be more than that. We just need an experienced warrior to teach us how to fight.",
    "village_elder_tell_train_peasants_against_bandits_mission",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s13, ":var0"),
      (quest_get_slot, reg5, "$random_quest_no", 10),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@The elder of the village of {s13} asked you to train {reg5} peasants to fight against local bandits."),
    ]],

  [plyr|anyone, "village_elder_tell_train_peasants_against_bandits_mission",
    [],
    "I can teach you how to defend yourselves.",
    "village_elder_train_peasants_against_bandits_mission_accept",
    []],

  [plyr|anyone, "village_elder_tell_train_peasants_against_bandits_mission",
    [],
    "You peasants have no business taking up arms. Just pay the bandits and be done with it.",
    "village_elder_train_peasants_against_bandits_mission_reject",
    []],

  [anyone, "village_elder_train_peasants_against_bandits_mission_accept",
    [],
    "You will? Oh, splendid! We would be deeply indebted to you, {reg63?sir:madam}. I'll instruct the village folk to assemble here and receive your training. If you can teach us how to defend ourselves, I promise you'll receive everything we can give you in return for your efforts.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "village_elder_train_peasants_against_bandits_mission_reject",
    [],
    "Yes, of course, {reg63?sir:madam}. Thank you for your counsel.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "village_elder_tell_mission",
    [
      (eq, "$random_quest_no", "qst_deliver_cattle"),
    ],
    "Bandits have driven away our cattle, and our pastures are empty. If we had just a few heads of cattle, we could start to raise a herd again.",
    "village_elder_tell_deliver_cattle_mission",
    [
      (quest_get_slot, ":var0", "$random_quest_no", 1),
      (str_store_party_name_link, s3, ":var0"),
      (quest_get_slot, reg5, "$random_quest_no", 10),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@The elder of the village of {s3} asked you to bring them {reg5} heads of cattle."),
    ]],

  [plyr|anyone, "village_elder_tell_deliver_cattle_mission",
    [],
    "How many animals do you need?",
    "village_elder_tell_deliver_cattle_mission_2",
    []],

  [plyr|anyone, "village_elder_tell_deliver_cattle_mission",
    [],
    "I don't have time for this. Ask help from someone else.",
    "village_elder_deliver_cattle_mission_reject",
    []],

  [anyone, "village_elder_tell_deliver_cattle_mission_2",
    [
      (quest_get_slot, reg5, "$random_quest_no", 10),
    ],
    "I think {reg5} heads will suffice for a small herd.",
    "village_elder_tell_deliver_cattle_mission_3",
    []],

  [plyr|anyone, "village_elder_tell_deliver_cattle_mission_3",
    [],
    "Then I will bring you the cattle you need.",
    "village_elder_deliver_cattle_mission_accept",
    []],

  [plyr|anyone, "village_elder_tell_deliver_cattle_mission_3",
    [],
    "I am afraid I don't have time for this. You'll need to find help elsewhere.",
    "village_elder_deliver_cattle_mission_reject",
    []],

  [anyone, "village_elder_deliver_cattle_mission_accept",
    [],
    "Thank you, {reg63?sir:madam}. We'll be praying for you night and day.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "village_elder_deliver_cattle_mission_reject",
    [],
    "Yes {reg63?sir:madam}, of course. I am sorry if I have bothered you with our troubles.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "village_elder_tell_mission",
    [
      (eq, "$random_quest_no", "qst_rescue_daughter"),
    ],
    "My good {reg63?sir:madam}, a terrible shame has befallen my humble household.^Not that long ago, the devious {s5} raided our village. We fled for the hills, but {s5}'s soldiers caught up with my youngest daughter and carried her away.^I fear her chastity will soon be taken and she will no longer be a daughter of mine. Oh, the shame!^Please, is there anything you could do to help a poor father?",
    "village_elder_tell_rescue_daughter_mission",
    [
      (str_store_party_name_link, s3, "$current_town"),
      (quest_get_slot, ":var0", "$random_quest_no", 2),
      (str_store_troop_name_link, s5, ":var0"),
      (setup_quest_text, "$random_quest_no"),
      (str_store_string, s2, "@The elder of the village of {s3} asked you to rescue his daughter from the clutches of {s5}."),
    ]],

  [plyr|anyone, "village_elder_tell_rescue_daughter_mission",
    [],
    "I am willing to help.",
    "village_elder_rescue_daughter_mission_accept",
    []],

  [plyr|anyone, "village_elder_tell_rescue_daughter_mission",
    [],
    "I don't have time for this. It is probably too late anyway.",
    "village_elder_deliver_rescue_daughter_reject",
    []],

  [anyone, "village_elder_rescue_daughter_mission_accept",
    [],
    "Thank you, {reg63?sir:madam}! If I may suggest, please make haste, I fear she may soon meet a fate worse than death.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_start_quest", "$random_quest_no", "$g_talk_troop"),
    ]],

  [anyone, "village_elder_deliver_rescue_daughter_reject",
    [],
    "Yes {reg63?sir:madam}, perhaps it is best to forget. I suppose I'll need to look after my other daughters now. Oh, the misfortune.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "village_elder_tell_mission",
    [
      (eq, "$random_quest_no", "qst_escort_peasants"),
    ],
    "Hello, good {reg63?sir:madam}, I hope you find trading with our village to your satisfaction. Now, we usually get a fair price on the {s4} market, but lately the town merchants are trying to drive us out by offering cheaper goods of inferior quality.^As a village elder, I can't allow this to continue. I'm sending a trading party to the town of {s3}, so we will not go hungry, until the local merchants come to their senses or run out of cheap goods.^Would you consider making sure our villagers arrive there safely?",
    "village_elder_tell_escort_peasants_mission",
    [
      (quest_get_slot, ":var0", "qst_escort_peasants", 1),
      (str_store_party_name_link, s3, ":var0"),
      (party_get_slot, ":var1", "$current_town", 121),
      (str_store_party_name, s4, ":var1"),
      (str_store_party_name_link, s5, "$current_town"),
      (setup_quest_text, "qst_escort_peasants"),
      (str_store_string, s2, "@The elder of the village of {s5} asked you to escort a trading party to {s3}."),
    ]],

  [plyr|anyone, "village_elder_tell_escort_peasants_mission",
    [],
    "I can escort your villagers.",
    "village_elder_escort_peasants_mission_accept",
    []],

  [plyr|anyone, "village_elder_tell_escort_peasants_mission",
    [],
    "I don't have time for guarding villagers.",
    "village_elder_deliver_escort_peasants_reject",
    []],

  [anyone, "village_elder_escort_peasants_mission_accept",
    [],
    "Thank you, {reg63?sir:madam}. Our trading party will start its journey shortly. Please keep them safe.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_start_quest", "qst_escort_peasants", "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_escort_peasants", 1),
      (set_spawn_radius, 0),
      (spawn_around_party, "$current_town", "pt_village_farmers"),
      (assign, ":var1", reg0),
      (quest_set_slot, "qst_escort_peasants", 8, ":var1"),
      (quest_set_slot, "qst_escort_peasants", 11, 0),
      (str_store_party_name, s1, "$current_town"),
      (party_set_name, ":var1", "@{s1} Trading Party"),
      (party_set_faction, ":var1", "$g_encountered_party_faction"),
      (party_set_slot, ":var1", 123, "$current_town"),
      (party_set_slot, ":var1", 126, "$current_town"),
      (party_set_slot, ":var1", 4, 13),
      (party_set_slot, ":var1", 5, ":var0"),
      (party_set_ai_behavior, ":var1", ai_bhvr_travel_to_party),
      (party_set_ai_object, ":var1", ":var0"),
      (party_set_flags, ":var1", 65536, 0),
      (store_sub, ":var2", 301, "itm_spice"),
      (try_for_range, ":var3", "itm_spice", "itm_baggage_train"),
        (store_add, ":var4", ":var3", ":var2"),
        (party_get_slot, ":var5", "$current_town", ":var4"),
        (party_set_slot, ":var1", ":var4", ":var5"),
      (try_end),
      (spawn_around_party, ":var0", "pt_red_brotherhood"),
      (assign, ":var6", reg0),
      (party_set_name, ":var6", "@Red Brotherhood Ambush Party"),
      (party_set_ai_behavior, ":var6", ai_bhvr_attack_party),
      (party_set_ai_object, ":var6", ":var1"),
      (party_set_flags, ":var6", 65536, 0),
      (store_character_level, ":var7", "trp_player"),
      (val_div, ":var7", 10),
      (try_for_range, ":var8", 0, ":var7"),
        (party_add_template, ":var6", "pt_red_brotherhood"),
      (try_end),
    ]],

  [anyone, "village_elder_deliver_escort_peasants_reject",
    [],
    "Yes {reg63?sir:madam}, I am sorry to have bothered you.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 20, 1),
    ]],

  [anyone, "village_elder_tell_mission",
    [],
    "Thank you, {reg63?sir:madam}, but we do not really need anything right now.",
    "village_elder_pretalk",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_merchant", "trp_town_1_horse_merchant"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "{reg63?My lord:my lady}, you honor my humble shop with your presence.",
    "goods_merchant_talk",
    [
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_town_1_merchant", "trp_town_1_horse_merchant"),
    ],
    "Welcome {reg63?sir:madam}. What can I do for you?",
    "goods_merchant_talk",
    [
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [anyone, "goods_merchant_pretalk",
    [],
    "Anything else?",
    "goods_merchant_talk",
    []],

  [plyr|anyone, "goods_merchant_talk",
    [],
    "I want to buy a few items... and perhaps sell some.",
    "goods_trade_requested",
    []],

  [anyone, "goods_trade_requested",
    [],
    "Sure, sure... Here, have a look at my stock...",
    "goods_trade_completed",
    [
      (change_screen_trade),
    ]],

  [anyone, "goods_trade_completed",
    [],
    "Anything else?",
    "goods_merchant_talk",
    []],

  [plyr|anyone, "goods_merchant_talk",
    [],
    "What goods should I buy here to trade with other towns?",
    "trade_info_request",
    []],

  [plyr|anyone, "goods_merchant_talk",
    [],
    "Nothing. Thanks.",
    "close_window",
    []],

  [anyone, "trade_info_request",
    [],
    "That information can be best obtained from caravan masters and travelling merchants. If you want I can send you to the district where foreign merchants stay at when they come to the town. If you spend some time there and listen to the talk, you can learn a lot about what to buy and where to sell it.",
    "trade_info_request_2",
    []],

  [plyr|anyone, "trade_info_request_2",
    [],
    "Then I'll go and spend some time with these merchants.",
    "close_window",
    [
      (jump_to_menu, "mnu_town_trade_assessment_begin"),
      (finish_mission),
    ]],

  [plyr|anyone, "trade_info_request_2",
    [],
    "I have no time for this right now.",
    "goods_merchant_pretalk",
    []],

  [anyone, "start",
    [
      (store_conversation_troop, reg1),
      (is_between, reg1, "trp_town_1_arena_master", "trp_town_1_armorer"),
      (assign, "$arena_reward_asked", 0),
      (assign, "$arena_tournaments_asked", 0),
      (eq, 1, 0),
    ],
    "{!}.",
    "arena_intro_1",
    []],

  [anyone, "start",
    [
      (store_conversation_troop, reg1),
      (is_between, reg1, "trp_town_1_arena_master", "trp_town_1_armorer"),
      (eq, "$arena_master_first_talk", 0),
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ],
    "Good day, friend. If you came to watch the tournaments, you came in vain. There won't be a tournament here anytime soon.",
    "arena_intro_1",
    [
      (assign, "$arena_master_first_talk", 1),
    ]],

  [plyr|anyone, "arena_intro_1",
    [],
    "Tournaments? So they hold the tournaments here...",
    "arena_intro_2",
    []],

  [anyone, "arena_intro_2",
    [],
    "Yes, but only distinguished fighters can join. You should see this place during one of the tournament fights. Everyone from the town and nearby villages comes here. The crowd becomes mad with excitement. Anyway, as I said, there won't be an event here soon, so there isn't much to see. Except, there is an official duel every now and then, and  of course we have melee fights almost every day.",
    "arena_intro_3",
    []],

  [plyr|anyone, "arena_intro_3",
    [],
    "Tell me about the melee fights.",
    "arena_training_melee_intro",
    []],

  [anyone, "arena_training_melee_intro",
    [],
    "The fighters and knights get bored waiting for the next tournament, so they have invented the training melee. It is a simple idea really. Fighters jump into the arena with a weapon. There are no rules, no teams. Everyone beats at each other until there is only one fighter left standing. Sounds like fun, eh?",
    "arena_training_melee_intro_2",
    []],

  [plyr|anyone, "arena_training_melee_intro_2",
    [
      (eq, "$arena_reward_asked", 0),
    ],
    "Is there a reward?",
    "arena_training_melee_intro_reward",
    [
      (assign, "$arena_reward_asked", 1),
    ]],

  [anyone, "arena_training_melee_intro_reward",
    [
      (assign, reg1, 3),
      (assign, reg11, 50),
      (assign, reg2, 6),
      (assign, reg12, 100),
      (assign, reg3, 10),
      (assign, reg13, 200),
      (assign, reg4, 20),
      (assign, reg14, 500),
      (assign, reg15, 2000),
    ],
    "There is, actually. Some of the wealthy townsmen offer prizes for those fighters who show great skill in the fights. If you can beat {reg1} opponents before going down, you'll earn {reg11} denars. You'll get {reg12} denars for striking down at least {reg2} opponents, {reg13} denars if you can defeat {reg3} opponents, and {reg14} denars if you can survive long enough to beat {reg4} opponents. If you can manage to be the last {reg63?man:fighter} standing, you'll earn the great prize of the fights, {reg15} denars. Sounds good, eh?",
    "arena_training_melee_intro_2",
    [
      (assign, "$arena_tournaments_asked", 1),
    ]],

  [anyone, "arena_training_melee_explain_reward",
    [
      (assign, reg1, 3),
      (assign, reg11, 50),
      (assign, reg2, 6),
      (assign, reg12, 100),
      (assign, reg3, 10),
      (assign, reg13, 200),
      (assign, reg4, 20),
      (assign, reg14, 500),
      (assign, reg15, 2000),
    ],
    "Some of the wealthy townsmen offer prizes for those fighters who show great skill in the fights. If you can beat {reg1} opponents before going down, you'll earn {reg11} denars. You'll get {reg12} denars for striking down at least {reg2} opponents, {reg13} denars if you can defeat {reg3} opponents, and {reg14} denars if you can survive long enough to beat {reg4} opponents. If you can manage to be the last {reg63?man:fighter} standing, you'll earn the great prize of the fights, {reg15} denars. Sounds good, eh?",
    "arena_master_melee_pretalk",
    []],

  [plyr|anyone, "arena_training_melee_intro_2",
    [],
    "Can I join too?",
    "arena_training_melee_intro_3",
    []],

  [anyone, "arena_training_melee_intro_3",
    [],
    "Ha ha. You would have to be out of your mind not to. Of course. The melee fights are open to all. Actually there is going to be a fight soon. You can go and hop in if you want to.",
    "arena_master_melee_talk",
    []],

  [anyone, "start",
    [
      (store_conversation_troop, reg1),
      (is_between, reg1, "trp_town_1_arena_master", "trp_town_1_armorer"),
      (eq, "$g_talk_troop_met", 0),
    ],
    "Hello. You seem to be new here. Care to share your name?",
    "arena_master_intro_1",
    []],

  [plyr|anyone, "arena_master_intro_1",
    [],
    "I am {playername}.",
    "arena_master_intro_2",
    []],

  [anyone, "arena_master_intro_2",
    [
      (store_encountered_party, reg2),
      (str_store_party_name, s1, reg2),
    ],
    "Well met {playername}. I am the master of the tournaments here at {s1}. Talk to me if you want to join the fights.",
    "arena_master_pre_talk",
    []],

  [auto_proceed|anyone, "start",
    [
      (store_conversation_troop, reg1),
      (is_between, reg1, "trp_town_1_arena_master", "trp_town_1_armorer"),
      (eq, "$last_training_fight_town", "$current_town"),
      (store_current_hours, ":var0"),
      (val_add, ":var0", -4),
      (lt, ":var0", "$training_fight_time"),
    ],
    ".",
    "arena_master_fight_result",
    [
      (assign, "$arena_reward_asked", 0),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (eq, "$g_arena_training_kills", 0),
    ],
    "Ha-ha, that's quite the bruise you're sporting. But don't worry; everybody gets trounced once in awhile. The important thing is to pick yourself up, dust yourself off and keep fighting. That's what champions do.",
    "arena_master_pre_talk",
    [
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (lt, "$g_arena_training_kills", 3),
      (assign, reg8, "$g_arena_training_kills"),
    ],
    "Hey, you managed to take down {reg8} opponents. Not bad. But that won't bring you any prize money. Now, if I were you, I would go back there and show everyone what I can do...",
    "arena_master_pre_talk",
    [
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (lt, "$g_arena_training_kills", 6),
      (assign, reg8, "$g_arena_training_kills"),
      (assign, reg10, 50),
    ],
    "You put up quite a good fight there. Good moves. You definitely show promise. And you earned a prize of {reg10} denars for knocking down {reg8} opponents.",
    "arena_master_pre_talk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 50),
      (add_xp_to_troop, 5, "trp_player"),
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (lt, "$g_arena_training_kills", 10),
      (assign, reg8, "$g_arena_training_kills"),
      (assign, reg10, 100),
      (assign, reg12, 6),
    ],
    "That was a good fight you put up there. You managed to take down no less than {reg8} opponents. And of course, you earned a prize money of {reg10} denars.",
    "arena_master_pre_talk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 100),
      (add_xp_to_troop, 10, "trp_player"),
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (lt, "$g_arena_training_kills", 20),
      (assign, reg8, "$g_arena_training_kills"),
      (assign, reg10, 200),
    ],
    "Your performance was amazing! You are without doubt a very skilled fighter. Not everyone can knock down {reg8} people in the fights. Of course you deserve a prize with that performance: {reg10} denars. Nice, eh?",
    "arena_master_pre_talk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 200),
      (add_xp_to_troop, 10, "trp_player"),
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (eq, "$g_arena_training_won", 0),
      (assign, reg8, "$g_arena_training_kills"),
      (assign, reg10, 500),
    ],
    "That was damned good fighting, {playername}. You have very good moves, excellent tactics. And you earned a prize of {reg10} denars for knocking down {reg8} opponents.",
    "arena_master_pre_talk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 500),
      (add_xp_to_troop, 10, "trp_player"),
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "arena_master_fight_result",
    [
      (assign, reg10, 2000),
    ],
    "Congratulations, champion! Your fight there was something to remember! You managed to be the last fighter standing beating down everyone else. And of course you won the grand prize of the fights: {reg10} denars.",
    "arena_master_pre_talk",
    [
      (call_script, "script_troop_add_gold", "trp_player", 2000),
      (add_xp_to_troop, 200, "trp_player"),
      (assign, "$last_training_fight_town", -1),
    ]],

  [anyone, "start",
    [
      (store_conversation_troop, reg1),
      (is_between, reg1, "trp_town_1_arena_master", "trp_town_1_armorer"),
    ],
    "Hello {playername}. Good to see you again.",
    "arena_master_pre_talk",
    [
      (assign, "$arena_reward_asked", 0),
    ]],

  [anyone, "arena_master_pre_talk",
    [],
    "What would you like to do?",
    "arena_master_talk",
    []],

  [plyr|anyone, "arena_master_talk",
    [],
    "About the melee fights...",
    "arena_master_melee_pretalk",
    []],

  [plyr|anyone, "arena_master_talk",
    [
      (eq, "$arena_tournaments_asked", 0),
    ],
    "Will there be a tournament in nearby towns soon?",
    "arena_master_ask_tournaments",
    [
      (assign, "$arena_tournaments_asked", 1),
    ]],

  [plyr|anyone, "arena_master_talk",
    [],
    "I need to leave now. Goodbye.",
    "close_window",
    []],

  [anyone, "arena_master_ask_tournaments",
    [],
    "{reg2?There won't be any tournaments any time soon.:{reg1?Tournaments are:A tournament is} going to be held at {s15}.}",
    "arena_master_talk",
    [
      (assign, ":var0", 0),
      (try_for_range_backwards, ":var1", "p_town_1", "p_castle_1"),
        (party_slot_ge, ":var1", 156, 1),
        (val_add, ":var0", 1),
        (try_begin),
          (eq, ":var0", 1),
          (str_store_party_name, s15, ":var1"),
        (else_try),
          (str_store_party_name, s16, ":var1"),
          (eq, ":var0", 2),
          (str_store_string, s15, "@{s16} and {s15}"),
        (else_try),
          (str_store_string, s15, "@{!}{s16}, {s15}"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (assign, reg2, 1),
      (else_try),
        (assign, reg2, 0),
        (store_sub, reg1, ":var0", 1),
      (try_end),
    ]],

  [anyone, "arena_master_melee_pretalk",
    [],
    "There will be a fight here soon. You can go and jump in if you like.",
    "arena_master_melee_talk",
    []],

  [plyr|anyone, "arena_master_melee_talk",
    [],
    "Good. That's what I am going to do.",
    "close_window",
    [
      (assign, "$last_training_fight_town", "$current_town"),
      (store_current_hours, "$training_fight_time"),
      (assign, "$g_mt_mode", 1),
      (party_get_slot, ":var0", "$current_town", 16),
      (modify_visitors_at_site, ":var0"),
      (reset_visitors),
      (store_random_in_range, "$g_player_entry_point", 32, 40),
      (set_visitor, "$g_player_entry_point", "trp_player"),
      (set_jump_mission, "mt_arena_melee_fight"),
      (jump_to_scene, ":var0"),
    ]],

  [plyr|anyone, "arena_master_melee_talk",
    [],
    "Thanks. But I will give my bruises some time to heal.",
    "arena_master_melee_reject",
    []],

  [anyone, "arena_master_melee_reject",
    [],
    "Good {reg63?man:girl}. That's clever of you.",
    "arena_master_pre_talk",
    []],

  [plyr|anyone, "arena_master_melee_talk",
    [
      (eq, "$arena_reward_asked", 0),
    ],
    "Actually, can you tell me about the rewards again?",
    "arena_training_melee_explain_reward",
    [
      (assign, "$arena_reward_asked", 1),
    ]],

  [trp_galeas, "start",
    [],
    "Hello {reg63?boy:girl}. If you have any prisoners, I will be happy to buy them from you.",
    "galeas_talk",
    []],

  [plyr|trp_galeas, "galeas_talk",
    [
      (store_num_regular_prisoners, reg0),
      (ge, reg0, 1),
    ],
    "Then you'd better bring your purse. I have got prisoners to sell.",
    "galeas_sell_prisoners",
    []],

  [plyr|trp_galeas, "galeas_talk",
    [],
    "Not this time. Good-bye.",
    "close_window",
    []],

  [trp_galeas, "galeas_sell_prisoners",
    [],
    "Let me see what you have...",
    "galeas_sell_prisoners_2",
    [
      (change_screen_trade_prisoners),
    ]],

  [trp_galeas, "galeas_sell_prisoners_2",
    [],
    "You take more prisoners, bring them to me. I will pay well.",
    "close_window",
    []],

  [party_tpl|auto_proceed|pt_mountain_bandits, "start",
    [
      (eq, "$talk_context", 2),
      (encountered_party_is_attacker),
    ],
    "{!}Warning: This line should never display.",
    "bandit_introduce",
    []],

  [party_tpl|auto_proceed|pt_forest_bandits, "start",
    [
      (eq, "$talk_context", 2),
      (encountered_party_is_attacker),
    ],
    "{!}Warning: This line should never display.",
    "bandit_introduce",
    []],

  [anyone, "bandit_introduce",
    [
      (store_random_in_range, ":var0", 11, 15),
      (str_store_string, s11, "@I can smell a fat purse a mile away. Methinks yours could do with some lightening, eh?"),
      (str_store_string, s12, "@Why, it be another traveller, chance met upon the road! I should warn you, country here's a mite dangerous for a good {reg63?fellow:woman} like you. But for a small donation my boys and I'll make sure you get rightways to your destination, eh?"),
      (str_store_string, s13, "@Well well, look at this! You'd best start coughing up some silver, friend, or me and my boys'll have to break you."),
      (str_store_string, s14, "@There's a toll for passin' through this land, payable to us, so if you don't mind we'll just be collectin' our due from your purse..."),
      (str_store_string_reg, s5, ":var0"),
    ],
    "{s5}",
    "bandit_talk",
    [
      (play_sound, "snd_encounter_bandits"),
    ]],

  [plyr|anyone, "bandit_talk",
    [],
    "I'll give you nothing but cold steel, you scum!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [plyr|anyone, "bandit_talk",
    [],
    "There's no need to fight. I can pay for free passage.",
    "bandit_barter",
    []],

  [anyone, "bandit_barter",
    [
      (store_relation, ":var0", "fac_player_faction", "$g_encountered_party_faction"),
      (ge, ":var0", -50),
      (store_troop_gold, ":var1", "trp_player"),
      (troop_get_inventory_capacity, ":var2", "trp_player"),
      (try_for_range, ":var3", 0, ":var2"),
        (troop_get_inventory_slot, ":var4", "trp_player", ":var3"),
        (ge, ":var4", 0),
        (try_begin),
          (is_between, ":var4", "itm_spice", "itm_baggage_train"),
          (store_item_value, ":var5", ":var4"),
          (val_add, ":var1", ":var5"),
        (try_end),
      (try_end),
      (store_div, "$bandit_tribute", ":var1", 10),
      (val_max, "$bandit_tribute", 10),
      (assign, reg5, "$bandit_tribute"),
    ],
    "Silver without blood, that's our favourite kind! Hmm, having a look at you, I reckon you could easily come up with {reg5} denars. Pay it, and we'll let you be on your way.",
    "bandit_barter_2",
    []],

  [plyr|anyone, "bandit_barter_2",
    [
      (store_troop_gold, reg2),
      (ge, reg2, "$bandit_tribute"),
      (assign, reg5, "$bandit_tribute"),
    ],
    "Very well, take it.",
    "bandit_barter_3a",
    [
      (troop_remove_gold, "trp_player", "$bandit_tribute"),
    ]],

  [plyr|anyone, "bandit_barter_2",
    [],
    "I don't have that much money with me",
    "bandit_barter_3b",
    []],

  [anyone, "bandit_barter_3b",
    [],
    "That's too bad. I guess we'll just have to sell you into slavery. Take {reg63?him:her}, lads!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [anyone, "bandit_barter",
    [],
    "Hey, I've heard of you! You slaughter us freebooters like dogs, and now you expect us to let you go for a few stinking coins? Forget it. You gave us no quarter, and you'll get none from us.",
    "close_window",
    []],

  [anyone, "bandit_barter_3a",
    [],
    "Heh, that wasn't so hard, was it? All right, we'll let you go now. Be off.",
    "close_window",
    [
      (store_current_hours, ":var0"),
      (val_add, ":var0", 72),
      (party_set_slot, "$g_encountered_party", 3, ":var0"),
      (party_ignore_player, "$g_encountered_party", 72),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "start",
    [
      (this_or_next|eq, "$g_encountered_party_template", "pt_mountain_bandits"),
      (eq, "$g_encountered_party_template", "pt_forest_bandits"),
    ],
    "Eh? What is it?",
    "bandit_meet",
    []],

  [plyr|anyone, "bandit_meet",
    [],
    "Your luck has run out, wretch. Prepare to die!",
    "bandit_attack",
    [
      (store_relation, ":var0", "fac_player_faction", "$g_encountered_party_faction"),
      (val_sub, ":var0", 3),
      (val_max, ":var0", -100),
      (set_relation, "fac_player_faction", "$g_encountered_party_faction", ":var0"),
      (party_ignore_player, "$g_encountered_party", 0),
      (party_set_slot, "$g_encountered_party", 3, 0),
    ]],

  [anyone, "bandit_attack",
    [
      (store_random_in_range, ":var0", 11, 15),
      (str_store_string, s11, "@Another fool come to throw {reg63?him:her}self on my weapon, eh? Fine..let us draw blood!"),
      (str_store_string, s12, "@We're not afraid of you, {reg63?sirrah:wench}. Time to bust some heads!"),
      (str_store_string, s13, "@That was a mistake. Now I'm going to have to make your death long and painful."),
      (str_store_string, s14, "@Brave words. Let's see you back them up with deeds, cur!"),
      (str_store_string_reg, s5, ":var0"),
      (str_store_string, s3, "@Bandits like you never live long enough to learn!"),
    ],
    "{s5}",
    "companion_comment",
    [
      (assign, "$random_companion", 0),
    ]],

  [plyr|anyone, "bandit_meet",
    [],
    "Never mind, I have no business with you.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_rescued_prisoners, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "Do you want us to follow you?",
    "disbanded_troop_ask",
    []],

  [plyr|anyone, "disbanded_troop_ask",
    [],
    "Yes, let us ride together.",
    "disbanded_troop_join",
    []],

  [plyr|anyone, "disbanded_troop_ask",
    [],
    "No, not at this time.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "disbanded_troop_join",
    [
      (neg|party_can_join),
    ],
    "Unfortunately, you do not have room in your party for us.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "disbanded_troop_join",
    [],
    "We are at your command.",
    "close_window",
    [
      (party_join),
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_enemy, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "You will not capture me again. Not this time.",
    "enemy_talk_1",
    []],

  [plyr|party_tpl|pt_enemy, "enemy_talk_1",
    [],
    "You don't have a chance against me. Give up.",
    "enemy_talk_2",
    []],

  [party_tpl|pt_enemy, "enemy_talk_2",
    [],
    "I will give up when you are dead!",
    "close_window",
    [
      (encounter_attack),
    ]],

  [party_tpl|pt_routed_warriors, "start",
    [
      (eq, "$talk_context", 2),
    ],
    "I beg you, please leave us alone.",
    "party_encounter_routed_agents_are_caught",
    []],

  [plyr|party_tpl|pt_routed_warriors, "party_encounter_routed_agents_are_caught",
    [],
    "Do you think you can run away from me? You will be my prisoner or die!",
    "party_encounter_routed_agents_are_caught2",
    []],

  [plyr|party_tpl|pt_routed_warriors, "party_encounter_routed_agents_are_caught",
    [],
    "Ok. We'll leave you in peace for this time, do not face with us again.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [party_tpl|pt_routed_warriors, "party_encounter_routed_agents_are_caught2",
    [
      (assign, ":var0", 0),
      (party_get_num_companion_stacks, ":var1", "$g_encountered_party"),
      (try_for_range, ":var2", 0, ":var1"),
        (party_stack_get_troop_id, ":var3", "$g_encountered_party", ":var2"),
        (store_character_level, ":var4", ":var3"),
        (try_begin),
          (troop_is_mounted, ":var3"),
          (val_add, ":var4", 5),
        (try_end),
        (party_stack_get_size, ":var5", "$g_encountered_party", ":var2"),
        (val_mul, ":var4", ":var5"),
        (val_add, ":var0", ":var4"),
      (try_end),
      (assign, ":var6", 0),
      (party_get_num_companion_stacks, ":var1", "p_main_party"),
      (try_for_range, ":var2", 0, ":var1"),
        (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
        (store_character_level, ":var4", ":var3"),
        (try_begin),
          (troop_is_mounted, ":var3"),
          (val_add, ":var4", 5),
        (try_end),
        (party_stack_get_size, ":var5", "p_main_party", ":var2"),
        (val_mul, ":var4", ":var5"),
        (val_add, ":var6", ":var4"),
      (try_end),
      (store_div, ":var7", ":var6", 5),
      (party_get_num_attached_parties, ":var8", "$g_encountered_party"),
      (this_or_next|gt, ":var8", 0),
      (ge, ":var0", ":var7"),
    ],
    "Haven't you got any mercy? Ok, we will fight you to the last man!",
    "close_window",
    []],

  [party_tpl|pt_routed_warriors, "party_encounter_routed_agents_are_caught2",
    [
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (party_get_num_companion_stacks, ":var2", "$g_encountered_party"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_stack_get_troop_id, ":var4", "$g_encountered_party", ":var3"),
        (store_character_level, ":var5", ":var4"),
        (try_begin),
          (troop_is_mounted, ":var4"),
          (val_add, ":var5", 5),
        (try_end),
        (party_stack_get_size, ":var6", "$g_encountered_party", ":var3"),
        (val_mul, ":var5", ":var6"),
        (val_add, ":var1", ":var5"),
        (val_add, ":var0", ":var6"),
      (try_end),
      (assign, ":var7", 0),
      (party_get_num_companion_stacks, ":var2", "p_main_party"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
        (store_character_level, ":var5", ":var4"),
        (try_begin),
          (troop_is_mounted, ":var4"),
          (val_add, ":var5", 5),
        (try_end),
        (party_stack_get_size, ":var6", "p_main_party", ":var3"),
        (val_mul, ":var5", ":var6"),
        (val_add, ":var7", ":var5"),
      (try_end),
      (store_div, ":var8", ":var7", 5),
      (lt, ":var1", ":var8"),
      (store_party_size_wo_prisoners, ":var9", "$g_encountered_party"),
      (assign, reg3, ":var9"),
      (try_begin),
        (gt, ":var0", 1),
        (str_store_string, s1, "str_we_resign"),
      (else_try),
        (str_store_string, s1, "str_i_resign"),
      (try_end),
    ],
    "{s1}",
    "close_window",
    [
      (assign, "$g_enemy_surrenders", 1),
      (call_script, "script_party_wound_all_members", "$g_encountered_party"),
      (call_script, "script_party_copy", "p_total_enemy_casualties", "$g_encountered_party"),
    ]],

  [plyr|anyone, "prisoner_chat",
    [
      (store_free_inventory_capacity, "$temp"),
    ],
    "You are my prisoner, do not try running away or doing anything foolish.",
    "prisoner_chat_2",
    []],

  [anyone, "prisoner_chat_2",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (str_store_troop_name, s43, "$g_talk_troop"),
      (is_between, "$g_talk_troop", "trp_hero_burilgi", "trp_omen_seeker"),
    ],
    "I am your prisoner, {reg63?Lord:Lady} {playername}. Do you wish to taunt me now?",
    "prisoner_chat_sig",
    []],

  [plyr|anyone, "prisoner_chat_sig",
    [],
    "Well {s43}, that is an interesting idea.",
    "prisoner_chat_sig2",
    []],

  [anyone, "prisoner_chat_sig2",
    [
      (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
    ],
    "It is true that you have defeated me. I would seek my freedom, as my followers can ransom me.^I can offer you diamonds^or perhaps... a gem... a Qualis gem of extraordinary value.^I can give you my sword or armor and word of honor that I shall not take up arms again should you grant my freedom.",
    "prisoner_chat_sig3",
    []],

  [anyone, "prisoner_chat_sig2",
    [
      (eq, "$g_talk_troop", "trp_hero_maltise"),
    ],
    "It is true that you have defeated me. I would seek my freedom, as my followers can ransom me.^I can offer you diamonds^or perhaps... a gem... a Qualis gem of extraordinary value.^Or, I can give you my armor set and word of honor that I shall not take up arms again should you grant my freedom.",
    "prisoner_chat_sig3",
    []],

  [anyone, "prisoner_chat_sig2",
    [
      (eq, "$g_talk_troop", "trp_hero_aeldarian"),
    ],
    "It is true that you have defeated me. I would seek my freedom, as my followers can ransom me.^I can offer you diamonds^or perhaps... a gem... a Qualis gem of extraordinary value.^I can give you my bow or armor and word of honor that I shall not take up arms again should you grant my freedom.",
    "prisoner_chat_sig3",
    []],

  [anyone, "prisoner_chat_sig2",
    [
      (is_between, "$g_talk_troop", "trp_hero_burilgi", "trp_omen_seeker"),
    ],
    "It is true that you have defeated me. I would seek my freedom, as my followers can ransom me.^I can offer you diamonds^or perhaps... a gem... a Qualis gem of extraordinary value.^Or, I can give you my word of honor that I shall not take up arms again should you grant my freedom.",
    "prisoner_chat_sig3",
    []],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (gt, "$temp", 0),
    ],
    "Very well, I will accept a pile of diamonds. You are free to go.",
    "prisoner_chat_threat",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (troop_add_item, "trp_player", "itm_diamond_large"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_hero_kjuda"),
        (item_slot_eq, "itm_warhorse_steppe", 65, 0),
        (call_script, "script_unlock_item_for_custom_troops", "itm_warhorse_steppe"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_strange_sword"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_zulkar"),
        (item_slot_eq, "itm_jatu_arrows", 65, 0),
        (call_script, "script_unlock_item_for_custom_troops", "itm_jatu_arrows"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_jatu_warbeast"),
      (try_end),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (eq, "$temp", 0),
    ],
    "A pile of diamonds sounds good, but my inventory is full.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (gt, "$temp", 0),
    ],
    "Excellent. I will accept your Qualis gem for your freedom.",
    "prisoner_chat_threat",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (troop_add_item, "trp_player", "itm_qualis", imod_plain),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (eq, "$temp", 0),
    ],
    "I'm interested in your Qualis gem, but my inventory is full.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (neq, "$g_talk_troop", "trp_hero_aeldarian"),
      (neq, "$g_talk_troop", "trp_hero_ithilrandir"),
      (neq, "$g_talk_troop", "trp_hero_maltise"),
    ],
    "You should return to your homeland and not take up arms ever again.",
    "prisoner_chat_threat_retire",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_signature_repression_for_death_and_defeat", "$g_talk_troop"),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (this_or_next|eq, "$g_talk_troop", "trp_hero_aeldarian"),
      (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
      (ge, "$temp", 1),
    ],
    "You can return to your homeland, but first handle me your weapon.",
    "prisoner_chat_threat_retire",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_signature_repression_for_death_and_defeat", "$g_talk_troop"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
        (troop_add_item, "trp_player", "itm_havathang"),
        (troop_add_item, "trp_hero_ithilrandir", "itm_noldor_bastard"),
      (try_end),
      (try_begin),
        (eq, "$g_talk_troop", "trp_hero_aeldarian"),
        (troop_add_item, "trp_player", "itm_duskfall_bow"),
        (troop_add_item, "trp_hero_aeldarian", "itm_noldor_bow"),
      (try_end),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 10),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (this_or_next|eq, "$g_talk_troop", "trp_hero_aeldarian"),
      (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
      (ge, "$temp", 1),
    ],
    "I will accept your armor.",
    "prisoner_chat_threat_retire",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_signature_repression_for_death_and_defeat", "$g_talk_troop"),
      (troop_add_item, "trp_player", "itm_rune_plate_strange"),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 10),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (this_or_next|eq, "$g_talk_troop", "trp_hero_aeldarian"),
      (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
      (eq, "$temp", 0),
    ],
    "I'm interested in your gift, but my inventory is full.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (eq, "$g_talk_troop", "trp_hero_maltise"),
      (ge, "$temp", 5),
    ],
    "You should return to your homeland and not take up arms ever again.",
    "prisoner_chat_threat_retire",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_signature_repression_for_death_and_defeat", "$g_talk_troop"),
      (troop_add_item, "trp_player", "itm_asp_plate_supreme"),
      (troop_add_item, "trp_player", "itm_asp_helm_supreme"),
      (troop_add_item, "trp_player", "itm_asp_greaves"),
      (troop_add_item, "trp_player", "itm_asp_gauntlets"),
      (troop_add_item, "trp_player", "itm_asp_shield"),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (eq, "$g_talk_troop", "trp_hero_maltise"),
      (lt, "$temp", 5),
    ],
    "I'm interested in your gift (max 5 pieces), but my inventory is full.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_sig3",
    [
      (assign, ":var0", 0),
      (try_begin),
        (eq, "$g_talk_troop", "trp_hero_maltise"),
        (item_slot_eq, "itm_asp_plate", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
        (item_slot_eq, "itm_noldor_ancient_plate", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_aeldarian"),
        (item_slot_eq, "itm_noldor_rune_armor", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_syla"),
        (item_slot_eq, "itm_shadow_legion_armor", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_burilgi"),
        (item_slot_eq, "itm_warhorse_sarranid", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_heynrich"),
        (item_slot_eq, "itm_priestess_high_armor", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_rasmus"),
        (item_slot_eq, "itm_demonskin", 65, 0),
        (assign, ":var0", 1),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_alaric"),
        (item_slot_eq, "itm_torch", 65, 0),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 1),
    ],
    "I will release you if you show me the secrets of your unique equipment.",
    "prisoner_chat_blueprints",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (try_begin),
        (eq, "$g_talk_troop", "trp_hero_maltise"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_asp_plate"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_asp_helm"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_asp_gauntlets"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_asp_greaves"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_asp_shield"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_dread_helm"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_dread_armor"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_ancient_plate"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_female_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_female_armor_cape"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_silver_gauntlets"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_noble_shield"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_spirit_horse"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_aeldarian"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_rune_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_knight_helm"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_knight_helm_hooded"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_ench_shield"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_plate_greaves"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_syla"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shadow_legion_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shadow_legion_armor_cape"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_phoenix_plate"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_imperial_radiant_plate"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_phoenix_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_heater_shield_32"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_burilgi"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_warhorse_sarranid"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_heretic_sabre"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_strange_great_sword"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_strange_short_sword"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_heretic_bow"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shield_heretics_2"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shield_heretics_3"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_heynrich"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_priestess_high_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_priestess_armor"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_snake_helm"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_snake_gloves"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_priestess_boots"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_viper_sabre"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_anaconda_plate"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_helmet_fel_great"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_snake_gauntlets"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_anaconda_snake_helm"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shield_round_21"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_anaconda_shield"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_rasmus"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_demonskin"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shield_battle_05"),
        (call_script, "script_unlock_item_for_custom_troops", "itm_shield_heretics_1"),
      (else_try),
        (eq, "$g_talk_troop", "trp_hero_alaric"),
        (try_begin),
          (troop_get_type, ":var0", "trp_player"),
          (gt, ":var0", 0),
          (item_slot_eq, "itm_lyre", 65, 0),
          (call_script, "script_unlock_item_for_custom_troops", "itm_lyre"),
          (call_script, "script_unlock_item_for_custom_troops", "itm_lute"),
        (try_end),
        (call_script, "script_unlock_item_for_custom_troops", "itm_torch"),
        (display_message, "@Congratulations, you have found an Easter Egg!", 0x50FF50),
      (try_end),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [],
    "No, only your death will suffice. ",
    "close_window",
    [
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_hero_maltise"),
        (eq, "$g_talk_troop", "trp_hero_verante"),
        (play_sound, "snd_woman_die"),
      (else_try),
        (play_sound, "snd_man_die"),
      (try_end),
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_signature_repression_for_death_and_defeat", "$g_talk_troop"),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_hero_aeldarian"),
        (eq, "$g_talk_troop", "trp_hero_ithilrandir"),
        (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", -5),
      (try_end),
    ]],

  [plyr|anyone, "prisoner_chat_sig3",
    [],
    "I will think upon your offer.",
    "close_window",
    []],

  [anyone, "prisoner_chat_2",
    [
      (store_conversation_troop, "$g_talk_troop"),
      (str_store_troop_name, s43, "$g_talk_troop"),
      (this_or_next|is_between, "$g_talk_troop", "trp_npc_adonja", "trp_knight_1_1_wife"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
    ],
    "I am your prisoner, Lord {playername}. What will you have of me?",
    "prisoner_chat_noble",
    []],

  [plyr|anyone, "prisoner_chat_noble",
    [],
    "Well {s43}, Are you interested in your freedom?",
    "prisoner_chat_noble1",
    []],

  [anyone, "prisoner_chat_noble1",
    [
      (this_or_next|is_between, "$g_talk_troop", "trp_knight_1_1", "trp_kingdom_1_pretender"),
      (this_or_next|is_between, "$g_talk_troop", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (this_or_next|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (troop_get_slot, ":var0", "$g_talk_troop", 7),
      (val_mul, ":var0", 4),
      (val_add, ":var0", 2000),
      (try_begin),
        (this_or_next|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (is_between, "$g_talk_troop", "trp_kingdom_1_lord", "trp_knight_1_1"),
        (val_add, ":var0", 20000),
      (try_end),
      (assign, reg23, ":var0"),
      (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
      (assign, ":var1", reg0),
      (assign, reg10, ":var1"),
      (str_clear, s23),
      (assign, ":var2", 15),
      (266, ":var3"),
      (try_begin),
        (eq, ":var3", 0),
        (val_add, ":var2", 10),
      (else_try),
        (eq, ":var3", 1),
        (val_add, ":var2", 5),
      (try_end),
      (store_skill_level, ":var4", skl_persuasion, "trp_player"),
      (val_sub, ":var2", ":var4"),
      (try_begin),
        (this_or_next|is_between, "$g_talk_troop", "trp_knight_1_1", "trp_knight_1_4"),
        (this_or_next|is_between, "$g_talk_troop", "trp_knight_2_1", "trp_knight_2_4"),
        (this_or_next|is_between, "$g_talk_troop", "trp_knight_3_1", "trp_knight_3_4"),
        (this_or_next|is_between, "$g_talk_troop", "trp_knight_4_1", "trp_knight_4_4"),
        (is_between, "$g_talk_troop", "trp_knight_5_1", "trp_knight_5_4"),
        (val_add, ":var2", 10),
      (try_end),
      (store_troop_faction, ":var5", "$g_talk_troop"),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (try_for_range, ":var8", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var9", ":var8"),
        (eq, ":var9", ":var5"),
        (try_begin),
          (party_slot_eq, ":var8", 0, 2),
          (val_add, ":var6", 1),
        (else_try),
          (party_slot_eq, ":var8", 0, 3),
          (val_add, ":var7", 1),
        (try_end),
      (try_end),
      (assign, reg0, 0),
      (assign, reg1, 0),
      (store_add, reg1, ":var6", ":var7"),
      (val_mul, ":var7", 2),
      (val_add, ":var2", ":var6"),
      (val_add, ":var2", ":var7"),
      (try_begin),
        (eq, "$pop_kingdom", 1),
        (assign, ":var6", 0),
        (assign, ":var7", 0),
        (try_for_range, ":var8", "p_town_1", "p_salt_mine"),
          (store_faction_of_party, ":var9", ":var8"),
          (eq, ":var9", "fac_player_supporters_faction"),
          (try_begin),
            (party_slot_eq, ":var8", 0, 2),
            (val_add, ":var6", 1),
          (else_try),
            (party_slot_eq, ":var8", 0, 3),
            (val_add, ":var7", 1),
          (try_end),
        (try_end),
        (val_clamp, ":var6", 0, 6),
        (val_clamp, ":var7", 0, 4),
        (val_mul, ":var7", 2),
        (val_sub, ":var2", ":var6"),
        (val_sub, ":var2", ":var7"),
      (try_end),
      (assign, reg0, ":var2"),
      (try_begin),
        (neg|is_between, "$g_talk_troop", "trp_kingdom_1_lord", "trp_knight_1_1"),
        (neg|is_between, "$g_talk_troop", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
        (try_begin),
          (ge, ":var1", ":var2"),
          (eq, "$pop_kingdom", 1),
          (str_store_string, s23, "@...or perhaps if you are inclined, I would ask, since we are friends, that you allow me to serve you as your vassal."),
        (try_end),
      (else_try),
        (eq, "$pop_kingdom", 1),
        (lt, reg1, 6),
        (troop_equip_items, "$g_talk_troop"),
        (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_sarleon_banner"),
        (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_gregory_sword"),
        (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_kadan_bow"),
        (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_valdis_axe"),
        (troop_has_item_equipped, "$g_talk_troop", "itm_marius_sword"),
        (str_store_string, s23, "@...I see that you are looking at my weapon, you knave. Set me free and I will give it to you."),
      (try_end),
    ],
    "It is to my shame that you have defeated me. I would seek my freedom as my family can ransom me. I can offer you {reg23} denars.^^{s23}",
    "prisoner_chat_noble2",
    []],

  [plyr|anyone, "prisoner_chat_noble2",
    [],
    "Very well, I will accept your ransom of {reg23} denars ... you are free to go.",
    "close_window",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (troop_add_gold, "trp_player", reg23),
    ]],

  [plyr|anyone, "prisoner_chat_noble2",
    [],
    "Actually, you are free to go.",
    "defeat_lord_answer_2",
    [
      (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 2),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_add_log_entry", 13, "trp_player", -1, "$g_talk_troop", "$g_talk_troop_faction"),
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
    ]],

  [plyr|anyone, "prisoner_chat_noble2",
    [
      (eq, "$pop_kingdom", 1),
      (is_between, "$g_talk_troop", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (lt, reg1, 6),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_sarleon_banner"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_gregory_sword"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_kadan_bow"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_valdis_axe"),
      (troop_has_item_equipped, "$g_talk_troop", "itm_marius_sword"),
      (store_free_inventory_capacity, ":var0"),
      (eq, ":var0", 0),
    ],
    "I will take your weapon, but first need to free some space.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_noble2",
    [
      (eq, "$pop_kingdom", 1),
      (is_between, "$g_talk_troop", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (lt, reg1, 6),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_sarleon_banner"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_gregory_sword"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_kadan_bow"),
      (this_or_next|troop_has_item_equipped, "$g_talk_troop", "itm_valdis_axe"),
      (troop_has_item_equipped, "$g_talk_troop", "itm_marius_sword"),
      (store_free_inventory_capacity, ":var0"),
      (ge, ":var0", 1),
    ],
    "I am taking your weapon. Now get out of my sight and run home, you coward!",
    "close_window",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (store_troop_faction, ":var0", "$g_talk_troop"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_kingdom_1_lord"),
        (troop_add_item, "trp_player", "itm_sarleon_banner"),
        (troop_remove_item, "trp_kingdom_1_lord", "itm_sarleon_banner"),
        (troop_add_item, "trp_kingdom_1_lord", "itm_great_lance"),
      (else_try),
        (eq, "$g_talk_troop", "trp_kingdom_2_lord"),
        (troop_add_item, "trp_player", "itm_gregory_sword"),
        (troop_remove_item, "trp_kingdom_2_lord", "itm_gregory_sword"),
        (troop_add_item, "trp_kingdom_2_lord", "itm_runed_bastard"),
      (else_try),
        (eq, "$g_talk_troop", "trp_kingdom_3_lord"),
        (troop_add_item, "trp_player", "itm_kadan_bow"),
        (troop_remove_item, "trp_kingdom_3_lord", "itm_kadan_bow"),
        (troop_add_item, "trp_kingdom_2_lord", "itm_heretic_bow"),
      (else_try),
        (eq, "$g_talk_troop", "trp_kingdom_4_lord"),
        (troop_add_item, "trp_player", "itm_valdis_axe"),
        (troop_remove_item, "trp_kingdom_4_lord", "itm_valdis_axe"),
        (troop_add_item, "trp_kingdom_4_lord", "itm_ancient_rune_axe"),
      (else_try),
        (eq, "$g_talk_troop", "trp_kingdom_5_lord"),
        (troop_add_item, "trp_player", "itm_marius_sword"),
        (troop_remove_item, "trp_kingdom_5_lord", "itm_marius_sword"),
        (troop_add_item, "trp_kingdom_5_lord", "itm_runed_bastard"),
      (try_end),
      (troop_equip_items, "$g_talk_troop"),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "$g_talk_troop", -40),
      (call_script, "script_change_player_relation_with_faction", ":var0", -30),
    ]],

  [plyr|anyone, "prisoner_chat_noble2",
    [
      (eq, "$pop_kingdom", 1),
      (ge, reg10, reg0),
      (this_or_next|is_between, "$g_talk_troop", "trp_knight_1_1", "trp_kingdom_1_pretender"),
      (is_between, "$g_talk_troop", "trp_npc_adonja", "trp_kingdom_1_lord"),
      (str_store_string, s23, "@Very well friend, I will accept your Oath of Fealty."),
    ],
    "{s23}",
    "companion_comment_lord_joined",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_faction", "$g_talk_troop", "fac_player_supporters_faction"),
      (val_add, "$g_lords_persuaded", 1),
    ]],

  [anyone|other(trp_npc_roland), "companion_comment_lord_joined",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_roland"),
      (neg|troop_is_wounded, "trp_npc_roland"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_roland_to_lord_f"),
      (play_sound, "snd_roland_to_lord_f"),
    ]],

  [anyone|other(trp_npc_kaverra), "companion_comment_lord_joined",
    [
      (eq, "$talk_context", 2),
      (main_party_has_troop, "trp_npc_kaverra"),
      (neg|troop_is_wounded, "trp_npc_kaverra"),
      (store_random_in_range, ":var0", 0, 100),
      (lt, ":var0", 50),
    ],
    "{s4}",
    "close_window",
    [
      (str_store_string, s4, "str_npc_kaverra_to_lord_f"),
      (play_sound, "snd_kaverra_to_lord_f"),
    ]],

  [auto_proceed|anyone, "companion_comment_lord_joined",
    [],
    "I will serve you well, my Liege.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_chat_noble2",
    [],
    "I will think upon your offer.",
    "close_window",
    []],

  [anyone, "prisoner_chat_2",
    [
      (is_between, "$g_talk_troop", "trp_noldor_ranger", "trp_noldor_troop_for_shop"),
    ],
    "We have surrendered, and are in your power and at your mercy.",
    "prisoner_noldor_chat1",
    []],

  [plyr|anyone, "prisoner_noldor_chat1",
    [],
    "I think that you should return to your forest and not take up arms against me ever again.",
    "close_window",
    [
      (party_remove_prisoners, "p_main_party", "$g_talk_troop", 1),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (try_begin),
        (is_between, "$g_talk_troop", "trp_noldor_maiden", "trp_noldor_troop_for_shop"),
        (call_script, "script_change_player_honor", 1),
      (try_end),
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", 1),
    ]],

  [plyr|anyone, "prisoner_noldor_chat1",
    [
      (assign, ":var0", 0),
      (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
      (try_for_range_backwards, ":var2", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
        (is_between, ":var3", "trp_noldor_ranger", "trp_noldor_troop_for_shop"),
        (val_add, ":var0", 1),
        (party_prisoner_stack_get_size, ":var4", "p_main_party", ":var2"),
        (try_begin),
          (gt, ":var4", 1),
          (val_add, ":var0", 1),
        (try_end),
        (gt, ":var0", 1),
        (assign, ":var1", 0),
      (try_end),
      (gt, ":var0", 1),
    ],
    "I release you all from your chains and you are free to go home.",
    "prisoner_noldor_chat1_all",
    []],

  [anyone, "prisoner_noldor_chat1_all",
    [],
    "You are very 'merciful', for a human.",
    "prisoner_noldor_chat1_all_1",
    []],

  [plyr|anyone, "prisoner_noldor_chat1_all_1",
    [],
    "Careful what you say! You are testing my patience here. I suggest you leave now.",
    "close_window",
    [
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "trp_noldor_ranger", "trp_noldor_troop_for_shop"),
        (party_count_prisoners_of_type, ":var3", "p_main_party", ":var2"),
        (gt, ":var3", 0),
        (remove_troops_from_prisoners, ":var2", ":var3"),
        (val_add, ":var0", ":var3"),
        (try_begin),
          (is_between, ":var2", "trp_noldor_maiden", "trp_noldor_troop_for_shop"),
          (val_add, ":var1", ":var3"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (call_script, "script_change_troop_renown", "trp_player", ":var0"),
        (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", ":var0"),
      (try_end),
      (try_begin),
        (gt, ":var1", 0),
        (call_script, "script_change_player_honor", ":var1"),
      (try_end),
    ]],

  [plyr|anyone, "prisoner_noldor_chat1_all_1",
    [],
    "On second thought, I have changed my mind. Puts chains back on.",
    "close_window",
    []],

  [plyr|anyone, "prisoner_noldor_chat1",
    [],
    "Yes, you are. We may talk soon.",
    "close_window",
    []],

  [anyone, "prisoner_chat_2",
    [],
    "No, I swear I won't.",
    "close_window",
    []],

  [anyone, "prisoner_chat_threat",
    [],
    "I look forward to our next meeting {reg63?Lord:Lady} {playername}! I would see you kneel before me and squirm as the mongrel you are! ",
    "last_player_statement",
    []],

  [anyone, "prisoner_chat_threat_retire",
    [],
    "Then I shall abide by my word and go. I shall raise a glass of wine and toast your eventual defeat {reg63?Lord:Lady} {playername}! ",
    "last_player_goodbye",
    []],

  [anyone, "prisoner_chat_blueprints",
    [],
    "Very well, I will let my smiths show you their secrets! But remember, you haven't seen the last of me! ",
    "last_player_statement",
    []],

  [plyr|anyone, "last_player_statement",
    [],
    "Next time I shall not be so generous. ",
    "close_window",
    []],

  [plyr|anyone, "last_player_goodbye",
    [],
    "And I, in turn, shall toast your retirement. See to it that you keep your word to me and do not return. If you return, you'll regret it. ",
    "close_window",
    []],

  [anyone, "start",
    [
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (this_or_next|is_between, "$g_talk_troop", "trp_town_1_weaponsmith", "trp_town_1_tavernkeeper"),
      (this_or_next|is_between, "$g_talk_troop", "trp_town_1_armorer", "trp_town_1_weaponsmith"),
      (is_between, "$g_talk_troop", "trp_town_1_horse_merchant", "trp_town_1_mayor"),
    ],
    "Greetings, {reg63?your lordship:my lady}. How can I serve you today?",
    "town_merchant_talk",
    [
      (call_script, "script_pop_commoner_talk", "$g_talk_troop"),
    ]],

  [anyone, "start",
    [
      (this_or_next|is_between, "$g_talk_troop", "trp_town_1_weaponsmith", "trp_town_1_tavernkeeper"),
      (this_or_next|is_between, "$g_talk_troop", "trp_town_1_armorer", "trp_town_1_weaponsmith"),
      (is_between, "$g_talk_troop", "trp_town_1_horse_merchant", "trp_town_1_mayor"),
    ],
    "Good day. What can I do for you?",
    "town_merchant_talk",
    []],

  [plyr|anyone, "town_merchant_talk",
    [
      (is_between, "$g_talk_troop", "trp_town_1_weaponsmith", "trp_town_1_tavernkeeper"),
    ],
    "I want to buy a new weapon. Show me your wares.",
    "trade_requested_weapons",
    []],

  [plyr|anyone, "town_merchant_talk",
    [
      (is_between, "$g_talk_troop", "trp_town_1_armorer", "trp_town_1_weaponsmith"),
    ],
    "I am looking for some equipment. Show me what you have.",
    "trade_requested_armor",
    []],

  [plyr|anyone, "town_merchant_talk",
    [
      (is_between, "$g_talk_troop", "trp_town_1_horse_merchant", "trp_town_1_mayor"),
    ],
    "I am thinking of buying a horse.",
    "trade_requested_horse",
    []],

  [anyone, "trade_requested_weapons",
    [],
    "Ah, yes {reg63?sir:madam}. These arms are the best you'll find anywhere.",
    "merchant_trade",
    [
      (change_screen_trade),
    ]],

  [anyone, "trade_requested_armor",
    [],
    "Of course, {reg63?sir:madam}. You won't find better quality armor than these in all Pendor.",
    "merchant_trade",
    [
      (change_screen_trade),
    ]],

  [anyone, "trade_requested_horse",
    [],
    "You have a fine eye for horses, {reg63?sir:madam}. You won't find better beasts than these anywhere else.",
    "merchant_trade",
    [
      (change_screen_trade),
    ]],

  [anyone, "merchant_trade",
    [],
    "Anything else?",
    "town_merchant_talk",
    []],

  [plyr|anyone, "town_merchant_talk",
    [],
    "Tell me. What are people talking about these days?",
    "merchant_gossip",
    [
      (store_conversation_troop, ":var0"),
      (call_script, "script_random_rumor_talk", 1, ":var0"),
    ]],

  [anyone, "merchant_gossip",
    [],
    "{s3}",
    "town_merchant_talk",
    []],

  [plyr|anyone, "town_merchant_talk",
    [
      (quest_slot_eq, "qst_horse_armor", 11, 1),
      (quest_get_slot, ":var0", "qst_horse_armor", 1),
      (eq, "$current_town", ":var0"),
      (quest_get_slot, ":var1", "qst_horse_armor", 2),
      (neq, "$g_talk_troop", ":var1"),
    ],
    "Is there anyone with whom I could talk about old horse breeds?",
    "town_merchant_horse_armor_1",
    []],

  [anyone, "town_merchant_horse_armor_1",
    [
      (quest_get_slot, ":var0", "qst_horse_armor", 2),
      (str_clear, s54),
      (str_store_troop_name, s54, ":var0"),
    ],
    "{s54} trades horses here, so maybe him. He has never talked about old breeds before, but we don't usually do business together and have spoken only few times.",
    "town_merchant_talk",
    []],

  [plyr|anyone, "town_merchant_talk",
    [
      (quest_slot_eq, "qst_horse_armor", 11, 1),
      (quest_get_slot, ":var0", "qst_horse_armor", 2),
      (eq, "$g_talk_troop", ":var0"),
    ],
    "Do you have any information about old or ancient horses breeds?",
    "town_horse_merchant_horse_armor_1",
    []],

  [anyone, "town_horse_merchant_horse_armor_1",
    [],
    "Ha! I can talk all day long about 'ancient horses breeds,' as there were so many of them.",
    "town_horse_merchant_horse_armor_2",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_2",
    [],
    "Well to be more specific, I am looking for some information about horses raised by the old Pendorian monarchy...",
    "town_horse_merchant_horse_armor_3",
    []],

  [anyone, "town_horse_merchant_horse_armor_3",
    [],
    "Hmm, there is only one kind of horse that I can think of: 'Pendor Royal Steeds'. What a magnificent animal they were. Almost wiped out by the Red Plague too!",
    "town_horse_merchant_horse_armor_4",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_4",
    [],
    "'... almost wiped out...'? Does that mean that they still exist?",
    "town_horse_merchant_horse_armor_5",
    []],

  [anyone, "town_horse_merchant_horse_armor_5",
    [],
    "Yes, in a way, but only in Sarleon due to the pedigree being passed down since King Alfred. While they may not be the exact breed as a few hundred years ago, they are linked in common traits and have identical physicality. ^^I just so happen to own three of these very few ancestors, that the last king rode, myself!",
    "town_horse_merchant_horse_armor_6",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_6",
    [],
    "I would like to buy one!",
    "town_horse_merchant_horse_armor_7",
    []],

  [anyone, "town_horse_merchant_horse_armor_7",
    [],
    "I am afraid that this horse is not for sale. My family bred horses for generations and we are very proud that we were able to preserve these royal steeds. ^^But I have other good horses, if you are interested?",
    "town_horse_merchant_horse_armor_8",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_8",
    [],
    "I can buy 'good horses' in other places, but they won't fit this old armor ...",
    "town_horse_merchant_horse_armor_9",
    []],

  [anyone, "town_horse_merchant_horse_armor_9",
    [],
    "Wait! Are you saying you found Pendor Royal Barding!?",
    "town_horse_merchant_horse_armor_10",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_10",
    [],
    "It is a bit tarnished now, but it still looks quite in good shape to me. Fit for a leader.",
    "town_horse_merchant_horse_armor_11",
    []],

  [anyone, "town_horse_merchant_horse_armor_11",
    [],
    "Oh, I would give you almost anything too see one of my horses in this armor before I die! ^^Hmm...tell you what, I will exchange one of my steeds for a Medium Pouch of Diamonds. I think I that be a fair trade. What do you say?",
    "town_horse_merchant_horse_armor_12",
    []],

  [plyr|anyone, "town_horse_merchant_horse_armor_12",
    [
      (player_has_item, "itm_diamond_medium"),
    ],
    "Thank you. Please take these diamonds.",
    "town_merchant_talk",
    [
      (troop_remove_item, "trp_player", "itm_diamond_medium"),
      (troop_add_item, "trp_player", "itm_horse_for_armor", imod_plain),
      (quest_set_slot, "qst_horse_armor", 11, 3),
      (str_clear, s3),
      (str_store_string, s3, "@You have bought a very rare Pendor Royal Steed, whose ancestors were used by Pendor kings. Speak to the blacksmith."),
      (add_quest_note_from_sreg, "qst_horse_armor", 3, s3, 0),
    ]],

  [plyr|anyone, "town_horse_merchant_horse_armor_12",
    [
      (neg|player_has_item, "itm_diamond_medium"),
    ],
    "I will bring you the diamonds. I will return soon.",
    "town_merchant_talk",
    [
      (quest_set_slot, "qst_horse_armor", 11, 2),
      (str_clear, s3),
      (str_store_string, s3, "@You have found a very rare Pendor Royal Steed in Sarleon. The merchant asks for Medium Pouch of Diamonds in exchange."),
      (add_quest_note_from_sreg, "qst_horse_armor", 3, s3, 0),
    ]],

  [plyr|anyone, "town_merchant_talk",
    [
      (quest_slot_eq, "qst_horse_armor", 11, 2),
      (quest_get_slot, ":var0", "qst_horse_armor", 2),
      (eq, "$g_talk_troop", ":var0"),
      (player_has_item, "itm_diamond_medium"),
    ],
    "I have got the diamonds for you.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_diamond_medium"),
      (troop_add_item, "trp_player", "itm_horse_for_armor", imod_plain),
      (quest_set_slot, "qst_horse_armor", 11, 3),
      (str_clear, s3),
      (str_store_string, s3, "@You have bought a very rare Pendor Royal Steed, whose ancestors were used by Pendor kings. Speak to the blacksmith."),
      (add_quest_note_from_sreg, "qst_horse_armor", 3, s3, 0),
    ]],

  [plyr|anyone, "town_merchant_talk",
    [],
    "Very good. Good-bye.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_hero_burilgi", "trp_omen_seeker"),
    ],
    "Yes My {reg63?lord:lady}? What may I do for you? ",
    "signature_player_introduce",
    []],

  [plyr|anyone, "signature_player_introduce",
    [],
    "Rumors about you abound in Pendor, sir. I'd like to learn more about you.",
    "signature_first_response",
    []],

  [anyone, "signature_first_response",
    [],
    "{s4}",
    "signature_player_response_2",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 104),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "signature_player_response_2",
    [],
    "Thank you, I've heard quite enough. Good day.",
    "close_window",
    []],

  [plyr|anyone, "signature_player_response_2",
    [],
    "Would you please expound upon that, sir?",
    "signature_second_response",
    []],

  [anyone, "signature_second_response",
    [],
    "{s4}",
    "signature_player_response_3",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 105),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "signature_player_response_3",
    [],
    "Please continue...",
    "signature_third_response",
    []],

  [anyone, "signature_third_response",
    [],
    "{s4}",
    "signature_player_response_4",
    [
      (troop_get_slot, ":var0", "$g_talk_troop", 106),
      (str_store_string, s4, ":var0"),
    ]],

  [plyr|anyone, "signature_player_response_4",
    [],
    "Thank you, that was.. interesting.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (is_between, "$g_talk_troop", "trp_town_walker_1", "trp_ramun_the_slave_trader"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "My {reg63?lord:lady}?",
    "town_dweller_talk",
    [
      (assign, "$welfare_inquired", 0),
      (assign, "$rumors_inquired", 0),
      (assign, "$info_inquired", 0),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (is_between, "$g_talk_troop", "trp_town_walker_1", "trp_ramun_the_slave_trader"),
    ],
    "Good day, {reg63?sir:madam}.",
    "town_dweller_talk",
    [
      (assign, "$welfare_inquired", 0),
      (assign, "$rumors_inquired", 0),
      (assign, "$info_inquired", 0),
    ]],

  [plyr|anyone, "town_dweller_talk",
    [
      (check_quest_active, "qst_hunt_down_fugitive"),
      (neg|check_quest_concluded, "qst_hunt_down_fugitive"),
      (quest_slot_eq, "qst_hunt_down_fugitive", 1, "$current_town"),
      (quest_get_slot, ":var0", "qst_hunt_down_fugitive", 13),
      (call_script, "script_get_name_from_dna_to_s50", ":var0"),
      (str_store_string, s4, s50),
    ],
    "I am looking for a man by the name of {s4}. I was told he may be hiding here.",
    "town_dweller_ask_fugitive",
    []],

  [anyone, "town_dweller_ask_fugitive",
    [],
    "Strangers come and go to our village, {reg63?sir:madam}. If he is hiding here, you will surely find him if you look around.",
    "close_window",
    []],

  [plyr|anyone, "town_dweller_talk",
    [
      (eq, 1, 0),
      (check_quest_active, "qst_meet_spy_in_enemy_town"),
      (neg|check_quest_succeeded, "qst_meet_spy_in_enemy_town"),
      (quest_slot_eq, "qst_meet_spy_in_enemy_town", 1, "$current_town"),
      (str_store_item_name, s5, "$spy_item_worn"),
    ],
    "Pardon me, but is that a {s5} you're wearing?",
    "town_dweller_quest_meet_spy_in_enemy_town_ask_item",
    []],

  [anyone, "town_dweller_quest_meet_spy_in_enemy_town_ask_item",
    [
      (str_store_item_name, s5, "$spy_item_worn"),
      (try_begin),
        (troop_has_item_equipped, "$g_talk_troop", "$spy_item_worn"),
        (str_store_string, s6, "@A {s5}? Well... Yes, I suppose it is. What a strange thing to ask."),
      (else_try),
        (str_store_string, s6, "@Eh? No, it most certainly is not a {s5}. I'd start questioning my eyesight if I were you."),
      (try_end),
    ],
    "{s6}",
    "town_dweller_talk",
    []],

  [repeat_for_100|plyr|anyone, "town_dweller_talk",
    [
      (store_repeat_object, ":var0"),
      (lt, ":var0", 4),
      (check_quest_active, "qst_meet_spy_in_enemy_town"),
      (neg|check_quest_succeeded, "qst_meet_spy_in_enemy_town"),
      (quest_slot_eq, "qst_meet_spy_in_enemy_town", 1, "$current_town"),
      (store_add, ":var1", ":var0", "str_secret_sign_1"),
      (str_store_string, s4, ":var1"),
    ],
    "{s4}",
    "town_dweller_quest_meet_spy_in_enemy_town",
    [
      (store_repeat_object, ":var0"),
      (assign, "$temp", ":var0"),
    ]],

  [anyone, "town_dweller_quest_meet_spy_in_enemy_town",
    [
      (call_script, "script_agent_get_town_walker_details", "$g_talk_agent"),
      (assign, ":var0", reg0),
      (eq, ":var0", 3),
      (quest_get_slot, ":var1", "qst_meet_spy_in_enemy_town", 10),
      (val_sub, ":var1", "str_secret_sign_1"),
      (eq, ":var1", "$temp"),
      (store_add, ":var2", ":var1", "str_countersign_1"),
      (str_store_string, s4, ":var2"),
    ],
    "{s4}",
    "town_dweller_quest_meet_spy_in_enemy_town_know",
    []],

  [anyone, "town_dweller_quest_meet_spy_in_enemy_town",
    [],
    "Eh? What kind of gibberish is that?",
    "town_dweller_quest_meet_spy_in_enemy_town_dont_know",
    []],

  [plyr|anyone, "town_dweller_quest_meet_spy_in_enemy_town_dont_know",
    [],
    "Never mind.",
    "close_window",
    []],

  [plyr|anyone, "town_dweller_quest_meet_spy_in_enemy_town_know",
    [
      (quest_get_slot, ":var0", "qst_meet_spy_in_enemy_town", 6),
      (str_store_troop_name, s4, ":var0"),
    ],
    "{s4} sent me to collect your reports. Do you have them with you?",
    "town_dweller_quest_meet_spy_in_enemy_town_chat",
    []],

  [anyone, "town_dweller_quest_meet_spy_in_enemy_town_chat",
    [
      (quest_get_slot, ":var0", "qst_meet_spy_in_enemy_town", 6),
      (str_store_troop_name, s4, ":var0"),
    ],
    "I've been expecting you. Here they are, make sure they reach {s4} intact and without delay.",
    "town_dweller_quest_meet_spy_in_enemy_town_chat_2",
    [
      (call_script, "script_succeed_quest", "qst_meet_spy_in_enemy_town"),
      (call_script, "script_center_remove_walker_type_from_walkers", "$current_town", 3),
    ]],

  [plyr|anyone, "town_dweller_quest_meet_spy_in_enemy_town_chat_2",
    [],
    "Farewell.",
    "close_window",
    []],

  [plyr|anyone, "town_dweller_talk",
    [
      (party_slot_eq, "$current_town", 0, 4),
      (eq, "$info_inquired", 0),
    ],
    "What can you tell me about this village?",
    "town_dweller_ask_info",
    [
      (assign, "$info_inquired", 1),
    ]],

  [plyr|anyone, "town_dweller_talk",
    [
      (party_slot_eq, "$current_town", 0, 3),
      (eq, "$info_inquired", 0),
    ],
    "What can you tell me about this town?",
    "town_dweller_ask_info",
    [
      (assign, "$info_inquired", 1),
    ]],

  [anyone, "town_dweller_ask_info",
    [
      (str_store_party_name, s5, "$current_town"),
      (assign, reg4, 0),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (assign, reg4, 1),
      (try_end),
      (str_store_string, s6, "@This is the {reg4?town:village} of {s5}, {reg63?sir:madam}."),
      (str_clear, s10),
      (try_begin),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (str_store_string, s10, "@{s6} Our {reg4?town:village} and the surrounding lands belong to you of course, my {reg63?lord:lady}."),
      (else_try),
        (party_get_slot, ":var0", "$current_town", 7),
        (ge, ":var0", 0),
        (str_store_troop_name, s7, ":var0"),
        (store_troop_faction, ":var1", ":var0"),
        (str_store_faction_name, s8, ":var1"),
        (str_store_string, s10, "@{s6} Our {reg4?town:village} and the surrounding lands belong to {s7} of {s8}."),
      (try_end),
      (str_clear, s5),
      (assign, ":var2", 0),
      (try_for_range, ":var3", "itm_spice", "itm_baggage_train"),
        (store_sub, ":var4", ":var3", "itm_spice"),
        (val_add, ":var4", 500),
        (party_get_slot, ":var5", "$g_encountered_party", ":var4"),
        (ge, ":var5", 5),
        (str_store_item_name, s3, ":var3"),
        (try_begin),
          (eq, ":var2", 0),
          (str_store_string, s5, s3),
        (else_try),
          (eq, ":var2", 1),
          (str_store_string, s5, "@{s3} and {s5}"),
        (else_try),
          (str_store_string, s5, "@{!}{s3}, {s5}"),
        (try_end),
        (val_add, ":var2", 1),
      (try_end),
      (try_begin),
        (gt, ":var2", 0),
        (assign, reg20, 1),
      (else_try),
        (assign, reg20, 0),
      (try_end),
      (str_store_string, s11, "@{reg20?We mostly produce {s5} here:We don't produce much here these days}. If you would like to learn more, you can speak with our {reg4?guildmaster:village elder}. He is nearby, right over there."),
    ],
    "{s10} {s11}",
    "close_window",
    []],

  [plyr|anyone, "town_dweller_talk",
    [
      (party_slot_eq, "$current_town", 0, 4),
      (eq, "$welfare_inquired", 0),
    ],
    "How is life here?",
    "town_dweller_ask_situation",
    [
      (assign, "$welfare_inquired", 1),
    ]],

  [plyr|anyone, "town_dweller_talk",
    [
      (party_slot_eq, "$current_town", 0, 3),
      (eq, "$welfare_inquired", 0),
    ],
    "How is life here?",
    "town_dweller_ask_situation",
    [
      (assign, "$welfare_inquired", 1),
    ]],

  [anyone, "town_dweller_ask_situation",
    [
      (call_script, "script_agent_get_town_walker_details", "$g_talk_agent"),
      (assign, ":var0", reg0),
      (eq, ":var0", 1),
      (party_slot_eq, "$current_town", 0, 4),
    ],
    "Disaster has struck my family, {reg63?sir:madam}. A pestilence has ruined the crops on our fields, and my poor children lie at home hungry and sick. My neighbours are too poor themselves to help me.",
    "town_dweller_poor",
    []],

  [anyone, "town_dweller_ask_situation",
    [
      (call_script, "script_agent_get_town_walker_details", "$g_talk_agent"),
      (assign, ":var0", reg0),
      (eq, ":var0", 1),
    ],
    "My life is miserable, {reg63?sir:madam}. I haven't been able to find a job for months, and my poor children go to bed hungry each night. My neighbours are too poor themselves to help me.",
    "town_dweller_poor",
    []],

  [plyr|anyone, "town_dweller_poor",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", 300),
    ],
    "Then take these 300 denars. I hope this will help you and your family.",
    "town_dweller_poor_paid",
    [
      (troop_remove_gold, "trp_player", 300),
    ]],

  [plyr|anyone, "town_dweller_poor",
    [],
    "Then you must work harder and bear your burden without complaining.",
    "town_dweller_poor_not_paid",
    []],

  [anyone, "town_dweller_poor_not_paid",
    [],
    "Yes {reg63?sir:madam}. I will do as you say.",
    "close_window",
    []],

  [anyone, "town_dweller_poor_paid",
    [],
    "{reg63?My lord:My good lady}.  You are so good and generous. I will tell everyone how you helped us.",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 1),
      (call_script, "script_agent_get_town_walker_details", "$g_talk_agent"),
      (assign, ":var0", reg2),
      (call_script, "script_center_set_walker_to_type", "$g_encountered_party", ":var0", 2),
    ]],

  [anyone, "town_dweller_ask_situation",
    [
      (call_script, "script_agent_get_town_walker_details", "$g_talk_agent"),
      (assign, ":var0", reg0),
      (eq, ":var0", 2),
    ],
    "Thank you for your kindness {reg63?sir:madam}. With your help our lives will be better. I will pray for you everyday.",
    "close_window",
    []],

  [anyone, "town_dweller_ask_situation",
    [
      (neg|party_slot_ge, "$current_town", 50, 30),
    ],
    "Times are hard, {reg63?sir:madam}. We work hard all day and yet we go to sleep hungry most nights.",
    "town_dweller_talk",
    []],

  [anyone, "town_dweller_ask_situation",
    [
      (neg|party_slot_ge, "$current_town", 50, 70),
    ],
    "Times are hard, {reg63?sir:madam}. But we must count our blessings.",
    "town_dweller_talk",
    []],

  [anyone, "town_dweller_ask_situation",
    [],
    "We are not doing too badly {reg63?sir:madam}. We must count our blessings.",
    "town_dweller_talk",
    []],

  [plyr|anyone, "town_dweller_talk",
    [],
    "What is your trade?",
    "town_dweller_ask_trade",
    []],

  [anyone, "town_dweller_ask_trade",
    [
      (call_script, "script_town_walker_occupation_string_to_s14", "$g_talk_agent"),
    ],
    "{s14}",
    "town_dweller_talk",
    []],

  [plyr|anyone, "town_dweller_talk",
    [
      (eq, "$rumors_inquired", 0),
    ],
    "What is the latest rumor around here?",
    "town_dweller_ask_rumor",
    [
      (assign, "$rumors_inquired", 1),
    ]],

  [anyone, "town_dweller_ask_rumor",
    [
      (neg|party_slot_ge, "$current_town", 26, -5),
    ],
    "I don't know anything that would be of interest to you.",
    "town_dweller_talk",
    []],

  [anyone, "town_dweller_ask_rumor",
    [
      (store_mul, ":var0", "$current_town", 197),
      (val_add, ":var0", "$g_talk_agent"),
      (call_script, "script_get_rumor_to_s61", ":var0"),
      (gt, reg0, 0),
    ],
    "{s61}",
    "town_dweller_talk",
    []],

  [anyone, "town_dweller_ask_rumor",
    [],
    "I haven't heard anything interesting lately.",
    "town_dweller_talk",
    []],

  [plyr|anyone, "town_dweller_talk",
    [],
    "Leave.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (is_between, "$g_talk_troop", "trp_novice_fighter", "trp_ramun_the_slave_trader"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
      (neq, "$current_town", "p_castle_noldor"),
      (neq, "$current_town", "p_snake_stronghold"),
    ],
    "Yes {reg63?sir:madam}?",
    "player_castle_guard_talk",
    []],

  [plyr|anyone, "player_castle_guard_talk",
    [],
    "How goes the watch, soldier?",
    "player_castle_guard_talk_2",
    []],

  [anyone, "player_castle_guard_talk_2",
    [],
    "All is quiet {reg63?sir:madam}. Nothing to report.",
    "player_castle_guard_talk_3",
    []],

  [plyr|anyone, "player_castle_guard_talk_3",
    [],
    "Good. Keep your eyes open.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (is_between, "$g_talk_troop", "trp_novice_fighter", "trp_ramun_the_slave_trader"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (eq, "$players_kingdom", "$g_encountered_party_faction"),
      (troop_slot_ge, "trp_player", 7, 100),
      (str_store_party_name, s10, "$current_town"),
    ],
    "Good day, {reg63?sir:madam}. It's nice having you here in {s10}.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (is_between, "$g_talk_troop", "trp_novice_fighter", "trp_ramun_the_slave_trader"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
    ],
    "Mind your manners within the walls and we'll have no trouble.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (eq, "$current_town", "p_castle_noldor"),
    ],
    "Hail, Noldor friend. The Jatu are far away and our patrols roam the forests freely.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 0),
      (eq, "$current_town", "p_snake_stronghold"),
    ],
    "Hail, Grandmaster. All is quiet and the view is fascinating at sunset.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (eq, "$g_order_challenge_won", 1),
      (eq, "$g_order_challenge_troop", "$g_talk_troop"),
      (assign, ":var0", 0),
      (try_begin),
        (this_or_next|eq, "$pop_kingdom", 1),
        (this_or_next|eq, "$player_has_homage", 1),
        (this_or_next|eq, "$g_talk_troop", "trp_player_knight"),
        (troop_slot_ge, "trp_player", 7, 2000),
        (assign, ":var0", 1),
      (try_end),
      (store_free_inventory_capacity, ":var1"),
      (this_or_next|eq, ":var0", 0),
      (ge, ":var1", 6),
    ],
    "Congratulations! You are now a {s8} of our Order!^May you always wear its armor proudly!",
    "close_window",
    [
      (assign, "$g_order_challenge_won", 0),
      (troop_set_slot, "trp_player", 162, "$g_talk_troop"),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 10),
      (faction_set_slot, "$g_talk_troop_faction", 72, 1),
      (faction_set_slot, "$g_talk_troop_faction", 71, 0),
      (try_begin),
        (eq, "$pop_kingdom", 1),
        (faction_set_slot, "$g_talk_troop_faction", 72, 4),
        (faction_set_slot, "$g_talk_troop_faction", 71, 100),
      (else_try),
        (this_or_next|eq, "$player_has_homage", 1),
        (troop_slot_ge, "trp_player", 7, 4000),
        (faction_set_slot, "$g_talk_troop_faction", 72, 3),
        (faction_set_slot, "$g_talk_troop_faction", 71, 60),
      (else_try),
        (troop_slot_ge, "trp_player", 7, 2000),
        (faction_set_slot, "$g_talk_troop_faction", 72, 2),
        (faction_set_slot, "$g_talk_troop_faction", 71, 30),
      (try_end),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (store_sub, ":var1", ":var0", 1),
      (val_add, ":var1", "str_order_rank_1"),
      (str_store_string, s8, ":var1"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_player_knight"),
        (str_store_string, s8, "@Honorary Grandmaster"),
      (try_end),
      (assign, ":var2", 0),
      (try_begin),
        (this_or_next|eq, "$g_talk_troop", "trp_player_knight"),
        (eq, ":var0", 4),
        (assign, ":var2", "$g_talk_troop"),
      (else_try),
        (ge, ":var0", 2),
        (faction_get_slot, ":var2", "$g_talk_troop_faction", 69),
      (try_end),
      (neq, ":var2", 0),
      (try_for_range, ":var3", 4, 8),
        (troop_get_inventory_slot, ":var4", ":var2", ":var3"),
        (try_begin),
          (ge, ":var4", 0),
          (troop_add_item, "trp_player", ":var4", imod_plain),
        (try_end),
      (try_end),
      (troop_get_inventory_slot, ":var4", ":var2", ek_horse),
      (try_begin),
        (ge, ":var4", 0),
        (troop_add_item, "trp_player", ":var4", imod_plain),
      (try_end),
      (try_for_range, ":var3", 0, 4),
        (troop_get_inventory_slot, ":var4", ":var2", ":var3"),
        (try_begin),
          (ge, ":var4", 0),
          (item_get_type, ":var5", ":var4"),
          (eq, ":var5", 7),
          (troop_add_item, "trp_player", ":var4", imod_plain),
        (try_end),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (eq, "$g_order_challenge_won", 1),
      (eq, "$g_order_challenge_troop", "$g_talk_troop"),
    ],
    "Congratulations! You'll need to make space for up to six items in your inventory to receive the Order specific outfit.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (eq, "$g_order_challenge_won", -1),
      (eq, "$g_order_challenge_troop", "$g_talk_troop"),
    ],
    "It seems you are unworthy of joining our Order. Goodbye.",
    "close_window",
    [
      (assign, "$g_order_challenge_won", 0),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (lt, "$g_talk_troop_faction_relation", 0),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "You have acted against your Order! You are therefore stripped of membership. Begone and make amends.",
    "close_window",
    [
      (troop_set_slot, "trp_player", 162, 0),
      (call_script, "script_change_player_honor", -10),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (lt, "$g_talk_troop_faction_relation", 0),
      (neg|player_has_item, "itm_book_heretic"),
      (neg|player_has_item, "itm_book_snake"),
    ],
    "My Order has no business with its enemies. Begone and make amends.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (lt, "$g_talk_troop_faction_relation", 0),
      (this_or_next|player_has_item, "itm_book_heretic"),
      (player_has_item, "itm_book_snake"),
    ],
    "My Order has no business ... What did you say?",
    "hall_order_guard_talk_books",
    []],

  [plyr|anyone, "hall_order_guard_talk_books",
    [],
    "Look, I have found strange writings.",
    "hall_order_guard_talk_books_1",
    []],

  [anyone, "hall_order_guard_talk_books_1",
    [],
    "Give them to me right now! They are too dangerous for an untrained reader. ^^^ Here is your tip.",
    "close_window",
    [
      (store_item_kind_count, ":var0", "itm_book_heretic", "trp_player"),
      (store_item_kind_count, ":var1", "itm_book_snake", "trp_player"),
      (store_add, ":var2", ":var0", ":var1"),
      (try_begin),
        (lt, ":var2", 3),
        (try_begin),
          (player_has_item, "itm_book_heretic"),
          (troop_remove_item, "trp_player", "itm_book_heretic"),
        (else_try),
          (player_has_item, "itm_book_snake"),
          (troop_remove_item, "trp_player", "itm_book_snake"),
        (try_end),
        (call_script, "script_troop_add_gold", "trp_player", 50),
        (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 1),
      (else_try),
        (assign, ":var3", 0),
        (troop_get_inventory_capacity, ":var4", "trp_player"),
        (try_for_range, ":var5", 10, ":var4"),
          (troop_get_inventory_slot, ":var6", "trp_player", ":var5"),
          (this_or_next|eq, ":var6", "itm_book_heretic"),
          (eq, ":var6", "itm_book_snake"),
          (troop_set_inventory_slot, "trp_player", ":var5", -1),
          (val_add, ":var3", 1),
          (try_begin),
            (eq, ":var3", 3),
            (assign, ":var4", ":var5"),
          (try_end),
        (try_end),
        (call_script, "script_troop_add_gold", "trp_player", 150),
        (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 5),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_bounty"),
      (check_quest_failed, "qst_order_bounty"),
      (quest_slot_eq, "qst_order_bounty", 6, "$g_talk_troop"),
    ],
    "I'm disappointed with your inability to defeat enough enemies of our Order. We do not reward failure.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_bounty"),
      (quest_get_slot, ":var0", "qst_order_bounty", 10),
      (quest_get_slot, ":var1", "qst_order_bounty", 17),
      (val_sub, ":var1", ":var0"),
      (val_div, ":var1", 1200),
      (val_add, ":var1", -1),
      (val_clamp, ":var1", -7, 0),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", ":var1"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_tournament"),
      (check_quest_failed, "qst_order_tournament"),
      (quest_slot_eq, "qst_order_tournament", 6, "$g_talk_troop"),
    ],
    "It's discouraging to fail to represent your Order with skill and honor. Still, at least you've tried.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_tournament"),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -2),
      (call_script, "script_change_player_honor", -1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_challenge"),
      (check_quest_failed, "qst_order_challenge"),
      (quest_slot_eq, "qst_order_challenge", 6, "$g_talk_troop"),
    ],
    "Your meek leadership failed us, {playername}. If you can't complete a challenge, then don't ask for one.^We'll immediately recall our soldiers and let your old soldiers rejoin you, they were nothing but a pestilence here, always rummaging through the Order pantries. Farewell.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_challenge"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -4),
      (party_count_companions_of_type, ":var0", "p_main_party", "$g_talk_troop"),
      (store_sub, ":var1", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var1", "trp_dragon_drake"),
      (party_count_companions_of_type, ":var2", "p_main_party", ":var1"),
      (party_remove_members, "p_main_party", "$g_talk_troop", ":var0"),
      (party_remove_members, "p_main_party", ":var1", ":var2"),
      (quest_get_slot, ":var3", "qst_order_challenge", 8),
      (try_begin),
        (party_is_active, ":var3"),
        (call_script, "script_party_add_party_companions", "p_main_party", ":var3"),
        (remove_party, ":var3"),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_rivalry"),
      (check_quest_failed, "qst_order_rivalry"),
      (quest_slot_eq, "qst_order_rivalry", 6, "$g_talk_troop"),
      (quest_slot_eq, "qst_order_rivalry", 12, "$current_town"),
    ],
    "I'm disappointed in you, {playername}. Either you are inept or your loyalties are suspect.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_rivalry"),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -2),
      (call_script, "script_change_player_honor", -1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_grandmaster"),
      (quest_slot_eq, "qst_order_grandmaster", 6, "$g_talk_troop"),
      (quest_slot_eq, "qst_order_grandmaster", 11, 1),
    ],
    "That was quite a scrap, eh, Constable?^Sadly, we were too late to save our Grandmaster - the Snake Cult assassins got to him before we could do anything. There's nothing to do now but take vengeance - since you are the senior Order officer now, it falls on you to lead our forces against the Cult and make them pay.^We don't know why they would be so bold to attack us here, as the Snake Cult usually operates from the shadows. I suggest finding more about their presence by questioning travelers - those staying in the taverns are notorious for useless gossip, but occasionally they might have a valuable clue. Start there, Constable, and good luck!",
    "close_window",
    [
      (quest_set_slot, "qst_order_grandmaster", 11, 2),
      (str_store_string, s3, "@Question travelers in taverns for clues about recent Snake Cult activity."),
      (add_quest_note_from_sreg, "qst_order_grandmaster", 2, s3, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_grandmaster"),
      (quest_slot_eq, "qst_order_grandmaster", 6, "$g_talk_troop"),
      (quest_slot_eq, "qst_order_grandmaster", 11, 3),
    ],
    "You bring valuable news, Constable. A hidden Cult stronghold near {s8} - as much as it sounds unlikely, that's where the Snake Cult assassins will be found, and destroyed by our hands, if the fates guide us.^I have received disturbing news from friendly Orders about attacks on their high-ranking members too - the Cult must have a devious plan to behead the Orders, the most valiant defenders of Pendor, and throw them into confusion. I fear we may soon expect grave news from Amala, foreboding a great invasion.^The task at hand for us, however, remains the destruction of the Snake Cult stronghold. You are bound by duty and honor to cleanse the stronghold and take it for our Order.^For this unique task we have many volunteers, Constable, so make sure you are prepared for an unrelenting siege assault. Good luck!",
    "close_window",
    [
      (party_set_flags, "p_snake_stronghold", 256, 0),
      (quest_get_slot, ":var0", "qst_order_grandmaster", 1),
      (str_store_party_name, s8, ":var0"),
      (quest_set_slot, "qst_order_grandmaster", 11, 4),
      (str_store_string, s3, "@Find and destroy the Snake Cult stronghold near {s8}."),
      (add_quest_note_from_sreg, "qst_order_grandmaster", 2, s3, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
      (jump_to_menu, "mnu_auto_grandmaster"),
      (assign, "$menu_control", 0),
      (finish_mission),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (check_quest_active, "qst_order_grandmaster"),
      (quest_slot_eq, "qst_order_grandmaster", 6, "$g_talk_troop"),
      (quest_slot_eq, "qst_order_grandmaster", 11, 5),
    ],
    "You bring glorious news, Grandmaster! Yes, in recognition of your leadership, the Order has acclaimed you as its next leader - with your presence at the helm, we hope to bring a new dawn to the people of Pendor. Recruitment has surged too as young warriors wish to join our ranks, and our renown is greater than ever, all thanks to you.^May your custodianship be marked with honor and glory!^^I thought you would like to know that we have already sent masons and laborers to rebuild the despicable Snake stronghold into a fortress more suitable to our Order's stature - work should be completed in about 2 months.",
    "close_window",
    [
      (quest_set_slot, "qst_order_grandmaster", 11, 6),
      (call_script, "script_succeed_quest", "qst_order_grandmaster"),
      (call_script, "script_end_quest", "qst_order_grandmaster"),
      (add_xp_to_troop, 5000, "trp_player"),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 12),
      (call_script, "script_change_troop_renown", "trp_player", 100),
      (call_script, "script_change_player_honor", 5),
      (faction_set_slot, "$g_talk_troop_faction", 72, 7),
      (play_sound, "snd_achievement_screen_fanfare"),
      (val_or, "$g_achieve_bits_delay_popup", 134217728),
      (assign, "$order_stronghold_upgrade_days", 60),
      (store_sub, ":var0", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var0", "trp_dragon_drake"),
      (party_clear, "p_snake_stronghold"),
      (party_add_members, "p_snake_stronghold", "$g_talk_troop", 50),
      (party_add_members, "p_snake_stronghold", ":var0", 80),
      (party_add_members, "p_snake_stronghold", "trp_mercenary_armcrossbow", 100),
      (party_add_members, "p_snake_stronghold", "trp_mercenary_swordsman", 100),
      (party_add_prisoners, "p_snake_stronghold", "trp_snake_follower", 20),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (lt, ":var0", 6),
      (call_script, "script_get_rank_from_rank_points", "$g_talk_troop_faction"),
      (lt, ":var0", reg0),
      (assign, ":var1", 0),
      (try_begin),
        (this_or_next|eq, reg0, 2),
        (this_or_next|eq, reg0, 4),
        (this_or_next|eq, reg0, 5),
        (eq, reg0, 6),
        (assign, ":var1", 1),
      (try_end),
      (store_free_inventory_capacity, ":var2"),
      (this_or_next|eq, ":var1", 0),
      (ge, ":var2", 6),
    ],
    "Congratulations, {playername}, your constant efforts to aid our cause earned you the right to call yourself {s8} of the Order of the {s12}.^Now, what can I do for you on this auspicious day?",
    "hall_order_guard_talk",
    [
      (call_script, "script_get_rank_from_rank_points", "$g_talk_troop_faction"),
      (assign, ":var0", reg0),
      (faction_set_slot, "$g_talk_troop_faction", 72, ":var0"),
      (val_sub, reg0, 1),
      (val_add, reg0, "str_order_rank_1"),
      (str_store_string, s8, reg0),
      (str_store_faction_name, s12, "$g_talk_troop_faction"),
      (play_sound, "snd_achievement_screen_fanfare"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (assign, ":var3", 0),
      (assign, ":var4", 0),
      (try_begin),
        (this_or_next|eq, ":var0", 4),
        (this_or_next|eq, ":var0", 5),
        (eq, ":var0", 6),
        (assign, ":var1", "$g_talk_troop"),
      (else_try),
        (eq, ":var0", 2),
        (faction_get_slot, ":var1", "$g_talk_troop_faction", 69),
      (try_end),
      (try_begin),
        (eq, ":var0", 5),
        (assign, ":var2", 27),
        (assign, ":var3", 35),
        (assign, ":var4", 25),
      (else_try),
        (eq, ":var0", 6),
        (assign, ":var2", 29),
        (assign, ":var3", 36),
        (assign, ":var4", 27),
      (try_end),
      (neq, ":var1", 0),
      (try_for_range, ":var5", 4, 8),
        (troop_get_inventory_slot, ":var6", ":var1", ":var5"),
        (try_begin),
          (ge, ":var6", 0),
          (try_begin),
            (eq, ":var0", 6),
            (eq, ":var1", "trp_griffon_knight"),
            (eq, ":var5", 5),
            (assign, ":var6", "itm_griffon_captain_armor_cape_black"),
          (try_end),
          (troop_add_item, "trp_player", ":var6", ":var2"),
        (try_end),
      (try_end),
      (troop_get_inventory_slot, ":var6", ":var1", ek_horse),
      (try_begin),
        (ge, ":var6", 0),
        (troop_add_item, "trp_player", ":var6", ":var3"),
      (try_end),
      (try_for_range, ":var5", 0, 4),
        (troop_get_inventory_slot, ":var6", ":var1", ":var5"),
        (try_begin),
          (ge, ":var6", 0),
          (item_get_type, ":var7", ":var6"),
          (eq, ":var7", 7),
          (troop_add_item, "trp_player", ":var6", ":var4"),
        (try_end),
      (try_end),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (lt, ":var0", 6),
      (call_script, "script_get_rank_from_rank_points", "$g_talk_troop_faction"),
      (lt, ":var0", reg0),
      (val_sub, reg0, 1),
      (val_add, reg0, "str_order_rank_1"),
      (str_store_string, s8, reg0),
      (str_store_faction_name, s12, "$g_talk_troop_faction"),
    ],
    "Congratulations, {playername}, your constant efforts to aid our cause earned you the right to call yourself {s8} of the Order of the {s12}. However, you'll need to make space for six Order items before you receive the honor.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (assign, ":var0", "$pop_arbalest_given"),
      (try_begin),
        (ge, ":var0", 10),
        (val_sub, ":var0", 10),
      (try_end),
      (eq, ":var0", 0),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 72),
      (ge, ":var1", 5),
      (store_proficiency_level, ":var2", "trp_player", wpt_crossbow),
      (ge, ":var2", 300),
      (store_sub, ":var3", ":var1", 1),
      (val_add, ":var3", "str_order_rank_1"),
      (str_store_string, s8, ":var3"),
    ],
    "Before anything else, {s8} {playername}, we have received a new advanced crossbow from our contact in Mettenheim.^Since you are an accomplished crossbowman yourself, maybe you would like to try it out?",
    "hall_order_guard_crossbow",
    []],

  [plyr|anyone, "hall_order_guard_crossbow",
    [
      (store_free_inventory_capacity, ":var0"),
      (eq, ":var0", 0),
    ],
    "Let me make room in my inventory first, I'll be right back.",
    "close_window",
    []],

  [plyr|anyone, "hall_order_guard_crossbow",
    [
      (store_free_inventory_capacity, ":var0"),
      (gt, ":var0", 0),
    ],
    "Of course I'm interested, let me have one.",
    "close_window",
    [
      (troop_add_item, "trp_player", "itm_arbalest", imod_plain),
      (val_add, "$pop_arbalest_given", 1),
      (call_script, "script_unlock_item_for_custom_troops", "itm_arbalest"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (item_slot_eq, "itm_arquebus_1", 65, 0),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (ge, ":var0", 5),
      (store_proficiency_level, ":var1", "trp_player", wpt_firearm),
      (ge, ":var1", 300),
      (store_sub, ":var2", ":var0", 1),
      (val_add, ":var2", "str_order_rank_1"),
      (str_store_string, s8, ":var2"),
    ],
    "Before anything else, {s8} {playername}, we have received a delivery from our contacts over in Barclay. They managed to ship us several hundred of their advanced weapons. Maybe you would like to try one out?",
    "hall_order_guard_musket",
    []],

  [plyr|anyone, "hall_order_guard_musket",
    [
      (store_free_inventory_capacity, ":var0"),
      (le, ":var0", 2),
    ],
    "Let me make room in my inventory first, I'll be right back. ^^^^^(min 3 empty slots are needed)",
    "close_window",
    []],

  [plyr|anyone, "hall_order_guard_musket",
    [
      (store_free_inventory_capacity, ":var0"),
      (gt, ":var0", 2),
    ],
    "Of course I'm interested, let me have one.",
    "close_window",
    [
      (troop_add_item, "trp_player", "itm_arquebus_1", imod_plain),
      (troop_add_item, "trp_player", "itm_bullets_1", imod_plain),
      (troop_add_item, "trp_player", "itm_bullets_1", imod_plain),
      (call_script, "script_unlock_item_for_custom_troops", "itm_arquebus_1"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_bullets_1"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (eq, "$g_talk_troop", "trp_griffon_knight"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (lt, "$pop_arbalest_given", 10),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (eq, ":var0", 7),
    ],
    "Grandmaster, please accept this set of armor that has been passed down to each Griffon Grandmaster that has proudly served our Order. Let this armor be an example to others that the Knights of the Griffon have returned to Pendor to serve its rightful leader and to fulfill Madigan's Prophecy.^^Currently the armor is not in an optimal shape, as it was hidden for a long time. However, a skilled blacksmith should be able to restore it to it's full glory.",
    "hall_order_guard_gm_armor",
    []],

  [plyr|anyone, "hall_order_guard_gm_armor",
    [
      (store_free_inventory_capacity, ":var0"),
      (eq, ":var0", 0),
    ],
    "Let me find a space in my inventory first.",
    "close_window",
    []],

  [plyr|anyone, "hall_order_guard_gm_armor",
    [
      (store_free_inventory_capacity, ":var0"),
      (gt, ":var0", 0),
    ],
    "Thank you and to the rest of the Order for this gift. I am honored.",
    "close_window",
    [
      (troop_add_item, "trp_player", "itm_griffon_grandmaster_armor", imod_rusty),
      (val_add, "$pop_arbalest_given", 10),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (eq, "$current_town", "p_snake_stronghold"),
      (is_between, "$g_talk_troop", "trp_dragon_drake", "trp_maiden_noble"),
    ],
    "We are under orders by the Constable to keep you safe, Grandmaster.",
    "close_window",
    []],

  [trp_player_knight, "start",
    [
      (eq, "$talk_context", 1),
    ],
    "It's always an honor to welcome the Founder of our glorious Order. Anything I can do to help?",
    "hall_order_guard_talk",
    []],

  [trp_player_sergeant, "start",
    [
      (eq, "$talk_context", 1),
    ],
    "It's always an honor to welcome the Founder of our glorious Order. Anything I can do to help?",
    "hall_order_sergeant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (faction_get_slot, ":var0", "$g_talk_troop_faction", 72),
      (val_sub, ":var0", 1),
      (val_add, ":var0", "str_order_rank_1"),
      (str_store_string, s8, ":var0"),
    ],
    "Greetings {s8} {playername}, it's always a pleasure to welcome one of our glorious Order. Anything I can do to help?",
    "hall_order_guard_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_drake", "trp_maiden_noble"),
      (store_sub, ":var0", "$g_talk_troop", "trp_dragon_drake"),
      (val_add, ":var0", "trp_dragon_knight"),
      (troop_slot_eq, "trp_player", 162, ":var0"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 72),
      (val_sub, ":var1", 1),
      (val_add, ":var1", "str_order_rank_1"),
      (str_store_string, s8, ":var1"),
    ],
    "Greetings {s8} {playername}, it's always a pleasure to welcome one of our glorious Order. Anything I can do to help?",
    "hall_order_sergeant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Do you have business with my Order, {reg63?my lord:my lady}?",
    "hall_order_guard_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_zombie"),
    ],
    "Do you have business with my Order, {reg63?sir:madam}?",
    "hall_order_guard_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_dragon_drake", "trp_maiden_noble"),
    ],
    "If you have business with my Order, {reg63?sir:madam}, you'd better speak to the Knight over there.",
    "hall_order_sergeant_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_novice_fighter", "trp_ramun_the_slave_trader"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (party_slot_eq, "$current_town", 7, "trp_player"),
    ],
    "Your orders, {reg63?my lord:my lady}?",
    "hall_guard_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_novice_fighter", "trp_ramun_the_slave_trader"),
      (is_between, "$g_encountered_party_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
    ],
    "We are not supposed to talk while on guard, {reg63?sir:madam}.",
    "close_window",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (faction_slot_eq, "$g_encountered_party_faction", 49, "$g_talk_troop"),
    ],
    "We are not supposed to talk while on guard, {reg63?sir:madam}.",
    "close_window",
    []],

  [plyr|anyone, "hall_guard_talk",
    [],
    "Stay on duty and let me know if anyone comes to see me.",
    "hall_guard_duty",
    []],

  [anyone, "hall_guard_duty",
    [],
    "Yes, {reg63?my lord:my lady}. As you wish.",
    "close_window",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (troop_slot_eq, "trp_player", 162, 0),
      (faction_slot_eq, "$g_talk_troop_faction", 72, 0),
      (troop_slot_ge, "trp_player", 7, 500),
      (assign, ":var0", "$g_talk_troop"),
      (assign, ":var1", 5),
      (try_begin),
        (this_or_next|eq, ":var0", "trp_shadow_centurion"),
        (this_or_next|eq, ":var0", "trp_shadowwolves_knight"),
        (this_or_next|eq, ":var0", "trp_empire_immortal"),
        (this_or_next|eq, ":var0", "trp_dshar_windrider"),
        (this_or_next|eq, ":var0", "trp_clarion_ranger"),
        (this_or_next|eq, ":var0", "trp_lion_knight"),
        (eq, ":var0", "trp_lady_valkyrie"),
        (assign, ":var1", 10),
      (else_try),
        (this_or_next|eq, ":var0", "trp_phoenix_knight"),
        (this_or_next|eq, ":var0", "trp_kraken_knight"),
        (this_or_next|eq, ":var0", "trp_dragon_knight"),
        (eq, ":var0", "trp_falcon_knight"),
        (assign, ":var1", 15),
      (else_try),
        (this_or_next|eq, ":var0", "trp_radiant_cross_knight"),
        (this_or_next|eq, ":var0", "trp_silvermist_ranger"),
        (this_or_next|eq, ":var0", "trp_griffon_knight"),
        (eq, ":var0", "trp_dawn_knight"),
        (assign, ":var1", 20),
      (try_end),
      (ge, "$player_honor", ":var1"),
    ],
    "I would like to join your Order!",
    "hall_order_join",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (eq, 0, 1),
    ],
    "CHEAT: Increase Order relations by +10",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 10),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (eq, 0, 1),
    ],
    "CHEAT: Decrease Order relations by -10",
    "close_window",
    [
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -10),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (eq, 0, 1),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (neq, "$g_talk_troop", "trp_player_knight"),
    ],
    "CHEAT: Increase Order rank points by +10",
    "close_window",
    [
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 10),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (eq, 0, 1),
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (neq, "$g_talk_troop", "trp_player_knight"),
    ],
    "CHEAT: Decrease Order rank points by -10",
    "close_window",
    [
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", -10),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [],
    "Is there anything I can do to help?",
    "order_choose_quest",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (player_has_item, "itm_book_heretic"),
    ],
    "I have found a strange book while fighting Heretics.",
    "order_sell_book_h",
    []],

  [anyone, "order_sell_book_h",
    [],
    "You've done well to bring the book to us - it is too dangerous for an untrained reader. Our scribes will lock it away safely for further study.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_book_heretic"),
      (call_script, "script_troop_add_gold", "trp_player", 1200),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 1),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 3),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (player_has_item, "itm_book_snake"),
    ],
    "I have found a strange book while fighting the Snake Cult.",
    "order_sell_book_s",
    []],

  [anyone, "order_sell_book_s",
    [],
    "You've done well to bring the book to us - it is too dangerous for an untrained reader. Our scribes will lock it away safely for further study.",
    "close_window",
    [
      (troop_remove_item, "trp_player", "itm_book_snake"),
      (call_script, "script_troop_add_gold", "trp_player", 1000),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 1),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 3),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (check_quest_active, "qst_order_bounty"),
      (quest_slot_eq, "qst_order_bounty", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_order_bounty", 10),
      (quest_slot_ge, "qst_order_bounty", 17, ":var0"),
    ],
    "I have bounties to claim.",
    "order_bounty_reward",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (check_quest_active, "qst_order_tournament"),
      (check_quest_succeeded, "qst_order_tournament"),
      (quest_slot_eq, "qst_order_tournament", 6, "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_order_tournament", 1),
      (str_store_party_name, s8, ":var0"),
    ],
    "I've won the {s8} tournament!",
    "order_tournament_reward",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (check_quest_active, "qst_order_challenge"),
      (check_quest_succeeded, "qst_order_challenge"),
      (quest_slot_eq, "qst_order_challenge", 6, "$g_talk_troop"),
    ],
    "I've won many victories for the Order!",
    "order_challenge_reward",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (check_quest_active, "qst_order_challenge"),
      (neg|check_quest_succeeded, "qst_order_challenge"),
      (neg|check_quest_failed, "qst_order_challenge"),
      (quest_slot_eq, "qst_order_challenge", 6, "$g_talk_troop"),
    ],
    "I wish to abandon the Order challenge and get my men back.",
    "order_challenge_abort",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (check_quest_active, "qst_order_rivalry"),
      (check_quest_succeeded, "qst_order_rivalry"),
      (quest_slot_eq, "qst_order_rivalry", 6, "$g_talk_troop"),
      (quest_slot_eq, "qst_order_rivalry", 12, "$current_town"),
      (quest_get_slot, ":var0", "qst_order_rivalry", 3),
      (str_store_faction_name, s8, ":var0"),
    ],
    "I have settled the problem with the {s8}.",
    "order_rivalry_reward",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
      (neg|check_quest_active, "qst_order_grandmaster"),
      (neg|faction_slot_eq, "$g_talk_troop_faction", 72, 7),
    ],
    "I wish to resign my membership with the Order.",
    "hall_order_resign_confirm",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [],
    "Tell me of your skills.",
    "start",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "hall_order_sergeant_talk",
    [],
    "Tell me of your skills.",
    "start",
    [
      (change_screen_view_character),
    ]],

  [plyr|anyone, "hall_order_guard_talk",
    [],
    "I wish to buy your armor set.",
    "buy_order_armour_set",
    []],

  [plyr|anyone, "hall_order_sergeant_talk",
    [],
    "I wish to buy your armor set.",
    "buy_order_armour_set",
    []],

  [plyr|anyone, "hall_order_guard_talk",
    [],
    "Not at present, thank you. Farewell.",
    "close_window",
    []],

  [plyr|anyone, "hall_order_sergeant_talk",
    [],
    "Ah, I see. Farewell.",
    "close_window",
    []],

  [anyone, "buy_order_armour_set",
    [
      (this_or_next|eq, "$g_talk_troop", "trp_player_knight"),
      (eq, "$g_talk_troop", "trp_player_sergeant"),
    ],
    "We can't sell our equipment. As you know {reg63?Sir:Madam}, this is against our codex.",
    "close_window",
    []],

  [anyone, "buy_order_armour_set",
    [
      (this_or_next|neq, "$g_talk_troop", "trp_player_knight"),
      (neq, "$g_talk_troop", "trp_player_sergeant"),
      (troop_get_slot, ":var0", "trp_player", 162),
      (store_troop_faction, ":var1", ":var0"),
      (faction_get_slot, ":var2", ":var1", 72),
      (eq, ":var2", 7),
      (store_relation, ":var3", "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (assign, ":var4", 0),
      (assign, ":var5", "$g_talk_troop"),
      (try_for_range, ":var6", 0, 9),
        (troop_get_inventory_slot, ":var7", ":var5", ":var6"),
        (try_begin),
          (ge, ":var7", 0),
          (store_item_value, ":var8", ":var7"),
          (val_add, ":var4", ":var8"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var4", 0),
        (assign, ":var4", 50000),
      (else_try),
        (store_mul, ":var9", ":var4", 26),
        (val_div, ":var9", 10),
        (store_mul, ":var10", ":var4", ":var3"),
        (val_div, ":var10", 100),
        (store_sub, ":var4", ":var9", ":var10"),
      (try_end),
      (assign, reg0, ":var4"),
      (assign, "$temp_2", ":var4"),
    ],
    "{reg63?Sir:Madam}, you are glorious knight, but nevertheless this set will cost you {reg0} in gold.",
    "buy_order_armour_set_1",
    []],

  [anyone, "buy_order_armour_set",
    [
      (this_or_next|neq, "$g_talk_troop", "trp_player_knight"),
      (neq, "$g_talk_troop", "trp_player_sergeant"),
      (troop_get_slot, ":var0", "trp_player", 162),
      (store_troop_faction, ":var1", ":var0"),
      (faction_get_slot, ":var2", ":var1", 72),
      (lt, ":var2", 7),
      (troop_slot_ge, "trp_player", 7, 1200),
      (ge, "$player_honor", 30),
      (store_relation, ":var3", "$g_talk_troop_faction", "fac_player_supporters_faction"),
      (ge, ":var3", 30),
      (assign, ":var4", 0),
      (assign, ":var5", "$g_talk_troop"),
      (try_for_range, ":var6", 0, 9),
        (troop_get_inventory_slot, ":var7", ":var5", ":var6"),
        (try_begin),
          (ge, ":var7", 0),
          (store_item_value, ":var8", ":var7"),
          (val_add, ":var4", ":var8"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var4", 0),
        (assign, ":var4", 50000),
      (else_try),
        (store_mul, ":var9", ":var4", 30),
        (val_div, ":var9", 10),
        (store_mul, ":var10", ":var4", ":var3"),
        (val_div, ":var10", 100),
        (store_sub, ":var4", ":var9", ":var10"),
      (try_end),
      (assign, reg0, ":var4"),
      (assign, "$temp_2", ":var4"),
    ],
    "{reg63?Sir:Madam}, you are glorious knight, but nevertheless this set will cost you {reg0} in gold.",
    "buy_order_armour_set_1",
    []],

  [anyone, "buy_order_armour_set",
    [],
    "We could share our equipment, but only with our beloved Grandmaster or well known and honorable knights, who are favorable to the Order. And you, {reg63?Sir:Madam}, are ... not one of them. ^^^^^^^(minimum 1200 renown, 30 honor, +30 relations)",
    "close_window",
    []],

  [plyr|anyone, "buy_order_armour_set_1",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", "$temp_2"),
    ],
    "It is too expensive.",
    "close_window",
    []],

  [plyr|anyone, "buy_order_armour_set_1",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", "$temp_2"),
    ],
    "Great price. I will take it.",
    "buy_order_armour_set_2",
    [
      (store_free_inventory_capacity, ":var0"),
      (try_begin),
        (ge, ":var0", 6),
        (assign, "$temp_3", 1),
      (else_try),
        (assign, "$temp_3", 0),
      (try_end),
    ]],

  [plyr|anyone, "buy_order_armour_set_1",
    [],
    "Maybe next time.",
    "close_window",
    []],

  [anyone, "buy_order_armour_set_2",
    [
      (eq, "$temp_3", 0),
    ],
    "{reg63?Sir:Madam}, there is not enough free space in your chest.",
    "close_window",
    []],

  [anyone, "buy_order_armour_set_2",
    [
      (eq, "$temp_3", 1),
    ],
    "{reg63?Sir:Madam}, wear your new armor with pride.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", "$temp_2"),
      (assign, ":var0", "$g_talk_troop"),
      (try_for_range, ":var1", 4, 9),
        (troop_get_inventory_slot, ":var2", ":var0", ":var1"),
        (try_begin),
          (ge, ":var2", 0),
          (troop_add_item, "trp_player", ":var2", imod_plain),
        (try_end),
      (try_end),
      (try_for_range, ":var1", 0, 4),
        (troop_get_inventory_slot, ":var2", ":var0", ":var1"),
        (try_begin),
          (ge, ":var2", 0),
          (item_get_type, ":var3", ":var2"),
          (eq, ":var3", 7),
          (troop_add_item, "trp_player", ":var2", imod_plain),
        (try_end),
      (try_end),
    ]],

  [trp_player_knight, "hall_order_resign_confirm",
    [],
    "I won't ask you what prompted you to make such a grave decision - but are you certain you wish to resign?",
    "hall_order_resign_confirm",
    []],

  [trp_player_knight, "hall_order_resign_finish",
    [],
    "This is a sad day indeed. Very well, from this day forward you are no longer a member of our Order, but you shall always remain our honored Founder.",
    "close_window",
    [
      (troop_set_slot, "trp_player", 162, 0),
      (call_script, "script_change_player_honor", -6),
      (try_for_range, ":var0", "fac_dragon_knights", "fac_player_knights"),
        (call_script, "script_change_player_relation_with_faction", ":var0", -5),
      (try_end),
    ]],

  [anyone, "hall_order_resign_confirm",
    [],
    "I won't ask you what prompted you to make such a grave decision - but are you certain you wish to resign?^You will be looked upon unfavorably by all Pendor Orders.",
    "hall_order_resign_confirm",
    []],

  [plyr|anyone, "hall_order_resign_confirm",
    [],
    "You are right, that would be dishonorable. Let us forget this.",
    "start",
    []],

  [plyr|anyone, "hall_order_resign_confirm",
    [],
    "Yes, I'm quite certain. I have my own reasons.",
    "hall_order_resign_finish",
    []],

  [anyone, "hall_order_resign_finish",
    [],
    "This is a sad day indeed. Very well, from this day forward you are no longer a member of our Order. May your judgment and honor serve you better in future.",
    "close_window",
    [
      (troop_set_slot, "trp_player", 162, 0),
      (call_script, "script_change_player_honor", -12),
      (try_for_range, ":var0", "fac_dragon_knights", "fac_player_knights"),
        (call_script, "script_change_player_relation_with_faction", ":var0", -5),
      (try_end),
      (call_script, "script_set_player_relation_with_faction", "$g_talk_troop_faction", 0),
    ]],

  [trp_player_knight, "hall_order_join",
    [],
    "But of course, {reg63?Sire:Madam}. As you are our founder, you will receive a rank of Honorary Grandmaster.^^^^^(WARNING: this order was created recently and doesn't have own 'Order Stronghold'; 'The Order Grandmaster' quest will be skipped as well)",
    "hall_order_join_1",
    []],

  [plyr|trp_player_knight, "hall_order_join_1",
    [],
    "I will accept the honor.",
    "hall_order_join_2",
    []],

  [plyr|trp_player_knight, "hall_order_join_1",
    [],
    "I need more time before making the decision.",
    "close_window",
    []],

  [trp_player_knight, "hall_order_join_2",
    [],
    "We shall be deeply honored by your membership.^Please give the squires a few minutes to fetch your complimentary armor set.",
    "close_window",
    [
      (assign, "$g_order_challenge_won", 1),
      (assign, "$g_order_challenge_troop", "$g_talk_troop"),
    ]],

  [anyone, "hall_order_join",
    [],
    "That is a serious request. Our Order admits only those worthy individuals who can best three of us in the arena. Are you ready for a test of arms? If you succeed, you will become one of us but will be forbidden to join any other Order.",
    "hall_order_join_confirm",
    []],

  [plyr|anyone, "hall_order_join_confirm",
    [],
    "I'm ready to join and will submit to the Order's test of arms!",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
      (assign, "$g_order_challenge_won", 0),
      (assign, "$g_order_challenge_troop", "$g_talk_troop"),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (party_get_slot, ":var0", "$g_encountered_party", 16),
      (else_try),
        (assign, ":var1", 100000),
        (assign, ":var2", -1),
        (try_for_range, ":var3", "p_town_1", "p_castle_1"),
          (store_distance_to_party_from_party, ":var4", ":var3", "p_main_party"),
          (lt, ":var4", ":var1"),
          (assign, ":var1", ":var4"),
          (assign, ":var2", ":var3"),
        (try_end),
        (party_get_slot, ":var0", ":var2", 16),
      (try_end),
      (modify_visitors_at_site, ":var0"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "$g_talk_troop"),
      (set_visitor, 2, "$g_talk_troop"),
      (set_visitor, 3, "$g_talk_troop"),
      (set_jump_mission, "mt_arena_heroic_challenge_fight"),
      (jump_to_scene, ":var0"),
    ]],

  [plyr|anyone, "hall_order_join_confirm",
    [],
    "On second thought, thank you, I don't think I want to join just now.",
    "close_window",
    []],

  [anyone, "order_choose_quest",
    [],
    "Why yes, {s4}. We do need some aid occasionally.",
    "order_choose_quest",
    [
      (str_store_string, s4, "@{playername}"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_player_knight"),
        (str_store_string, s4, "@honored Founder"),
      (else_try),
        (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
        (str_store_string, s4, "@dear {reg63?brother:sister}"),
      (try_end),
    ]],

  [plyr|anyone, "order_choose_quest",
    [
      (neg|check_quest_active, "qst_order_bounty"),
      (neg|quest_slot_ge, "qst_order_bounty", 25, 1),
      (neq, "$g_talk_troop", "trp_player_knight"),
    ],
    "I hear you have posted a bounty.",
    "order_bounty_talk",
    []],

  [plyr|anyone, "order_choose_quest",
    [
      (neg|check_quest_active, "qst_order_tournament"),
      (neg|quest_slot_ge, "qst_order_tournament", 25, 1),
      (troop_slot_ge, "trp_player", 7, 150),
    ],
    "I was told you are looking for a tournament champion.",
    "order_tournament_talk",
    []],

  [plyr|anyone, "order_choose_quest",
    [
      (neg|check_quest_active, "qst_order_challenge"),
      (neg|quest_slot_ge, "qst_order_challenge", 25, 1),
      (ge, "$g_talk_troop_faction_relation", 30),
    ],
    "I'm looking for a more challenging task.",
    "order_challenge_talk",
    []],

  [plyr|anyone, "order_choose_quest",
    [
      (neg|check_quest_active, "qst_order_rivalry"),
      (neg|quest_slot_ge, "qst_order_rivalry", 25, 1),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "fac_dragon_knights", "fac_noldor_castle"),
        (eq, ":var0", 0),
        (neq, ":var1", "$g_talk_troop_faction"),
        (store_relation, ":var2", "$g_talk_troop_faction", ":var1"),
        (lt, ":var2", 0),
        (store_sub, ":var3", ":var1", "fac_dragon_knights"),
        (val_add, ":var3", "trp_dragon_knight"),
        (try_for_range, ":var4", "p_town_1", "p_village_1"),
          (eq, ":var0", 0),
          (party_slot_eq, ":var4", 289, ":var3"),
          (assign, ":var0", 1),
        (try_end),
      (try_end),
      (eq, ":var0", 1),
    ],
    "I've heard you have problems with rivals.",
    "order_rivalry_talk",
    []],

  [plyr|anyone, "order_choose_quest",
    [],
    "On second thought, I have more pressing matters.",
    "close_window",
    []],

  [anyone, "order_bounty_talk",
    [],
    "Very well, {s4}. I want you to hunt down as many as you can of those {s5} {s6}.^Are you up for some bounty hunting?",
    "order_bounty_talk_2",
    [
      (str_store_string, s4, "@{playername}"),
      (try_begin),
        (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
        (str_store_string, s4, "@dear {reg63?brother:sister}"),
      (try_end),
      (str_store_string, s5, "str_empty_string"),
      (store_sub, ":var0", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var0", "str_insult_1"),
      (str_store_string, s5, ":var0"),
      (str_store_string, s6, "str_empty_string"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 100),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 102),
      (try_begin),
        (gt, ":var1", 0),
        (str_store_faction_name, s6, ":var1"),
      (else_try),
        (gt, ":var2", 0),
        (spawn_around_party, "p_main_party", ":var2"),
        (str_store_party_name, s6, reg0),
        (remove_party, reg0),
      (else_try),
        (str_store_string, s6, "@The Lazy POP Developers"),
      (try_end),
      (str_store_string, s7, "str_empty_string"),
      (faction_get_slot, ":var1", "$g_talk_troop_faction", 101),
      (faction_get_slot, ":var2", "$g_talk_troop_faction", 103),
      (try_begin),
        (gt, ":var1", 0),
        (str_store_faction_name, s7, ":var1"),
      (else_try),
        (gt, ":var2", 0),
        (spawn_around_party, "p_main_party", ":var2"),
        (str_store_party_name, s7, reg0),
        (remove_party, reg0),
      (try_end),
      (try_begin),
        (this_or_next|gt, ":var1", 0),
        (gt, ":var2", 0),
        (str_store_string, s8, "@{s6} and {s7}"),
        (str_store_string, s6, "@{s6}, and any {s7}, too"),
      (else_try),
        (str_store_string_reg, s8, s6),
        (str_store_string, s6, "@{s6}"),
      (try_end),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
      (setup_quest_text, "qst_order_bounty"),
      (store_character_level, ":var3", "trp_player"),
      (val_mul, ":var3", 100),
      (val_add, ":var3", 1500),
      (quest_set_slot, "qst_order_bounty", 17, 0),
      (quest_set_slot, "qst_order_bounty", 10, ":var3"),
      (assign, reg4, ":var3"),
      (quest_set_slot, "qst_order_bounty", 23, 20),
      (quest_set_slot, "qst_order_bounty", 24, 7),
      (str_store_string, s2, "@The {s9} asked you to hunt down {s8} parties, while achieving a rating of {reg4} or more."),
      (str_store_string, s3, "@Current progress: 0/{reg4}."),
      (add_quest_note_from_sreg, "qst_order_bounty", 3, s3, 0),
    ]],

  [plyr|anyone, "order_bounty_talk_2",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "I will gladly help my Order.",
    "order_bounty_talk_accept",
    []],

  [plyr|anyone, "order_bounty_talk_2",
    [
      (neg|troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "I can hunt down your enemies.",
    "order_bounty_talk_accept",
    []],

  [anyone, "order_bounty_talk_accept",
    [],
    "That's the spirit! Destroy as many as you can, and the Order will favor you.",
    "close_window",
    [
      (call_script, "script_start_quest", "qst_order_bounty", "$g_talk_troop"),
    ]],

  [plyr|anyone, "order_bounty_talk_2",
    [],
    "On second thought, I have more pressing matters.",
    "order_talk_move_on",
    []],

  [anyone, "order_talk_move_on",
    [],
    "I see. Anything else?",
    "hall_order_guard_talk",
    []],

  [anyone, "order_bounty_reward",
    [],
    "Superb work, {playername}. Pendor is yet to be rid of our enemies, but thanks to you, that day is not too far.^Our Order is grateful.",
    "close_window",
    [
      (try_begin),
        (neg|check_quest_succeeded, "qst_order_bounty"),
        (call_script, "script_succeed_quest", "qst_order_bounty"),
      (try_end),
      (call_script, "script_end_quest", "qst_order_bounty"),
      (quest_get_slot, ":var0", "qst_order_bounty", 10),
      (quest_get_slot, ":var1", "qst_order_bounty", 17),
      (assign, ":var2", ":var1"),
      (assign, ":var3", ":var1"),
      (val_sub, ":var1", ":var0"),
      (val_div, ":var1", 1000),
      (val_add, ":var1", 3),
      (val_clamp, ":var1", 3, 10),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", ":var1"),
      (val_add, ":var1", 6),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", ":var1"),
      (val_div, ":var2", 7),
      (val_add, ":var2", 200),
      (add_xp_as_reward, ":var2"),
      (val_div, ":var3", 5),
      (val_add, ":var3", 400),
      (call_script, "script_troop_add_gold", "trp_player", ":var3"),
      (store_random_in_range, ":var4", 1, 101),
      (try_begin),
        (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
        (troop_get_inventory_slot, ":var5", "$g_talk_troop", ek_head),
        (troop_get_inventory_slot, ":var6", "$g_talk_troop", ek_body),
        (troop_get_inventory_slot, ":var7", "$g_talk_troop", ek_foot),
        (troop_get_inventory_slot, ":var8", "$g_talk_troop", ek_gloves),
        (troop_get_inventory_capacity, ":var9", "trp_player"),
        (assign, "$temp", 0),
        (try_for_range, ":var10", 10, ":var9"),
          (troop_get_inventory_slot, ":var11", "trp_player", ":var10"),
          (lt, ":var11", 0),
          (val_add, "$temp", 1),
        (try_end),
        (ge, "$temp", 1),
        (try_begin),
          (lt, ":var4", 6),
          (ge, ":var6", 0),
          (try_begin),
            (gt, ":var1", 8),
            (troop_add_item, "trp_player", ":var6", imod_lordly),
          (else_try),
            (gt, ":var1", 5),
            (troop_add_item, "trp_player", ":var6", imod_reinforced),
          (else_try),
            (troop_add_item, "trp_player", ":var6"),
          (try_end),
          (str_store_item_name, s11, ":var6"),
          (display_message, "@You received a {s11}!"),
        (else_try),
          (lt, ":var4", 11),
          (ge, ":var8", 0),
          (try_begin),
            (gt, ":var1", 5),
            (troop_add_item, "trp_player", ":var8", imod_thick),
          (else_try),
            (troop_add_item, "trp_player", ":var8"),
          (try_end),
          (str_store_item_name, s11, ":var8"),
          (display_message, "@You received {s11}!"),
        (else_try),
          (lt, ":var4", 16),
          (ge, ":var7", 0),
          (try_begin),
            (gt, ":var1", 5),
            (troop_add_item, "trp_player", ":var7", imod_thick),
          (else_try),
            (troop_add_item, "trp_player", ":var7"),
          (try_end),
          (str_store_item_name, s11, ":var7"),
          (display_message, "@You received {s11}!"),
        (else_try),
          (lt, ":var4", 21),
          (ge, ":var5", 0),
          (try_begin),
            (gt, ":var1", 5),
            (troop_add_item, "trp_player", ":var5", imod_thick),
          (else_try),
            (troop_add_item, "trp_player", ":var5"),
          (try_end),
          (str_store_item_name, s11, ":var5"),
          (display_message, "@You received a {s11}!"),
        (try_end),
        (val_add, ":var4", 30),
      (try_end),
      (val_add, ":var4", ":var1"),
      (try_begin),
        (gt, ":var4", 79),
        (neg|check_quest_active, "qst_order_challenge"),
        (store_random_in_range, ":var12", 4, ":var1"),
        (store_sub, ":var13", "$g_talk_troop", "trp_dragon_knight"),
        (val_add, ":var13", "trp_dragon_drake"),
        (party_add_members, "p_main_party", ":var13", ":var12"),
        (str_store_troop_name_by_count, s11, ":var13", ":var12"),
        (display_message, "@{s11} joined your party!"),
        (gt, ":var4", 99),
        (store_random_in_range, ":var12", 1, 5),
        (party_add_members, "p_main_party", "$g_talk_troop", ":var12"),
        (str_store_troop_name_by_count, s11, "$g_talk_troop", ":var12"),
        (display_message, "@{s11} joined your party!"),
      (try_end),
    ]],

  [anyone, "order_tournament_talk",
    [
      (neg|troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "Huh? We are only looking among our membership, I'm sorry. Anything else?",
    "hall_order_guard_talk",
    []],

  [anyone, "order_tournament_talk",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_castle_1"),
        (party_slot_ge, ":var1", 156, 1),
        (store_faction_of_party, ":var2", ":var1"),
        (store_relation, ":var3", ":var2", "fac_player_faction"),
        (ge, ":var3", 0),
        (val_add, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
    ],
    "Hmm, I haven't heard about any tournaments open to you these days, but we may need a champion some time next week. Anything else?",
    "hall_order_guard_talk",
    []],

  [anyone, "order_tournament_talk",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_castle_1"),
        (party_slot_ge, ":var1", 156, 1),
        (store_faction_of_party, ":var2", ":var1"),
        (store_relation, ":var3", ":var2", "fac_player_faction"),
        (ge, ":var3", 0),
        (val_add, ":var0", 1),
      (try_end),
      (store_random_in_range, ":var4", 0, ":var0"),
      (try_for_range, ":var1", "p_town_1", "p_castle_1"),
        (ge, ":var4", 0),
        (party_slot_ge, ":var1", 156, 1),
        (store_faction_of_party, ":var2", ":var1"),
        (store_relation, ":var3", ":var2", "fac_player_faction"),
        (ge, ":var3", 0),
        (try_begin),
          (eq, ":var4", 0),
          (quest_set_slot, "qst_order_tournament", 1, ":var1"),
          (str_store_party_name, s8, ":var1"),
        (try_end),
        (val_sub, ":var4", 1),
      (try_end),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
      (setup_quest_text, "qst_order_tournament"),
      (quest_set_slot, "qst_order_tournament", 23, 7),
      (quest_set_slot, "qst_order_tournament", 24, 15),
      (str_store_string, s2, "@The {s9} asked you to win the {s8} tournament for the glory of their Order."),
    ],
    "Hmm, yes, you might be a suitable candidate. We are looking for Order members that are skilled in the arena.^We want you to go to {s8} and enter the tournament there on behalf of the {s9}. Win the tournament, forfeiting any rewards, and spread the glory of the {s9} across Pendor! Lose... well, let's not consider that.^Do you have what it takes to be a champion, {playername}?",
    "order_tournament_talk_2",
    []],

  [plyr|anyone, "order_tournament_talk_2",
    [],
    "I would be proud to champion my Order!",
    "order_tournament_talk_accept",
    []],

  [anyone, "order_tournament_talk_accept",
    [],
    "Excellent! Show the citizens of {s8} and all of Pendor which Order is the finest. And please hurry, we don't want to forfeit the tournament by default.",
    "close_window",
    [
      (call_script, "script_start_quest", "qst_order_tournament", "$g_talk_troop"),
      (quest_get_slot, ":var0", "qst_order_tournament", 1),
      (party_set_slot, ":var0", 156, 9),
    ]],

  [plyr|anyone, "order_tournament_talk_2",
    [],
    "On second thought, I may need more practice first.",
    "order_talk_move_on",
    []],

  [anyone, "order_tournament_reward",
    [
      (quest_get_slot, ":var0", "qst_order_tournament", 1),
      (str_store_party_name, s8, ":var0"),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ],
    "Welcome, Champion of the {s9}! Your superb win at {s8} shall be the talk of Pendor for weeks to come.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_tournament"),
      (add_xp_to_troop, 1000, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 30),
      (call_script, "script_change_player_honor", 4),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 5),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 8),
    ]],

  [anyone, "order_challenge_talk",
    [
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
      (store_character_level, ":var0", "trp_player"),
      (val_mul, ":var0", 5),
      (val_add, ":var0", 50),
      (quest_set_slot, "qst_order_challenge", 17, 0),
      (quest_set_slot, "qst_order_challenge", 10, ":var0"),
      (quest_set_slot, "qst_order_challenge", 23, 20),
      (quest_set_slot, "qst_order_challenge", 24, 15),
      (setup_quest_text, "qst_order_challenge"),
      (assign, reg8, ":var0"),
      (str_store_string, s2, "@The {s9} asked you to win {reg8} renown for the glory of their Order, using only Order troops. No hiring, recruiting or rescuing prisoners is possible for the duration of this task.^You will get back your old troops once the task is complete."),
      (str_store_string, s3, "@Renown earned so far: 0."),
      (add_quest_note_from_sreg, "qst_order_challenge", 3, s3, 0),
      (str_store_troop_name_plural, s10, "$g_talk_troop"),
      (store_sub, ":var1", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var1", "trp_dragon_drake"),
      (str_store_troop_name_plural, s11, ":var1"),
    ],
    "A challenge? Well, you might be able to accomplish a feat worthy of the {s9}. Be warned though, it's dangerous and requires skillful generalship.^You are to lead a force of chosen {s10} and {s11} into battle and win renown across Pendor's battlefields. Defeat is not a possibility!^Your current troops will be awaiting your return here safely, but your companions can remain with you at all times.^What do you say?",
    "order_challenge_talk_2",
    []],

  [plyr|anyone, "order_challenge_talk_2",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "I'll leave my troops here and win victories for my Order!",
    "order_challenge_talk_accept",
    []],

  [plyr|anyone, "order_challenge_talk_2",
    [
      (neg|troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "I'll leave my troops here - I can lead the Order troops to victory.",
    "order_challenge_talk_accept",
    []],

  [anyone, "order_challenge_talk_accept",
    [],
    "I'm impressed with your resolve. Lead our soldiers with skill and care, and you'll earn the gratitude of our Order.",
    "close_window",
    [
      (call_script, "script_start_quest", "qst_order_challenge", "$g_talk_troop"),
      (spawn_around_party, "p_battlefields", "pt_none"),
      (assign, ":var0", reg0),
      (quest_set_slot, "qst_order_challenge", 8, ":var0"),
      (party_set_ai_behavior, ":var0", ai_bhvr_hold),
      (party_set_flags, ":var0", 16384, 0),
      (party_clear, "p_temp_party"),
      (party_get_num_companion_stacks, ":var1", "p_main_party"),
      (try_for_range_backwards, ":var2", 0, ":var1"),
        (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
        (neg|troop_is_hero, ":var3"),
        (party_stack_get_size, ":var4", "p_main_party", ":var2"),
        (party_add_members, "p_temp_party", ":var3", ":var4"),
        (party_stack_get_num_wounded, ":var5", "p_main_party", ":var2"),
        (party_wound_members, "p_temp_party", ":var3", ":var5"),
        (party_remove_members, "p_main_party", ":var3", ":var4"),
      (try_end),
      (party_get_num_companion_stacks, ":var1", "p_temp_party"),
      (try_for_range_backwards, ":var2", 0, ":var1"),
        (party_stack_get_troop_id, ":var3", "p_temp_party", ":var2"),
        (party_stack_get_size, ":var4", "p_temp_party", ":var2"),
        (party_add_members, ":var0", ":var3", ":var4"),
        (party_stack_get_num_wounded, ":var5", "p_temp_party", ":var2"),
        (party_wound_members, ":var0", ":var3", ":var5"),
        (party_remove_members, "p_temp_party", ":var3", ":var4"),
      (try_end),
      (store_character_level, ":var6", "trp_player"),
      (val_mul, ":var6", 3),
      (val_div, ":var6", 2),
      (val_sub, ":var6", 10),
      (val_max, ":var6", 1),
      (store_mul, ":var7", ":var6", 8),
      (val_div, ":var7", 5),
      (val_max, ":var7", 2),
      (store_random_in_range, ":var8", -5, 6),
      (val_add, ":var6", ":var8"),
      (store_random_in_range, ":var8", -10, 11),
      (val_add, ":var7", ":var8"),
      (party_add_members, "p_main_party", "$g_talk_troop", ":var6"),
      (store_sub, ":var9", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var9", "trp_dragon_drake"),
      (party_add_members, "p_main_party", ":var9", ":var7"),
    ]],

  [plyr|anyone, "order_challenge_talk_2",
    [],
    "On second thought, I can't be parted with my men.",
    "order_talk_move_on",
    []],

  [anyone, "order_challenge_reward",
    [
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ],
    "We have all heard of your glorious victories, knight commander! The brave soldiers of the {s9} deserve to be led only by the best.^Of course, your old soldiers are anxious to rejoin you. You may be delighted to know that I have been approached by a number of knights and sergeants, and many of them want to continue in your service. Bring them more victories!",
    "order_challenge_reward_mercs",
    [
      (call_script, "script_end_quest", "qst_order_challenge"),
      (add_xp_to_troop, 3000, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 50),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 8),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 14),
      (party_clear, "p_temp_party"),
      (party_count_companions_of_type, ":var0", "p_main_party", "$g_talk_troop"),
      (store_sub, ":var1", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var1", "trp_dragon_drake"),
      (party_count_companions_of_type, ":var2", "p_main_party", ":var1"),
      (party_remove_members, "p_main_party", "$g_talk_troop", ":var0"),
      (party_remove_members, "p_main_party", ":var1", ":var2"),
      (assign, ":var3", "$g_talk_troop_faction_relation"),
      (val_clamp, ":var3", 30, 70),
      (val_mul, ":var0", ":var3"),
      (val_div, ":var0", 100),
      (val_mul, ":var2", ":var3"),
      (val_div, ":var2", 100),
      (party_add_members, "p_temp_party", "$g_talk_troop", ":var0"),
      (party_add_members, "p_temp_party", ":var1", ":var2"),
      (quest_get_slot, ":var4", "qst_order_challenge", 8),
      (try_begin),
        (party_is_active, ":var4"),
        (call_script, "script_party_add_party_companions", "p_main_party", ":var4"),
        (remove_party, ":var4"),
      (try_end),
    ]],

  [plyr|anyone, "order_challenge_reward_mercs",
    [],
    "I'll gratefully accept their service.",
    "order_talk_move_on",
    [
      (change_screen_exchange_members, -1, "p_temp_party"),
    ]],

  [anyone, "order_challenge_abort",
    [],
    "That's very disappointing, {playername}. If you can't complete a challenge, then don't ask for one.^We'll immediately recall our soldiers and let your old soldiers rejoin you, they were nothing but a pestilence here, always rummaging through the Order pantries. Farewell.",
    "close_window",
    [
      (call_script, "script_fail_quest", "qst_order_challenge"),
      (call_script, "script_end_quest", "qst_order_challenge"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", -4),
      (party_count_companions_of_type, ":var0", "p_main_party", "$g_talk_troop"),
      (store_sub, ":var1", "$g_talk_troop", "trp_dragon_knight"),
      (val_add, ":var1", "trp_dragon_drake"),
      (party_count_companions_of_type, ":var2", "p_main_party", ":var1"),
      (party_remove_members, "p_main_party", "$g_talk_troop", ":var0"),
      (party_remove_members, "p_main_party", ":var1", ":var2"),
      (quest_get_slot, ":var3", "qst_order_challenge", 8),
      (try_begin),
        (party_is_active, ":var3"),
        (call_script, "script_party_add_party_companions", "p_main_party", ":var3"),
        (remove_party, ":var3"),
      (try_end),
    ]],

  [anyone, "order_rivalry_talk",
    [
      (assign, ":var0", 0),
      (try_for_range, ":var1", "fac_dragon_knights", "fac_noldor_castle"),
        (neq, ":var1", "$g_talk_troop_faction"),
        (store_relation, ":var2", "$g_talk_troop_faction", ":var1"),
        (lt, ":var2", 0),
        (faction_get_slot, ":var3", ":var1", 68),
        (assign, ":var4", "p_village_1"),
        (try_for_range, ":var5", "p_town_1", ":var4"),
          (party_slot_eq, ":var5", 289, ":var3"),
          (val_add, ":var0", 1),
          (assign, ":var4", 0),
        (try_end),
      (try_end),
      (store_random_in_range, ":var6", 0, ":var0"),
      (val_add, ":var6", 1),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (try_for_range, ":var1", "fac_dragon_knights", "fac_noldor_castle"),
        (eq, ":var7", 0),
        (neq, ":var1", "$g_talk_troop_faction"),
        (store_relation, ":var2", "$g_talk_troop_faction", ":var1"),
        (lt, ":var2", 0),
        (faction_get_slot, ":var3", ":var1", 68),
        (assign, ":var4", "p_village_1"),
        (try_for_range, ":var5", "p_town_1", ":var4"),
          (party_slot_eq, ":var5", 289, ":var3"),
          (assign, ":var4", 0),
          (val_sub, ":var6", 1),
          (eq, ":var6", 0),
          (assign, ":var7", ":var1"),
          (assign, ":var8", ":var5"),
        (try_end),
      (try_end),
      (quest_set_slot, "qst_order_rivalry", 3, ":var7"),
      (quest_set_slot, "qst_order_rivalry", 1, ":var8"),
      (str_store_faction_name, s8, ":var7"),
      (str_store_party_name, s9, ":var8"),
      (str_store_party_name, s10, "$g_encountered_party"),
    ],
    "You've heard that too, {reg63?sir:madam}?^We do have an ongoing feud with the {s8} based in {s9}. While the history between our two Orders have been difficult at best, they seem to want to escalate the conflict further.^They have sent louts and mercenaries to harass our patrols around {s10} - this is unacceptable and they must be stopped. Will you do us a favor and drive off the interlopers?",
    "order_rivalry_talk_2",
    []],

  [plyr|anyone, "order_rivalry_talk_2",
    [
      (troop_slot_eq, "trp_player", 162, "$g_talk_troop"),
    ],
    "I am bound by my honor to do so.",
    "order_rivalry_talk_accept",
    []],

  [plyr|anyone, "order_rivalry_talk_2",
    [],
    "Certainly, the {s8} are not my friends.",
    "order_rivalry_talk_accept",
    []],

  [plyr|anyone, "order_rivalry_talk_2",
    [],
    "Sorry, I don't wish any quarrel with the {s8}.",
    "order_talk_move_on",
    []],

  [anyone, "order_rivalry_talk_accept",
    [],
    "For a moment, I thought you would refuse - I'm glad you are on the right side of this argument. The rival patrol is in the vicinity of {s10}, seek it out and defeat it.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_order_rivalry", 3),
      (spawn_around_party, "$g_encountered_party", "pt_errant_knights"),
      (assign, ":var1", reg0),
      (quest_set_slot, "qst_order_rivalry", 8, ":var1"),
      (party_set_faction, ":var1", ":var0"),
      (party_set_name, ":var1", "@Rival Patrol"),
      (quest_get_slot, ":var2", "qst_order_rivalry", 1),
      (party_set_slot, ":var1", 123, ":var2"),
      (party_set_ai_behavior, ":var1", ai_bhvr_patrol_party),
      (party_set_ai_object, ":var1", "$g_encountered_party"),
      (store_sub, ":var3", ":var0", "fac_dragon_knights"),
      (store_add, ":var4", ":var3", "trp_dragon_drake"),
      (val_add, ":var3", "trp_dragon_knight"),
      (store_random_in_range, ":var5", 10, 26),
      (party_add_members, ":var1", ":var3", ":var5"),
      (store_random_in_range, ":var6", 18, 40),
      (party_add_members, ":var1", ":var4", ":var6"),
      (setup_quest_text, "qst_order_rivalry"),
      (str_store_faction_name, s11, "$g_talk_troop_faction"),
      (str_store_string, s2, "@The {s11} asked you to defeat the {s8} patrol in the vicinity of {s10}."),
      (quest_set_slot, "qst_order_rivalry", 12, "$g_encountered_party"),
      (quest_set_slot, "qst_order_rivalry", 23, 5),
      (quest_set_slot, "qst_order_rivalry", 24, 21),
      (call_script, "script_start_quest", "qst_order_rivalry", "$g_talk_troop"),
    ]],

  [anyone, "order_rivalry_reward",
    [
      (quest_get_slot, ":var0", "qst_order_rivalry", 3),
      (str_store_faction_name, s8, ":var0"),
      (str_store_faction_name, s9, "$g_talk_troop_faction"),
    ],
    "Well done, {playername}! The {s8} shall think twice before attacking the {s9} the next time.",
    "close_window",
    [
      (call_script, "script_end_quest", "qst_order_rivalry"),
      (add_xp_to_troop, 700, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_player_relation_with_faction", "$g_talk_troop_faction", 3),
      (call_script, "script_change_rank_points_with_order", "$g_talk_troop_faction", 6),
    ]],

  [anyone, "enemy_defeated",
    [],
    "Arggh! I hate this.",
    "close_window",
    []],

  [anyone, "party_relieved",
    [],
    "Thank you for helping us against those bastards.",
    "close_window",
    []],

  [anyone, "start",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (gt, ":var0", 0),
      (party_is_active, ":var0"),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (eq, ":var1", "$g_talk_troop"),
      (le, "$talk_context", 4),
      (troop_slot_eq, "$g_talk_troop", 80, 0),
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Greetings, {reg63?King:Queen} {playername}.^I am Kapitan Gerhart and this company is called The Freybrueder. We hail from Mettenheim and are known as the best disciplined mercenary company gold can persuade into service."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Hail, foreign {reg63?King:Queen}. I am Toblik, a Veccavian Uncut, and this is my loyal warband of Veccavian Renegades.^We came to Pendor to escape the female oppression and injustices in our homeland, but only found more injustice. Your women are treated no better than the men of Veccavia.^One day, rivers will run red with blood in the name of justice, but until then, we are at the service of the Pendor mighty such as yourself."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Greetings from Barclay's finest company, {reg63?King:Queen} {playername}!^My name is Velasco Perfecta Banderas Durante, the captain of the Primera Guardia Real, but you may call me Velasco.^We are here in Pendor to look for the dastardly fugitive Rufio and bring his head to the Emperor.^In the meantime, we are pleased to take up work that we know best, and that's killing."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Hail, {reg63?King:Queen}!^We were told that you made an effort to help us Melitines in Pendor, so here we are. I'm on a business here with my company to investigate certain goings on with the Snake Cult, but we are not prepared to face their full might alone.^We shall help you, and watch. Always watch."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@Good day, {reg63?King:Queen} {playername}! You chose well to hire the pride of the Marleons citizenry.^I am Grandilon, the commander of the best riders in Sarleon: the 1st Banneret of Marleons. We have among our numbers the most prominent and proud burghers of our great city - treat us with respect and we'll sweep your enemies off the battlefield."),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@Greetings, your Majesty. Allow me to introduce myself: I am Sir Timothy of the Order of the Unicorn, and I am here to answer your call for heroes! My knights and loyal followers are yours to command!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Hello, friend! I've heard you needed someone to 'juice' you... er... reinforce your armies, all for the good of the common people of Pendor, I hope.^I field a fine party of brothers experienced both in combat and, some of them, imprisonment until they met me.^For a bit of cash and a fair portion of prisoners, captured or rescued, we shall exact revenge on your enemies... heh... for whatever misdeeds they inflicted upon your friends and allies. Or my friends and allies. We'll find a reason, I'm sure."),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@Hail, I am Sir Morcas Verral, the leader of the famous Snowlion Brigade. We will fight for anyone who strives to reunite the north with the heartlands. Besides, our treasury has been rather empty as of late, so if you pay us, we shall lend you our strength."),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Salam! May your gardens be full of rose blossoms and your tents with healthy maidens and boys.^Firuz has heard of your exploits and comes to serve you, great Shah.^He will only require modest gifts in gold - a mere pittance to the powerful friend of the Singalians - and a humble share of the slaves."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@Hazah Jatu! Shiruzah, the Chosen of Indar, salutes you.^Shiruzah was shot by an arrow while riding away from battle in a false retreat. The chiefs cried coward and sent Shiruzah into exile. But the arrow was Indar's - I survived and he watches now over me. Indar guides His chosen, and He led me to meet you today."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@So you are the new {reg63?King:Queen} I have been hearing about.^I must say, I am really glad you summoned me. Not only will this enable me to claim once again to have worked for every single monarch on Pendor, but it also provides me with the chance to thank you personally for all the trouble and misery you have caused. You have no idea just how good the establishment of a new kingdom is for business."),
      (else_try),
        (str_store_string, s4, "@HELLO!"),
      (try_end),
    ],
    "{s4}",
    "player_merc_talk",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [anyone, "start",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (gt, ":var0", 0),
      (party_is_active, ":var0"),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (eq, ":var1", "$g_talk_troop"),
      (le, "$talk_context", 4),
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@New orders, {reg63?Sir:Lady}?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Hail! Shall we converse about the quaint injustices of Pendor or put our consciences to sleep by more slaughter?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Your enemies are my enemies, {playername}."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Watching and waiting."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@I haven't seen the Duke of Marleons as often as you, {reg63?sir:madam}!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@You summoned me, your Majesty? Does the Kingdom need saving once more?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Talk to me, my friend."),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@What is your bidding, {reg63?Sir:Madam}?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Yes, Shah, Firuz saw the vultures in the skies and knew it was you."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@Lead us to more victories, Warlord, and our honor will be known in the Jatu steppes."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Hello {playername}, we meet again! Any rumors you may have heard of me going over to your enemies is, of course, a blatant lie."),
      (else_try),
        (str_store_string, s4, "@HELLO AGAIN!"),
      (try_end),
    ],
    "{s4}",
    "player_merc_talk",
    []],

  [plyr|anyone, "player_merc_talk",
    [],
    "I have a new task for you.",
    "player_merc_give_order_ask",
    []],

  [plyr|anyone, "player_merc_talk",
    [],
    "I don't need your services anymore.",
    "player_merc_dismiss",
    []],

  [plyr|anyone, "player_merc_talk",
    [],
    "Never mind, carry on.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "player_merc_give_order_ask",
    [
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@If it's worth doing, it's worth doing well, my {reg63?Lord:Lady}."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@There's no task too evil or too hard when your final destination is worthy."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Show us who and they will pay with their blood."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Something needs to be done? We are ready."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@We are well-equipped and rested. What shall we do next?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@Well, of course! How can my order be of service?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Shall we help the village militias repel the unwashed Fierdsvain masses or simply humiliate some bungling lords?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@I hope it involves killing traitors in kilts."),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Your wisdom is legendary, great Shah, but a smart stallion never steps in a rabbit-hole no matter the rider's spurs. Neither does a wise rider watch the skies while in full gallop."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@The Chosen of Indar wait for guidance."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Well, that is what you are paying us for, is it not? What do you have in mind?"),
      (else_try),
        (str_store_string, s4, "@WHAT TASK?"),
      (try_end),
    ],
    "{s4}",
    "player_merc_give_order",
    []],

  [plyr|anyone, "player_merc_give_order",
    [],
    "Follow me.",
    "player_merc_give_order_answer",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (party_set_ai_behavior, ":var0", ai_bhvr_escort_party),
      (party_set_ai_object, ":var0", "p_main_party"),
      (party_set_flags, ":var0", 65536, 0),
      (1606, ":var0", 1),
      (1607, ":var0", 15),
      (party_set_ai_initiative, ":var0", 5),
    ]],

  [plyr|anyone, "player_merc_give_order",
    [],
    "Go to...",
    "player_merc_give_order_details_ask",
    [
      (assign, "$temp", 7),
    ]],

  [plyr|anyone, "player_merc_give_order",
    [],
    "Patrol around...",
    "player_merc_give_order_details_ask",
    [
      (assign, "$temp", 4),
    ]],

  [plyr|anyone, "player_merc_give_order",
    [],
    "Never mind.",
    "player_merc_pretalk",
    []],

  [anyone, "player_merc_give_order_details_ask",
    [
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Where should we go, my {reg63?Lord:Lady}? We will get there on time and in orderly fashion."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Where shall we go next? It matters little."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@We don't mind traveling through these beautiful parts, but we'd like to be stationed close to a good supply of wine and loose women."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@We may need to get closer to the Imperial lands, if you are looking for suggestions."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@I'm familiar with the area - I know most of the merchants well."),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@My knights travel wherever we are needed the most. Tell me, where would that currently be?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Let's go some place where many lords are unwarily prancing about the countryside. Our dungeons are a sad and desolate place without them!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@Give us the direction, {reg63?Sir:Madam}, the further north the better."),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@This land is wide like a dancer's thighs, but hardly as inviting."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@Jatu ride fastest in the plains. Woods are for Noldor and town-dwellers with no honor."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Just point me in the right direction, and consider it done."),
      (else_try),
        (str_store_string, s4, "@WHERE?"),
      (try_end),
    ],
    "{s4}",
    "player_merc_give_order_details",
    []],

  [repeat_for_parties|plyr|anyone, "player_merc_give_order_details",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$players_kingdom"),
      (assign, ":var3", 0),
      (try_begin),
        (this_or_next|eq, "$temp", 14),
        (eq, "$temp", 7),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 0, 2),
          (party_slot_eq, ":var0", 0, 3),
          (eq, ":var1", "$players_kingdom"),
          (neq, ":var0", "$g_encountered_party"),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 5),
        (try_begin),
          (party_slot_eq, ":var0", 0, 4),
          (lt, ":var2", 0),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 1),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 0, 2),
          (party_slot_eq, ":var0", 0, 3),
          (party_slot_eq, ":var0", 54, -1),
          (lt, ":var2", 0),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 4),
        (try_begin),
          (eq, ":var1", "$players_kingdom"),
          (is_between, ":var0", "p_town_1", "p_salt_mine"),
          (assign, ":var3", 1),
        (else_try),
          (is_between, ":var0", "p_town_1", "p_salt_mine"),
          (store_distance_to_party_from_party, ":var4", ":var0", "p_main_party"),
          (le, ":var4", 25),
          (assign, ":var3", 1),
        (try_end),
      (try_end),
      (eq, ":var3", 1),
      (str_store_party_name, s1, ":var0"),
    ],
    "{s1}",
    "player_merc_give_order_answer",
    [
      (store_repeat_object, "$temp_2"),
      (troop_get_slot, ":var0", "trp_player", 161),
      (try_begin),
        (eq, "$temp", 7),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", "$temp_2"),
        (party_set_flags, ":var0", 65536, 0),
        (1606, ":var0", 3),
        (1607, ":var0", 9),
        (party_set_ai_initiative, ":var0", 20),
      (else_try),
        (eq, "$temp", 4),
        (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
        (party_set_ai_object, ":var0", "$temp_2"),
        (party_set_ai_patrol_radius, ":var0", 1),
        (1606, ":var0", 10),
        (1607, ":var0", 9),
        (party_set_ai_initiative, ":var0", 50),
      (try_end),
    ]],

  [plyr|anyone, "player_merc_give_order_details",
    [],
    "Never mind.",
    "player_merc_pretalk",
    []],

  [anyone, "player_merc_give_order_answer",
    [
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Jawohl, my {reg63?King:Queen}, at once."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@I'll gather my women and men, and we shall be on our way."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Yes, friend. Vamos!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Very well, {reg63?King:Queen} {playername}."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@The 1st Banneret rides!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@It will be done, your Majesty. You have my word!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Very clever, my {reg63?brother:sister}. Let's go and give someone a good reason to use that special lotion."),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@As you wish. I hope you don't mind if we kill any northmen we chance upon on the way!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Firuz will oblige! As long as he gets the most shapely prisoners."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@Jatu! Forward, by Indar!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Splendid. We shall set out at once."),
      (else_try),
        (str_store_string, s4, "@OK!"),
      (try_end),
    ],
    "{s4}",
    "close_window",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (party_detach, ":var0"),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "player_merc_dismiss",
    [
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Our contract is fulfilled then.^We shall head back to Mettenheim - to sing songs about our fallen comrades and their bravery in battle, but also to train their replacements. We will meet again, no doubt, now that you know our worth."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Your ways are foreign, {reg63?King:Queen}, but we were satisfied in your service. I can assure you that your gold will be put to good use. Farewell!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Ah, it is the hour of farewells.^We had pleasant journeys together, didn't we? We will be now looking for the bandit Rufio with increased vigor and much larger coffers. Should you need our help again, send your messenger and we'll join our lances again."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Of course, we shall depart. Our time grows near, and we need to make preparations to complete our mission.^Farewell, {playername}, we will be watching you too."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@Finally our service is at an end.^We depart with pride in our achievements, yet look forward to getting back to Marleons and putting our businesses to order. Our strength is our fair town.^Farewell, {reg63?King:Queen}, and mind the friendship of the lord liege of Marleons, for he determines the burgher affection too."),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@I understand. Please, believe me when I say that I take no pleasure in leaving with your money, but hopefully the gold, along with our actions while in your service, will help me in reminding the people of my order's greatness. You have my gratitude, your Majesty. Until we meet again."),
      (else_try),
        (eq, "$g_talk_troop", "trp_lothario"),
        (str_store_string, s4, "@Very well, my friend! As much as I enjoyed trouncing foolish lords with you, I'll need to check on some acquaintances of a rather Snakish persuasion.^ Maybe we shall meet again, I'm always up for a jaunty ride."),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@Excellent, this gives us some time to fight the kilt-wearing traitors by ourselves."),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@It saddens me to depart, yet my wives and husbands shall comfort me this night.^Goodbye and may your enemies' tombs be rained upon by sixty thousand elephant droppings!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@You are letting us go free. We salute you for the honor we gained in battle.^Now the Jatu will hear Indar's voice. Jatu need laws. I will make them obey in Indar's name - even if I have to kill half of them."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Really, already? Sorry, I get all emotional every time a contract is terminated. Don't worry though; there are ample ways to comfort my grieving soul in Singal with the money you provided. You should visit me, if you find the time. I am sure there are still a few things I could show you in that marvellous whore of a city. Until that time, {playername}."),
      (else_try),
        (str_store_string, s4, "@GOODBYE!"),
      (try_end),
    ],
    "{s4}",
    "close_window",
    [
      (troop_get_slot, ":var0", "trp_player", 161),
      (party_get_template_id, ":var1", ":var0"),
      (store_current_hours, ":var2"),
      (party_template_set_slot, ":var1", 8, ":var2"),
      (party_template_set_slot, ":var1", 6, 0),
      (remove_party, ":var0"),
      (troop_set_slot, "trp_player", 161, -1),
      (assign, "$g_leave_encounter", 1),
    ]],

  [anyone, "player_merc_pretalk",
    [],
    "Anything else?",
    "player_merc_talk",
    []],

  [anyone, "start",
    [
      (eq, "$talk_context", 1),
      (is_between, "$g_talk_troop", "trp_merc_leader_mettenheim", "trp_andy"),
    ],
    "Well, goodbye then.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_merc_leader_mettenheim", "trp_andy"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_faction"),
      (lt, ":var0", 0),
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Our professionalism demands that we eliminate all our employer's enemies. Taste Mettenheim steel, Pendorian!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Stop, unjust brigand! You shall now confront the quality of the Veccavian soldiery, male and female joined as one."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Ha! Foolish Pendorian, just run away and leave the women and the baggage or you will get a lance in the ribs!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Did you know that women make better generals than men?^Well, no, but I'll show you how the Melitine War Academy made me a better one than you."),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@The king has promised to reinstate my order if we helped him against his enemies. Unfortunately for you, you seem to qualify. I take no pleasure in this, but a Knight of the Unicorn always stays true to his word. Rest assured, every man and women of your company being taken prisoner will be treated with dignity."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@Wretched {playername}! Tremble before the mighty charge of the Marleons Heavy Cavalry!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@Stop right there, {playername}! I have heard you're in league with those traitorous northmen. Now you shall pay the price for that!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Shameless dog! Your ancestors were smeared in donkey seed and your religion is unworthy!^When your remaining soldiers surrender, I shall give them as slaves to my Singalians. You alone I will keep to perform favors to the lowest of my spearmen!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@Jatu! Our lances are sharp! Our arms strong! Our arrows guided by Indar! Fear us - and perish!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@I have some advice for you, {playername}. It is always better to have the Free Company as a friend, rather than an enemy. After today, you will hopefully understand why."),
      (else_try),
        (str_store_string, s4, "@HOSTILE"),
      (try_end),
    ],
    "{s4}",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_merc_leader_mettenheim", "trp_andy"),
      (try_begin),
        (eq, "$g_talk_troop", "trp_merc_leader_mettenheim"),
        (str_store_string, s4, "@Hail, {playername}. It is a beautiful day for training and exercise, isn't it?"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_veccavia"),
        (str_store_string, s4, "@Hail, {playername}. We again travel in the service of others. May your fate be better."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_barclay"),
        (str_store_string, s4, "@Hail, {playername}! We are on a little mission for our royal employer, but we are also looking for that cabron Rufio Vincente de Villaviciosia.^If you see him, don't get too close, he's very dangerous - only the Guardia Real can deal with him. "),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_melitine"),
        (str_store_string, s4, "@Greetings, {playername}. We've heard the Snake Cult takes some interest in you. So we shall be watching you as well. Step carefully."),
      (else_try),
        (eq, "$g_talk_troop", "trp_timothy"),
        (str_store_string, s4, "@Good day to you. I am sorry, but I have no time to spare. We are currently on an important mission for the king, and there is much at stake, so I must remain diligent. Please forgive my rudeness. Maybe we will have time to talk at some point in the future."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_marleons"),
        (str_store_string, s4, "@Greetings, {reg63?sir:madam}. The 1st Banneret rides to war again.^We do hope it's a brief one, as prosperity only grows in peace."),
      (else_try),
        (eq, "$g_talk_troop", "trp_morcas"),
        (str_store_string, s4, "@Hold! Are you one of those treacherous northerners? Ah, of course not, forgive me. You don't stink of treason like they do."),
      (else_try),
        (eq, "$g_talk_troop", "trp_firuz"),
        (str_store_string, s4, "@Salam! Our horsemen are fast and the Temptresses are in a foul mood, so think before you do anything rash.^We were gathering healthy little girls from the hamlets around here. They will make good Temptresses one day and fetch a good price with the Khans."),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_jatu"),
        (str_store_string, s4, "@I am Shiruzah of the Hallowed Arrow! One day Shiruzah will bring Indar's laws to the tribes and become a Great Khan.^The booty shall be split in equal measures and cattle thieves shall die on a stake. The tents would multiply and the lances would be countless - the foreign warlords would pay homage to the Jatu. Hazah Jatu!"),
      (else_try),
        (eq, "$g_talk_troop", "trp_merc_leader_merc"),
        (str_store_string, s4, "@Sorry, my friend. The Free Company has already been hired, and we are not looking for recruits. So, whatever is on your mind will probably have to wait."),
      (else_try),
        (str_store_string, s4, "@FRIENDLY"),
      (try_end),
    ],
    "{s4}",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [plyr|anyone, "lady_member_talk",
    [],
    "Very good, carry on.",
    "close_window",
    []],

  [anyone, "member_chat",
    [],
    "Your orders {reg63?sir:madam}?",
    "regular_member_talk",
    []],

  [plyr|anyone, "regular_member_talk",
    [],
    "Tell me about yourself",
    "view_regular_char_requested",
    []],

  [anyone, "view_regular_char_requested",
    [],
    "Aye {reg63?sir:madam}. Let me tell you all there is to know about me.",
    "do_regular_member_view_char",
    [
      (change_screen_view_character),
    ]],

  [anyone, "do_regular_member_view_char",
    [],
    "Anything else?",
    "regular_member_talk",
    []],

  [plyr|anyone, "regular_member_talk",
    [],
    "Nothing. Keep moving.",
    "close_window",
    []],

  [plyr|anyone, "regular_member_talk",
    [
      (is_between, "$g_talk_troop", "trp_dragon_knight", "trp_player_knight"),
    ],
    "I'd like to learn more about your Order.",
    "start_order_rumor",
    [
      (store_sub, reg33, "$g_talk_troop", "trp_dragon_knight"),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (gt, "$encountered_party_hostile", 0),
      (encountered_party_is_attacker),
    ],
    "You have no chance against us. Surrender now or we will kill you all...",
    "party_encounter_hostile_attacker",
    [
      (try_begin),
        (eq, "$g_encountered_party_template", "pt_steppe_bandits"),
        (play_sound, "snd_encounter_steppe_bandits"),
      (try_end),
    ]],

  [plyr|anyone, "party_encounter_hostile_attacker",
    [],
    "We will fight you to the end!",
    "close_window",
    []],

  [plyr|anyone, "party_encounter_hostile_attacker",
    [],
    "Don't attack! We surrender.",
    "close_window",
    [
      (assign, "$g_player_surrenders", 1),
    ]],

  [anyone, "start",
    [
      (eq, "$talk_context", 2),
      (neg|encountered_party_is_attacker),
    ],
    "What do you want?",
    "party_encounter_hostile_defender",
    []],

  [plyr|anyone, "party_encounter_hostile_defender",
    [],
    "Surrender or die!",
    "party_encounter_hostile_ultimatum_surrender",
    []],

  [anyone, "party_encounter_hostile_ultimatum_surrender",
    [],
    "{s43}",
    "close_window",
    [
      (call_script, "script_lord_comment_to_s43", "$g_talk_troop", "str_lord_challenged_default"),
    ]],

  [plyr|anyone, "party_encounter_hostile_defender",
    [],
    "Nothing. We'll leave you in peace.",
    "close_window",
    [
      (assign, "$g_leave_encounter", 1),
    ]],

  [trp_ghost_quest_ghost_lady, "start",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
      (quest_slot_eq, "qst_ghost_lady", 11, 0),
    ],
    "Oh, you can see me! I have despaired of making myself seen or heard! I am the ghost of Lady Alienor, wife to {s4}.",
    "ghostlady_intro_response",
    [
      (quest_set_slot, "qst_ghost_lady", 11, 1),
    ]],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_intro_response",
    [],
    "Yes, my Lady, I both see and hear you. How do you come to be here?",
    "ghostlady_backstory_intro",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_intro_response",
    [],
    "There is no such thing as a ghost. Begone, foul thing!",
    "close_window",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_backstory_intro",
    [],
    "Please, please, you must listen to me! I mean no harm to you, but I crave your help! You are the only one thus far who has seen me. I beg you, at least listen to my sad tale. I am bound to this hall until I discover who killed me.",
    "ghostlady_backstory_a",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_backstory_a",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 4),
      (str_store_troop_name, s5, ":var0"),
      (quest_get_slot, ":var1", "qst_ghost_lady", 6),
      (str_store_troop_name, s6, ":var1"),
    ],
    "My husband wasted little time before installing {s6} as his mistress in my place, though I thought he loved me well. {s6} was furious when we married, because she wanted to marry my Lord herself. I discovered our Scribe was embezzling from my Lord and told him I would expose his thefts and see him sacked and imprisoned. {s5} captured twenty of our peasants for his army, and I urged my husband to war against him and bring our peasants back. Any of these might have wanted my death and brought it about with poison. I know not which my killer may be, but I must discover my murderer, or I shall never find rest or leave this world.",
    "ghostlady_backstory_b",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_backstory_b",
    [],
    "I cannot leave this place, nor can I question those who may have killed me. I must have help from a living person to find out who poisoned me and why.",
    "ghostlady_backstory_response",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_backstory_response",
    [],
    "It is a difficult problem to solve, my lady.",
    "ghostlady_give_quest",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_give_quest",
    [],
    "If you will undertake to find my murderer and avenge me, I will tell you where my jewels are hidden. I no longer need them.",
    "ghostlady_response_give_quest",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_give_quest",
    [],
    "I will find your murderer and avenge you, my Lady.",
    "close_window",
    [
      (quest_set_slot, "qst_ghost_lady", 11, 2),
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name_link, s4, ":var0"),
      (quest_get_slot, ":var1", "qst_ghost_lady", 4),
      (str_store_troop_name_link, s5, ":var1"),
      (quest_get_slot, ":var2", "qst_ghost_lady", 6),
      (str_store_troop_name, s6, ":var2"),
      (str_store_string, s60, "@You have a dilemma: there are four likely suspects. Speak with the castle Scribe, {s4}, {s5} and {s6} and see what you can discover."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (call_script, "script_get_information_about_troops_position", ":var0", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 1, s1, 0),
      (call_script, "script_get_information_about_troops_position", ":var1", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 2, s1, 0),
      (call_script, "script_get_information_about_troops_position", ":var2", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 3, s1, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_give_quest",
    [],
    "I am sorry, my Lady, but I have neither the time nor the interest.",
    "close_window",
    [
      (quest_set_slot, "qst_ghost_lady", 11, 8),
      (call_script, "script_cancel_quest", "qst_ghost_lady"),
    ]],

  [trp_ghost_quest_ghost_lady, "start",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
      (quest_slot_eq, "qst_ghost_lady", 11, 1),
    ],
    "You have returned! Please believe me, I am the ghost of Lady Alienor, wife to {s4}.",
    "ghostlady_intro_response_again",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_intro_response_again",
    [],
    "Yes, my Lady. How do you come to be here?",
    "ghostlady_backstory_intro",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_intro_response_again",
    [],
    "There is no such thing as a ghost. Begone, foul thing!",
    "close_window",
    []],

  [trp_ghost_quest_ghost_lady, "start",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 2),
    ],
    "I haunt this hall, desolate in my invisibility, desperate to find my murderer, but none can see me or hear my pleas for aid. I weep, but none hear me, as I watch my husband with my rival. Were I not already dead, I would wish to be!",
    "close_window",
    []],

  [trp_ghost_quest_ghost_lady, "start",
    [
      (neg|check_quest_succeeded, "qst_ghost_lady"),
      (neg|check_quest_failed, "qst_ghost_lady"),
      (quest_get_slot, ":var0", "qst_ghost_lady", 11),
      (this_or_next|eq, ":var0", 3),
      (this_or_next|eq, ":var0", 5),
      (eq, ":var0", 6),
    ],
    "Oh, {playername}, have you found who killed me?",
    "ghostlady_response_done_yet",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_done_yet",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "Please have patience, my lady, I'll find your murderer.",
    "close_window",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_done_yet",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 11),
      (this_or_next|eq, ":var0", 3),
      (eq, ":var0", 5),
    ],
    "I am so sorry, my lady, but I could not discover your murderer.",
    "ghostlady_failure",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_done_yet",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 6),
    ],
    "I regret to inform you that you were poisoned by your scribe. I killed him for his crime.",
    "ghostlady_success",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_success",
    [],
    "I suspected he was the one! You are welcome to my casket of jewels. Thank you, {playername} from the bottom of my heart. I am free to go now. Farewell and I wish you great success in all your future ventures!",
    "ghostlady_response_success",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_success",
    [
      (troop_get_inventory_capacity, ":var0", "trp_player"),
      (assign, "$temp", 0),
      (try_for_range, ":var1", 10, ":var0"),
        (troop_get_inventory_slot, ":var2", "trp_player", ":var1"),
        (lt, ":var2", 0),
        (assign, ":var0", 0),
        (assign, "$temp", 1),
      (try_end),
      (eq, "$temp", 1),
    ],
    "Farewell, my Lady - oops, she's gone! Now, for those jewels!",
    "close_window",
    [
      (succeed_quest, "qst_ghost_lady"),
      (quest_set_slot, "qst_ghost_lady", 10, 0),
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name_link, s4, ":var0"),
      (quest_get_slot, ":var1", "qst_ghost_lady", 4),
      (str_store_troop_name_link, s5, ":var1"),
      (quest_get_slot, ":var2", "qst_ghost_lady", 6),
      (str_store_troop_name, s6, ":var2"),
      (str_store_string, s60, "@You have dealt with the lady's murderer and should now inform the innocent, {s4}, {s5} and {s6} that they are cleared of all suspicion."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (call_script, "script_get_information_about_troops_position", ":var0", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 1, s1, 0),
      (call_script, "script_get_information_about_troops_position", ":var1", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 2, s1, 0),
      (call_script, "script_get_information_about_troops_position", ":var2", 0),
      (add_quest_note_from_sreg, "qst_ghost_lady", 3, s1, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
      (add_xp_as_reward, 5000),
      (troop_add_item, "trp_player", "itm_loot"),
      (jump_to_menu, "mnu_town"),
      (finish_mission),
    ]],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_success",
    [
      (eq, "$temp", 0),
    ],
    "Damn, nice jewels, but I have a full inventory! I will return later to claim my reward.",
    "close_window",
    []],

  [trp_ghost_quest_ghost_lady, "ghostlady_failure",
    [],
    "You spoke to everyone, yet could not find my murderer? Oh, woe, I am dooomed to forever haunt my own hall, invisible to all. You have sentenced me to a terrible fate by your failure.",
    "ghostlady_response_failure",
    []],

  [plyr|trp_ghost_quest_ghost_lady, "ghostlady_response_failure",
    [],
    "I beg your forgiveness, Lady. I am deeply saddened by your fate. Farewell.",
    "close_window",
    [
      (fail_quest, "qst_ghost_lady"),
      (call_script, "script_end_quest", "qst_ghost_lady"),
      (quest_set_slot, "qst_ghost_lady", 11, 8),
      (jump_to_menu, "mnu_town"),
      (finish_mission),
    ]],

  [trp_ghost_quest_ghost_lady, "start",
    [
      (this_or_next|check_quest_succeeded, "qst_ghost_lady"),
      (check_quest_failed, "qst_ghost_lady"),
    ],
    "...",
    "close_window",
    []],

  [trp_ghost_quest_castle_scribe, "start",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 3),
    ],
    "Have you found your imaginary killer yet, or do you yet run in circles chasing your tail?",
    "ghostscribe_accuse",
    []],

  [trp_ghost_quest_castle_scribe, "start",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 1),
      (str_store_party_name, s4, ":var0"),
    ],
    "I am the Scribe of {s4}. How may I serve you, my {reg63?lord:lady}?",
    "ghostscribe_start_response",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_start_response",
    [
      (quest_slot_eq, "qst_ghost_lady", 11, 2),
    ],
    "I understand you've been dipping your fingers into your Lord's purse on the sly.",
    "ghostscribe_backstory_intro",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_start_response",
    [],
    "I need no service from you. Good day.",
    "close_window",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_backstory_intro",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 2),
      (str_store_troop_name, s4, ":var0"),
    ],
    "How dare you accuse me of stealing from {s4}?! I am his most trusted servant. Who has been telling you lies about me? I demand to know. I have stolen nothing, nothing I tell you!",
    "ghostscribe_backstory_intro_response",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_backstory_intro_response",
    [],
    "Your late lady told me the entire story of your thievery.",
    "ghostscribe_backstory_a",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_backstory_a",
    [],
    "You lie! There is no such thing as a ghost. She is dead and buried, and cannot speak to anyone. I did not kill her, you fool; she died of an illness a few weeks ago. There are no spirits watching us!",
    "ghostscribe_backstory_a_response",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_backstory_a_response",
    [],
    "Lady Alienor's spirit tells me you embezzled from her Lord and she intended to expose you.",
    "ghostscribe_backstory_b",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_backstory_b",
    [],
    "All right, I confess that I took a few denars from the taxes I collected to pay a gambling debt, but it was the first and only time I ever took a copper. My Lady threatened to tell her husband but I swore that I would repay what I stole and she said she would not expose me. Of course I did not poison her! Who could the killer be?",
    "ghostscribe_backstory_b_response",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_backstory_b_response",
    [],
    "Her spirit hears your lies as you speak them. Did you kill her to silence her?",
    "ghostscribe_backstory_c",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_backstory_c",
    [],
    "An interesting fabrication; perhaps you should take up the role of bard. If you will excuse me, I have my Lord's tasks to see about.",
    "close_window",
    [
      (quest_get_slot, ":var0", "qst_ghost_lady", 10),
      (val_or, ":var0", 1),
      (quest_set_slot, "qst_ghost_lady", 10, ":var0"),
      (eq, ":var0", 15),
      (quest_set_slot, "qst_ghost_lady", 11, 3),
      (str_store_string, s60, "@You have decided which of the suspects is guilty and now it is time to confront the murderer."),
      (add_quest_note_from_sreg, "qst_ghost_lady", 0, s60, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ]],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_accuse",
    [],
    "You killed her. You have condemned yourself with your own words.",
    "ghostscribe_accuse_1",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_accuse",
    [],
    "When I know that, I will inform you. Pay back what you stole before your Lord discovers the theft.",
    "close_window",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_accuse_1",
    [],
    "What on earth do you mean? I said nothing of killing my Lady.",
    "ghostscribe_accuse_2",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_accuse_2",
    [],
    "I never said anything to you about poison. You used the word, not I.",
    "ghostscribe_accuse_3",
    []],

  [trp_ghost_quest_castle_scribe, "ghostscribe_accuse_3",
    [],
    "You lie. I don't want trouble with my Lord, so I could make it worth your while to keep silence, rather than repeating your nonsense to my Lord, perhaps as much as 500 denars. Be sensible, {playername}. Take it and go.",
    "ghostscribe_accuse_4",
    []],

  [plyr|trp_ghost_quest_castle_scribe, "ghostscribe_accuse_4",
    [],
    "I won't take your bribe, but I will take your life in recompense for the one you took.",
    "close_window",
    [
      (set_party_battle_mode),
      (get_player_agent_no, ":var0"),
      (try_for_agents, ":var1"),
        (agent_get_troop_id, ":var2", ":var1"),
        (try_begin),
          (eq, ":var2", "trp_ghost_quest_castle_scribe"),
          (agent_set_team, ":var1", 3),
        (else_try),
          (eq, ":var1", ":var0"),
          (agent_set_team, ":var1", 2),
        (try_end),
      (try_end),
      (team_set_relation, 2, 3, -1),
      (team_set_relation, 2, 0, 0),
      (team_set_relation, 3, 0, 0),
      (quest_set_slot, "qst_ghost_lady", 11, 4),
    ]],

  [auto_proceed|anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (check_quest_active, "qst_collect_men"),
      (eq, "$talk_context", 21),
    ],
    "{!}.",
    "merchant_end",
    []],

  [anyone, "merchant_end",
    [],
    "Heh! I must really be in a tight spot, to place my hopes in a passing stranger. However, something about you tells me that my trust is not misplaced. Now, go see if you can round up some volunteers or mercenaries.",
    "close_window",
    []],

  [anyone, "start",
    [
      (is_between, "$g_talk_troop", "trp_sarleon_merchant", "trp_startup_merchants_end"),
      (eq, "$talk_context", 14),
      (neg|check_quest_finished, "qst_collect_men"),
      (eq, "$current_startup_quest_phase", 1),
      (str_store_string, s1, "@Hey there this is the first text."),
    ],
    "{s1}",
    "merchant_quest_1_prologue_1",
    []],

  [anyone, "merchant_quest_1_prologue_1",
    [
      (eq, "$g_talk_troop", "trp_sarleon_merchant"),
    ],
    "We've lately had a real problem with Heretics kidnapping young girls for sacrifice. We've discovered numerous girls' bodies, every one with the heart ripped out! Of late, they've begun venturing into town, looking for unwary prey. The watch commander tells us it's because of all the fighting on the frontiers - fewer men to keep an eye on the streets. This helps them enter unnoticed and aids them in identifying particularly tempting targets ... Last week, you see, they took my young sister.",
    "merchant_quest_1_prologue_2",
    []],

  [anyone, "merchant_quest_1_prologue_1",
    [
      (eq, "$g_talk_troop", "trp_ravenstern_merchant"),
    ],
    "Those damnable Mystmountain Raiders appear when least expected and vanish back into their mountains without a trace. I'll confess that I've done a bit of trading with them in the past - their gold is as good as anyone's. Still, they've gone too far this time. My younger brother went off hunting the other day and failed to return. Those Mystmountain barbarians sent me his ear in a bag, with an ill-written note demanding 1000 denars ransom for him!",
    "merchant_quest_1_prologue_2",
    []],

  [anyone, "merchant_quest_1_prologue_1",
    [
      (eq, "$g_talk_troop", "trp_dshar_merchant"),
    ],
    "We've a growing problem here stemming from Singal - bands of Singalian slavers prowling about all the D'Shar Principalities, taking every person they can get their hands on as slaves. It isn't safe to travel anywhere without a large group of guards. Of late, they've begun taking citizens right off our city streets, as boldly as they do in Singal! Now they've taken one of my wives. I wouldn't worry so much about it if she weren't my first wife's younger sister. She won't stop nagging me until I recover her little sister and the caterwauling in the women's quarters is driving me insane. She's also informed me I will have no 'husbandly rights' until my third wife is returned, and my second wife agrees.",
    "merchant_quest_1_prologue_2",
    []],

  [anyone, "merchant_quest_1_prologue_1",
    [
      (eq, "$g_talk_troop", "trp_fierdsvain_merchant"),
    ],
    "Those bloody Vanskerry Raiders are growing bolder with every passing day. They take every person they come across as skalds, and send them back to their iceberg of a country in chains. The watch commander says they look too much like everyone else in the Fierdsvain, so when they enter the city, they could be any citizen. Anyway, Vanskerries have kidnapped my son!",
    "merchant_quest_1_prologue_2",
    []],

  [anyone, "merchant_quest_1_prologue_1",
    [
      (eq, "$g_talk_troop", "trp_empire_merchant"),
    ],
    "The Snake Cult raids have increased of late, probably because a number of the Empire nobility are secret worshipers of Azi Dahaka. The incidences of girls kidnapped are on the rise, and rumor has it they steal girls to make them into Snake Priestesses. I've also heard they only take girl babies for that, and sacrifice their older captives. The problem is this: I sent my daughter under escort to Cez, to visit her aunt, and her party was taken by the Snake Cult!",
    "merchant_quest_1_prologue_2",
    []],

  [anyone, "merchant_quest_1_prologue_2",
    [
      (eq, "$g_talk_troop", "trp_sarleon_merchant"),
    ],
    "I don't know what my sister was thinking to go wandering alone after dark in times like these; I hope she wasn't meeting a lover! You were traipsing about, too, but you're a stranger here, and didn't know how bad things have become. She had no such excuse. But she's my sister, so what can I do? If I don't protect my kin, people will start thinking that I can't protect my investments, either, and I can't have that. I also confess that I love her dearly and am worried to death about her! I cannot bear the thought of her being sacrificed by Heretics!",
    "merchant_quest_1_prologue_3",
    []],

  [anyone, "merchant_quest_1_prologue_2",
    [
      (eq, "$g_talk_troop", "trp_ravenstern_merchant"),
    ],
    "They say they will send more 'important' parts of him next, if they don't have the ransom within two days. He's the last of my family - my parents are dead, and I promised my father on his deathbed I'd look after the boy. He's worthless as a merchant, has as much trading sense as a hound, but I swore to my father to keep him safe, so I must rescue him.",
    "merchant_quest_1_prologue_3",
    []],

  [anyone, "merchant_quest_1_prologue_2",
    [
      (eq, "$g_talk_troop", "trp_dshar_merchant"),
    ],
    "I've told those idiot wives of mine, time and time again, don't go sneaking out of the house without escort, just because a peddler waves some gaudy trinket under your window to entice you, but they never listen. I'm sure that's what happened - one of those Singalians disguised as a peddler flapped a length of red silk, or waved a gold bracelet in the air, the greedy little twit went racing out to buy it, and was taken.",
    "merchant_quest_1_prologue_3",
    []],

  [anyone, "merchant_quest_1_prologue_2",
    [
      (eq, "$g_talk_troop", "trp_fierdsvain_merchant"),
    ],
    "My son has a bad habit of frequenting the taverns and associating with people he should not. He also drinks too much. I fear he was waylaid by some Vanskerry Raiders as he stumbled home too drunk to defend himself or raise an alarm. I make no excuses for his behavior - he's an idiot. But, he's my own blood, after all. If I can't protect my kin, people will start thinking that I can't protect my investments, either, and I can't have that. I'm also fond of the young blighter - he's my only son and I love him despite his foolish ways.",
    "merchant_quest_1_prologue_3",
    []],

  [anyone, "merchant_quest_1_prologue_2",
    [
      (eq, "$g_talk_troop", "trp_empire_merchant"),
    ],
    "She's not just my daughter, she's my only heir, and I've promised her to the son of one of my oldest friends in marriage. This marriage will join our trading concerns and make us the wealthiest and most influential merchants in the Empire. This marriage must take place very soon, or both our friendship and our potential partnership will end. She must be rescued before the wedding date!",
    "merchant_quest_1_prologue_3",
    []],

  [anyone, "merchant_quest_1_prologue_3",
    [
      (store_sub, ":var0", "$g_talk_troop", "trp_sarleon_merchant"),
      (store_add, ":var1", "str_victim_sarleon", ":var0"),
      (store_add, ":var2", "str_bandits_sarleon", ":var0"),
      (str_store_string, s1, ":var1"),
      (str_store_string, s3, ":var2"),
    ],
    "So here's my proposition. You look like you've had a bit of experience with a blade - and more importantly, you must have a bit of fire in your belly, or you wouldn't be coming to Pendor to seek your fortune. This is what I'm asking you to do: gather a small but strong party, track down these {s3} to their lair and return my {s1} to me in good health. In return, you'll earn my lasting gratitude and a bit of silver. What say you?",
    "merchant_quest_1a",
    []],

  [plyr|anyone, "merchant_quest_1a",
    [],
    "Very well, I will rescue your {s1}.",
    "merchant_quest_1b",
    []],

  [plyr|anyone, "merchant_quest_1a",
    [],
    "I am sorry, but I have more important business to attend.",
    "close_window",
    [
      (assign, "$dialog_with_merchant_ended", 1),
    ]],

  [anyone, "merchant_quest_1b",
    [],
    "You won't be able to do this by yourself, though. If you tackle that warband by yourself, the hunter will become the hunted, I'll warrant. You'll first need to recruit some fighting men. There are always a few lads in the outlying villages looking for work more interesting than tilling the soil or hauling water. With a little training, they'll fight well. There are also mercenaries for hire in the taverns. They'll join you for pay. Visit the villages and taverns, and use the money to hire some men. You will need at least five men behind you to fight the {s3}. The bandit leaders are a mean bunch, so having experienced men with good equipment would be best.",
    "merchant_quest_1c",
    [
      (call_script, "script_troop_add_gold", "trp_player", 300),
      (str_store_troop_name, s9, "$g_talk_troop"),
      (str_store_party_name, s1, "$g_starting_town"),
      (str_store_string, s2, "str_start_up_quest_message_1"),
      (call_script, "script_start_quest", "qst_collect_men", "$g_talk_troop"),
      (party_get_position, pos1, "$current_town"),
    ]],

  [plyr|anyone, "merchant_quest_1c",
    [],
    "Very good, sir. I'll go collect some men from around the villages and check the tavern too.",
    "merchant_quest_1d",
    []],

  [anyone, "merchant_quest_1d",
    [
      (str_store_party_name, s1, "$current_town"),
    ],
    "Good. You can find me again in the tavern here in {s1} after you've got your group together. Then we'll speak about what to do next.",
    "close_window",
    [
      (assign, "$dialog_with_merchant_ended", 1),
    ]],

  [trp_noldor_leader, "start",
    [
      (ge, "$noldor_tournaments_won", 10),
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_supporters_faction"),
      (ge, ":var0", 95),
      (troop_has_item_equipped, "$g_talk_troop", "itm_rune_plate_strange"),
    ],
    "Twair Ganieer Champion! You've done it! You bested all that Elcarai has to offer. You are truly a mighty human worthy of Noldor status. No one has ever achieved an undefeated record as much as you, including myself! In response, the Lords of Elcarai have agreed to gift you one of our most prized relics. Wear it with pride Champion of Pendor! Show the world that the Noldor think of you as an equal!",
    "noldor_give_armor_1",
    []],

  [plyr|trp_noldor_leader, "noldor_give_armor_1",
    [],
    "It is with the greatest honor, that I accept this most prized gift. Thank you!",
    "noldor_give_armor_2",
    [
      (troop_set_inventory_slot, "$g_talk_troop", ek_body, "itm_noldor_noble_armor_cape"),
      (troop_clear_inventory, "trp_temp_troop"),
      (troop_add_item, "trp_temp_troop", "itm_rune_plate_strange"),
      (change_screen_loot, "trp_temp_troop"),
    ]],

  [trp_noldor_leader, "noldor_give_armor_2",
    [],
    "We are glad to hear that!",
    "close_window",
    []],

  [trp_noldor_leader, "start",
    [],
    "Yes, what can I do for you?",
    "noldor_player_response",
    []],

  [plyr|trp_noldor_leader, "noldor_player_response",
    [],
    "I have many questions about the Noldor...",
    "noldor_leader_1",
    []],

  [trp_noldor_leader, "noldor_leader_1",
    [],
    "I may deign to give you a few answers. Ask.",
    "noldor_player_questions",
    []],

  [trp_noldor_leader, "noldor_anything_else",
    [],
    "Anything else you need to know? Ask.",
    "noldor_player_questions",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about Noldor relations with others.",
    "noldor_question_1",
    []],

  [plyr|trp_noldor_leader, "noldor_question_1",
    [],
    "Your people seem at odds with all of Pendor. Why is that?",
    "noldor_answer_1",
    []],

  [trp_noldor_leader, "noldor_answer_1",
    [],
    "The Jatu are uncouth savages who murder our patrols. Our woods can never be safe while they live. The Empire lords pursue our patrols because they wish to loot our weapons and armor, and they use chasing the Snake Cult into our woods as an excuse for invading us. They take us prisoners without compunction.",
    "noldor_player_1",
    []],

  [plyr|trp_noldor_leader, "noldor_player_1",
    [],
    "Please go on.",
    "noldor_answer_1a",
    []],

  [trp_noldor_leader, "noldor_answer_1a",
    [],
    "This, despite the fact that we also fight and defeat the Snake Cult! Our proud warrior women captives are sold at auction by Ramun in Singal, and we cannot enter Pendor cities to ransom them. The Pendor lords immure them in their towers and use them as sex slaves. This is intolerable to us! Sarleon ever threatens us and most of the Knightly Orders despise us. The Noldor have never been accepted by the rest of Pendor. We find it ironic that, even though many of the people who now occupy Pendor came from elsewhere, the Pendorians treat us as alien invaders. Do you wonder, human, that we wish nothing to do with the people of Pendor?",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about Noldor reclusiveness.",
    "noldor_question_2",
    []],

  [plyr|trp_noldor_leader, "noldor_question_2",
    [],
    "Do you think if you interacted more with the people of Pendor, they would be more accepting of you?",
    "noldor_answer_2",
    []],

  [trp_noldor_leader, "noldor_answer_2",
    [],
    "When first we came to Pendor, we tried that. Our efforts failed. We are accepted only by one of the Knighthood Orders.",
    "noldor_player_2",
    []],

  [plyr|trp_noldor_leader, "noldor_player_2",
    [],
    "Maybe it's the pointy ears that put people off. (relation -1)",
    "noldor_anything_else",
    [
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", -1),
    ]],

  [plyr|trp_noldor_leader, "noldor_player_2",
    [],
    "Tell that to the next human widow you meet, courtesy of a stray Noldor arrow. (relation -10)",
    "noldor_anything_else",
    [
      (call_script, "script_change_player_relation_with_faction", "fac_noldor_elves", -10),
    ]],

  [plyr|trp_noldor_leader, "noldor_player_2",
    [],
    "I'm sorry to hear that. Your people have been treated unjustly.",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about the hidden castle.",
    "noldor_question_3",
    []],

  [plyr|trp_noldor_leader, "noldor_question_3",
    [],
    "How have you managed to keep Elacrai castle so well hidden for this long?",
    "noldor_answer_3",
    []],

  [trp_noldor_leader, "noldor_answer_3",
    [],
    "Though most of our magic was lost with our island - a tale that does not concern you - we retained enough magic to hide in these woods. You are the first human to whom we have revealed it, because you have proven yourself a friend to the Noldor. Don't make us regret our decision to admit you to our confidence. Noldor friends are well-rewarded. Noldor enemies are dealt with summarily and forever barred from seeing or entering Elacrai Castle. Should you prove untrustworthy, you will never find this castle again, and every Noldor will be your enemy from that time on. We make very bad enemies.",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about tournaments.",
    "noldor_question_4",
    []],

  [plyr|trp_noldor_leader, "noldor_question_4",
    [],
    "Do you hold tournaments here? Would you permit me to enter one?",
    "noldor_answer_4",
    []],

  [trp_noldor_leader, "noldor_answer_4",
    [],
    "At the beginning of each new moon, we take the first four days and hold the most grand tournament here in Pendor. As you are now welcomed to our halls, you are more than welcome to join the combatants in the arena. Many rewards are to be won, but heed my words, us Noldor will not roll over for any opposition, especially a human. Prove yourself and see what may come if you continue to be victorious.",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about training.",
    "noldor_question_5",
    []],

  [plyr|trp_noldor_leader, "noldor_question_5",
    [],
    "Is it possible for me to train with your Trainer here in Elacrai Castle?",
    "noldor_answer_5",
    []],

  [trp_noldor_leader, "noldor_answer_5",
    [],
    "If my Trainer consents to your attempt, you have my permission to train with her. Being human, you will find her training very challenging.",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about trading and recruitment.",
    "noldor_question_6",
    []],

  [plyr|trp_noldor_leader, "noldor_question_6",
    [],
    "I see you have a merchant and a quartermaster here - may I buy some Noldor goods and hire Noldor troops from them?",
    "noldor_answer_6",
    []],

  [trp_noldor_leader, "noldor_answer_6",
    [],
    "If my castle merchant and quartermaster will condescend to deal with you, yes you may. There are always young Noldor who seek adventure in the outside world, but their price is very high. Our goods are excellent, but also very expensive.",
    "noldor_anything_else",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "Ask about more information.",
    "noldor_question_7",
    []],

  [plyr|trp_noldor_leader, "noldor_question_7",
    [],
    "Is there anything else you'd care to tell me about the Noldor?",
    "noldor_answer_7",
    []],

  [trp_noldor_leader, "noldor_answer_7",
    [],
    "When we know you better, we may tell you more about ourselves, but for now, I think I have sufficiently satisfied your curiosity, and I grow weary of your questions.",
    "close_window",
    []],

  [plyr|trp_noldor_leader, "noldor_player_questions",
    [],
    "This is very interesting, but I have to go.",
    "close_window",
    []],

  [trp_noldor_merchant, "start",
    [
      (eq, "$g_talk_troop_met", 0),
    ],
    "So, human, you wish to trade for Noldor goods?",
    "merchant_process_2",
    [
      (troop_set_slot, "$g_talk_troop", 5, 1),
    ]],

  [trp_noldor_merchant, "start",
    [
      (eq, "$g_talk_troop_met", 1),
    ],
    "Back again, are you? What do you want this time?",
    "merchant_process_2",
    []],

  [plyr|trp_noldor_merchant, "merchant_process_2",
    [],
    "I am interested in Noldor items.",
    "noldor_merchant_trade",
    []],

  [plyr|trp_noldor_merchant, "merchant_process_2",
    [
      (item_slot_eq, "itm_noldor_noble_armor", 65, 0),
    ],
    "I'd like to learn the secrets of creating these items.",
    "noldor_merchant_unlock",
    []],

  [plyr|trp_noldor_merchant, "merchant_process_2",
    [],
    "I must be going, perhaps later.",
    "close_window",
    []],

  [trp_noldor_merchant, "noldor_merchant_trade",
    [],
    "Normally, I'd not let these goods go to human hands, but I'll make an exception this time.",
    "merchant_ending_trade",
    [
      (change_screen_trade),
    ]],

  [trp_noldor_merchant, "noldor_merchant_unlock",
    [
      (store_relation, ":var0", "fac_noldor_elves", "fac_player_faction"),
      (lt, ":var0", 70),
    ],
    "Wouldn't you like to know? And how would we know you can be entrusted with such secrets? Better trade with me while you can, human.",
    "merchant_ending_trade",
    []],

  [trp_noldor_merchant, "noldor_merchant_unlock",
    [],
    "Very well, human friend. I'll summon a smith to show you the intricacies of creating some of our common equipment. I only hope I don't live to regret this.",
    "merchant_ending_trade",
    [
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_noble_armor"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_noble_armor_cape"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_ranger_garb"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_ranger_garb_cape"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_archer_garb"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_archer_garb_cape"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_boots"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_leather_gloves"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_bow"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_arrows"),
      (call_script, "script_unlock_item_for_custom_troops", "itm_noldor_gold_horse"),
    ]],

  [trp_noldor_merchant, "merchant_ending_trade",
    [],
    "Very good. Will there be anything else?",
    "merchant_process_2",
    []],

  [trp_noldor_trainer, "start",
    [
      (eq, "$g_talk_troop_met", 0),
    ],
    "I can train you in a variety of weapons to a Noldor skill level.",
    "trainer_process_2",
    [
      (troop_set_slot, "$g_talk_troop", 5, 1),
    ]],

  [trp_noldor_trainer, "start",
    [
      (neq, "$pop_training_weapon", 0),
    ],
    "I see you have completed your training.",
    "trainer_reward",
    [
      (assign, "$pop_training_weapon", 0),
    ]],

  [trp_noldor_trainer, "start",
    [
      (eq, "$g_talk_troop_met", 1),
    ],
    "Do you wish training again?",
    "trainer_process_2",
    []],

  [plyr|trp_noldor_trainer, "trainer_process_2",
    [],
    "Yes, let us train.",
    "trainer_choose_weapon",
    []],

  [plyr|trp_noldor_trainer, "trainer_process_2",
    [],
    "I must be going, perhaps later.",
    "close_window",
    []],

  [trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Choose a weapon proficiency you want to improve.",
    "trainer_choose_weapon",
    [
      (assign, "$pop_training_weapon", 0),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "One-handed weapons.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 2),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Two-handed weapons.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 3),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Polearms.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 4),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Bows.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 8),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Crossbows.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 9),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "Thrown weapons.",
    "trainer_begin_training",
    [
      (assign, "$pop_training_weapon", 10),
    ]],

  [plyr|trp_noldor_trainer, "trainer_choose_weapon",
    [],
    "None, I've changed my mind.",
    "trainer_ending_training",
    []],

  [trp_noldor_trainer, "trainer_begin_training",
    [],
    "Very well, here we go. Once you finish training, come back and speak to me.",
    "close_window",
    [
      (assign, "$g_leave_town", 1),
      (store_character_level, ":var0", "trp_player"),
      (val_max, ":var0", 20),
      (assign, ":var1", "trp_noldor_warrior"),
      (assign, ":var2", 2),
      (try_begin),
        (le, ":var0", 30),
        (store_sub, ":var2", ":var0", 20),
        (val_div, ":var2", 6),
        (val_add, ":var2", 1),
      (else_try),
        (le, ":var0", 35),
        (assign, ":var1", "trp_noldor_ranger"),
        (assign, ":var2", 2),
      (else_try),
        (le, ":var0", 40),
        (assign, ":var1", "trp_noldor_maiden"),
        (assign, ":var2", 2),
      (else_try),
        (assign, ":var1", "trp_noldor_knight"),
        (store_sub, ":var2", ":var0", 40),
        (val_div, ":var2", 5),
        (val_add, ":var2", 2),
        (try_begin),
          (gt, ":var2", 4),
          (assign, ":var2", 4),
        (try_end),
      (try_end),
      (try_for_range, ":var3", 0, ":var2"),
        (troop_set_slot, "trp_temp_array_a", ":var3", ":var1"),
      (try_end),
      (call_script, "script_pop_start_training_at_training_ground", "$pop_training_weapon", ":var2"),
      (music_set_situation, 0),
      (finish_mission),
    ]],

  [trp_noldor_trainer, "trainer_reward",
    [
      (eq, "$g_training_ground_training_success_ratio", 100),
    ],
    "Your training was a success. You are awarded a proficiency raise{reg2? (of {reg2} points):}.",
    "trainer_ending_training",
    [
      (store_proficiency_level, ":var0", "trp_player", "$g_training_ground_used_weapon_proficiency"),
      (val_mul, "$g_training_ground_training_hardness", 1),
      (troop_raise_proficiency, "trp_player", "$g_training_ground_used_weapon_proficiency", "$g_training_ground_training_hardness"),
      (store_proficiency_level, reg2, "trp_player", "$g_training_ground_used_weapon_proficiency"),
      (val_sub, reg2, ":var0"),
    ]],

  [trp_noldor_trainer, "trainer_reward",
    [],
    "You have failed the training.",
    "trainer_ending_training",
    []],

  [trp_noldor_trainer, "trainer_ending_training",
    [],
    "Will there be anything else?",
    "trainer_process_2",
    []],

  [trp_noldor_recruiter, "start",
    [
      (eq, "$g_talk_troop_met", 0),
    ],
    "I've some Noldor troops who foolishly wish to adventure with a human captain. They'll join you for a Qualis gem.",
    "recruiter_process_2",
    [
      (troop_set_slot, "$g_talk_troop", 5, 1),
    ]],

  [trp_noldor_recruiter, "start",
    [
      (eq, "$g_talk_troop_met", 1),
    ],
    "Back again for more troops, human? I've more foolish Noldor here. Pony up another gem, then.",
    "recruiter_process_2",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_process_2",
    [
      (neg|check_quest_active, "qst_order_challenge"),
    ],
    "I am interested in hiring Noldor troops.",
    "recruiter_warrior",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_process_2",
    [],
    "I must be going, perhaps later.",
    "close_window",
    []],

  [trp_noldor_recruiter, "recruiter_warrior",
    [],
    "Do you have a Qualis Gem? Or maybe some of our delicate pottery?",
    "recruiter_warrior_gem",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (neg|player_has_item, "itm_noldor_goods"),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (assign, reg24, ":var0"),
    ],
    "Yes, I have Qualis Gem (and space for {reg24} units).",
    "recruiter_warrior_choose",
    [
      (assign, reg25, 15),
      (try_begin),
        (lt, reg24, reg25),
        (assign, reg25, reg24),
      (try_end),
      (assign, reg26, 12),
      (try_begin),
        (lt, reg24, reg26),
        (assign, reg26, reg24),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg27, 0),
      (else_try),
        (assign, reg27, 10),
        (try_begin),
          (lt, reg24, reg27),
          (assign, reg27, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg28, 0),
      (else_try),
        (assign, reg28, 6),
        (try_begin),
          (lt, reg24, reg28),
          (assign, reg28, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg29, 0),
      (else_try),
        (assign, reg29, 4),
        (try_begin),
          (lt, reg24, reg29),
          (assign, reg29, reg24),
        (try_end),
      (try_end),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_noldor_goods"),
      (party_get_free_companions_capacity, ":var0", "p_main_party"),
      (assign, reg24, ":var0"),
    ],
    "Yes, I have Qualis Gem and this beautiful vase (and space for {reg24} units).",
    "recruiter_warrior_choose",
    [
      (assign, reg25, 18),
      (try_begin),
        (lt, reg24, reg25),
        (assign, reg25, reg24),
      (try_end),
      (assign, reg26, 15),
      (try_begin),
        (lt, reg24, reg26),
        (assign, reg26, reg24),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg27, 0),
      (else_try),
        (assign, reg27, 12),
        (try_begin),
          (lt, reg24, reg27),
          (assign, reg27, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg28, 0),
      (else_try),
        (assign, reg28, 7),
        (try_begin),
          (lt, reg24, reg28),
          (assign, reg28, reg24),
        (try_end),
      (try_end),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 50),
        (assign, reg29, 0),
      (else_try),
        (assign, reg29, 5),
        (try_begin),
          (lt, reg24, reg29),
          (assign, reg29, reg24),
        (try_end),
      (try_end),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (neg|player_has_item, "itm_noldor_goods"),
    ],
    "Yes, but I don't want to trade it for now.",
    "close_window",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_gem",
    [
      (player_has_item, "itm_qualis"),
      (player_has_item, "itm_noldor_goods"),
    ],
    "Yes, but I don't want to trade them for now.",
    "close_window",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_gem",
    [
      (neg|player_has_item, "itm_qualis"),
    ],
    "No, not with me.",
    "close_window",
    []],

  [trp_noldor_recruiter, "recruiter_warrior_choose",
    [
      (gt, reg24, 0),
    ],
    "Excellent. Please select one of the options below.",
    "recruiter_warrior_select",
    [
      (troop_remove_item, "trp_player", "itm_qualis"),
      (try_begin),
        (player_has_item, "itm_noldor_goods"),
        (troop_remove_item, "trp_player", "itm_noldor_goods"),
      (try_end),
    ]],

  [trp_noldor_recruiter, "recruiter_warrior_choose",
    [
      (eq, reg24, 0),
    ],
    "Excellent, but ... there is no room in your party.",
    "close_window",
    []],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_select",
    [],
    "{reg25}x Noldor Warrior.",
    "recruiter_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_warrior", reg25),
      (display_log_message, "@ {reg25}x Noldor Warrior have joined your party."),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_select",
    [],
    "{reg26}x Noldor Ranger.",
    "recruiter_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_ranger", reg26),
      (display_log_message, "@ {reg26}x Noldor Ranger have joined your party."),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_select",
    [
      (gt, reg27, 0),
    ],
    "{reg27}x Noldor Maiden Ranger.",
    "recruiter_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_maiden", reg27),
      (display_log_message, "@ {reg27}x Noldor Maiden Ranger have joined your party."),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_select",
    [
      (gt, reg28, 0),
    ],
    "{reg28}x Noldor Noble.",
    "recruiter_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_noble", reg28),
      (display_log_message, "@ {reg28}x Noldor Noble have joined your party."),
    ]],

  [plyr|trp_noldor_recruiter, "recruiter_warrior_select",
    [
      (gt, reg29, 0),
    ],
    "{reg29}x Noldor Twilight Knight.",
    "recruiter_ending_trade",
    [
      (party_add_members, "p_main_party", "trp_noldor_knight", reg29),
      (display_log_message, "@ {reg29}x Noldor Twilight Knight have joined your party."),
    ]],

  [trp_noldor_recruiter, "recruiter_ending_trade",
    [],
    "Very good. Will there be anything else?",
    "recruiter_process_2",
    []],

  [trp_order_constable, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Greetings, Grandmaster. It's an honor to welcome you in a our new headquarters.^I will be here to advise you on our military activities. Our knights and sergeants are at your command.",
    "order_constable_player_response",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [trp_order_constable, "start",
    [],
    "Yes, Grandmaster {playername}, what are your orders?",
    "order_constable_player_response",
    []],

  [plyr|trp_order_constable, "order_constable_player_response",
    [],
    "I want to send out an Order patrol.",
    "order_constable_patrols",
    []],

  [plyr|trp_order_constable, "order_constable_player_response",
    [],
    "Our fortress deserves a better name.",
    "order_constable_rename",
    []],

  [plyr|trp_order_constable, "order_constable_player_response",
    [],
    "That would be all, Constable.",
    "close_window",
    []],

  [trp_order_constable, "order_constable_patrols",
    [
      (store_num_parties_of_template, ":var0", "pt_stronghold_patrol"),
      (ge, ":var0", 3),
    ],
    "I am sorry, Grandmaster, we already have three patrols on duty and can't spare any more men.^Is there anything else you wish?",
    "order_constable_player_response",
    []],

  [trp_order_constable, "order_constable_patrols",
    [],
    "Very well, where should we send our patrol?",
    "order_constable_patrols",
    []],

  [repeat_for_parties|plyr|trp_order_constable, "order_constable_patrols",
    [
      (store_repeat_object, ":var0"),
      (is_between, ":var0", "p_town_1", "p_village_1"),
      (store_distance_to_party_from_party, ":var1", ":var0", "p_snake_stronghold"),
      (le, ":var1", 50),
      (str_store_party_name, s1, ":var0"),
    ],
    "{s1}",
    "order_constable_patrols_done",
    [
      (store_repeat_object, ":var0"),
      (set_spawn_radius, 1),
      (spawn_around_party, "p_main_party", "pt_stronghold_patrol"),
      (assign, ":var1", reg0),
      (party_set_slot, ":var1", 123, ":var0"),
      (party_set_ai_behavior, ":var1", ai_bhvr_patrol_party),
      (party_set_ai_patrol_radius, ":var1", 5),
      (party_set_ai_object, ":var1", ":var0"),
      (party_set_flags, ":var1", 65536, 0),
      (party_set_ai_initiative, ":var1", 50),
      (store_faction_of_party, ":var2", "p_snake_stronghold"),
      (party_set_faction, ":var1", ":var2"),
      (str_store_party_name, s2, "p_snake_stronghold"),
      (party_set_name, ":var1", "@{s2} Patrol"),
      (troop_get_slot, ":var3", "trp_player", 162),
      (store_sub, ":var4", ":var3", "trp_dragon_knight"),
      (val_add, ":var4", "trp_dragon_drake"),
      (store_random_in_range, ":var5", 8, 24),
      (party_add_members, ":var1", ":var3", ":var5"),
      (store_random_in_range, ":var6", 12, 40),
      (party_add_members, ":var1", ":var4", ":var6"),
    ]],

  [trp_order_constable, "order_constable_patrols_done",
    [],
    "They will be on their way at once, Grandmaster. Anything else?",
    "order_constable_player_response",
    []],

  [trp_order_constable, "order_constable_rename",
    [],
    "But of course, Grandmaster. Please suggest a suitable new name, and I'll send our messengers to announce it.",
    "close_window",
    [
      (assign, "$menu_control", -1),
      (jump_to_menu, "mnu_auto_name_stronghold"),
      (finish_mission),
    ]],

  [trp_order_blacksmith, "start",
    [
      (gt, "$order_blacksmith_days", 0),
      (assign, reg1, "$order_blacksmith_days"),
    ],
    "I'm still working on your requested gear, please be patient. It will be ready in {reg1} days time.",
    "order_blacksmith_speedup",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_speedup",
    [
      (ge, "$order_blacksmith_days", 3),
      (eq, "$order_blacksmith_asked_for_speedup", 0),
    ],
    "Is there anything I can do to speed up this process?",
    "order_blacksmith_speedup_1",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_speedup",
    [],
    "Take your time, Master Alexios. I will gladly wait for you to craft your masterpieces.",
    "close_window",
    []],

  [trp_order_blacksmith, "order_blacksmith_speedup_1",
    [
      (item_get_type, ":var0", "$order_blacksmith_item"),
      (assign, ":var1", 100),
      (try_begin),
        (is_between, ":var0", 12, 16),
        (try_begin),
          (eq, "$order_blacksmith_modifier", 29),
          (assign, ":var1", 1150),
        (else_try),
          (eq, "$order_blacksmith_modifier", 27),
          (assign, ":var1", 650),
        (else_try),
          (eq, "$order_blacksmith_modifier", 26),
          (assign, ":var1", 390),
        (else_try),
          (eq, "$order_blacksmith_modifier", 25),
          (assign, ":var1", 260),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var0", 2),
        (this_or_next|eq, ":var0", 3),
        (this_or_next|eq, ":var0", 4),
        (this_or_next|eq, ":var0", 8),
        (eq, ":var0", 9),
        (try_begin),
          (eq, "$order_blacksmith_modifier", 17),
          (assign, ":var1", 1750),
        (else_try),
          (eq, "$order_blacksmith_modifier", 14),
          (assign, ":var1", 670),
        (else_try),
          (eq, "$order_blacksmith_modifier", 19),
          (assign, ":var1", 490),
        (else_try),
          (eq, "$order_blacksmith_modifier", 13),
          (assign, ":var1", 350),
        (else_try),
          (this_or_next|eq, "$order_blacksmith_modifier", 18),
          (eq, "$order_blacksmith_modifier", 10),
          (assign, ":var1", 190),
        (try_end),
      (else_try),
        (eq, ":var0", 7),
        (try_begin),
          (eq, "$order_blacksmith_modifier", 27),
          (assign, ":var1", 210),
        (else_try),
          (eq, "$order_blacksmith_modifier", 25),
          (assign, ":var1", 160),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var0", 5),
        (this_or_next|eq, ":var0", 6),
        (eq, ":var0", 10),
        (try_begin),
          (eq, "$order_blacksmith_modifier", 13),
          (assign, ":var1", 350),
        (else_try),
          (this_or_next|eq, "$order_blacksmith_modifier", 18),
          (eq, "$order_blacksmith_modifier", 42),
          (assign, ":var1", 190),
        (try_end),
      (try_end),
      (item_get_slot, ":var2", "$order_blacksmith_item", 67),
      (val_mul, ":var2", ":var1"),
      (val_div, ":var2", 100),
      (party_get_skill_level, ":var3", "p_main_party", skl_trade),
      (val_mul, ":var3", 5),
      (store_sub, ":var4", 200, ":var3"),
      (val_mul, ":var2", ":var4"),
      (val_div, ":var2", 100),
      (val_mul, ":var2", "$order_blacksmith_days"),
      (val_div, ":var2", "$order_blacksmith_days_initial"),
      (val_mul, ":var2", 50),
      (val_div, ":var2", 100),
      (val_max, ":var2", 500),
      (assign, reg33, ":var2"),
      (store_mul, ":var5", "$order_blacksmith_days", 2),
      (val_div, ":var5", 3),
      (val_max, ":var5", 2),
      (assign, reg34, ":var5"),
    ],
    "Hmm ... I suppose I cash in on some favors I am owed. I have some connections that could get me some of the best material to work with, which speeds up the crafting. Also, having two apprentices would help and allow me to focus a lot better. Plus I can reach out to local smithies who could contribute to the production process as well. With all these extra strings needing to be pulled, I may be able to reduce the production time by a third for {reg33} denars. ^^Shall I do that, Grandmaster?",
    "order_blacksmith_speedup_2",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_speedup_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg33),
    ],
    "Yes, spare no expense and arrange everything needed.",
    "order_blacksmith_speedup_3",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_speedup_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (ge, ":var0", reg33),
    ],
    "I think it's best to wait for now.",
    "close_window",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_speedup_2",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (lt, ":var0", reg33),
    ],
    "I can't afford all that currently. Maybe another time.",
    "close_window",
    []],

  [trp_order_blacksmith, "order_blacksmith_speedup_3",
    [],
    "As you wish, Grandmaster. You item should be ready within {reg34} days.",
    "close_window",
    [
      (troop_remove_gold, "trp_player", reg33),
      (assign, "$order_blacksmith_days", reg34),
      (assign, "$order_blacksmith_asked_for_speedup", 1),
    ]],

  [trp_order_blacksmith, "start",
    [
      (eq, "$order_blacksmith_days", -1),
      (troop_get_inventory_capacity, ":var0", "trp_player"),
      (assign, "$temp", 0),
      (try_for_range, ":var1", 10, ":var0"),
        (troop_get_inventory_slot, ":var2", "trp_player", ":var1"),
        (lt, ":var2", 0),
        (assign, ":var0", 0),
        (assign, "$temp", 1),
      (try_end),
      (eq, "$temp", 1),
      (str_store_item_name, s10, "$order_blacksmith_item"),
    ],
    "Ah, here you are at last, Grandmaster. I have your {s10} right here.",
    "close_window",
    [
      (assign, "$order_blacksmith_days", 0),
      (assign, "$order_blacksmith_asked_for_speedup", 0),
      (troop_add_item, "trp_player", "$order_blacksmith_item", "$order_blacksmith_modifier"),
    ]],

  [trp_order_blacksmith, "start",
    [
      (eq, "$order_blacksmith_days", -1),
      (eq, "$temp", 0),
    ],
    "I have your item ready, but your inventory is full.",
    "close_window",
    []],

  [trp_order_blacksmith, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Greetings, Grandmaster. My name is Alexios and I come from Melitine in Amala.^I've traveled to Pendor to put my smithing skills to good use - there is no other that can best me in the secrets of steelworking, if I say so myself. You are welcome to take advantage of my talents, even if I'm busy forging beautiful new pieces for our best knights.",
    "order_blacksmith_player_response_player",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_player_response_player",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Your reputation precedes you, master Alexios. I will use your talents for sure.",
    "close_window",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
      (assign, "$order_blacksmith_asked_for_speedup", 0),
    ]],

  [trp_order_blacksmith, "start",
    [],
    "Do you need a touch of Melitine magic to your equipment?",
    "order_blacksmith_player_response",
    []],

  [repeat_for_100|plyr|trp_order_blacksmith, "order_blacksmith_player_response",
    [
      (store_repeat_object, ":var0"),
      (lt, ":var0", 8),
      (val_add, ":var0", 0),
      (troop_get_inventory_slot, ":var1", "trp_player", ":var0"),
      (neq, ":var1", -1),
      (assign, ":var2", 1),
      (try_begin),
        (this_or_next|is_between, ":var1", "itm_rune_plate_strange", "itm_leather_gloves"),
        (this_or_next|is_between, ":var1", "itm_kadan_bow", "itm_hunting_crossbow"),
        (this_or_next|is_between, ":var1", "itm_strange_rune_axe", "itm_maul"),
        (this_or_next|is_between, ":var1", "itm_strange_rune_two_h_sword", "itm_strange_sword"),
        (this_or_next|is_between, ":var1", "itm_strange_rune_glaive", "itm_wolf_halberd"),
        (this_or_next|eq, ":var1", "itm_valdis_axe"),
        (eq, ":var1", "itm_sarleon_banner"),
        (assign, ":var2", 0),
      (else_try),
        (item_get_type, ":var3", ":var1"),
        (troop_get_inventory_slot_modifier, ":var4", "trp_player", ":var0"),
        (try_begin),
          (ge, ":var0", 4),
          (this_or_next|eq, ":var4", 29),
          (eq, ":var4", 26),
          (assign, ":var2", 0),
        (else_try),
          (eq, ":var3", 7),
          (eq, ":var4", 27),
          (assign, ":var2", 0),
        (else_try),
          (this_or_next|eq, ":var3", 5),
          (this_or_next|eq, ":var3", 18),
          (eq, ":var3", 6),
          (eq, ":var4", 42),
          (assign, ":var2", 0),
        (else_try),
          (this_or_next|eq, ":var3", 8),
          (this_or_next|eq, ":var3", 9),
          (eq, ":var3", 17),
          (eq, ":var4", 17),
          (assign, ":var2", 0),
        (else_try),
          (eq, ":var3", 10),
          (eq, ":var4", 42),
          (assign, ":var2", 0),
        (else_try),
          (eq, ":var3", 4),
          (this_or_next|eq, ":var4", 17),
          (eq, ":var4", 13),
          (assign, ":var2", 0),
        (else_try),
          (this_or_next|eq, ":var3", 2),
          (eq, ":var3", 3),
          (try_begin),
            (2725, ":var1", 17),
            (eq, ":var4", 17),
            (assign, ":var2", 0),
          (else_try),
            (neg|2725, ":var1", 17),
            (2725, ":var1", 18),
            (eq, ":var4", 18),
            (assign, ":var2", 0),
          (else_try),
            (neg|2725, ":var1", 17),
            (2725, ":var1", 14),
            (eq, ":var4", 14),
            (assign, ":var2", 0),
          (try_end),
        (try_end),
      (try_end),
      (eq, ":var2", 1),
      (str_store_item_name, s5, ":var1"),
    ],
    "Improve {s5}",
    "order_blacksmith_1",
    [
      (store_repeat_object, ":var0"),
      (val_add, ":var0", 0),
      (assign, "$temp", ":var0"),
      (troop_get_inventory_slot, ":var1", "trp_player", ":var0"),
      (str_store_item_name, s5, ":var1"),
    ]],

  [plyr|trp_order_blacksmith, "order_blacksmith_player_response",
    [],
    "That would be all, master Alexios.",
    "close_window",
    []],

  [trp_order_blacksmith, "order_blacksmith_1",
    [
      (troop_get_inventory_slot, "$order_blacksmith_item", "trp_player", "$temp"),
      (troop_get_inventory_slot_modifier, ":var0", "trp_player", "$temp"),
      (item_get_type, ":var1", "$order_blacksmith_item"),
      (try_begin),
        (ge, "$temp", 4),
        (try_begin),
          (2725, "$order_blacksmith_item", 29),
          (try_begin),
            (eq, ":var0", 27),
            (assign, "$order_blacksmith_modifier", 29),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (this_or_next|eq, ":var0", 0),
            (this_or_next|eq, ":var0", 28),
            (eq, ":var0", 25),
            (assign, "$order_blacksmith_modifier", 27),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (else_try),
          (2725, "$order_blacksmith_item", 26),
          (try_begin),
            (eq, ":var0", 25),
            (assign, "$order_blacksmith_modifier", 26),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (this_or_next|eq, ":var0", 0),
            (this_or_next|eq, ":var0", 28),
            (eq, ":var0", 24),
            (assign, "$order_blacksmith_modifier", 25),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$temp", 5),
          (val_add, "$order_blacksmith_days", 30),
        (try_end),
      (else_try),
        (eq, ":var1", 7),
        (try_begin),
          (eq, ":var0", 25),
          (assign, "$order_blacksmith_modifier", 27),
          (str_store_string, s9, "@is in very good shape, but just short of perfection"),
          (assign, "$order_blacksmith_days", 20),
        (else_try),
          (eq, ":var0", 0),
          (assign, "$order_blacksmith_modifier", 25),
          (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
          (assign, "$order_blacksmith_days", 15),
        (else_try),
          (assign, "$order_blacksmith_modifier", 0),
          (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
          (assign, "$order_blacksmith_days", 10),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var1", 5),
        (this_or_next|eq, ":var1", 18),
        (eq, ":var1", 6),
        (try_begin),
          (eq, ":var0", 0),
          (assign, "$order_blacksmith_modifier", 42),
          (str_store_string, s9, "@are well balanced, you just need more of them"),
          (assign, "$order_blacksmith_days", 20),
        (else_try),
          (assign, "$order_blacksmith_modifier", 0),
          (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
          (assign, "$order_blacksmith_days", 10),
        (try_end),
        (try_begin),
          (eq, ":var1", 18),
          (val_add, "$order_blacksmith_days", 20),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var1", 17),
        (eq, ":var1", 9),
        (try_begin),
          (eq, ":var0", 10),
          (assign, "$order_blacksmith_modifier", 17),
          (str_store_string, s9, "@is in very good shape, but just short of perfection"),
          (assign, "$order_blacksmith_days", 50),
        (else_try),
          (eq, ":var0", 0),
          (assign, "$order_blacksmith_modifier", 10),
          (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
          (assign, "$order_blacksmith_days", 30),
        (else_try),
          (assign, "$order_blacksmith_modifier", 0),
          (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
          (assign, "$order_blacksmith_days", 20),
        (try_end),
        (try_begin),
          (eq, ":var1", 17),
          (val_add, "$order_blacksmith_days", 30),
        (try_end),
      (else_try),
        (eq, ":var1", 8),
        (try_begin),
          (eq, ":var0", 19),
          (assign, "$order_blacksmith_modifier", 17),
          (str_store_string, s9, "@is in very good shape, but just short of perfection"),
          (assign, "$order_blacksmith_days", 50),
        (else_try),
          (this_or_next|eq, ":var0", 0),
          (eq, ":var0", 10),
          (assign, "$order_blacksmith_modifier", 19),
          (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
          (assign, "$order_blacksmith_days", 30),
        (else_try),
          (assign, "$order_blacksmith_modifier", 0),
          (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
          (assign, "$order_blacksmith_days", 20),
        (try_end),
      (else_try),
        (eq, ":var1", 10),
        (try_begin),
          (this_or_next|eq, ":var0", 18),
          (eq, ":var0", 13),
          (assign, "$order_blacksmith_modifier", 42),
          (str_store_string, s9, "@are in very good shape, you just need more of them"),
          (assign, "$order_blacksmith_days", 20),
        (else_try),
          (eq, ":var0", 0),
          (assign, "$order_blacksmith_modifier", 13),
          (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
          (assign, "$order_blacksmith_days", 15),
        (else_try),
          (assign, "$order_blacksmith_modifier", 0),
          (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
          (assign, "$order_blacksmith_days", 10),
        (try_end),
      (else_try),
        (eq, ":var1", 4),
        (try_begin),
          (2725, "$order_blacksmith_item", 17),
          (try_begin),
            (eq, ":var0", 18),
            (assign, "$order_blacksmith_modifier", 17),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (eq, ":var0", 0),
            (assign, "$order_blacksmith_modifier", 18),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (else_try),
          (2725, "$order_blacksmith_item", 13),
          (try_begin),
            (eq, ":var0", 10),
            (assign, "$order_blacksmith_modifier", 13),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (eq, ":var0", 0),
            (assign, "$order_blacksmith_modifier", 10),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var1", 2),
        (eq, ":var1", 3),
        (try_begin),
          (2725, "$order_blacksmith_item", 17),
          (2725, "$order_blacksmith_item", 18),
          (try_begin),
            (this_or_next|eq, ":var0", 13),
            (eq, ":var0", 18),
            (assign, "$order_blacksmith_modifier", 17),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (eq, ":var0", 0),
            (try_begin),
              (2725, "$order_blacksmith_item", 13),
              (assign, "$order_blacksmith_modifier", 13),
            (else_try),
              (assign, "$order_blacksmith_modifier", 18),
            (try_end),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (else_try),
          (2725, "$order_blacksmith_item", 18),
          (try_begin),
            (eq, ":var0", 10),
            (assign, "$order_blacksmith_modifier", 18),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 5),
          (else_try),
            (eq, ":var0", 0),
            (assign, "$order_blacksmith_modifier", 10),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 5),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 5),
          (try_end),
        (else_try),
          (2725, "$order_blacksmith_item", 17),
          (2725, "$order_blacksmith_item", 14),
          (try_begin),
            (this_or_next|eq, ":var0", 13),
            (eq, ":var0", 14),
            (assign, "$order_blacksmith_modifier", 17),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 50),
          (else_try),
            (this_or_next|eq, ":var0", 10),
            (this_or_next|eq, ":var0", 16),
            (eq, ":var0", 0),
            (store_random_in_range, ":var2", 0, 100),
            (try_begin),
              (lt, ":var2", 50),
              (assign, "$order_blacksmith_modifier", 13),
            (else_try),
              (assign, "$order_blacksmith_modifier", 14),
            (try_end),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (else_try),
          (2725, "$order_blacksmith_item", 14),
          (try_begin),
            (eq, ":var0", 13),
            (assign, "$order_blacksmith_modifier", 14),
            (str_store_string, s9, "@is in very good shape, but just short of perfection"),
            (assign, "$order_blacksmith_days", 20),
          (else_try),
            (this_or_next|eq, ":var0", 10),
            (eq, ":var0", 0),
            (assign, "$order_blacksmith_modifier", 13),
            (str_store_string, s9, "@is in reasonable shape, with some room for improvement"),
            (assign, "$order_blacksmith_days", 30),
          (else_try),
            (assign, "$order_blacksmith_modifier", 0),
            (str_store_string, s9, "@looks like battlefield loot in grave need of repair"),
            (assign, "$order_blacksmith_days", 20),
          (try_end),
        (try_end),
      (try_end),
      (str_store_item_name, s10, "$order_blacksmith_item"),
      (assign, reg1, "$order_blacksmith_days"),
    ],
    "Let me take a look... Hmm, your {s10} {s9}.^I'll need {reg1} days to work in my enhancements. Would that be convenient for you Grandmaster?",
    "order_blacksmith_2",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_2",
    [],
    "Yes, go ahead.",
    "order_blacksmith_3",
    []],

  [plyr|trp_order_blacksmith, "order_blacksmith_2",
    [],
    "No, that's too long for me.",
    "start",
    [
      (assign, "$order_blacksmith_days", 0),
    ]],

  [trp_order_blacksmith, "order_blacksmith_3",
    [],
    "Very well, I'll do my best, and that's saying something.",
    "close_window",
    [
      (assign, "$order_blacksmith_days_initial", "$order_blacksmith_days"),
      (assign, "$order_blacksmith_asked_for_speedup", 0),
      (troop_set_inventory_slot, "trp_player", "$temp", -1),
    ]],

  [trp_order_quartermaster, "start",
    [
      (troop_slot_eq, "$g_talk_troop", 80, 0),
    ],
    "Well, hello {playername}, er, Grandmaster. As your Quartermaster I'm in charge of supplying our forces, a hard task now that we are teeming with new recruits.^I do have a fine selection of delicacies for our high-ranking officers, and you are most welcome to peruse my offerings, including lesser food for your soldiers - they need not go hungry on a siege ever again!",
    "order_quartermaster_player_response",
    [
      (troop_set_slot, "$g_talk_troop", 80, 1),
    ]],

  [trp_order_quartermaster, "start",
    [],
    "Ah yes, we just received more bread - did you know there's a Pendor-wide shortage? It's baffling.",
    "order_quartermaster_player_response",
    []],

  [plyr|trp_order_quartermaster, "order_quartermaster_player_response",
    [],
    "Show me your supplies.",
    "order_quartermaster_1",
    [
      (change_screen_trade),
    ]],

  [plyr|trp_order_quartermaster, "order_quartermaster_player_response",
    [],
    "That would be all, Quartermaster.",
    "close_window",
    []],

  [trp_order_quartermaster, "order_quartermaster_1",
    [],
    "Anything else?",
    "order_quartermaster_player_response",
    []],

  [anyone, "start",
    [],
    "Surrender or die. Make your choice.",
    "companion_comment",
    [
      (str_store_string, s3, "@Today is a good day to die! Let us fight."),
      (assign, "$random_companion", 0),
    ]],

  [anyone, "start",
    [],
    "Hello. What can I do for you?",
    "free",
    []],

  [plyr|anyone, "free",
    [
      (neg|in_meta_mission),
    ],
    "Tell me about yourself",
    "view_char_requested",
    []],

  [anyone, "view_char_requested",
    [],
    "Very well, listen to this...",
    "view_char",
    [
      (change_screen_view_character),
    ]],

  [anyone, "view_char",
    [],
    "Anything else?",
    "free",
    []],

  [plyr|anyone, "end",
    [],
    "[Done]",
    "close_window",
    []],

  [plyr|anyone, "start",
    [],
    "Drop your weapons and surrender if you want to live",
    "threaten_1",
    []],

  [anyone, "threaten_1",
    [],
    "We will fight you first",
    "end",
    [
      (encounter_attack),
    ]],

  [anyone, "member_direct_campaign",
    [],
    "Yes, {reg63?my lord:my lady}. Which message do you wish to send to the vassals?",
    "member_direct_campaign_choice",
    []],

  [plyr|anyone, "member_direct_campaign_choice",
    [
      (neg|this_or_next|faction_slot_ge, "$players_kingdom", 8, "trp_npc_adonja"),
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 0),
      (faction_slot_eq, "$players_kingdom", 4, 6),
    ],
    "I want to start a new campaign. Let us assemble the army here.",
    "member_direct_campaign_call_to_arms_verify",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 8),
      (try_begin),
        (ge, ":var0", 0),
        (troop_get_slot, ":var1", ":var0", 10),
        (party_is_active, ":var1"),
        (1604, ":var1", 0),
      (try_end),
      (faction_set_slot, "$players_kingdom", 8, "trp_player"),
    ]],

  [plyr|anyone, "member_direct_campaign_choice",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|faction_slot_eq, "$players_kingdom", 4, 0),
      (neg|faction_slot_eq, "$players_kingdom", 4, 6),
    ],
    "I want to end the campaign and let everyone return home.",
    "member_give_order_disband_army_verify",
    []],

  [plyr|anyone, "member_direct_campaign_choice",
    [
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (neg|faction_slot_eq, "$players_kingdom", 4, 6),
      (check_quest_active, "qst_organize_feast"),
      (quest_get_slot, ":var0", "qst_organize_feast", 1),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "$players_kingdom"),
      (str_store_party_name, s4, ":var0"),
    ],
    "I wish to invite the vassals of the realm to a feast at {s4}.",
    "member_give_order_invite_feast_verify",
    []],

  [plyr|anyone, "member_direct_campaign_choice",
    [],
    "Never mind",
    "member_pretalk",
    []],

  [anyone, "member_give_order_invite_feast_verify",
    [],
    "You wish to invite the lords of the realm to a feast?",
    "member_give_order_invite_feast_verify_2",
    []],

  [plyr|anyone, "member_give_order_invite_feast_verify_2",
    [],
    "Yes. It is time for us to strengthen the bonds that bring us together.",
    "member_give_order_invite_feast",
    []],

  [plyr|anyone, "member_give_order_invite_feast_verify_2",
    [],
    "On second thought, this is perhaps not the time.",
    "member_pretalk",
    []],

  [anyone, "member_give_order_invite_feast",
    [
      (quest_get_slot, ":var0", "qst_organize_feast", 1),
      (str_store_party_name, s4, ":var0"),
    ],
    "All right then. I shall dispatch messengers informing the lords of the realm of your feast at {s4}.",
    "member_pretalk",
    [
      (quest_get_slot, ":var0", "qst_organize_feast", 1),
      (assign, "$player_marshal_ai_state", 6),
      (assign, "$player_marshal_ai_object", ":var0"),
      (call_script, "script_decide_faction_ai", "$players_kingdom"),
      (assign, "$g_recalculate_ais", 1),
      (str_store_party_name, s4, ":var0"),
    ]],

  [anyone, "member_direct_campaign_call_to_arms_verify",
    [],
    "You wish to summon all lords for a new campaign?",
    "member_give_order_call_to_arms_verify_2",
    []],

  [plyr|anyone, "member_give_order_call_to_arms_verify_2",
    [],
    "Yes. We must gather all our forces before we march on the enemy.",
    "member_give_order_call_to_arms",
    []],

  [plyr|anyone, "member_give_order_call_to_arms_verify_2",
    [],
    "On second thought, it won't be necessary to summon everyone.",
    "member_pretalk",
    []],

  [anyone, "member_give_order_call_to_arms",
    [],
    "All right then. I will send messengers and tell everyone to come here.",
    "member_pretalk",
    [
      (assign, "$player_marshal_ai_state", 1),
      (assign, "$player_marshal_ai_object", "p_main_party"),
      (call_script, "script_decide_faction_ai", "$players_kingdom"),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [anyone, "member_give_order_disband_army_verify",
    [],
    "You want to end the current campaign and release all lords from duty?",
    "member_give_order_disband_army_2",
    []],

  [plyr|anyone, "member_give_order_disband_army_2",
    [],
    "Yes. We no longer need all our forces here.",
    "member_give_order_disband_army",
    []],

  [plyr|anyone, "member_give_order_disband_army_2",
    [],
    "On second thought, it will be better to stay together for now.",
    "member_pretalk",
    []],

  [anyone, "member_give_order_disband_army",
    [],
    "All right. I will let everyone know that they are released from duty.",
    "member_pretalk",
    [
      (assign, "$player_marshal_ai_state", 0),
      (assign, "$player_marshal_ai_object", -1),
      (call_script, "script_decide_faction_ai", "$players_kingdom"),
      (assign, "$g_recalculate_ais", 1),
    ]],

  [anyone, "mayor_wealth_comparison_1",
    [
      (assign, ":var0", "$g_encountered_party"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (party_get_slot, ":var3", "$g_encountered_party", 50),
      (party_get_slot, ":var4", "$g_encountered_party", 50),
      (try_for_range, ":var5", "p_town_1", "p_castle_1"),
        (neq, ":var5", "$g_encountered_party"),
        (party_get_slot, ":var6", ":var5", 50),
        (try_begin),
          (gt, ":var6", ":var3"),
          (val_add, ":var2", 1),
          (assign, ":var0", ":var5"),
          (assign, ":var3", ":var6"),
        (else_try),
          (gt, ":var6", ":var4"),
          (val_add, ":var2", 1),
        (else_try),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg4, ":var2"),
      (assign, reg5, ":var1"),
      (str_store_party_name, s5, "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "Overall, the wealthiest town in Pendor is known to be {s4}. Here in {s5}, we are poorer than {reg4} towns, and richer than {reg5}.",
    "mayor_wealth_comparison_2",
    []],

  [anyone, "mayor_wealth_comparison_2",
    [
      (assign, ":var0", "$g_encountered_party"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (assign, ":var3", 0),
      (try_for_range, ":var4", "itm_spice", "itm_baggage_train"),
        (call_script, "script_center_get_production", "$g_encountered_party", ":var4"),
        (val_add, ":var3", reg0),
      (try_end),
      (assign, ":var5", ":var3"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg4, ":var3"),
        (str_store_party_name, s4, "$g_encountered_party"),
        (display_message, "@{!}DEBUG -- Total production for {s4}: {reg4}"),
      (try_end),
      (try_for_range, ":var6", "p_town_1", "p_castle_1"),
        (neq, ":var6", "$g_encountered_party"),
        (assign, ":var7", 0),
        (try_for_range, ":var4", "itm_spice", "itm_baggage_train"),
          (call_script, "script_center_get_production", ":var6", ":var4"),
          (val_add, ":var7", reg0),
        (try_end),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg4, ":var7"),
          (str_store_party_name, s4, ":var6"),
          (display_message, "@{!}DEBUG -- Total production for {s4}: {reg4}"),
        (try_end),
        (try_begin),
          (gt, ":var7", ":var5"),
          (val_add, ":var2", 1),
          (assign, ":var0", ":var6"),
          (assign, ":var5", ":var7"),
        (else_try),
          (gt, ":var7", ":var3"),
          (val_add, ":var2", 1),
        (else_try),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg4, ":var2"),
      (assign, reg5, ":var1"),
      (str_store_party_name, s5, "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "In terms of local industry, the most productive town in Pendor is known to be {s4}. Here in {s5}, we produce less than {reg4} towns, and produce more than {reg5}. Production is, of course, affected by the supply of raw materials, as well as by the overall prosperity of the town.",
    "mayor_wealth_comparison_3",
    []],

  [anyone, "mayor_wealth_comparison_3",
    [
      (assign, ":var0", "$g_encountered_party"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", "p_town_1", "p_castle_1"),
        (party_set_slot, ":var3", 248, 0),
      (try_end),
      (try_for_range, ":var4", "p_village_1", "p_salt_mine"),
        (assign, ":var5", 0),
        (try_for_range, ":var6", "itm_spice", "itm_baggage_train"),
          (call_script, "script_center_get_production", ":var4", ":var6"),
          (val_add, ":var5", reg0),
        (try_end),
        (party_get_slot, ":var7", ":var4", 121),
        (party_get_slot, ":var8", ":var7", 248),
        (val_add, ":var8", ":var5"),
        (party_set_slot, ":var7", 248, ":var8"),
      (try_end),
      (party_get_slot, ":var9", "$g_encountered_party", 248),
      (assign, ":var10", ":var9"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg4, ":var9"),
        (str_store_party_name, s4, "$g_encountered_party"),
        (display_message, "@{!}DEBUG -- Total rural production for {s4} region: {reg4}"),
      (try_end),
      (try_for_range, ":var11", "p_town_1", "p_castle_1"),
        (neq, ":var11", "$g_encountered_party"),
        (party_get_slot, ":var12", ":var11", 248),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg4, ":var12"),
          (str_store_party_name, s4, ":var11"),
          (display_message, "@{!}DEBUG -- Total rural production for {s4} region: {reg4}"),
        (try_end),
        (try_begin),
          (gt, ":var12", ":var10"),
          (val_add, ":var2", 1),
          (assign, ":var0", ":var11"),
          (assign, ":var10", ":var12"),
        (else_try),
          (gt, ":var12", ":var9"),
          (val_add, ":var2", 1),
        (else_try),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg4, ":var2"),
      (assign, reg5, ":var1"),
      (str_store_party_name, s5, "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "In terms of the output of the surrounding villages, the town of {s4} is the richest in Pendor. Here in {s5}, the villages produce less than the hinterland around {reg4} towns, and produce more than {reg5}. The wealth of a town's hinterland, of course, is heavily dependent on the tides of war. Looting and pillage, and shifts in territory, can make a major impact.",
    "mayor_wealth_comparison_4",
    []],

  [anyone, "mayor_wealth_comparison_4",
    [
      (assign, ":var0", "$g_encountered_party"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", "p_town_1", "p_castle_1"),
        (party_set_slot, ":var3", 248, 0),
      (try_end),
      (try_for_range, ":var4", 0, "$num_log_entries"),
        (store_sub, ":var5", "$num_log_entries", ":var4"),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 5),
        (troop_get_slot, ":var6", "trp_log_array_entry_time", ":var5"),
        (store_current_hours, ":var7"),
        (store_sub, ":var8", ":var7", ":var6"),
        (lt, ":var8", 1344),
        (troop_get_slot, ":var9", "trp_log_array_center_object", ":var5"),
        (is_between, ":var9", "p_town_1", "p_castle_1"),
        (troop_get_slot, ":var10", "trp_log_array_troop_object", ":var5"),
        (party_get_slot, ":var11", ":var10", 248),
        (val_add, ":var11", 1),
        (party_set_slot, ":var10", 248, ":var11"),
      (try_end),
      (party_get_slot, ":var12", "$g_encountered_party", 248),
      (assign, ":var13", ":var12"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg4, ":var12"),
        (str_store_party_name, s4, "$g_encountered_party"),
        (display_message, "@{!}DEBUG -- Total trade for {s4}: {reg4}"),
      (try_end),
      (try_for_range, ":var14", "p_town_1", "p_castle_1"),
        (neq, ":var14", "$g_encountered_party"),
        (party_get_slot, ":var15", ":var14", 248),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg4, ":var15"),
          (str_store_party_name, s4, ":var14"),
          (display_message, "@{!}DEBUG -- Total trade for {s4}: {reg4}"),
        (try_end),
        (try_begin),
          (gt, ":var15", ":var13"),
          (val_add, ":var2", 1),
          (assign, ":var0", ":var14"),
          (assign, ":var13", ":var15"),
        (else_try),
          (gt, ":var15", ":var12"),
          (val_add, ":var2", 1),
        (else_try),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg4, ":var2"),
      (assign, reg5, ":var1"),
      (str_store_party_name, s5, "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "In terms of trade, the town of {s4} is believed to have received the most visits from caravans over the past few months. Here in {s5}, we are less visited than {reg4} towns, and more visited than {reg5}. ",
    "mayor_wealth_comparison_5",
    []],

  [anyone, "mayor_wealth_comparison_5",
    [
      (assign, ":var0", "$g_encountered_party"),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", "p_town_1", "p_castle_1"),
        (party_set_slot, ":var3", 248, 0),
      (try_end),
      (try_for_range, ":var4", 0, "$num_log_entries"),
        (store_sub, ":var5", "$num_log_entries", ":var4"),
        (troop_slot_eq, "trp_log_array_entry_type", ":var5", 3),
        (troop_get_slot, ":var6", "trp_log_array_entry_time", ":var5"),
        (store_current_hours, ":var7"),
        (store_sub, ":var8", ":var7", ":var6"),
        (lt, ":var8", 1344),
        (troop_get_slot, ":var9", "trp_log_array_center_object", ":var5"),
        (troop_get_slot, ":var10", "trp_log_array_troop_object", ":var5"),
        (try_begin),
          (is_between, ":var10", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var11", ":var10", 248),
          (val_add, ":var11", 1),
          (party_set_slot, ":var10", 248, ":var11"),
        (try_end),
        (try_begin),
          (is_between, ":var9", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var11", ":var9", 248),
          (val_add, ":var11", 1),
          (party_set_slot, ":var9", 248, ":var11"),
        (try_end),
      (try_end),
      (party_get_slot, ":var12", "$g_encountered_party", 248),
      (assign, ":var13", ":var12"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg4, ":var12"),
        (str_store_party_name, s4, "$g_encountered_party"),
        (display_message, "@{!}DEBUG -- Total attacks for {s4}: {reg4}"),
      (try_end),
      (try_for_range, ":var14", "p_town_1", "p_castle_1"),
        (neq, ":var14", "$g_encountered_party"),
        (party_get_slot, ":var15", ":var14", 248),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg4, ":var15"),
          (str_store_party_name, s4, ":var14"),
          (display_message, "@{!}DEBUG -- Total attacks for {s4}: {reg4}"),
        (try_end),
        (try_begin),
          (gt, ":var15", ":var13"),
          (val_add, ":var2", 1),
          (assign, ":var0", ":var14"),
          (assign, ":var13", ":var15"),
        (else_try),
          (gt, ":var15", ":var12"),
          (val_add, ":var2", 1),
        (else_try),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg4, ":var2"),
      (assign, reg5, ":var1"),
      (str_store_party_name, s5, "$g_encountered_party"),
      (str_store_party_name, s4, ":var0"),
    ],
    "In terms of attacks on travelers, the town of {s4} is believed to be the most dangerous. Here in {s5}, we are less afflicted by bandits and raiders than {reg4} towns, and more afflicted than {reg5}. ",
    "mayor_pretalk",
    []],

  [plyr|anyone, "free",
    [
      (in_meta_mission),
    ],
    " Good-bye.",
    "close_window",
    []],

  [plyr|anyone, "free",
    [
      (neg|in_meta_mission),
    ],
    " [Leave]",
    "close_window",
    []],

]
