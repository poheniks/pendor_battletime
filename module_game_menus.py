# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_game_menus import *
from header_parties import *
from header_items import *
from header_mission_templates import *
from header_music import *
from header_terrain_types import *

from module_constants import *

####################################################################################################################
#  (menu-id, menu-flags, menu_text, mesh-name, [<operations>], [<options>]),
#
#   Each game menu is a tuple that contains the following fields:
#  
#  1) Game-menu id (string): used for referencing game-menus in other files.
#     The prefix menu_ is automatically added before each game-menu-id
#
#  2) Game-menu flags (int). See header_game_menus.py for a list of available flags.
#     You can also specify menu text color here, with the menu_text_color macro
#  3) Game-menu text (string).
#  4) mesh-name (string). Not currently used. Must be the string "none"
#  5) Operations block (list). A list of operations. See header_operations.py for reference.
#     The operations block is executed when the game menu is activated.
#  6) List of Menu options (List).
#     Each menu-option record is a tuple containing the following fields:
#   6.1) Menu-option-id (string) used for referencing game-menus in other files.
#        The prefix mno_ is automatically added before each menu-option.
#   6.2) Conditions block (list). This must be a valid operation block. See header_operations.py for reference. 
#        The conditions are executed for each menu option to decide whether the option will be shown to the player or not.
#   6.3) Menu-option text (string).
#   6.4) Consequences block (list). This must be a valid operation block. See header_operations.py for reference. 
#        The consequences are executed for the menu option that has been selected by the player.
#
#
# Note: The first Menu is the initial character creation menu.
####################################################################################################################

game_menus = [
  ("start_game_0", menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "Welcome, adventurer, to Prophesy of Pendor! ^ Before beginning the game you must create your character. ^^ Be very careful, Adventurer. Your background choices here will forever impact your options and opportunities in Pendor.",
    "none",
    [
      (assign, "$astraea_aid_snd", 0),
      (assign, "$wrath_of_indar", 0),
      (assign, "$damia_command", 0),
      (assign, "$claws_of_vejovis", 0),
      (assign, "$eunomia_warning", 0),
      (assign, "$hafsigla_wrath", 0),
      (assign, "$thallo_defend", 0),
      (assign, "$vata_command", 0),
      (assign, "$ullbow", 0),
      (assign, "$g_bard_job", -40),
      (assign, "$snouz_test_war", 0),
      (assign, "$fadefromblack", 1),
      (271, 120),
      (assign, "$bf_size_option", 3),
      (assign, "$g_defender_reinforcement_limit_siege", 36),
      (assign, "$g_attacker_reinforcement_limit_siege", 36),
      (assign, "$g_defender_reinforcement_limit", 14),
      (assign, "$g_attacker_reinforcement_limit", 14),
      (assign, "$g_option_show_ratio_bar", 1),
      (assign, "$g_option_ratio_bar_is_global", 0),
      (set_background_mesh, "mesh_pic_pendor_newgame"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_start_game_1"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("start_phase_2", mnf_disable_all_keys|mnf_scale_picture,
    "By the grace of the divine, you arrive in Pendor, a land plagued by constant strife for over 150 years. You have accepted a daunting challenge: to stave off the influence of evil, reunite the warring factions of the old Kingdom, and create a new possibility for Pendor, as echoed by the mad wanderer, Madigan. These are dangerous lands, where many powers, great and small, vie against one another for supremacy. Here you will find honor and nobility, but also deceit and skulduggery. There will be valorous knights, and black-hearted assassins. You will leave your past behind to start a new life. Pendor is not your typical medieval country. Women and men have equal chances of successes and failure in Pendor. If you succeed, you will create another destiny, a new possibility in the infinite dimensions of reality. Your choices may create a new thread in the weave for the Oracle to choose, and offer the possibility that your actions may save us all. Drawn by the stories you hear about Pendor and its kingdoms, you.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_phase_2"),
    ],
    [
      ("town_1",
      [
        (eq, "$current_startup_quest_phase", 0),
        (store_relation, ":var0", "fac_kingdom_1", "fac_player_faction"),
        (ge, ":var0", 0),
      ],
      "join_a_caravan_to_Sarleon,_in_the_Kingdom_of_Sarleon.",
      [
        (assign, "$current_town", "p_town_6"),
        (assign, "$g_starting_town", "$current_town"),
        (assign, "$g_journey_string", "str_journey_to_sarleon"),
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),

      ("town_2",
      [
        (eq, "$current_startup_quest_phase", 0),
        (store_relation, ":var0", "fac_kingdom_2", "fac_player_faction"),
        (ge, ":var0", 0),
      ],
      "join_a_caravan_to_Ravenstern,_in_the_Kingdom_of_Ravenstern.",
      [
        (assign, "$current_town", "p_town_8"),
        (assign, "$g_starting_town", "$current_town"),
        (assign, "$g_journey_string", "str_journey_to_ravenstern"),
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),

      ("town_3",
      [
        (eq, "$current_startup_quest_phase", 0),
        (store_relation, ":var0", "fac_kingdom_3", "fac_player_faction"),
        (ge, ":var0", 0),
      ],
      "join_a_caravan_to_Torbah,_in_the_D'Shar_Principalities.",
      [
        (assign, "$current_town", "p_town_10"),
        (assign, "$g_starting_town", "$current_town"),
        (assign, "$g_journey_string", "str_journey_to_torbah"),
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),

      ("town_4",
      [
        (eq, "$current_startup_quest_phase", 0),
        (store_relation, ":var0", "fac_kingdom_4", "fac_player_faction"),
        (ge, ":var0", 0),
      ],
      "take_a_ship_to_Javiksholm,_in_the_Fierdsvain.",
      [
        (assign, "$current_town", "p_town_1"),
        (assign, "$g_starting_town", "$current_town"),
        (assign, "$g_journey_string", "str_journey_to_javiksholm"),
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),

      ("town_5",
      [
        (eq, "$current_startup_quest_phase", 0),
        (store_relation, ":var0", "fac_kingdom_5", "fac_player_faction"),
        (ge, ":var0", 0),
      ],
      "take_a_ship_to_Janos,_in_the_Empire.",
      [
        (assign, "$current_town", "p_town_5"),
        (assign, "$g_starting_town", "$current_town"),
        (assign, "$g_journey_string", "str_journey_to_janos"),
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),

      ("pop_cheat",
      [
        (eq, 0, 1),
      ],
      "[TEST]_Just_let_me_play!",
      [
        (call_script, "script_get_player_party_morale_values"),
        (party_set_morale, "p_main_party", reg0),
        (party_relocate_near_party, "p_main_party", "p_town_6", 2),
        (troop_sort_inventory, "trp_player"),
        (change_screen_return),
      ]
      ),

      ("tutorial_cheat",
      [
        (eq, 1, 0),
      ],
      "{!}CHEAT!",
      [
        (change_screen_return),
        (assign, "$cheat_mode", 1),
        (set_show_messages, 0),
        (add_xp_to_troop, 15000, "trp_player"),
        (troop_raise_skill, "trp_player", skl_leadership, 7),
        (troop_raise_skill, "trp_player", skl_prisoner_management, 5),
        (troop_raise_skill, "trp_player", skl_inventory_management, 10),
        (party_add_members, "p_main_party", "trp_sarleon_knight", 10),
        (party_add_members, "p_main_party", "trp_rav_knight", 10),
        (party_add_members, "p_main_party", "trp_rav_archer", 10),
        (party_add_members, "p_main_party", "trp_sarleon_arm_longbowman", 10),
        (troop_add_item, "trp_player", "itm_scale_armor", imod_plain),
        (troop_add_item, "trp_player", "itm_full_helm", imod_plain),
        (troop_add_item, "trp_player", "itm_awlpike", imod_plain),
        (set_show_messages, 1),
        (try_for_range, ":var0", "scn_town_1_center", "scn_castle_1_exterior"),
          (scene_set_slot, ":var0", 0, 1),
        (try_end),
        (call_script, "script_get_player_party_morale_values"),
        (party_set_morale, "p_main_party", reg0),
      ]
      ),
    ],
  ),

  ("start_game_3", mnf_disable_all_keys,
    "Choose your scenario:",
    "none",
    [
      (assign, "$g_custom_battle_scenario", 0),
      (assign, "$g_custom_battle_scenario", "$g_custom_battle_scenario"),
    ],
    [
      ("go_back",
      [],
      "Go_back",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("tutorial", mnf_disable_all_keys,
    "You approach a field where the locals are training with weapons. You can practice here to improve your combat skills.",
    "none",
    [
      (try_begin),
        (eq, "$g_tutorial_entered", 1),
        (change_screen_quit),
      (else_try),
        (set_passage_menu, "mnu_tutorial"),
        (assign, "$g_tutorial_entered", 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (modify_visitors_at_site, "scn_tutorial_training_ground"),
        (reset_visitors, 0),
        (set_player_troop, "trp_player"),
        (assign, "$g_player_troop", "trp_player"),
        (troop_raise_attribute, "$g_player_troop", ca_strength, 12),
        (troop_raise_attribute, "$g_player_troop", ca_agility, 9),
        (troop_raise_attribute, "$g_player_troop", ca_charisma, 5),
        (troop_raise_skill, "$g_player_troop", skl_shield, 3),
        (troop_raise_skill, "$g_player_troop", skl_athletics, 2),
        (troop_raise_skill, "$g_player_troop", skl_riding, 3),
        (troop_raise_skill, "$g_player_troop", skl_power_strike, 1),
        (troop_raise_skill, "$g_player_troop", skl_power_draw, 5),
        (troop_raise_skill, "$g_player_troop", skl_weapon_master, 4),
        (troop_raise_skill, "$g_player_troop", skl_ironflesh, 1),
        (troop_raise_skill, "$g_player_troop", skl_horse_archery, 6),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_one_handed_weapon, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_two_handed_weapon, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_polearm, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_crossbow, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_throwing, 70),
        (troop_clear_inventory, "$g_player_troop"),
        (troop_add_item, "$g_player_troop", "itm_leather_jerkin", imod_plain),
        (troop_add_item, "$g_player_troop", "itm_leather_boots", imod_plain),
        (troop_add_item, "$g_player_troop", "itm_practice_sword", imod_plain),
        (troop_add_item, "$g_player_troop", "itm_quarter_staff", imod_plain),
        (troop_equip_items, "$g_player_troop"),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 32, "trp_tutorial_fighter_1"),
        (set_visitor, 33, "trp_tutorial_fighter_2"),
        (set_visitor, 34, "trp_tutorial_fighter_3"),
        (set_visitor, 35, "trp_tutorial_fighter_4"),
        (set_visitor, 40, "trp_tutorial_master_archer"),
        (set_visitor, 41, "trp_tutorial_archer_1"),
        (set_visitor, 42, "trp_tutorial_archer_1"),
        (set_visitor, 60, "trp_tutorial_master_horseman"),
        (set_visitor, 61, "trp_tutorial_rider_1"),
        (set_visitor, 62, "trp_tutorial_rider_1"),
        (set_visitor, 63, "trp_tutorial_rider_2"),
        (set_visitor, 64, "trp_tutorial_rider_2"),
        (set_jump_mission, "mt_tutorial_training_ground"),
        (jump_to_scene, "scn_tutorial_training_ground"),
        (change_screen_mission),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("reports", mnf_scale_picture,
    "Character Renown/Prestige: {reg5}^ ^Honor Rating: {reg6}^Prestige spent: {reg9}^Base prestige cost of Honor troops: {reg10}^^Party Morale: {reg8}^Party Size Limit: {reg7}^^Next Payday: {s60}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_reports"),
      (call_script, "script_game_get_party_companion_limit"),
      (assign, ":var0", reg0),
      (troop_get_slot, ":var1", "trp_player", 7),
      (assign, reg5, ":var1"),
      (assign, reg6, "$player_honor"),
      (assign, reg7, ":var0"),
      (party_get_morale, reg8, "p_main_party"),
      (troop_get_slot, ":var2", "trp_player", 156),
      (assign, reg9, ":var2"),
      (assign, reg10, 450),
      (val_sub, reg10, "$player_honor"),
      (val_div, reg10, 10),
      (val_clamp, reg10, 10, 46),
      (str_store_date, s60, "$payday_date"),
    ],
    [
      ("cheat_faction_orders",
      [
        (ge, "$cheat_mode", 1),
      ],
      "{!}Cheat:_Faction_orders.",
      [
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("action_view_troop_trees",
      [],
      "Troop_trees.",
      [
        (start_presentation, "prsnt_faction_troop_trees"),
      ]
      ),

      ("view_character_report",
      [],
      "View_character_report.",
      [
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("view_party_size_report",
      [],
      "View_party_size_report.",
      [
        (jump_to_menu, "mnu_party_size_report"),
      ]
      ),

      ("view_morale_report",
      [],
      "View_party_morale_report.",
      [
        (jump_to_menu, "mnu_morale_report"),
      ]
      ),

      ("view_weekly_budget_report",
      [],
      "View_weekly_budget_report.",
      [
        (assign, "$g_apply_budget_report_to_gold", 0),
        (start_presentation, "prsnt_budget_report"),
      ]
      ),

      ("view_center_income_report",
      [],
      "View_location_income_report.",
      [
        (jump_to_menu, "mnu_center_income_report"),
      ]
      ),

      ("view_victory_condition_report",
      [],
      "View_victory_progress.",
      [
        (jump_to_menu, "mnu_victory_progress_report"),
      ]
      ),

      ("view_achievement_report",
      [],
      "View_achievements.",
      [
        (assign, "$g_achievement_page_no", 0),
        (start_presentation, "prsnt_achievement_report"),
      ]
      ),

      ("status_check",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}NPC_status_check.",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var0"),
          (str_store_troop_name, s4, ":var0"),
          (troop_get_slot, reg3, ":var0", 61),
          (troop_get_slot, reg4, ":var0", 65),
          (troop_get_slot, reg5, ":var0", 72),
          (troop_get_slot, reg6, ":var0", 74),
          (troop_get_slot, reg7, ":var0", 76),
          (display_message, "@{!}{s4}: M{reg3}, 2M{reg4}, PC{reg5}, 2PC{reg6}, PM{reg7}"),
        (try_end),
      ]
      ),

      ("view_faction_relations_report",
      [],
      "View_faction_relations_report.",
      [
        (jump_to_menu, "mnu_faction_relations_report"),
      ]
      ),

      ("view_npc_mission_report",
      [],
      "View_companion_mission_report.",
      [
        (jump_to_menu, "mnu_companion_report"),
      ]
      ),

      ("lord_relations",
      [],
      "View_list_of_known_lords_by_relation.",
      [
        (jump_to_menu, "mnu_lord_relations"),
      ]
      ),

      ("courtship_relations",
      [],
      "View_courtship_relations.",
      [
        (jump_to_menu, "mnu_courtship_relations"),
      ]
      ),

      ("action_view_world_map",
      [],
      "Pendor_map.",
      [
        (start_presentation, "prsnt_world_map"),
      ]
      ),

      ("resume_travelling",
      [],
      "Resume_travelling.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("custom_battle_scene", menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "(NO TRANS)",
    "none",
    [],
    [
      ("quick_battle_scene_1",
      [],
      "{!}quick_battle_scene_1",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_quick_battle_scene_1"),
        (change_screen_mission),
      ]
      ),

      ("quick_battle_scene_2",
      [],
      "{!}quick_battle_scene_2",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_quick_battle_scene_2"),
        (change_screen_mission),
      ]
      ),

      ("quick_battle_scene_3",
      [],
      "{!}quick_battle_scene_3",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_quick_battle_scene_3"),
        (change_screen_mission),
      ]
      ),

      ("quick_battle_scene_4",
      [],
      "{!}quick_battle_scene_4",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_quick_battle_scene_4"),
        (change_screen_mission),
      ]
      ),

      ("quick_battle_scene_5",
      [],
      "{!}quick_battle_scene_5",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_quick_battle_scene_5"),
        (change_screen_mission),
      ]
      ),

      ("go_back_a",
      [],
      "{!}Go_back",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("custom_battle_end", mnf_disable_all_keys,
    "The battle is over. {s1} Your side killed {reg5} enemies and lost {reg6} troops over the battle. You personally slew {reg7} men in the fighting.",
    "none",
    [
      (music_set_situation, 0),
      (assign, reg5, "$g_custom_battle_team2_death_count"),
      (assign, reg6, "$g_custom_battle_team1_death_count"),
      (get_player_agent_kill_count, ":var0"),
      (get_player_agent_kill_count, ":var1", 1),
      (store_add, reg7, ":var0", ":var1"),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s1, "str_battle_won"),
      (else_try),
        (str_store_string, s1, "str_battle_lost"),
      (try_end),
      (try_begin),
        (ge, "$g_custom_battle_team2_death_count", 100),
        (372, 4),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("start_game_1", menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "Select your character's gender.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_game_1"),
    ],
    [
      ("start_male",
      [],
      "Male.",
      [
        (troop_set_type, "trp_player", 0),
        (assign, "$character_gender", 0),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("start_female",
      [],
      "Female_(Warband_faces).",
      [
        (troop_set_type, "trp_player", 1),
        (assign, "$character_gender", 1),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("start_female_2",
      [],
      "Female_(Custom_faces).",
      [
        (troop_set_type, "trp_player", 2),
        (assign, "$character_gender", 2),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (jump_to_menu, "mnu_start_game_0"),
      ]
      ),
    ],
  ),

  ("start_character_1", mnf_disable_all_keys|mnf_scale_picture,
    "You were born years ago, and reside now in the Land of Barclay, far to the West and South of Pendor. Your father was...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_character_1"),
      (str_clear, s10),
      (str_clear, s11),
      (str_clear, s12),
      (str_clear, s13),
      (str_clear, s14),
      (str_clear, s15),
      (str_clear, s16),
    ],
    [
      ("start_noble",
      [],
      "a_minor_noble.",
      [
        (assign, "$background_type", 1),
        (assign, reg3, "$character_gender"),
        (str_store_string, s10, "@You came into the world the {reg3?daughter:son} of displaced nobility from the land of Pendor. Your family fled the Pendoran city of Cez just after you were born, and purchased a tumbledown manor in an outlying district of Barclay. Your father and his retainers managed to provide you with a good education in the duties of the aristocracy and the idioms of life at court. Your mother and father rarely spoke of their history in Pendor, though you did get the sense that you mother was not from the Baccus Empire that now holds claim to the lands where your father was raised."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_merchant",
      [],
      "a_merchant_ship_captain.",
      [
        (assign, "$background_type", 2),
        (assign, reg3, "$character_gender"),
        (str_store_string, s10, "@You were born the {reg3?daughter:son} of a Fierdsvain Merchant Ship Captain, and his wife from Sarleon. Together they traded between Barclay and the Ports of Pendor, dodging pirates, outwitting corrupt harbor masters and avoiding the vicious Red Brotherhood, which seemed to grow stronger each year. Your father grew prosperous from his ventures, and paid off the debt on his ship to the Ship masters Guild in Barclay with a percentage of his earnings. It was a modest life but they provided you with a good education and a talent for making profit and opening new markets."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_guard",
      [],
      "a_former_knight.",
      [
        (assign, "$background_type", 3),
        (assign, reg3, "$character_gender"),
        (str_store_string, s10, "@When you were a child, your father earned a respectable living as a master-at-arms in Barclay, hiring out to those who could pay for his services. He had great skill with a sword. Patiently he taught you all he knew, and you became capable with both sword and lance. He was rough, callous, but fair. Your mother was a minor Noble from Pendor who spoke very little of her past - though she did let on that she met your father when he rescued her from kidnappers. Your father spoke only once of the Knighthood Order to which he belonged, and then only said that it had been outlawed by order of the former King of Sarleon. He refused to answer your many questions about his deeds or even the name of the Order, saying only that he preferred not to speak of it."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_forester",
      [],
      "a_retired_adventurer.",
      [
        (assign, "$background_type", 4),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@{reg3?daughter:son}"),
        (str_store_string, s10, "@You were the {reg3?daughter:son} of a man and woman who traveled with a band of mercenary adventurers. On many a night, you listened raptly to your their tales of bravery, adventure and sacrifice. They worked often for the Sheriff and Wardens in the outlying towns of Eastern Barclay, tracking down and capturing the poachers, outlaws and bandits who plagued the forests where you grew up. Both of them taught you how to survive in the wilds, to fight, and how to spot and avoid danger. "),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_nomad",
      [],
      "a_wandering_nomad_clan_leader.",
      [
        (assign, "$background_type", 5),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@{reg3?daughter:son}"),
        (str_store_string, s10, "@Your father was a banished chieftain's son from the far lands of southern desert lands of Pendor. Growing up, you were a nomadic child, living in a wagon on the road. Your family traveled from place to place, camping for no more than half a year before moving on. Your father was born on the D'Shar Plains and your mother was a lady in waiting from Sarleon. They never really answered your many questions about how they knew each other or the circumstances around  their meeting. Your father told you many stories of how his people lived and fought, inspiring you with pride in your ancestry. Years ago, when their father died, his older brother had banished him from his tribe. He gathered up his wife and few possessions and moved to the Northern Plains of Barclay, where you were born. He was joined by other D'shar outcasts and these outcasts formed their own new tribe, living off the land and carrying on the traditions of their homeland across the Eastern Sea. He taught you how to fight, and how to survive through self-reliance."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_thief",
      [],
      "a_rough_and_mysterious_figure.",
      [
        (assign, "$background_type", 6),
        (assign, reg3, "$character_gender"),
        (str_store_string, s10, "@Your father never told you of your mother, and indeed seemed very secretive about his past, as you grew up in the poor section of Barclay's waterfront district. You received very little 'formal' education, however your father did teach you from a young age how to defend yourself, and how to spot and avoid danger. When you were a bit older, he taught you about herbs, poisons, and antidotes, and how to keep someone alive when they were wounded. He never stepped in to offer you protection from the local bullies, but insisted that you fight your own battles. He would often leave for extended periods of time, offering no explanation of where he was going, or saying when he would return. You raised yourself and sometimes had to resort to petty theft just to survive. Still, these difficult years made you streetwise, sharp to the secrets of cities and their shadowy back alley ways."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_priest",
      [],
      "a_respectable_physician.",
      [
        (assign, "$background_type", 7),
        (assign, reg3, "$character_gender"),
        (str_store_string, s10, "@You were an only {reg3?daughter:son} of noteworthy healers who, even though of noble blood, rejected the trappings of court intrigue and instead spent their lives traveling between the cities and towns of Barclay. Helping your parents make potions and healing the sick gave you an appreciation of life and a knowledge of healing. During your early travels with your parents, you became familiar with many cultures and heard many stories of distant lands. The spires of Veccavia, the scandalous bazaars of the Melitine, and the heroic poetry from the mountains of Mettenheim were tales that ignited the imagination. But of most fascination to you was the realm of Pendor. Always these stories kept you entranced, and early on you decided that someday you would travel to that land."),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_game_1"),
      ]
      ),
    ],
  ),

  ("start_character_2", mnf_scale_picture,
    "{s10}^^ In your youth, you had very little idle time, as your father... ",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_character_2"),
    ],
    [
      ("page",
      [],
      "arranged_for_you_to_serve_a_minor_Barclay_noble.",
      [
        (assign, "$background_answer_2", 8),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@As a {reg3?girl:boy} growing out of childhood, you were sent to live in the court of one of the many minor outlying baronies of Barclay. There, your first lessons were in humility, as you waited upon the lords and ladies of the household. From their chess games, their gossip, and their poems of great deeds and courtly love, you quickly began to learn of the conflicts of adult life and competition. You learned even more from the rough games of other children, who fought with sticks in imitation of their elders' sword battles."),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("apprentice",
      [],
      "sent_you_to_become_an_apprentice_to_the_local_guild_as_a_craftsman.",
      [
        (assign, "$background_answer_2", 9),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@As a {reg3?girl:boy} growing out of childhood, you apprenticed with a local craftsman to learn his trade. After you spent years working hard and studying harder under your master, he promoted you to journeyman. Later, he employed you as a fully-paid crafter until you decided it was time to move on."),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("stockboy",
      [],
      "put_you_in_the_care_of_a_successful_merchant.",
      [
        (assign, "$background_answer_2", 12),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@As a {reg3?girl:boy} growing out of childhood, you apprenticed to a wealthy merchant, learning your trade by managing inventories, selling merchandise, and traveling with his caravans. It was a hard life at first, but it grew easier as you learned how to pry out information, the art of buying low and selling high, and how to leave a customer thinking he'd beaten you, and driven the harder bargain himself."),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("urchin",
      [],
      "left_you_to_fend_for_yourself.",
      [
        (assign, "$background_answer_2", 10),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@As a {reg3?girl:boy} barely emerged from childhood, you lived on the streets, doing whatever you had to, just to survive. You begged, stole and worked for gangs to earn your bread, living only from day to day in a violent world, frequently only one step ahead of the law and others who wished you ill."),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("nomad",
      [],
      "sent_you_out_on_your_own_to_hunt_in_the_wilds.",
      [
        (assign, "$background_answer_2", 11),
        (assign, reg3, "$character_gender"),
        (str_store_string, s11, "@As a very young {reg3?girl:boy}, you rode the great steppes on a horse of your own, learning the paths through the grass and the desert. Though you sometimes went hungry, you became a skillful hunter and pathfinder despite - or perhaps because of - the relatively trackless country. Your body grew lean and muscular as you mastered the nomad's way of life."),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),
    ],
  ),

  ("start_character_3", mnf_disable_all_keys|mnf_scale_picture,
    "{s11}^^ Then, after what seemed an eternity, your life changed. You were given the opportunity to become...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_character_3"),
      (assign, reg3, "$character_gender"),
    ],
    [
      ("squire",
      [
        (eq, "$character_gender", 0),
      ],
      "a_squire.",
      [
        (assign, "$background_answer_3", 17),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {reg3?woman:man}, and the whole world seemed to change around you. When you were named squire to a noble at court, you practiced with weapons for long hours, learning how to give hard knocks without hesitation and take them with fortitude. You were instructed in your obligations to your lord, and your duties to those who would one day be your vassals. In addition to learning the chivalric ideal, you also learned about the less attractive side of the noble life -- from old warriors' stories of ruthless power politics, betrayals and usurpations, of men who used guile, as well as valor, to achieve their aims."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("lady",
      [
        (neq, "$character_gender", 0),
      ],
      "a_lady-in-waiting.",
      [
        (assign, "$background_answer_3", 18),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s13, "@{reg3?woman:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {s13}, and the whole world seemed to change around you. You joined the tightly-knit circle of women at court, ladies who lived for the appearance of propriety; the wives and mistresses of noblemen, as well as maidens who had yet to find a husband. Even here, however, you found politics at work, as the ladies schemed for prominence and fought each other bitterly just to catch the eye of whatever unmarried man was currently in fashion at court. You soon learned ways of turning these situations to your own advantage. With that knowledge came the realization that you could yourself wield great influence in the world, if you applied a little subtlety towards achieving your own goals."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("troubadour",
      [],
      "a_bard.",
      [
        (assign, "$background_answer_3", 16),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s13, "@{reg3?woman:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {s13}, and the whole world seemed to change around you. You set out on your own, with nothing but your instrument and your voice. It was a poor existence, and you spent many a hungry night when people failed to appreciate your music, but you managed to get by on your music alone. As the years went by you became adept at playing to the drunken crowds in the taverns, and even better at talking anyone into whatever you wanted."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("student",
      [],
      "a_physician_scholar.",
      [
        (assign, "$background_answer_3", 19),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {reg3?woman:man}, and the whole world seemed to change around you. You found yourself a student at the university of Barclay, in one of the great cities, where you studied the healing arts as well as theology and philosophy. Not all your lessons were learned in the lecture halls. Sometimes, you joined your fellows as they roamed the alleys in search of wine, {reg3?men:women}, or a good fight. You learned first-hand how to set a broken jaw, and how to persuade an angry townsman to set down his club and accept cash as compensation for the destruction of his shop."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("peddler",
      [],
      "a_self_employed_merchant.",
      [
        (assign, "$background_answer_3", 15),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s13, "@{reg3?woman:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {s13}, and the whole world seemed to change around you. Heeding the call of the open road, you traveled from village to village, buying and selling. It was not a rich existence, but you became a master at negotiating a good price from even the most miserly elders. Soon, you knew, you would be well-placed to start your own trading empire..."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("craftsman",
      [],
      "an_engineer_and_builder.",
      [
        (assign, "$background_answer_3", 14),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s13, "@{reg3?woman:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {s13}, and the whole world seemed to change around you. You pursued a career as an apprentice engineer and builder, crafting plans for homes, castles and towns. As time wore on you became a master of your trade, and your work started to bring you high prices. With food on your table and logs on your fire, you could take pride in your work and your growing reputation."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("poacher",
      [],
      "a_huntsman.",
      [
        (assign, "$background_answer_3", 13),
        (str_store_string, s14, "@{reg3?daughter:man}"),
        (str_store_string, s13, "@{reg3?woman:man}"),
        (str_store_string, s12, "@Though the distinction felt sudden to you, somewhere along the way you had become a {s13}, and the whole world seemed to change around you. Dissatisfied with the common man's desperate scrabble for coin, you took to the forests and wilderness and decided to help yourself to its bounty. You hunted stags, boars and geese, and sold the precious meat on the sly. Later, your skills in tracking and pathfinding were often employed to track wanted outlaws for bounty. You made many friends, and many enemies as well. Your enterprise yielded more than a few silvers, of course."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),
    ],
  ),

  ("start_character_4", mnf_disable_all_keys|mnf_scale_picture,
    "{s12}^^But as the fates would have it, everything in your world changed suddenly. You had no choice but to leave the lands of Barclay and strike out for Pendor because...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_character_4"),
    ],
    [
      ("revenge",
      [],
      "you_must_right_a_wrong_done_to_you.",
      [
        (assign, "$background_answer_4", 20),
        (try_begin),
          (eq, "$background_answer_3", 17),
          (assign, "$background_answer_5", 25),
          (str_store_string, s13, "@Happiness was within your reach as your wedding date approached. Your engagement to a lady-in-waiting was everything you hoped it would be. Her planning for the event consumed most of her time and she was excited for a future with you. One fateful day, a group of petulant nobles decided that she would be their next adventure. Upon hearing the commotion, you raced to her aid. Even though you killed two of the rogues, their leader fled like the coward he is, leaving your fiancée violated both physically and  mentally. The shame and horror of what happened to her was too much and she took her own life shortly thereafter, leaving you feeling angry and guilty for being unable to protect her in her time of need. Swearing revenge for this misdeed, you sought out the base scoundrel to exact your vengeance in his blood. Upon hearing of your intentions, he purchased his way out of facing you and fled to Pendor. You sell what you can and and take the next ship to Pendor, determined that he will not escape you..."),
        (else_try),
          (eq, "$background_answer_3", 18),
          (assign, "$background_answer_5", 26),
          (str_store_string, s13, "@Happiness was within your reach as your wedding date approached. Your engagement to a minor lord was everything you hoped it would be. Planning for the event consumed your time, until the fateful day when a group of petulant nobles decided that you would be their next adventure. Your fiancée, hearing the commotion, raced to your aid but was overpowered and killed in the ensuing melee. Grabbing his up his sword, you killed two of the rogues in your anger and despair, but their leader fled like the coward he is. You later learned that he purchased passage to Pendor with the Red Brotherhood to escape the calls for justice in your fiancée's name. Determined not to let this misdeed go unpunished, you pack your belongings and travel to Pendor to exact your revenge..."),
        (else_try),
          (eq, "$background_answer_3", 16),
          (assign, "$background_answer_5", 27),
          (str_store_string, s13, "@For the last several years you lived the life of a wandering bard, charming your way into the hearts of nobles who would be your patron and support your quest for artistic perfection. That was until you met the love of your life, who was not only enamored with your artistry, but also genuinely in love with you. One fateful night, when you were away tending to a minor task, a group of hooded men kidnapped your beloved for ransom. Unfortunately even though the wealthy parents of your beloved paid the ransom, your love was found dead the next morning. Swearing vengeance, you hunted down the scoundrels responsible for this heinous crime and cut most of them down with your crossbow and sword. Unfortunately, you were unable to slay the leader of the band, who escaped. Later, you discovered that he fled to Pendor with the help of the local Red Brotherhood. Swearing that this jackal will not escape justice, you book passage for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 19),
          (assign, "$background_answer_5", 28),
          (str_store_string, s13, "@For the last several years you had studied under a renowned and kindly scholar at the Barclay university, who treated you as if you were his child. Working beside him, you learned a great deal about medicine and the higher arts. Then one day, several cloaked men broke into the university and confronted your mentor - and after a heated argument they stabbed him and set fire to his room. As you raced to your mentors aid, the men escaped into the night. Unfortunately, you were unable to save him from the flames due to his injuries. Salvaging what you could of his research, you set forth to investigate the matter. You soon found that the cloaked men were from Pendor, and that they had returned shortly after their visit to the university. Swearing that you would exact revenge for this misdeed, you book passage for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 15),
          (assign, "$background_answer_5", 29),
          (str_store_string, s13, "@As a merchant you know that there will always be enemies, but even then, some things cross the line. Years of work and negotiations had you on the verge of creating a network of trading caravans that would provide for you and your future family. There was a very profitable opportunity with a particular caravan that would cement your legacy. As the fates would weave, your dreams were thwarted by cold steel and the villainy of a rival merchant - who had hired highwaymen to waylay your caravan and not steal, but destroy, the merchandise and kill everyone guarding it, including you. The highwaymen were successful in destroying your cargo, and as they were in the act of slaying your guards and drivers one by one, they let out the name of who hired them. One thing did not go to their plan however, and that was the unexpected arrival of a Barclay lancer patrol who managed to save you from an early demise. The rival merchant, learning that his plans were only partially successful and with a bounty on his head, fled to Pendor to escape being arrested. You swear that he would not get away from his crimes, and so you sell your remaining possessions and book passage for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 14),
          (assign, "$background_answer_5", 30),
          (str_store_string, s13, "@Happiness was within your reach as your wedding date approached. Alongside wedding preparation, you were working as second engineer in a castle reconstruction project. A fire set by the primary engineer to hide shoddy work claimed not only your reputation, but your life of your betrothed. The scoundrel fled to Pendor with the help of the Red Brotherhood to escape his crimes. You have sworn that the there is no place for him to hide, and so book passage on the next ship to Pendor..."),
        (else_try),
          (assign, "$background_answer_3", 13),
          (assign, "$background_answer_5", 31),
          (str_store_string, s13, "@You and a group of fellow friends and hunters were ambushed by highwaymen looking to rob you. The fight ended badly, with all of your friends dead, although you did manage to kill most of the bandits. The leader escaped to Pendor with the assistance of the local Red Brotherhood, and you swear that you will track him down and avenge your fallen friends. To this end, you book passage on the next ship to Pendor..."),
        (try_end),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("death",
      [],
      "you_received_a_message_that_your_father_has_died.",
      [
        (assign, "$background_answer_4", 21),
        (try_begin),
          (eq, "$background_type", 1),
          (assign, "$background_answer_5", 32),
          (str_store_string, s13, "@His death was swift and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. In it, she warned you that your father's enemies were seeking both her demise and your own. She advised you to flee from Barclay and travel to Pendor - only there would you be beyond the reach of these knaves. She stated that she had to go into hiding, and that she would be safe and not to worry about her. She gifted you your father's shield and told you that when the time came, you should fly these colors and claim your destiny. So, with a heavy heart, you book passage to Pendor..."),
        (else_try),
          (eq, "$background_type", 2),
          (assign, "$background_answer_5", 59),
          (str_store_string, s13, "@His death was swift and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. In it, she warned you that your father's enemies were seeking both her demise and your own. She advised you to flee from Barclay and travel to Pendor - only there would you be beyond the reach of these knaves. She stated that she had to go into hiding, and that she would be safe and not to worry about her. Enclosed with the message was a promissory note for 1,000 gold and a tightly wrapped package containing an old jacket your father used to wear on his business trips. So, with a heavy heart, you book passage to Pendor..."),
        (else_try),
          (eq, "$background_type", 3),
          (assign, "$background_answer_5", 33),
          (str_store_string, s13, "@His death was swift and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. In it, she warned you that your father's enemies were seeking both her demise and your own. She advised you to flee from Barclay and travel to Pendor - only there would you be beyond the reach of these knaves. She stated that she had to go into hiding, and that she would be safe and not to worry about her. She gifted you your father's sword, a family heirloom with which you could defend both your honor and your life.  So, with a heavy heart, you book passage to Pendor..."),
        (else_try),
          (eq, "$background_type", 4),
          (assign, "$background_answer_5", 34),
          (str_store_string, s13, "@His death was swift and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. In it, she warned you that your father's enemies were seeking both her demise and your own. She advised you to flee from Barclay and travel to Pendor - only there would you be beyond the reach of these knaves. She stated that she had to go into hiding, and that she would be safe and not to worry about her. She gifted you your father's armor, a family heirloom with which you could defend both your honor and your life.  So, with a heavy heart, you book passage to Pendor..."),
        (else_try),
          (eq, "$background_type", 5),
          (assign, "$background_answer_5", 35),
          (str_store_string, s13, "@His death was swift and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. In it, she warned you that your father's enemies were seeking both her demise and your own. She advised you to flee from Barclay and travel to Pendor - only there would you be beyond the reach of these knaves. She stated that she had to go into hiding, and that she would be safe and not to worry about her. She gifted you your father's bow, a family heirloom with which you could defend both your honor and your life.  So, with a heavy heart, you book passage to Pendor..."),
        (else_try),
          (eq, "$background_type", 6),
          (assign, "$background_answer_5", 36),
          (str_store_string, s13, "@His death was unexpected and violent, at the hands of an unknown assailant. The message you received afterwards from one of his associates was vague and confusing. The missive warned you of an unseen enemy that had been seeking both your father's demise and your own. Apparently, your father was not your real father, but rather had been keeping you in hiding since you were an infant. He was a hired blade sent to kill your real mother and father, and he succeeded, but he could not bring himself to kill you as an infant. He decided to spare you, and keep you hidden from those who had paid to see you dead. He always felt guilt at his deeds, and tried as best he was able to raise you so that you could survive on your own. Recently, his past employers discovered his subterfuge and your continued existence. He had left instructions with a trusted friend that should anything happen to him, you should be sent this letter, along with his knives, his regrets of past actions, and this warning: Leave Barclay immediately as your life is in danger. Travel to Pendor, there you will find a safe haven. Deciding to heed his words, you book passage to Pendor..."),
        (else_try),
          (assign, "$background_type", 7),
          (assign, "$background_answer_5", 37),
          (str_store_string, s13, "@His death was unexpected and violent, at the hands of an unknown assailant. The message you received afterwards from your mother was vague and confusing. The missive tells you that you were not their child, but was in fact given to them to raise. Your real parents feared for your safety, and so they put you in the care of your adoptive parents - just weeks before assassins finally caught up to them and killed them. Since that time, your adoptive parents feared that some day, those who would see your family dead would catch up to them and slay them all, including you. That day has apparently arrived, with your adoptive father dead and your adoptive mother only alive through sheer luck, and the assassins now turning their sight to you. She reassured you that she is in hiding and safe, but stressed that your life is in danger, and urged you to leave Barclay immediately. She gifted you your father's book of healing, and asked your forgiveness for not telling you earlier that you were adopted. So, to escape these hidden enemies, you booked a passage to Pendor..."),
        (try_end),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("wanderlust",
      [],
      "of_a_series_of_unfortunate_events.",
      [
        (assign, "$background_answer_4", 22),
        (try_begin),
          (eq, "$background_answer_3", 17),
          (assign, "$background_answer_5", 38),
          (str_store_string, s13, "@A series of unexpected deaths of close friends, having to put your favorite horse down and your fiancée breaking off your engagement all combined to make it seem necessary to leave Barclay and start life anew somewhere else. That 'somewhere else' is in the land of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 18),
          (assign, "$background_answer_5", 39),
          (str_store_string, s13, "@A series of unexpected deaths of close friends, not to mention the loss of your fiancée in a duel defending your honor, all combined to make it seem necessary to leave Barclay and start life anew somewhere else. That somewhere else is in the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 16),
          (assign, "$background_answer_5", 40),
          (str_store_string, s13, "@A series of unexpected cancellations and lack of patron support, coupled with a false accusation, tarnished your reputation beyond all repair in Barclay. You find yourself effectively locked out of upscale Taverns and Inns and thus the ability to make a living. The lure of new lands, new adventure and new patrons finds you booking passage to the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 19),
          (assign, "$background_answer_5", 41),
          (str_store_string, s13, "@An unexpected death of a patient leaves your reputation in tatters. Those healers who would take your practice and patients (and the income) spread half truths and outright lies about your methods and training. After months of decline you find the lure of new horizons too great to ignore. Selling some of your equipment, to pay for passage, you find yourself on a ship bound for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 15),
          (assign, "$background_answer_5", 42),
          (str_store_string, s13, "@Unusual rainfall destroyed a warehouse filled with your inventory leaving you almost broke. Rival merchants moved in quickly to capitalize on your market, setting you back years of work. Discouraged and nearly bankrupt, you set your sights to new lands and new opportunities. You find yourself on a ship bound for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 14),
          (assign, "$background_answer_5", 43),
          (str_store_string, s13, "@A glut of experienced builders and architects have taken all of the renovation and construction positions in Barclay. The lack of credit and lack of meaningful work find you looking to a distant land to start life anew. You find yourself booking passage to the lands of Pendor..."),
        (else_try),
          (assign, "$background_answer_3", 13),
          (assign, "$background_answer_5", 44),
          (str_store_string, s13, "@After you captured a dangerous fugitive for the local sheriff, he somehow managed to escape. Before he was recaptured, the vile criminal killed an entire family. You feel that those deaths are on your hands, and many in Barclay blame you for letting the villain escape in the first place. You find that your reputation is in tatters, and after weeks of recrimination and guilt, you decide to start fresh by taking a ship to the lands of Pendor..."),
        (try_end),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("disown",
      [],
      "there_were_too_many_enemies_that_seek_to_end_your_life.",
      [
        (assign, "$background_answer_4", 23),
        (try_begin),
          (eq, "$background_answer_3", 17),
          (assign, "$background_answer_5", 45),
          (str_store_string, s13, "@The life of a squire can be difficult. Your liege was a powerful Duke of Barclay, and as a Duke, he had very powerful enemies. When the Duke's enemies out maneuvered him politically and had him declared a traitor to the Realm, many of his vassals, including you, were forced to flee Barclay or fall victim to the headsman's axe. You set your sights on the land across the sea, where a strong arm and some luck can carve out a future for the bold. You purchase passage on a ship bound for the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 18),
          (assign, "$background_answer_5", 46),
          (str_store_string, s13, "@The life of a lady-in-waiting can be difficult. Your liege was a powerful Duke of Barclay, and as a Duke, he had very powerful enemies. When the Duke's enemies out maneuvered him politically and had him declared a traitor to the Realm, many of his vassals, including you, were forced to flee Barclay or fall victim to the headsman's axe. Disguising yourself as a squire, you acquire some arms and armor and purchase passage on a ship. So it is you set sail for the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 16),
          (assign, "$background_answer_5", 47),
          (str_store_string, s13, "@The life of a bard in the service of the noble can be tenuous. Your patron, a powerful Duke of Barclay, was fond of your company and prose. Unfortunately, as a Duke, he had very powerful enemies. When the Duke's enemies out maneuvered him politically and had him declared a traitor to the Realm, many of his vassals, including you, were forced to flee Barclay or fall victim to the headsman axe. Purchasing passage on the first ship out of Barclay, you find that it is headed for the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 19),
          (assign, "$background_answer_5", 48),
          (str_store_string, s13, "@The life of a healer can be difficult. When a powerful but gravely ill patient passes away unexpectedly, his sons declared 'Kan Devasi' on you, believing that you were responsible for his death. Knowing that they will not stop until you are dead, you elect to leave Barclay and start life again in the lands of Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 15),
          (assign, "$background_answer_5", 49),
          (str_store_string, s13, "@The life of a merchant can be trying. When a powerful leader of the local Red Brotherhood decided that you are in the way of his success, he broke brotherhood rules and began a campaign to drive you out of business. After a significant loss of coin and the deaths of most of your guards, you deem it wise to leave Barclay on the next ship, which happens to be bound for Pendor..."),
        (else_try),
          (eq, "$background_answer_3", 14),
          (assign, "$background_answer_5", 50),
          (str_store_string, s13, "@The life of an engineer can be trying. When a powerful leader of the local Red Brotherhood decided that you are in the way of his plans and put a bounty on your head, life swiftly became unpleasant. Luckily, some fast talking at the right time allowed you to slip past his thugs. You deem it wise to leave Barclay while you can, and so you book passage on the next ship, which happens to be bound for Pendor..."),
        (else_try),
          (assign, "$background_answer_3", 13),
          (assign, "$background_answer_5", 51),
          (str_store_string, s13, "@After capturing a dangerous fugitive for the local sheriff, you were forced to kill him as he tried to escape. Unfortunately, the criminal's brothers, all of them associated with the Red Brotherhood, did not take this well and combined their efforts towards avenging their sibling. You know it is only a matter of time before you will be killed by one of them, so you decide that it wise to leave Barclay on the next ship, which happens to be bound for Pendor..."),
        (try_end),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("greed",
      [],
      "of_a_letter_that_changed_your_life_forever.",
      [
        (assign, "$background_answer_4", 24),
        (str_store_string, s14, "@{reg3?daughter:son}"),
        (str_store_string, s16, "@{reg3?woman:man}"),
        (try_begin),
          (eq, "$background_type", 1),
          (assign, "$background_answer_5", 52),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother is of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. We fled Pendor all those years ago not because our house and fortunes were lost or displaced, but because we feared discovery by dark and evil powers who would end the true line of Pendor. Be warned, my {s14}, there are those who are actively seeking your death, and with your demise the line of heirs to the silver throne of Pendor will be broken forever. Forgive us for not telling you this sooner. Those that suspect that you and your mother live are here, in Barclay, and are seeking your location with fell intent. Your mother and I have gone into hiding, but there are assassins - and worse - that are even now searching for you. Take Heed! My advice is to leave Barclay as soon as possible and sail to Pendor. There you will find dangers, but you may also find answers, and with any luck you, or your sons or daughters, may be able to reclaim that which was lost. In any case, be well, my {s14}, and be safe in your travels. Sincerely - Your Father' And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (eq, "$background_type", 2),
          (assign, "$background_answer_5", 58),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother is of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. We fled Pendor all those years ago not because our house and fortunes were lost or displaced, but because we feared discovery by dark and evil powers who would end the true line of Pendor. Be warned, my {s14}, there are those who are actively seeking your death, and with your demise the line of heirs to the silver throne of Pendor will be broken forever. Forgive us for not telling you this sooner. Those that suspect that you and your mother live are here, in Barclay, and are seeking your location with fell intent. Your mother and I have gone into hiding, but there are assassins - and worse - that are even now searching for you. Take Heed! My advice is to leave Barclay as soon as possible and sail to Pendor. There you will find dangers, but you may also find answers, and with any luck you, or your sons or daughters, may be able to reclaim that which was lost. In any case, be well, my {s14}, and be safe in your travels. Sincerely - Your Father' And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (eq, "$background_type", 3),
          (assign, "$background_answer_5", 53),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother is of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. We fled Pendor all those years ago because your mother feared discovery by dark and evil powers who would end the true line of Pendor. Be warned, my {s14}, there are those who are actively seeking your death, and with your demise the line of heirs to the silver throne of Pendor will be broken forever. Forgive us for not telling you this sooner. Those that suspect that you and your mother live are here, in Barclay, and are seeking your location with fell intent. Your mother and I have gone into hiding, but there are assassins - and worse - that are even now searching for you. Take Heed! My advice is to leave Barclay as soon as possible and sail to Pendor. There you will find dangers, but you may also find answers, and with any luck you, or your sons or daughters, may be able to reclaim that which was lost. In any case, be well, my {s14}, and be safe in your travels. Sincerely - Your Father' And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (eq, "$background_type", 4),
          (assign, "$background_answer_5", 54),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother is of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. We fled Pendor all those years ago not because our house and fortunes were lost or displaced, but because we feared discovery by dark and evil powers who would end the true line of Pendor. Be warned, my {s14}, there are those who are actively seeking your death, and with your demise the line of heirs to the silver throne of Pendor will be broken forever. Forgive us for not telling you this sooner. Those that suspect that you and your mother live are here, in Barclay, and are seeking your location with fell intent. Your mother and I have gone into hiding, but there are assassins - and worse - that are even now searching for you. Take Heed! My advice is to leave Barclay as soon as possible and sail to Pendor. There you will find dangers, but you may also find answers, and with any luck you, or your sons or daughters, may be able to reclaim that which was lost. In any case, be well, my {s14}, and be safe in your travels. Sincerely - Your Father' And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (eq, "$background_type", 5),
          (assign, "$background_answer_5", 55),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother is of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. I first met your mother as she was fleeing dark and evil forces who sought to end the true line of Pendor, and we fled Pendor all those years ago because we feared discovery. Be warned, my {s14}, there are those who are actively seeking your death, and with your demise the line of heirs to the silver throne of Pendor will be broken forever. Forgive us for not telling you this sooner. Those that suspect that you and your mother live are here, in Barclay, and are seeking your location with fell intent. Your mother and I have gone into hiding, but there are assassins - and worse - that are even now searching for you. Take Heed! My advice is to leave Barclay as soon as possible and sail to Pendor. There you will find dangers, but you may also find answers, and with any luck you, or your sons or daughters, may be able to reclaim that which was lost. In any case, be well, my {s14}, and be safe in your travels. Sincerely - Your Father' And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (eq, "$background_type", 6),
          (assign, "$background_answer_5", 56),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother was of ancient noble lineage, and in your veins flows the blood of the old Kings of Pendor. I was hired to find and kill her for precisely that reason. When I found her after years of searching, she was near death and you were swaddled in her arms. I did not have it in me to end her life, much less yours. My healing arts were not sufficient to save her, so I made it look as if I had killed her, collected the reward and then disappeared to raise you. I do not ask your forgiveness, only your understanding that sometimes a man is forced down a path not of his choosing. I know first-hand that there are those who are seeking you to end your life, as I have now come across those who seek to kill me for my failure to take your life as an infant. I have dealt with one initial group looking for us here in Barclay, and have wounds to heal for my trouble. I know there are many more out there, and that they will not stop until both of us are dead. I have gone into hiding; my part in your life is done, so do not try to find me. Take heed! My advice is to leave Barclay as soon as possible and sail to Pendor. In any case, be well and be safe in your travels. Regards-'  And so, heart heavy and head spinning, you set sail for Pendor..."),
        (else_try),
          (assign, "$background_type", 7),
          (assign, "$background_answer_5", 57),
          (str_store_string, s13, "@The letter reads - 'My {s14}, I am proud of the {s16} you have become. It is with a heavy heart that I must tell you that your path in life was dictated to you the moment you were born. You see, my {s14}, your mother and I are not your real parents. You came to us when you were a newborn, from a noblewoman fleeing for her life from Pendor. She was fearful that her time was limited, and did not want you to share her fate. She told us she was of ancient noble lineage, the great-grandchild of the only true surviving member of the royal Pendorian line of Kings. After she gave you to us we found her along the road the next day near death, having been stabbed multiple times. Our healing arts were not sufficient to save her, so we buried her at the local church and took you in as if you were our child. We are sorry we did not tell you this before, and ask your understanding that what we have done was for your own protection. We tell you this now as we fear that those who took your mother's life have returned. We have been followed, and have heard of hooded men asking questions about our travels and our routes. More concerning are the questions they ask about you and your age. We fear that they mean you harm or worse. We have gone into hiding and feel that we will be safe. However, you should not stay in Barclay. Flee! Flee to the lands of Pendor and seek answers. In any case, be well and be safe in your travels. With love always - you will always be our {s14} - Your Father'  And so, heart heavy and head spinning, you set sail for Pendor..."),
        (try_end),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),
    ],
  ),

  ("choose_skill", mnf_disable_all_keys|mnf_scale_picture,
    "{s13}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_begin_adventuring"),
      (assign, "$current_string_reg", 10),
      (assign, ":var0", 0),
      (try_begin),
        (neq, "$character_gender", 0),
        (str_store_string, s14, "str_woman"),
      (else_try),
        (str_store_string, s14, "str_man"),
      (try_end),
      (try_begin),
        (eq, "$background_type", 1),
        (str_store_string, s15, "str_noble"),
        (val_sub, ":var0", 1),
      (else_try),
        (str_store_string, s15, "str_common"),
      (try_end),
    ],
    [
      ("begin_adventuring",
      [],
      "You_board_the_ship_and_settle_in...",
      [
        (set_show_messages, 0),
        (play_sound, "snd_nar_the_die_has_been_cast_sail_pendor"),
        (try_begin),
          (eq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
        (else_try),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
        (try_end),
        (troop_raise_attribute, "trp_player", ca_strength, 2),
        (troop_raise_attribute, "trp_player", ca_agility, 1),
        (troop_raise_attribute, "trp_player", ca_charisma, 1),
        (troop_raise_skill, "trp_player", skl_leadership, 1),
        (troop_raise_skill, "trp_player", skl_riding, 1),
        (troop_raise_proficiency, "trp_player", wpt_firearm, 25),
        (try_begin),
          (eq, "$background_type", 1),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_5", -10),
          (eq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 2),
          (troop_raise_skill, "trp_player", skl_shield, 2),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_tactics, 2),
          (troop_raise_skill, "trp_player", skl_leadership, 3),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 40),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 40),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 40),
          (troop_add_item, "trp_player", "itm_tab_shield_round_a", imod_sturdy),
          (troop_add_item, "trp_player", "itm_crosshilt_sword", imod_fine),
          (troop_add_item, "trp_player", "itm_noble_clothing2", imod_plain),
          (troop_set_slot, "trp_player", 7, 100),
          (call_script, "script_change_player_honor", 1),
          (troop_add_gold, "trp_player", 300),
        (else_try),
          (eq, "$background_type", 1),
          (neq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 3),
          (troop_raise_skill, "trp_player", skl_wound_treatment, 1),
          (troop_raise_skill, "trp_player", skl_power_draw, 1),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_skill, "trp_player", skl_first_aid, 2),
          (troop_raise_skill, "trp_player", skl_leadership, 2),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_persuasion, 2),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 40),
          (troop_set_slot, "trp_player", 7, 60),
          (troop_add_item, "trp_player", "itm_tab_shield_round_a", imod_sturdy),
          (troop_add_item, "trp_player", "itm_crosshilt_sword", imod_balanced),
          (troop_add_item, "trp_player", "itm_dress", imod_sturdy),
          (troop_add_item, "trp_player", "itm_leather_lady1", imod_plain),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
          (troop_add_item, "trp_player", "itm_courser", imod_spirited),
          (troop_add_gold, "trp_player", 300),
        (else_try),
          (eq, "$background_type", 2),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", 5),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 4),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_trade, 3),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_raise_skill, "trp_player", skl_pathfinding, 2),
          (troop_raise_skill, "trp_player", skl_inventory_management, 3),
          (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 20),
          (troop_add_item, "trp_player", "itm_tabard", imod_plain),
          (troop_add_item, "trp_player", "itm_pottery", imod_plain),
          (troop_add_item, "trp_player", "itm_pottery", imod_plain),
          (troop_add_gold, "trp_player", 3000),
          (troop_set_slot, "trp_player", 7, 20),
        (else_try),
          (eq, "$background_type", 3),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -10),
          (store_random_in_range, ":var0", "fac_dragon_knights", "fac_player_knights"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -5),
          (store_random_in_range, ":var0", "fac_dragon_knights", "fac_player_knights"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -5),
          (troop_raise_attribute, "trp_player", ca_strength, 3),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_skill, "trp_player", skl_ironflesh, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 2),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_trainer, 3),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_shield, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 60),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 65),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 60),
          (troop_add_item, "trp_player", "itm_tab_shield_kite_b"),
          (troop_add_item, "trp_player", "itm_lance", imod_battered),
          (troop_add_gold, "trp_player", 350),
          (troop_add_item, "trp_player", "itm_surcoat_over_mail_09", imod_plain),
          (troop_add_item, "trp_player", "itm_tabard_worn_red", imod_plain),
          (troop_add_item, "trp_player", "itm_sword_medieval_c", imod_plain),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_gloves", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
          (troop_set_slot, "trp_player", 7, 10),
        (else_try),
          (eq, "$background_type", 4),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_skill, "trp_player", skl_power_draw, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 2),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_looting, 2),
          (troop_raise_skill, "trp_player", skl_tracking, 1),
          (troop_raise_skill, "trp_player", skl_pathfinding, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 40),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_archery, 40),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 30),
          (troop_add_item, "trp_player", "itm_surcoat_over_mail_04", imod_plain),
          (troop_add_item, "trp_player", "itm_arrows", imod_plain),
          (troop_add_item, "trp_player", "itm_singalian_arrows", imod_plain),
          (troop_add_item, "trp_player", "itm_war_spear", imod_plain),
          (troop_add_item, "trp_player", "itm_light_leather", imod_plain),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_dried_meat", imod_plain),
          (troop_add_item, "trp_player", "itm_light_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_furs", imod_plain),
          (troop_add_gold, "trp_player", 300),
        (else_try),
          (eq, "$background_type", 5),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_3", -10),
          (call_script, "script_change_player_relation_with_faction", "fac_inquisition", -10),
          (eq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_strength, 3),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 2),
          (troop_raise_skill, "trp_player", skl_power_draw, 2),
          (troop_raise_skill, "trp_player", skl_horse_archery, 2),
          (troop_raise_skill, "trp_player", skl_pathfinding, 2),
          (troop_raise_skill, "trp_player", skl_first_aid, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 20),
          (troop_raise_proficiency, "trp_player", wpt_archery, 50),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 10),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 10),
          (troop_add_item, "trp_player", "itm_tab_shield_small_round_a", imod_battered),
          (troop_add_item, "trp_player", "itm_dshar_mail_shirt1", imod_plain),
          (troop_add_item, "trp_player", "itm_dshar_robe_c", imod_plain),
          (troop_add_gold, "trp_player", 150),
          (troop_set_slot, "trp_player", 7, 10),
        (else_try),
          (eq, "$background_type", 5),
          (neq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_horse_archery, 1),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_raise_skill, "trp_player", skl_pathfinding, 3),
          (troop_raise_skill, "trp_player", skl_tracking, 1),
          (troop_raise_skill, "trp_player", skl_wound_treatment, 1),
          (troop_raise_skill, "trp_player", skl_first_aid, 1),
          (troop_raise_skill, "trp_player", skl_riding, 3),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 5),
          (troop_raise_proficiency, "trp_player", wpt_archery, 30),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 15),
          (troop_add_item, "trp_player", "itm_tab_shield_small_round_a", imod_battered),
          (troop_add_item, "trp_player", "itm_dshar_courser", imod_plain),
          (troop_add_item, "trp_player", "itm_dshar_robe_b", imod_plain),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_steppe_horse", imod_plain),
          (troop_add_gold, "trp_player", 120),
        (else_try),
          (eq, "$background_type", 6),
          (troop_raise_attribute, "trp_player", ca_agility, 4),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_skill, "trp_player", skl_power_throw, 3),
          (troop_raise_skill, "trp_player", skl_athletics, 2),
          (troop_raise_skill, "trp_player", skl_first_aid, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 2),
          (troop_raise_skill, "trp_player", skl_inventory_management, 1),
          (troop_raise_skill, "trp_player", skl_prisoner_management, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 2),
          (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (troop_raise_skill, "trp_player", skl_trade, 2),
          (troop_raise_skill, "trp_player", skl_looting, 3),
          (troop_raise_skill, "trp_player", skl_tracking, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 50),
          (troop_add_item, "trp_player", itm_throwing_knives, imod_plain),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 50),
          (troop_add_item, "trp_player", "itm_robe", imod_plain),
          (troop_add_item, "trp_player", "itm_black_hood", imod_tattered),
          (troop_add_gold, "trp_player", 25),
        (else_try),
          (eq, "$background_type", 7),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 3),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_pathfinding, 2),
          (troop_raise_skill, "trp_player", skl_first_aid, 3),
          (troop_raise_skill, "trp_player", skl_wound_treatment, 3),
          (troop_raise_skill, "trp_player", skl_surgery, 3),
          (troop_raise_skill, "trp_player", skl_inventory_management, 1),
          (troop_raise_skill, "trp_player", skl_leadership, 1),
          (troop_raise_skill, "trp_player", skl_prisoner_management, 1),
          (troop_raise_skill, "trp_player", skl_trade, 2),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 20),
          (troop_add_gold, "trp_player", 1000),
          (call_script, "script_change_troop_renown", "trp_player", 30),
          (troop_add_item, "trp_player", "itm_robe", imod_plain),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
          (troop_add_item, "trp_player", "itm_wrapping_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
          (troop_add_item, "trp_player", "itm_sumpter_horse", imod_plain),
          (troop_add_gold, "trp_player", 10),
          (troop_add_item, "trp_player", "itm_book_wound_treatment_reference", imod_plain),
        (try_end),
        (try_begin),
          (eq, "$background_answer_2", 8),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_trainer, 1),
          (troop_raise_skill, "trp_player", skl_persuasion, 2),
          (troop_raise_skill, "trp_player", skl_leadership, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 25),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 5),
          (call_script, "script_change_troop_renown", "trp_player", 15),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_heavy),
          (troop_add_item, "trp_player", "itm_sword_viking_2", imod_plain),
        (else_try),
          (eq, "$background_answer_2", 9),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_skill, "trp_player", skl_inventory_management, 2),
          (troop_add_gold, "trp_player", 600),
          (troop_raise_skill, "trp_player", skl_engineer, 2),
          (troop_raise_skill, "trp_player", skl_trade, 1),
          (troop_add_item, "trp_player", "itm_light_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_steel_bolts", imod_plain),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 30),
        (else_try),
          (eq, "$background_answer_2", 10),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 1),
          (troop_raise_skill, "trp_player", skl_looting, 2),
          (troop_raise_skill, "trp_player", skl_ironflesh, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 25),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 25),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 15),
          (troop_add_item, "trp_player", "itm_leather_gloves", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_armor", imod_plain),
        (else_try),
          (eq, "$background_answer_2", 11),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_skill, "trp_player", skl_spotting, 1),
          (troop_add_item, "trp_player", "itm_furs", imod_plain),
          (troop_raise_skill, "trp_player", skl_horse_archery, 2),
          (troop_raise_skill, "trp_player", skl_pathfinding, 1),
          (troop_raise_skill, "trp_player", skl_tracking, 1),
          (troop_raise_proficiency, "trp_player", wpt_archery, 35),
          (call_script, "script_change_troop_renown", "trp_player", 5),
          (troop_add_gold, "trp_player", 100),
          (troop_add_item, "trp_player", "itm_rawhide_coat", imod_plain),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_nomad_bow", imod_plain),
          (troop_add_item, "trp_player", "itm_barbed_arrows", imod_plain),
          (troop_add_item, "trp_player", "itm_dark_steppe", imod_heavy),
        (else_try),
          (eq, "$background_answer_2", 12),
          (troop_raise_attribute, "trp_player", ca_intelligence, 3),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_add_gold, "trp_player", 1500),
          (troop_raise_skill, "trp_player", skl_inventory_management, 2),
          (troop_raise_skill, "trp_player", skl_trade, 1),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_add_item, "trp_player", "itm_light_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
        (try_end),
        (try_begin),
          (eq, "$background_answer_3", 13),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_skill, "trp_player", skl_power_draw, 2),
          (troop_raise_skill, "trp_player", skl_tracking, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 2),
          (troop_raise_skill, "trp_player", skl_athletics, 2),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_add_gold, "trp_player", 100),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 20),
          (troop_raise_proficiency, "trp_player", wpt_archery, 35),
          (troop_add_gold, "trp_player", 100),
          (troop_add_item, "trp_player", "itm_scimitar", imod_chipped),
          (troop_add_item, "trp_player", "itm_rawhide_coat", imod_plain),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_strong_bow", imod_plain),
          (troop_add_item, "trp_player", "itm_barbed_arrows", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_heavy),
          (troop_add_item, "trp_player", "itm_dried_meat", imod_plain),
          (troop_add_item, "trp_player", "itm_dried_meat", imod_plain),
          (troop_add_item, "trp_player", "itm_furs", imod_plain),
          (troop_add_item, "trp_player", "itm_furs", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 14),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_inventory_management, 2),
          (troop_raise_skill, "trp_player", skl_engineer, 3),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 2),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 15),
          (troop_add_gold, "trp_player", 700),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_coarse_tunic", imod_plain),
          (troop_add_item, "trp_player", "itm_sword_medieval_b", imod_plain),
          (troop_add_item, "trp_player", "itm_light_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_tools", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 15),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_raise_skill, "trp_player", skl_trade, 2),
          (troop_raise_skill, "trp_player", skl_pathfinding, 1),
          (troop_raise_skill, "trp_player", skl_inventory_management, 2),
          (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (troop_add_item, "trp_player", "itm_leather_gloves", imod_plain),
          (troop_add_gold, "trp_player", 1200),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 15),
          (troop_add_item, "trp_player", "itm_leather_jacket", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_fur_hat", imod_plain),
          (troop_add_item, "trp_player", "itm_winged_mace", imod_plain),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_plain),
          (troop_add_item, "trp_player", "itm_sumpter_horse", imod_plain),
          (troop_add_item, "trp_player", "itm_linen", imod_plain),
          (troop_add_item, "trp_player", "itm_pottery", imod_plain),
          (troop_add_item, "trp_player", "itm_wool", imod_plain),
          (troop_add_item, "trp_player", "itm_iron", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 16),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_persuasion, 2),
          (troop_raise_skill, "trp_player", skl_leadership, 2),
          (troop_raise_skill, "trp_player", skl_pathfinding, 2),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_add_item, "trp_player", "itm_lute", imod_plain),
          (troop_add_gold, "trp_player", 200),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 25),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 30),
          (troop_add_item, "trp_player", "itm_tabard", imod_sturdy),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_sword_viking_1", imod_plain),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_plain),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 17),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_skill, "trp_player", skl_trainer, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 2),
          (troop_raise_skill, "trp_player", skl_leadership, 1),
          (troop_raise_skill, "trp_player", skl_shield, 2),
          (troop_add_gold, "trp_player", 100),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 30),
          (troop_raise_proficiency, "trp_player", wpt_archery, 10),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 30),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 10),
          (troop_add_item, "trp_player", "itm_surcoat_over_mail_28", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_sword_medieval_a", imod_plain),
          (troop_add_item, "trp_player", "itm_light_lance", imod_plain),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_plain),
          (troop_add_item, "trp_player", "itm_chicken", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 18),
          (neq, "$character_gender", 0),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_skill, "trp_player", skl_persuasion, 2),
          (troop_raise_skill, "trp_player", skl_riding, 2),
          (troop_raise_skill, "trp_player", skl_wound_treatment, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_skill, "trp_player", skl_leadership, 2),
          (troop_add_item, "trp_player", "itm_dagger", imod_plain),
          (troop_add_item, "trp_player", "itm_light_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_courser", imod_spirited),
          (troop_add_item, "trp_player", "itm_woolen_dress", imod_sturdy),
          (troop_add_gold, "trp_player", 100),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 35),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_lady1", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 19),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_skill, "trp_player", skl_surgery, 2),
          (troop_raise_skill, "trp_player", skl_wound_treatment, 2),
          (troop_raise_skill, "trp_player", skl_first_aid, 2),
          (troop_add_gold, "trp_player", 700),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 20),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 20),
          (troop_add_item, "trp_player", "itm_linen_tunic", imod_sturdy),
          (troop_add_item, "trp_player", "itm_woolen_hose", imod_plain),
          (troop_add_item, "trp_player", "itm_sword_medieval_a", imod_rusty),
          (troop_add_item, "trp_player", "itm_hunting_crossbow", imod_plain),
          (troop_add_item, "trp_player", "itm_bolts", imod_plain),
          (troop_add_item, "trp_player", "itm_saddle_horse", imod_swaybacked),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
          (store_random_in_range, ":var1", "itm_book_tactics", "itm_spice"),
          (troop_add_item, "trp_player", ":var1", imod_plain),
        (try_end),
        (try_begin),
          (eq, "$background_answer_4", 20),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_pathfinding, 1),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (try_begin),
            (this_or_next|eq, "$background_answer_5", 25),
            (eq, "$background_answer_5", 26),
            (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 20),
            (troop_add_gold, "trp_player", 100),
          (else_try),
            (eq, "$background_answer_5", 27),
            (troop_raise_skill, "trp_player", skl_tactics, 1),
            (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
            (troop_raise_proficiency, "trp_player", wpt_crossbow, 20),
          (else_try),
            (eq, "$background_answer_5", 28),
            (troop_raise_skill, "trp_player", skl_spotting, 1),
          (else_try),
            (eq, "$background_answer_5", 29),
            (troop_raise_skill, "trp_player", skl_ironflesh, 1),
            (troop_add_gold, "trp_player", 200),
          (else_try),
            (eq, "$background_answer_5", 30),
            (troop_add_gold, "trp_player", 100),
          (else_try),
            (eq, "$background_answer_5", 31),
            (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
            (troop_raise_proficiency, "trp_player", wpt_archery, 20),
          (try_end),
        (else_try),
          (eq, "$background_answer_4", 21),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_skill, "trp_player", skl_ironflesh, 1),
          (troop_raise_skill, "trp_player", skl_spotting, 2),
          (troop_raise_skill, "trp_player", skl_first_aid, 2),
          (try_begin),
            (eq, "$background_answer_5", 32),
            (troop_add_item, "trp_player", "itm_tab_shield_heater_d", imod_plain),
            (troop_add_item, "trp_player", "itm_coat_plates_yellow", 128),
          (else_try),
            (eq, "$background_answer_5", 59),
            (troop_add_gold, "trp_player", 1000),
            (troop_add_item, "trp_player", "itm_light_leather", 128),
          (else_try),
            (eq, "$background_answer_5", 33),
            (troop_add_item, "trp_player", "itm_bastard_sword_b", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 34),
            (troop_add_item, "trp_player", "itm_barclay_plate", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 35),
            (troop_add_item, "trp_player", "itm_khergit_bow", imod_plain),
            (troop_add_item, "trp_player", "itm_barbed_arrows", imod_plain),
            (troop_add_item, "trp_player", "itm_scimitar_b", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 36),
            (troop_add_gold, "trp_player", 100),
            (troop_add_item, "trp_player", "itm_assassin_knives", 8192),
          (else_try),
            (eq, "$background_answer_5", 37),
            (troop_add_item, "trp_player", "itm_book_surgery_reference", imod_plain),
          (try_end),
        (else_try),
          (eq, "$background_answer_4", 22),
          (troop_raise_attribute, "trp_player", ca_agility, 3),
          (troop_raise_skill, "trp_player", skl_pathfinding, 2),
          (troop_raise_skill, "trp_player", skl_spotting, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (try_begin),
            (this_or_next|eq, "$background_answer_5", 38),
            (eq, "$background_answer_5", 39),
            (troop_add_gold, "trp_player", 100),
            (troop_raise_skill, "trp_player", skl_tactics, 2),
          (else_try),
            (eq, "$background_answer_5", 40),
            (troop_raise_skill, "trp_player", skl_looting, 1),
            (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (else_try),
            (eq, "$background_answer_5", 41),
            (troop_add_gold, "trp_player", 100),
            (troop_raise_skill, "trp_player", skl_tactics, 2),
          (else_try),
            (eq, "$background_answer_5", 42),
            (troop_raise_skill, "trp_player", skl_trade, 1),
            (troop_raise_skill, "trp_player", skl_prisoner_management, 1),
          (else_try),
            (eq, "$background_answer_5", 43),
            (troop_add_gold, "trp_player", 100),
            (troop_raise_skill, "trp_player", skl_engineer, 2),
          (else_try),
            (eq, "$background_answer_5", 44),
            (troop_raise_skill, "trp_player", skl_pathfinding, 1),
            (troop_raise_skill, "trp_player", skl_riding, 1),
          (try_end),
        (else_try),
          (eq, "$background_answer_4", 23),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_skill, "trp_player", skl_looting, 1),
          (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (troop_raise_skill, "trp_player", skl_trade, 1),
          (try_begin),
            (eq, "$background_answer_5", 45),
            (troop_add_item, "trp_player", "itm_ale", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 46),
            (troop_add_item, "trp_player", "itm_wine", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 47),
            (troop_add_item, "trp_player", "itm_leather_gloves", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 48),
            (troop_raise_skill, "trp_player", skl_surgery, 1),
          (else_try),
            (eq, "$background_answer_5", 49),
            (troop_raise_skill, "trp_player", skl_tactics, 1),
          (else_try),
            (eq, "$background_answer_5", 50),
            (troop_add_gold, "trp_player", 100),
            (troop_raise_skill, "trp_player", skl_persuasion, 1),
          (else_try),
            (eq, "$background_answer_5", 51),
            (troop_raise_skill, "trp_player", skl_prisoner_management, 1),
          (try_end),
        (else_try),
          (eq, "$background_answer_4", 24),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_skill, "trp_player", skl_pathfinding, 1),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -10),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_2", -10),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_5", -10),
          (call_script, "script_change_player_relation_with_faction", "fac_snake_cult", -20),
          (call_script, "script_change_player_relation_with_troop", "trp_kingdom_1_lord", -10),
          (try_begin),
            (eq, "$background_answer_5", 52),
            (call_script, "script_change_player_honor", 2),
            (call_script, "script_change_player_relation_with_faction", "fac_griffon_knights", 15),
            (call_script, "script_change_player_relation_with_faction", "fac_lion_knights", -5),
          (else_try),
            (eq, "$background_answer_5", 58),
            (call_script, "script_change_player_honor", 2),
            (troop_add_gold, "trp_player", 800),
            (call_script, "script_change_troop_renown", "trp_player", 10),
            (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", 5),
          (else_try),
            (eq, "$background_answer_5", 53),
            (troop_add_item, "trp_player", "itm_bastard_sword_b", imod_exquisite),
            (call_script, "script_change_player_honor", 10),
            (call_script, "script_change_player_relation_with_faction", "fac_robber_knights", 10),
            (call_script, "script_change_troop_renown", "trp_player", 30),
            (call_script, "script_change_player_honor", 3),
          (else_try),
            (eq, "$background_answer_5", 54),
            (troop_add_item, "trp_player", "itm_barclay_plate", 256),
            (call_script, "script_change_player_relation_with_faction", "fac_adventurers", 10),
            (call_script, "script_change_player_honor", 3),
            (call_script, "script_change_troop_renown", "trp_player", 10),
          (else_try),
            (eq, "$background_answer_5", 55),
            (call_script, "script_change_player_relation_with_faction", "fac_singalians", -10),
            (call_script, "script_change_player_relation_with_faction", "fac_dshar_raiders", 10),
            (call_script, "script_change_player_honor", 3),
            (call_script, "script_change_troop_renown", "trp_player", 10),
            (call_script, "script_change_player_relation_with_troop", "trp_kingdom_3_lord", -5),
            (troop_add_item, "trp_player", "itm_dshar_scimitar", imod_exquisite),
          (else_try),
            (eq, "$background_answer_5", 56),
            (troop_add_gold, "trp_player", 500),
            (troop_add_item, "trp_player", "itm_spiked_mace", imod_plain),
          (else_try),
            (eq, "$background_answer_5", 57),
            (troop_add_gold, "trp_player", 500),
            (call_script, "script_change_troop_renown", "trp_player", 10),
            (call_script, "script_change_player_honor", 3),
          (try_end),
        (try_end),
        (troop_raise_skill, "trp_player", skl_prisoner_management, 2),
        (try_begin),
          (eq, "$background_answer_3", 16),
          (assign, "$g_rumor_interval", 4),
        (else_try),
          (eq, "$background_answer_3", 15),
          (assign, "$g_rumor_interval", 5),
        (else_try),
          (eq, "$background_answer_3", 13),
          (assign, "$g_rumor_interval", 6),
        (else_try),
          (eq, "$background_answer_2", 10),
          (assign, "$g_rumor_interval", 4),
        (else_try),
          (assign, "$g_rumor_interval", 7),
        (try_end),
        (call_script, "script_update_troop_notes", "trp_player"),
        (troop_sort_inventory, "trp_player"),
        (try_begin),
          (this_or_next|eq, "$background_type", 2),
          (this_or_next|eq, "$background_type", 4),
          (this_or_next|eq, "$background_type", 5),
          (eq, "$background_type", 6),
          (change_screen_return, 0),
        (else_try),
          (jump_to_menu, "mnu_auto_return"),
          (start_presentation, "prsnt_banner_selection"),
        (else_try),
          (change_screen_return, 0),
        (try_end),
        (set_show_messages, 1),
        (play_track, "track_althea_intro_c_audionmusic", 1),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),
    ],
  ),

  ("past_life_explanation", mnf_disable_all_keys|mnf_scale_picture,
    "{s3}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_past_life_explanation"),
      (try_begin),
        (gt, "$current_string_reg", 14),
        (assign, "$current_string_reg", 10),
      (try_end),
      (str_store_string_reg, s3, "$current_string_reg"),
      (try_begin),
        (ge, "$current_string_reg", 14),
        (str_store_string, s5, "@Back to the beginning..."),
      (else_try),
        (str_store_string, s5, "@View next segment..."),
      (try_end),
    ],
    [
      ("view_next",
      [],
      "{s5}",
      [
        (val_add, "$current_string_reg", 1),
        (jump_to_menu, "mnu_past_life_explanation"),
      ]
      ),

      ("continue",
      [],
      "Continue...",
      []
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),
    ],
  ),

  ("auto_return", 0,
    "{!}This menu automatically returns to caller.",
    "none",
    [
      (change_screen_return, 0),
    ],
    [
    ],
    [],
  ),

  ("morale_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_morale"),
      (call_script, "script_get_player_party_morale_values"),
      (assign, ":var0", reg0),
      (assign, reg1, "$g_player_party_morale_modifier_party_size"),
      (try_begin),
        (gt, reg1, 0),
        (str_store_string, s2, "@{!} -"),
      (else_try),
        (str_store_string, s2, "str_space"),
      (try_end),
      (assign, reg2, "$g_player_party_morale_modifier_leadership"),
      (try_begin),
        (gt, reg2, 0),
        (str_store_string, s3, "@{!} +"),
      (else_try),
        (str_store_string, s3, "str_space"),
      (try_end),
      (try_begin),
        (gt, "$g_player_party_morale_modifier_no_food", 0),
        (assign, reg7, "$g_player_party_morale_modifier_no_food"),
        (str_store_string, s5, "@^No food:  -{reg7}"),
      (else_try),
        (str_store_string, s5, "str_space"),
      (try_end),
      (assign, reg3, "$g_player_party_morale_modifier_food"),
      (try_begin),
        (gt, reg3, 0),
        (str_store_string, s4, "@{!} +"),
      (else_try),
        (str_store_string, s4, "str_space"),
      (try_end),
      (try_begin),
        (gt, "$g_player_party_morale_modifier_debt", 0),
        (assign, reg6, "$g_player_party_morale_modifier_debt"),
        (str_store_string, s6, "@^Wage debt:  -{reg6}"),
      (else_try),
        (str_store_string, s6, "str_space"),
      (try_end),
      (party_get_morale, reg5, "p_main_party"),
      (store_sub, reg4, reg5, ":var0"),
      (try_begin),
        (gt, reg4, 0),
        (str_store_string, s7, "@{!} +"),
      (else_try),
        (str_store_string, s7, "str_space"),
      (try_end),
      (assign, reg6, 50),
      (str_store_string, s1, "str_current_party_morale_is_reg5_current_party_morale_modifiers_are__base_morale__50_party_size_s2reg1_leadership_s3reg2_food_variety_s4reg3s5s6_recent_events_s7reg4_total__reg5___"),
      (try_for_range, ":var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (faction_get_slot, ":var2", ":var1", 99),
        (val_div, ":var2", 100),
        (neq, ":var2", 0),
        (assign, reg6, ":var2"),
        (str_store_faction_name, s9, ":var1"),
        (str_store_string, s1, "str_s1extra_morale_for_s9_troops__reg6_"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("courtship_relations", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_courtshiprelations"),
      (str_store_string, s1, "str_courtships_in_progress_"),
      (try_for_range, ":var0", "trp_knight_1_1_wife", "trp_heroes_end"),
        (troop_slot_eq, ":var0", 5, 2),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
        (gt, reg0, 0),
        (assign, reg3, reg0),
        (str_store_troop_name, s2, ":var0"),
        (store_current_hours, ":var1"),
        (troop_get_slot, ":var2", ":var0", 4),
        (val_sub, ":var1", ":var2"),
        (store_div, ":var3", ":var1", 24),
        (assign, reg4, ":var3"),
        (str_store_string, s1, "str_s1_s2_relation_reg3_last_visit_reg4_days_ago"),
      (try_end),
      (str_store_string, s1, "str_s1__poems_known"),
      (try_begin),
        (gt, "$allegoric_poem_recitations", 0),
        (str_store_string, s1, "str_s1_storming_the_castle_of_love_allegoric"),
      (try_end),
      (try_begin),
        (gt, "$tragic_poem_recitations", 0),
        (str_store_string, s1, "str_s1_kais_and_layali_tragic"),
      (try_end),
      (try_begin),
        (gt, "$comic_poem_recitations", 0),
        (str_store_string, s1, "str_s1_a_conversation_in_the_garden_comic"),
      (try_end),
      (try_begin),
        (gt, "$heroic_poem_recitations", 0),
        (str_store_string, s1, "str_s1_helgered_and_kara_epic"),
      (try_end),
      (try_begin),
        (gt, "$mystic_poem_recitations", 0),
        (str_store_string, s1, "str_s1_a_hearts_desire_mystic"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("lord_relations", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_lordrelations"),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_set_slot, ":var0", 46, 0),
      (try_end),
      (str_clear, s1),
      (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (assign, ":var2", -100),
        (assign, ":var3", -1),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var0", 46, 0),
          (troop_slot_eq, ":var0", 2, 2),
          (troop_slot_ge, ":var0", 5, 1),
          (call_script, "script_troop_get_player_relation", ":var0"),
          (assign, ":var4", reg0),
          (ge, ":var4", ":var2"),
          (assign, ":var2", ":var4"),
          (assign, ":var3", ":var0"),
        (try_end),
        (gt, ":var3", -1),
        (str_store_troop_name_link, s4, ":var3"),
        (assign, reg4, ":var2"),
        (str_store_string, s1, "@{!}{s1}^{s4}: {reg4}"),
        (troop_set_slot, ":var3", 46, 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("center_income_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_cityincome"),
      (str_clear, s2),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 7, "trp_player"),
        (party_get_slot, reg1, ":var1", 290),
        (party_get_slot, reg2, ":var1", 50),
        (call_script, "script_get_prosperity_text_to_s50", ":var1"),
        (str_store_party_name, s4, ":var1"),
        (str_store_string, s2, "@{s2}^{s4}: Econ: {reg1} - Prosperity: {reg2} {s50} "),
        (val_add, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s1, "@Currently no locations owned."),
      (else_try),
        (str_store_string, s1, "@The current fief income is: ^{s2}"),
      (try_end),
    ],
    [
      ("list_of_fief_with_pending_quests",
      [
        (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var0", 7, "trp_player"),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Give_me_the_list_of_fiefs_with_pending_heartbeat_quests",
      [
        (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var0", 7, "trp_player"),
          (party_slot_ge, ":var0", 296, 1),
          (str_store_party_name, s0, ":var0"),
          (display_message, "str_s0"),
        (try_end),
      ]
      ),

      ("construction",
      [],
      "View_construction_report...",
      [
        (jump_to_menu, "mnu_center_construction_report"),
      ]
      ),

      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("center_construction_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_cityconstruction"),
      (str_clear, s2),
      (assign, ":var0", 0),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var1", 7, "trp_player"),
        (call_script, "script_get_prosperity_text_to_s50", ":var1"),
        (str_store_party_name, s4, ":var1"),
        (try_begin),
          (party_get_slot, ":var2", ":var1", 124),
          (gt, ":var2", 0),
          (call_script, "script_get_improvement_details", ":var2", ":var1"),
          (gt, reg10, 1),
          (store_current_hours, ":var3"),
          (party_get_slot, ":var4", ":var1", 125),
          (val_sub, ":var4", ":var3"),
          (store_div, reg8, ":var4", 24),
          (assign, reg10, 1),
          (try_begin),
            (eq, reg8, 0),
            (assign, reg8, ":var4"),
            (assign, reg10, 0),
          (try_end),
          (val_max, reg8, 1),
          (store_sub, reg9, reg8, 1),
          (try_begin),
            (eq, ":var2", 292),
            (str_store_string, s2, "@{s2}^{s4}: {s10} in {reg8} {reg10?day:hour}{reg9?s:}."),
          (else_try),
            (str_store_string, s2, "@{s2}^{s4}: Building {s10} in {reg8} {reg10?day:hour}{reg9?s:}."),
          (try_end),
        (else_try),
          (str_store_string, s2, "@{s2}^{s4}: No construction."),
        (try_end),
        (val_add, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s1, "@Currently no locations owned."),
      (else_try),
        (str_store_string, s1, "@Current construction at your fiefs: ^{s2}"),
      (try_end),
    ],
    [
      ("back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_center_income_report"),
      ]
      ),
    ],
  ),

  ("victory_progress_report", mnf_scale_picture,
    "Victory Progress Report^^{s6}^^The Snake Cult is: {s7}^The Jatu are: {s8}^The Mystmountain Barbarians are: {s9}^The Heretics are: {s10}^^Total Armies Spawned: {reg4}^^Armies Remaining:^{s13}^^Noldor Relations: {s12}^^Victory is achieved by:^^- Having one Kingdom remaining.^- The Noldor must have Favorable or better relations with you.^- The Mystmountain tribes must either be Obliterated or Destroyed.^- Every other minor faction must be Obliterated or Destroyed with no outstanding minor faction armies or heroic personalties on the map.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_victoryprogress"),
      (str_clear, s2),
      (str_clear, s1),
      (str_clear, s3),
      (str_clear, s4),
      (str_clear, s5),
      (str_clear, s6),
      (str_clear, s7),
      (str_clear, s8),
      (str_clear, s9),
      (str_clear, s10),
      (str_clear, s11),
      (str_clear, s12),
      (str_clear, s13),
      (str_clear, s14),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (assign, ":var1", 0),
        (try_for_range, ":var2", "p_town_1", "p_village_1"),
          (store_faction_of_party, ":var3", ":var2"),
          (eq, ":var3", ":var0"),
          (val_add, ":var1", 1),
        (try_end),
        (try_begin),
          (eq, ":var0", "fac_player_supporters_faction"),
          (eq, "$pop_kingdom", 0),
          (str_store_string, s2, "@Long Forgotten"),
        (else_try),
          (neq, ":var0", "fac_player_supporters_faction"),
          (faction_slot_eq, ":var0", 21, 1),
          (str_store_string, s2, "@Destroyed"),
        (else_try),
          (lt, ":var1", 3),
          (try_begin),
            (eq, ":var0", "fac_kingdom_1"),
            (str_store_string, s2, "@Defending the King's Honor"),
          (else_try),
            (eq, ":var0", "fac_kingdom_2"),
            (str_store_string, s2, "@The Dragon's Fire Grows Cold"),
          (else_try),
            (eq, ":var0", "fac_kingdom_3"),
            (str_store_string, s2, "@The Windriders bow to the Gale"),
          (else_try),
            (eq, ":var0", "fac_kingdom_4"),
            (str_store_string, s2, "@The Shieldwall is Pierced"),
          (else_try),
            (eq, ":var0", "fac_kingdom_5"),
            (str_store_string, s2, "@The Emperor's Will is Weak"),
          (else_try),
            (eq, ":var0", "fac_player_supporters_faction"),
            (str_store_string, s2, "@A Fledgeling Hope for Pendor"),
          (else_try),
            (str_store_string, s2, "@Very Weak"),
          (try_end),
        (else_try),
          (lt, ":var1", 7),
          (try_begin),
            (eq, ":var0", "fac_kingdom_1"),
            (str_store_string, s2, "@Resisting in the King's Name"),
          (else_try),
            (eq, ":var0", "fac_kingdom_2"),
            (str_store_string, s2, "@The Dragon's Wings are Clipped"),
          (else_try),
            (eq, ":var0", "fac_kingdom_3"),
            (str_store_string, s2, "@The Windriders fear the Wind"),
          (else_try),
            (eq, ":var0", "fac_kingdom_4"),
            (str_store_string, s2, "@The Shieldwall Buckles"),
          (else_try),
            (eq, ":var0", "fac_kingdom_5"),
            (str_store_string, s2, "@The Emperor's Will Wavers"),
          (else_try),
            (eq, ":var0", "fac_player_supporters_faction"),
            (str_store_string, s2, "@Promising Madigan's Dream"),
          (else_try),
            (str_store_string, s2, "@Weak"),
          (try_end),
        (else_try),
          (try_begin),
            (eq, ":var0", "fac_kingdom_1"),
            (str_store_string, s2, "@Strong under the King's Banner"),
          (else_try),
            (eq, ":var0", "fac_kingdom_2"),
            (str_store_string, s2, "@The Dragon is Defiant in the North"),
          (else_try),
            (eq, ":var0", "fac_kingdom_3"),
            (str_store_string, s2, "@The Windriders are Fiercely United"),
          (else_try),
            (eq, ":var0", "fac_kingdom_4"),
            (str_store_string, s2, "@The Shieldwall Holds"),
          (else_try),
            (eq, ":var0", "fac_kingdom_5"),
            (str_store_string, s2, "@The Emperor's Will is Law"),
          (else_try),
            (eq, ":var0", "fac_player_supporters_faction"),
            (str_store_string, s2, "@Fulfilling the Prophecy"),
          (else_try),
            (str_store_string, s2, "@Strong"),
          (try_end),
        (try_end),
        (str_store_faction_name, s1, ":var0"),
        (str_store_string, s6, "@{s6}^The {s1}: {s2}"),
      (try_end),
      (store_relation, ":var4", "fac_noldor_elves", "fac_player_faction"),
      (call_script, "script_faction_relations_text_reporter", ":var4"),
      (str_store_string, s12, s33),
      (call_script, "script_determine_victory_conditions_and_text", 0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("companion_report", mnf_scale_picture,
    "{s7}{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_companions"),
      (str_clear, s1),
      (str_store_string, s7, "str_no_companions_in_service"),
      (try_begin),
        (troop_get_slot, ":var0", "trp_player", 30),
        (try_begin),
          (troop_get_type, ":var1", "trp_player"),
          (ge, ":var1", 1),
          (str_store_string, s8, "str_husband"),
        (else_try),
          (str_store_string, s8, "str_wife"),
        (try_end),
        (try_begin),
          (le, ":var0", 0),
          (troop_get_slot, ":var0", "trp_player", 34),
          (str_store_string, s8, "str_betrothed"),
        (try_end),
        (gt, ":var0", 0),
        (str_store_troop_name, s4, ":var0"),
        (troop_get_slot, ":var2", ":var0", 12),
        (try_begin),
          (is_between, ":var2", "p_town_1", "p_salt_mine"),
          (str_store_party_name, s5, ":var2"),
        (else_try),
          (troop_slot_eq, ":var0", 2, 2),
          (str_store_string, s5, "str_leading_party"),
        (else_try),
          (str_store_string, s5, "str_whereabouts_unknown"),
        (try_end),
        (str_store_string, s3, "str_s4_s8_s5"),
        (str_store_string, s2, s1),
        (str_store_string, s1, "str_s2_s3"),
      (try_end),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (ge, "$npc_to_rejoin_party", 0),
        (str_store_troop_name, s5, "$npc_to_rejoin_party"),
        (str_store_string, s1, "@{!}DEBUG -- {s1}^NPC in rejoin queue: {s5}^"),
      (try_end),
      (try_for_range, ":var3", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (str_clear, s2),
        (str_clear, s3),
        (try_begin),
          (troop_get_slot, ":var4", ":var3", 151),
          (troop_slot_eq, ":var3", 2, 5),
          (str_store_troop_name, s4, ":var3"),
          (try_begin),
            (troop_slot_eq, ":var3", 152, 1),
            (str_store_string, s8, "str_gathering_support"),
            (try_begin),
              (le, ":var4", 1),
              (str_store_string, s5, "str_expected_back_imminently"),
            (else_try),
              (assign, reg3, ":var4"),
              (str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
            (try_end),
          (else_try),
            (troop_slot_eq, ":var3", 152, 2),
            (troop_get_slot, ":var5", ":var3", 67),
            (str_store_party_name, s11, ":var5"),
            (str_store_string, s8, "str_gathering_intelligence"),
            (try_begin),
              (le, ":var4", 1),
              (str_store_string, s5, "str_expected_back_imminently"),
            (else_try),
              (assign, reg3, ":var4"),
              (str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
            (try_end),
          (else_try),
            (troop_slot_eq, ":var3", 152, 9),
            (str_store_string, s8, "@Training your Order troops."),
            (try_begin),
              (le, ":var4", 1),
              (str_store_string, s5, "str_expected_back_imminently"),
            (else_try),
              (assign, reg3, ":var4"),
              (str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
            (try_end),
          (else_try),
            (troop_slot_ge, ":var3", 152, 3),
            (neg|troop_slot_ge, ":var3", 152, 8),
            (troop_get_slot, ":var6", ":var3", 153),
            (str_store_faction_name, s9, ":var6"),
            (str_store_string, s8, "str_diplomatic_embassy_to_s9"),
            (try_begin),
              (le, ":var4", 1),
              (str_store_string, s5, "str_expected_back_imminently"),
            (else_try),
              (assign, reg3, ":var4"),
              (str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
            (try_end),
          (else_try),
            (eq, ":var3", "$g_player_minister"),
            (str_store_string, s8, "str_serving_as_minister"),
            (try_begin),
              (is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
              (str_store_party_name, s9, "$g_player_court"),
              (str_store_string, s5, "str_in_your_court_at_s9"),
            (else_try),
              (str_store_string, s5, "str_whereabouts_unknown"),
            (try_end),
          (else_try),
            (main_party_has_troop, ":var3"),
            (str_store_string, s8, "str_under_arms"),
            (str_store_string, s5, "str_in_your_party"),
          (else_try),
            (troop_slot_eq, ":var3", 152, 8),
            (str_store_string, s8, "str_attempting_to_rejoin_party"),
            (str_store_string, s5, "str_whereabouts_unknown"),
          (else_try),
            (troop_slot_ge, ":var3", 12, 1),
            (str_store_string, s8, "str_separated_from_party"),
            (str_store_string, s5, "str_whereabouts_unknown"),
          (else_try),
            (try_begin),
              (check_quest_active, "qst_lend_companion"),
              (quest_slot_eq, "qst_lend_companion", 2, ":var3"),
              (str_store_string, s8, "@On loan,"),
            (else_try),
              (troop_set_slot, ":var3", 152, 8),
              (str_store_string, s8, "str_attempting_to_rejoin_party"),
            (try_end),
            (str_store_string, s5, "str_whereabouts_unknown"),
            (try_begin),
              (ge, "$cheat_mode", 1),
              (troop_get_slot, reg2, ":var3", 152),
              (troop_get_slot, reg3, ":var3", 151),
              (troop_get_slot, reg4, ":var3", 8),
              (troop_get_slot, reg4, ":var3", 82),
              (display_message, "@{!}DEBUG: {s4} current mission: {reg2}, days on mission: {reg3}, prisoner: {reg4}, pphistory: {reg5}"),
            (try_end),
          (try_end),
          (str_store_string, s3, "str_s4_s8_s5"),
          (str_store_string, s2, s1),
          (str_store_string, s1, "str_s2_s3"),
          (str_clear, s7),
        (else_try),
          (neg|troop_slot_eq, ":var3", 2, 2),
          (troop_slot_ge, ":var3", 8, "p_town_1"),
          (str_store_troop_name, s4, ":var3"),
          (str_store_string, s8, "str_missing_after_battle"),
          (str_store_string, s5, "str_whereabouts_unknown"),
          (str_store_string, s3, "str_s4_s8_s5"),
          (str_store_string, s2, s1),
          (str_store_string, s1, "str_s2_s3"),
          (str_clear, s7),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("faction_orders", mnf_scale_picture,
    "{!}{s9}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_faction_orders"),
      (str_clear, s9),
      (store_current_hours, ":var0"),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (neq, ":var1", "fac_player_supporters_faction"),
        (faction_get_slot, ":var2", ":var1", 4),
        (try_begin),
          (faction_get_slot, ":var3", ":var1", 8),
          (gt, ":var3", -1),
          (assign, ":var4", ":var3"),
        (else_try),
          (faction_get_slot, ":var4", ":var1", 11),
        (try_end),
        (call_script, "script_npc_decision_checklist_faction_ai_alt", ":var4"),
        (assign, ":var5", reg0),
        (str_store_string, s26, s14),
        (faction_get_slot, ":var6", ":var1", 4),
        (faction_get_slot, ":var7", ":var1", 5),
        (faction_get_slot, ":var8", ":var1", 8),
        (faction_get_slot, ":var9", ":var1", 9),
        (str_store_faction_name, s10, ":var1"),
        (try_begin),
          (faction_get_slot, ":var10", ":var1", 64),
          (try_begin),
            (eq, ":var10", 1),
            (str_store_string, s11, "@Appoint next marshal"),
          (else_try),
            (is_between, ":var10", "p_town_1", "p_salt_mine"),
            (str_store_party_name, s12, ":var10"),
            (str_store_string, s11, "@Award {s12} as fief"),
          (else_try),
            (eq, ":var10", 0),
            (str_store_string, s11, "@None"),
          (else_try),
            (assign, reg3, ":var10"),
            (str_store_string, s11, "@{!}Error ({reg3})"),
          (try_end),
          (store_current_hours, reg4),
          (faction_get_slot, ":var11", ":var1", 65),
          (val_sub, reg4, ":var11"),
          (str_store_string, s10, "@{!}{s10}^Faction political issue: {s11}"),
          (try_begin),
            (faction_slot_ge, ":var1", 64, 1),
            (str_store_string, s10, "@{!}{s10} (on agenda {reg4} hours)"),
          (try_end),
        (try_end),
        (assign, reg2, ":var9"),
        (try_begin),
          (eq, ":var6", 0),
          (str_store_string, s11, "@{!}Defending"),
        (else_try),
          (eq, ":var6", 1),
          (str_store_string, s11, "@{!}Gathering army"),
        (else_try),
          (eq, ":var6", 2),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s11, "@{!}Besieging {s11}"),
        (else_try),
          (eq, ":var6", 3),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s11, "@{!}Raiding {s11}"),
        (else_try),
          (eq, ":var6", 4),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s11, "str_attacking_enemy_army_near_s11"),
        (else_try),
          (eq, ":var6", 6),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s11, "str_holding_feast_at_s11"),
        (else_try),
          (eq, ":var6", 5),
          (str_store_party_name, s11, ":var7"),
          (str_store_string, s11, "@{!}Attacking enemies around {s11}"),
        (else_try),
          (assign, reg4, ":var6"),
          (str_store_string, s11, "str_sfai_reg4"),
        (try_end),
        (try_begin),
          (lt, ":var8", 0),
          (str_store_string, s12, "@No one"),
        (else_try),
          (str_store_troop_name, s12, ":var8"),
          (troop_get_slot, reg21, ":var8", 150),
          (str_store_string, s12, "@{!}{s12} (controversy: {reg21})"),
        (try_end),
        (try_for_parties, ":var12"),
          (party_slot_eq, ":var12", 4, 12),
          (store_faction_of_party, ":var13", ":var12"),
          (eq, ":var13", ":var1"),
          (str_store_party_name, s38, ":var12"),
          (str_store_string, s12, "@{!}{s12}^Screening party: {s38}"),
        (try_end),
        (try_begin),
          (this_or_next|eq, ":var5", 0),
          (eq, ":var5", 6),
          (store_current_hours, ":var14"),
          (faction_get_slot, ":var15", ":var1", 97),
          (val_sub, ":var14", ":var15"),
          (ge, ":var14", 18),
          (store_current_hours, ":var16"),
          (faction_set_slot, ":var1", 96, ":var16"),
        (try_end),
        (try_begin),
          (neq, ":var5", ":var2"),
          (store_current_hours, ":var16"),
          (faction_set_slot, ":var1", 97, ":var16"),
        (try_end),
        (call_script, "script_evaluate_realm_stability", ":var1"),
        (assign, ":var17", reg0),
        (assign, ":var18", reg1),
        (faction_get_slot, ":var19", ":var1", 94),
        (store_sub, ":var20", ":var0", ":var19"),
        (val_sub, ":var20", 72),
        (faction_get_slot, ":var15", ":var1", 97),
        (store_sub, ":var14", ":var0", ":var15"),
        (faction_get_slot, ":var21", ":var1", 95),
        (store_sub, ":var22", ":var0", ":var21"),
        (faction_get_slot, ":var23", ":var1", 96),
        (store_sub, ":var24", ":var0", ":var23"),
        (faction_get_slot, ":var25", ":var1", 98),
        (store_sub, ":var26", ":var0", ":var25"),
        (assign, reg3, ":var14"),
        (assign, reg4, ":var22"),
        (assign, reg5, ":var20"),
        (assign, reg7, ":var17"),
        (assign, reg8, ":var18"),
        (assign, reg9, ":var24"),
        (assign, reg10, ":var26"),
        (str_store_string, s14, s26),
        (str_store_string, s9, "str_s9s10_current_state_s11_hours_at_current_state_reg3_current_strategic_thinking_s14_marshall_s12_since_the_last_offensive_ended_reg4_hours_since_the_decisive_event_reg10_hours_since_the_last_rest_reg9_hours_since_the_last_feast_ended_reg5_hours_percent_disgruntled_lords_reg7_percent_restless_lords_reg8__"),
      (try_end),
      (try_begin),
        (neg|is_between, "$g_cheat_selected_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (call_script, "script_get_next_active_kingdom", "fac_kingdoms_end"),
        (assign, "$g_cheat_selected_faction", reg0),
      (try_end),
      (str_store_faction_name, s10, "$g_cheat_selected_faction"),
      (str_store_string, s9, "@Selected faction is: {s10}^^{s9}"),
    ],
    [
      ("faction_orders_next_faction",
      [],
      "{!}Select_next_faction.",
      [
        (call_script, "script_get_next_active_kingdom", "$g_cheat_selected_faction"),
        (assign, "$g_cheat_selected_faction", reg0),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_political_collapse",
      [],
      "{!}CHEAT_-_Cause_all_lords_in_faction_to_fall_out_with_their_liege.",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var0", 2, 2),
          (store_troop_faction, ":var1", ":var0"),
          (eq, ":var1", "$g_cheat_selected_faction"),
          (faction_get_slot, ":var2", ":var1", 11),
          (call_script, "script_troop_change_relation_with_troop", ":var0", ":var2", -200),
        (try_end),
      ]
      ),

      ("faction_orders_defend",
      [],
      "{!}Force_defend.",
      [
        (faction_set_slot, "$g_cheat_selected_faction", 4, 0),
        (faction_set_slot, "$g_cheat_selected_faction", 5, -1),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_feast",
      [],
      "{!}Force_feast.",
      [
        (assign, ":var0", 0),
        (try_for_range, ":var1", "p_town_1", "p_village_1"),
          (neg|party_slot_ge, ":var1", 54, 1),
          (store_faction_of_party, ":var2", ":var1"),
          (eq, ":var2", "$g_cheat_selected_faction"),
          (party_get_slot, ":var3", ":var1", 7),
          (troop_get_slot, ":var4", ":var3", 7),
          (store_random_in_range, ":var5", 0, 1000),
          (val_add, ":var4", ":var5"),
          (gt, ":var4", ":var0"),
          (assign, ":var0", ":var4"),
          (assign, ":var6", ":var1"),
        (try_end),
        (try_begin),
          (gt, ":var6", "p_town_1"),
          (faction_set_slot, "$g_cheat_selected_faction", 4, 6),
          (faction_set_slot, "$g_cheat_selected_faction", 5, ":var6"),
          (try_begin),
            (eq, "$g_player_eligible_feast_center_no", ":var6"),
            (assign, "$g_player_eligible_feast_center_no", -1),
          (try_end),
          (store_current_hours, ":var7"),
          (faction_set_slot, "$g_cheat_selected_faction", 94, ":var7"),
        (try_end),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_gather",
      [],
      "{!}Force_gather_army.",
      [
        (store_current_hours, ":var0"),
        (faction_set_slot, "$g_cheat_selected_faction", 4, 1),
        (faction_set_slot, "$g_cheat_selected_faction", 95, ":var0"),
        (faction_set_slot, "$g_cheat_selected_faction", 9, 1),
        (faction_set_slot, "$g_cheat_selected_faction", 5, -1),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_increase_time",
      [],
      "{!}Increase_last_offensive_time_by_24_hours.",
      [
        (faction_get_slot, ":var0", "$g_cheat_selected_faction", 95),
        (val_sub, ":var0", 24),
        (faction_set_slot, "$g_cheat_selected_faction", 95, ":var0"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_rethink",
      [],
      "{!}Force_rethink.",
      [
        (call_script, "script_init_ai_calculation"),
        (call_script, "script_decide_faction_ai", "$g_cheat_selected_faction"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_rethink_all",
      [],
      "{!}Force_rethink_for_all_factions.",
      [
        (call_script, "script_recalculate_ais"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("enable_alt_ai",
      [
        (eq, "$g_use_alternative_ai", 2),
      ],
      "{!}CHEAT!_-_enable_alternative_ai",
      [
        (assign, "$g_use_alternative_ai", 1),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("disable_alt_ai",
      [
        (eq, "$g_use_alternative_ai", 2),
      ],
      "{!}CHEAT!_-_disable_alternative_ai",
      [
        (assign, "$g_use_alternative_ai", 0),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_init_econ",
      [],
      "{!}Initialize_economic_stats.",
      [
        (call_script, "script_initialize_economic_information"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("go_back_a_dot",
      [],
      "{!}Go_back.",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("character_report", mnf_scale_picture,
    "{s9}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_pendor_rep_character_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_pendor_rep_character_man"),
      (try_end),
      (try_begin),
        (gt, "$g_player_reading_book", 0),
        (player_has_item, "$g_player_reading_book"),
        (str_store_item_name, s8, "$g_player_reading_book"),
        (str_store_string, s9, "@You are currently reading {s8}."),
      (else_try),
        (assign, "$g_player_reading_book", 0),
        (str_store_string, s9, "@You are not reading any books."),
      (try_end),
      (try_begin),
        (eq, "$background_answer_4", 24),
        (str_store_string, s9, "@ {s9} ^^ You have the ability to train Knights of the Griffon due to your clear birthright."),
      (try_end),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (str_store_string, s6, "@none"),
      (str_store_string, s8, "@none"),
      (try_for_range, ":var3", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (this_or_next|troop_slot_eq, ":var3", 2, 2),
        (troop_slot_eq, ":var3", 2, 9),
        (call_script, "script_troop_get_player_relation", ":var3"),
        (assign, ":var4", reg0),
        (try_begin),
          (gt, ":var4", 20),
          (try_begin),
            (eq, ":var1", 0),
            (str_store_troop_name, s8, ":var3"),
          (else_try),
            (eq, ":var1", 1),
            (str_store_troop_name, s7, ":var3"),
            (str_store_string, s8, "@{s7} and {s8}"),
          (else_try),
            (str_store_troop_name, s7, ":var3"),
            (str_store_string, s8, "@{!}{s7}, {s8}"),
          (try_end),
          (val_add, ":var1", 1),
        (else_try),
          (lt, ":var4", -20),
          (try_begin),
            (eq, ":var2", 0),
            (str_store_troop_name, s6, ":var3"),
          (else_try),
            (eq, ":var2", 1),
            (str_store_troop_name, s5, ":var3"),
            (str_store_string, s6, "@{s5} and {s6}"),
          (else_try),
            (str_store_troop_name, s5, ":var3"),
            (str_store_string, s6, "@{!}{s5}, {s6}"),
          (try_end),
          (val_add, ":var2", 1),
        (try_end),
      (try_end),
      (str_clear, s12),
      (try_begin),
        (gt, "$player_right_to_rule", 0),
        (assign, reg12, "$player_right_to_rule"),
        (str_store_string, s12, "str__right_to_rule_reg12"),
      (try_end),
      (str_clear, s15),
      (try_begin),
        (this_or_next|gt, "$claim_arguments_made", 0),
        (this_or_next|gt, "$ruler_arguments_made", 0),
        (this_or_next|gt, "$victory_arguments_made", 0),
        (this_or_next|gt, "$lords_arguments_made", 0),
        (eq, 1, 0),
        (assign, reg3, "$claim_arguments_made"),
        (assign, reg4, "$ruler_arguments_made"),
        (assign, reg5, "$victory_arguments_made"),
        (assign, reg6, "$lords_arguments_made"),
        (assign, reg7, "$benefit_arguments_made"),
        (str_store_string, s15, "str_political_arguments_made_legality_reg3_rights_of_lords_reg4_unificationpeace_reg5_rights_of_commons_reg6_fief_pledges_reg7"),
      (try_end),
      (assign, reg3, "$player_honor"),
      (troop_get_slot, reg2, "trp_player", 7),
      (str_store_string, s9, "str_renown_reg2_honour_rating_reg3s12_friends_s8_enemies_s6_s9"),
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (assign, ":var5", reg0),
      (try_begin),
        (gt, ":var5", 0),
        (try_for_range_backwards, ":var6", 0, ":var5"),
          (call_script, "script_troop_get_leaded_center_with_index", "trp_player", ":var6"),
          (assign, ":var7", reg0),
          (store_sub, ":var8", ":var5", ":var6"),
          (val_sub, ":var8", 1),
          (try_begin),
            (eq, ":var8", 0),
            (str_store_party_name, s8, ":var7"),
          (else_try),
            (eq, ":var8", 1),
            (str_store_party_name, s7, ":var7"),
            (str_store_string, s8, "@{s7} and {s8}"),
          (else_try),
            (str_store_party_name, s7, ":var7"),
            (str_store_string, s8, "@{!}{s7}, {s8}"),
          (try_end),
        (try_end),
        (str_store_string, s9, "@Your estates are: {s8}.^{s9}"),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var9", "trp_player", 162),
        (neq, ":var9", 0),
        (store_troop_faction, ":var10", ":var9"),
        (faction_get_slot, ":var11", ":var10", 72),
        (store_sub, ":var12", ":var11", 1),
        (val_add, ":var12", "str_order_rank_1"),
        (str_store_string, s8, ":var12"),
        (try_begin),
          (eq, ":var10", "fac_player_knights"),
          (str_store_string, s8, "@Honorary Grandmaster"),
        (else_try),
          (lt, ":var11", 7),
          (faction_get_slot, reg1, ":var10", 71),
          (str_store_string, s8, "@{s8} ({reg1})"),
        (try_end),
        (str_store_faction_name, s12, ":var10"),
        (str_store_string, s9, "@You are a {s8} of the Order of the {s12}.^{s9}"),
      (try_end),
      (assign, reg1, 0),
      (try_begin),
        (faction_slot_ge, "fac_player_faction", 70, 1),
        (faction_get_slot, ":var13", "fac_player_faction", 70),
        (assign, reg1, ":var13"),
      (try_end),
      (try_begin),
        (eq, "$pop_kingdom", 1),
        (str_store_faction_name, s8, "$players_kingdom"),
        (faction_get_slot, ":var14", "fac_player_supporters_faction", 10),
        (str_store_faction_name, s7, ":var14"),
        (call_script, "script_gender_to_reg63"),
        (str_store_string, s9, "@You are the sovereign {reg63?King:Queen} of the {s8}, embracing the culture of {s7}.^{s9} ^ You have {reg1} Noble Recruits."),
      (else_try),
        (gt, "$players_kingdom", 0),
        (str_store_faction_name, s8, "$players_kingdom"),
        (try_begin),
          (eq, "$player_has_homage", 1),
          (str_store_string, s9, "@You are a lord of the {s8}.^{s9} ^ You have {reg1} Noble Recruits."),
        (else_try),
          (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
          (str_store_string, s9, "@You are a Rogue Leader of the {s8}.^{s9}"),
        (else_try),
          (str_store_string, s9, "@You are a Mercenary Captain in the service of the {s8}.^{s9}"),
        (try_end),
      (else_try),
        (str_store_string, s9, "@You are a Mercenary Captain.^ {s9}"),
      (try_end),
      (assign, reg33, "$noldor_tournaments_won"),
      (try_begin),
        (eq, reg33, 1),
        (str_store_string, s9, "@{s9} ^ You won {reg33} Noldor Tournament."),
      (else_try),
        (str_store_string, s9, "@{s9} ^ You won {reg33} Noldor Tournaments."),
      (else_try),
    ],
    [
      ("cheat_increase_rtr",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_increase_Right_to_Rule",
      [
        (val_add, "$player_right_to_rule", 10),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_decrease_rtr",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_decrease_Right_to_Rule",
      [
        (ge, "$player_right_to_rule", 10),
        (val_sub, "$player_right_to_rule", 10),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_increase_rel_npc",
      [
        (eq, "$cheat_mode", 1),
        (str_store_troop_name, s14, "$g_talk_troop"),
      ],
      "{!}CHEAT!_-_increase_your_relation_with_{s14}",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 10),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_increase_hon",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_increase_honor",
      [
        (val_add, "$player_honor", 10),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_decrease_hon",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_decrease_honor",
      [
        (val_sub, "$player_honor", 10),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_increase_ren",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_increase_renown",
      [
        (troop_get_slot, ":var0", "trp_player", 7),
        (val_add, ":var0", 50),
        (troop_set_slot, "trp_player", 7, ":var0"),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("cheat_increase_per",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_-_increase_persuasion",
      [
        (troop_raise_skill, "trp_player", "skl_persuasion", 1),
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("party_size_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_partysize"),
      (call_script, "script_game_get_party_companion_limit"),
      (assign, ":var0", reg0),
      (store_skill_level, ":var1", "skl_leadership", "trp_player"),
      (val_mul, ":var1", 10),
      (store_attribute_level, ":var2", "trp_player", ca_charisma),
      (troop_get_slot, ":var3", "trp_player", 7),
      (val_div, ":var3", 25),
      (try_begin),
        (gt, ":var1", 0),
        (str_store_string, s2, "@{!} +"),
      (else_try),
        (str_store_string, s2, "str_space"),
      (try_end),
      (try_begin),
        (gt, ":var2", 0),
        (val_mul, ":var2", 2),
        (str_store_string, s3, "@{!} +"),
      (else_try),
        (str_store_string, s3, "str_space"),
      (try_end),
      (try_begin),
        (gt, ":var3", 0),
        (str_store_string, s4, "@{!} +"),
      (else_try),
        (str_store_string, s4, "str_space"),
      (try_end),
      (assign, reg5, ":var0"),
      (assign, reg1, ":var1"),
      (assign, reg2, ":var2"),
      (assign, reg3, ":var3"),
      (str_store_string, s1, "@Current party size limit is {reg5}.^Current party size modifiers are:^^Base size:  +10^Leadership: {s2}{reg1}^Charisma: {s3}{reg2}^Renown: {s4}{reg3}^TOTAL:  {reg5}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("faction_relations_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_factionrelations"),
      (str_clear, s2),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (neq, ":var0", "fac_player_supporters_faction"),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
        (call_script, "script_faction_relations_text_reporter", ":var1"),
        (str_store_faction_name, s4, ":var0"),
        (assign, reg1, ":var1"),
        (str_store_string, s2, "@{s2}^The {s4}: {reg1} ({s33})"),
      (try_end),
      (str_store_string, s2, "@{s2}^"),
      (try_for_range, ":var0", "fac_noldor_elves", "fac_dragon_knights"),
        (store_relation, ":var1", "fac_player_faction", ":var0"),
        (call_script, "script_faction_relations_text_reporter", ":var1"),
        (str_store_faction_name, s4, ":var0"),
        (assign, reg1, ":var1"),
        (try_begin),
          (is_between, ":var0", "fac_barclay", "fac_jatu"),
          (str_store_string, s2, "@{s2}^{s4}: {reg1} ({s33})"),
        (else_try),
          (str_store_string, s2, "@{s2}^The {s4}: {reg1} ({s33})"),
        (try_end),
      (try_end),
      (str_store_string, s1, "@Your relations with the factions are:^{s2}"),
    ],
    [
      ("orders",
      [],
      "View_relations_with_Knighthood_Orders.",
      [
        (jump_to_menu, "mnu_order_relations_report"),
      ]
      ),

      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("order_relations_report", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rep_orderrelations"),
      (str_clear, s2),
      (try_for_range, ":var0", "fac_dragon_knights", "fac_noldor_castle"),
        (this_or_next|neq, ":var0", "fac_player_knights"),
        (eq, "$players_order_name_set", 1),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
        (call_script, "script_faction_relations_text_reporter", ":var1"),
        (str_store_faction_name, s4, ":var0"),
        (assign, reg1, ":var1"),
        (str_store_string, s2, "@{s2}^The {s4}: {reg1} ({s33})"),
      (try_end),
      (str_store_string, s1, "@Your relations with the Orders are:^{s2}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("camp", mnf_scale_picture,
    "You set up camp. What do you want to do?",
    "none",
    [
      (assign, "$g_player_icon_state", 0),
      (set_background_mesh, "mesh_pic_camp"),
    ],
    [
      ("camp_action_1",
      [],
      "Walk_around_and_review_your_soldiers.",
      [
        (set_jump_mission, "mt_camp_review_soldiers"),
        (call_script, "script_party_count_fit_for_battle", "p_main_party", 0),
        (call_script, "script_setup_random_scene", reg0),
        (assign, "$g_encountered_party", -1),
        (change_screen_mission),
      ]
      ),

      ("camp_manage_inventory",
      [
        (call_script, "script_get_count_of_companions"),
        (gt, reg0, 0),
      ],
      "Manage_your_party's_inventory.",
      [
        (troop_clear_inventory, "trp_temp_troop"),
        (assign, "$return_menu", "mnu_camp"),
        (assign, "$inventory_menu_offset", 0),
        (str_clear, s30),
        (jump_to_menu, "mnu_manage_loot_pool"),
      ]
      ),

      ("camp_access_companions_inventory",
      [
        (call_script, "script_get_count_of_companions"),
        (gt, reg0, 0),
      ],
      "Access_companions'_inventories.",
      [
        (assign, "$inventory_menu_offset", 0),
        (jump_to_menu, "mnu_access_companions_inventory"),
      ]
      ),

      ("camp_action",
      [],
      "Take_an_action.",
      [
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("camp_wait_here",
      [],
      "Wait_here_for_some_time.",
      [
        (assign, "$g_camp_mode", 1),
        (assign, "$g_infinite_camping", 0),
        (assign, "$g_player_icon_state", 1),
        (try_begin),
          (party_is_active, "p_main_party"),
          (party_get_current_terrain, ":var0", "p_main_party"),
          (try_begin),
            (eq, ":var0", 5),
            (372, 28),
          (try_end),
        (try_end),
        (rest_for_hours_interactive, 8760, 5, 1),
        (change_screen_return),
      ]
      ),

      ("camp_options",
      [],
      "POP_options.",
      [
        (start_presentation, "prsnt_mod_options"),
      ]
      ),

      ("resume_travelling",
      [],
      "Resume_travelling.",
      [
        (try_begin),
          (neq, "$g_option_companion_dialogs", 0),
          (store_random_in_range, ":var0", 0, 100),
          (lt, ":var0", 5),
          (assign, ":var1", 0),
          (assign, ":var2", 0),
          (try_for_range, ":var3", "trp_npc_adonja", "trp_kingdom_1_lord"),
            (main_party_has_troop, ":var3"),
            (neg|troop_is_wounded, ":var3"),
            (troop_get_slot, ":var4", ":var3", 79),
            (store_and, ":var2", ":var4", 8),
            (eq, ":var2", 0),
            (assign, ":var5", 0),
            (try_begin),
              (eq, ":var3", "trp_npc_adonja"),
              (neg|main_party_has_troop, "trp_npc_ansen"),
            (else_try),
              (eq, ":var3", "trp_npc_ediz"),
              (neg|main_party_has_troop, "trp_npc_rayne"),
            (else_try),
              (eq, ":var3", "trp_npc_jocelyn"),
              (neg|main_party_has_troop, "trp_npc_alistair"),
            (else_try),
              (eq, ":var3", "trp_npc_rayne"),
              (neg|main_party_has_troop, "trp_npc_boadice"),
            (else_try),
              (eq, ":var3", "trp_npc_riva"),
              (neg|main_party_has_troop, "trp_npc_kassim"),
            (else_try),
              (eq, ":var3", "trp_npc_leslie"),
              (neg|main_party_has_troop, "trp_npc_diev"),
            (else_try),
              (eq, ":var3", "trp_npc_diev"),
              (neg|main_party_has_troop, "trp_npc_leslie"),
            (else_try),
              (assign, ":var5", 1),
            (try_end),
            (eq, ":var5", 1),
            (val_add, ":var1", 1),
          (try_end),
          (gt, ":var1", 0),
          (assign, ":var6", -1),
          (store_random_in_range, ":var7", 0, ":var1"),
          (try_for_range, ":var3", "trp_npc_adonja", "trp_kingdom_1_lord"),
            (ge, ":var7", 0),
            (main_party_has_troop, ":var3"),
            (neg|troop_is_wounded, ":var3"),
            (troop_get_slot, ":var4", ":var3", 79),
            (store_and, ":var2", ":var4", 8),
            (eq, ":var2", 0),
            (assign, ":var5", 0),
            (try_begin),
              (eq, ":var3", "trp_npc_adonja"),
              (neg|main_party_has_troop, "trp_npc_ansen"),
            (else_try),
              (eq, ":var3", "trp_npc_ediz"),
              (neg|main_party_has_troop, "trp_npc_rayne"),
            (else_try),
              (eq, ":var3", "trp_npc_jocelyn"),
              (neg|main_party_has_troop, "trp_npc_alistair"),
            (else_try),
              (eq, ":var3", "trp_npc_rayne"),
              (neg|main_party_has_troop, "trp_npc_boadice"),
            (else_try),
              (eq, ":var3", "trp_npc_riva"),
              (neg|main_party_has_troop, "trp_npc_kassim"),
            (else_try),
              (eq, ":var3", "trp_npc_leslie"),
              (neg|main_party_has_troop, "trp_npc_diev"),
            (else_try),
              (eq, ":var3", "trp_npc_diev"),
              (neg|main_party_has_troop, "trp_npc_leslie"),
            (else_try),
              (assign, ":var5", 1),
            (try_end),
            (eq, ":var5", 1),
            (try_begin),
              (eq, ":var7", 0),
              (val_or, ":var4", 8),
              (troop_set_slot, ":var3", 79, ":var4"),
              (assign, ":var6", ":var3"),
            (try_end),
            (val_sub, ":var7", 1),
          (try_end),
          (assign, "$npc_dialog_partner", -1),
          (start_map_conversation, ":var6"),
          (change_screen_map),
        (else_try),
          (change_screen_return),
        (try_end),
      ]
      ),

      ("camp_cheat_infoline",
      [
        (ge, "$cheat_mode", 1),
        (disable_menu_option),
      ],
      "-CHEATS_BELOW_ARE_ONLY_FOR_DEVELOPERS-",
      []
      ),

      ("camp_cheat",
      [
        (ge, "$cheat_mode", 1),
      ],
      "Cheat_Menu.",
      [
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("test_vader",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat_Menu_Vader.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),

      ("test_vader2",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat_Menu_Vader_Troops.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("testers_cheat",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat_Menu_Testers.",
      [
        (jump_to_menu, "mnu_testers_cheat"),
      ]
      ),

      ("fix_pop",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Fix_my_game.",
      [
        (jump_to_menu, "mnu_fix_pop_list"),
      ]
      ),
    ],
  ),

  ("fix_pop_list", mnf_scale_picture,
    "Fix my game.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("fix_food",
      [],
      "Fix_'0_morale_food'_&_'negative_enterprise_income'_&_'no_CKO_items'.",
      [
        (call_script, "script_initialize_item_info"),
      ]
      ),

      ("camp_autoloot_for_bug",
      [],
      "Camp_Autoloot_to_Correct_Bug.",
      [
        (jump_to_menu, "mnu_camp_autoloot"),
      ]
      ),

      ("reset_old_ruins_var",
      [],
      "Reset_blacksmith_and_stable_boy_in_Old_Ruins.",
      [
        (assign, "$old_ruins_var", 0),
      ]
      ),

      ("purge_the_world",
      [],
      "Purge_the_world.",
      [
        (jump_to_menu, "mnu_purge_the_world_0"),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("purge_the_world_0", mnf_scale_picture,
    "Attempt to reduce sizes of all field armies to the selected maximum value by randomly removing troops with level <35.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("purge_the_world_1",
      [],
      "1000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 1000, 1),
      ]
      ),

      ("purge_the_world_2",
      [],
      "2000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 2000, 1),
      ]
      ),

      ("purge_the_world_3",
      [],
      "3000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 3000, 1),
      ]
      ),

      ("purge_the_world_4",
      [],
      "4000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 4000, 1),
      ]
      ),

      ("purge_the_world_5",
      [],
      "5000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 5000, 1),
      ]
      ),

      ("purge_the_world_6",
      [],
      "7500_warriors",
      [
        (call_script, "script_purge_the_world_execute", 7500, 1),
      ]
      ),

      ("purge_the_world_7",
      [],
      "10000_warriors",
      [
        (call_script, "script_purge_the_world_execute", 10000, 1),
      ]
      ),

      ("purge_the_world_8",
      [],
      "1000_warriors_with_no_level_restriction",
      [
        (call_script, "script_purge_the_world_execute", 1000, 2),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("testers_cheat", mnf_scale_picture,
    "Cheats for testers.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("camp_cheatleo_get_50_troops",
      [
        (255),
      ],
      "Get_100_troops.",
      [
        (party_clear, "p_temp_party"),
        (try_for_range, ":var0", "trp_farmer", "trp_town_walker_1"),
          (neg|is_between, ":var0", "trp_hero_burilgi", "trp_omen_seeker"),
          (neq, ":var0", "trp_hero_eyegrim"),
          (neq, ":var0", "trp_seeress"),
          (neq, ":var0", "trp_mercenaries_end"),
          (neq, ":var0", "trp_noldor_troop_for_shop"),
          (neg|is_between, ":var0", "trp_sarleon_lady_in_waiting", "trp_dragon_drake"),
          (party_add_members, "p_temp_party", ":var0", 100),
        (try_end),
        (change_screen_exchange_members, 1, "p_temp_party"),
      ]
      ),

      ("camp_cheatleo_give_troops",
      [
        (255),
      ],
      "Give_troops.",
      [
        (spawn_around_party, "p_main_party", "pt_looters"),
        (party_clear, reg0),
        (change_screen_exchange_members, 1, reg0),
        (assign, reg5, reg0),
      ]
      ),

      ("camp_cheatleo_undress_troops",
      [
        (255),
      ],
      "Undress_a_soldier.",
      [
        (party_get_num_companion_stacks, ":var0", reg5),
        (try_for_range, ":var1", 0, ":var0"),
          (party_stack_get_troop_id, ":var2", reg5, ":var1"),
          (call_script, "script_copy_inventory", ":var2", "trp_player"),
          (2750, 1, ":var2", 0),
          (2751, "trp_player", 1, 0),
        (try_end),
      ]
      ),

      ("camp_cheatleo_get_lords",
      [
        (255),
      ],
      "Get_Lords.",
      [
        (party_clear, "p_temp_party"),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (party_add_members, "p_temp_party", ":var0", 10),
        (try_end),
        (change_screen_exchange_members, 1, "p_temp_party"),
      ]
      ),

      ("cheat_spawn_ashenborn",
      [
        (255),
      ],
      "Give_me_the_new_Ashenborn_and_Assassin_units.",
      [
        (party_add_members, "p_main_party", "trp_phoenix_knight", 1),
        (party_add_members, "p_main_party", "trp_shadowwolves_knight", 1),
        (party_add_members, "p_main_party", "trp_scorpion_assassin_knight", 1),
        (party_add_members, "p_main_party", "trp_phoenix_squire", 1),
        (party_add_members, "p_main_party", "trp_wolf_squire", 1),
        (party_add_members, "p_main_party", "trp_scorpion_squire", 1),
        (display_message, "@6 new units joined the party"),
      ]
      ),

      ("cheat_companion_xp",
      [
        (255),
      ],
      "Give_my_company_1_000_000_XP.",
      [
        (set_show_messages, 0),
        (party_upgrade_with_xp, "p_main_party", 1000000, 1),
        (set_show_messages, 1),
        (display_message, "@1 million xp received"),
      ]
      ),

      ("cheat_change_race_noldor",
      [
        (255),
      ],
      "Make_me_an_elf.",
      [
        (troop_set_type, "trp_player", 4),
      ]
      ),

      ("cheat_change_race_undead",
      [
        (255),
      ],
      "Make_me_a_zombie.",
      [
        (troop_set_type, "trp_player", 3),
      ]
      ),

      ("raise_player_level",
      [
        (255),
      ],
      "Give_me_1_000_000_XP.",
      [
        (add_xp_to_troop, 1000000, "trp_player"),
      ]
      ),

      ("cheat_disable_companion_complaints",
      [
        (neq, "$disable_npc_complaints", 2),
      ],
      "Disable_companion_complaints.",
      [
        (assign, "$disable_npc_complaints", 2),
        (display_message, "@Companion complaints are disabled", 0x289128),
        (jump_to_menu, "mnu_testers_cheat"),
      ]
      ),

      ("cheat_enable_companion_complaints",
      [
        (eq, "$disable_npc_complaints", 2),
      ],
      "Enable_companion_complaints.",
      [
        (assign, "$disable_npc_complaints", 0),
        (display_message, "@Companion complaints are enabled", 0x289128),
        (jump_to_menu, "mnu_testers_cheat"),
      ]
      ),

      ("cheat_disable_cheatmode",
      [],
      "Turn_cheat_mode_off.",
      [
        (assign, "$cheat_mode", 0),
        (display_message, "@Cheat mode has been disabled", 0x289128),
        (jump_to_menu, "mnu_testers_cheat"),
      ]
      ),

      ("choose_scene",
      [
        (eq, "$cheat_mode", 1),
        (eq, "$test_mode", 1),
      ],
      "Scene_Chooser.",
      [
        (jump_to_menu, "mnu_choose_scenes_0"),
      ]
      ),

      ("sarleon_loves_me",
      [
        (eq, "$cheat_mode", 1),
        (eq, "$test_mode", 1),
      ],
      "Sarleon_loves_me.",
      [
        (try_for_range, ":var0", "trp_knight_1_1", "trp_knight_2_1"),
          (troop_set_slot, ":var0", 22, 100),
        (try_end),
        (troop_set_slot, "trp_kingdom_1_lord", 22, 100),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_cheat", mnf_scale_picture,
    "Select a cheat:",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("camp_cheat_find_item",
      [],
      "Find_an_item_...",
      [
        (jump_to_menu, "mnu_cheat_find_item"),
      ]
      ),

      ("camp_cheat_change_weather",
      [],
      "Change_weather_...",
      [
        (jump_to_menu, "mnu_cheat_change_weather"),
      ]
      ),

      ("camp_cheat_1",
      [],
      "{!}Increase_player_renown.",
      [
        (str_store_string, s1, "@Player renown is increased by 100. "),
        (call_script, "script_change_troop_renown", "trp_player", 100),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_2",
      [],
      "{!}Increase_player_honor.",
      [
        (assign, reg7, "$player_honor"),
        (val_add, reg7, 1),
        (display_message, "@Player honor is increased by 1 and it is now {reg7}."),
        (val_add, "$player_honor", 1),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_3",
      [],
      "{!}Update_political_notes.",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var0", 2, 2),
          (call_script, "script_update_troop_political_notes", ":var0"),
        (try_end),
        (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (call_script, "script_update_faction_political_notes", ":var1"),
        (try_end),
      ]
      ),

      ("camp_cheat_4",
      [],
      "{!}Update_troop_notes.",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var0", 2, 2),
          (call_script, "script_update_troop_notes", ":var0"),
        (try_end),
        (try_for_range, ":var1", "trp_knight_1_1_wife", "trp_heroes_end"),
          (call_script, "script_update_troop_notes", ":var1"),
          (call_script, "script_update_troop_political_notes", ":var1"),
          (call_script, "script_update_troop_location_notes", ":var1", 0),
        (try_end),
      ]
      ),

      ("camp_cheat_5",
      [],
      "{!}Scramble_minstrels.",
      [
        (call_script, "script_update_tavern_minstrels"),
      ]
      ),

      ("camp_cheat_6",
      [],
      "{!}Infinite_camp.",
      [
        (assign, "$g_camp_mode", 1),
        (assign, "$g_infinite_camping", 1),
        (assign, "$g_player_icon_state", 1),
        (rest_for_hours_interactive, 87600, 20),
        (change_screen_return),
      ]
      ),

      ("cheat_debug_msg_all",
      [
        (ge, "$cheat_mode", 1),
      ],
      "{!}Cheat:_Set_Debug_messages_to_All.",
      [
        (assign, "$cheat_mode", 1),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("cheat_debug_msg_econ",
      [
        (ge, "$cheat_mode", 1),
        (neq, "$cheat_mode", 3),
      ],
      "{!}Cheat:_Set_Debug_messages_to_Econ_Only.",
      [
        (assign, "$cheat_mode", 3),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("cheat_debug_msg_poli",
      [
        (ge, "$cheat_mode", 1),
        (neq, "$cheat_mode", 4),
      ],
      "{!}Cheat:_Set_Debug_messages_to_Political_Only.",
      [
        (assign, "$cheat_mode", 4),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("cheat_find_item", mnf_scale_picture,
    "{!}Current item range: {reg5} to {reg6}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
      (assign, reg5, "$cheat_find_item_range_begin"),
      (store_add, reg6, "$cheat_find_item_range_begin", 96),
      (val_min, reg6, "itm_items_end"),
      (val_sub, reg6, 1),
    ],
    [
      ("cheat_find_item_next_range",
      [],
      "{!}Move_to_next_item_range.",
      [
        (val_add, "$cheat_find_item_range_begin", 96),
        (try_begin),
          (ge, "$cheat_find_item_range_begin", "itm_items_end"),
          (assign, "$cheat_find_item_range_begin", 0),
        (try_end),
        (jump_to_menu, "mnu_cheat_find_item"),
      ]
      ),

      ("cheat_find_item_choose_this",
      [],
      "{!}Choose_from_this_range.",
      [
        (troop_clear_inventory, "trp_find_item_cheat"),
        (store_add, ":var0", "$cheat_find_item_range_begin", 96),
        (val_min, ":var0", "itm_items_end"),
        (store_sub, ":var1", ":var0", "$cheat_find_item_range_begin"),
        (try_for_range, ":var2", 0, ":var1"),
          (store_add, ":var3", "$cheat_find_item_range_begin", ":var2"),
          (troop_add_items, "trp_find_item_cheat", ":var3", 1),
        (try_end),
        (change_screen_trade, "trp_find_item_cheat"),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("cheat_change_weather", 0,
    "{!}Current cloud amount: {reg5}^Current Fog Strength: {reg6}",
    "none",
    [
      (get_global_cloud_amount, reg5),
      (get_global_haze_amount, reg6),
    ],
    [
      ("cheat_increase_cloud",
      [],
      "{!}Increase_Cloud_Amount.",
      [
        (get_global_cloud_amount, ":var0"),
        (val_add, ":var0", 5),
        (val_min, ":var0", 100),
        (set_global_cloud_amount, ":var0"),
      ]
      ),

      ("cheat_decrease_cloud",
      [],
      "{!}Decrease_Cloud_Amount.",
      [
        (get_global_cloud_amount, ":var0"),
        (val_sub, ":var0", 5),
        (val_max, ":var0", 0),
        (set_global_cloud_amount, ":var0"),
      ]
      ),

      ("cheat_increase_fog",
      [],
      "{!}Increase_Fog_Amount.",
      [
        (get_global_haze_amount, ":var0"),
        (val_add, ":var0", 5),
        (val_min, ":var0", 100),
        (set_global_haze_amount, ":var0"),
      ]
      ),

      ("cheat_decrease_fog",
      [],
      "{!}Decrease_Fog_Amount.",
      [
        (get_global_haze_amount, ":var0"),
        (val_sub, ":var0", 5),
        (val_max, ":var0", 0),
        (set_global_haze_amount, ":var0"),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_vader", mnf_scale_picture,
    "What do you want to test today?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("camp_vader_pimp",
      [],
      "First,_pimp_me_up!",
      [
        (call_script, "script_campvader_pimpmeup"),
      ]
      ),

      ("salt_mine",
      [],
      "Go_to_Al-Aziz.",
      [
        (jump_to_menu, "mnu_salt_mine"),
      ]
      ),

      ("camp_vader_ownorder",
      [],
      "Test_Player_Order_...",
      [
        (jump_to_menu, "mnu_camp_ownorder"),
      ]
      ),

      ("camp_vader_gmquest_1",
      [],
      "Setup_Grandmaster_quest_for_test_(part_1).",
      [
        (call_script, "script_end_quest", "qst_order_grandmaster"),
        (quest_set_slot, "qst_order_grandmaster", 11, 0),
        (troop_get_slot, ":var0", "trp_player", 162),
        (try_begin),
          (eq, ":var0", 0),
          (troop_set_slot, "trp_player", 162, "trp_lion_knight"),
          (assign, ":var0", "trp_lion_knight"),
        (try_end),
        (store_troop_faction, ":var1", ":var0"),
        (faction_set_slot, ":var1", 72, 6),
        (faction_set_slot, ":var1", 71, 300),
        (str_store_faction_name, s12, ":var1"),
        (display_message, "@GM quest ready: talk to the {s12} for a surprise.", 0x30FFC8),
        (change_screen_map),
      ]
      ),

      ("camp_vader_gmquest_2",
      [],
      "Setup_Grandmaster_quest_for_test_(part_2).",
      [
        (quest_get_slot, ":var0", "qst_order_grandmaster", 12),
        (assign, ":var1", 1000000),
        (assign, ":var2", -1),
        (store_add, ":var3", "p_stronghold_pos1", 6),
        (try_for_range, ":var4", "p_stronghold_pos1", ":var3"),
          (store_distance_to_party_from_party, ":var5", ":var0", ":var4"),
          (lt, ":var5", ":var1"),
          (assign, ":var1", ":var5"),
          (assign, ":var2", ":var4"),
        (try_end),
        (party_get_position, pos0, ":var2"),
        (party_set_position, "p_snake_stronghold", pos0),
        (assign, ":var1", 1000000),
        (assign, ":var6", -1),
        (try_for_range, ":var7", "p_town_1", "p_salt_mine"),
          (store_distance_to_party_from_party, ":var5", ":var7", "p_snake_stronghold"),
          (lt, ":var5", ":var1"),
          (assign, ":var1", ":var5"),
          (assign, ":var6", ":var7"),
        (try_end),
        (quest_set_slot, "qst_order_grandmaster", 1, ":var6"),
        (str_store_party_name, s8, ":var6"),
        (quest_set_slot, "qst_order_grandmaster", 11, 3),
        (str_store_string, s3, "@Report back to the Order with your findings about Cult activity near {s8}."),
        (add_quest_note_from_sreg, "qst_order_grandmaster", 2, s3, 0),
        (display_message, "str_quest_log_updated", 0x66CCFF),
      ]
      ),

      ("camp_vader_randorder1",
      [],
      "Generate_and_test_random_minor_Order.",
      [
        (call_script, "script_generate_minor_order", "p_castle_24"),
        (assign, ":var0", reg0),
        (faction_get_slot, ":var1", ":var0", 68),
        (party_force_add_members, "p_main_party", ":var1", 100),
        (str_store_faction_name, s12, ":var0"),
        (str_store_troop_name, s13, ":var1"),
        (display_message, "@Random order of the {s12} created in Kennet Castle. 100 {s13}s recruited.", 0x30FFC8),
        (change_screen_map),
      ]
      ),

      ("camp_vader_randorder2",
      [],
      "Generate_7_random_minor_Orders._(WARNING)",
      [
        (party_clear, "p_main_party"),
        (assign, ":var0", "p_castle_24"),
        (try_for_range, ":var1", 65, 72),
          (call_script, "script_generate_minor_order_knight", ":var0", ":var1"),
          (faction_get_slot, ":var2", ":var1", 68),
          (party_add_members, "p_main_party", ":var2", 5),
          (str_store_faction_name, s12, ":var1"),
          (str_store_troop_name, s13, ":var2"),
          (str_store_party_name, s14, ":var0"),
          (display_message, "@Random order of the {s12} created in {s14}. 5 {s13}s recruited.", 0x30FFC8),
          (val_add, ":var0", 1),
        (try_end),
        (change_screen_map),
      ]
      ),

      ("test_noldor_quest_complete",
      [],
      "Complete_the_Noldor_quest_(access_the_castle).",
      [
        (quest_set_slot, "qst_marauding_jatu", 11, 3),
        (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", 30),
        (display_message, "@Noldor castle accessible", 0x30FFC8),
        (display_message, "@Noldor relation set to 30", 0x30FFC8),
      ]
      ),

      ("camp_vader_cheat",
      [
        (try_begin),
          (eq, "$cheat_mode", 0),
          (str_store_string, s7, "@OFF"),
        (else_try),
          (eq, "$cheat_mode", 1),
          (str_store_string, s7, "@Standard"),
        (else_try),
          (eq, "$cheat_mode", 2),
          (str_store_string, s7, "@Special"),
        (else_try),
          (eq, "$cheat_mode", 3),
          (str_store_string, s7, "@Economy"),
        (else_try),
          (eq, "$cheat_mode", 4),
          (str_store_string, s7, "@Politics"),
        (else_try),
          (str_store_string, s7, "@ERROR"),
        (try_end),
      ],
      "Toggle_Native_cheat_mode:_{s7}",
      [
        (val_add, "$cheat_mode", 1),
        (try_begin),
          (eq, "$cheat_mode", 5),
          (assign, "$cheat_mode", 0),
        (try_end),
      ]
      ),

      ("camp_wait",
      [],
      "Fast_forward_for_200_days_(x50_speed).",
      [
        (assign, "$g_camp_mode", 1),
        (assign, "$g_infinite_camping", 1),
        (assign, "$g_player_icon_state", 1),
        (rest_for_hours_interactive, 4800, 50),
        (change_screen_return),
      ]
      ),

      ("camp_vader_comp",
      [],
      "Test_companion_conversations_...",
      [
        (jump_to_menu, "mnu_camp_companion"),
      ]
      ),

      ("rebuild_old_ruins",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (try_begin),
          (lt, ":var0", 30000),
          (disable_menu_option),
        (try_end),
      ],
      "Rebuild_Old_Ruins_for_30000_denars.",
      [
        (party_set_slot, "p_old_ruins", 10, "scn_abhuva_pendor_castle_2_base"),
        (party_set_slot, "p_old_ruins", 268, 1),
        (party_set_slot, "p_old_ruins", 270, 2),
        (party_set_flags, "p_old_ruins", 256, 0),
        (party_set_flags, "p_old_ruins", 2097152, 0),
        (assign, "$old_ruins_var", 0),
        (troop_remove_gold, "trp_player", 30000),
        (try_begin),
          (store_item_kind_count, ":var0", "itm_book_old_diary", "trp_bonus_chest_6"),
          (gt, ":var0", 0),
          (troop_remove_item, "trp_bonus_chest_6", "itm_book_old_diary"),
        (try_end),
      ]
      ),

      ("spawn_test_bandit_lairs",
      [],
      "Spawn_Test_Bandit_Lairs.",
      [
        (set_spawn_radius, 5),
        (try_for_range, ":var0", "pt_steppe_bandit_lair", "pt_bandit_lair_templates_end"),
          (spawn_around_party, "p_main_party", ":var0"),
          (assign, ":var1", reg0),
          (party_set_slot, ":var1", 0, 18),
          (party_set_flags, ":var1", 256, 1),
        (try_end),
      ]
      ),

      ("camp_vader_back",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_ownorder", 0,
    "Select an option:",
    "none",
    [],
    [
      ("join",
      [],
      "Join_Sarleon_and_take_over_Avendor.",
      [
        (call_script, "script_player_join_faction", "fac_kingdom_1"),
        (call_script, "script_give_center_to_lord", "p_town_16", "trp_player", 0),
        (call_script, "script_update_troop_notes", "trp_player"),
        (assign, "$player_has_homage", 1),
        (assign, "$g_player_banner_granted", 1),
        (troop_add_items, "trp_player", "itm_qualis", 3),
        (call_script, "script_change_player_honor", 100),
        (troop_add_gold, "trp_player", 20000),
      ]
      ),

      ("join2",
      [],
      "Join_Fierdsvain_and_take_over_Windholm.",
      [
        (call_script, "script_player_join_faction", "fac_kingdom_4"),
        (call_script, "script_give_center_to_lord", "p_town_12", "trp_player", 0),
        (call_script, "script_update_troop_notes", "trp_player"),
        (assign, "$player_has_homage", 1),
        (assign, "$g_player_banner_granted", 1),
        (troop_add_items, "trp_player", "itm_qualis", 3),
        (call_script, "script_change_player_honor", 100),
        (troop_add_gold, "trp_player", 20000),
      ]
      ),

      ("finish",
      [],
      "Finish_current_upgrades.",
      [
        (try_begin),
          (gt, "$g_pop_upgrade_knight_days", 0),
          (assign, "$g_pop_upgrade_knight_days", 0),
          (troop_set_inventory_slot, "trp_player_knight", "$g_pop_upgrade_knight_slot", "$g_pop_upgrade_knight_item"),
          (troop_set_inventory_slot, "trp_player_knight_save", "$g_pop_upgrade_knight_slot", "$g_pop_upgrade_knight_item"),
          (str_store_item_name_plural, s11, "$g_pop_upgrade_knight_item"),
          (str_store_troop_name_plural, s12, "trp_player_knight"),
          (display_message, "@Your {s12} have acquired new {s11}!"),
        (try_end),
        (try_begin),
          (gt, "$g_pop_upgrade_squire_days", 0),
          (assign, "$g_pop_upgrade_squire_days", 0),
          (troop_set_inventory_slot, "trp_player_sergeant", "$g_pop_upgrade_squire_slot", "$g_pop_upgrade_squire_item"),
          (troop_set_inventory_slot, "trp_player_sergeant_save", "$g_pop_upgrade_squire_slot", "$g_pop_upgrade_squire_item"),
          (str_store_item_name_plural, s11, "$g_pop_upgrade_squire_item"),
          (str_store_troop_name_plural, s12, "trp_player_sergeant"),
          (display_message, "@Your {s12} have acquired new {s11}!"),
        (try_end),
      ]
      ),

      ("give",
      [],
      "Give_me_Order_Knights_and_Squires.",
      [
        (party_add_members, "p_main_party", "trp_player_knight", 10),
        (party_add_members, "p_main_party", "trp_player_sergeant", 10),
        (display_message, "@10 Order Knights and 10 Order Squires joined the party"),
      ]
      ),

      ("back_to_test_menu",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_balance", 0,
    "Choose wisely:",
    "none",
    [],
    [
      ("lords",
      [],
      "Calculate_lord_strengths.",
      [
        (assign, ":var0", 0),
        (assign, ":var1", 0),
        (try_for_range, ":var2", "fac_kingdom_1", "fac_kingdoms_end"),
          (store_sub, ":var3", ":var2", "fac_kingdom_1"),
          (val_mul, ":var3", 20),
          (val_add, ":var3", "trp_knight_1_1"),
          (store_add, ":var4", ":var3", 20),
          (assign, ":var5", 0),
          (assign, ":var6", 0),
          (try_for_range, ":var7", ":var3", ":var4"),
            (troop_get_slot, ":var8", ":var7", 10),
            (party_is_active, ":var8"),
            (call_script, "script_party_calculate_strength", ":var8", 0),
            (str_store_troop_name, s4, ":var7"),
            (display_message, "@{s4}: {reg0}"),
            (val_add, ":var5", reg0),
            (val_add, ":var6", 1),
          (try_end),
          (val_add, ":var0", ":var5"),
          (val_add, ":var1", ":var6"),
          (str_store_faction_name, s9, ":var2"),
          (store_div, reg1, ":var5", ":var6"),
          (display_message, "@## {s9} average strength: {reg1}", 0x30FFC8),
        (try_end),
        (store_div, reg1, ":var0", ":var1"),
        (display_message, "@#### Overall average strength: {reg1}", 0x30FFC8),
      ]
      ),

      ("calcmercs",
      [],
      "Spawn_mercs_and_print_strength.",
      [
        (try_for_range, ":var0", "pt_player_merc_mettenheim", "pt_player_merc_cheaters"),
          (neq, ":var0", "pt_player_merc_mettenheim_2"),
          (neq, ":var0", "pt_player_merc_red_brotherhood_2"),
          (spawn_around_party, "p_main_party", ":var0"),
          (assign, ":var1", reg0),
          (try_begin),
            (this_or_next|eq, ":var0", "pt_player_merc_mettenheim"),
            (eq, ":var0", "pt_player_merc_red_brotherhood"),
            (val_add, ":var0", 1),
            (party_add_template, ":var1", ":var0"),
          (try_end),
          (call_script, "script_party_calculate_strength", ":var1", 0),
          (str_store_party_name, s4, ":var1"),
          (display_message, "@{s4}: strength {reg0}", 0x30FFC8),
        (try_end),
      ]
      ),

      ("limits0",
      [],
      "Set_template_limits_to_0.",
      [
        (set_party_creation_random_limits, 0, 0),
        (display_message, "@Limits set to 0-0!", 0x30FFC8),
      ]
      ),

      ("limits50",
      [],
      "Set_template_limits_to_50.",
      [
        (set_party_creation_random_limits, 50, 50),
        (display_message, "@Limits set to 50-50!", 0x30FFC8),
      ]
      ),

      ("limits100",
      [],
      "Set_template_limits_to_100.",
      [
        (set_party_creation_random_limits, 100, 100),
        (display_message, "@Limits set to 100-100!", 0x30FFC8),
      ]
      ),

      ("back_to_test_menu",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_hostile_party", 0,
    "Choosen troop:{s4} ({reg4})",
    "none",
    [
      (val_clamp, "$temp", "trp_farmer", "trp_town_walker_1"),
      (str_store_troop_name, s4, "$temp"),
      (assign, reg4, "$temp"),
    ],
    [
      ("add1",
      [],
      "Increase_by_1",
      [
        (val_add, "$temp", 1),
      ]
      ),

      ("add2",
      [],
      "Increase_by_10",
      [
        (val_add, "$temp", 10),
      ]
      ),

      ("add3",
      [],
      "Increase_by_100",
      [
        (val_add, "$temp", 100),
      ]
      ),

      ("rem1",
      [],
      "Decrease_by_1",
      [
        (val_sub, "$temp", 1),
      ]
      ),

      ("rem2",
      [],
      "Decrease_by_10",
      [
        (val_sub, "$temp", 10),
      ]
      ),

      ("rem3",
      [],
      "Decrease_by_100",
      [
        (val_sub, "$temp", 100),
      ]
      ),

      ("spawn",
      [],
      "Spawn_a_party_with_100_troops!",
      [
        (spawn_around_party, "p_main_party", "pt_none"),
        (assign, ":var0", reg0),
        (party_add_members, ":var0", "$temp", 100),
        (party_set_faction, ":var0", "fac_outlaws"),
        (party_set_name, ":var0", "@The Hundred"),
        (display_message, "@The Hundred are upon you!", 0x30FFC8),
        (change_screen_return),
      ]
      ),

      ("back_to_test_menu",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_quests35", 0,
    "Select an option:",
    "none",
    [],
    [
      ("tavern_assassin",
      [],
      "Tavern_Assassin",
      [
        (set_show_messages, 0),
        (try_for_range, ":var0", "trp_knight_1_1", "trp_kingdom_1_pretender"),
          (call_script, "script_troop_change_relation_with_troop", "trp_player", ":var0", -40),
          (troop_set_slot, ":var0", 52, 5),
        (try_end),
        (try_for_range, ":var1", "fac_dragon_knights", "fac_noldor_castle"),
          (call_script, "script_change_player_relation_with_faction", ":var1", -40),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@You have now made enemies with all lords and all orders... visit some taverns now... ", 0x30FFC8),
        (change_screen_return),
      ]
      ),

      ("rescue_daughter",
      [],
      "Rescue_daughter",
      [
        (call_script, "script_end_quest", "qst_rescue_daughter"),
        (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var0", 40, 0),
          (party_set_slot, ":var0", 40, "trp_knight_1_5"),
        (try_end),
        (try_for_range, ":var1", "qst_deliver_grain", "qst_eliminate_bandits_infesting_village"),
          (quest_set_slot, ":var1", 25, 10),
        (try_end),
        (quest_set_slot, "qst_rescue_daughter", 25, 0),
        (display_message, "@Daughter waiting to be rescued, talk to a village elder.", 0x30FFC8),
        (change_screen_return),
      ]
      ),

      ("escort_peasants",
      [],
      "Escort_peasants",
      [
        (call_script, "script_end_quest", "qst_escort_peasants"),
        (try_for_range, ":var0", "qst_deliver_grain", "qst_eliminate_bandits_infesting_village"),
          (quest_set_slot, ":var0", 25, 10),
        (try_end),
        (quest_set_slot, "qst_escort_peasants", 25, 0),
        (display_message, "@Peasants waiting to be escorted, talk to a village elder.", 0x30FFC8),
        (change_screen_return),
      ]
      ),

      ("order_bounty",
      [],
      "Order_bounty_hunting",
      [
        (call_script, "script_end_quest", "qst_order_bounty"),
        (quest_set_slot, "qst_order_bounty", 25, 0),
        (display_message, "@Bounties await, talk to a friendly Order guard.", 0x30FFC8),
        (change_screen_return),
      ]
      ),

      ("back_to_test_menu",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_economy", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_economy_listcenters",
      [],
      "List_all_centers",
      [
        (jump_to_menu, "mnu_camp_economy_view"),
      ]
      ),

      ("camp_economy_listprices",
      [],
      "List_average_prices",
      [
        (jump_to_menu, "mnu_camp_economy_prices"),
      ]
      ),

      ("camp_economy_centergoods",
      [],
      "View_data_on_the_nearest_center",
      [
        (jump_to_menu, "mnu_camp_economy_center"),
      ]
      ),

      ("camp_economy_market_towns",
      [],
      "View_market_towns",
      [
        (jump_to_menu, "mnu_camp_economy_markets"),
      ]
      ),

      ("camp_economy_centerresetall",
      [],
      "Reset_all_prices_to_1000",
      [
        (try_for_range, ":var0", "itm_spice", "itm_baggage_train"),
          (store_sub, ":var1", ":var0", "itm_spice"),
          (val_add, ":var1", 301),
          (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
            (party_set_slot, ":var2", ":var1", 1000),
          (try_end),
        (try_end),
        (display_message, "@Prices reset."),
      ]
      ),

      ("camp_economy_cycle",
      [],
      "Update_cycle_for_all_trade_goods_prices",
      [
        (assign, ":var0", 1000000),
        (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
          (party_get_position, pos1, ":var1"),
          (store_distance_to_party_from_party, ":var2", ":var1", "p_main_party"),
          (try_begin),
            (lt, ":var2", ":var0"),
            (assign, ":var0", ":var2"),
            (assign, ":var3", ":var1"),
          (try_end),
        (try_end),
        (store_sub, ":var4", "itm_grain", "itm_spice"),
        (val_add, ":var4", 301),
        (store_sub, ":var5", "itm_bread", "itm_spice"),
        (val_add, ":var5", 301),
        (party_get_slot, ":var6", ":var3", ":var4"),
        (party_get_slot, ":var7", ":var3", ":var5"),
        (call_script, "script_update_trade_good_prices"),
        (party_get_slot, ":var8", ":var3", ":var4"),
        (party_get_slot, ":var9", ":var3", ":var5"),
        (call_script, "script_update_trade_good_prices"),
        (party_get_slot, ":var10", ":var3", ":var4"),
        (party_get_slot, ":var11", ":var3", ":var5"),
        (call_script, "script_update_trade_good_prices"),
        (party_get_slot, ":var12", ":var3", ":var4"),
        (party_get_slot, ":var13", ":var3", ":var5"),
        (call_script, "script_average_trade_good_prices"),
        (party_get_slot, ":var14", ":var3", ":var4"),
        (party_get_slot, ":var15", ":var3", ":var5"),
        (call_script, "script_average_trade_good_prices"),
        (party_get_slot, ":var16", ":var3", ":var4"),
        (party_get_slot, ":var17", ":var3", ":var5"),
        (str_store_party_name, s4, ":var3"),
        (assign, reg1, ":var6"),
        (assign, reg2, ":var8"),
        (assign, reg3, ":var10"),
        (assign, reg4, ":var12"),
        (assign, reg5, ":var14"),
        (assign, reg6, ":var16"),
        (display_message, "@Grain price in {s4}: {reg1} U {reg2} {reg3} {reg4} A {reg5} {reg6}."),
        (assign, reg1, ":var7"),
        (assign, reg2, ":var9"),
        (assign, reg3, ":var11"),
        (assign, reg4, ":var13"),
        (assign, reg5, ":var15"),
        (assign, reg6, ":var17"),
        (display_message, "@Bread price in {s4}: {reg1} U {reg2} {reg3} {reg4} A {reg5} {reg6}."),
      ]
      ),

      ("camp_economy_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_economy_markets", 0,
    "{s2}",
    "none",
    [
      (str_store_string, s2, "@Villages per town: market (bound)^"),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1", "p_castle_1"),
        (assign, ":var3", 0),
        (assign, ":var4", 0),
        (try_for_range, ":var5", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var5", 121, ":var2"),
          (val_add, ":var3", 1),
          (val_add, ":var0", 1),
          (party_slot_eq, ":var5", 120, ":var2"),
          (val_add, ":var4", 1),
          (val_add, ":var1", 1),
        (try_end),
        (assign, reg1, ":var3"),
        (assign, reg2, ":var4"),
        (str_store_party_name, s5, ":var2"),
        (str_store_string, s2, "@{s2}^{s5}: {reg1} ({reg2})"),
      (try_end),
      (val_add, ":var1", "p_village_1"),
      (val_sub, ":var1", "p_castle_1"),
      (assign, reg1, ":var0"),
      (assign, reg2, ":var1"),
      (str_store_string, s2, "@{s2}^^Total villages: {reg1} (Bound: {reg2})"),
    ],
    [
      ("back_to_econ_menu",
      [],
      "Back_to_economy_menu.",
      [
        (jump_to_menu, "mnu_camp_economy"),
      ]
      ),
    ],
  ),

  ("camp_economy_center", 0,
    "{s2}",
    "none",
    [
      (assign, ":var0", 1000000),
      (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
        (party_get_position, pos1, ":var1"),
        (store_distance_to_party_from_party, ":var2", ":var1", "p_main_party"),
        (try_begin),
          (lt, ":var2", ":var0"),
          (assign, ":var0", ":var2"),
          (assign, ":var3", ":var1"),
        (try_end),
      (try_end),
      (str_clear, s2),
      (assign, ":var4", 0),
      (try_for_range, ":var5", "itm_spice", "itm_baggage_train"),
        (try_begin),
          (is_between, ":var3", "p_village_1", "p_salt_mine"),
          (item_get_slot, ":var6", ":var5", 12),
        (else_try),
          (item_get_slot, ":var6", ":var5", 11),
        (try_end),
        (try_begin),
          (gt, ":var6", 2),
          (store_div, ":var7", ":var6", 3),
        (else_try),
          (assign, ":var7", 0),
        (try_end),
        (store_sub, ":var8", ":var5", "itm_spice"),
        (val_add, ":var8", 301),
        (party_get_slot, ":var9", ":var3", ":var8"),
        (store_sub, ":var10", ":var9", 950),
        (try_begin),
          (gt, ":var10", 100),
          (val_div, ":var10", 100),
          (val_min, ":var10", ":var7"),
        (else_try),
          (assign, ":var10", 0),
        (try_end),
        (call_script, "script_center_get_production", ":var3", ":var5"),
        (assign, reg3, reg0),
        (call_script, "script_center_get_consumption", ":var3", ":var5"),
        (assign, reg4, reg0),
        (assign, reg5, ":var9"),
        (str_store_item_name, s10, ":var5"),
        (assign, reg6, ":var10"),
        (str_store_string, s2, "@{s2}^{s10}: {reg6} (Prod:{reg3}/{reg4} Price:{reg5})"),
        (val_add, ":var4", ":var10"),
      (try_end),
      (str_store_string, s3, "@."),
      (try_begin),
        (is_between, ":var3", "p_town_1", "p_castle_1"),
        (try_for_range, ":var11", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var11", 121, ":var3"),
          (str_store_party_name, s5, ":var11"),
          (str_store_string, s3, "@{s5} {s3}"),
        (try_end),
      (try_end),
      (call_script, "script_center_get_goods_availability", ":var3"),
      (assign, reg3, reg0),
      (call_script, "script_get_center_ideal_prosperity", ":var3"),
      (assign, reg4, reg0),
      (party_get_slot, reg1, ":var3", 290),
      (party_get_slot, reg2, ":var3", 50),
      (call_script, "script_get_prosperity_text_to_s50", ":var3"),
      (str_store_party_name, s4, ":var3"),
      (str_store_string, s2, "@Report for {s4}:^Economy: {reg1}^Prosperity: {reg2}[{reg4}] {s50}^Hardship: {reg3}^Market villages: {s3}^{s2}"),
    ],
    [
      ("back_to_econ_menu",
      [],
      "Back_to_economy_menu.",
      [
        (jump_to_menu, "mnu_camp_economy"),
      ]
      ),
    ],
  ),

  ("camp_economy_view", 0,
    "{s2}",
    "none",
    [
      (str_clear, s2),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (try_begin),
          (this_or_next|eq, ":var0", "p_castle_1"),
          (eq, ":var0", "p_village_1"),
          (str_store_string, s2, "@{s2}^"),
        (try_end),
        (call_script, "script_center_get_goods_availability", ":var0"),
        (assign, reg3, reg0),
        (call_script, "script_get_center_ideal_prosperity", ":var0"),
        (assign, reg4, reg0),
        (party_get_slot, reg1, ":var0", 290),
        (party_get_slot, reg2, ":var0", 50),
        (str_store_party_name, s4, ":var0"),
        (str_store_string, s2, "@{s2}^{s4}: E: {reg1} P: {reg2}[{reg4}] H: {reg3}"),
      (try_end),
      (str_store_string, s2, "@The current fief income is: ^{s2}"),
    ],
    [
      ("back_to_econ_menu",
      [],
      "Back_to_economy_menu.",
      [
        (jump_to_menu, "mnu_camp_economy"),
      ]
      ),
    ],
  ),

  ("camp_economy_prices", 0,
    "{s2}",
    "none",
    [
      (str_store_string, s2, "@Average prices in Pendor [Prod/Cons]^"),
      (try_for_range, ":var0", "itm_spice", "itm_baggage_train"),
        (store_sub, ":var1", ":var0", "itm_spice"),
        (val_add, ":var1", 301),
        (assign, ":var2", 0),
        (assign, ":var3", 0),
        (assign, ":var4", 0),
        (assign, ":var5", 0),
        (try_for_range, ":var6", "p_town_1", "p_salt_mine"),
          (neg|is_between, ":var6", "p_castle_1", "p_village_1"),
          (val_add, ":var2", 1),
          (call_script, "script_center_get_production", ":var6", ":var0"),
          (assign, ":var7", reg2),
          (call_script, "script_center_get_consumption", ":var6", ":var0"),
          (store_add, ":var8", reg1, reg2),
          (party_get_slot, ":var9", ":var6", ":var1"),
          (val_add, ":var3", ":var9"),
          (val_add, ":var4", ":var7"),
          (val_add, ":var5", ":var8"),
        (try_end),
        (assign, ":var10", ":var4"),
        (assign, ":var11", ":var5"),
        (val_div, ":var3", ":var2"),
        (assign, reg6, ":var3"),
        (assign, reg12, ":var10"),
        (assign, reg13, ":var11"),
        (str_store_item_name, s10, ":var0"),
        (str_store_string, s2, "@{s2}^{s10}: {reg6} [{reg12}/{reg13}]"),
      (try_end),
    ],
    [
      ("back_to_econ_menu",
      [],
      "Back_to_economy_menu.",
      [
        (jump_to_menu, "mnu_camp_economy"),
      ]
      ),
    ],
  ),

  ("camp_noldor", 0,
    "Select an option:",
    "none",
    [],
    [
      ("test_noldor_friend",
      [],
      "Make_me_a_Noldor_friend_(30)",
      [
        (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", 30),
        (display_message, "@Noldor relations set to 30.", 0x30FFC8),
      ]
      ),

      ("test_noldor_friend2",
      [],
      "Make_me_a_Noldor_supporter_(15)_-_enables_the_quest",
      [
        (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", 15),
        (display_message, "@Noldor relations set to 15.", 0x30FFC8),
      ]
      ),

      ("test_noldor_enemy",
      [],
      "Make_me_a_Noldor_enemy_(-10)",
      [
        (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", -10),
        (display_message, "@Noldor relations set to -10.", 0x30FFC8),
      ]
      ),

      ("test_noldor_quest_complete",
      [],
      "Complete_the_Noldor_quest_(access_the_castle).",
      [
        (quest_set_slot, "qst_marauding_jatu", 11, 3),
        (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", 30),
        (display_message, "@Noldor castle accessible.", 0x30FFC8),
      ]
      ),

      ("test_noldor_quest_reset",
      [],
      "Reset_the_Noldor_quest",
      [
        (quest_set_slot, "qst_marauding_jatu", 11, 0),
        (display_message, "@Noldor quest reset.", 0x30FFC8),
      ]
      ),

      ("test_noldor_tournament",
      [],
      "Start_a_Noldor_tournament",
      [
        (party_set_slot, "p_castle_noldor", 156, 1),
        (display_message, "@Noldor tournament started.", 0x30FFC8),
      ]
      ),

      ("test_noldor_trader",
      [],
      "Regenerate_merchant_inventory.",
      [
        (try_for_range, ":var0", 0, 7),
          (reset_item_probabilities, 100),
          (set_merchandise_modifier_quality, 150),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_warrior", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_warrior", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_ranger", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_ranger", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_noble", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_maiden", 300),
          (troop_loot_troop, "trp_noldor_merchant", "trp_noldor_knight", 300),
          (troop_get_inventory_capacity, ":var1", "trp_noldor_merchant"),
          (try_for_range, ":var2", 0, ":var1"),
            (troop_get_inventory_slot, ":var3", "trp_noldor_merchant", ":var2"),
            (ge, ":var3", 0),
            (try_begin),
              (this_or_next|eq, ":var3", "itm_loot"),
              (eq, ":var3", "itm_noldor_goods"),
              (troop_set_inventory_slot, "trp_noldor_merchant", ":var2", -1),
            (try_end),
          (try_end),
          (troop_ensure_inventory_space, "trp_noldor_merchant", 30),
          (troop_sort_inventory, "trp_noldor_merchant"),
          (store_troop_gold, reg6, "trp_noldor_merchant"),
          (lt, reg6, 900),
          (store_random_in_range, ":var4", 2800, 5000),
          (call_script, "script_troop_add_gold", "trp_noldor_merchant", ":var4"),
        (try_end),
        (display_message, "@One week's worth of new inventory added", 0x30FFC8),
      ]
      ),

      ("test_noldor_prize",
      [],
      "Give_me_a_Noldor_prize!",
      [
        (str_clear, s8),
        (store_random_in_range, ":var0", 0, 100),
        (store_random_in_range, ":var1", 0, 100),
        (store_random_in_range, ":var2", 0, 100),
        (assign, ":var3", 0),
        (try_begin),
          (lt, ":var0", 20),
          (assign, ":var4", "itm_qualis"),
        (else_try),
          (lt, ":var0", 40),
          (try_begin),
            (lt, ":var1", 50),
            (assign, ":var4", "itm_noldor_longsword"),
          (else_try),
            (lt, ":var1", 80),
            (assign, ":var4", "itm_noldor_runesword"),
          (else_try),
            (assign, ":var4", "itm_noldor_bastard"),
          (try_end),
          (try_begin),
            (lt, ":var2", 50),
            (assign, ":var3", 10),
          (else_try),
            (lt, ":var2", 70),
            (assign, ":var3", 13),
          (else_try),
            (lt, ":var2", 90),
            (assign, ":var3", 14),
          (else_try),
            (assign, ":var3", 17),
          (try_end),
        (else_try),
          (lt, ":var0", 50),
          (assign, ":var4", "itm_noldor_bow"),
          (try_begin),
            (lt, ":var2", 10),
            (assign, ":var3", 17),
          (try_end),
        (else_try),
          (lt, ":var0", 80),
          (try_begin),
            (lt, ":var1", 5),
            (assign, ":var4", "itm_noldor_leather_gloves"),
          (else_try),
            (lt, ":var1", 10),
            (assign, ":var4", "itm_noldor_silver_gauntlets"),
          (else_try),
            (lt, ":var1", 15),
            (assign, ":var4", "itm_noldor_inf_helm"),
          (else_try),
            (lt, ":var1", 20),
            (assign, ":var4", "itm_noldor_capt_helm"),
          (else_try),
            (lt, ":var1", 25),
            (assign, ":var4", "itm_noldor_knight_helm"),
          (else_try),
            (lt, ":var1", 30),
            (assign, ":var4", "itm_noldor_noble_armor"),
          (else_try),
            (lt, ":var1", 35),
            (assign, ":var4", "itm_noldor_ranger_garb"),
          (else_try),
            (lt, ":var1", 50),
            (assign, ":var4", "itm_noldor_archer_garb"),
          (else_try),
            (lt, ":var1", 65),
            (assign, ":var4", "itm_noldor_female_armor"),
          (else_try),
            (lt, ":var1", 75),
            (assign, ":var4", "itm_noldor_rune_armor"),
          (else_try),
            (lt, ":var1", 80),
            (assign, ":var4", "itm_noldor_ancient_plate"),
          (else_try),
            (lt, ":var1", 85),
            (assign, ":var4", "itm_noldor_plate_greaves"),
          (else_try),
            (assign, ":var4", "itm_noldor_boots"),
          (try_end),
          (try_begin),
            (lt, ":var2", 60),
            (assign, ":var3", 25),
          (else_try),
            (lt, ":var2", 90),
            (assign, ":var3", 27),
          (else_try),
            (assign, ":var3", 29),
          (try_end),
          (try_begin),
            (this_or_next|eq, ":var4", "itm_noldor_leather_gloves"),
            (eq, ":var4", "itm_noldor_boots"),
            (try_begin),
              (eq, ":var3", 27),
              (assign, ":var3", 24),
            (else_try),
              (eq, ":var3", 29),
              (assign, ":var3", 26),
            (try_end),
          (try_end),
        (else_try),
          (try_begin),
            (lt, ":var1", 20),
            (assign, ":var4", "itm_noldor_grey_horse"),
          (else_try),
            (lt, ":var1", 40),
            (assign, ":var4", "itm_noldor_dark_horse"),
          (else_try),
            (lt, ":var1", 60),
            (assign, ":var4", "itm_noldor_gold_horse"),
          (else_try),
            (lt, ":var1", 90),
            (assign, ":var4", "itm_noldor_pony_horse"),
          (else_try),
            (assign, ":var4", "itm_noldor_spirit_horse"),
          (try_end),
          (try_begin),
            (lt, ":var2", 30),
            (assign, ":var3", 35),
          (else_try),
            (lt, ":var2", 60),
            (assign, ":var3", 18),
          (else_try),
            (lt, ":var2", 90),
            (assign, ":var3", 32),
          (else_try),
            (assign, ":var3", 36),
          (try_end),
        (try_end),
        (troop_add_item, "trp_player", ":var4", ":var3"),
        (str_store_item_name, s21, ":var4"),
        (str_store_string, s8, "@You have been presented with an exquisite {s21} from the Noldor Council."),
        (display_message, "@{s8}", 0x30FFC8),
      ]
      ),

      ("camp_noldor_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("test_heartbeat", 0,
    "Select an option:",
    "none",
    [],
    [
      ("test_heartbeat_generate",
      [],
      "Generate_heartbeat_quest",
      [
        (call_script, "script_get_number_of_hero_centers", "trp_player"),
        (assign, ":var0", reg0),
        (try_begin),
          (gt, ":var0", 0),
          (store_random_in_range, ":var1", 0, ":var0"),
          (call_script, "script_troop_get_leaded_center_with_index", "trp_player", ":var1"),
          (assign, ":var2", reg0),
          (store_random_in_range, ":var3", 1, 14),
          (party_set_slot, ":var2", 296, ":var3"),
          (call_script, "script_add_notification_menu", "mnu_heartbeat_quest", ":var2", 0),
          (assign, reg0, ":var3"),
          (str_store_party_name, s4, ":var2"),
          (display_message, "@Generated quest #{reg0} in {s4} - notification pending"),
        (try_end),
      ]
      ),

      ("camp_heartbeat_back",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_achieve", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_achieve_all",
      [],
      "Give_me_all_achievements",
      [
        (assign, "$g_achieve_bitfield", 268435455),
        (display_message, "@All achievements given. Check report."),
      ]
      ),

      ("camp_achieve_none",
      [],
      "Clear_all_achievements",
      [
        (assign, "$g_achieve_bitfield", 0),
        (assign, "$g_achieve_bits_delay_popup", 0),
        (display_message, "@All achievements cleared."),
      ]
      ),

      ("camp_achieve_notify",
      [],
      "Review_all_notifications",
      [
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kill_battle", 0),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kills_1", 1),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_kills_2", 2),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_vic_1", 3),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_vic_2", 4),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heroes_1", 5),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heroes_2", 6),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_mysts", 7),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_snakes", 8),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_jatu", 9),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_heretics", 10),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_tour_1", 11),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_tour_2", 12),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_rnwn_1", 13),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_rnwn_2", 14),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_honor", 15),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_king", 16),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_persuader", 17),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_builder", 18),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_quests", 19),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_fquests", 20),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_captured", 21),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_caravan", 22),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_village", 23),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_cheater", 24),
        (call_script, "script_add_notification_menu", "mnu_achievement_notify", "str_achieve_gm", 25),
        (display_message, "@Notifications queued. Should trigger anytime now."),
        (change_screen_map),
      ]
      ),

      ("camp_achieve_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_honor", 0,
    "Select an option:",
    "none",
    [
      (eq, "$cheat_mode", 1),
    ],
    [
      ("camp_honor_kotd",
      [],
      "Give_me_10_Dragon_troops",
      [
        (party_add_members, "p_main_party", "trp_dragon_drake", 5),
        (party_add_members, "p_main_party", "trp_dragon_knight", 5),
        (display_message, "@10 Dragon troops joined the party"),
      ]
      ),

      ("camp_honor_kol",
      [],
      "Give_me_10_Lion_troops",
      [
        (party_add_members, "p_main_party", "trp_lion_squire", 5),
        (party_add_members, "p_main_party", "trp_lion_knight", 5),
        (display_message, "@10 Squires of the Lion joined the party"),
      ]
      ),

      ("camp_honor_ei",
      [],
      "Give_me_10_Empire_Mortals",
      [
        (party_add_members, "p_main_party", "trp_empire_mortal", 5),
        (party_add_members, "p_main_party", "trp_empire_immortal", 5),
        (display_message, "@10 Empire Mortals joined the party"),
      ]
      ),

      ("camp_honor_dsw",
      [],
      "Give_me_10_D'Shar_Dustriders",
      [
        (party_add_members, "p_main_party", "trp_dshar_dustrider", 10),
        (display_message, "@10 D'Shar Dustriders joined the party"),
      ]
      ),

      ("camp_honor_lv",
      [],
      "Give_me_10_Lady_Einherjar",
      [
        (party_add_members, "p_main_party", "trp_lady_einherjar", 10),
        (display_message, "@10 Lady Einherjar joined the party"),
      ]
      ),

      ("camp_honor_kotg",
      [],
      "Give_me_10_Knights_of_the_Griffon",
      [
        (party_add_members, "p_main_party", "trp_griffon_knight", 10),
        (display_message, "@10 Knights of the Griffon joined the party"),
      ]
      ),

      ("camp_honor_kotf",
      [],
      "Give_me_10_Knights_and_Talons_of_the_Falcon",
      [
        (party_add_members, "p_main_party", "trp_falcon_talon", 10),
        (party_add_members, "p_main_party", "trp_falcon_knight", 10),
        (display_message, "@10 Knights and Talons of the Falcon joined the party"),
      ]
      ),

      ("camp_honor_kors",
      [],
      "Give_me_10_Ravenspear_Knights",
      [
        (party_add_members, "p_main_party", "trp_raven_spear_knight", 10),
        (display_message, "@10 Ravenspear knights joined the party"),
      ]
      ),

      ("camp_honor_korc",
      [],
      "Give_me_10_Radiant_Cross_Knights",
      [
        (party_add_members, "p_main_party", "trp_radiant_cross_knight", 10),
        (display_message, "@10 Radiant Cross Knights joined the party"),
      ]
      ),

      ("camp_honor_rocc",
      [],
      "Give_me_10_Rangers_of_the_Clarion_Call",
      [
        (party_add_members, "p_main_party", "trp_clarion_ranger", 10),
        (display_message, "@10 Rangers of the Clarion Call joined the party"),
      ]
      ),

      ("camp_honor_kotdw",
      [],
      "Give_me_10_Knight_of_the_Dawn",
      [
        (party_add_members, "p_main_party", "trp_dawn_knight", 10),
        (display_message, "@10 Knights of the Dawn joined the party"),
      ]
      ),

      ("camp_honor_koteg",
      [],
      "Give_me_10_Knights_of_the_Ebony_Gauntlet",
      [
        (party_add_members, "p_main_party", "trp_ebony_gauntlet", 10),
        (display_message, "@10 Knights of the Ebony Gauntlet joined the party"),
      ]
      ),

      ("camp_honor_slc",
      [],
      "Give_me_10_Shadow_Legion_Marinae",
      [
        (party_add_members, "p_main_party", "trp_shadow_marinus", 10),
        (display_message, "@10 Shadow Legion Marinae joined the party"),
      ]
      ),

      ("camp_honor_sr",
      [],
      "Give_me_10_Silvermist_Rangers",
      [
        (party_add_members, "p_main_party", "trp_silvermist_ranger", 10),
        (display_message, "@10 Silvermist Rangers joined the party"),
      ]
      ),

      ("camp_honor_koe",
      [],
      "Give_me_10_Knights_of_Eventide_(and_ghost_lady)",
      [
        (party_add_members, "p_main_party", "trp_eventide_knight", 10),
        (display_message, "@10 Knights of Eventide joined the party"),
        (party_add_members, "p_main_party", "trp_ghost_quest_ghost_lady", 1),
        (display_message, "@Added Ghost Lady"),
      ]
      ),

      ("camp_honor_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_cool", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_cool_ha",
      [],
      "Give_me_100_Heroine_Adventurers",
      [
        (party_add_members, "p_main_party", "trp_heroine_adventurer", 100),
        (display_message, "@100 Heroine Adventurers joined the party"),
      ]
      ),

      ("camp_cool_ham",
      [],
      "Give_me_100_Hero_Adventurers",
      [
        (party_add_members, "p_main_party", "trp_hero_adventurer", 100),
        (display_message, "@100 Hero Adventurers joined the party"),
      ]
      ),

      ("camp_cool_jmr",
      [],
      "Give_me_100_Jatu_Mercenary_Riders",
      [
        (party_add_members, "p_main_party", "trp_jatu_merc", 100),
        (display_message, "@100 Jatu Mercenary Riders joined the party"),
      ]
      ),

      ("camp_cool_mhc",
      [],
      "Give_me_100_Marleons_Heavy_Cavalry",
      [
        (party_add_members, "p_main_party", "trp_marleons_cavalry", 100),
        (display_message, "@100 Marleons Heavy Cavalry joined the party"),
      ]
      ),

      ("camp_cool_rkk",
      [],
      "Give_me_100_Ravenstern_Highlanders",
      [
        (party_add_members, "p_main_party", "trp_rav_highlander", 100),
        (display_message, "@100 Ravenstern Highlanders joined the party"),
      ]
      ),

      ("camp_cool_dda",
      [],
      "Give_me_100_D'Shar_Djaha_Archers",
      [
        (party_add_members, "p_main_party", "trp_dshar_djaha", 100),
        (display_message, "@100 D'Shar Djaha Archers joined the party"),
      ]
      ),

      ("camp_cool_fb",
      [],
      "Give_me_100_Fierdsvain_Berserkers",
      [
        (party_add_members, "p_main_party", "trp_fierd_berserker", 100),
        (display_message, "@100 Fierdsvain Berserkers joined the party"),
      ]
      ),

      ("camp_cool_ntk",
      [],
      "Give_me_100_Noldor_Twilight_Knights",
      [
        (party_add_members, "p_main_party", "trp_noldor_knight", 100),
        (display_message, "@100 Noldor Twilight Knights joined the party"),
      ]
      ),

      ("camp_cool_nmr",
      [],
      "Give_me_100_Noldor_Maiden_Rangers",
      [
        (party_add_members, "p_main_party", "trp_noldor_maiden", 100),
        (display_message, "@100 Noldor Maiden Rangers joined the party"),
      ]
      ),

      ("camp_cool_nr",
      [],
      "Give_me_100_Noldor_Rangers",
      [
        (party_add_members, "p_main_party", "trp_noldor_ranger", 100),
        (display_message, "@100 Noldor Rangers joined the party"),
      ]
      ),

      ("camp_cool_kjk",
      [],
      "Give_me_100_K'Juda's_Kajahars",
      [
        (party_add_members, "p_main_party", "trp_kjuda_kajahar", 100),
        (display_message, "@100 K'Juda's Kajahars joined the party"),
      ]
      ),

      ("camp_cool_dg",
      [],
      "Give_me_100_Doomguides",
      [
        (party_add_members, "p_main_party", "trp_doomguide", 100),
        (display_message, "@100 Doomguides joined the party"),
      ]
      ),

      ("camp_cool_os",
      [],
      "Give_me_100_Omen_Seekers",
      [
        (party_add_members, "p_main_party", "trp_omen_seeker", 100),
        (display_message, "@100 Omen Seekers joined the party"),
      ]
      ),

      ("camp_cool_more",
      [],
      "More_cool_troops...",
      [
        (jump_to_menu, "mnu_camp_cool2"),
      ]
      ),

      ("camp_cool_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_cool2", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_cool_05",
      [],
      "Give_me_a_Specialty_Troop",
      [
        (party_add_members, "p_main_party", "trp_dshar_djaha", 1),
        (party_add_members, "p_main_party", "trp_valdis_huscarl", 1),
        (party_add_members, "p_main_party", "trp_empire_knight", 1),
        (party_add_members, "p_main_party", "trp_marleons_cavalry", 1),
        (party_add_members, "p_main_party", "trp_empire_guardian_knight", 1),
        (display_message, "@A specialty troop has joined the party"),
      ]
      ),

      ("camp_cool2_dli",
      [],
      "Give_me_100_Dread_Legion_Infantry",
      [
        (party_add_members, "p_main_party", "trp_dread_infantry", 100),
        (display_message, "@100 Dread Legion Infantry joined the party"),
      ]
      ),

      ("camp_cool2_ak",
      [],
      "Give_me_100_Anaconda_Knights",
      [
        (party_add_members, "p_main_party", "trp_anaconda_knight", 100),
        (display_message, "@100 Anaconda Knights joined the party"),
      ]
      ),

      ("camp_cool2_fr",
      [],
      "Give_me_100_Fallen_Revenants",
      [
        (party_add_members, "p_main_party", "trp_fallen_revenant", 100),
        (display_message, "@100 Fallen Revenants joined the party"),
      ]
      ),

      ("camp_cool2_dm",
      [],
      "Give_me_100_Demonic_Magni",
      [
        (party_add_members, "p_main_party", "trp_demonic_magnus", 100),
        (display_message, "@100 Demonic Magni joined the party"),
      ]
      ),

      ("camp_cool2_hm",
      [],
      "Give_me_100_Heretic_Invokers",
      [
        (party_add_members, "p_main_party", "trp_heretic_invoker", 100),
        (display_message, "@100 Heretic Invokers joined the party"),
      ]
      ),

      ("camp_cool2_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_regular", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_regular_Mettenheim",
      [],
      "Give_me_a_Mettenheim_troops",
      [
        (party_add_members, "p_main_party", "trp_mett_avonteurer", 4),
        (party_add_members, "p_main_party", "trp_mett_infantry", 5),
        (party_add_members, "p_main_party", "trp_mett_crossbow", 5),
        (party_add_members, "p_main_party", "trp_mett_heavy_crossbow", 3),
        (party_add_members, "p_main_party", "trp_mett_spieszknecht", 3),
        (party_add_members, "p_main_party", "trp_mett_greatsword", 3),
        (party_add_members, "p_main_party", "trp_mett_hauptmann", 2),
        (party_add_members, "p_main_party", "trp_mett_forlorn", 2),
        (display_message, "@A Mettenheim company has joined your party"),
      ]
      ),

      ("camp_regular_Barclay",
      [],
      "Give_me_Barclay_troops",
      [
        (party_add_members, "p_main_party", "trp_barclay_adventurer", 5),
        (party_add_members, "p_main_party", "trp_barclay_footman", 4),
        (party_add_members, "p_main_party", "trp_barclay_sapper", 4),
        (party_add_members, "p_main_party", "trp_barclay_sapper_adv", 3),
        (party_add_members, "p_main_party", "trp_barclay_lancer", 3),
        (party_add_members, "p_main_party", "trp_barclay_knight", 2),
        (display_message, "@A Barclay company has joined your party"),
      ]
      ),

      ("camp_regular_Veccavian",
      [],
      "Give_me_a_Veccavian_company",
      [
        (party_add_members, "p_main_party", "trp_veccavi_kral", 4),
        (party_add_members, "p_main_party", "trp_veccavi_krom", 5),
        (party_add_members, "p_main_party", "trp_vecavi_man_hunter", 4),
        (party_add_members, "p_main_party", "trp_veccavi_archer", 3),
        (party_add_members, "p_main_party", "trp_veccavi_horse", 3),
        (party_add_members, "p_main_party", "trp_veccavi_uncut", 3),
        (party_add_members, "p_main_party", "trp_veccavi_knight", 3),
        (party_add_members, "p_main_party", "trp_veccavi_queen_guard", 3),
        (display_message, "@A Veccavian company has joined your party"),
      ]
      ),

      ("camp_regular_Melitine",
      [],
      "Give_me_a_Melitine_company",
      [
        (party_add_members, "p_main_party", "trp_melitine_merc", 4),
        (party_add_members, "p_main_party", "trp_melitine_archer", 6),
        (party_add_members, "p_main_party", "trp_melitine_infantry", 4),
        (party_add_members, "p_main_party", "trp_melitine_shock_infantry", 3),
        (party_add_members, "p_main_party", "trp_melitine_lancer", 3),
        (party_add_members, "p_main_party", "trp_melitine_horse_archer", 3),
        (party_add_members, "p_main_party", "trp_melitine_cataphract", 2),
        (display_message, "@A Melitine company has joined your party"),
      ]
      ),

      ("camp_regular_Singalian",
      [],
      "Give_me_Singalian_troops",
      [
        (party_add_members, "p_main_party", "trp_singalian_spearman", 10),
        (party_add_members, "p_main_party", "trp_singalian_horseman", 5),
        (party_add_members, "p_main_party", "trp_singalian_temptress", 4),
        (display_message, "@A Singalian company has joined your party"),
      ]
      ),

      ("camp_regular_Sarleon",
      [],
      "Give_me_a_Sarleon_company",
      [
        (party_add_members, "p_main_party", "trp_sarleon_recruit", 1),
        (party_add_members, "p_main_party", "trp_sarleon_militia", 1),
        (party_add_members, "p_main_party", "trp_sarleon_trained_militia", 1),
        (party_add_members, "p_main_party", "trp_sarleon_footman", 1),
        (party_add_members, "p_main_party", "trp_sarleon_arm_footman", 1),
        (party_add_members, "p_main_party", "trp_sarleon_halberdier", 1),
        (party_add_members, "p_main_party", "trp_sarleon_skirmisher", 1),
        (party_add_members, "p_main_party", "trp_sarleon_longbowman", 1),
        (party_add_members, "p_main_party", "trp_sarleon_arm_longbowman", 1),
        (party_add_members, "p_main_party", "trp_sarleon_manatarms", 1),
        (party_add_members, "p_main_party", "trp_sarleon_knight", 1),
        (party_add_members, "p_main_party", "trp_sarleon_nobleman", 1),
        (party_add_members, "p_main_party", "trp_sarleon_squire", 1),
        (party_add_members, "p_main_party", "trp_marleons_cavalry", 1),
        (display_message, "@A Sarleon Company has joined the party"),
      ]
      ),

      ("camp_regular_Ravenstern",
      [],
      "Give_me_a_Ravenstern_company",
      [
        (party_add_members, "p_main_party", "trp_rav_recruit", 1),
        (party_add_members, "p_main_party", "trp_rav_militia", 1),
        (party_add_members, "p_main_party", "trp_rav_skirmisher", 1),
        (party_add_members, "p_main_party", "trp_rav_archer", 1),
        (party_add_members, "p_main_party", "trp_rav_warden", 1),
        (party_add_members, "p_main_party", "trp_rav_manatarms", 1),
        (party_add_members, "p_main_party", "trp_rav_footman", 1),
        (party_add_members, "p_main_party", "trp_rav_kierguard", 1),
        (party_add_members, "p_main_party", "trp_rav_squire", 1),
        (party_add_members, "p_main_party", "trp_rav_horseman", 1),
        (party_add_members, "p_main_party", "trp_rav_knight", 1),
        (party_add_members, "p_main_party", "trp_rav_trained_militia", 1),
        (party_add_members, "p_main_party", "trp_rav_nobleman", 1),
        (party_add_members, "p_main_party", "trp_rav_ranger", 1),
        (party_add_members, "p_main_party", "trp_rav_mounted_ranger", 1),
        (display_message, "@A Ravenstern Company joined the party"),
      ]
      ),

      ("camp_regular_DShar",
      [],
      "Give_me_a_D'Shar_company",
      [
        (party_add_members, "p_main_party", "trp_dshar_tribesman", 1),
        (party_add_members, "p_main_party", "trp_dshar_hunter", 1),
        (party_add_members, "p_main_party", "trp_dshar_conscript", 1),
        (party_add_members, "p_main_party", "trp_dshar_desert_fighter", 1),
        (party_add_members, "p_main_party", "trp_dshar_warrior", 1),
        (party_add_members, "p_main_party", "trp_dshar_ghazi_dervish", 1),
        (party_add_members, "p_main_party", "trp_dshar_ghazi_spearman", 1),
        (party_add_members, "p_main_party", "trp_dshar_desert_bowman", 1),
        (party_add_members, "p_main_party", "trp_dshar_ghazi_marksman", 1),
        (party_add_members, "p_main_party", "trp_dshar_mtd_raider", 1),
        (party_add_members, "p_main_party", "trp_dshar_mtd_bowfighter", 1),
        (party_add_members, "p_main_party", "trp_dshar_sand_stalker", 1),
        (party_add_members, "p_main_party", "trp_dshar_mtd_horseman", 1),
        (party_add_members, "p_main_party", "trp_dshar_dune_rider", 1),
        (party_add_members, "p_main_party", "trp_dshar_mtd_bowfighter", 1),
        (party_add_members, "p_main_party", "trp_dshar_sand_stalker", 1),
        (party_add_members, "p_main_party", "trp_dshar_djaha", 1),
        (party_add_members, "p_main_party", "trp_dshar_nobleman", 1),
        (party_add_members, "p_main_party", "trp_dshar_noble_raider", 1),
        (party_add_members, "p_main_party", "trp_dshar_noble_cavalry", 1),
        (display_message, "@A D'Shar Company joined the party"),
      ]
      ),

      ("camp_regular_Fierdsvain",
      [],
      "Give_me_a_Fierdsvain_company",
      [
        (party_add_members, "p_main_party", "trp_fierd_recruit", 1),
        (party_add_members, "p_main_party", "trp_fierd_militia", 1),
        (party_add_members, "p_main_party", "trp_fierd_tr_militia", 1),
        (party_add_members, "p_main_party", "trp_fierd_axeman", 1),
        (party_add_members, "p_main_party", "trp_fierd_warrior", 1),
        (party_add_members, "p_main_party", "trp_fierd_huscarl", 1),
        (party_add_members, "p_main_party", "trp_fierd_hunter", 1),
        (party_add_members, "p_main_party", "trp_fierd_bowman", 1),
        (party_add_members, "p_main_party", "trp_fierd_archer", 1),
        (party_add_members, "p_main_party", "trp_fierd_light_infantry", 1),
        (party_add_members, "p_main_party", "trp_fierd_berserker", 1),
        (party_add_members, "p_main_party", "trp_fierd_armored_axeman", 1),
        (party_add_members, "p_main_party", "trp_fierd_heavy_archer", 1),
        (party_add_members, "p_main_party", "trp_fierd_noblewoman", 1),
        (party_add_members, "p_main_party", "trp_fierd_sword_maiden", 1),
        (party_add_members, "p_main_party", "trp_valkyrie", 1),
        (party_add_members, "p_main_party", "trp_valdis_huscarl", 1),
        (display_message, "@A Fierdsvain Company joined the party"),
      ]
      ),

      ("camp_regular_Empire",
      [],
      "Give_me_an_Empire_company",
      [
        (party_add_members, "p_main_party", "trp_empire_citizen", 1),
        (party_add_members, "p_main_party", "trp_empire_recruit", 1),
        (party_add_members, "p_main_party", "trp_empire_militia", 1),
        (party_add_members, "p_main_party", "trp_empire_infantry", 1),
        (party_add_members, "p_main_party", "trp_empire_knight", 1),
        (party_add_members, "p_main_party", "trp_empire_legionnaire", 1),
        (party_add_members, "p_main_party", "trp_empire_noble_foot", 1),
        (party_add_members, "p_main_party", "trp_empire_hunter", 1),
        (party_add_members, "p_main_party", "trp_empire_skirmisher", 1),
        (party_add_members, "p_main_party", "trp_empire_crossbowman", 1),
        (party_add_members, "p_main_party", "trp_empire_arm_crossbowman", 1),
        (party_add_members, "p_main_party", "trp_empire_light_infantry", 1),
        (party_add_members, "p_main_party", "trp_empire_pikeman", 1),
        (party_add_members, "p_main_party", "trp_empire_armored_pikeman", 1),
        (party_add_members, "p_main_party", "trp_empire_gladiator", 1),
        (party_add_members, "p_main_party", "trp_empire_nobleman", 1),
        (party_add_members, "p_main_party", "trp_empire_light_cavalry", 1),
        (party_add_members, "p_main_party", "trp_empire_horseman", 1),
        (party_add_members, "p_main_party", "trp_empire_immortal", 1),
        (display_message, "@An Empire Company joined the party"),
      ]
      ),

      ("camp_regular_pendor",
      [],
      "Give_me_a_Pendor_company",
      [
        (party_add_members, "p_main_party", "trp_pendor_foot_knight", 1),
        (party_add_members, "p_main_party", "trp_pendor_recruit", 1),
        (party_add_members, "p_main_party", "trp_pendor_militia", 1),
        (party_add_members, "p_main_party", "trp_pendor_footman", 1),
        (party_add_members, "p_main_party", "trp_pendor_swordsman", 1),
        (party_add_members, "p_main_party", "trp_pendor_manatarms", 1),
        (party_add_members, "p_main_party", "trp_pendor_cavalry", 1),
        (party_add_members, "p_main_party", "trp_pendor_mtdmanatarms", 1),
        (party_add_members, "p_main_party", "trp_pendor_nobleman", 1),
        (party_add_members, "p_main_party", "trp_pendor_squire", 1),
        (party_add_members, "p_main_party", "trp_pendor_knight", 1),
        (party_add_members, "p_main_party", "trp_pendor_light_bowman", 1),
        (party_add_members, "p_main_party", "trp_pendor_heavy_bowman", 1),
        (party_add_members, "p_main_party", "trp_pendor_armored_bowman", 1),
        (party_add_members, "p_main_party", "trp_pendor_gray_archer", 1),
        (party_add_members, "p_main_party", "trp_pendor_noble_bowman", 1),
        (display_message, "@A Pendor Company has joined the party"),
      ]
      ),

      ("camp_regular_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_minor", 0,
    "Select an option:",
    "none",
    [
      (set_spawn_radius, 3),
    ],
    [
      ("camp_minor_eventide",
      [],
      "Spawn_Eventide_Knight_Patrol",
      [
        (spawn_around_party, "p_main_party", "pt_errant_knights"),
        (assign, ":var0", reg0),
        (party_set_faction, ":var0", "fac_eventide_knights"),
        (party_set_name, ":var0", "@Patrolling Kick-Ass Knights"),
        (party_add_members, ":var0", "trp_eventide_knight", 10),
        (display_message, "@Eventide Knight Patrol spawned"),
      ]
      ),

      ("camp_minor_dawn",
      [],
      "Spawn_Dawn_Knight_Patrol",
      [
        (spawn_around_party, "p_main_party", "pt_errant_knights"),
        (assign, ":var0", reg0),
        (party_set_faction, ":var0", "fac_dawn_knights"),
        (party_set_name, ":var0", "@Patrolling Kick-Ass Knights"),
        (party_add_members, ":var0", "trp_dawn_knight", 10),
        (display_message, "@Dawn Knight Patrol spawned"),
      ]
      ),

      ("camp_minor_ebony",
      [],
      "Spawn_Ebony_Knight_Patrol",
      [
        (spawn_around_party, "p_main_party", "pt_errant_knights"),
        (assign, ":var0", reg0),
        (party_set_faction, ":var0", "fac_ebony_knights"),
        (party_set_name, ":var0", "@Patrolling Kick-Ass Knights"),
        (party_add_members, ":var0", "trp_ebony_gauntlet", 10),
        (display_message, "@Ebony Knight Patrol spawned"),
      ]
      ),

      ("camp_minor_1",
      [],
      "Spawn_Vanskerry_Army",
      [
        (spawn_around_party, "p_main_party", "pt_sea_raider_army"),
        (display_message, "@Vanskerries spawned"),
      ]
      ),

      ("camp_minor_2",
      [],
      "Spawn_Heretic_Army",
      [
        (spawn_around_party, "p_main_party", "pt_heretics_army"),
        (display_message, "@Heretics spawned"),
      ]
      ),

      ("camp_minor_3",
      [],
      "Spawn_Snake_Cult_Army",
      [
        (spawn_around_party, "p_main_party", "pt_snake_cult_army"),
        (display_message, "@Snake Cult spawned"),
      ]
      ),

      ("camp_minor_4",
      [],
      "Spawn_Mystmountain_Army",
      [
        (spawn_around_party, "p_main_party", "pt_mystmountain_army"),
        (display_message, "@Mystmountains spawned"),
      ]
      ),

      ("camp_minor_5",
      [],
      "Spawn_Jatu_Army",
      [
        (spawn_around_party, "p_main_party", "pt_jatu_army"),
        (display_message, "@Jatu spawned"),
      ]
      ),

      ("camp_minor_6",
      [],
      "Spawn_Noldor_Patrol",
      [
        (spawn_around_party, "p_main_party", "pt_noldor_elves"),
        (display_message, "@Noldor Patrol spawned"),
      ]
      ),

      ("camp_minor_7",
      [],
      "Spawn_Inquisition_Army",
      [
        (spawn_around_party, "p_main_party", "pt_inquisition_army"),
        (display_message, "@Inquisition Army spawned"),
      ]
      ),

      ("camp_minor_8",
      [],
      "Spawn_Peasant_Revolt_Army",
      [
        (spawn_around_party, "p_main_party", "pt_peasant_army"),
        (display_message, "@Peasant Revolt Army spawned"),
      ]
      ),

      ("camp_minor_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_hero", 0,
    "Select an option:",
    "none",
    [
      (set_spawn_radius, 2),
    ],
    [
      ("camp_hero_1",
      [],
      "Spawn_Three_Seers",
      [
        (spawn_around_party, "p_main_party", "pt_three_seers"),
        (assign, ":var0", reg0),
        (store_character_level, ":var1", "trp_player"),
        (store_mul, ":var2", ":var1", 6),
        (val_add, ":var2", 150),
        (val_min, ":var2", 400),
        (party_add_members, ":var0", "trp_sarleon_deserter", ":var2"),
        (display_message, "@Three Seers spawned"),
      ]
      ),

      ("camp_hero_2",
      [],
      "Spawn_Alaric_Von_Brouhaha",
      [
        (spawn_around_party, "p_main_party", "pt_brouhaha"),
        (display_message, "@Alaric Von Brouhaha spawned"),
      ]
      ),

      ("camp_hero_3",
      [],
      "Spawn_Boris_the_Raven",
      [
        (spawn_around_party, "p_main_party", "pt_boristheraven"),
        (display_message, "@Boris the Raven spawned"),
      ]
      ),

      ("camp_hero_4",
      [],
      "Spawn_Burilgi_the_Usurper",
      [
        (spawn_around_party, "p_main_party", "pt_burilgi_the_usurper"),
        (display_message, "@Burilgi the Usurper spawned"),
      ]
      ),

      ("camp_hero_5",
      [],
      "Spawn_Dread_Legion",
      [
        (spawn_around_party, "p_main_party", "pt_dread_legion"),
        (display_message, "@Dread Legion spawned"),
      ]
      ),

      ("camp_hero_6",
      [],
      "Spawn_Eyegrim_the_Devourer",
      [
        (spawn_around_party, "p_main_party", "pt_eyegrim"),
        (display_message, "@Eyegrim the Devourer spawned"),
      ]
      ),

      ("camp_hero_7",
      [],
      "Spawn_Oswald_de_Fleur",
      [
        (spawn_around_party, "p_main_party", "pt_oswald"),
        (display_message, "@Oswald de Fleur spawned"),
      ]
      ),

      ("camp_hero_8",
      [],
      "Spawn_Sheik_Shalavan",
      [
        (spawn_around_party, "p_main_party", "pt_shalavan"),
        (display_message, "@Sheik Shalavan spawned"),
      ]
      ),

      ("camp_hero_more",
      [],
      "More_spawns...",
      [
        (jump_to_menu, "mnu_camp_hero2"),
      ]
      ),

      ("camp_hero_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_hero2", 0,
    "Select an option:",
    "none",
    [
      (set_spawn_radius, 2),
    ],
    [
      ("camp_hero_9",
      [],
      "Spawn_Wolfbode_the_Slayer",
      [
        (spawn_around_party, "p_main_party", "pt_wolfbode"),
        (display_message, "@Wolfbode the Slayer spawned"),
      ]
      ),

      ("camp_hero_10",
      [],
      "Spawn_Syla_Uzas",
      [
        (spawn_around_party, "p_main_party", "pt_syla_uzas"),
        (display_message, "@Syla Uzas spawned"),
      ]
      ),

      ("camp_hero_11",
      [],
      "Spawn_Griffonsword",
      [
        (spawn_around_party, "p_main_party", "pt_griffonsword"),
        (display_message, "@Griffonsword spawned"),
      ]
      ),

      ("camp_hero_12",
      [],
      "Spawn_Kodan_Ironsword",
      [
        (spawn_around_party, "p_main_party", "pt_ironsword"),
        (display_message, "@Kodan Ironsword spawned"),
      ]
      ),

      ("camp_hero_13",
      [],
      "Spawn_Aeldarian",
      [
        (spawn_around_party, "p_main_party", "pt_noldor_lord_1"),
        (display_message, "@Aeldarian spawned"),
      ]
      ),

      ("camp_hero_14",
      [],
      "Spawn_Ithilrandir",
      [
        (spawn_around_party, "p_main_party", "pt_noldor_lord_2"),
        (display_message, "@Ithilrandir spawned"),
      ]
      ),

      ("camp_hero_15",
      [],
      "Spawn_K'Juda_the_Ravager",
      [
        (spawn_around_party, "p_main_party", "pt_jatu_k_juda"),
        (display_message, "@K'Juda the Ravager spawned"),
      ]
      ),

      ("camp_hero_16",
      [],
      "Spawn_Warlord_Zulkar",
      [
        (spawn_around_party, "p_main_party", "pt_jatu_zulkar"),
        (display_message, "@Warlord Zulkar spawned"),
      ]
      ),

      ("camp_hero_more_1",
      [],
      "Even_more_spawns_...",
      [
        (jump_to_menu, "mnu_camp_hero3"),
      ]
      ),

      ("camp_hero2_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_hero3", 0,
    "Select an option:",
    "none",
    [
      (set_spawn_radius, 2),
    ],
    [
      ("camp_hero_17",
      [],
      "Spawn_Obrist_Heynrich",
      [
        (spawn_around_party, "p_main_party", "pt_mett_obrist"),
        (display_message, "@Obrist Heynrich spawned"),
      ]
      ),

      ("camp_hero_18",
      [],
      "Spawn_Verante_Kruus",
      [
        (spawn_around_party, "p_main_party", "pt_vecc_verante"),
        (display_message, "@Verante Kruus spawned"),
      ]
      ),

      ("camp_hero_19",
      [],
      "Spawn_Rufio_of_Barclay",
      [
        (spawn_around_party, "p_main_party", "pt_barclay_rufio"),
        (display_message, "@Rufio of Barclay spawned"),
      ]
      ),

      ("camp_hero_20",
      [],
      "Spawn_Sebastokrator_Kaspax",
      [
        (spawn_around_party, "p_main_party", "pt_melitine_kaspax"),
        (display_message, "@Sebastokrator Kaspax spawned"),
      ]
      ),

      ("camp_hero_21",
      [],
      "Spawn_Holy_Inquisitor_Rasmus_Devatica",
      [
        (spawn_around_party, "p_main_party", "pt_inquisitor"),
        (display_message, "@Holy Inquisitor Rasmus Devatica spawned"),
      ]
      ),

      ("camp_hero_22",
      [],
      "Spawn_Toblik's_Veccavian_Renegades",
      [
        (spawn_around_party, "p_main_party", "pt_player_merc_veccavian"),
        (display_message, "@Toblik's Veccavian Renegades spawned"),
      ]
      ),

      ("camp_hero3_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_horsemen_apocalypse", 0,
    "Do NOT try this on your main savegame as it may ruin your game.",
    "none",
    [],
    [
      ("camp_horsemen_apocalypse_1",
      [],
      "Call_independent_heroes.",
      [
        (party_clear, "p_main_party"),
        (try_for_range, ":var0", "trp_hero_burilgi", "trp_omen_seeker"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (party_add_members, "p_main_party", "trp_seeress", 3),
        (party_add_members, "p_main_party", "trp_hero_eyegrim", 1),
        (try_for_range, ":var0", "trp_merc_leader_mettenheim", "trp_andy"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@Heroes are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_2",
      [],
      "Call_Sarleon_lords.",
      [
        (party_clear, "p_main_party"),
        (party_add_members, "p_main_party", "trp_kingdom_1_lord", 1),
        (party_add_members, "p_main_party", "trp_kingdom_1_pretender", 1),
        (try_for_range, ":var0", "trp_knight_1_1", "trp_knight_2_1"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@Sarleon lords are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_3",
      [],
      "Call_Ravenstern_lords.",
      [
        (party_clear, "p_main_party"),
        (party_add_members, "p_main_party", "trp_kingdom_2_lord", 1),
        (party_add_members, "p_main_party", "trp_kingdom_2_pretender", 1),
        (try_for_range, ":var0", "trp_knight_2_1", "trp_knight_3_1"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@Ravenstern lords are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_4",
      [],
      "Call_D'Shar_lords.",
      [
        (party_clear, "p_main_party"),
        (party_add_members, "p_main_party", "trp_kingdom_3_lord", 1),
        (party_add_members, "p_main_party", "trp_kingdom_3_pretender", 1),
        (try_for_range, ":var0", "trp_knight_3_1", "trp_knight_4_1"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@D'Shar lords are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_5",
      [],
      "Call_Fierdsvain_lords.",
      [
        (party_clear, "p_main_party"),
        (party_add_members, "p_main_party", "trp_kingdom_4_lord", 1),
        (party_add_members, "p_main_party", "trp_kingdom_4_pretender", 1),
        (try_for_range, ":var0", "trp_knight_4_1", "trp_knight_5_1"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@Fierdsvain lords are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_6",
      [],
      "Call_Empire_lords.",
      [
        (party_clear, "p_main_party"),
        (party_add_members, "p_main_party", "trp_kingdom_5_lord", 1),
        (party_add_members, "p_main_party", "trp_kingdom_5_pretender", 1),
        (try_for_range, ":var0", "trp_knight_5_1", "trp_kingdom_1_pretender"),
          (party_add_members, "p_main_party", ":var0", 1),
        (try_end),
        (display_message, "@Empire lords are here."),
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),

      ("camp_horsemen_apocalypse_back",
      [],
      "Back_to_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader2"),
      ]
      ),
    ],
  ),

  ("camp_victory", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_victory_simple",
      [],
      "Simple_victory_screen",
      [
        (start_presentation, "prsnt_victory_screen_simple"),
      ]
      ),

      ("camp_victoryold",
      [],
      "Old_Victory_screen",
      [
        (start_presentation, "prsnt_group_photo"),
      ]
      ),

      ("camp_victory_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_fun", 0,
    "Select an option:",
    "none",
    [
      (set_spawn_radius, 2),
    ],
    [
      ("camp_fun_village",
      [
        (try_begin),
          (neq, "$test_burn", 0),
          (str_store_string, s7, "@ON"),
        (else_try),
          (str_store_string, s7, "@OFF"),
        (try_end),
      ],
      "Burn_everything:_{s7}",
      [
        (store_sub, "$test_burn", 1, "$test_burn"),
        (val_clamp, "$test_burn", 0, 2),
        (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
          (try_begin),
            (eq, "$test_burn", 0),
            (party_clear_particle_systems, ":var0"),
          (else_try),
            (try_begin),
              (is_between, ":var0", "p_town_1", "p_castle_1"),
              (party_add_particle_system, ":var0", "psys_village_fire_big"),
            (else_try),
              (party_add_particle_system, ":var0", "psys_map_village_fire"),
            (try_end),
          (try_end),
        (try_end),
      ]
      ),

      ("camp_fun_twins",
      [],
      "Spawn_evil_twins!",
      [
        (spawn_around_party, "p_main_party", "pt_looters"),
        (assign, ":var0", reg0),
        (call_script, "script_party_copy", ":var0", "p_main_party"),
        (party_set_name, ":var0", "@Evil Twins"),
        (party_set_faction, ":var0", "fac_outlaws"),
        (party_get_icon, ":var1", "p_main_party"),
        (party_set_icon, ":var0", ":var1"),
        (display_message, "@Evil twin party spawned!"),
      ]
      ),

      ("camp_fun_female",
      [],
      "Make_soldiers_female!",
      [
        (try_for_range, ":var0", "trp_farmer", "trp_town_walker_1"),
          (troop_set_type, ":var0", 1),
        (try_end),
        (display_message, "@Soldiers' balls cut off!"),
      ]
      ),

      ("camp_fun_undead",
      [],
      "Make_soldiers_undead!",
      [
        (try_for_range, ":var0", "trp_farmer", "trp_town_walker_1"),
          (troop_set_type, ":var0", 3),
        (try_end),
        (display_message, "@Soldiers killed and ressurected!"),
      ]
      ),

      ("camp_fun_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_autoloot", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_autoloot_choose_item",
      [
        (try_begin),
          (eq, "$test_item_type", 0),
          (assign, "$test_item_type", 1),
        (try_end),
        (try_begin),
          (eq, "$test_item_type", 1),
          (str_store_string, s3, "@Horse"),
        (else_try),
          (eq, "$test_item_type", 2),
          (str_store_string, s3, "@1-Handed"),
        (else_try),
          (eq, "$test_item_type", 3),
          (str_store_string, s3, "@2-Handed"),
        (else_try),
          (eq, "$test_item_type", 4),
          (try_begin),
            (eq, "$test_item_halberd", 0),
            (str_store_string, s3, "@Polearm - Spear"),
          (else_try),
            (str_store_string, s3, "@Polearm - Halberd"),
          (try_end),
        (else_try),
          (eq, "$test_item_type", 5),
          (str_store_string, s3, "@Arrows"),
        (else_try),
          (eq, "$test_item_type", 6),
          (str_store_string, s3, "@Bolts"),
        (else_try),
          (eq, "$test_item_type", 7),
          (str_store_string, s3, "@Shield"),
        (else_try),
          (eq, "$test_item_type", 8),
          (str_store_string, s3, "@Bow"),
        (else_try),
          (eq, "$test_item_type", 9),
          (str_store_string, s3, "@Crossbow"),
        (else_try),
          (eq, "$test_item_type", 10),
          (str_store_string, s3, "@Thrown"),
        (else_try),
          (eq, "$test_item_type", 12),
          (str_store_string, s3, "@Helmet"),
        (else_try),
          (eq, "$test_item_type", 13),
          (str_store_string, s3, "@Armor"),
        (else_try),
          (eq, "$test_item_type", 14),
          (str_store_string, s3, "@Boots"),
        (else_try),
          (eq, "$test_item_type", 15),
          (str_store_string, s3, "@Gloves"),
        (else_try),
          (str_store_string, s3, "@ERROR"),
        (try_end),
      ],
      "Change_item_type:_{s3}",
      [
        (try_begin),
          (eq, "$test_item_type", 15),
          (assign, "$test_item_type", 1),
        (else_try),
          (eq, "$test_item_type", 10),
          (assign, "$test_item_type", 12),
        (else_try),
          (eq, "$test_item_type", 4),
          (try_begin),
            (eq, "$test_item_halberd", 0),
            (assign, "$test_item_halberd", 1),
          (else_try),
            (assign, "$test_item_halberd", 0),
            (assign, "$test_item_type", 5),
          (try_end),
        (else_try),
          (val_add, "$test_item_type", 1),
        (try_end),
      ]
      ),

      ("camp_autoloot_cavalry_toggle",
      [
        (try_begin),
          (neq, "$test_cavalry_restricted", 0),
          (str_store_string, s7, "@ON"),
        (else_try),
          (str_store_string, s7, "@OFF"),
        (try_end),
      ],
      "Cavalry_restriction:_{s7}",
      [
        (val_clamp, "$test_cavalry_restricted", 0, 2),
        (store_sub, "$test_cavalry_restricted", 1, "$test_cavalry_restricted"),
      ]
      ),

      ("camp_autoloot_item_trade",
      [],
      "Review/buy_items",
      [
        (troop_clear_inventory, "trp_find_item_cheat"),
        (assign, ":var0", 0),
        (try_for_range_backwards, ":var1", 0, "itm_items_end"),
          (neq, ":var0", 96),
          (item_get_type, ":var2", ":var1"),
          (eq, ":var2", "$test_item_type"),
          (this_or_next|item_slot_eq, ":var1", 19, 0),
          (eq, "$test_cavalry_restricted", 0),
          (troop_add_items, "trp_find_item_cheat", ":var1", 1),
          (val_add, ":var0", 1),
        (try_end),
        (troop_sort_inventory, "trp_find_item_cheat"),
        (change_screen_trade, "trp_find_item_cheat"),
      ]
      ),

      ("camp_autoloot_calc",
      [],
      "Calculate_average_and_standard_deviation_for_item_attributes.",
      [
        (try_for_range, ":var0", 9, 19),
          (str_store_string, s4, "@Not used"),
          (try_begin),
            (eq, "$test_item_type", 1),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Horse Charge"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Horse Speed"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Horse Maneuver"),
            (else_try),
              (eq, ":var0", 17),
              (str_store_string, s4, "@Horse Armor"),
            (else_try),
              (eq, ":var0", 18),
              (str_store_string, s4, "@Horse Hitpoints"),
            (try_end),
          (else_try),
            (this_or_next|eq, "$test_item_type", 2),
            (this_or_next|eq, "$test_item_type", 3),
            (eq, "$test_item_type", 4),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Swing Damage"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Thrust Damage"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Weapon Speed"),
            (else_try),
              (eq, ":var0", 17),
              (str_store_string, s4, "@Weapon Reach"),
            (try_end),
          (else_try),
            (this_or_next|eq, "$test_item_type", 5),
            (eq, "$test_item_type", 6),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Missile speed"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Max Ammo"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Bonus Damage"),
            (try_end),
          (else_try),
            (eq, "$test_item_type", 7),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Shield Resistance"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Shield Speed"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Shield Hitpoints"),
            (else_try),
              (eq, ":var0", 17),
              (str_store_string, s4, "@Shield Coverage"),
            (try_end),
          (else_try),
            (this_or_next|eq, "$test_item_type", 8),
            (this_or_next|eq, "$test_item_type", 9),
            (eq, "$test_item_type", 10),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Ranged Damage"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Reload Speed"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Missile Speed"),
            (try_end),
          (else_try),
            (this_or_next|eq, "$test_item_type", 12),
            (this_or_next|eq, "$test_item_type", 13),
            (this_or_next|eq, "$test_item_type", 14),
            (eq, "$test_item_type", 15),
            (try_begin),
              (eq, ":var0", 9),
              (str_store_string, s4, "@Body Armor"),
            (else_try),
              (eq, ":var0", 10),
              (str_store_string, s4, "@Leg Armor"),
            (else_try),
              (eq, ":var0", 16),
              (str_store_string, s4, "@Head Armor"),
            (else_try),
              (eq, ":var0", 17),
              (str_store_string, s4, "@Armor Weight"),
            (try_end),
          (else_try),
            (str_store_string, s4, "@ERROR"),
          (try_end),
          (assign, ":var1", 0),
          (assign, ":var2", 0),
          (assign, ":var3", 0),
          (try_for_range, ":var4", "itm_sumpter_horse", "itm_items_end"),
            (item_get_type, ":var5", ":var4"),
            (eq, ":var5", "$test_item_type"),
            (this_or_next|item_slot_eq, ":var4", 19, 0),
            (eq, "$test_cavalry_restricted", 0),
            (assign, ":var6", 1),
            (try_begin),
              (eq, ":var5", 4),
              (item_get_slot, ":var7", ":var4", 9),
              (item_get_slot, ":var8", ":var4", 10),
              (try_begin),
                (eq, "$test_item_halberd", 0),
                (gt, ":var7", ":var8"),
                (assign, ":var6", 0),
              (else_try),
                (eq, "$test_item_halberd", 1),
                (gt, ":var8", ":var7"),
                (assign, ":var6", 0),
              (try_end),
            (try_end),
            (eq, ":var6", 1),
            (item_get_slot, ":var9", ":var4", ":var0"),
            (val_add, ":var1", ":var9"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (gt, ":var2", 0),
            (neq, ":var1", 0),
            (store_div, ":var3", ":var1", ":var2"),
            (assign, ":var1", 0),
            (assign, ":var10", 0),
            (try_for_range, ":var4", "itm_sumpter_horse", "itm_items_end"),
              (item_get_type, ":var5", ":var4"),
              (eq, ":var5", "$test_item_type"),
              (this_or_next|item_slot_eq, ":var4", 19, 0),
              (eq, "$test_cavalry_restricted", 0),
              (assign, ":var6", 1),
              (try_begin),
                (eq, ":var5", 4),
                (item_get_slot, ":var7", ":var4", 9),
                (item_get_slot, ":var8", ":var4", 10),
                (try_begin),
                  (eq, "$test_item_halberd", 0),
                  (gt, ":var7", ":var8"),
                  (assign, ":var6", 0),
                (else_try),
                  (eq, "$test_item_halberd", 1),
                  (gt, ":var8", ":var7"),
                  (assign, ":var6", 0),
                (try_end),
              (try_end),
              (eq, ":var6", 1),
              (item_get_slot, ":var9", ":var4", ":var0"),
              (val_sub, ":var9", ":var3"),
              (val_mul, ":var9", ":var9"),
              (val_add, ":var1", ":var9"),
            (try_end),
            (store_div, ":var10", ":var1", ":var2"),
            (convert_to_fixed_point, ":var10"),
            (store_sqrt, ":var10", ":var10"),
            (convert_from_fixed_point, ":var10"),
            (assign, reg0, ":var3"),
            (assign, reg1, ":var10"),
            (assign, reg2, ":var2"),
            (display_message, "@{s4}: Average: {reg0}, St.dev.: {reg1}, Count: {reg2}", 0x00AAAA),
          (try_end),
        (try_end),
      ]
      ),

      ("camp_autoloot_score",
      [],
      "Print_all_autoloot_scores",
      [
        (display_message, "@Printing scores...", 0x00AAAA),
        (try_for_range, ":var0", "itm_sumpter_horse", "itm_items_end"),
          (item_get_type, ":var1", ":var0"),
          (eq, ":var1", "$test_item_type"),
          (this_or_next|item_slot_eq, ":var0", 19, 0),
          (eq, "$test_cavalry_restricted", 0),
          (assign, ":var2", 1),
          (try_begin),
            (eq, ":var1", 4),
            (item_get_slot, ":var3", ":var0", 9),
            (item_get_slot, ":var4", ":var0", 10),
            (assign, ":var5", 0),
            (try_begin),
              (eq, "$test_item_halberd", 0),
              (assign, ":var5", 2),
              (gt, ":var3", ":var4"),
              (assign, ":var2", 0),
            (else_try),
              (eq, "$test_item_halberd", 1),
              (assign, ":var5", 1),
              (gt, ":var4", ":var3"),
              (assign, ":var2", 0),
            (try_end),
          (try_end),
          (eq, ":var2", 1),
          (call_script, "script_get_item_value_with_imod", ":var0", 0, ":var5"),
          (str_store_item_name, s10, ":var0"),
          (display_message, "@{reg0}: {s10}"),
        (try_end),
      ]
      ),

      ("camp_autoloot_top20",
      [],
      "Print_top_20_autoloot_scores",
      [
        (assign, ":var0", 20),
        (try_for_range, ":var1", 0, ":var0"),
          (troop_set_slot, "trp_temp_array_a", ":var1", 0),
          (troop_set_slot, "trp_temp_array_b", ":var1", 0),
        (try_end),
        (try_for_range, ":var2", "itm_sumpter_horse", "itm_items_end"),
          (item_get_type, ":var3", ":var2"),
          (eq, ":var3", "$test_item_type"),
          (this_or_next|item_slot_eq, ":var2", 19, 0),
          (eq, "$test_cavalry_restricted", 0),
          (assign, ":var4", 0),
          (try_begin),
            (eq, ":var3", 4),
            (try_begin),
              (eq, "$test_item_halberd", 0),
              (assign, ":var4", 2),
            (else_try),
              (assign, ":var4", 1),
            (try_end),
          (try_end),
          (call_script, "script_get_item_value_with_imod", ":var2", 0, ":var4"),
          (assign, ":var5", reg0),
          (assign, ":var6", 0),
          (try_for_range, ":var1", 0, ":var0"),
            (eq, ":var6", 0),
            (try_begin),
              (troop_get_slot, ":var7", "trp_temp_array_a", ":var1"),
              (gt, ":var5", ":var7"),
              (assign, ":var6", 1),
              (assign, ":var8", ":var5"),
              (assign, ":var9", ":var2"),
              (try_for_range, ":var10", ":var1", ":var0"),
                (troop_get_slot, ":var11", "trp_temp_array_a", ":var10"),
                (troop_get_slot, ":var12", "trp_temp_array_b", ":var10"),
                (troop_set_slot, "trp_temp_array_a", ":var10", ":var8"),
                (troop_set_slot, "trp_temp_array_b", ":var10", ":var9"),
                (assign, ":var8", ":var11"),
                (assign, ":var9", ":var12"),
              (try_end),
            (try_end),
          (try_end),
        (try_end),
        (try_for_range, ":var1", 0, ":var0"),
          (troop_get_slot, reg1, "trp_temp_array_a", ":var1"),
          (troop_get_slot, ":var2", "trp_temp_array_b", ":var1"),
          (neq, reg1, 0),
          (store_add, reg0, ":var1", 1),
          (str_store_item_name, s10, ":var2"),
          (display_message, "@{reg0}. {reg1}: {s10}", 0xFFFF00),
        (try_end),
      ]
      ),

      ("camp_autoloot_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_companion", 0,
    "Select an option:",
    "none",
    [],
    [
      ("camp_comp_recruit",
      [],
      "Recruit_all_20_companions.",
      [
        (party_add_members, "p_main_party", "trp_npc_adonja", 1),
        (party_add_members, "p_main_party", "trp_npc_leslie", 1),
        (party_add_members, "p_main_party", "trp_npc_ansen", 1),
        (party_add_members, "p_main_party", "trp_npc_riva", 1),
        (party_add_members, "p_main_party", "trp_npc_kassim", 1),
        (party_add_members, "p_main_party", "trp_npc_lethaldiran", 1),
        (party_add_members, "p_main_party", "trp_npc_jocelyn", 1),
        (party_add_members, "p_main_party", "trp_npc_alistair", 1),
        (party_add_members, "p_main_party", "trp_npc_rayne", 1),
        (party_add_members, "p_main_party", "trp_npc_julia", 1),
        (party_add_members, "p_main_party", "trp_npc_frederick", 1),
        (party_add_members, "p_main_party", "trp_npc_ediz", 1),
        (party_add_members, "p_main_party", "trp_npc_sara", 1),
        (party_add_members, "p_main_party", "trp_npc_donavan", 1),
        (party_add_members, "p_main_party", "trp_npc_diev", 1),
        (party_add_members, "p_main_party", "trp_npc_alyssa", 1),
        (party_add_members, "p_main_party", "trp_npc_roland", 1),
        (party_add_members, "p_main_party", "trp_npc_kaverra", 1),
        (party_add_members, "p_main_party", "trp_npc_sigismund", 1),
        (party_add_members, "p_main_party", "trp_npc_boadice", 1),
        (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (troop_set_slot, ":var0", 2, 5),
          (troop_set_slot, ":var0", 12, -1),
          (troop_set_auto_equip, ":var0", 0),
        (try_end),
        (display_message, "@All 20 companions recruited"),
      ]
      ),

      ("camp_comp_linked",
      [],
      "Random_linked_conversation.",
      [
        (assign, ":var0", 0),
        (assign, ":var1", 0),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (troop_get_slot, ":var3", ":var2", 79),
          (troop_get_slot, ":var4", ":var2", 71),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 1),
            (eq, ":var0", 0),
            (val_add, ":var1", 1),
          (try_end),
          (troop_get_slot, ":var4", ":var2", 73),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 2),
            (eq, ":var0", 0),
            (val_add, ":var1", 1),
          (try_end),
          (troop_get_slot, ":var4", ":var2", 75),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 4),
            (eq, ":var0", 0),
            (val_add, ":var1", 1),
          (try_end),
        (try_end),
        (gt, ":var1", 0),
        (store_random_in_range, ":var5", 0, ":var1"),
        (store_add, reg0, ":var5", 1),
        (assign, reg1, ":var1"),
        (display_message, "@Conversation #{reg0} chosen out of {reg1} total."),
        (assign, ":var6", 0),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (ge, ":var5", 0),
          (troop_get_slot, ":var3", ":var2", 79),
          (troop_get_slot, ":var4", ":var2", 71),
          (try_begin),
            (gt, ":var4", ":var2"),
            (val_add, ":var6", 1),
          (try_end),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 1),
            (eq, ":var0", 0),
            (try_begin),
              (eq, ":var5", 0),
              (val_or, ":var3", 1),
              (troop_set_slot, ":var2", 79, ":var3"),
              (assign, ":var7", ":var2"),
              (assign, ":var8", ":var4"),
              (try_begin),
                (this_or_next|eq, ":var6", 1),
                (this_or_next|eq, ":var6", 2),
                (this_or_next|eq, ":var6", 6),
                (eq, ":var6", 10),
                (assign, ":var7", ":var4"),
                (assign, ":var8", ":var2"),
              (try_end),
              (assign, "$npc_dialog_partner", ":var8"),
              (start_map_conversation, ":var7"),
              (change_screen_map),
            (try_end),
            (val_sub, ":var5", 1),
          (try_end),
        (try_end),
        (assign, ":var6", 0),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (ge, ":var5", 0),
          (troop_get_slot, ":var3", ":var2", 79),
          (troop_get_slot, ":var4", ":var2", 73),
          (try_begin),
            (gt, ":var4", ":var2"),
            (val_add, ":var6", 1),
          (try_end),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 2),
            (eq, ":var0", 0),
            (try_begin),
              (eq, ":var5", 0),
              (val_or, ":var3", 2),
              (troop_set_slot, ":var2", 79, ":var3"),
              (assign, ":var7", ":var2"),
              (assign, ":var8", ":var4"),
              (try_begin),
                (this_or_next|eq, ":var6", 1),
                (this_or_next|eq, ":var6", 3),
                (this_or_next|eq, ":var6", 4),
                (this_or_next|eq, ":var6", 6),
                (eq, ":var6", 9),
                (assign, ":var7", ":var4"),
                (assign, ":var8", ":var2"),
              (try_end),
              (assign, "$npc_dialog_partner", ":var8"),
              (start_map_conversation, ":var7"),
              (change_screen_map),
            (try_end),
            (val_sub, ":var5", 1),
          (try_end),
        (try_end),
        (assign, ":var6", 0),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (ge, ":var5", 0),
          (troop_get_slot, ":var3", ":var2", 79),
          (troop_get_slot, ":var4", ":var2", 75),
          (try_begin),
            (gt, ":var4", ":var2"),
            (val_add, ":var6", 1),
          (try_end),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (try_begin),
            (gt, ":var4", ":var2"),
            (main_party_has_troop, ":var4"),
            (neg|troop_is_wounded, ":var4"),
            (store_and, ":var0", ":var3", 4),
            (eq, ":var0", 0),
            (try_begin),
              (eq, ":var5", 0),
              (val_or, ":var3", 4),
              (troop_set_slot, ":var2", 79, ":var3"),
              (assign, ":var7", ":var2"),
              (assign, ":var8", ":var4"),
              (try_begin),
                (this_or_next|eq, ":var6", 1),
                (this_or_next|eq, ":var6", 2),
                (this_or_next|eq, ":var6", 3),
                (this_or_next|eq, ":var6", 4),
                (this_or_next|eq, ":var6", 8),
                (this_or_next|eq, ":var6", 9),
                (eq, ":var6", 10),
                (assign, ":var7", ":var4"),
                (assign, ":var8", ":var2"),
              (try_end),
              (assign, "$npc_dialog_partner", ":var8"),
              (start_map_conversation, ":var7"),
              (change_screen_map),
            (try_end),
            (val_sub, ":var5", 1),
          (try_end),
        (try_end),
      ]
      ),

      ("camp_comp_toplayer",
      [],
      "Random_remark_to_player.",
      [
        (assign, ":var0", 0),
        (assign, ":var1", 0),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (troop_get_slot, ":var3", ":var2", 79),
          (store_and, ":var0", ":var3", 8),
          (eq, ":var0", 0),
          (assign, ":var4", 0),
          (try_begin),
            (eq, ":var2", "trp_npc_adonja"),
            (neg|main_party_has_troop, "trp_npc_ansen"),
          (else_try),
            (eq, ":var2", "trp_npc_ediz"),
            (neg|main_party_has_troop, "trp_npc_rayne"),
          (else_try),
            (eq, ":var2", "trp_npc_jocelyn"),
            (neg|main_party_has_troop, "trp_npc_alistair"),
          (else_try),
            (eq, ":var2", "trp_npc_rayne"),
            (neg|main_party_has_troop, "trp_npc_boadice"),
          (else_try),
            (eq, ":var2", "trp_npc_riva"),
            (neg|main_party_has_troop, "trp_npc_kassim"),
          (else_try),
            (eq, ":var2", "trp_npc_leslie"),
            (neg|main_party_has_troop, "trp_npc_diev"),
          (else_try),
            (eq, ":var2", "trp_npc_diev"),
            (neg|main_party_has_troop, "trp_npc_leslie"),
          (else_try),
            (assign, ":var4", 1),
          (try_end),
          (eq, ":var4", 1),
          (val_add, ":var1", 1),
        (try_end),
        (gt, ":var1", 0),
        (assign, ":var5", -1),
        (store_random_in_range, ":var6", 0, ":var1"),
        (store_add, reg0, ":var6", 1),
        (assign, reg1, ":var1"),
        (display_message, "@Conversation #{reg0} chosen out of {reg1} total."),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (ge, ":var6", 0),
          (main_party_has_troop, ":var2"),
          (neg|troop_is_wounded, ":var2"),
          (troop_get_slot, ":var3", ":var2", 79),
          (store_and, ":var0", ":var3", 8),
          (eq, ":var0", 0),
          (assign, ":var4", 0),
          (try_begin),
            (eq, ":var2", "trp_npc_adonja"),
            (neg|main_party_has_troop, "trp_npc_ansen"),
          (else_try),
            (eq, ":var2", "trp_npc_ediz"),
            (neg|main_party_has_troop, "trp_npc_rayne"),
          (else_try),
            (eq, ":var2", "trp_npc_jocelyn"),
            (neg|main_party_has_troop, "trp_npc_alistair"),
          (else_try),
            (eq, ":var2", "trp_npc_rayne"),
            (neg|main_party_has_troop, "trp_npc_boadice"),
          (else_try),
            (eq, ":var2", "trp_npc_riva"),
            (neg|main_party_has_troop, "trp_npc_kassim"),
          (else_try),
            (eq, ":var2", "trp_npc_leslie"),
            (neg|main_party_has_troop, "trp_npc_diev"),
          (else_try),
            (eq, ":var2", "trp_npc_diev"),
            (neg|main_party_has_troop, "trp_npc_leslie"),
          (else_try),
            (assign, ":var4", 1),
          (try_end),
          (eq, ":var4", 1),
          (try_begin),
            (eq, ":var6", 0),
            (val_or, ":var3", 8),
            (troop_set_slot, ":var2", 79, ":var3"),
            (assign, ":var5", ":var2"),
          (try_end),
          (val_sub, ":var6", 1),
        (try_end),
        (assign, "$npc_dialog_partner", -1),
        (start_map_conversation, ":var5"),
        (change_screen_map),
      ]
      ),

      ("cheat_all_companions_to_basic_level",
      [
        (255),
      ],
      "All_companions_to_basic_level.",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (try_for_range, ":var1", 0, 4),
            (store_attribute_level, ":var2", ":var0", ":var1"),
            (val_mul, ":var2", -1),
            (troop_raise_attribute, ":var0", ":var1", ":var2"),
            (assign, ":var3", 5),
            (try_begin),
              (this_or_next|eq, ":var1", 0),
              (eq, ":var1", 1),
              (store_random_in_range, ":var3", 7, 15),
            (else_try),
              (store_random_in_range, ":var3", 28, 33),
            (try_end),
            (troop_raise_attribute, ":var0", ":var1", ":var3"),
          (try_end),
          (try_for_range, ":var4", 0, 37),
            (try_begin),
              (le, ":var4", 22),
              (store_random_in_range, ":var3", 8, 11),
            (else_try),
              (store_random_in_range, ":var3", 0, 3),
            (try_end),
            (store_skill_level, ":var5", ":var4", ":var0"),
            (store_sub, ":var6", ":var3", ":var5"),
            (gt, ":var6", 0),
            (troop_raise_skill, ":var0", ":var4", ":var6"),
          (try_end),
          (try_for_range, ":var7", 0, 7),
            (store_random_in_range, ":var3", 620, 651),
            (store_proficiency_level, ":var8", ":var0", ":var7"),
            (store_sub, ":var6", ":var3", ":var8"),
            (gt, ":var6", 0),
            (troop_raise_proficiency_linear, ":var0", ":var7", ":var6"),
          (try_end),
        (try_end),
      ]
      ),

      ("camp_comp_back",
      [],
      "Back_to_main_test_menu.",
      [
        (jump_to_menu, "mnu_camp_vader"),
      ]
      ),
    ],
  ),

  ("camp_vader2", mnf_scale_picture,
    "What do you want to test today?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_cheat"),
    ],
    [
      ("camp_vader_ht",
      [],
      "Give_me_Honor_troops_...",
      [
        (jump_to_menu, "mnu_camp_honor"),
      ]
      ),

      ("camp_vader_ct",
      [],
      "Give_me_cool_troops_...",
      [
        (jump_to_menu, "mnu_camp_cool"),
      ]
      ),

      ("camp_vader_rt",
      [],
      "Give_me_regular_troops_...",
      [
        (jump_to_menu, "mnu_camp_regular"),
      ]
      ),

      ("camp_vader_mf",
      [],
      "Spawn_a_minor_faction_...",
      [
        (jump_to_menu, "mnu_camp_minor"),
      ]
      ),

      ("camp_vader_sh",
      [],
      "Spawn_a_special_hero_...",
      [
        (jump_to_menu, "mnu_camp_hero"),
      ]
      ),

      ("camp_vader_ha",
      [],
      "Horsemen_of_the_Apocalypse_...",
      [
        (jump_to_menu, "mnu_camp_horsemen_apocalypse"),
      ]
      ),

      ("camp_vader_balance",
      [],
      "Balance_parties_...",
      [
        (jump_to_menu, "mnu_camp_balance"),
      ]
      ),

      ("camp_vader_back",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_action", mnf_scale_picture,
    "Choose an action:",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_chooseaction"),
    ],
    [
      ("camp_recruit_prisoners",
      [
        (troops_can_join, 1),
        (store_current_hours, ":var0"),
        (val_sub, ":var0", 24),
        (gt, ":var0", "$g_prisoner_recruit_last_time"),
        (try_begin),
          (gt, "$g_prisoner_recruit_last_time", 0),
          (assign, "$g_prisoner_recruit_troop_id", 0),
          (assign, "$g_prisoner_recruit_size", 0),
          (assign, "$g_prisoner_recruit_last_time", 0),
        (try_end),
        (neg|check_quest_active, "qst_order_challenge"),
      ],
      "Recruit_some_of_your_prisoners_to_your_party.",
      [
        (jump_to_menu, "mnu_camp_recruit_prisoners"),
      ]
      ),

      ("action_read_book",
      [],
      "Select_a_book_to_read.",
      [
        (jump_to_menu, "mnu_camp_action_read_book"),
      ]
      ),

      ("action_rename_party",
      [],
      "Rename_your_party.",
      [
        (start_presentation, "prsnt_name_party"),
      ]
      ),

      ("action_rename_kingdom",
      [
        (eq, "$players_kingdom_name_set", 1),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      ],
      "Rename_your_kingdom.",
      [
        (start_presentation, "prsnt_name_kingdom"),
      ]
      ),

      ("action_change_vassal_title",
      [
        (eq, "$players_kingdom_name_set", 1),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
      ],
      "Set_titles_of_your_noble_vassals.",
      [
        (start_presentation, "prsnt_set_vassal_title"),
      ]
      ),

      ("action_rename_order",
      [
        (eq, "$players_order_name_set", 1),
      ],
      "Rename_your_Order.",
      [
        (jump_to_menu, "mnu_auto_name_order"),
        (assign, "$menu_control", -1),
      ]
      ),

      ("action_rename_old_ruins",
      [
        (party_slot_eq, "p_old_ruins", 268, 1),
      ],
      "Rename_camp_in_the_old_ruins.",
      [
        (start_presentation, "prsnt_name_old_ruins"),
      ]
      ),

      ("action_modify_banner",
      [
        (troop_get_slot, ":var0", "trp_player", 13),
        (gt, ":var0", 0),
      ],
      "Modify_your_banner.",
      [
        (start_presentation, "prsnt_banner_selection"),
      ]
      ),

      ("action_retire",
      [],
      "Retire_from_adventuring.",
      [
        (jump_to_menu, "mnu_retirement_verify"),
      ]
      ),

      ("camp_action_4a",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_recruit_prisoners", mnf_scale_picture,
    "You offer your prisoners freedom if they agree to join you as soldiers. {s18}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_recruitprisoners"),
      (assign, ":var0", 0),
      (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
      (assign, ":var2", 0),
      (assign, ":var3", 0),
      (try_for_range, ":var4", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
        (neg|troop_is_hero, ":var5"),
        (store_character_level, ":var6", ":var5"),
        (try_begin),
          (lt, ":var6", 40),
          (neq, ":var5", "trp_noldor_warrior"),
          (neq, ":var5", "trp_noldor_ranger"),
          (try_begin),
            (troop_get_type, ":var7", ":var5"),
            (neq, ":var7", 3),
            (val_add, ":var0", 1),
          (else_try),
            (val_add, ":var3", 1),
          (try_end),
        (else_try),
          (val_add, ":var2", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (eq, ":var2", 0),
        (eq, ":var3", 0),
        (jump_to_menu, "mnu_camp_no_prisoners"),
      (else_try),
        (eq, "$g_prisoner_recruit_troop_id", 0),
        (store_current_hours, "$g_prisoner_recruit_last_time"),
        (store_random_in_range, ":var8", 0, 100),
        (store_skill_level, ":var9", "skl_persuasion", "trp_player"),
        (store_sub, ":var10", 15, ":var9"),
        (val_mul, ":var10", 4),
        (try_begin),
          (lt, ":var8", ":var10"),
          (assign, "$g_prisoner_recruit_troop_id", -7),
        (else_try),
          (assign, ":var0", 0),
          (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
          (try_for_range, ":var4", 0, ":var1"),
            (party_prisoner_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
            (neg|troop_is_hero, ":var5"),
            (store_character_level, ":var6", ":var5"),
            (try_begin),
              (lt, ":var6", 40),
              (neq, ":var5", "trp_noldor_warrior"),
              (neq, ":var5", "trp_noldor_ranger"),
              (try_begin),
                (troop_get_type, ":var7", ":var5"),
                (neq, ":var7", 3),
                (val_add, ":var0", 1),
              (try_end),
            (try_end),
          (try_end),
          (store_random_in_range, ":var11", 0, ":var0"),
          (try_for_range, ":var4", 0, ":var1"),
            (party_prisoner_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
            (neg|troop_is_hero, ":var5"),
            (store_character_level, ":var6", ":var5"),
            (try_begin),
              (lt, ":var6", 40),
              (neq, ":var5", "trp_noldor_warrior"),
              (neq, ":var5", "trp_noldor_ranger"),
              (try_begin),
                (troop_get_type, ":var7", ":var5"),
                (neq, ":var7", 3),
                (val_sub, ":var11", 1),
                (lt, ":var11", 0),
                (assign, ":var1", 0),
                (assign, "$g_prisoner_recruit_troop_id", ":var5"),
                (party_prisoner_stack_get_size, "$g_prisoner_recruit_size", "p_main_party", ":var4"),
              (try_end),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (gt, "$g_prisoner_recruit_troop_id", 0),
          (party_get_free_companions_capacity, ":var12", "p_main_party"),
          (val_min, "$g_prisoner_recruit_size", ":var12"),
          (assign, reg1, "$g_prisoner_recruit_size"),
          (gt, "$g_prisoner_recruit_size", 0),
          (try_begin),
            (gt, "$g_prisoner_recruit_size", 1),
            (assign, reg2, 1),
          (else_try),
            (assign, reg2, 0),
          (try_end),
          (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
          (str_store_string, s18, "@{reg1} {s1} {reg2?accept:accepts} the offer."),
        (else_try),
          (str_store_string, s18, "@No one accepts the offer."),
          (try_begin),
            (ge, ":var2", 1),
            (assign, reg1, ":var2"),
            (store_sub, reg2, ":var2", 1),
            (str_store_string, s18, "@{s18}^^ There {reg2?are:is} {reg1} {reg2?types:type} of Elite troops present that cannot be persuaded to join your cause."),
          (try_end),
          (try_begin),
            (ge, ":var3", 1),
            (assign, reg1, ":var3"),
            (store_sub, reg2, ":var3", 1),
            (str_store_string, s18, "@{s18}^^ There {reg2?are:is} {reg1} {reg2?types:type} of undead troops present that cannot be persuaded to join your cause."),
          (try_end),
        (try_end),
      (try_end),
    ],
    [
      ("camp_recruit_prisoners_accept",
      [
        (gt, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Take_them.",
      [
        (remove_troops_from_prisoners, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (party_add_members, "p_main_party", "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (store_mul, ":var0", -3, "$g_prisoner_recruit_size"),
        (call_script, "script_change_player_party_morale", ":var0"),
        (jump_to_menu, "mnu_camp"),
      ]
      ),

      ("camp_recruit_prisoners_reject",
      [
        (gt, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Reject_them.",
      [
        (jump_to_menu, "mnu_camp"),
        (assign, "$g_prisoner_recruit_troop_id", 0),
        (assign, "$g_prisoner_recruit_size", 0),
      ]
      ),

      ("go_back_dot",
      [
        (le, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Go_back.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_no_prisoners", mnf_scale_picture,
    "You have no prisoners to recruit from.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_recruitprisoners"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_action_read_book", mnf_scale_picture,
    "Choose a book to read:",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_readbook"),
    ],
    [
      ("action_read_book_1",
      [
        (player_has_item, "itm_book_tactics"),
        (item_slot_eq, "itm_book_tactics", 3, 0),
        (str_store_item_name, s1, "itm_book_tactics"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_tactics"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_2",
      [
        (player_has_item, "itm_book_persuasion"),
        (item_slot_eq, "itm_book_persuasion", 3, 0),
        (str_store_item_name, s1, "itm_book_persuasion"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_persuasion"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_3",
      [
        (player_has_item, "itm_book_leadership"),
        (item_slot_eq, "itm_book_leadership", 3, 0),
        (str_store_item_name, s1, "itm_book_leadership"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_leadership"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_4",
      [
        (player_has_item, "itm_book_intelligence"),
        (item_slot_eq, "itm_book_intelligence", 3, 0),
        (str_store_item_name, s1, "itm_book_intelligence"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_intelligence"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_5",
      [
        (player_has_item, "itm_book_trade"),
        (item_slot_eq, "itm_book_trade", 3, 0),
        (str_store_item_name, s1, "itm_book_trade"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_trade"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_6",
      [
        (player_has_item, "itm_book_weapon_mastery"),
        (item_slot_eq, "itm_book_weapon_mastery", 3, 0),
        (str_store_item_name, s1, "itm_book_weapon_mastery"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_weapon_mastery"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_7",
      [
        (player_has_item, "itm_book_engineering"),
        (item_slot_eq, "itm_book_engineering", 3, 0),
        (str_store_item_name, s1, "itm_book_engineering"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_engineering"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_8",
      [
        (player_has_item, "itm_book_noldor_1"),
        (item_slot_eq, "itm_book_noldor_1", 3, 0),
        (str_store_item_name, s1, "itm_book_noldor_1"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_noldor_1"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_9",
      [
        (player_has_item, "itm_book_noldor_2"),
        (item_slot_eq, "itm_book_noldor_2", 3, 0),
        (str_store_item_name, s1, "itm_book_noldor_2"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_noldor_2"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_10",
      [
        (player_has_item, "itm_book_noldor_3"),
        (item_slot_eq, "itm_book_noldor_3", 3, 0),
        (str_store_item_name, s1, "itm_book_noldor_3"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_noldor_3"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_11",
      [
        (player_has_item, "itm_book_old_diary"),
        (item_slot_eq, "itm_book_old_diary", 3, 0),
        (str_store_item_name, s1, "itm_book_old_diary"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_old_diary"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("camp_action_4a",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_action_read_book_start", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_readbook"),
      (assign, ":var0", "$temp"),
      (str_store_item_name, s2, ":var0"),
      (try_begin),
        (store_attribute_level, ":var1", "trp_player", ca_intelligence),
        (item_get_slot, ":var2", ":var0", 4),
        (le, ":var2", ":var1"),
        (str_store_string, s1, "@You start reading {s2}. After a few pages, you feel you could learn a lot from this book. You decide to keep it close by and read whenever you have the time."),
        (assign, "$g_player_reading_book", ":var0"),
      (else_try),
        (str_store_string, s1, "@You flip through the pages of {s2}, but you find the text confusing and difficult to follow. Try as you might, it soon gives you a headache, and you're forced to give up the attempt."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("retirement_verify", mnf_scale_picture,
    "You are at day {reg0}. Your current luck is {reg1}. Are you sure you want to retire?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_endgame"),
      (store_current_day, reg0),
      (assign, reg1, "$g_player_luck"),
    ],
    [
      ("retire_yes",
      [],
      "Yes.",
      [
        (start_presentation, "prsnt_retirement"),
      ]
      ),

      ("retire_no",
      [],
      "No.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("end_game", mnf_scale_picture,
    "The decision is made, and you resolve to give up your adventurer's life and settle down. You sell off your weapons and armor, gather up all your money, and ride off into the sunset...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_endgame"),
    ],
    [
      ("end_game_bye",
      [],
      "Farewell.",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("cattle_herd", mnf_scale_picture,
    "You encounter a herd of cattle.",
    "none",
    [
      (play_sound, "snd_cow_moo"),
      (set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("cattle_drive_away",
      [],
      "Drive_the_cattle_onward.",
      [
        (party_set_slot, "$g_encountered_party", 7, 1),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_escort_party),
        (party_set_ai_object, "$g_encountered_party", "p_main_party"),
        (change_screen_return),
      ]
      ),

      ("cattle_stop",
      [],
      "Bring_the_herd_to_a_stop.",
      [
        (party_set_slot, "$g_encountered_party", 7, 0),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_hold),
        (change_screen_return),
      ]
      ),

      ("cattle_kill",
      [
        (assign, ":var0", 1),
        (try_begin),
          (check_quest_active, "qst_move_cattle_herd"),
          (quest_slot_eq, "qst_move_cattle_herd", 8, "$g_encountered_party"),
          (assign, ":var0", 0),
        (try_end),
        (eq, ":var0", 1),
      ],
      "Slaughter_some_of_the_animals.",
      [
        (jump_to_menu, "mnu_cattle_herd_kill"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("cattle_herd_kill", mnf_scale_picture,
    "How many animals do you want to slaughter?",
    "none",
    [
      (play_sound, "snd_cow_moo"),
      (set_background_mesh, "mesh_pic_cattle"),
      (party_get_num_companions, reg5, "$g_encountered_party"),
    ],
    [
      ("cattle_kill_1",
      [
        (ge, reg5, 1),
      ],
      "One.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 1),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_2",
      [
        (ge, reg5, 2),
      ],
      "Two.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 2),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_3",
      [
        (ge, reg5, 3),
      ],
      "Three.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 3),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_4",
      [
        (ge, reg5, 4),
      ],
      "Four.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 4),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_5",
      [
        (ge, reg5, 5),
      ],
      "Five.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 5),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_cattle_herd"),
      ]
      ),
    ],
  ),

  ("cattle_herd_kill_end", 0,
    "{!}You shouldn't be reading this.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("arena_duel_fight", 0,
    "You and your opponent prepare to fight for honor.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_leave_encounter", 0),
        (try_begin),
          (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var0", "$g_encountered_party", 16),
        (else_try),
          (eq, "$g_start_arena_fight_at_nearest_town", 1),
          (assign, ":var1", -1),
          (assign, ":var2", 10000),
          (try_for_range, ":var3", "p_town_1", "p_castle_1"),
            (store_distance_to_party_from_party, ":var4", ":var3", "$g_encountered_party"),
            (lt, ":var4", ":var2"),
            (assign, ":var2", ":var4"),
            (assign, ":var1", ":var3"),
          (try_end),
          (try_begin),
            (ge, ":var1", 0),
            (party_get_slot, ":var0", ":var1", 16),
          (try_end),
          (assign, "$g_start_arena_fight_at_nearest_town", 0),
        (else_try),
          (party_get_current_terrain, ":var5", "p_main_party"),
          (eq, ":var5", 4),
          (assign, ":var0", "scn_training_ground_ranged_melee_3"),
        (else_try),
          (eq, ":var5", 5),
          (assign, ":var0", "scn_training_ground_ranged_melee_4"),
        (else_try),
          (assign, ":var0", "scn_training_ground_ranged_melee_1"),
        (try_end),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 1, "$g_duel_troop"),
        (set_jump_mission, "mt_duel_with_lord"),
        (jump_to_scene, ":var0"),
        (jump_to_menu, "mnu_arena_duel_conclusion"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("arena_duel_conclusion", 0,
    "{!}{s11}",
    "none",
    [
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (str_store_troop_name, s10, "$g_duel_troop"),
      (try_begin),
        (quest_slot_eq, "qst_duel_for_lady", 2, "$g_duel_troop"),
        (check_quest_failed, "qst_duel_for_lady"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_duel_for_lady", 2, "$g_duel_troop"),
        (check_quest_succeeded, "qst_duel_for_lady"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_duel_troop"),
        (check_quest_failed, "qst_duel_courtship_rival"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_duel_courtship_rival", 2, "$g_duel_troop"),
        (check_quest_succeeded, "qst_duel_courtship_rival"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_duel_avenge_insult", 2, "$g_duel_troop"),
        (check_quest_succeeded, "qst_duel_avenge_insult"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_duel_avenge_insult", 2, "$g_duel_troop"),
        (check_quest_failed, "qst_duel_avenge_insult"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_denounce_lord", 2, "$g_duel_troop"),
        (check_quest_succeeded, "qst_denounce_lord"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
      (else_try),
        (quest_slot_eq, "qst_denounce_lord", 2, "$g_duel_troop"),
        (check_quest_failed, "qst_denounce_lord"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
      (else_try),
        (str_store_troop_name, s10, "$g_duel_troop"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_get_meeting_scene"),
        (assign, ":var0", reg0),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, "$g_duel_troop"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, ":var0"),
        (assign, "$talk_context", 17),
        (change_screen_map_conversation, "$g_duel_troop"),
      ]
      ),
    ],
  ),

  ("simple_encounter", mnf_enable_hot_keys|mnf_scale_picture,
    "{s2} You have {reg10} troops fit for battle against their {reg11}.",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (assign, "$g_encounter_is_in_village", 0),
        (assign, "$g_encounter_type", 0),
        (try_begin),
          (party_slot_eq, "$g_enemy_party", 4, 5),
          (party_get_slot, ":var0", "$g_enemy_party", 5),
          (store_distance_to_party_from_party, ":var1", ":var0", "$g_enemy_party"),
          (try_begin),
            (lt, ":var1", 4),
            (assign, "$g_encounter_is_in_village", ":var0"),
            (assign, "$g_encounter_type", 1),
          (try_end),
        (try_end),
        (try_begin),
          (gt, "$g_player_raiding_village", 0),
          (assign, "$g_encounter_is_in_village", "$g_player_raiding_village"),
          (assign, "$g_encounter_type", 2),
          (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 1),
          (str_store_string, s7, "@Villagers"),
          (display_message, "str_s1_joined_battle_enemy", 0xFF5050),
        (else_try),
          (eq, "$g_encounter_type", 1),
          (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 0),
          (str_store_string, s7, "@Villagers"),
          (display_message, "str_s1_joined_battle_friend", 0x50FF50),
        (try_end),
        (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
        (call_script, "script_encounter_init_variables"),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
          (gt, "$g_encountered_party_relation", 0),
          (assign, "$encountered_party_friendly", 1),
        (try_end),
        (try_begin),
          (lt, "$g_encountered_party_relation", 0),
          (assign, "$encountered_party_hostile", 1),
          (try_begin),
            (encountered_party_is_attacker),
            (assign, "$cant_leave_encounter", 1),
          (try_end),
        (try_end),
        (assign, "$talk_context", 2),
        (call_script, "script_setup_party_meeting", "$g_encountered_party"),
      (else_try),
        (try_begin),
          (eq, "$cant_leave_encounter", 1),
          (call_script, "script_party_count_members_with_full_health", "p_main_party_backup"),
          (assign, ":var2", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_encountered_party_backup"),
          (val_add, ":var2", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (assign, ":var3", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (val_add, ":var3", reg0),
          (store_sub, ":var4", ":var2", 10),
          (lt, ":var3", ":var4"),
          (assign, "$cant_leave_encounter", 0),
        (try_end),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (try_begin),
        (party_is_active, "$g_encountered_party"),
        (str_store_party_name, s1, "$g_encountered_party"),
        (try_begin),
          (eq, "$g_encounter_type", 0),
          (str_store_string, s2, "@You have encountered {s1}."),
        (else_try),
          (eq, "$g_encounter_type", 1),
          (str_store_party_name, s3, "$g_encounter_is_in_village"),
          (str_store_string, s2, "@You have engaged {s1} while they were raiding {s3}."),
        (else_try),
          (eq, "$g_encounter_type", 2),
          (str_store_party_name, s3, "$g_encounter_is_in_village"),
          (str_store_string, s2, "@You were caught by {s1} while your forces were raiding {s3}."),
        (try_end),
      (try_end),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var5", reg0),
        (assign, ":var6", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (this_or_next|le, ":var5", 0),
          (le, ":var5", "$num_routed_enemies"),
          (assign, ":var6", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (this_or_next|le, ":var5", 0),
          (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var6", 1),
        (try_end),
        (this_or_next|eq, ":var6", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", -1),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var7", reg0),
        (assign, ":var8", 0),
        (try_begin),
          (eq, "$g_battle_result", -1),
          (le, ":var7", "$num_routed_us"),
          (assign, ":var8", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (ge, "$g_enemy_fit_for_battle", 1),
          (le, "$g_friend_fit_for_battle", 0),
          (assign, ":var8", 1),
        (try_end),
        (this_or_next|eq, ":var8", 1),
        (eq, "$g_player_surrenders", 1),
        (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
      (call_script, "script_get_illustration_for_encounter"),
    ],
    [
      ("encounter_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Charge_the_enemy.",
      [
        (assign, "$g_battle_result", 0),
        (assign, "$g_engaged_enemy", 1),
        (party_get_template_id, ":var0", "$g_encountered_party"),
        (try_begin),
          (eq, ":var0", "pt_village_farmers"),
          (372, 27),
        (try_end),
        (try_begin),
          (check_quest_active, "qst_order_bounty"),
          (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
          (party_set_slot, "$g_encountered_party", 56, reg0),
          (party_get_num_attached_parties, ":var1", "$g_encountered_party"),
          (try_for_range, ":var2", 0, ":var1"),
            (party_get_attached_party_with_rank, ":var3", "$g_encountered_party", ":var2"),
            (call_script, "script_party_calculate_strength", ":var3", 0),
            (party_set_slot, ":var3", 56, reg0),
          (try_end),
        (try_end),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (neq, "$music_track_enemy", 0),
          (try_begin),
            (eq, "$music_track_enemy_playing", 1),
            (assign, "$music_track_enemy_playing", 0),
          (else_try),
            (music_set_situation, mtf_sit_fight),
            (play_track, "$music_track_enemy", 1),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_encounter_type", 1),
          (assign, "$g_village_raid_evil", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var4", "$g_encounter_is_in_village", 10),
          (jump_to_scene, ":var4"),
        (else_try),
          (eq, "$g_encounter_type", 2),
          (assign, "$g_village_raid_evil", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var4", "$g_encounter_is_in_village", 10),
          (jump_to_scene, ":var4"),
        (else_try),
          (set_jump_mission, "mt_lead_charge"),
          (call_script, "script_party_count_fit_for_battle", "p_collective_ally", 0),
          (assign, ":var5", reg0),
          (call_script, "script_party_count_fit_for_battle", "p_collective_enemy", 0),
          (assign, ":var6", reg0),
          (store_add, ":var7", ":var5", ":var6"),
          (call_script, "script_setup_random_scene", ":var7"),
        (try_end),
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("encounter_order_attack",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 4),
      ],
      "Order_your_troops_to_attack_without_you.",
      [
        (jump_to_menu, "mnu_order_attack_begin"),
      ]
      ),

#COOP BEGIN Battle#############################		  
      ("coop_setup",[
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
      ],"Setup multiplayer battle.", 
      [   
        #need to attach villagers to battle
        (try_begin),
          (eq, "$g_encounter_type", enctype_catched_during_village_raid), #if player is raiding
          (gt, "$g_player_raiding_village", 0),
          (party_attach_to_party, "$g_encounter_is_in_village", "$g_enemy_party"),
          (assign, "$coop_encountered_party", "$g_enemy_party"),
          (assign, "$coop_battle_type", coop_battle_type_village_player_attack),
        (else_try),
          (eq, "$g_encounter_type", enctype_fighting_against_village_raid),#if enemy lord is raiding
          (assign, "$g_ally_party", "$g_encounter_is_in_village"),
          (assign, "$coop_encountered_party", "$g_enemy_party"),
          (assign, "$coop_battle_type", coop_battle_type_village_player_defend),
        (else_try),
          (assign, "$coop_battle_type", coop_battle_type_field_battle), #normal field battle
          (assign, "$coop_encountered_party", "$g_enemy_party"),
        (try_end),

        (call_script, "script_coop_copy_parties_to_file_sp"), # set coop_battle_state to 1
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
      ]),	

      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_coop_copy_file_to_parties_sp"),	   # set coop_battle_state to 0
        (assign, "$g_engaged_enemy", 1),
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
      ]),		 
 
      ("encounter_save",[],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),		  
#COOP END##########################################

      ("encounter_leave",
      [
        (eq, "$cant_leave_encounter", 0),
      ],
      "Leave.",
      [
        (try_begin),
          (eq, "$encountered_party_friendly", 0),
          (encountered_party_is_attacker),
          (call_script, "script_objectionable_action", 1, "str_flee_battle"),
        (try_end),
        (try_begin),
          (eq, "$encountered_party_friendly", 0),
          (party_get_num_companion_stacks, ":var0", "p_encountered_party_backup"),
          (try_for_range, ":var1", 0, ":var0"),
            (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
            (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
            (troop_slot_eq, ":var2", 2, 2),
            (store_troop_faction, ":var3", ":var2"),
            (call_script, "script_add_log_entry", 15, "trp_player", -1, ":var2", ":var3"),
          (try_end),
        (try_end),
        (leave_encounter),
        (change_screen_return),
      ]
      ),

      ("encounter_retreat",
      [
        (eq, "$cant_leave_encounter", 1),
        (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
        (assign, ":var0", reg0),
        (val_add, ":var0", 4),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
        (assign, ":var1", reg0),
        (val_div, ":var1", 2),
        (val_div, ":var1", ":var0"),
        (val_max, ":var1", 1),
        (call_script, "script_party_count_fit_regulars", "p_main_party"),
        (assign, ":var2", reg0),
        (ge, ":var2", ":var1"),
      ],
      "Pull_back,_leaving_some_soldiers_behind_to_cover_your_retreat.",
      [
        (jump_to_menu, "mnu_encounter_retreat_confirm"),
      ]
      ),

      ("encounter_surrender",
      [
        (eq, "$cant_leave_encounter", 1),
      ],
      "Surrender.",
      [
        (jump_to_menu, "mnu_encounter_surrender_confirm"),
      ]
      ),
    ],
  ),

  ("encounter_surrender_confirm", mnf_scale_picture,
    "Do you want to surrender?",
    "none",
    [
      (set_background_mesh, "mesh_pic_prisoner_wilderness"),
    ],
    [
      ("encounter_surrender_yes",
      [],
      "Yes,_there_is_no_hope.",
      [
        (assign, "$g_player_surrenders", 1),
        (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
        (jump_to_menu, "mnu_total_defeat"),
      ]
      ),

      ("encounter_surrender_no",
      [],
      "No!_I_will_fight_to_the_end.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("encounter_retreat_confirm", mnf_scale_picture,
    "As the party member with the highest tactics skill, ({reg2}), {reg3?you devise:{s3} devises} a plan that will allow you and your men to escape with your lives, but you'll have to leave {reg4} soldiers behind to stop the enemy from giving chase.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_retreat"),
      (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (val_add, ":var0", 4),
      (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 2),
      (store_div, reg4, ":var2", ":var0"),
      (val_max, reg4, 1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("leave_behind",
      [],
      "Go_on._The_sacrifice_of_these_men_will_save_the_rest.",
      [
        (assign, ":var0", reg4),
        (try_for_range, ":var1", 0, ":var0"),
          (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
          (assign, ":var2", reg0),
          (store_random_in_range, ":var3", 0, 100),
          (ge, ":var3", 30),
          (party_add_prisoners, "$g_encountered_party", ":var2", 1),
        (try_end),
        (call_script, "script_change_player_party_morale", -20),
        (jump_to_menu, "mnu_encounter_retreat"),
      ]
      ),

      ("dont_leave_behind",
      [],
      "No._We_leave_no_one_behind.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("encounter_retreat", mnf_scale_picture,
    "You tell {reg4} of your troops to hold the enemy while you retreat with the rest of your party.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_retreat"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_objectionable_action", 1, "str_flee_battle"),
        (party_get_num_companion_stacks, ":var0", "p_encountered_party_backup"),
        (try_for_range, ":var1", 0, ":var0"),
          (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
          (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var2", 2, 2),
          (store_troop_faction, ":var3", ":var2"),
          (call_script, "script_add_log_entry", 16, "trp_player", -1, ":var2", ":var3"),
        (try_end),
        (party_ignore_player, "$g_encountered_party", 1),
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("order_attack_begin", mnf_scale_picture,
    "Your troops prepare to attack the enemy.",
    "none",
    [
      (set_background_mesh, "mesh_pic_charge"),
    ],
    [
      ("order_attack_begin",
      [],
      "Order_the_attack_to_begin.",
      [
        (party_get_template_id, ":var0", "$g_encountered_party"),
        (try_begin),
          (eq, ":var0", "pt_village_farmers"),
          (372, 27),
        (try_end),
        (assign, "$g_engaged_enemy", 1),
        (jump_to_menu, "mnu_order_attack_2"),
      ]
      ),

      ("call_back",
      [],
      "Call_them_back.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("order_attack_2", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties: {s8}^^Enemy casualties: {s9}^^Allies remaining: {reg10}^Enemies remaining: {reg11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_charge"),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "p_main_party", 1, 0),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (call_script, "script_kt_party_calculate_strength", "p_collective_enemy", 0, 0),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
      (try_begin),
        (store_faction_of_party, ":var4", "$g_encountered_party"),
        (eq, ":var4", "fac_noldor_elves"),
        (val_mul, ":var2", 2),
        (store_sub, ":var3", 100, ":var3"),
        (val_mul, ":var3", 2),
        (val_clamp, ":var3", 0, 90),
        (store_sub, ":var3", 100, ":var3"),
      (try_end),
      (val_mul, ":var0", ":var3"),
      (val_mul, ":var2", ":var1"),
      (val_div, ":var0", 100),
      (val_div, ":var2", 100),
      (val_max, ":var0", 1),
      (val_max, ":var2", 1),
      (val_div, ":var0", 50),
      (val_div, ":var2", 50),
      (inflict_casualties_to_party_group, "p_main_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_encountered_party", ":var0", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_get_num_companion_stacks, ":var5", "p_temp_casualties"),
      (try_for_range, ":var6", 0, ":var5"),
        (party_stack_get_troop_id, ":var7", "p_temp_casualties", ":var6"),
        (try_begin),
          (party_stack_get_size, ":var8", "p_temp_casualties", ":var6"),
          (gt, ":var8", 0),
          (party_add_members, "p_total_enemy_casualties", ":var7", ":var8"),
          (party_stack_get_num_wounded, ":var9", "p_temp_casualties", ":var6"),
          (gt, ":var9", 0),
          (party_wound_members, "p_total_enemy_casualties", ":var7", ":var9"),
        (try_end),
      (try_end),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var10", reg0),
        (store_add, ":var11", "$num_routed_us", 1),
        (le, ":var10", ":var11"),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var12", reg0),
        (this_or_next|le, ":var12", 0),
        (le, ":var12", "$num_routed_enemies"),
        (assign, ":var13", 0),
        (party_get_num_companion_stacks, ":var14", "p_collective_enemy"),
        (try_begin),
          (eq, ":var14", 0),
          (assign, ":var13", 1),
        (else_try),
          (party_stack_get_troop_id, ":var15", "p_collective_enemy", 0),
          (try_begin),
            (neg|troop_is_hero, ":var15"),
            (assign, ":var13", 1),
          (else_try),
            (troop_is_wounded, ":var15"),
            (assign, ":var13", 1),
          (try_end),
        (try_end),
        (eq, ":var13", 1),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_order_attack_continue"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
    ],
    [
      ("order_attack_continue",
      [
        (eq, "$no_soldiers_left", 0),
      ],
      "Order_your_soldiers_to_continue_the_attack.",
      [
        (jump_to_menu, "mnu_order_attack_2"),
      ]
      ),

      ("order_retreat",
      [
        (eq, "$no_soldiers_left", 0),
      ],
      "Call_your_soldiers_back.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),

      ("continue",
      [
        (eq, "$no_soldiers_left", 1),
      ],
      "Continue...",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("battle_debrief", mnf_disable_all_keys|mnf_scale_picture,
    "{s11}^^Your casualties:{s8}{s10}^^Enemy casualties:{s9}^^Kill count:{s12}",
    "none",
    [
      (assign, "$dont_use_fist_enable", 0),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (call_script, "script_change_troop_renown", "trp_player", "$battle_renown_value"),
        (try_begin),
          (check_quest_active, "qst_order_challenge"),
          (neg|check_quest_succeeded, "qst_order_challenge"),
          (neg|check_quest_failed, "qst_order_challenge"),
          (quest_get_slot, ":var0", "qst_order_challenge", 17),
          (val_add, ":var0", "$battle_renown_value"),
          (quest_set_slot, "qst_order_challenge", 17, ":var0"),
          (assign, reg1, ":var0"),
          (quest_get_slot, reg2, "qst_order_challenge", 10),
          (display_message, "@Challenge quest renown earned so far: {reg1}/{reg2}."),
          (str_store_string, s3, "@Renown earned so far: {reg1}."),
          (add_quest_note_from_sreg, "qst_order_challenge", 3, s3, 0),
          (try_begin),
            (ge, reg1, reg2),
            (call_script, "script_succeed_quest", "qst_order_challenge"),
          (try_end),
        (try_end),
        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (eq, ":var1", "pt_kingdom_caravan_party"),
          (370, ":var2", 30, 0),
          (370, ":var3", 30, 1),
          (val_add, ":var3", 1),
          (371, 30, 1, ":var3"),
          (try_begin),
            (ge, ":var2", 3),
            (ge, ":var3", 3),
            (372, 30),
          (try_end),
        (try_end),
        (try_begin),
          (party_get_current_terrain, ":var4", "p_main_party"),
          (eq, ":var4", 4),
          (370, ":var5", 8, 0),
          (val_add, ":var5", 1),
          (371, 8, 0, ":var5"),
          (try_begin),
            (eq, ":var5", 10),
            (372, 8),
          (try_end),
        (try_end),
        (try_begin),
          (ge, "$g_enemy_party", 0),
          (party_is_active, "$g_enemy_party"),
          (party_stack_get_troop_id, ":var6", "$g_enemy_party", 0),
          (eq, ":var6", "trp_mountain_bandit"),
          (370, ":var7", 13, 0),
          (val_add, ":var7", 1),
          (371, 13, 0, ":var7"),
          (try_begin),
            (eq, ":var7", 10),
            (372, 13),
          (try_end),
        (try_end),
        (try_begin),
          (is_between, "$g_ally_party", "p_town_1", "p_village_1"),
          (372, 1),
        (try_end),
        (try_begin),
          (eq, "$g_joined_battle_to_help", 1),
          (372, 34),
        (try_end),
      (try_end),
      (assign, "$g_joined_battle_to_help", 0),
      (call_script, "script_count_casualties_and_adjust_morale"),
      (call_script, "script_encounter_calculate_fit"),
      (call_script, "script_party_count_fit_regulars", "p_main_party"),
      (assign, "$playerparty_postbattle_regulars", reg0),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (eq, "$g_enemy_fit_for_battle", 0),
        (str_store_string, s11, "@You were victorious!"),
        (call_script, "script_music_set_situation_with_culture", 8388608),
        (try_begin),
          (gt, "$g_friend_fit_for_battle", 1),
          (set_background_mesh, "mesh_pic_victory"),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", -1),
        (ge, "$g_enemy_fit_for_battle", 1),
        (this_or_next|le, "$g_friend_fit_for_battle", 0),
        (le, "$playerparty_postbattle_regulars", 0),
        (str_store_string, s11, "@The battle was lost. Your forces were utterly crushed."),
        (set_background_mesh, "mesh_pic_defeat"),
      (else_try),
        (eq, "$g_battle_result", -1),
        (str_store_string, s11, "@Your companions carry you away from the fighting."),
        (troop_get_type, ":var8", "trp_player"),
        (try_begin),
          (ge, ":var8", 1),
          (set_background_mesh, "mesh_pic_wounded_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_wounded"),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", 1),
        (str_store_string, s11, "@You have defeated the enemy."),
        (try_begin),
          (gt, "$g_friend_fit_for_battle", 1),
          (set_background_mesh, "mesh_pic_victory"),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", 0),
        (is_between, "$g_enemy_party", "p_town_1", "p_village_1"),
        (str_store_string, s11, "@You have retreated from the siege."),
        (set_background_mesh, "mesh_pic_pendor_retreat"),
        (call_script, "script_change_troop_renown", "trp_player", -20),
        (call_script, "script_change_player_honor", -2),
        (call_script, "script_change_player_party_morale", -15),
        (troop_get_slot, ":var9", "trp_player", 150),
        (store_random_in_range, ":var10", 0, 3),
        (try_begin),
          (gt, ":var10", 0),
          (val_add, ":var9", ":var10"),
          (val_min, ":var9", 100),
          (troop_set_slot, "trp_player", 150, ":var9"),
          (display_message, "@Your controversy has increased due to this retreat.", 0xFF5050),
        (try_end),
        (eq, "$pop_kingdom", 1),
        (try_for_range, ":var11", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var11", 2, 2),
          (store_troop_faction, ":var12", ":var11"),
          (eq, ":var12", "fac_player_supporters_faction"),
          (store_random_in_range, ":var10", 1, 11),
          (ge, ":var10", 9),
          (call_script, "script_troop_change_relation_with_troop", "trp_player", ":var11", -1),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", 0),
        (str_store_string, s11, "@You have retreated from the fight."),
        (set_background_mesh, "mesh_pic_pendor_retreat"),
      (try_end),
      (try_begin),
        (gt, "$playerparty_prebattle_regulars", 9),
        (store_add, ":var13", 3, "$g_battle_result"),
        (store_div, ":var14", "$playerparty_prebattle_regulars", ":var13"),
        (lt, "$playerparty_postbattle_regulars", ":var14"),
        (call_script, "script_objectionable_action", 2, "str_excessive_casualties"),
      (try_end),
      (call_script, "script_print_casualties_to_s0", "p_player_casualties", 0),
      (str_store_string_reg, s8, s0),
      (call_script, "script_print_casualties_to_s0", "p_enemy_casualties", 0),
      (str_store_string_reg, s9, s0),
      (call_script, "script_print_kill_count_to_s0"),
      (str_store_string_reg, s12, s0),
      (str_clear, s10),
      (try_begin),
        (eq, "$any_allies_at_the_last_battle", 1),
        (call_script, "script_print_casualties_to_s0", "p_ally_casualties", 0),
        (str_store_string, s10, "@^^Ally Casualties:{s0}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "$g_next_menu"),
      ]
      ),
    ],
  ),

  ("total_victory", 0,
    "You shouldn't be reading this... {s9}",
    "none",
    [
      (assign, ":var0", 0),
      (try_begin),
        (eq, "$routed_party_added", 0),
        (assign, "$routed_party_added", 1),
        (call_script, "script_add_routed_party"),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_track_down_bandits"),
        (neg|check_quest_succeeded, "qst_track_down_bandits"),
        (neg|check_quest_failed, "qst_track_down_bandits"),
        (quest_get_slot, ":var1", "qst_track_down_bandits", 8),
        (party_is_active, ":var1"),
        (party_get_attached_to, ":var2"),
        (this_or_next|eq, ":var1", "$g_enemy_party"),
        (eq, ":var2", "$g_enemy_party"),
        (try_begin),
          (gt, "$g_starting_strength_friends", "$g_starting_strength_main_party"),
          (store_add, ":var3", "$g_starting_strength_main_party", "$g_starting_strength_friends"),
          (quest_get_slot, ":var4", "qst_track_down_bandits", 21),
          (val_mul, ":var4", "$g_starting_strength_main_party"),
          (val_div, ":var4", ":var3"),
          (val_max, ":var4", 100),
          (quest_set_slot, "qst_track_down_bandits", 21, ":var4"),
          (quest_get_slot, ":var5", "qst_track_down_bandits", 22),
          (val_mul, ":var5", "$g_starting_strength_main_party"),
          (val_div, ":var5", ":var3"),
          (val_max, ":var5", 100),
          (quest_set_slot, "qst_track_down_bandits", 22, ":var5"),
        (try_end),
        (call_script, "script_succeed_quest", "qst_track_down_bandits"),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_retaliate_for_border_incident"),
        (quest_get_slot, ":var6", "qst_retaliate_for_border_incident", 2),
        (troop_slot_eq, ":var6", 10, "$g_encountered_party"),
        (call_script, "script_finish_quest_simple", "qst_retaliate_for_border_incident", 100),
        (try_begin),
          (quest_get_slot, ":var7", "qst_retaliate_for_border_incident", 6),
          (store_troop_faction, ":var8", ":var7"),
          (call_script, "script_faction_follows_controversial_policy", ":var8", 81),
        (try_end),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_rescue_daughter"),
        (neg|check_quest_succeeded, "qst_rescue_daughter"),
        (quest_get_slot, ":var6", "qst_rescue_daughter", 2),
        (troop_slot_eq, ":var6", 10, "$g_encountered_party"),
        (party_force_add_members, "p_main_party", "trp_kidnapped_daughter", 1),
        (call_script, "script_succeed_quest", "qst_rescue_daughter"),
      (try_end),
      (try_begin),
        (eq, "$order_bounty_progress_added", 0),
        (assign, "$order_bounty_progress_added", 1),
        (check_quest_active, "qst_order_bounty"),
        (neg|check_quest_succeeded, "qst_order_bounty"),
        (neg|check_quest_failed, "qst_order_bounty"),
        (quest_get_slot, ":var9", "qst_order_bounty", 17),
        (assign, ":var10", 0),
        (quest_get_slot, ":var11", "qst_order_bounty", 6),
        (store_troop_faction, ":var12", ":var11"),
        (party_get_slot, ":var13", "$g_enemy_party", 56),
        (try_begin),
          (store_faction_of_party, ":var14", "$g_enemy_party"),
          (party_get_template_id, ":var15", "$g_enemy_party"),
          (assign, ":var16", 0),
          (try_begin),
            (neg|faction_slot_eq, ":var12", 100, 0),
            (faction_slot_eq, ":var12", 100, ":var14"),
            (assign, ":var16", 1),
          (else_try),
            (neg|faction_slot_eq, ":var12", 101, 0),
            (faction_slot_eq, ":var12", 101, ":var14"),
            (assign, ":var16", 1),
          (else_try),
            (neg|faction_slot_eq, ":var12", 102, 0),
            (faction_slot_eq, ":var12", 102, ":var15"),
            (assign, ":var16", 1),
          (else_try),
            (neg|faction_slot_eq, ":var12", 103, 0),
            (faction_slot_eq, ":var12", 103, ":var15"),
            (assign, ":var16", 1),
          (try_end),
          (eq, ":var16", 1),
          (val_add, ":var10", ":var13"),
        (try_end),
        (party_set_slot, "$g_enemy_party", 56, 0),
        (party_get_num_attached_parties, ":var17", "$g_enemy_party"),
        (try_for_range, ":var18", 0, ":var17"),
          (party_get_attached_party_with_rank, ":var19", "$g_enemy_party", ":var18"),
          (party_get_slot, ":var13", ":var19", 56),
          (try_begin),
            (store_faction_of_party, ":var14", "$g_enemy_party"),
            (party_get_template_id, ":var15", "$g_enemy_party"),
            (assign, ":var16", 0),
            (try_begin),
              (neg|faction_slot_eq, ":var12", 100, 0),
              (faction_slot_eq, ":var12", 100, ":var14"),
              (assign, ":var16", 1),
            (else_try),
              (neg|faction_slot_eq, ":var12", 101, 0),
              (faction_slot_eq, ":var12", 101, ":var14"),
              (assign, ":var16", 1),
            (else_try),
              (neg|faction_slot_eq, ":var12", 102, 0),
              (faction_slot_eq, ":var12", 102, ":var15"),
              (assign, ":var16", 1),
            (else_try),
              (neg|faction_slot_eq, ":var12", 103, 0),
              (faction_slot_eq, ":var12", 103, ":var15"),
              (assign, ":var16", 1),
            (try_end),
            (eq, ":var16", 1),
            (val_add, ":var10", ":var13"),
          (try_end),
          (party_set_slot, ":var19", 56, 0),
        (try_end),
        (try_begin),
          (gt, "$g_starting_strength_friends", "$g_starting_strength_main_party"),
          (val_mul, ":var10", "$g_starting_strength_main_party"),
          (val_div, ":var10", "$g_starting_strength_friends"),
        (try_end),
        (val_add, ":var9", ":var10"),
        (quest_set_slot, "qst_order_bounty", 17, ":var9"),
        (quest_get_slot, reg5, "qst_order_bounty", 10),
        (assign, reg4, ":var9"),
        (str_store_string, s3, "@Current progress: {reg4}/{reg5}."),
        (add_quest_note_from_sreg, "qst_order_bounty", 3, s3, 0),
      (try_end),
      (try_begin),
        (gt, "$g_private_battle_with_troop", 0),
        (troop_slot_eq, "$g_private_battle_with_troop", 10, "$g_encountered_party"),
        (assign, "$g_private_battle_with_troop", 0),
        (assign, "$g_disable_condescending_comments", 1),
      (try_end),
      (party_get_num_companion_stacks, ":var20", "p_collective_enemy"),
      (try_for_range, ":var21", 0, ":var20"),
        (party_stack_get_troop_id, ":var22", "p_collective_enemy", ":var21"),
        (is_between, ":var22", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (troop_is_wounded, ":var22"),
        (party_add_members, "p_total_enemy_casualties", ":var22", 1),
      (try_end),
      (try_begin),
        (eq, "$thanked_by_ally_leader", 0),
        (assign, "$thanked_by_ally_leader", 1),
        (gt, "$g_ally_party", 0),
        (store_add, ":var23", "$g_starting_strength_friends", "$g_starting_strength_enemy_party"),
        (val_sub, ":var23", "$g_starting_strength_main_party"),
        (store_sub, ":var24", "$g_starting_strength_friends", "$g_starting_strength_main_party"),
        (store_mul, ":var25", ":var24", 100),
        (val_add, ":var23", 1),
        (val_div, ":var25", ":var23"),
        (store_sub, ":var26", 100, ":var25"),
        (store_mul, ":var27", ":var26", "$g_starting_strength_enemy_party"),
        (val_div, ":var27", 3000),
        (val_min, ":var27", 4),
        (store_mul, "$g_relation_boost", ":var26", ":var26"),
        (val_div, "$g_relation_boost", 700),
        (val_clamp, "$g_relation_boost", 0, 20),
        (party_get_num_companion_stacks, ":var28", "$g_ally_party"),
        (gt, ":var28", 0),
        (store_faction_of_party, ":var29", "$g_ally_party"),
        (call_script, "script_change_player_relation_with_faction", ":var29", ":var27"),
        (try_begin),
          (troop_slot_eq, "trp_player", 162, ":var29"),
          (store_mul, ":var30", ":var29", 3),
          (val_div, ":var30", 4),
          (call_script, "script_change_rank_points_with_order", ":var29", ":var30"),
        (try_end),
        (store_faction_of_party, ":var14", "$g_enemy_party"),
        (val_mul, ":var27", -1),
        (call_script, "script_change_player_relation_with_faction", ":var14", ":var27"),
        (party_stack_get_troop_id, ":var31", "$g_ally_party"),
        (party_stack_get_troop_dna, ":var32", "$g_ally_party", 0),
        (try_begin),
          (troop_is_hero, ":var31"),
          (troop_get_slot, ":var33", ":var31", 22),
          (assign, ":var34", "$g_relation_boost"),
          (try_begin),
            (lt, ":var33", -5),
            (val_div, ":var34", 3),
          (try_end),
          (call_script, "script_change_player_relation_with_troop", ":var31", ":var34"),
        (try_end),
        (assign, "$talk_context", 13),
        (call_script, "script_setup_troop_meeting", ":var31", ":var32"),
      (else_try),
        (assign, ":var0", 0),
        (party_get_num_companion_stacks, ":var20", "p_total_enemy_casualties"),
        (try_for_range, ":var35", "$last_defeated_hero", ":var20"),
          (eq, ":var0", 0),
          (party_stack_get_troop_id, ":var22", "p_total_enemy_casualties", ":var35"),
          (party_stack_get_troop_dna, ":var36", "p_total_enemy_casualties", ":var35"),
          (troop_is_hero, ":var22"),
          (store_troop_faction, ":var37", ":var22"),
          (try_begin),
            (store_relation, ":var38", ":var37", "fac_player_faction"),
            (ge, ":var38", 0),
            (str_store_troop_name, s4, ":var22"),
            (try_begin),
              (eq, "$cheat_mode", 1),
              (display_message, "@{!}{s4} skipped in p total enemy casualties capture queue because is friendly"),
            (try_end),
          (else_try),
            (try_begin),
              (party_stack_get_troop_id, ":var39", "$g_encountered_party", 0),
              (is_between, ":var39", "trp_npc_adonja", "trp_knight_1_1_wife"),
              (troop_slot_eq, ":var39", 2, 2),
              (store_sub, ":var40", ":var39", "trp_npc_adonja"),
              (370, ":var41", 7, ":var40"),
              (eq, ":var41", 1),
              (372, 7),
            (try_end),
            (store_add, "$last_defeated_hero", ":var35", 1),
            (call_script, "script_remove_troop_from_prison", ":var22"),
            (troop_set_slot, ":var22", 10, -1),
            (assign, ":var42", 0),
            (try_begin),
              (check_quest_active, "qst_persuade_lords_to_make_peace"),
              (this_or_next|quest_slot_eq, "qst_persuade_lords_to_make_peace", 2, ":var22"),
              (quest_slot_eq, "qst_persuade_lords_to_make_peace", 4, ":var22"),
              (assign, ":var42", 1),
            (else_try),
              (is_between, ":var22", "trp_heretic_leader", "trp_bandit_leaders_end"),
              (try_begin),
                (check_quest_active, "qst_learn_where_merchant_brother_is"),
                (assign, ":var42", 1),
              (else_try),
                (assign, ":var42", -1),
              (try_end),
            (try_end),
            (assign, ":var43", 0),
            (try_begin),
              (eq, ":var42", 0),
              (try_begin),
                (is_between, ":var22", "trp_hero_burilgi", "trp_omen_seeker"),
                (assign, ":var44", "$event_rand_0"),
                (call_script, "script_update_event_rand", 0),
              (else_try),
                (store_random_in_range, ":var44", 0, 100),
              (try_end),
              (store_skill_level, ":var45", skl_prisoner_management, "trp_player"),
              (val_mul, ":var45", 5),
              (val_add, ":var44", ":var45"),
              (lt, ":var44", 60),
              (assign, ":var43", 1),
            (else_try),
              (eq, ":var42", -1),
              (assign, ":var43", 1),
            (else_try),
              (is_between, ":var22", "trp_merc_leader_mettenheim", "trp_andy"),
              (assign, ":var43", 1),
            (try_end),
            (eq, ":var43", 1),
            (str_store_troop_name, s1, ":var22"),
            (str_store_faction_name, s3, ":var37"),
            (str_store_string, s17, "@{s1} of the {s3} managed to escape."),
            (display_log_message, "@{!}{s17}"),
            (jump_to_menu, "mnu_enemy_slipped_away"),
            (assign, ":var0", 1),
          (else_try),
            (store_add, "$last_defeated_hero", ":var35", 1),
            (call_script, "script_remove_troop_from_prison", ":var22"),
            (troop_set_slot, ":var22", 10, -1),
            (assign, "$talk_context", 9),
            (call_script, "script_setup_troop_meeting", ":var22", ":var36"),
            (assign, ":var0", 1),
          (try_end),
        (try_end),
        (eq, ":var0", 1),
      (else_try),
        (assign, ":var0", 0),
        (party_get_num_prisoner_stacks, ":var46", "p_collective_enemy"),
        (try_for_range, ":var35", "$last_freed_hero", ":var46"),
          (eq, ":var0", 0),
          (party_prisoner_stack_get_troop_id, ":var22", "p_collective_enemy", ":var35"),
          (troop_is_hero, ":var22"),
          (neg|is_between, ":var22", "trp_hero_burilgi", "trp_omen_seeker"),
          (party_prisoner_stack_get_troop_dna, ":var36", "p_collective_enemy", ":var35"),
          (store_add, "$last_freed_hero", ":var35", 1),
          (assign, "$talk_context", 8),
          (call_script, "script_setup_troop_meeting", ":var22", ":var36"),
          (assign, ":var0", 1),
        (try_end),
        (eq, ":var0", 1),
      (else_try),
        (eq, "$loot_screen_shown", 0),
        (assign, "$loot_screen_shown", 1),
        (troop_clear_inventory, "trp_temp_troop"),
        (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"),
        (gt, reg0, 0),
        (troop_sort_inventory, "trp_temp_troop"),
        (try_begin),
          (call_script, "script_get_count_of_companions"),
          (gt, reg0, 0),
          (assign, "$return_menu", "mnu_total_victory"),
          (assign, "$inventory_menu_offset", 0),
          (str_clear, s30),
          (jump_to_menu, "mnu_manage_loot_pool"),
        (else_try),
          (change_screen_loot, "trp_temp_troop"),
        (try_end),
      (else_try),
        (eq, "$capture_screen_shown", 0),
        (assign, "$capture_screen_shown", 1),
        (party_clear, "p_temp_party"),
        (assign, "$g_move_heroes", 0),
        (call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),
        (call_script, "script_party_add_party_prisoners", "p_temp_party", "p_collective_enemy", 1),
        (try_begin),
          (call_script, "script_party_calculate_strength", "p_collective_friends_backup", 0),
          (assign, ":var47", reg0),
          (gt, ":var47", 0),
          (call_script, "script_party_calculate_strength", "p_main_party_backup", 0),
          (assign, ":var48", reg0),
          (store_sub, ":var49", ":var47", ":var48"),
          (store_mul, ":var50", ":var49", 1000),
          (val_div, ":var50", ":var47"),
          (assign, "$pin_number", ":var50"),
          (party_clear, "p_temp_party_2"),
          (call_script, "script_move_members_with_ratio", "p_temp_party", "p_temp_party_2"),
          (try_begin),
            (gt, "$g_ally_party", 0),
            (distribute_party_among_party_group, "p_temp_party_2", "$g_ally_party"),
          (try_end),
        (try_end),
        (party_get_num_companions, ":var51", "p_temp_party"),
        (party_get_num_prisoners, ":var52", "p_temp_party"),
        (store_add, ":var53", ":var51", ":var52"),
        (gt, ":var53", 0),
        (neg|check_quest_active, "qst_order_challenge"),
        (troop_set_slot, "trp_quick_battle_6_player", 406, 10),
        (change_screen_exchange_with_party, "p_temp_party"),
      (else_try),
        (try_begin),
          (gt, "$g_ally_party", 0),
          (call_script, "script_party_add_party", "$g_ally_party", "p_temp_party"),
        (else_try),
          (party_get_num_attached_parties, ":var54", "p_main_party"),
          (gt, ":var54", 0),
          (party_get_attached_party_with_rank, ":var55", "p_main_party", 0),
          (call_script, "script_party_add_party", ":var55", "p_temp_party"),
        (try_end),
        (try_begin),
          (le, "$g_ally_party", 0),
          (end_current_battle),
        (try_end),
        (call_script, "script_party_give_xp_and_gold", "p_total_enemy_casualties"),
        (try_begin),
          (eq, "$g_enemy_party", 0),
          (display_message, "str_error_string"),
        (try_end),
        (try_begin),
          (party_is_active, "$g_ally_party"),
          (call_script, "script_battle_political_consequences", "$g_enemy_party", "$g_ally_party"),
        (else_try),
          (call_script, "script_battle_political_consequences", "$g_enemy_party", "p_main_party"),
        (try_end),
        (call_script, "script_event_player_defeated_enemy_party", "$g_enemy_party"),
        (call_script, "script_clear_party_group", "$g_enemy_party"),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (call_script, "script_post_battle_personality_clash_check"),
          (party_stack_get_troop_id, ":var56", "p_encountered_party_backup", 0),
          (try_begin),
            (is_between, ":var56", "trp_npc_adonja", "trp_knight_1_1_wife"),
            (neg|is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
            (store_troop_faction, ":var57", ":var56"),
            (try_begin),
              (eq, "$g_ally_party", 0),
              (call_script, "script_add_log_entry", 11, "trp_player", -1, ":var56", ":var57"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@{!}Victory comment. Player was alone"),
              (try_end),
            (else_try),
              (ge, "$g_strength_contribution_of_player", 40),
              (call_script, "script_add_log_entry", 11, "trp_player", -1, ":var56", ":var57"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@{!}Ordinary victory comment. The player provided at least 40 percent forces."),
              (try_end),
            (else_try),
              (gt, "$g_starting_strength_enemy_party", 1000),
              (call_script, "script_get_closest_center", "p_main_party"),
              (assign, ":var58", reg0),
              (call_script, "script_automatic_relation_gain_after_battles"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@{!}Player participation comment. The enemy had at least 1k starting strength."),
              (try_end),
            (else_try),
              (eq, "$cheat_mode", 1),
              (display_message, "@{!}No victory comment. The battle was small, and the player provided less than 40 percent of allied strength"),
            (try_end),
          (try_end),
          (val_add, "$g_total_victories", 1),
          (try_begin),
            (neg|encountered_party_is_attacker),
            (le, "$g_ally_party", 0),
            (party_stack_get_troop_id, ":var56", "p_encountered_party_backup", 0),
            (neg|is_between, ":var56", "trp_npc_adonja", "trp_knight_1_1_wife"),
            (store_faction_of_party, ":var14", "$g_enemy_party"),
            (call_script, "script_change_player_relation_with_faction", ":var14", -4),
          (try_end),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (eq, "$g_next_menu", "mnu_noldor_castle_victory"),
          (jump_to_menu, "$g_next_menu"),
        (else_try),
          (eq, "$g_next_menu", "mnu_stronghold_victory"),
          (jump_to_menu, "$g_next_menu"),
        (else_try),
          (try_begin),
            (eq, "$g_next_menu", "mnu_castle_taken"),
            (call_script, "script_automatic_relation_gain_after_battles"),
            (store_current_hours, ":var59"),
            (faction_set_slot, "$players_kingdom", 98, ":var59"),
            (try_begin),
              (is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
              (jump_to_menu, "$g_next_menu"),
            (else_try),
              (eq, "$players_kingdom", "fac_player_supporters_faction"),
              (assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
              (neg|faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
              (faction_get_slot, ":var60", "fac_player_supporters_faction", 11),
              (change_screen_return),
              (start_map_conversation, ":var60", -1),
            (else_try),
              (neg|is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
              (assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
              (assign, "$talk_context", 20),
              (change_screen_return),
              (assign, ":var61", "trp_sarleon_arm_longbowman"),
              (assign, ":var62", 0),
              (party_get_num_companion_stacks, ":var20", "p_main_party"),
              (try_for_range, ":var35", 0, ":var20"),
                (party_stack_get_troop_id, ":var22", "p_main_party", ":var35"),
                (neq, ":var22", "trp_player"),
                (party_stack_get_size, ":var63", "p_main_party", ":var35"),
                (party_stack_get_num_wounded, ":var64", "p_main_party", ":var35"),
                (troop_get_slot, ":var65", "p_main_party", 146),
                (assign, ":var43", 0),
                (try_begin),
                  (neg|troop_is_hero, ":var22"),
                  (store_add, ":var66", ":var64", ":var65"),
                  (gt, ":var63", ":var66"),
                  (assign, ":var43", 1),
                (else_try),
                  (troop_is_hero, ":var22"),
                  (neg|troop_is_wounded, ":var22"),
                  (assign, ":var43", 1),
                (try_end),
                (eq, ":var43", 1),
                (try_begin),
                  (troop_is_hero, ":var22"),
                  (troop_get_slot, ":var67", ":var22", 7),
                  (store_mul, ":var68", ":var67", 100),
                  (val_add, ":var68", 1000),
                (else_try),
                  (store_character_level, ":var69", ":var22"),
                  (assign, ":var68", ":var69"),
                (try_end),
                (try_begin),
                  (gt, ":var68", ":var62"),
                  (assign, ":var62", ":var68"),
                  (assign, ":var61", ":var22"),
                  (party_stack_get_troop_dna, ":var70", "p_main_party", ":var35"),
                (try_end),
              (try_end),
              (start_map_conversation, ":var61", ":var70"),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (party_get_num_attached_parties, ":var0", "p_main_party"),
        (try_for_range_backwards, ":var1", 0, ":var0"),
          (party_get_attached_party_with_rank, ":var2", "p_main_party", ":var1"),
          (party_detach, ":var2"),
        (try_end),
      ]
      ),
    ],
  ),

  ("enemy_slipped_away", mnf_scale_picture,
    "{s17}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_retreat"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_total_victory"),
      ]
      ),
    ],
  ),

  ("total_defeat", 0,
    "{!}You shouldn't be reading this...",
    "none",
    [
      (play_track, "track_JNGL_Capture", 1),
      (party_get_num_prisoner_stacks, ":var0", "p_main_party"),
      (try_for_range, ":var1", 0, ":var0"),
        (party_prisoner_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (troop_is_hero, ":var2"),
        (call_script, "script_remove_troop_from_prison", ":var2"),
      (try_end),
      (try_begin),
        (party_is_active, "$g_ally_party"),
        (call_script, "script_battle_political_consequences", "$g_ally_party", "$g_enemy_party"),
      (else_try),
        (call_script, "script_battle_political_consequences", "p_main_party", "$g_enemy_party"),
      (try_end),
      (call_script, "script_loot_player_items", "$g_enemy_party"),
      (assign, "$g_move_heroes", 0),
      (party_clear, "p_temp_party"),
      (call_script, "script_party_add_party_prisoners", "p_temp_party", "p_main_party", 0),
      (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_main_party"),
      (distribute_party_among_party_group, "p_temp_party", "$g_enemy_party"),
      (assign, "$g_prison_heroes", 1),
#COOP BEGIN ###############################################################################
          (try_begin),
            (eq, "$coop_no_capture_heroes", 1),
            (assign, "$g_prison_heroes", 0),
            (assign, "$g_move_heroes", 0),
          (try_end),
#COOP END ##########################################################################################
      (call_script, "script_party_remove_all_companions", "p_main_party"),
      (assign, "$g_prison_heroes", 0),
      (assign, "$g_move_heroes", 1),
      (call_script, "script_party_remove_all_prisoners", "p_main_party"),
      (val_add, "$g_total_defeats", 1),
      (try_begin),
        (neq, "$g_player_surrenders", 1),
        (store_random_in_range, ":var3", 0, 100),
        (ge, ":var3", "$g_player_luck"),
        (jump_to_menu, "mnu_permanent_damage"),
      (else_try),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$g_ally_party", 0),
        (call_script, "script_party_wound_all_members", "$g_ally_party"),
      (try_end),
      (party_get_num_companion_stacks, ":var4", "p_encountered_party_backup"),
      (try_for_range, ":var1", 0, ":var4"),
        (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
        (is_between, ":var2", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var2", 2, 2),
        (store_troop_faction, ":var5", ":var2"),
        (call_script, "script_add_log_entry", 14, "trp_player", -1, ":var2", ":var5"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("permanent_damage", mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, ":var0", 1),
      (try_for_range, ":var1", 0, ":var0"),
        (store_random_in_range, ":var2", 0, 4),
        (store_attribute_level, ":var3", "trp_player", ":var2"),
        (try_begin),
          (gt, ":var3", 3),
          (neq, ":var2", 3),
          (try_begin),
            (eq, ":var2", 0),
            (str_store_string, s0, "@Some of your tendons have been damaged in the battle. You lose 1 strength."),
          (else_try),
            (eq, ":var2", 1),
            (str_store_string, s0, "@You took a nasty wound which will cause you to limp slightly even after it heals. You lose 1 agility."),
          (else_try),
            (str_store_string, s0, "@You have trouble thinking straight after the battle, perhaps from a particularly hard hit to your head, and frequent headaches now plague your existence. Your intelligence is reduced by 1."),
          (try_end),
        (else_try),
          (lt, ":var0", 200),
          (val_add, ":var0", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 200),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (else_try),
        (troop_raise_attribute, "trp_player", ":var2", -1),
      (try_end),
    ],
    [
      ("s0",
      [
        (store_random_in_range, ":var0", 0, 4),
        (try_begin),
          (eq, ":var0", 0),
          (str_store_string, s0, "@Perhaps I'm getting unlucky..."),
        (else_try),
          (eq, ":var0", 1),
          (str_store_string, s0, "@Retirement is starting to sound better and better."),
        (else_try),
          (eq, ":var0", 2),
          (str_store_string, s0, "@No matter! I will persevere!"),
        (else_try),
          (eq, ":var0", 3),
          (troop_get_type, ":var1", "trp_player"),
          (try_begin),
            (ge, ":var1", 1),
            (str_store_string, s0, "@What did I do to deserve this?"),
          (else_try),
            (str_store_string, s0, "@I suppose it'll make for a good story, at least..."),
          (try_end),
        (try_end),
      ],
      "{s0}",
      [
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      ]
      ),
    ],
  ),

  ("pre_join", mnf_scale_picture,
    "You come across a battle between {s2} and {s1}. You decide to...",
    "none",
    [
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
      (set_background_mesh, "mesh_pic_pendor_chooseside"),
    ],
    [
      ("pre_join_help_attackers",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party_2"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (store_faction_of_party, ":var2", "$g_encountered_party"),
        (store_relation, ":var3", ":var2", "fac_player_supporters_faction"),
        (ge, ":var1", -50),
        (lt, ":var3", 80),
      ],
      "Move_in_to_help_the_{s2}.",
      [
        (select_enemy, 0),
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", "$g_encountered_party_2"),
        (try_begin),
          (eq, "$pop_kingdom", 1),
          (store_faction_of_party, ":var0", "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -10),
        (try_end),
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),

      ("pre_join_help_defenders",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party_2"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (store_faction_of_party, ":var2", "$g_encountered_party"),
        (store_relation, ":var3", ":var2", "fac_player_supporters_faction"),
        (ge, ":var3", -50),
        (lt, ":var1", 80),
      ],
      "Rush_to_the_aid_of_the_{s1}.",
      [
        (select_enemy, 1),
        (assign, "$g_enemy_party", "$g_encountered_party_2"),
        (assign, "$g_ally_party", "$g_encountered_party"),
        (try_begin),
          (eq, "$pop_kingdom", 1),
          (store_faction_of_party, ":var0", "$g_encountered_party_2"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -10),
        (try_end),
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),

      ("pre_join_leave",
      [],
      "Don't_get_involved.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("join_battle", mnf_enable_hot_keys|mnf_scale_picture,
    "You are helping the {s2} against the {s1}. You have {reg10} troops fit for battle against the enemy's {reg11}.",
    "none",
    [
      (str_store_party_name, s1, "$g_enemy_party"),
      (str_store_party_name, s2, "$g_ally_party"),
      (store_faction_of_party, ":var0", "$g_enemy_party"),
      (party_get_template_id, "$g_encountered_party_template", "$g_enemy_party"),
      (call_script, "script_get_illustration_for_encounter"),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_encounter_init_variables"),
      (else_try),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var1", reg0),
        (assign, ":var2", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (this_or_next|le, ":var1", 0),
          (le, ":var1", "$num_routed_enemies"),
          (assign, ":var2", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var2", 1),
        (try_end),
        (this_or_next|eq, ":var2", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", -1),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
        (assign, ":var3", reg0),
        (assign, ":var4", 0),
        (try_begin),
          (eq, "$g_battle_result", -1),
          (le, ":var3", "$num_routed_allies"),
          (assign, ":var4", 1),
        (try_end),
        (this_or_next|eq, ":var4", 1),
        (eq, "$g_player_surrenders", 1),
        (leave_encounter),
        (change_screen_return),
      (try_end),
    ],
    [
      ("join_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Charge_the_enemy.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (assign, "$g_battle_result", 0),
        (try_begin),
          (check_quest_active, "qst_order_bounty"),
          (call_script, "script_party_calculate_strength", "$g_enemy_party", 0),
          (party_set_slot, "$g_enemy_party", 56, reg0),
          (party_get_num_attached_parties, ":var0", "$g_enemy_party"),
          (try_for_range, ":var1", 0, ":var0"),
            (party_get_attached_party_with_rank, ":var2", "$g_enemy_party", ":var1"),
            (call_script, "script_party_calculate_strength", ":var2", 0),
            (party_set_slot, ":var2", 56, reg0),
          (try_end),
        (try_end),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (call_script, "script_set_music_for_enemy", "$g_enemy_party"),
        (try_begin),
          (eq, "$music_track_enemy", 0),
          (call_script, "script_set_music_for_enemy", "$g_ally_party"),
        (try_end),
        (set_jump_mission, "mt_lead_charge"),
        (call_script, "script_party_count_fit_for_battle", "p_collective_ally", 0),
        (assign, ":var3", reg0),
        (call_script, "script_party_count_fit_for_battle", "p_collective_enemy", 0),
        (assign, ":var4", reg0),
        (store_add, ":var5", ":var3", ":var4"),
        (call_script, "script_setup_random_scene", ":var5"),
        (assign, "$g_next_menu", "mnu_join_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("join_order_attack",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 3),
      ],
      "Order_your_troops_to_attack_with_your_allies_while_you_stay_back.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (jump_to_menu, "mnu_join_order_attack"),
      ]
      ),
#COOP BEGIN Join battle#############################		  
      ("coop_setup",[
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
      ],"Setup multiplayer battle.", 
      [
        (assign, "$coop_battle_type", coop_battle_type_field_battle),
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
      ]),	
	  
      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [

        (call_script, "script_calculate_renown_value"),
        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      #change these for menu
        (assign, "$g_next_menu", "mnu_join_battle"),
        (assign, "$g_joined_battle_to_help", 1),
      ]),		 
      ("encounter_save",[],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
        # (rest_for_hours, 1, 1, 0),#rest while not attackable

      ]),		  
          
#COOP END##########################################

      ("join_leave",
      [],
      "Leave.",
      [
        (try_begin),
          (neg|troop_is_wounded, "trp_player"),
          (call_script, "script_objectionable_action", 1, "str_flee_battle"),
          (party_stack_get_troop_id, ":var0", "$g_enemy_party", 0),
          (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (call_script, "script_add_log_entry", 15, "trp_player", -1, ":var0", -1),
        (try_end),
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("join_order_attack", mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}^^Allies remaining: {reg10}^Enemies remaining: {reg11}",
    "none",
    [
      (call_script, "script_kt_party_calculate_strength", "p_main_party", 1, 0),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "$g_ally_party", 0, 0),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "$g_enemy_party", 0, 0),
      (assign, ":var4", reg0),
      (assign, ":var5", reg1),
      (store_add, ":var6", ":var0", ":var2"),
      (try_begin),
        (store_faction_of_party, ":var7", "$g_enemy_party"),
        (eq, ":var7", "fac_noldor_elves"),
        (val_mul, ":var4", 3),
      (try_end),
      (store_mul, ":var8", ":var1", ":var0"),
      (val_mul, ":var8", ":var4"),
      (val_div, ":var8", ":var6"),
      (val_div, ":var8", 100),
      (store_mul, ":var9", ":var3", ":var2"),
      (val_mul, ":var9", ":var4"),
      (val_div, ":var9", ":var6"),
      (val_div, ":var9", 100),
      (store_mul, ":var10", ":var5", ":var6"),
      (val_div, ":var10", 100),
      (val_div, ":var10", 50),
      (val_div, ":var9", 50),
      (val_div, ":var8", 50),
      (inflict_casualties_to_party_group, "p_main_party", ":var8", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var10", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (party_get_num_companion_stacks, ":var11", "p_temp_casualties"),
      (try_for_range, ":var12", 0, ":var11"),
        (party_stack_get_troop_id, ":var13", "p_temp_casualties", ":var12"),
        (try_begin),
          (party_stack_get_size, ":var14", "p_temp_casualties", ":var12"),
          (gt, ":var14", 0),
          (party_add_members, "p_total_enemy_casualties", ":var13", ":var14"),
          (party_stack_get_num_wounded, ":var15", "p_temp_casualties", ":var12"),
          (gt, ":var15", 0),
          (party_wound_members, "p_total_enemy_casualties", ":var13", ":var15"),
        (try_end),
      (try_end),
      (call_script, "script_collect_friendly_parties"),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var9", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var16", reg0),
        (le, ":var16", "$num_routed_us"),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_join_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var17", reg0),
        (this_or_next|le, ":var17", 0),
        (le, ":var17", "$num_routed_enemies"),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_join_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_join_order_attack_continue"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),
    ],
  ),

  ("salt_mine", mnf_auto_enter|mnf_scale_picture,
    "You enter the Hidden mines of Al-Aziz.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_saltmine"),
      (reset_price_rates, 0),
      (set_price_rate_for_item, "itm_salt", 55),
    ],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_town_center"),
        (jump_to_scene, "scn_salt_mine"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("four_ways_inn", mnf_auto_enter,
    "You arrive at the Four Ways Inn.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_four_ways_inn"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("test_scene", 0,
    "You enter the test scene.",
    "none",
    [],
    [
      ("enter_1",
      [],
      "Enter_1.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_1"),
        (change_screen_mission),
      ]
      ),

      ("enter_2",
      [],
      "Enter_2.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_2"),
        (change_screen_mission),
      ]
      ),

      ("enter_3",
      [],
      "Enter_3.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_3"),
        (change_screen_mission),
      ]
      ),

      ("enter_4",
      [],
      "Enter_4.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_4"),
        (change_screen_mission),
      ]
      ),

      ("enter_5",
      [],
      "Enter_5.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_5"),
        (change_screen_mission),
      ]
      ),

      ("enter_6",
      [],
      "Enter_6.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_6"),
        (change_screen_mission),
      ]
      ),

      ("enter_7",
      [],
      "Enter_7.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_test2"),
        (change_screen_mission),
      ]
      ),

      ("enter_8",
      [],
      "Enter_8.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_test3"),
        (change_screen_mission),
      ]
      ),

      ("enter_9",
      [],
      "Enter_9.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_multi_scene_13"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("battlefields", 0,
    "{!}Select a field...",
    "none",
    [],
    [
      ("enter_f1",
      [],
      "{!}Field_1",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_1"),
        (change_screen_mission),
      ]
      ),

      ("enter_f2",
      [],
      "{!}Field_2",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_2"),
        (change_screen_mission),
      ]
      ),

      ("enter_f3",
      [],
      "{!}Field_3",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_3"),
        (change_screen_mission),
      ]
      ),

      ("enter_f4",
      [],
      "{!}Field_4",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_4"),
        (change_screen_mission),
      ]
      ),

      ("enter_f5",
      [],
      "{!}Field_5",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_5"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("dhorak_keep", 0,
    "You enter the Dhorak Keep",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_town_center"),
        (jump_to_scene, "scn_dhorak_keep"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("join_siege_outside", mnf_scale_picture,
    "{s1} has come under siege by {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_siege_sighted_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
    ],
    [
      ("approach_besiegers",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party_2"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (ge, ":var1", 0),
        (store_faction_of_party, ":var0", "$g_encountered_party"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (lt, ":var1", 0),
      ],
      "Approach_the_siege_camp.",
      [
        (jump_to_menu, "mnu_besiegers_camp_with_allies"),
      ]
      ),

      ("pass_through_siege",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (ge, ":var1", 0),
      ],
      "Pass_through_the_siege_lines_and_enter_{s1}.",
      [
        (jump_to_menu, "mnu_cut_siege_without_fight"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("cut_siege_without_fight", mnf_scale_picture,
    "The besiegers let you approach the gates without challenge.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_siege_joindefenders"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_castle_outside"),
        (try_end),
      ]
      ),
    ],
  ),

  ("besiegers_camp_with_allies", mnf_enable_hot_keys|mnf_scale_picture,
    "{s1} remains under siege. The banners of {s2} fly above the camp of the besiegers, where you and your men are welcomed.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_siege_joinattackers"),
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", "$g_encountered_party_2"),
      (select_enemy, 0),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_encounter_init_variables"),
      (try_end),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (assign, ":var0", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var0", 1),
        (else_try),
#pendor original          (le, "$g_enemy_fit_for_battle", 0),
#COOP BEGIN bugfix ##############
#              (le, "$g_enemy_fit_for_battle",0),
              (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END######################### 
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var0", 1),
        (try_end),
        (this_or_next|eq, ":var0", 1),
        (eq, "$g_enemy_surrenders", 1),
        (call_script, "script_party_wound_all_members", "$g_enemy_party"),
        (leave_encounter),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
        (assign, ":var1", reg0),
        (eq, "$g_battle_result", -1),
#pendor original        (eq, ":var1", 0),
#COOP BEGIN bugfix ##############
#          (eq, ":ally_num_soldiers", 0), #battle lost (sdsd = TODO : also compare this with routed allies too like in other parts)
           (le, ":var1",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################
        (leave_encounter),
        (change_screen_return),
      (try_end),
    ],
    [
      ("talk_to_siege_commander",
      [
        (party_stack_get_troop_id, ":var0", "$g_encountered_party_2", 0),
        (troop_slot_eq, ":var0", 2, 2),
      ],
      "_Request_a_meeting_with_the_commander.",
      [
        (call_script, "script_get_meeting_scene"),
        (assign, ":var0", reg0),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (party_stack_get_troop_id, ":var1", "$g_encountered_party_2", 0),
        (party_stack_get_troop_dna, ":var2", "$g_encountered_party_2", 0),
        (set_visitor, 17, ":var1", ":var2"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, ":var0"),
        (assign, "$talk_context", 4),
        (change_screen_map_conversation, ":var1"),
      ]
      ),

      ("join_siege_with_allies",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Join_the_next_assault.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", 1, "$g_encountered_party"),
          (call_script, "script_reward_for_quest_per_player_level", 300, 40, 0, 0),
          (add_xp_as_reward, reg33),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          (faction_get_slot, ":var0", "$players_kingdom", 8),
          (str_store_troop_name_link, s9, ":var0"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":var0"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (party_get_slot, ":var1", "$g_encountered_party", 18),
        (else_try),
          (party_get_slot, ":var1", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (val_mul, reg0, 2),
        (val_div, reg0, 3),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 27, 1),
          (set_jump_mission, "mt_castle_attack_walls_belfry"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (jump_to_scene, ":var1"),
        (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("join_siege_stay_back",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 3),
      ],
      "Order_your_soldiers_to_join_the_next_assault_without_you.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", 1, "$g_encountered_party"),
          (add_xp_as_reward, 100),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          (faction_get_slot, ":var0", "$players_kingdom", 8),
          (str_store_troop_name_link, s9, ":var0"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":var0"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (jump_to_menu, "mnu_castle_attack_walls_with_allies_simulate"),
      ]
      ),
#COOP BEGIN Join siege#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_siege_player_attack),
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),

       ]),	
	  
      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [
        (call_script, "script_calculate_renown_value"),
        (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
          (add_xp_as_reward, 250),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          #Reactivating follow army quest
          (faction_get_slot, ":var0", "$players_kingdom", slot_faction_marshall),
          (str_store_troop_name_link, s9, ":var0"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":var0"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),

        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      ]),		  

      ("encounter_save",[],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),		  
#COOP END#################################################
 
      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("castle_outside", mnf_scale_picture,
    "You are outside {s2}.{s11} {s3} {s4}",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s2, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, "$all_doors_locked", 1),
      (assign, "$current_town", "$g_encountered_party"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
        (call_script, "script_encounter_init_variables"),
        (assign, "$entry_to_town_forbidden", 0),
        (assign, "$sneaked_into_town", 0),
        (assign, "$town_entered", 0),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
          (gt, "$g_player_besiege_town", 0),
          (neq, "$g_player_besiege_town", "$g_encountered_party"),
          (party_slot_eq, "$g_player_besiege_town", 54, "p_main_party"),
          (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
          (assign, "$g_player_besiege_town", -1),
        (try_end),
        (try_begin),
          (lt, "$g_encountered_party_relation", 0),
          (assign, "$encountered_party_hostile", 1),
          (assign, "$entry_to_town_forbidden", 1),
        (try_end),
        (assign, "$cant_sneak_into_town", 0),
        (try_begin),
          (eq, "$current_town", "$last_sneak_attempt_town"),
          (store_current_hours, reg2),
          (val_sub, reg2, "$last_sneak_attempt_time"),
          (lt, reg2, 12),
          (assign, "$cant_sneak_into_town", 1),
        (try_end),
      (else_try),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (str_clear, s4),
      (try_begin),
        (eq, "$entry_to_town_forbidden", 1),
        (try_begin),
          (eq, "$cant_sneak_into_town", 1),
          (str_store_string, s4, "str_sneaking_to_town_impossible"),
        (else_try),
          (str_store_string, s4, "str_entrance_to_town_forbidden"),
        (try_end),
      (try_end),
      (party_get_slot, ":var0", "$current_town", 7),
      (store_faction_of_party, ":var1", "$current_town"),
      (str_store_faction_name, s9, ":var1"),
      (try_begin),
        (ge, ":var0", 0),
        (str_store_troop_name, s8, ":var0"),
        (str_store_string, s7, "@{s8} of the {s9}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 2),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (str_store_string, s11, "@ Your own banner flies over the castle gate."),
        (else_try),
          (ge, ":var0", 0),
          (str_store_string, s11, "@ You see the banner of {s7} over the castle gate."),
        (else_try),
          (is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (str_store_string, s11, "str__this_castle_is_temporarily_under_royal_control"),
        (else_try),
          (str_store_string, s11, "str__this_castle_does_not_seem_to_be_under_anyones_control"),
        (try_end),
      (else_try),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (str_store_string, s11, "@ Your own banner flies over the town gates."),
        (else_try),
          (ge, ":var0", 0),
          (str_store_string, s11, "@ You see the banner of {s7} over the town gates."),
        (else_try),
          (is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (str_store_string, s11, "str__this_town_is_temporarily_under_royal_control"),
        (else_try),
          (str_store_string, s11, "str__the_townspeople_seem_to_have_declared_their_independence"),
        (try_end),
      (try_end),
      (party_get_num_companions, reg7, "p_collective_enemy"),
      (assign, "$castle_undefended", 0),
      (str_clear, s3),
      (try_begin),
        (eq, reg7, 0),
        (assign, "$castle_undefended", 1),
        (str_store_string, s3, "str_castle_is_abondened"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (str_store_string, s3, "str_place_is_occupied_by_player"),
      (else_try),
        (lt, "$g_encountered_party_relation", 0),
        (str_store_string, s3, "str_place_is_occupied_by_enemy"),
      (else_try),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town_outside", 1),
        (assign, "$g_leave_town_outside", 0),
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return),
      (else_try),
        (check_quest_active, "qst_escort_lady"),
        (quest_slot_eq, "qst_escort_lady", 1, "$g_encountered_party"),
        (quest_get_slot, ":var2", "qst_escort_lady", 4),
        (call_script, "script_get_meeting_scene"),
        (assign, ":var3", reg0),
        (modify_visitors_at_site, ":var3"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, ":var2"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, ":var3"),
        (assign, "$talk_context", 10),
        (change_screen_map_conversation, ":var2"),
      (else_try),
        (check_quest_active, "qst_kidnapped_girl"),
        (quest_slot_eq, "qst_kidnapped_girl", 12, "$g_encountered_party"),
        (quest_slot_eq, "qst_kidnapped_girl", 11, 3),
        (call_script, "script_get_meeting_scene"),
        (assign, ":var3", reg0),
        (modify_visitors_at_site, ":var3"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, "trp_kidnapped_girl"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, ":var3"),
        (assign, "$talk_context", 10),
        (change_screen_map_conversation, "trp_kidnapped_girl"),
      (else_try),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (this_or_next|party_slot_eq, "$g_encountered_party", 7, "trp_player"),
        (faction_slot_eq, "$g_encountered_party_faction", 11, "trp_player"),
        (jump_to_menu, "mnu_enter_your_own_castle"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (ge, "$g_encountered_party_relation", 0),
        (this_or_next|eq, "$castle_undefended", 1),
        (this_or_next|eq, "$g_permitted_to_center", 1),
        (eq, "$g_encountered_party_faction", "$players_kingdom"),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (ge, "$g_encountered_party_relation", 0),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (eq, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("approach_gates",
      [
        (this_or_next|eq, "$entry_to_town_forbidden", 1),
        (party_slot_eq, "$g_encountered_party", 0, 2),
      ],
      "Approach_the_gates_and_hail_the_guard.",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),

      ("town_sneak",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (str_store_string, s7, "str_town"),
        (else_try),
          (str_store_string, s7, "str_castle"),
        (try_end),
        (eq, "$entry_to_town_forbidden", 1),
        (eq, "$cant_sneak_into_town", 0),
      ],
      "Disguise_yourself_and_try_to_sneak_into_the_{s7}",
      [
        (faction_get_slot, ":var0", "$g_encountered_party_faction", 30),
        (party_get_num_companions, ":var1", "p_main_party"),
        (party_get_num_prisoners, ":var2", "p_main_party"),
        (val_add, ":var1", ":var2"),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (store_add, ":var3", ":var0", ":var1"),
        (store_random_in_range, ":var4", 0, 100),
        (try_begin),
          (this_or_next|ge, ":var4", ":var3"),
          (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
          (assign, "$g_last_defeated_bandits_town", 0),
          (assign, "$sneaked_into_town", 1),
          (assign, "$town_entered", 1),
          (jump_to_menu, "mnu_sneak_into_town_suceeded"),
          (assign, "$g_mt_mode", 1),
        (else_try),
          (jump_to_menu, "mnu_sneak_into_town_caught"),
        (try_end),
      ]
      ),

      ("castle_start_siege",
      [
        (this_or_next|party_slot_eq, "$g_encountered_party", 54, -1),
        (party_slot_eq, "$g_encountered_party", 54, "p_main_party"),
        (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (lt, ":var0", 0),
        (assign, ":var1", 1),
        (try_begin),
          (eq, "$pop_kingdom", 0),
          (gt, "$players_kingdom", 0),
          (store_relation, ":var2", "$g_encountered_party_faction", "$players_kingdom"),
          (ge, ":var2", 0),
          (assign, ":var1", 0),
        (try_end),
        (eq, ":var1", 1),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 5),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),
      ],
      "Besiege_the_{reg6?town:castle}.",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (store_relation, ":var0", "fac_player_supporters_faction", "$g_encountered_party_faction"),
        (val_min, ":var0", -40),
        (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
        (call_script, "script_update_all_notes"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("cheat_castle_start_siege",
      [
        (eq, "$cheat_mode", 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 54, -1),
        (party_slot_eq, "$g_encountered_party", 54, "p_main_party"),
        (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (ge, ":var0", 0),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),
      ],
      "{!}CHEAT:_Besiege_the_{reg6?town:castle}...",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("castle_leave",
      [],
      "Leave.",
      [
        (change_screen_return, 0),
      ]
      ),

      ("castle_cheat_interior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Interior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 11),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_exterior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Exterior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 10),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_town_walls",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "{!}CHEAT!_Town_Walls.",
      [
        (party_get_slot, ":var0", "$current_town", 18),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("castle_guard", mnf_scale_picture,
    "You approach the gate. The men on the walls watch you closely.",
    "none",
    [
      (call_script, "script_set_town_picture"),
    ],
    [
      ("request_shelter",
      [
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (ge, "$g_encountered_party_relation", 0),
      ],
      "Request_entry_to_the_castle.",
      [
        (party_get_slot, ":var0", "$g_encountered_party", 7),
        (try_begin),
          (lt, ":var0", 0),
          (jump_to_menu, "mnu_castle_entry_granted"),
        (else_try),
          (call_script, "script_troop_get_player_relation", ":var0"),
          (assign, ":var1", reg0),
          (try_begin),
            (gt, ":var1", -15),
            (jump_to_menu, "mnu_castle_entry_granted"),
          (else_try),
            (jump_to_menu, "mnu_castle_entry_denied"),
          (try_end),
        (try_end),
      ]
      ),

      ("request_meeting_commander",
      [],
      "Request_a_meeting_with_someone.",
      [
        (jump_to_menu, "mnu_castle_meeting"),
      ]
      ),

      ("guard_leave",
      [],
      "Leave.",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("castle_entry_granted", mnf_scale_picture,
    "After a brief wait, the guards open the gates for you and allow your party inside.",
    "none",
    [
      (call_script, "script_set_town_picture"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("castle_entry_denied", mnf_scale_picture,
    "The lord of this castle has forbidden you from coming inside these walls, and the guard sergeant informs you that his men will fire if you attempt to come any closer.",
    "none",
    [
      (call_script, "script_set_town_picture"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),
    ],
  ),

  ("castle_meeting", mnf_scale_picture,
    "With whom do you want to meet?",
    "none",
    [
      (assign, "$num_castle_meeting_troops", 0),
      (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (call_script, "script_get_troop_attached_party", ":var0"),
        (eq, "$g_encountered_party", reg0),
        (troop_set_slot, "trp_temp_array_a", "$num_castle_meeting_troops", ":var0"),
        (val_add, "$num_castle_meeting_troops", 1),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 0),
        (troop_get_slot, ":var0", "trp_temp_array_a", 0),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 0),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 1),
        (troop_get_slot, ":var0", "trp_temp_array_a", 1),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 1),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 2),
        (troop_get_slot, ":var0", "trp_temp_array_a", 2),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 2),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 3),
        (troop_get_slot, ":var0", "trp_temp_array_a", 3),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 3),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 4),
        (troop_get_slot, ":var0", "trp_temp_array_a", 4),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 4),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 5),
        (troop_get_slot, ":var0", "trp_temp_array_a", 5),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 5),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 6),
        (troop_get_slot, ":var0", "trp_temp_array_a", 6),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 6),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 7),
        (troop_get_slot, ":var0", "trp_temp_array_a", 7),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 7),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 8),
        (troop_get_slot, ":var0", "trp_temp_array_a", 8),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 8),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 9),
        (troop_get_slot, ":var0", "trp_temp_array_a", 9),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 9),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),
    ],
  ),

  ("castle_meeting_selected", mnf_scale_picture,
    "Your request for a meeting is relayed inside, and finally {s6} appears in the courtyard to speak with you.",
    "none",
    [
      (str_store_troop_name, s6, "$castle_meeting_selected_troop"),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_outside"),
        (modify_visitors_at_site, "scn_conversation_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, "$castle_meeting_selected_troop"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_conversation_scene"),
        (assign, "$talk_context", 3),
        (change_screen_map_conversation, "$castle_meeting_selected_troop"),
      ]
      ),
    ],
  ),

  ("castle_besiege", mnf_enable_hot_keys|mnf_scale_picture,
    "You are laying siege to {s1}. {s2} {s3}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_siege_sighted_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (assign, "$g_siege_force_wait", 0),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 54, -1),
        (party_set_slot, "$g_encountered_party", 54, "p_main_party"),
        (store_current_hours, ":var1"),
        (party_set_slot, "$g_encountered_party", 64, ":var1"),
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
      (try_end),
      (party_get_slot, ":var2", "$g_encountered_party", 53),
      (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
      (assign, ":var3", reg0),
      (assign, reg7, ":var3"),
      (assign, reg8, ":var2"),
      (store_div, reg3, ":var2", ":var3"),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
      (try_begin),
        (gt, reg3, 0),
        (str_store_string, s2, "@The {reg6?town's:castle's} food stores should last for {reg3} more days."),
      (else_try),
        (str_store_string, s2, "@The {reg6?town's:castle's} food stores have run out and the defenders are starving."),
      (try_end),
      (str_store_string, s3, "str_empty_string"),
      (try_begin),
        (ge, "$g_siege_method", 1),
        (store_current_hours, ":var1"),
        (try_begin),
          (lt, ":var1", "$g_siege_method_finish_hours"),
          (store_sub, reg9, "$g_siege_method_finish_hours", ":var1"),
          (try_begin),
            (eq, "$g_siege_method", 1),
            (str_store_string, s3, "@You're preparing to attack the walls, the work should finish in {reg9} hours."),
          (else_try),
            (eq, "$g_siege_method", 2),
            (str_store_string, s3, "@Your forces are building a siege tower. They estimate another {reg9} hours to complete the build."),
          (try_end),
        (else_try),
          (try_begin),
            (eq, "$g_siege_method", 1),
            (str_store_string, s3, "@You are ready to attack the walls at any time."),
          (else_try),
            (eq, "$g_siege_method", 2),
            (str_store_string, s3, "@The siege tower is built and ready to make an assault."),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_castle_left_to_player", 1),
        (assign, "$g_castle_left_to_player", 0),
        (store_faction_of_party, ":var4", "$g_encountered_party"),
        (party_set_faction, "$g_encountered_party", "fac_neutral"),
        (party_get_num_attached_parties, ":var5", "$g_encountered_party"),
        (try_for_range_backwards, ":var6", 0, ":var5"),
          (party_get_attached_party_with_rank, ":var7", "$g_encountered_party", ":var6"),
          (party_detach, ":var7"),
          (party_get_slot, ":var8", ":var7", 0),
          (eq, ":var8", 13),
          (store_faction_of_party, ":var9", ":var7"),
          (call_script, "script_get_closest_walled_center_of_faction", ":var7", ":var9"),
          (try_begin),
            (gt, reg0, 0),
            (call_script, "script_party_set_ai_state", ":var7", 7, reg0),
          (else_try),
            (call_script, "script_party_set_ai_state", ":var7", 4, "$g_encountered_party"),
          (try_end),
        (try_end),
        (call_script, "script_party_remove_all_companions", "$g_encountered_party"),
        (change_screen_return),
        (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
        (call_script, "script_party_copy", "p_encountered_party_backup", "p_collective_enemy"),
        (party_set_faction, "$g_encountered_party", ":var4"),
      (try_end),
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s1, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars", "p_collective_enemy"),
        (assign, ":var10", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var10", 1),
        (else_try),
#pendor original          (le, "$g_enemy_fit_for_battle", 0),
#COOP BEGIN bugfix ##############
#            (le, "$g_enemy_fit_for_battle",0),
            (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################  
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var10", 1),
        (try_end),
        (this_or_next|eq, ":var10", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var11", reg0),
        (eq, "$g_battle_result", -1),
#pendor original        (eq, ":var11", 0),
#COOP BEGIN bugfix ##############
#          (eq, ":main_party_fit_regulars", 0), #all lost (sdsd = TODO : )             
           (le, ":var11",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################
        (assign, "$g_next_menu", "mnu_captivity_start_castle_defeat"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      ("siege_request_meeting",
      [
        (eq, "$cant_talk_to_enemy", 0),
      ],
      "Call_for_a_meeting_with_the_castle_commander.",
      [
        (assign, "$cant_talk_to_enemy", 1),
        (assign, "$g_enemy_surrenders", 0),
        (assign, "$g_castle_left_to_player", 0),
        (assign, "$talk_context", 7),
        (party_get_num_attached_parties, ":var0", "$g_encountered_party"),
        (try_begin),
          (gt, ":var0", 0),
          (party_get_attached_party_with_rank, ":var1", "$g_encountered_party", 0),
          (call_script, "script_setup_party_meeting", ":var1"),
        (else_try),
          (call_script, "script_setup_party_meeting", "$g_encountered_party"),
        (try_end),
      ]
      ),

      ("wait_24_hours",
      [],
      "Wait_until_tomorrow.",
      [
        (assign, "$auto_besiege_town", "$g_encountered_party"),
        (assign, "$g_siege_force_wait", 1),
        (store_time_of_day, ":var0"),
        (val_add, ":var0", 1),
        (assign, ":var1", 31),
        (val_sub, ":var1", ":var0"),
        (val_mod, ":var1", 24),
        (val_add, ":var1", 1),
        (rest_for_hours_interactive, ":var1", 5, 1),
        (assign, "$cant_talk_to_enemy", 0),
        (change_screen_return),
      ]
      ),

      ("castle_lead_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
        (ge, "$g_siege_method", 1),
        (gt, "$g_friend_fit_for_battle", 3),
        (store_current_hours, ":var0"),
        (ge, ":var0", "$g_siege_method_finish_hours"),
      ],
      "Lead_your_soldiers_in_an_assault.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (party_get_slot, ":var0", "$g_encountered_party", 18),
        (else_try),
          (party_get_slot, ":var0", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (assign, ":var1", reg0),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (assign, reg0, ":var1"),
        (call_script, "script_sally_count_archers_fit_for_battle", "p_collective_friends"),
        (assign, ":var2", reg1),
        (call_script, "script_sally_count_archers_fit_for_battle", "p_collective_enemy"),
        (assign, ":var3", reg1),
        (assign, ":var4", reg0),
        (set_battle_advantage, ":var1"),
        (set_party_battle_mode),
        (assign, "$g_siege_battle_state", 1),
        (assign, ":var5", 0),
        (try_begin),
          (le, ":var1", -4),
          (eq, "$g_siege_sallied_out_once", 0),
          (set_jump_mission, "mt_castle_attack_walls_defenders_sally"),
          (assign, "$g_siege_battle_state", 0),
          (assign, ":var5", 1),
        (else_try),
          (eq, "$g_siege_sallied_out_once", 0),
          (le, ":var1", -3),
          (this_or_next|ge, ":var2", 33),
          (le, ":var3", 20),
          (set_jump_mission, "mt_castle_attack_walls_defenders_sally"),
          (assign, "$g_siege_battle_state", 0),
          (assign, ":var5", 1),
        (else_try),
          (eq, "$g_siege_sallied_out_once", 0),
          (le, ":var1", -2),
          (ge, ":var4", 80),
          (this_or_next|ge, ":var2", 50),
          (le, ":var3", 20),
          (set_jump_mission, "mt_castle_attack_walls_defenders_sally"),
          (assign, "$g_siege_battle_state", 0),
          (assign, ":var5", 1),
        (else_try),
          (eq, "$g_siege_sallied_out_once", 0),
          (le, ":var1", 0),
          (store_add, ":var6", ":var2", ":var3"),
          (val_mul, ":var2", 100),
          (val_div, ":var2", ":var6"),
          (ge, ":var2", 70),
          (ge, ":var4", 150),
          (set_jump_mission, "mt_castle_attack_walls_defenders_sally"),
          (assign, "$g_siege_battle_state", 0),
          (assign, ":var5", 1),
        (else_try),
          (party_slot_eq, "$current_town", 27, 1),
          (set_jump_mission, "mt_castle_attack_walls_belfry"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (assign, "$cant_talk_to_enemy", 0),
        (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (assign, "$g_siege_method", 0),
        (jump_to_scene, ":var0"),
        (try_begin),
          (eq, ":var5", 1),
          (jump_to_menu, "mnu_siege_attack_meets_sally"),
        (else_try),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
        (try_end),
      ]
      ),

      ("attack_stay_back",
      [
        (ge, "$g_siege_method", 1),
        (gt, "$g_friend_fit_for_battle", 3),
        (store_current_hours, ":var0"),
        (ge, ":var0", "$g_siege_method_finish_hours"),
      ],
      "Order_your_soldiers_to_attack_while_you_stay_back...",
      [
        (assign, "$cant_talk_to_enemy", 0),
        (jump_to_menu, "mnu_castle_attack_walls_simulate"),
      ]
      ),

#COOP BEGIN Siege attack#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
         (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         (store_current_hours, ":var0"),
         (ge, ":var0", "$g_siege_method_finish_hours"),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_siege_player_attack),
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),

#TODO siege sally
#           (assign, "$g_siege_battle_state", 1),
#           (assign, ":siege_sally", 0),
#           (try_begin),
#             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
#             (eq, "$g_siege_sallied_out_once", 0),
#             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
#             (assign, "$g_siege_battle_state", 0),
#             (assign, ":siege_sally", 1),
#           (else_try),
#             (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
#             (set_jump_mission,"mt_castle_attack_walls_belfry"),
#           (else_try),
#             (set_jump_mission,"mt_castle_attack_walls_ladder"),
#           (try_end),

       ]),	
	  

      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
        (ge, "$g_siege_method", 1),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
         (ge, "$g_siege_method", 1),
         (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
      ],"Use multiplayer battle results.", 
      [

        (call_script, "script_calculate_renown_value"),
        (assign, "$cant_talk_to_enemy", 0),           
        (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
        (assign, "$g_next_menu", "mnu_castle_besiege"),
        (assign, "$g_siege_method", 0), #reset siege timer

        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      ]),		  

      ("encounter_save",[(ge, "$g_siege_method", 1)],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),
#COOP END#################################################

      ("build_ladders",
      [
        (party_slot_eq, "$current_town", 27, 0),
        (eq, "$g_siege_method", 0),
      ],
      "Prepare_ladders_to_attack_the_walls.",
      [
        (jump_to_menu, "mnu_construct_ladders"),
      ]
      ),

      ("build_siege_tower",
      [
        (party_slot_eq, "$current_town", 27, 1),
        (eq, "$g_siege_method", 0),
      ],
      "Build_a_siege_tower.",
      [
        (jump_to_menu, "mnu_construct_siege_tower"),
      ]
      ),

      ("cheat_castle_lead_attack",
      [
        (eq, "$cheat_mode", 1),
        (eq, "$g_siege_method", 0),
      ],
      "{!}CHEAT:_Instant_build_equipment.",
      [
        (assign, "$g_siege_method", 1),
        (assign, "$g_siege_method_finish_hours", 0),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("cheat_conquer_castle",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT:_Instant_conquer_castle.",
      [
        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
      ]
      ),

      ("lift_siege",
      [],
      "Abandon_the_siege.",
      [
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("siege_attack_meets_sally", mnf_scale_picture,
    "The defenders sally out to meet your assault.",
    "none",
    [
      (set_background_mesh, "mesh_pic_sally_out"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("castle_besiege_inner_battle", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_siege_sighted_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (assign, ":var1", "$g_battle_result"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, "$battle_renown_value", 5),
      (str_store_string, s1, "@As a last defensive effort, you retreat to the main hall of the keep. You and your remaining soldiers will put up a desperate fight here. If you are defeated, there's no other place to fall back to."),
      (str_store_string, s1, "@You've been driven away from the walls. Now the attackers are pouring into the streets. IF you can defeat them, you can perhaps turn the tide and save the day."),
      (try_begin),
        (this_or_next|neq, ":var1", 1),
        (this_or_next|le, "$g_friend_fit_for_battle", 0),
        (le, "$g_enemy_fit_for_battle", 0),
        (jump_to_menu, "$g_siege_final_menu"),
      (else_try),
        (call_script, "script_encounter_calculate_fit"),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (try_begin),
          (eq, "$g_siege_battle_state", 0),
          (eq, ":var1", 1),
          (assign, "$g_battle_result", 0),
          (jump_to_menu, "$g_siege_final_menu"),
        (else_try),
          (eq, "$g_siege_battle_state", 1),
          (eq, ":var1", 1),
          (str_store_string, s1, "@You've breached the town walls, but the stubborn defenders continue to resist you in the streets! You'll have to deal with them before you can attack the keep at the heart of the town."),
        (else_try),
          (eq, "$g_siege_battle_state", 2),
          (eq, ":var1", 1),
          (str_store_string, s1, "@The town center is yours, but the remaining defenders have retreated to the castle. It must fall before you can complete your victory."),
        (else_try),
          (jump_to_menu, "$g_siege_final_menu"),
        (try_end),
      (else_try),
        (try_begin),
          (eq, "$g_siege_battle_state", 0),
          (eq, ":var1", 1),
          (assign, "$g_battle_result", 0),
          (jump_to_menu, "$g_siege_final_menu"),
        (else_try),
          (eq, "$g_siege_battle_state", 1),
          (eq, ":var1", 1),
          (str_store_string, s1, "@The remaining defenders have retreated to the castle as a last defense. You must go in and crush any remaining resistance."),
        (else_try),
          (jump_to_menu, "$g_siege_final_menu"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (try_begin),
            (eq, "$g_siege_battle_state", 1),
            (party_get_slot, ":var0", "$g_encountered_party", 10),
            (set_jump_mission, "mt_besiege_inner_battle_town_center"),
          (else_try),
            (party_get_slot, ":var0", "$g_encountered_party", 11),
            (set_jump_mission, "mt_besiege_inner_battle_castle"),
          (try_end),
        (else_try),
          (party_get_slot, ":var0", "$g_encountered_party", 11),
          (set_jump_mission, "mt_besiege_inner_battle_castle"),
        (try_end),
        (set_party_battle_mode),
        (jump_to_scene, ":var0"),
        (val_add, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("construct_ladders", 0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take {reg4} hours to build enough scaling ladders for the assault.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (store_sub, reg4, 19, ":var0"),
      (val_mul, reg4, 2),
      (val_div, reg4, 3),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("build_ladders_cont",
      [],
      "Do_it.",
      [
        (assign, "$g_siege_method", 1),
        (store_current_hours, ":var0"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (store_sub, ":var1", 19, reg0),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (store_add, "$g_siege_method_finish_hours", ":var0", ":var1"),
        (assign, "$auto_besiege_town", "$current_town"),
        (rest_for_hours_interactive, 96, 5, 1),
        (change_screen_return),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("construct_siege_tower", 0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that building a siege tower will take {reg4} hours.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (store_sub, reg4, 15, ":var0"),
      (val_mul, reg4, 6),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("build_siege_tower_cont",
      [],
      "Start_building.",
      [
        (assign, "$g_siege_method", 2),
        (store_current_hours, ":var0"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (store_sub, ":var1", 15, reg0),
        (val_mul, ":var1", 6),
        (store_add, "$g_siege_method_finish_hours", ":var0", ":var1"),
        (assign, "$auto_besiege_town", "$current_town"),
        (rest_for_hours_interactive, 240, 5, 1),
        (change_screen_return),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("castle_attack_walls_simulate", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties:{s8}^^Enemy casualties: {s9}",
    "none",
    [
      (try_begin),
        (set_background_mesh, "mesh_pic_siege_attack"),
      (try_end),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "p_main_party", 1, 1),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (val_mul, ":var0", 3),
      (val_div, ":var0", 4),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "$g_encountered_party", 0, 1),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
      (val_mul, ":var2", 13),
      (val_div, ":var2", 10),
      (val_mul, ":var2", ":var1"),
      (val_mul, ":var0", ":var3"),
      (val_div, ":var2", 100),
      (val_div, ":var0", 100),
      (val_div, ":var2", 50),
      (val_div, ":var0", 50),
      (inflict_casualties_to_party_group, "p_main_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_encountered_party", ":var0", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "$g_encountered_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("castle_attack_walls_with_allies_simulate", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}^^Allies remaining: {reg10}^Enemies remaining: {reg11}",
    "none",
    [
      (try_begin),
        (set_background_mesh, "mesh_pic_siege_attack"),
      (try_end),
      (call_script, "script_kt_party_calculate_strength", "p_main_party", 1, 1),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (val_mul, ":var0", 3),
      (val_div, ":var0", 4),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "$g_ally_party", 0, 1),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
      (val_mul, ":var2", 3),
      (val_div, ":var2", 4),
      (val_max, ":var2", 1),
      (call_script, "script_kt_party_calculate_strength", "p_collective_enemy", 0, 1),
      (assign, ":var4", reg0),
      (assign, ":var5", reg1),
      (val_mul, ":var4", 13),
      (val_div, ":var4", 10),
      (store_add, ":var6", ":var0", ":var2"),
      (store_mul, ":var7", ":var1", ":var4"),
      (store_mul, ":var8", ":var3", ":var4"),
      (val_mul, ":var7", ":var0"),
      (val_mul, ":var8", ":var2"),
      (val_div, ":var7", ":var6"),
      (val_div, ":var8", ":var6"),
      (val_div, ":var7", 100),
      (val_div, ":var8", 100),
      (store_mul, ":var9", ":var6", ":var5"),
      (val_div, ":var9", 100),
      (val_div, ":var7", 50),
      (val_div, ":var8", 50),
      (val_div, ":var9", 50),
      (inflict_casualties_to_party_group, "p_main_party", ":var7", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var9", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (call_script, "script_collect_friendly_parties"),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var8", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_besiegers_camp_with_allies"),
      ]
      ),
    ],
  ),

  ("castle_taken_by_friends", 0,
    "Nothing to see here.",
    "none",
    [
      (party_clear, "$g_encountered_party"),
      (party_stack_get_troop_id, ":var0", "$g_encountered_party_2", 0),
      (party_set_slot, "$g_encountered_party", 28, ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
      (try_begin),
        (assign, ":var2", 20),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (assign, ":var2", 40),
      (try_end),
      (try_begin),
        (neq, ":var1", "$g_encountered_party_faction"),
        (call_script, "script_faction_inflict_war_damage_on_faction", ":var1", "$g_encountered_party_faction", ":var2"),
      (try_end),
      (call_script, "script_give_center_to_faction", "$g_encountered_party", ":var1"),
      (call_script, "script_automatic_relation_gain_after_battles"),
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("castle_taken", mnf_disable_all_keys|mnf_scale_picture,
    "{s3} has fallen to your troops, and you now have full control of the {reg2?town:castle}.{reg1? You may station troops here to defend it against enemies who may try to recapture it. Also, you should select now whether you will hold the {reg2?town:castle} yourself or give it to a faithful vassal...:}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_castletaken_king"),
      (party_clear, "$g_encountered_party"),
      (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (party_get_slot, ":var0", "$g_encountered_party", 7),
        (neq, ":var0", "trp_player"),
        (try_for_range, ":var1", 0, 4),
          (call_script, "script_cf_reinforce_party", "$g_encountered_party"),
        (try_end),
      (try_end),
      (call_script, "script_lift_siege", "$g_encountered_party", 0),
      (assign, "$g_player_besiege_town", -1),
      (party_set_slot, "$g_encountered_party", 28, "trp_player"),
      (call_script, "script_generate_refugees", "$g_encountered_party", 1),
      (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (assign, ":var2", 20),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (assign, ":var2", 40),
      (try_end),
      (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", "$g_encountered_party_faction", ":var2"),
      (try_begin),
        (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "$players_kingdom"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "$players_kingdom"),
        (jump_to_menu, "mnu_castle_taken_2"),
      (else_try),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "fac_player_supporters_faction"),
        (str_store_party_name, s3, "$g_encountered_party"),
        (assign, reg1, 0),
        (try_begin),
          (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
          (assign, reg1, 1),
        (try_end),
      (try_end),
      (assign, reg2, 0),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (assign, reg2, 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("castle_taken_2", mnf_disable_all_keys|mnf_scale_picture,
    "{s3} has fallen to your troops, and you now have full control of the castle. It is time to send word to {s9} about your victory. {s5}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_castletaken_vassal"),
      (str_store_party_name, s3, "$g_encountered_party"),
      (str_clear, s5),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s9, ":var0"),
      (try_begin),
        (eq, "$player_has_homage", 0),
        (assign, reg8, 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 3),
          (assign, reg8, 1),
        (try_end),
        (call_script, "script_gender_to_reg63"),
        (str_store_string, s5, "@However, since you are not a sworn {reg63?man:follower} of {s9}, there is no chance he would recognize you as the {reg63?lord:lady} of this {reg8?town:castle}."),
      (try_end),
    ],
    [
      ("castle_taken_claim",
      [
        (eq, "$player_has_homage", 1),
      ],
      "Request_that_{s3}_be_awarded_to_you.",
      [
        (party_set_slot, "$g_encountered_party", 28, "trp_player"),
        (assign, "$g_castle_requested_by_player", "$current_town"),
        (assign, "$g_castle_requested_for_troop", "trp_player"),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),

      ("castle_taken_claim_2",
      [
        (troop_get_slot, ":var0", "trp_player", 30),
        (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (store_troop_faction, ":var1", ":var0"),
        (eq, ":var1", "$players_kingdom"),
        (call_script, "script_gender_to_reg63"),
      ],
      "Request_that_{s3}_be_awarded_to_your_{reg63?wife:husband}.",
      [
        (party_set_slot, "$g_encountered_party", 28, "trp_player"),
        (assign, "$g_castle_requested_by_player", "$current_town"),
        (troop_get_slot, ":var0", "trp_player", 30),
        (assign, "$g_castle_requested_for_troop", ":var0"),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),

      ("castle_taken_no_claim",
      [],
      "Ask_no_rewards.",
      [
        (party_set_slot, "$g_encountered_party", 28, -1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_player", mnf_scale_picture,
    "You receive a message from your liege, {s3}.^^ {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to you, with all due incomes and titles, to hold in {reg4?her:his} name for as long as you maintain your oath of homage..",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_casltegranted"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s3, ":var0"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", 0, 2),
        (assign, reg3, 1),
        (try_for_range, ":var1", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var1", 120, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":var1"),
        (try_end),
      (else_try),
        (assign, reg3, 0),
      (try_end),
      (troop_get_type, reg4, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_player_husband", mnf_scale_picture,
    "You receive a message from your liege, {s3}.^^ {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to your husband, {s7}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_casltegranted"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s3, ":var0"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", 0, 2),
        (assign, reg3, 1),
        (try_for_range, ":var1", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var1", 120, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":var1"),
        (try_end),
      (else_try),
        (assign, reg3, 0),
      (try_end),
      (troop_get_type, reg4, ":var0"),
      (troop_get_slot, ":var2", "trp_player", 30),
      (str_store_troop_name, s11, ":var2"),
      (str_store_string, s7, "str_to_your_husband_s11"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (troop_get_slot, ":var0", "trp_player", 30),
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", ":var0", 0),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_another", mnf_scale_picture,
    "You receive a message from your monarch, {s3}.^^ 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts. You also requested me to give you ownership of the castle, but that is a favor which I fear I cannot grant, as you already hold significant estates in my realm. Instead I have sent you {reg6} denars to cover the expenses of your campaign, but {s2} I give to {s5}.' ",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_castlerefused"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s3, ":var0"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (party_get_slot, ":var1", "$g_center_to_give_to_player", 7),
      (str_store_troop_name, s5, ":var1"),
      (assign, reg6, 2500),
      (assign, "$g_castle_requested_by_player", -1),
      (assign, "$g_castle_requested_for_troop", -1),
    ],
    [
      ("accept_decision",
      [],
      "Accept_the_decision.",
      [
        (call_script, "script_troop_add_gold", "trp_player", reg6),
        (change_screen_return),
      ]
      ),

      ("leave_faction",
      [],
      "You_have_been_wronged!_Renounce_your_oath_to_your_liege!_",
      [
        (jump_to_menu, "mnu_leave_faction"),
        (call_script, "script_troop_add_gold", "trp_player", reg6),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_another_female", mnf_scale_picture,
    "You receive a message from your monarch, {s3}.^^ 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts. You also requested me to give ownership of the castle to your husband, but that is a favor which I fear I cannot grant, as he already holds significant estates in my realm. Instead I have sent you {reg6} denars to cover the expenses of your campaign, but {s2} I give to {s5}.' ",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_castlerefused"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s3, ":var0"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (party_get_slot, ":var1", "$g_center_to_give_to_player", 7),
      (str_store_troop_name, s5, ":var1"),
      (assign, reg6, 2500),
      (assign, "$g_castle_requested_by_player", -1),
      (assign, "$g_castle_requested_for_troop", -1),
    ],
    [
      ("accept_decision",
      [],
      "Accept_the_decision.",
      [
        (call_script, "script_troop_add_gold", "trp_player", reg6),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("leave_faction", mnf_scale_picture,
    "Renouncing your oath is a grave act. Your lord may condemn you and confiscate your lands and holdings. However, if you return them of your own free will, he may let the betrayal go without a fight.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_leavefaction"),
    ],
    [
      ("leave_faction_give_back",
      [],
      "Renounce_your_oath_and_give_up_your_holdings.",
      [
        (call_script, "script_player_leave_faction", 1),
        (change_screen_return),
      ]
      ),

      ("leave_faction_hold",
      [
        (str_store_party_name, s2, "$g_center_to_give_to_player"),
      ],
      "Renounce_your_oath_and_rule_your_lands,_including_{s2},_in_your_own_name.",
      [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (call_script, "script_player_leave_faction", 0),
        (call_script, "script_activate_player_faction", "trp_player"),
        (change_screen_return),
      ]
      ),

      ("leave_faction_cancel",
      [],
      "Remain_loyal_and_accept_the_decision.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("give_center_to_player", mnf_scale_picture,
    "Your lord offers to extend your fiefs! {s1} sends word that he is willing to grant {s2} to you in payment for your loyal service, adding it to your holdings. What is your answer?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_townreceived"),
      (store_faction_of_party, ":var0", "$g_center_to_give_to_player"),
      (faction_get_slot, ":var1", ":var0", 11),
      (str_store_troop_name, s1, ":var1"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
    ],
    [
      ("give_center_to_player_accept",
      [],
      "Accept_the_offer.",
      [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
      ]
      ),

      ("give_center_to_player_reject",
      [],
      "Reject._You_have_no_interest_in_holding_{s2}.",
      [
        (party_set_slot, "$g_center_to_give_to_player", 7, -3),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("give_center_to_player_2", mnf_scale_picture,
    "With a brief ceremony, you are officially confirmed as the new lord of {s2}{reg3? and its bound village {s4}:}. {reg3?They:It} will make a fine part of your fiefdom. You can now claim the rents and revenues from your personal estates there, draft soldiers from the populace, and manage the lands as you see fit. However, you are also expected to defend your fief and your people from harm, as well as maintaining the rule of law and order.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_townreceived"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (assign, reg3, 0),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", 0, 2),
        (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var0", 120, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":var0"),
          (assign, reg3, 1),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("oath_fulfilled", 0,
    "You had a contract with {s1} to serve him for a certain duration. Your contract has now expired. What will you do?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_oathfulfilled"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s1, ":var0"),
    ],
    [
      ("renew_oath",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 11),
        (str_store_troop_name, s1, ":var0"),
      ],
      "Renew_your_contract_with_{s1}_for_another_month.",
      [
        (store_current_day, ":var0"),
        (store_add, "$mercenary_service_next_renew_day", ":var0", 30),
        (change_screen_return),
      ]
      ),

      ("dont_renew_oath",
      [],
      "Become_free_of_your_bond.",
      [
        (call_script, "script_player_leave_faction", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("siege_started_defender", mnf_scale_picture,
    "{s1} is launching an assault against the walls of {s2}. You have {reg10} troops fit for battle against the enemy's {reg11}. You decide to...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_siegedefense"),
      (select_enemy, 1),
      (assign, "$g_enemy_party", "$g_encountered_party_2"),
      (assign, "$g_ally_party", "$g_encountered_party"),
      (str_store_party_name, s1, "$g_enemy_party"),
      (str_store_party_name, s2, "$g_ally_party"),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$g_siege_first_encounter", 1),
        (call_script, "script_let_nearby_parties_join_current_battle", 0, 1),
        (call_script, "script_encounter_init_variables"),
      (try_end),
      (try_begin),
        (eq, "$g_siege_first_encounter", 0),
        (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (assign, ":var0", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
          (assign, ":var1", reg0),
          (assign, ":var2", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
#pendor original            (eq, ":var0", 0),
#COOP BEGIN bugfix ##############
#              (eq, ":num_enemy_regulars_remaining", 0), #battle won (sdsd = TODO : compare with num_routed_us)
              (this_or_next|le, ":var0", 0), #battle won
              (le, ":var0",  "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################            
            (assign, ":var2", 1),
          (else_try),
            (eq, "$g_engaged_enemy", 1),
#pendor original            (le, "$g_enemy_fit_for_battle", 0),
#COOP BEGIN bugfix ##############
#              (le, "$g_enemy_fit_for_battle",0),
              (this_or_next|le, ":var0", 0), 
              (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################  
            (ge, "$g_friend_fit_for_battle", 1),
            (assign, ":var2", 1),
          (try_end),
          (this_or_next|eq, ":var2", 1),
          (eq, "$g_enemy_surrenders", 1),
          (assign, "$g_next_menu", -1),
          (jump_to_menu, "mnu_total_victory"),
        (else_try),
          (assign, ":var3", 0),
          (try_begin),
            (this_or_next|eq, "$g_battle_result", -1),
            (troop_is_wounded, "trp_player"),
#pendor original            (eq, ":var1", 0),
#COOP BEGIN bugfix ##############
#              (eq, ":num_ally_regulars_remaining", 0), #(sdsd = TODO : compare with num_routed_allies)
              (le, ":var1",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#COOP END##########################
            (assign, ":var3", 1),
          (try_end),
          (this_or_next|eq, ":var3", 1),
          (eq, "$g_player_surrenders", 1),
          (assign, "$g_next_menu", "mnu_captivity_start_under_siege_defeat"),
          (jump_to_menu, "mnu_total_defeat"),
        (else_try),
          (assign, ":var4", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (assign, ":var4", 1),
          (else_try),
            (eq, "$g_battle_result", 0),
            (store_div, ":var5", "$g_enemy_fit_for_battle", 3),
            (lt, ":var5", "$g_friend_fit_for_battle"),
            (assign, ":var4", 1),
          (else_try),
            (store_random_in_range, ":var6", 0, 100),
            (store_mul, ":var7", ":var1", 13),
            (val_div, ":var7", 10),
            (ge, ":var7", ":var0"),
            (lt, ":var6", 10),
            (neq, "$new_encounter", 1),
            (assign, ":var4", 1),
          (try_end),
          (try_begin),
            (eq, ":var4", 1),
            (party_get_slot, ":var8", "$g_encountered_party", 65),
            (val_add, ":var8", 100),
            (party_set_slot, "$g_encountered_party", 65, ":var8"),
            (party_set_slot, "$g_enemy_party", 2, 1),
            (try_for_range, ":var9", "trp_npc_adonja", "trp_knight_1_1_wife"),
              (troop_slot_eq, ":var9", 2, 2),
              (neg|troop_slot_ge, ":var9", 8, 0),
              (troop_get_slot, ":var10", ":var9", 10),
              (gt, ":var10", 0),
              (party_slot_eq, ":var10", 4, 1),
              (party_slot_eq, ":var10", 5, "$g_encountered_party"),
              (party_slot_eq, ":var10", 8, 1),
              (call_script, "script_party_set_ai_state", ":var10", -1, -1),
              (call_script, "script_party_set_ai_state", ":var10", 1, "$g_encountered_party"),
            (try_end),
            (try_begin),
              (store_faction_of_party, ":var11", "$g_enemy_party"),
              (neg|is_between, ":var11", "fac_player_supporters_faction", "fac_kingdoms_end"),
              (party_set_ai_behavior, "$g_enemy_party", ai_bhvr_patrol_location),
              (party_set_ai_initiative, "$g_enemy_party", 100),
              (display_message, "@The enemy has been forced to retreat and abandon the surprise assault."),
            (else_try),
              (display_message, "@The enemy has been forced to retreat. The assault is over, but the siege continues."),
            (try_end),
            (assign, "$g_battle_simulation_cancel_for_party", "$g_encountered_party"),
            (leave_encounter),
            (change_screen_return),
            (assign, "$g_battle_simulation_auto_enter_town_after_battle", "$g_encountered_party"),
          (try_end),
        (try_end),
      (try_end),
      (assign, "$g_siege_first_encounter", 0),
      (assign, "$new_encounter", 0),
    ],
    [
      ("siege_defender_join_battle",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Join_the_battle.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (assign, "$g_battle_result", 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (party_get_slot, ":var0", "$g_encountered_party", 18),
        (else_try),
          (party_get_slot, ":var0", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (val_mul, reg0, 2),
        (val_div, reg0, 3),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (party_slot_eq, "$current_town", 27, 1),
          (set_jump_mission, "mt_castle_attack_walls_belfry"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (jump_to_scene, ":var0"),
        (assign, "$g_next_menu", "mnu_siege_started_defender"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("siege_defender_troops_join_battle",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (this_or_next|troop_is_wounded, "trp_player"),
        (ge, reg0, 3),
      ],
      "Order_your_men_to_join_the_battle_without_you.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (select_enemy, 1),
        (assign, "$g_enemy_party", "$g_encountered_party_2"),
        (assign, "$g_ally_party", "$g_encountered_party"),
        (assign, "$g_siege_join", 1),
        (jump_to_menu, "mnu_siege_join_defense")]),
#COOP BEGIN Siege defend#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_siege_player_defend),
        (assign, "$g_siege_first_encounter", 1),#we are not finished in this menu yet
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
       ]),	
	  

      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [
        (call_script, "script_calculate_renown_value"),
        (assign, "$g_siege_first_encounter", 0),
        (assign, "$new_encounter", 0),
        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (assign, "$g_next_menu", "mnu_siege_started_defender"),
        (jump_to_menu, "mnu_battle_debrief"),

      ]),		  

	  ("encounter_save",[],"Give me time to save.",
	  [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),		  
#COOP END#################################################
    ],
  ),

  ("siege_join_defense", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}^^Allies remaining: {reg10}^Enemies remaining: {reg11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_siegedefense"),
      (try_begin),
        (eq, "$g_siege_join", 1),
        (call_script, "script_kt_party_calculate_strength", "p_main_party", 1, 1),
        (assign, ":var0", reg0),
        (assign, ":var1", reg1),
        (val_mul, ":var0", 13),
        (val_div, ":var0", 10),
      (else_try),
        (assign, ":var0", 0),
        (assign, ":var1", 1),
      (try_end),
      (call_script, "script_kt_party_calculate_strength_with_attachments", "$g_ally_party", 0, 1),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
      (val_mul, ":var2", 13),
      (val_div, ":var2", 10),
      (call_script, "script_kt_party_calculate_strength", "p_collective_enemy", 0, 1),
      (assign, ":var4", reg0),
      (assign, ":var5", reg1),
      (val_mul, ":var4", 3),
      (val_div, ":var4", 4),
      (store_add, ":var6", ":var0", ":var2"),
      (store_mul, ":var7", ":var1", ":var4"),
      (store_mul, ":var8", ":var3", ":var4"),
      (val_mul, ":var7", ":var0"),
      (val_mul, ":var8", ":var2"),
      (val_div, ":var7", ":var6"),
      (val_div, ":var8", ":var6"),
      (val_div, ":var7", 100),
      (val_div, ":var8", 100),
      (store_mul, ":var9", ":var6", ":var5"),
      (val_div, ":var9", 100),
      (val_div, ":var7", 50),
      (val_div, ":var8", 50),
      (val_div, ":var9", 50),
      (inflict_casualties_to_party_group, "p_main_party", ":var7", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var8", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var9", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (str_store_string, s4, "str_siege_defender_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_siege_defender_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_siege_defender_order_attack_continue"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_siege_started_defender"),
      ]
      ),
    ],
  ),

  ("enter_your_own_castle", mnf_scale_picture,
    "{s10}",
    "none",
    [
      (call_script, "script_gender_to_reg63"),
      (try_begin),
        (neg|is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 11),
        (eq, ":var0", "trp_player"),
        (str_store_string, s10, "@As you approach, you are spotted by the castle guards, who welcome you and open the gates for their {reg63?king:queen}."),
      (else_try),
        (str_store_string, s10, "@As you approach, you are spotted by the castle guards, who welcome you and open the gates for their {reg63?lord:lady}."),
      (try_end),
      (str_store_party_name, s2, "$current_town"),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("village", mnf_enable_hot_keys,
    "{s10} {s12}^{s11}^{s6}{s7}",
    "none",
    [
      (call_script, "script_detect_load_restore_custom_troops"),
      (assign, "$current_town", "$g_encountered_party"),
      (call_script, "script_update_center_recon_notes", "$current_town"),
      (assign, "$g_defending_against_siege", 0),
      (assign, "$g_battle_result", 0),
      (assign, "$qst_collect_taxes_currently_collecting", 0),
      (assign, "$qst_train_peasants_against_bandits_currently_training", 0),
      (call_script, "script_music_set_situation_with_culture", 67108864),
      (try_begin),
        (gt, "$auto_enter_menu_in_center", 0),
        (jump_to_menu, "$auto_enter_menu_in_center"),
        (assign, "$auto_enter_menu_in_center", 0),
      (try_end),
      (try_begin),
        (neq, "$g_player_raiding_village", "$current_town"),
        (assign, "$g_player_raiding_village", 0),
      (else_try),
        (jump_to_menu, "mnu_village_loot_continue"),
      (try_end),
      (try_begin),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
      (try_end),
      (str_store_party_name, s2, "$current_town"),
      (party_get_slot, ":var0", "$current_town", 7),
      (store_faction_of_party, ":var1", "$current_town"),
      (str_store_faction_name, s9, ":var1"),
      (try_begin),
        (ge, ":var0", 0),
        (str_store_troop_name, s8, ":var0"),
        (str_store_string, s7, "@{s8} of the {s9}"),
      (try_end),
      (str_clear, s10),
      (str_clear, s12),
      (try_begin),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (str_store_string, s60, s2),
        (party_get_slot, ":var2", "$current_town", 50),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg4, ":var2"),
          (display_message, "@{!}Prosperity: {reg4}"),
        (try_end),
        (try_begin),
          (le, ":var2", 3),
          (assign, ":var3", 0),
        (else_try),
          (le, ":var2", 9),
          (assign, ":var3", 1),
        (else_try),
          (le, ":var2", 24),
          (assign, ":var3", 2),
        (else_try),
          (le, ":var2", 45),
          (assign, ":var3", 3),
        (else_try),
          (le, ":var2", 75),
          (assign, ":var3", 4),
        (else_try),
          (le, ":var2", 117),
          (assign, ":var3", 5),
        (else_try),
          (le, ":var2", 183),
          (assign, ":var3", 6),
        (else_try),
          (le, ":var2", 225),
          (assign, ":var3", 7),
        (else_try),
          (le, ":var2", 255),
          (assign, ":var3", 8),
        (else_try),
          (le, ":var2", 276),
          (assign, ":var3", 9),
        (else_try),
          (le, ":var2", 291),
          (assign, ":var3", 10),
        (else_try),
          (le, ":var2", 297),
          (assign, ":var3", 11),
        (else_try),
          (gt, ":var2", 297),
          (assign, ":var3", 12),
        (try_end),
        (store_add, ":var4", "str_village_prosperity_0", ":var3"),
        (str_store_string, s10, ":var4"),
        (store_div, ":var4", ":var2", 60),
        (val_min, ":var4", 4),
        (try_begin),
          (val_add, ":var4", "str_village_alt_prosperity_0"),
        (try_end),
        (str_store_string, s12, ":var4"),
      (try_end),
      (str_clear, s11),
      (try_begin),
        (party_slot_eq, "$current_town", 35, 2),
      (else_try),
        (eq, ":var0", "trp_player"),
        (str_store_string, s11, "@ This village and the surrounding lands belong to you."),
      (else_try),
        (ge, ":var0", 0),
        (str_store_string, s11, "@ You remember that this village and the surrounding lands belong to {s7}."),
      (else_try),
        (str_store_string, s11, "@ These lands belong to no one."),
      (try_end),
      (str_clear, s7),
      (try_begin),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (party_get_slot, ":var5", "$current_town", 26),
        (call_script, "script_describe_center_relation_to_s3", ":var5"),
        (assign, reg9, ":var5"),
        (str_store_string, s7, "@{!} {s3} ({reg9})."),
      (try_end),
      (str_clear, s6),
      (try_begin),
        (party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var6", "$current_town", 39),
        (store_character_level, ":var7", "trp_player"),
        (store_add, "$qst_eliminate_bandits_infesting_village_num_bandits", ":var7", 10),
        (val_mul, "$qst_eliminate_bandits_infesting_village_num_bandits", 12),
        (val_div, "$qst_eliminate_bandits_infesting_village_num_bandits", 10),
        (store_random_in_range, "$qst_eliminate_bandits_infesting_village_num_villagers", 25, 30),
        (assign, reg8, "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_troop_name_by_count, s35, ":var6", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_string, s6, "@ The village is infested by {reg8} {s35}."),
        (assign, "$g_enemy_party", -1),
        (assign, "$g_ally_party", -1),
        (try_begin),
          (eq, ":var6", "trp_forest_bandit"),
          (set_background_mesh, "mesh_pic_forest_bandits"),
        (else_try),
          (eq, ":var6", "trp_steppe_bandit"),
          (set_background_mesh, "mesh_pic_steppe_bandits"),
        (else_try),
          (eq, ":var6", "trp_mountain_bandit"),
          (set_background_mesh, "mesh_pic_mountain_bandits"),
        (else_try),
          (eq, ":var6", "trp_vanskerry_marauder"),
          (set_background_mesh, "mesh_pic_sea_raiders"),
        (else_try),
          (set_background_mesh, "mesh_pic_bandits"),
        (try_end),
      (else_try),
        (party_slot_eq, "$current_town", 35, 2),
        (str_store_string, s6, "@ The village has been looted. A handful of souls scatter as you pass through the burnt out houses."),
        (try_begin),
          (neq, "$g_player_raid_complete", 1),
          (play_track, "track_empty_village_lic", 1),
        (try_end),
        (set_background_mesh, "mesh_pic_looted_village"),
      (else_try),
        (party_slot_eq, "$current_town", 35, 1),
        (str_store_string, s6, "@ The village is being raided."),
      (else_try),
        (party_get_current_terrain, ":var8", "$current_town"),
        (try_begin),
          (this_or_next|eq, ":var8", 2),
          (this_or_next|eq, ":var8", 10),
          (this_or_next|eq, ":var8", 5),
          (eq, ":var8", 13),
          (set_background_mesh, "mesh_pic_village_s"),
        (else_try),
          (this_or_next|eq, ":var8", 4),
          (eq, ":var8", 12),
          (set_background_mesh, "mesh_pic_village_w"),
        (else_try),
          (set_background_mesh, "mesh_pic_village_p"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_player_raid_complete", 1),
        (assign, "$g_player_raid_complete", 0),
        (jump_to_menu, "mnu_village_loot_complete"),
      (else_try),
        (party_get_slot, ":var9", "$current_town", 34),
        (gt, ":var9", 0),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town", 1),
        (assign, "$g_leave_town", 0),
        (change_screen_return),
      (try_end),
      (try_begin),
        (store_time_of_day, ":var10"),
        (ge, ":var10", 5),
        (lt, ":var10", 21),
        (assign, "$town_nighttime", 0),
      (else_try),
        (assign, "$town_nighttime", 1),
      (try_end),
    ],
    [
      ("village_manage",
      [
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Manage_this_village.",
      [
        (assign, "$g_next_menu", "mnu_village"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("village_train_steward",
      [
        (party_slot_eq, "$current_town", 295, 1),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Train_your_village_steward.",
      [
        (assign, "$g_next_menu", "mnu_village"),
        (jump_to_menu, "mnu_steward_training"),
      ]
      ),

      ("village_elder_talk",
      [
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Speak_with_the_Village_Elder.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (party_get_slot, ":var1", "$current_town", 25),
          (set_visitor, 11, ":var1"),
          (call_script, "script_init_town_walkers"),
          (try_begin),
            (check_quest_active, "qst_hunt_down_fugitive"),
            (neg|is_currently_night),
            (quest_slot_eq, "qst_hunt_down_fugitive", 1, "$current_town"),
            (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
            (neg|check_quest_failed, "qst_hunt_down_fugitive"),
            (set_visitor, 45, "trp_fugitive"),
          (try_end),
          (set_jump_mission, "mt_village_center"),
          (jump_to_scene, ":var0"),
          (change_screen_map_conversation, ":var1"),
        (try_end),
      ]
,
      "Door_to_the_village_center"
      ),

      ("recruit_volunteers",
      [
        (call_script, "script_cf_village_recruit_volunteers_cond"),
      ],
      "Recruit_Volunteers.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (jump_to_menu, "mnu_recruit_volunteers"),
        (try_end),
      ]
      ),

      ("village_center",
      [
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Go_to_the_village_center.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (party_get_slot, ":var1", "$current_town", 25),
          (set_visitor, 11, ":var1"),
          (call_script, "script_init_town_walkers"),
          (try_begin),
            (check_quest_active, "qst_hunt_down_fugitive"),
            (neg|is_currently_night),
            (quest_slot_eq, "qst_hunt_down_fugitive", 1, "$current_town"),
            (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
            (neg|check_quest_failed, "qst_hunt_down_fugitive"),
            (set_visitor, 45, "trp_fugitive"),
          (try_end),
          (set_jump_mission, "mt_village_center"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_village_center"
      ),

      ("village_buy_food",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Buy_supplies_from_the_peasants.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 25),
          (change_screen_trade, ":var0"),
        (try_end),
      ]
      ),

      ("village_attack_bandits",
      [
        (neg|troop_is_wounded, "trp_player"),
        (party_slot_ge, "$current_town", 39, 1),
      ],
      "Attack_the_bandits.",
      [
        (party_get_slot, ":var0", "$current_town", 39),
        (party_get_slot, ":var1", "$current_town", 10),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (set_visitors, 0, ":var0", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (store_character_level, ":var2", "trp_player"),
        (val_div, ":var2", 3),
        (set_visitors, 0, "trp_rogue_knight", ":var2"),
        (store_div, ":var3", "$qst_eliminate_bandits_infesting_village_num_bandits", 6),
        (val_div, ":var2", 2),
        (store_add, "$battle_renown_value", ":var2", ":var3"),
        (val_add, "$battle_renown_value", 3),
        (set_visitors, 2, "trp_farmer", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission, "mt_village_attack_bandits"),
        (jump_to_scene, ":var1"),
        (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", 1),
        (change_screen_mission),
      ]
      ),
      
#COOP BEGIN Village bandits#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_village_player_defend),

        # (set_visitors, 0, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        # (set_visitors, 2, "trp_farmer", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (party_get_slot, ":var0", "$current_town", slot_village_infested_by_bandits),

        (party_clear, "p_temp_wounded"), #use this party to temp make bandits
        (party_add_members, "p_temp_wounded", ":var0", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (assign, "$coop_encountered_party", "p_temp_wounded"),
        (assign, "$g_ally_party", "$current_town"),

        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
       ]),	
	  
      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      ],"Use multiplayer battle results.", 
      [

        (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      ]),		  
 
      ("encounter_save",[(party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1)],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),  
          
#COOP END#################################################

      ("village_wait",
      [
        (party_slot_eq, "$current_town", 251, 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Wait_here_for_some_time.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_last_rest_center", "$current_town"),
        (try_begin),
          (party_is_active, "p_main_party"),
          (party_get_current_terrain, ":var0", "p_main_party"),
          (try_begin),
            (eq, ":var0", 5),
            (372, 28),
          (try_end),
        (try_end),
        (rest_for_hours_interactive, 168, 5, 1),
        (change_screen_return),
      ]
      ),

      ("collect_taxes_qst",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (check_quest_active, "qst_collect_taxes"),
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (quest_slot_eq, "qst_collect_taxes", 1, "$current_town"),
        (neg|quest_slot_eq, "qst_collect_taxes", 11, 4),
        (str_store_troop_name, s1, ":var0"),
        (quest_get_slot, reg5, "qst_collect_taxes", 11),
      ],
      "{reg5?Continue_collecting_taxes:Collect_taxes}_due_to_{s1}.",
      [
        (jump_to_menu, "mnu_collect_taxes"),
      ]
      ),

      ("train_peasants_against_bandits_qst",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (check_quest_active, "qst_train_peasants_against_bandits"),
        (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
        (quest_slot_eq, "qst_train_peasants_against_bandits", 1, "$current_town"),
      ],
      "Train_the_peasants.",
      [
        (jump_to_menu, "mnu_train_peasants_against_bandits"),
      ]
      ),

      ("village_hostile_action",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (neq, "$players_kingdom", "$g_encountered_party_faction"),
      ],
      "Take_a_hostile_action.",
      [
        (jump_to_menu, "mnu_village_hostile_action"),
      ]
      ),

      ("village_reports",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Show_reports.",
      [
        (jump_to_menu, "mnu_center_reports"),
      ]
      ),

      ("village_leave",
      [],
      "Leave.",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("village_hostile_action", mnf_scale_picture,
    "What action do you have in mind?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_hostileaction"),
    ],
    [
      ("village_take_food",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var0", "$current_town", 25),
        (assign, ":var1", 0),
        (try_for_range, ":var2", 10, 106),
          (troop_get_inventory_slot, ":var3", ":var0", ":var2"),
          (ge, ":var3", 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Force_the_peasants_to_give_you_supplies.",
      [
        (jump_to_menu, "mnu_village_take_food_confirm"),
      ]
      ),

      ("village_steal_cattle",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (party_slot_eq, "$current_town", 46, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var0", "$current_town", 205),
        (neg|party_slot_eq, "$current_town", 7, "trp_player"),
        (gt, ":var0", 0),
      ],
      "Steal_cattle.",
      [
        (jump_to_menu, "mnu_village_steal_cattle_confirm"),
      ]
      ),

      ("village_loot",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (store_faction_of_party, ":var0", "$current_town"),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
        (lt, ":var1", 0),
      ],
      "Loot_and_burn_this_village.",
      [
        (jump_to_menu, "mnu_village_start_attack"),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("recruit_volunteers", mnf_scale_picture,
    "{s18}",
    "none",
    [
      (party_get_slot, ":var0", "$current_town", 92),
      (party_get_slot, ":var1", "$current_town", 93),
      (party_get_free_companions_capacity, ":var2", "p_main_party"),
      (store_troop_gold, ":var3", "trp_player"),
      (store_div, ":var4", ":var3", 20),
      (assign, ":var5", ":var2"),
      (val_min, ":var5", ":var4"),
      (try_begin),
        (gt, ":var5", 0),
        (val_min, ":var1", ":var5"),
      (try_end),
      (assign, reg5, ":var1"),
      (assign, reg7, 0),
      (try_begin),
        (gt, ":var1", ":var4"),
        (assign, reg7, 1),
      (try_end),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s18, "@No one here seems to be willing to join your party."),
      (else_try),
        (store_mul, reg6, ":var1", 20),
        (str_store_troop_name_by_count, s3, ":var0", ":var1"),
        (try_begin),
          (eq, reg5, 1),
          (str_store_string, s18, "@One {s3} volunteer to follow you for 20 Dinars."),
        (else_try),
          (str_store_string, s18, "@{reg5} {s3} volunteers to follow you for 20 Dinars each."),
        (try_end),
        (set_background_mesh, "mesh_pic_recruits"),
      (try_end),
    ],
    [
      ("continue_not_enough_gold",
      [
        (eq, reg7, 1),
      ],
      "I_don't_have_enough_money...",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),

      ("continue",
      [
        (eq, reg7, 0),
        (eq, reg5, 0),
      ],
      "Continue...",
      [
        (party_set_slot, "$current_town", 93, -1),
        (jump_to_menu, "mnu_village"),
      ]
      ),

      ("recruit_them",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Recruit_them_({reg6}_denars).",
      [
        (call_script, "script_village_recruit_volunteers_recruit"),
        (jump_to_menu, "mnu_village"),
      ]
      ),

      ("forget_it",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_hunt_down_fugitive_defeated", mnf_scale_picture,
    "A heavy blow from the fugitive sends you to the ground, and your vision spins and goes dark. Time passes. When you open your eyes again you find yourself battered and bloody, but luckily none of the wounds appear to be lethal.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_lostagainstfugitives"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_infest_bandits_result", mnf_scale_picture,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (jump_to_menu, "mnu_village_infestation_removed"),
      (else_try),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits. Infuriated, they raze the village to the ground to punish the peasants, and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (party_set_slot, "$g_encountered_party", 39, 0),
        (call_script, "script_village_set_state", "$current_town", 2),
        (party_set_slot, "$current_town", 36, 0),
        (party_set_slot, "$current_town", 37, 0),
        (try_begin),
          (check_quest_active, "qst_eliminate_bandits_infesting_village"),
          (quest_slot_eq, "qst_eliminate_bandits_infesting_village", 1, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -5),
          (call_script, "script_fail_quest", "qst_eliminate_bandits_infesting_village"),
          (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
        (else_try),
          (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
          (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", 1, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -4),
          (call_script, "script_fail_quest", "qst_deal_with_bandits_at_lords_village"),
          (call_script, "script_end_quest", "qst_deal_with_bandits_at_lords_village"),
        (else_try),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
        (try_end),
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_infestation_removed", mnf_disable_all_keys|mnf_scale_picture,
    "In a battle worthy of song, you and your men drive the bandits out of the village, making it safe once more. The villagers have little left in the way of wealth after their ordeal, but they offer you all they can find.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_cleaned"),
      (party_get_slot, ":var0", "$g_encountered_party", 39),
      (party_set_slot, "$g_encountered_party", 39, 0),
      (party_clear, "p_temp_party"),
      (party_add_members, "p_temp_party", ":var0", "$qst_eliminate_bandits_infesting_village_num_bandits"),
      (assign, "$g_strength_contribution_of_player", 50),
      (call_script, "script_party_give_xp_and_gold", "p_temp_party"),
      (try_begin),
        (check_quest_active, "qst_eliminate_bandits_infesting_village"),
        (quest_slot_eq, "qst_eliminate_bandits_infesting_village", 1, "$g_encountered_party"),
        (call_script, "script_finish_quest_simple", "qst_eliminate_bandits_infesting_village", 100),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 5),
      (else_try),
        (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
        (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", 1, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_bandits_at_lords_village"),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
      (else_try),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
      (try_end),
      (party_get_slot, ":var1", "$current_town", 25),
      (try_for_range, ":var2", 10, 106),
        (store_random_in_range, ":var3", 0, 100),
        (lt, ":var3", 70),
        (troop_set_inventory_slot, ":var1", ":var2", -1),
      (try_end),
    ],
    [
      ("village_bandits_defeated_accept",
      [],
      "Take_it_as_your_just_due.",
      [
        (jump_to_menu, "mnu_village"),
        (party_get_slot, ":var0", "$current_town", 25),
        (troop_sort_inventory, ":var0"),
        (change_screen_loot, ":var0"),
      ]
      ),

      ("village_bandits_defeated_cont",
      [],
      "Refuse,_stating_that_they_need_these_items_more_than_you_do.",
      [
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
        (call_script, "script_change_player_honor", 1),
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("steward_training", mnf_disable_all_keys|mnf_scale_picture,
    "The meeting between you and your {s17} steward^is prepared to begin.^^Based on the amount of information your steward needs to learn,^the meeting will last {reg8} hours and cost {reg9} denars.{reg6?^^Unfortunately you do not currently have the funds to hold this meeting...:}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_training"),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (str_store_string, s17, "@village"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (str_store_string, s17, "@town"),
      (else_try),
        (str_store_string, s17, "@castle"),
      (try_end),
      (party_get_slot, ":var0", "$g_encountered_party", 293),
      (call_script, "script_pop_check_steward_skills", ":var0"),
      (try_begin),
        (lt, reg1, 4),
        (assign, reg8, 3),
        (assign, reg9, 450),
      (else_try),
        (gt, reg1, 17),
        (assign, reg8, 18),
        (assign, reg9, 2700),
      (else_try),
        (assign, reg8, reg1),
        (store_mul, ":var1", reg1, 150),
        (assign, reg9, ":var1"),
      (try_end),
      (try_begin),
        (assign, reg6, 0),
        (store_troop_gold, ":var2", "trp_player"),
        (lt, ":var2", reg9),
        (assign, reg6, 1),
      (try_end),
    ],
    [
      ("steward_training_confirm",
      [
        (eq, reg6, 0),
      ],
      "Begin_the_meeting.",
      [
        (party_set_slot, "$current_town", 295, 0),
        (assign, ":var0", reg9),
        (troop_remove_gold, "trp_player", ":var0"),
        (party_get_slot, ":var1", "$current_town", 293),
        (call_script, "script_pop_train_steward", ":var1"),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$pop_train_steward_hours", reg8),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours, 1000, 5, 0),
        (change_screen_return),
      ]
      ),

      ("steward_training_decline",
      [],
      "Put_the_meeting_off_until_later.",
      [
        (jump_to_menu, "$g_next_menu"),
      ]
      ),
    ],
  ),

  ("steward_training_complete", mnf_disable_all_keys|mnf_scale_picture,
    "The meeting with your {s17} steward was a success. He thanks you for your time, returning to {reg9?the castle:his home} with renewed confidence in his abilities.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_training"),
      (assign, reg9, 1),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 4),
        (str_store_string, s17, "@village"),
        (assign, reg9, 0),
      (else_try),
        (party_slot_eq, "$current_town", 0, 3),
        (str_store_string, s17, "@town"),
      (else_try),
        (str_store_string, s17, "@castle"),
      (try_end),
      (try_begin),
        (neg|party_slot_eq, "$current_town", 0, 2),
        (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("center_manage", mnf_scale_picture,
    "{s19}^{reg6?^^You are currently building {s7}. The current project will be completed after {reg8} day{reg9?s:}.:}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_manage_construction"),
      (assign, ":var0", 0),
      (str_clear, s18),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (assign, ":var1", 250),
        (assign, ":var2", 273),
        (str_store_string, s17, "@village"),
      (else_try),
        (assign, ":var1", 262),
        (assign, ":var2", 289),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (str_store_string, s17, "@town"),
      (else_try),
        (assign, ":var1", 260),
        (assign, ":var2", 276),
        (str_store_string, s17, "@castle"),
      (try_end),
      (str_clear, s18),
      (try_for_range, ":var3", ":var1", ":var2"),
        (party_slot_ge, "$g_encountered_party", ":var3", 1),
        (val_add, ":var0", 1),
        (assign, reg0, 0),
        (call_script, "script_get_improvement_details", ":var3", "$g_encountered_party"),
        (party_get_slot, ":var4", "$g_encountered_party", ":var3"),
        (eq, ":var4", 1),
        (str_store_string, s10, "@{s10}"),
        (try_begin),
          (eq, ":var0", 1),
          (gt, reg10, 1),
          (str_store_string, s18, "@^{s10}"),
        (else_try),
          (gt, reg10, 1),
          (str_store_string, s18, "@{s18}^{s10}."),
        (try_end),
      (try_end),
      (try_for_range, ":var3", ":var1", ":var2"),
        (party_slot_ge, "$g_encountered_party", ":var3", 1),
        (val_add, ":var0", 1),
        (assign, reg10, 0),
        (call_script, "script_get_improvement_details", ":var3", "$g_encountered_party"),
        (party_get_slot, ":var4", "$g_encountered_party", ":var3"),
        (is_between, ":var4", 2, 10),
        (val_mul, ":var4", 10),
        (assign, reg12, ":var4"),
        (str_store_string, s10, "@({s10} - {reg12}% Damaged-)"),
        (try_begin),
          (eq, ":var0", 1),
          (gt, reg10, 1),
          (str_store_string, s18, "@^{s10}"),
        (else_try),
          (gt, reg10, 1),
          (str_store_string, s18, "@{s18}^{s10}."),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s19, "@The {s17} has no improvements."),
      (else_try),
        (str_store_string, s19, "@The {s17} has the following improvements:^^       {s18}"),
      (try_end),
      (assign, reg6, 0),
      (try_begin),
        (party_get_slot, ":var5", "$g_encountered_party", 124),
        (gt, ":var5", 0),
        (call_script, "script_get_improvement_details", ":var5", "$g_encountered_party"),
        (gt, reg10, 1),
        (str_store_string, s7, s10),
        (assign, reg6, 1),
        (store_current_hours, ":var6"),
        (party_get_slot, ":var7", "$g_encountered_party", 125),
        (val_sub, ":var7", ":var6"),
        (store_div, reg8, ":var7", 24),
        (val_max, reg8, 1),
        (store_sub, reg9, reg8, 1),
      (try_end),
    ],
    [
      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "$g_next_menu"),
      ]
      ),

      ("center_send_out_prospectors",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 1),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 1),
        (party_slot_eq, "$g_encountered_party", 292, 0),
        (party_slot_eq, "$g_encountered_party", 269, 0),
      ],
      "Send_out_prospectors.",
      [
        (assign, "$g_improvement_type", 292),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_training_grounds",
      [
        (neq, reg6, 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 3),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_trainer, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_weapon_master, ":var0"),
        (ge, ":var1", 5),
        (neg|party_slot_eq, "$g_encountered_party", 274, 1),
      ],
      "Build_training_grounds.",
      [
        (assign, "$g_improvement_type", 274),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_manor",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 251, 1),
      ],
      "Build_a_manor.",
      [
        (assign, "$g_improvement_type", 251),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_herbalist",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_first_aid, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_wound_treatment, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 250, 1),
      ],
      "Build_a_herbalist.",
      [
        (assign, "$g_improvement_type", 250),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_fishpond",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 1),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 252, 1),
      ],
      "Build_fish_pond.",
      [
        (assign, "$g_improvement_type", 252),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_shrine",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_wound_treatment, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 270, 1),
      ],
      "Build_a_shrine.",
      [
        (assign, "$g_improvement_type", 270),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_watch_tower",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 1),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 253, 1),
      ],
      "Build_a_watch_tower.",
      [
        (assign, "$g_improvement_type", 253),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_school",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_trainer, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 254, 1),
      ],
      "Build_a_school.",
      [
        (assign, "$g_improvement_type", 254),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_renderers",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_inventory_management, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 255, 1),
      ],
      "Build_renderers.",
      [
        (assign, "$g_improvement_type", 255),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_crop_rotation",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_inventory_management, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 256, 1),
      ],
      "Implement_crop_rotation.",
      [
        (assign, "$g_improvement_type", 256),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_hunting_lodge",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tracking, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 257, 1),
      ],
      "Build_hunting_lodge.",
      [
        (assign, "$g_improvement_type", 257),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_improved_roads",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 263, 1),
      ],
      "Improve_roads.",
      [
        (assign, "$g_improvement_type", 263),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_warehouse",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_inventory_management, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 280, 1),
      ],
      "Build_warehouse.",
      [
        (assign, "$g_improvement_type", 280),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_foresters",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_tracking, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 258, 1),
      ],
      "Hire_foresters.",
      [
        (assign, "$g_improvement_type", 258),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_sheriff",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_trainer, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_tracking, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 259, 1),
      ],
      "Hire_a_sheriff.",
      [
        (assign, "$g_improvement_type", 259),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_building_civic_patrols",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tracking, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 1),
        (neg|party_slot_eq, "$g_encountered_party", 288, 1),
      ],
      "Hire_civic_patrols.",
      [
        (assign, "$g_improvement_type", 288),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_prisoner_tower",
      [
        (neq, reg6, 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 3),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_prisoner_management, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 275, 1),
      ],
      "Build_a_prison_tower.",
      [
        (assign, "$g_improvement_type", 275),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_market",
      [
        (neq, reg6, 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_looting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 260, 1),
      ],
      "Build_a_market.",
      [
        (assign, "$g_improvement_type", 260),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_blacksmith",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 262, 1),
      ],
      "Build_blacksmith.",
      [
        (assign, "$g_improvement_type", 262),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_sanitation_standards",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 264, 1),
      ],
      "Implement_sanitation_standards.",
      [
        (assign, "$g_improvement_type", 264),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_church",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_leadership, ":var0"),
        (ge, ":var1", 5),
        (neg|party_slot_eq, "$g_encountered_party", 265, 1),
      ],
      "Build_church.",
      [
        (assign, "$g_improvement_type", 265),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_winery",
      [
        (neq, reg6, 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_first_aid, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 261, 1),
      ],
      "Build_winery.",
      [
        (assign, "$g_improvement_type", 261),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_tax_collector",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_looting, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 266, 1),
      ],
      "Build_tax_collector_office.",
      [
        (assign, "$g_improvement_type", 266),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_fire_brigade",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 267, 1),
      ],
      "Build_fire_brigade.",
      [
        (assign, "$g_improvement_type", 267),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_craftsmen",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 268, 1),
      ],
      "Train_craftsmen.",
      [
        (assign, "$g_improvement_type", 268),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_well_cleaners",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 283, 1),
      ],
      "Train_well_cleaners.",
      [
        (assign, "$g_improvement_type", 283),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_streetsweepers",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tracking, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 284, 1),
      ],
      "Hire_street_sweepers.",
      [
        (assign, "$g_improvement_type", 284),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_building_inspectors",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 285, 1),
      ],
      "Train_building_inspectors.",
      [
        (assign, "$g_improvement_type", 285),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_mine",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 4),
        (party_slot_ge, "$g_encountered_party", 291, 5),
        (neg|party_slot_eq, "$g_encountered_party", 269, 1),
      ],
      "Build_a_mine.",
      [
        (assign, "$g_improvement_type", 269),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_monastery",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_trainer, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 271, 1),
      ],
      "Build_monastery.",
      [
        (assign, "$g_improvement_type", 271),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_messenger_post",
      [
        (neq, reg6, 1),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 272, 1),
      ],
      "Build_messenger_post.",
      [
        (assign, "$g_improvement_type", 272),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_chapel",
      [
        (neq, reg6, 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 3),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_leadership, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 273, 1),
      ],
      "Build_chapel.",
      [
        (assign, "$g_improvement_type", 273),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_hospital",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 3),
        (store_skill_level, ":var1", skl_surgery, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 3),
        (neg|party_slot_eq, "$g_encountered_party", 276, 1),
      ],
      "Build_hospital.",
      [
        (assign, "$g_improvement_type", 276),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_university",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_trainer, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 4),
        (neg|party_slot_eq, "$g_encountered_party", 277, 1),
      ],
      "Build_university.",
      [
        (assign, "$g_improvement_type", 277),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_cathedral",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_engineer, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_leadership, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 6),
        (neg|party_slot_eq, "$g_encountered_party", 278, 1),
      ],
      "Build_cathedral.",
      [
        (assign, "$g_improvement_type", 278),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_courts",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_prisoner_management, ":var0"),
        (ge, ":var1", 2),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 4),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 5),
        (neg|party_slot_eq, "$g_encountered_party", 279, 1),
      ],
      "Build_courts.",
      [
        (assign, "$g_improvement_type", 279),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_organized_guilds",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_trade, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 5),
        (neg|party_slot_eq, "$g_encountered_party", 281, 1),
      ],
      "Found_organized_guilds.",
      [
        (assign, "$g_improvement_type", 281),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_lamplighters",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_pathfinding, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 282, 1),
      ],
      "Hire_lamplighters.",
      [
        (assign, "$g_improvement_type", 282),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_building_thieves_guild",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_looting, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_tactics, ":var0"),
        (ge, ":var1", 5),
        (store_skill_level, ":var1", skl_persuasion, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 286, 1),
      ],
      "Found_thieves_guild.",
      [
        (assign, "$g_improvement_type", 286),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_building_town_crier",
      [
        (neq, reg6, 1),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (party_get_slot, ":var0", "$g_encountered_party", 293),
        (store_skill_level, ":var1", skl_spotting, ":var0"),
        (ge, ":var1", 2),
        (neg|party_slot_eq, "$g_encountered_party", 287, 1),
      ],
      "Hire_town_crier.",
      [
        (assign, "$g_improvement_type", 287),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),
    ],
  ),

  ("center_improve", mnf_scale_picture,
    "^^ {s19} Your steward, with an engineering skill of ({reg2}), believes that {reg7?repairing:building} the {s4} will cost  {reg5} denars and will take {reg6} days.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_manage_construction"),
      (call_script, "script_get_improvement_details", "$g_improvement_type", "$g_encountered_party"),
      (gt, reg10, 0),
      (assign, ":var0", reg10),
      (party_get_slot, ":var1", "$g_encountered_party", "$g_improvement_type"),
      (store_sub, reg7, ":var1", 1),
      (val_clamp, reg7, 0, 2),
      (try_begin),
        (gt, ":var1", 1),
        (val_mul, ":var0", ":var1"),
        (val_div, ":var0", 10),
      (try_end),
      (str_store_string, s4, s10),
      (str_store_string, s19, s1),
      (party_get_slot, ":var2", "$g_encountered_party", 293),
      (store_skill_level, ":var3", "skl_engineer", ":var2"),
      (assign, reg2, ":var3"),
      (store_sub, ":var4", 20, ":var3"),
      (val_mul, ":var0", ":var4"),
      (val_div, ":var0", 20),
      (store_div, ":var5", ":var0", 150),
      (val_add, ":var5", 3),
      (val_mul, ":var5", 67),
      (val_div, ":var5", 80),
      (assign, reg5, ":var0"),
      (assign, reg6, ":var5"),
    ],
    [
      ("improve_cont",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", reg5),
      ],
      "Go_on.",
      [
        (troop_remove_gold, "trp_player", reg5),
        (party_set_slot, "$g_encountered_party", 124, "$g_improvement_type"),
        (store_current_hours, ":var0"),
        (store_mul, ":var1", reg6, 24),
        (val_add, ":var1", ":var0"),
        (party_set_slot, "$g_encountered_party", 125, ":var1"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("forget_it",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", reg5),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("improve_not_enough_gold",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (lt, ":var0", reg5),
      ],
      "I_don't_have_enough_money_for_that.",
      [
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),
    ],
  ),

  ("town_bandits_failed", mnf_disable_all_keys|mnf_scale_picture,
    "{s4} {s5}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_lose"),
      (store_troop_gold, ":var0", "trp_player"),
      (store_div, ":var1", ":var0", 30),
      (store_random_in_range, ":var2", 40, 100),
      (val_add, ":var1", ":var2"),
      (val_min, ":var1", ":var0"),
      (troop_remove_gold, "trp_player", ":var1"),
      (party_set_slot, "$current_town", 155, 0),
      (party_get_num_companions, ":var3", "p_main_party"),
      (str_store_string, s4, "@The assasins beat you down and leave you for dead. ."),
      (str_store_string, s4, "@You have fallen. The bandits quickly search your body for every coin they can find, then vanish into the night. They have left you alive, if only barely."),
      (try_begin),
        (gt, ":var3", 2),
        (str_store_string, s5, "@Luckily some of your companions come to search for you when you do not return, and find you lying by the side of the road. They hurry you to safety and dress your wounds."),
      (else_try),
        (str_store_string, s5, "@Luckily some passing townspeople find you lying by the side of the road, and recognise you as something other than a simple beggar. They carry you to the nearest inn and dress your wounds."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("town_bandits_succeeded", mnf_disable_all_keys|mnf_scale_picture,
    "The bandits fall before you as wheat to a scythe! Soon you stand alone in the streets while most of your attackers lie unconscious, dead or dying. Searching the bodies, you find a purse which must have belonged to a previous victim of these brutes. Or perhaps, it was given to them by someone who wanted to arrange a suitable ending to your life.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_win"),
      (party_set_slot, "$current_town", 155, 0),
      (assign, "$g_last_defeated_bandits_town", "$g_encountered_party"),
      (try_begin),
        (check_quest_active, "qst_deal_with_night_bandits"),
        (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
        (quest_slot_eq, "qst_deal_with_night_bandits", 1, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_night_bandits"),
      (try_end),
      (store_mul, ":var0", "$num_center_bandits", 117),
      (add_xp_to_troop, ":var0", "trp_player"),
      (store_mul, ":var1", "$num_center_bandits", 50),
      (call_script, "script_troop_add_gold", "trp_player", ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_cattle_confirm", mnf_scale_picture,
    "As the party member with the highest looting skill ({reg2}), {reg3?you reckon:{s1} reckons} that you can steal as many as {reg4} heads of village's cattle.",
    "none",
    [
      (set_background_mesh, "mesh_pic_cattle"),
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (assign, ":var0", reg1),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var0"),
      (try_end),
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, reg4, reg0),
    ],
    [
      ("village_steal_cattle_confirm",
      [],
      "Go_on.",
      [
        (rest_for_hours_interactive, 3, 5, 1),
        (assign, "$auto_menu", "mnu_village_steal_cattle"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_cattle", mnf_disable_all_keys|mnf_scale_picture,
    "{s1}",
    "none",
    [
      (set_background_mesh, "mesh_pic_cattle"),
      (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (try_begin),
        (ge, ":var0", 0),
        (call_script, "script_change_player_honor", -3),
      (try_end),
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, ":var1", reg0),
      (val_add, ":var1", 1),
      (store_random_in_range, ":var2", 0, ":var1"),
      (party_set_slot, "$current_town", 46, 1),
      (party_get_slot, ":var3", "$current_town", 7),
      (try_begin),
        (le, ":var2", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -5),
        (str_store_string, s1, "@You fail to steal any cattle."),
      (else_try),
        (assign, reg17, ":var2"),
        (store_sub, reg12, ":var2", 1),
        (try_begin),
          (gt, ":var3", 0),
          (call_script, "script_change_player_relation_with_troop", ":var3", -10),
          (call_script, "script_add_log_entry", 66, "trp_player", "$current_town", ":var3", "$g_encountered_party_faction"),
        (try_end),
        (call_script, "script_change_player_relation_with_center", "$current_town", -15),
        (str_store_string, s1, "@You drive away {reg17} {reg12?heads:head} of cattle from the village's herd."),
        (try_begin),
          (eq, ":var2", 3),
          (372, 31),
        (try_end),
        (call_script, "script_create_cattle_herd", "$current_town", ":var2"),
        (party_get_slot, ":var4", "$current_town", 205),
        (val_sub, ":var4", ":var2"),
        (party_set_slot, "$current_town", 205, ":var4"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_take_food_confirm", mnf_scale_picture,
    "It will be difficult to force and threaten the peasants into giving their precious supplies. You think you will need at least one hour.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_hostileaction"),
    ],
    [
      ("village_take_food_confirm",
      [],
      "Go_ahead.",
      [
        (rest_for_hours_interactive, 1, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$auto_enter_menu_in_center", "mnu_village_take_food"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village_hostile_action"),
      ]
      ),
    ],
  ),

  ("village_take_food", mnf_scale_picture,
    "The villagers grudgingly bring out what they have for you.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_hostileaction"),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var0", reg0),
      (call_script, "script_party_count_members_with_full_health", "$current_town"),
      (assign, ":var1", reg0),
      (try_begin),
        (lt, ":var0", 6),
        (ge, ":var1", 40),
        (neg|party_slot_eq, "$current_town", 7, "trp_player"),
        (jump_to_menu, "mnu_village_start_attack"),
      (try_end),
    ],
    [
      ("take_supplies",
      [],
      "Take_the_supplies.",
      [
        (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (try_begin),
          (ge, ":var0", 0),
          (call_script, "script_change_player_honor", -3),
        (try_end),
        (try_begin),
          (party_slot_ge, "$current_town", 26, -55),
          (try_begin),
            (party_slot_eq, "$current_town", 7, "trp_player"),
            (call_script, "script_change_player_relation_with_center", "$current_town", -5),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", -15),
          (try_end),
        (try_end),
        (party_get_slot, ":var1", "$current_town", 7),
        (try_begin),
          (gt, ":var1", 1),
          (call_script, "script_change_player_relation_with_troop", ":var1", -10),
        (try_end),
        (party_get_slot, ":var2", "$current_town", 25),
        (party_get_skill_level, ":var3", "p_main_party", "skl_looting"),
        (val_mul, ":var3", 3),
        (store_sub, ":var4", 70, ":var3"),
        (try_for_range, ":var5", 10, 106),
          (store_random_in_range, ":var6", 0, 100),
          (lt, ":var6", ":var4"),
          (troop_set_inventory_slot, ":var2", ":var5", -1),
        (try_end),
        (call_script, "script_objectionable_action", 3, "str_steal_from_villagers"),
        (call_script, "script_add_log_entry", 2, "trp_player", "$current_town", -1, -1),
        (store_faction_of_party, ":var7", "$current_town"),
        (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", ":var7", 5),
        (jump_to_menu, "mnu_village"),
        (troop_sort_inventory, ":var2"),
        (change_screen_loot, ":var2"),
      ]
      ),

      ("let_them_keep_it",
      [],
      "Let_them_keep_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_start_attack", mnf_disable_all_keys|mnf_scale_picture,
    "Some of the angry villagers grab their tools and prepare to resist you. It looks like you'll have a fight on your hands if you continue.",
    "none",
    [
      (set_background_mesh, "mesh_pic_villageriot"),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var0", reg0),
      (call_script, "script_party_count_members_with_full_health", "$current_town"),
      (assign, ":var1", reg0),
      (try_begin),
        (gt, ":var0", 25),
        (jump_to_menu, "mnu_village_loot_no_resist"),
      (else_try),
        (this_or_next|eq, ":var1", 0),
        (eq, "$g_battle_result", 1),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (store_random_in_range, ":var2", -30, -15),
          (call_script, "script_change_player_relation_with_center", "$current_town", ":var2"),
          (party_get_slot, ":var3", "$current_town", 7),
          (gt, ":var3", 0),
          (call_script, "script_change_player_relation_with_troop", ":var3", -3),
        (try_end),
        (jump_to_menu, "mnu_village_loot_no_resist"),
      (else_try),
        (eq, "$g_battle_result", -1),
        (jump_to_menu, "mnu_village_loot_defeat"),
      (try_end),
    ],
    [
      ("village_raid_attack",
      [],
      "Charge_them.",
      [
        (store_random_in_range, ":var0", -10, -5),
        (call_script, "script_change_player_relation_with_center", "$current_town", ":var0"),
        (try_begin),
          (party_get_slot, ":var1", "$current_town", 7),
          (gt, ":var1", 0),
          (call_script, "script_change_player_relation_with_troop", ":var1", -3),
        (try_end),
        (assign, "$battle_renown_value", 0),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (assign, "$g_battle_result", 0),
        (assign, "$g_village_raid_evil", 1),
        (set_jump_mission, "mt_village_raid"),
        (party_get_slot, ":var2", "$current_town", 10),
        (jump_to_scene, ":var2"),
        (assign, "$g_next_menu", "mnu_village_start_attack"),
        (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
        (call_script, "script_objectionable_action", 3, "str_loot_village"),
        (val_add, "$g_villages_raided", 1),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
#COOP BEGIN Village attack#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_village_player_attack),
        (assign, "$coop_encountered_party", "$current_town"),

        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
       ]),	
	  

       ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [

          (store_random_in_range, ":var0", -10, -5),
          (call_script, "script_change_player_relation_with_center", "$current_town", ":var0"),
          (try_begin),
            (party_get_slot, ":var1", "$current_town", slot_town_lord),
            (gt, ":var1", 0),
            (call_script, "script_change_player_relation_with_troop", ":var1", -3),
          (try_end),

         # (assign, "$g_village_raid_evil", 1), #not needed
          (assign, "$g_next_menu", "mnu_village_start_attack"),

          (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
          (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),

        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),

      ]),		  

      ("encounter_save",[],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),		
          
#COOP END#################################################
      ("village_raid_leave",
      [],
      "Leave_this_village_alone.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_no_resist", mnf_scale_picture,
    "The villagers here are few and frightened, and they quickly scatter and run before you. The village is at your mercy.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_hostileaction"),
    ],
    [
      ("village_loot_raze",
      [],
      "Plunder_the_village,_then_raze_it.",
      [
        (call_script, "script_village_set_state", "$current_town", 1),
        (party_set_slot, "$current_town", 34, "p_main_party"),
        (assign, "$g_player_raiding_village", "$current_town"),
        (try_begin),
          (store_faction_of_party, ":var0", "$current_town"),
          (store_relation, ":var1", "$players_kingdom", ":var0"),
          (ge, ":var1", 0),
          (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
        (try_end),
        (rest_for_hours, 3, 5, 1),
        (change_screen_return),
      ]
      ),

      ("village_raid_leave",
      [],
      "Leave_this_village_alone.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_complete", mnf_disable_all_keys|mnf_scale_picture,
    "On your orders your troops sack the village, pillaging everything of any value, and then put the buildings to the torch. From the coins and valuables that are found, you get your share of {reg1} denars.",
    "none",
    [
      (set_background_mesh, "mesh_pic_looted_village"),
      (call_script, "script_change_player_honor", -1),
      (370, ":var0", 30, 0),
      (370, ":var1", 30, 1),
      (val_add, ":var0", 1),
      (371, 30, 0, ":var0"),
      (party_set_slot, "$current_town", 40, "trp_player"),
      (try_begin),
        (ge, ":var0", 3),
        (ge, ":var1", 3),
        (372, 30),
      (try_end),
      (party_get_slot, ":var2", "$current_town", 7),
      (try_begin),
        (gt, ":var2", 0),
        (call_script, "script_change_player_relation_with_troop", ":var2", -10),
      (try_end),
      (store_random_in_range, ":var3", -35, -25),
      (call_script, "script_change_player_relation_with_center", "$current_town", ":var3"),
      (store_faction_of_party, ":var4", "$current_town"),
      (store_relation, ":var5", ":var4", "fac_player_supporters_faction"),
      (try_begin),
        (lt, ":var5", 0),
        (call_script, "script_change_player_relation_with_faction", ":var4", -3),
      (try_end),
      (assign, ":var6", 50),
      (party_get_slot, ":var7", "$current_town", 50),
      (store_mul, ":var8", ":var7", 5),
      (val_add, ":var6", ":var8"),
      (call_script, "script_troop_add_gold", "trp_player", ":var6"),
      (assign, ":var9", 3),
      (store_div, ":var10", ":var6", 100),
      (val_add, ":var9", ":var10"),
      (call_script, "script_change_player_party_morale", ":var9"),
      (faction_get_slot, ":var11", ":var4", 99),
      (store_mul, ":var12", ":var9", 200),
      (val_sub, ":var11", ":var12"),
      (faction_set_slot, ":var4", 99, ":var11"),
      (call_script, "script_objectionable_action", 3, "str_loot_village"),
      (val_add, "$g_villages_raided", 1),
      (assign, reg1, ":var6"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_close"),
        (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
        (assign, ":var0", reg0),
        (val_mul, ":var0", 3),
        (val_div, ":var0", 2),
        (party_get_slot, ":var1", "$current_town", 205),
        (val_min, ":var0", ":var1"),
        (val_add, ":var0", 1),
        (store_random_in_range, ":var2", 0, ":var0"),
        (try_begin),
          (gt, ":var2", 0),
          (call_script, "script_create_cattle_herd", "$current_town", ":var2"),
          (val_sub, ":var1", ":var2"),
          (party_set_slot, "$current_town", 205, ":var1"),
        (try_end),
        (troop_clear_inventory, "trp_temp_troop"),
        (reset_item_probabilities, 100),
        (troop_add_merchandise, "trp_temp_troop", itp_type_goods, 45),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
      ]
      ),
    ],
  ),

  ("village_loot_defeat", mnf_scale_picture,
    "Fighting with courage and determination, the villagers manage to hold together and drive off your forces.",
    "none",
    [
      (set_background_mesh, "mesh_pic_villageriot"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_continue", mnf_scale_picture,
    "Do you wish to continue looting this village?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_hostileaction"),
    ],
    [
      ("disembark_yes",
      [],
      "Yes.",
      [
        (rest_for_hours, 3, 5, 1),
        (change_screen_return),
      ]
      ),

      ("disembark_no",
      [],
      "No.",
      [
        (call_script, "script_village_set_state", "$current_town", 0),
        (party_set_slot, "$current_town", 34, -1),
        (assign, "$g_player_raiding_village", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("close", 0,
    "Nothing.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("noldor_castle", mnf_enable_hot_keys|mnf_scale_picture,
    "You approach the Noldor castle, hardly believing it is a reality, not merely a myth...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_elacrai"),
      (store_encountered_party, "$current_town"),
      (try_begin),
        (eq, "$g_leave_town", 1),
        (assign, "$g_leave_town", 0),
        (rest_for_hours, 1, 5, 0),
        (leave_encounter),
        (change_screen_return),
      (try_end),
    ],
    [
      ("castle_castle_1",
      [],
      "Go_to_the_Noldor_castle_hall.",
      [
        (assign, "$town_entered", 1),
        (call_script, "script_enter_court", "$current_town"),
      ]
,
      "Door_to_the_castle"
      ),

      ("join_tournament_noldor",
      [
        (neg|is_currently_night),
        (party_slot_ge, "$current_town", 156, 1),
      ],
      "Join_the_Noldor_tournament.",
      [
        (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
        (assign, "$g_tournament_cur_tier", 0),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (assign, "$g_tournament_bet_win_amount", 0),
        (assign, "$g_tournament_last_bet_tier", -1),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),

      ("castle_inspect",
      [],
      "Take_a_walk_around_the_courtyard.",
      [
        (try_begin),
          (assign, "$talk_context", 0),
          (assign, "$g_mt_mode", 0),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (assign, ":var1", 40),
          (party_get_num_companion_stacks, ":var2", "$g_encountered_party"),
          (try_for_range, ":var3", 0, ":var2"),
            (lt, ":var1", 47),
            (party_stack_get_troop_id, ":var4", "$g_encountered_party", ":var3"),
            (neg|troop_is_hero, ":var4"),
            (party_stack_get_size, ":var5", "$g_encountered_party", ":var3"),
            (party_stack_get_num_wounded, ":var6", "$g_encountered_party", ":var3"),
            (val_sub, ":var5", ":var6"),
            (gt, ":var5", 0),
            (party_stack_get_troop_dna, ":var7", "$g_encountered_party", ":var3"),
            (set_visitor, ":var1", ":var4", ":var7"),
            (val_add, ":var1", 1),
          (try_end),
          (try_begin),
            (eq, "$town_entered", 0),
            (assign, "$town_entered", 1),
          (try_end),
          (set_jump_entry, 1),
          (assign, ":var8", 256),
          (set_jump_mission, "mt_castle_visit"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 0, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 1, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 2, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 3, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 4, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 5, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 6, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 7, ":var8"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (try_end),
      ]
,
      "To_the_castle_courtyard."
      ),

      ("castle_attack_surprise",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Launch_a_surprise_attack_on_the_castle.",
      [
        (jump_to_menu, "mnu_noldor_attack_verify"),
      ]
      ),

      ("castle_wait",
      [
        (assign, ":var0", 1),
        (str_clear, s1),
        (try_begin),
          (party_get_num_companions, ":var1", "p_main_party"),
          (store_div, reg1, ":var1", 4),
          (val_add, reg1, 1),
          (str_store_string, s1, "@ ({reg1} denars per night)"),
          (store_troop_gold, ":var2", "trp_player"),
          (lt, ":var2", reg1),
          (assign, ":var0", 0),
        (try_end),
        (eq, ":var0", 1),
      ],
      "Wait_here_for_some_time{s1}.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours_interactive, 168, 5, 0),
        (change_screen_return),
      ]
      ),

      ("town_leave",
      [],
      "Leave.",
      [
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
      ]
,
      "Leave_Area."
      ),
    ],
  ),

  ("noldor_attack_verify", mnf_scale_picture,
    "Are you sure you want to attack the Noldor castle? This is a very treacherous act with dire consequences.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_elacrai"),
    ],
    [
      ("noldor_attack_verify_yes",
      [],
      "Yes._There's_plenty_of_loot_around_here_masquerading_as_pointy-eared_twats.",
      [
        (jump_to_menu, "mnu_noldor_castle_attack"),
      ]
      ),

      ("noldor_attack_verify_no",
      [],
      "No,_we_can't_stab_our_Noldor_friends_in_the_back!",
      [
        (jump_to_menu, "mnu_noldor_castle"),
      ]
      ),
    ],
  ),

  ("noldor_castle_attack", mnf_enable_hot_keys|mnf_scale_picture,
    "Your troops prepare to assault the Noldor castle...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_siege_sighted_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
    ],
    [
      ("castle_lead_attack",
      [
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", -1),
        (str_store_party_name, s2, "$g_encountered_party"),
        (call_script, "script_encounter_calculate_fit"),
        (assign, "$all_doors_locked", 1),
        (assign, "$current_town", "$g_encountered_party"),
        (try_begin),
          (eq, "$new_encounter", 1),
          (assign, "$new_encounter", 0),
          (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
          (call_script, "script_encounter_init_variables"),
          (assign, "$entry_to_town_forbidden", 0),
          (assign, "$sneaked_into_town", 0),
          (assign, "$town_entered", 0),
          (assign, "$encountered_party_hostile", 0),
          (assign, "$encountered_party_friendly", 0),
        (try_end),
      ],
      "Lead_your_soldiers_in_an_assault.",
      [
        (party_get_slot, ":var0", "$g_encountered_party", 10),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (assign, ":var1", reg0),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (set_battle_advantage, ":var1"),
        (set_party_battle_mode),
        (assign, "$g_siege_battle_state", 1),
        (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (assign, "$cant_talk_to_enemy", 0),
        (assign, "$g_siege_final_menu", "mnu_noldor_castle_attack_result"),
        (assign, "$g_next_menu", "mnu_noldor_castle_attack_result"),
        (jump_to_scene, ":var0"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("noldor_castle_attack_result", mnf_enable_hot_keys|mnf_scale_picture,
    "Castle attack result - you should not see this text!",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s1, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars", "p_collective_enemy"),
        (assign, ":var0", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var0", 1),
        (else_try),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var0", 1),
        (try_end),
        (this_or_next|eq, ":var0", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", "mnu_noldor_castle_victory"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (assign, "$g_next_menu", "mnu_noldor_castle_defeat"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
      (call_script, "script_set_player_relation_with_faction", "fac_noldor_elves", -50),
      (call_script, "script_change_player_honor", -20),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("noldor_castle_victory", mnf_scale_picture,
    "Your treacherous assault has been successful. Just as you leave with wagons of loot, the Noldor castle flickers out of sight as it never existed.",
    "none",
    [
      (set_background_mesh, "mesh_pic_victory"),
      (party_clear, "p_castle_noldor"),
      (party_add_members, "p_castle_noldor", "trp_noldor_knight", 50),
      (party_add_members, "p_castle_noldor", "trp_noldor_maiden", 50),
      (party_add_members, "p_castle_noldor", "trp_noldor_noble", 100),
      (party_add_members, "p_castle_noldor", "trp_noldor_ranger", 300),
      (party_add_members, "p_castle_noldor", "trp_noldor_warrior", 500),
      (party_add_prisoners, "p_castle_noldor", "trp_jatu_lancer", 100),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_warrior", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_warrior", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_ranger", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_noble", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_maiden", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_knight", 300),
      (troop_loot_troop, "trp_elacrai_loot", "trp_noldor_troop_for_shop", 300),
      (troop_ensure_inventory_space, "trp_elacrai_loot", 30),
      (troop_sort_inventory, "trp_elacrai_loot"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_loot, "trp_elacrai_loot"),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("noldor_castle_defeat", mnf_scale_picture,
    "The Noldor have repelled your treacherous assault and cloaked their castle again.",
    "none",
    [
      (set_background_mesh, "mesh_pic_defeat"),
      (party_clear, "p_castle_noldor"),
      (party_add_members, "p_castle_noldor", "trp_noldor_knight", 50),
      (party_add_members, "p_castle_noldor", "trp_noldor_maiden", 50),
      (party_add_members, "p_castle_noldor", "trp_noldor_noble", 100),
      (party_add_members, "p_castle_noldor", "trp_noldor_ranger", 300),
      (party_add_members, "p_castle_noldor", "trp_noldor_warrior", 500),
      (party_add_prisoners, "p_castle_noldor", "trp_jatu_lancer", 100),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("stronghold", mnf_enable_hot_keys|mnf_scale_picture,
    "{s4}",
    "none",
    [
      (store_encountered_party, "$current_town"),
      (try_begin),
        (check_quest_active, "qst_order_grandmaster"),
        (quest_slot_eq, "qst_order_grandmaster", 11, 4),
        (str_store_string, s4, "@As you near the Snake Cult stronghold, you can see its many defenders manning the walls. It may be a bloody day."),
      (else_try),
        (quest_slot_eq, "qst_order_grandmaster", 11, 6),
        (eq, "$order_stronghold_upgrade_days", 0),
        (str_store_string, s4, "@The fully rebuilt Order fortress conveys an impression of strength and permanence."),
      (else_try),
        (str_store_string, s4, "@The Order stronghold seems welcoming now that it's cleansed of every trace of Cultist presence."),
      (try_end),
      (set_background_mesh, "mesh_pic_pendor_stronghold"),
    ],
    [
      ("castle_castle_2",
      [
        (eq, 1, 0),
      ],
      "Go_to_the_castle.",
      []
      ),

      ("join_tournament_order",
      [
        (eq, 1, 0),
      ],
      "Join_the_Order_tournament.",
      []
      ),

      ("town_castle_2",
      [
        (quest_slot_ge, "qst_order_grandmaster", 11, 5),
      ],
      "Go_to_the_Order_castle_hall.",
      [
        (assign, "$town_entered", 1),
        (call_script, "script_enter_court", "$current_town"),
      ]
,
      "Door_to_the_castle"
      ),

      ("town_center",
      [
        (eq, 1, 0),
      ],
      "Take_a_walk_around_the_streets.",
      []
      ),

      ("town_tavern",
      [
        (eq, 1, 0),
      ],
      "Visit_the_tavern.",
      []
      ),

      ("town_merchant",
      [
        (eq, 1, 0),
      ],
      "Speak_with_the_merchant.",
      []
      ),

      ("town_arena",
      [
        (eq, 1, 0),
      ],
      "Enter_the_arena.",
      []
      ),

      ("town_dungeon",
      [
        (eq, 1, 0),
      ],
      "Never:_Enter_the_prison.",
      []
      ),

      ("castle_inspect",
      [
        (quest_slot_ge, "qst_order_grandmaster", 11, 5),
      ],
      "Take_a_walk_around_the_courtyard.",
      [
        (try_begin),
          (assign, "$talk_context", 0),
          (assign, "$g_mt_mode", 0),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (assign, ":var1", 40),
          (party_get_num_companion_stacks, ":var2", "$g_encountered_party"),
          (try_for_range, ":var3", 0, ":var2"),
            (lt, ":var1", 47),
            (party_stack_get_troop_id, ":var4", "$g_encountered_party", ":var3"),
            (neg|troop_is_hero, ":var4"),
            (party_stack_get_size, ":var5", "$g_encountered_party", ":var3"),
            (party_stack_get_num_wounded, ":var6", "$g_encountered_party", ":var3"),
            (val_sub, ":var5", ":var6"),
            (gt, ":var5", 0),
            (party_stack_get_troop_dna, ":var7", "$g_encountered_party", ":var3"),
            (set_visitor, ":var1", ":var4", ":var7"),
            (val_add, ":var1", 1),
          (try_end),
          (try_begin),
            (eq, "$town_entered", 0),
            (assign, "$town_entered", 1),
          (try_end),
          (set_jump_entry, 1),
          (assign, ":var8", 256),
          (set_jump_mission, "mt_castle_visit"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 0, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 1, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 2, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 3, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 4, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 5, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 6, ":var8"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 7, ":var8"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (try_end),
      ]
,
      "To_the_castle_courtyard."
      ),

      ("town_enterprise",
      [
        (eq, 1, 0),
      ],
      "Visit_your_enterprise.",
      []
      ),

      ("visit_lady",
      [
        (eq, 1, 0),
      ],
      "Attempt_to_visit_a_lady.",
      []
      ),

      ("trade_with_merchants",
      [
        (eq, 1, 0),
      ],
      "Go_to_the_marketplace.",
      []
      ),

      ("castle_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
        (check_quest_active, "qst_order_grandmaster"),
        (quest_slot_eq, "qst_order_grandmaster", 11, 4),
      ],
      "Launch_the_assault!",
      [
        (jump_to_menu, "mnu_stronghold_attack_verify"),
      ]
      ),

      ("castle_wait_free",
      [
        (quest_slot_ge, "qst_order_grandmaster", 11, 5),
      ],
      "Rest_here_for_some_time.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours_interactive, 168, 5, 0),
        (change_screen_return),
      ]
      ),

      ("town_leave",
      [],
      "Leave.",
      [
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
      ]
,
      "Leave_Area."
      ),
    ],
  ),

  ("stronghold_attack_verify", mnf_scale_picture,
    "Are you ready to assault the stronghold?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_stronghold"),
    ],
    [
      ("stronghold_attack_verify_yes",
      [],
      "Yes._I_have_fine_troops_at_my_command.",
      [
        (jump_to_menu, "mnu_stronghold_attack"),
      ]
      ),

      ("stronghold_attack_verify_no",
      [],
      "No,_it_looks_suicidal.",
      [
        (jump_to_menu, "mnu_stronghold"),
      ]
      ),
    ],
  ),

  ("stronghold_attack", mnf_enable_hot_keys|mnf_scale_picture,
    "Your troops prepare to assault the Snake Cult stronghold...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_siege_sighted_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
    ],
    [
      ("castle_lead_attack",
      [
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", -1),
        (str_store_party_name, s2, "$g_encountered_party"),
        (call_script, "script_encounter_calculate_fit"),
        (assign, "$all_doors_locked", 1),
        (assign, "$current_town", "$g_encountered_party"),
        (try_begin),
          (eq, "$new_encounter", 1),
          (assign, "$new_encounter", 0),
          (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
          (call_script, "script_encounter_init_variables"),
          (assign, "$entry_to_town_forbidden", 0),
          (assign, "$sneaked_into_town", 0),
          (assign, "$town_entered", 0),
          (assign, "$encountered_party_hostile", 0),
          (assign, "$encountered_party_friendly", 0),
        (try_end),
      ],
      "Lead_your_soldiers_in_an_assault.",
      [
        (party_get_slot, ":var0", "$g_encountered_party", 10),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (assign, ":var1", reg0),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (set_battle_advantage, ":var1"),
        (set_party_battle_mode),
        (assign, "$g_siege_battle_state", 1),
        (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (assign, "$cant_talk_to_enemy", 0),
        (assign, "$g_siege_final_menu", "mnu_stronghold_attack_result"),
        (assign, "$g_next_menu", "mnu_stronghold_attack_result"),
        (jump_to_scene, ":var0"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("stronghold_attack_result", mnf_enable_hot_keys|mnf_scale_picture,
    "Castle attack result - you should not see this text!",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s1, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars", "p_collective_enemy"),
        (assign, ":var0", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var0", 1),
        (else_try),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var0", 1),
        (try_end),
        (this_or_next|eq, ":var0", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", "mnu_stronghold_victory"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (assign, "$g_next_menu", "mnu_stronghold_defeat"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("stronghold_victory", mnf_scale_picture,
    "The day is won! The last Cultist defender is put to the sword and you claim their stronghold for your Order.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_stronghold"),
      (troop_get_slot, ":var0", "trp_player", 162),
      (store_sub, ":var1", ":var0", "trp_dragon_knight"),
      (val_add, ":var1", "trp_dragon_drake"),
      (store_troop_faction, ":var2", ":var0"),
      (faction_set_slot, ":var2", 49, ":var1"),
      (party_set_faction, "p_snake_stronghold", ":var2"),
      (party_set_name, "p_snake_stronghold", "@Order Stronghold"),
      (party_set_flags, "p_snake_stronghold", 16384, 1),
      (party_clear, "p_snake_stronghold"),
      (party_add_members, "p_snake_stronghold", ":var0", 10),
      (party_add_members, "p_snake_stronghold", ":var1", 20),
      (party_add_prisoners, "p_snake_stronghold", "trp_snake_follower", 20),
      (quest_set_slot, "qst_order_grandmaster", 11, 5),
      (str_store_string, s3, "@Report news of your victory to your Order."),
      (add_quest_note_from_sreg, "qst_order_grandmaster", 2, s3, 0),
      (display_message, "str_quest_log_updated", 0x66CCFF),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("stronghold_defeat", mnf_scale_picture,
    "The Snake Cult have repelled your futile assault and will surely reinforce their garrison before the next one.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_stronghold"),
      (party_add_members, "p_snake_stronghold", "trp_snake_priestess", 5),
      (party_add_members, "p_snake_stronghold", "trp_anaconda_knight", 5),
      (party_add_members, "p_snake_stronghold", "trp_cobra_warrior", 10),
      (party_add_members, "p_snake_stronghold", "trp_snake_armsman", 30),
      (party_add_members, "p_snake_stronghold", "trp_snake_follower", 50),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("old_ruins", mnf_enable_hot_keys|mnf_scale_picture,
    "{s4}",
    "none",
    [
      (store_encountered_party, "$current_town"),
      (try_begin),
        (check_quest_active, "qst_old_tale_part_1"),
        (quest_slot_eq, "qst_old_tale_part_1", 11, 2),
        (str_store_string, s4, "@You have found the place described by village elder. Bushes, trees, few stones laying here and there. An old path lay in front of you."),
        (str_clear, s2),
        (str_store_string, s2, "@You have located the old ruins. Try to search this area for anything pertaining to its history."),
        (add_quest_note_from_sreg, "qst_old_tale_part_1", 5, s2, 0),
        (quest_set_slot, "qst_old_tale_part_1", 11, 3),
      (else_try),
        (check_quest_active, "qst_old_tale_part_1"),
        (quest_slot_eq, "qst_old_tale_part_1", 11, 3),
        (str_store_string, s4, "@At first glance this place looks like a peaceful valley, full of trees, bees and flowers."),
      (else_try),
        (check_quest_active, "qst_old_tale_part_1"),
        (quest_slot_eq, "qst_old_tale_part_1", 11, 4),
        (str_store_string, s4, "@The valley remains incredibly silent. Unchanged since your last visit."),
      (else_try),
        (party_slot_eq, "p_old_ruins", 268, 1),
        (try_begin),
          (party_slot_eq, "p_old_ruins", 251, 1),
          (assign, reg33, 100),
        (else_try),
          (assign, reg33, 50),
        (try_end),
        (party_get_num_companions, reg34, "p_old_ruins"),
        (try_begin),
          (le, reg34, reg33),
          (str_store_string, s4, "@The base is fully established and hidden well. Garrisoned soldiers seem to be in a good mood."),
        (else_try),
          (str_store_string, s4, "@The base is fully established and hidden well. Everything looks normal, but you can feel tension in the air."),
        (try_end),
      (else_try),
        (str_store_string, s4, "@The old ruins look more and more appealing every time you visit them."),
      (try_end),
      (set_background_mesh, "mesh_pic_pendor_old_ruins"),
    ],
    [
      ("castle_castle_3",
      [
        (eq, 1, 0),
      ],
      "Go_to_the_castle.",
      []
      ),

      ("join_tournament_order",
      [
        (eq, 1, 0),
      ],
      "Join_the_Order_tournament.",
      []
      ),

      ("town_center",
      [
        (eq, 1, 0),
      ],
      "Take_a_walk_around_the_streets.",
      []
      ),

      ("town_tavern",
      [
        (eq, 1, 0),
      ],
      "Visit_the_tavern.",
      []
      ),

      ("town_merchant",
      [
        (eq, 1, 0),
      ],
      "Speak_with_the_merchant.",
      []
      ),

      ("town_arena",
      [
        (eq, 1, 0),
      ],
      "Enter_the_arena.",
      []
      ),

      ("town_dungeon",
      [
        (eq, 1, 0),
      ],
      "Never:_Enter_the_prison.",
      []
      ),

      ("town_enterprise",
      [
        (eq, 1, 0),
      ],
      "Visit_your_enterprise.",
      []
      ),

      ("visit_lady",
      [
        (eq, 1, 0),
      ],
      "Attempt_to_visit_a_lady.",
      []
      ),

      ("trade_with_merchants",
      [
        (eq, 1, 0),
      ],
      "Go_to_the_marketplace.",
      []
      ),

      ("inspect_old_ruins",
      [
        (quest_slot_eq, "qst_old_tale_part_1", 11, 3),
        (neg|player_has_item, "itm_book_old_diary"),
      ],
      "Investigate_area.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_jump_entry, 0),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
,
      "Investigate_area."
      ),

      ("inspect_camp_build",
      [
        (this_or_next|quest_slot_eq, "qst_old_tale_part_2", 11, 2),
        (this_or_next|quest_slot_eq, "qst_old_tale_part_2", 11, 3),
        (quest_slot_eq, "qst_old_tale_part_2", 11, 5),
        (neg|is_currently_night),
      ],
      "Meet_the_builder.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (assign, "$talk_context", 0),
        (set_visitor, 8, "trp_old_ruin_camp_master"),
        (assign, ":var1", 11),
        (try_for_range, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var2"),
          (set_visitor, ":var1", ":var2"),
          (val_add, ":var1", 1),
          (try_begin),
            (eq, ":var1", 18),
            (assign, ":var1", 11),
          (try_end),
        (try_end),
        (try_begin),
          (assign, ":var1", 11),
          (party_get_num_companion_stacks, ":var3", "p_old_ruins"),
          (gt, ":var3", 0),
          (try_for_range, ":var4", 0, ":var3"),
            (party_stack_get_troop_id, ":var5", "p_old_ruins", ":var4"),
            (party_stack_get_size, ":var6", "p_old_ruins", ":var4"),
            (try_for_range, ":var7", 0, ":var6"),
              (set_visitor, ":var1", ":var5"),
              (val_add, ":var1", 1),
              (try_begin),
                (eq, ":var1", 18),
                (assign, ":var1", 11),
              (try_end),
            (try_end),
          (try_end),
        (try_end),
        (set_jump_entry, 0),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
,
      "Meet_the_builder."
      ),

      ("leave_workforce_camp",
      [
        (quest_slot_eq, "qst_old_tale_part_2", 11, 4),
        (party_count_companions_of_type, ":var0", "$g_encountered_party", "trp_refugee"),
        (assign, reg33, ":var0"),
        (try_begin),
          (party_count_members_of_type, ":var1", "p_main_party", "trp_refugee"),
          (eq, ":var1", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Leave_workers_in_the_camp_({reg33}/20_already_here).",
      [
        (party_count_members_of_type, ":var0", "$g_encountered_party", "trp_refugee"),
        (assign, reg33, ":var0"),
        (try_begin),
          (party_count_companions_of_type, ":var1", "p_main_party", "trp_refugee"),
          (eq, ":var1", 0),
          (disable_menu_option),
        (else_try),
          (party_remove_members, "p_main_party", "trp_refugee", 1),
          (party_add_members, "$g_encountered_party", "trp_refugee", 1),
          (party_count_companions_of_type, ":var0", "$g_encountered_party", "trp_refugee"),
          (assign, reg33, ":var0"),
          (try_begin),
            (eq, ":var0", 20),
            (disable_menu_option),
            (quest_set_slot, "qst_old_tale_part_2", 11, 5),
            (change_screen_return),
          (try_end),
        (try_end),
      ]
,
      "Leave_workers_in_the_camp."
      ),

      ("camp_master_talk",
      [
        (party_slot_eq, "p_old_ruins", 268, 1),
        (store_time_of_day, ":var0"),
        (neg|is_between, ":var0", 0, 5),
      ],
      "Speak_with_the_Camp_Master.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 8, "trp_old_ruin_camp_master"),
        (set_jump_entry, 1),
        (jump_to_scene, ":var0"),
        (change_screen_map_conversation, "trp_old_ruin_camp_master"),
      ]
,
      "Speak_with_the_Camp_Master."
      ),

      ("camp_blacksmith_talk",
      [
        (party_slot_ge, "p_old_ruins", 262, 1),
        (store_time_of_day, ":var0"),
        (neg|is_between, ":var0", 0, 5),
      ],
      "Speak_with_the_Blacksmith.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 9, "trp_old_ruin_camp_blacksmith"),
        (set_jump_entry, 1),
        (jump_to_scene, ":var0"),
        (change_screen_map_conversation, "trp_old_ruin_camp_blacksmith"),
      ]
,
      "Speak_with_the_Blacksmith."
      ),

      ("camp_vet_talk",
      [
        (party_slot_ge, "p_old_ruins", 270, 2),
        (store_time_of_day, ":var0"),
        (neg|is_between, ":var0", 0, 5),
      ],
      "Speak_with_the_Horse_Keeper.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 10, "trp_old_ruin_camp_vet"),
        (set_jump_entry, 1),
        (jump_to_scene, ":var0"),
        (change_screen_map_conversation, "trp_old_ruin_camp_vet"),
      ]
,
      "Speak_with_the_Horse_Keeper."
      ),

      ("inspect_camp_finished",
      [
        (party_slot_eq, "p_old_ruins", 10, "scn_abhuva_pendor_castle_2_base"),
      ],
      "Go_to_the_camp.",
      [
        (set_jump_mission, "mt_visit_old_ruins_1"),
        (party_get_slot, ":var0", "p_old_ruins", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (assign, "$talk_context", 0),
        (store_time_of_day, ":var1"),
        (try_begin),
          (neg|is_between, ":var1", 0, 5),
          (set_visitor, 8, "trp_old_ruin_camp_master"),
          (try_begin),
            (party_slot_ge, "p_old_ruins", 262, 1),
            (set_visitor, 9, "trp_old_ruin_camp_blacksmith"),
          (try_end),
          (try_begin),
            (party_slot_ge, "p_old_ruins", 270, 2),
            (set_visitor, 10, "trp_old_ruin_camp_vet"),
          (try_end),
        (try_end),
        (try_for_range, ":var2", 2, 8),
          (set_visitor, ":var2", "trp_old_ruin_camp_guard"),
        (try_end),
        (assign, ":var2", 11),
        (try_for_range, ":var3", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var3"),
          (set_visitor, ":var2", ":var3"),
          (val_add, ":var2", 1),
          (try_begin),
            (eq, ":var2", 18),
            (assign, ":var2", 11),
          (try_end),
        (try_end),
        (try_begin),
          (party_get_num_companion_stacks, ":var4", "p_old_ruins"),
          (gt, ":var4", 0),
          (party_clear, "p_temp_party"),
          (try_for_range, ":var5", 0, ":var4"),
            (party_stack_get_troop_id, ":var6", "p_old_ruins", ":var5"),
            (party_stack_get_size, ":var7", "p_old_ruins", ":var5"),
            (party_stack_get_num_wounded, ":var8", "p_old_ruins", ":var5"),
            (val_sub, ":var7", ":var8"),
            (party_add_members, "p_temp_party", ":var6", ":var7"),
          (try_end),
          (party_get_num_companion_stacks, ":var4", "p_temp_party"),
          (gt, ":var4", 0),
          (try_begin),
            (neg|is_between, ":var1", 0, 5),
            (assign, ":var9", 2),
            (assign, ":var10", 18),
            (try_for_range, ":var11", 0, ":var9"),
              (store_random_in_range, ":var12", 0, ":var4"),
              (party_stack_get_troop_id, ":var6", "p_temp_party", ":var12"),
              (set_visitor, ":var10", ":var6"),
              (val_add, ":var10", 1),
              (party_remove_members, "p_temp_party", ":var6", 1),
              (party_get_num_companion_stacks, ":var4", "p_temp_party"),
              (try_begin),
                (eq, ":var4", 0),
                (party_clear, "p_temp_party"),
                (assign, ":var9", 0),
              (try_end),
            (try_end),
          (try_end),
          (gt, ":var4", 0),
          (try_begin),
            (neg|is_between, ":var1", 0, 5),
            (assign, ":var9", 30),
          (else_try),
            (assign, ":var9", 5),
          (try_end),
          (assign, ":var10", 11),
          (try_for_range, ":var11", 0, ":var9"),
            (store_random_in_range, ":var12", 0, ":var4"),
            (party_stack_get_troop_id, ":var6", "p_temp_party", ":var12"),
            (set_visitor, ":var10", ":var6"),
            (val_add, ":var10", 1),
            (try_begin),
              (eq, ":var10", 18),
              (assign, ":var10", 11),
            (try_end),
            (party_remove_members, "p_temp_party", ":var6", 1),
            (party_get_num_companion_stacks, ":var4", "p_temp_party"),
            (try_begin),
              (eq, ":var4", 0),
              (party_clear, "p_temp_party"),
              (assign, ":var9", 0),
            (try_end),
          (try_end),
        (try_end),
        (set_jump_entry, 0),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
,
      "Go_to_the_camp."
      ),

      ("camp_station_troops",
      [
        (party_slot_eq, "p_old_ruins", 268, 1),
        (neg|check_quest_active, "qst_order_challenge"),
        (party_get_num_companions, reg33, "p_old_ruins"),
        (try_begin),
          (party_slot_eq, "p_old_ruins", 251, 1),
          (assign, reg34, 100),
        (else_try),
          (assign, reg34, 50),
        (try_end),
        (try_begin),
          (str_clear, s2),
          (party_get_num_prisoner_stacks, ":var0", "p_old_ruins"),
          (gt, ":var0", 0),
          (str_store_string, s2, "@, no prisoners allowed"),
        (try_end),
      ],
      "Manage_the_garrison._({reg33}/{reg34}{s2})",
      [
        (troop_set_slot, "trp_quick_battle_6_player", 406, 12),
        (change_screen_exchange_members, 1),
      ]
,
      "Manage_the_garrison."
      ),

      ("camp_wait_old_ruins",
      [
        (party_slot_eq, "p_old_ruins", 268, 1),
      ],
      "Rest_here_for_some_time.",
      [
        (assign, "$auto_enter_town", "p_old_ruins"),
        (assign, "$g_last_rest_center", "p_old_ruins"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours_interactive, 168, 5, 0),
        (change_screen_return),
      ]
,
      "Rest_here_for_some_time."
      ),

      ("camp_leave",
      [],
      "Leave.",
      [
        (try_begin),
          (quest_slot_eq, "qst_old_tale_part_1", 11, 3),
          (str_clear, s2),
          (try_begin),
            (player_has_item, "itm_book_old_diary"),
            (str_store_string, s2, "@It seems that some time ago a battle took place here. You have found: few bend swords, weathered skeletons, some rusty armor pieces with faded emblem which resemble a griffon and ... a fragile book."),
          (else_try),
            (str_store_string, s2, "@It seems that some time ago a battle took place here. You have found so far only rubbish: few bend swords, weathered skeletons, some rusty armor pieces with faded emblem which resemble a griffon. Search the valley much more carefully."),
          (try_end),
          (add_quest_note_from_sreg, "qst_old_tale_part_1", 6, s2, 0),
          (display_log_message, "@Quest log updated."),
        (try_end),
        (try_begin),
          (party_slot_eq, "p_old_ruins", 268, 1),
          (party_get_num_prisoner_stacks, ":var0", "p_old_ruins"),
          (gt, ":var0", 0),
          (try_for_range_backwards, ":var1", 0, ":var0"),
            (party_prisoner_stack_get_troop_id, ":var2", "p_old_ruins", ":var1"),
            (party_prisoner_stack_get_size, ":var3", "p_old_ruins", ":var1"),
            (party_remove_prisoners, "p_old_ruins", ":var2", ":var3"),
            (try_begin),
              (troop_is_hero, ":var2"),
              (call_script, "script_remove_troop_from_prison", ":var2"),
            (try_end),
          (try_end),
          (display_log_message, "@The camp is too small to keep prisoners there. All prisoners were taken away and released.", 0xFF5050),
        (try_end),
        (try_begin),
          (party_slot_eq, "p_old_ruins", 268, 1),
          (try_begin),
            (party_slot_eq, "p_old_ruins", 251, 1),
            (assign, ":var4", 100),
          (else_try),
            (assign, ":var4", 50),
          (try_end),
          (party_get_num_companions, ":var5", "p_old_ruins"),
          (gt, ":var5", 0),
          (gt, ":var5", ":var4"),
          (assign, ":var6", 1),
          (try_for_range, ":var7", 0, ":var6"),
            (party_get_num_companion_stacks, ":var8", "p_old_ruins"),
            (store_random_in_range, ":var1", 0, ":var8"),
            (party_stack_get_troop_id, ":var9", "p_old_ruins", ":var1"),
            (party_stack_get_size, ":var3", "p_old_ruins", ":var1"),
            (try_begin),
              (ge, ":var3", 4),
              (store_div, ":var10", ":var3", 2),
              (store_random_in_range, ":var11", 1, ":var10"),
              (party_remove_members, "p_old_ruins", ":var9", ":var11"),
            (else_try),
              (neg|troop_is_hero, ":var9"),
              (party_remove_members, "p_old_ruins", ":var9", ":var3"),
            (try_end),
            (party_get_num_companions, ":var5", "p_old_ruins"),
            (try_begin),
              (gt, ":var5", ":var4"),
              (try_begin),
                (lt, ":var6", 20),
                (val_add, ":var6", 1),
              (else_try),
                (assign, ":var6", 0),
              (try_end),
            (else_try),
              (assign, ":var6", 0),
            (try_end),
          (try_end),
          (display_log_message, "@This camp was overcrowded and some soldiers deserted.", 0xFF5050),
        (try_end),
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
        (assign, "$current_town", "p_village_69"),
      ]
,
      "Leave."
      ),
    ],
  ),

  ("town", mnf_enable_hot_keys|mnf_scale_picture,
    "{s10} {s14}^{s11}{s12}{s13}",
    "none",
    [
      (call_script, "script_detect_load_restore_custom_troops"),
      (try_begin),
        (eq, "$sneaked_into_town", 1),
        (call_script, "script_music_set_situation_with_culture", 16384),
      (else_try),
        (call_script, "script_music_set_situation_with_culture", 65536),
      (try_end),
      (store_encountered_party, "$current_town"),
      (call_script, "script_update_center_recon_notes", "$current_town"),
      (assign, "$g_defending_against_siege", 0),
      (str_clear, s3),
      (party_get_battle_opponent, ":var0", "$current_town"),
      (store_faction_of_party, ":var1", "$g_encountered_party"),
      (store_relation, ":var2", ":var1", "fac_player_supporters_faction"),
      (try_begin),
        (gt, ":var0", 0),
        (ge, ":var2", 0),
        (store_faction_of_party, ":var3", ":var0"),
        (store_relation, ":var4", ":var3", "fac_player_supporters_faction"),
        (this_or_next|party_slot_eq, "$current_town", 7, "trp_player"),
        (lt, ":var4", 0),
        (assign, "$g_defending_against_siege", 1),
        (assign, "$g_siege_first_encounter", 1),
        (jump_to_menu, "mnu_siege_started_defender"),
      (try_end),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (store_sub, ":var5", "$g_encountered_party", "p_town_1"),
        (371, 26, ":var5", 1),
        (assign, ":var6", 0),
        (try_for_range, ":var7", "p_town_1", "p_castle_1"),
          (store_sub, ":var5", ":var7", "p_town_1"),
          (370, ":var8", 26, ":var5"),
          (eq, ":var8", 0),
          (assign, ":var6", 1),
        (try_end),
        (try_begin),
          (eq, ":var6", 0),
          (372, 26),
        (try_end),
      (try_end),
      (assign, "$qst_collect_taxes_currently_collecting", 0),
      (try_begin),
        (gt, "$quest_auto_menu", 0),
        (jump_to_menu, "$quest_auto_menu"),
        (assign, "$quest_auto_menu", 0),
      (try_end),
      (try_begin),
        (eq, "$g_town_assess_trade_goods_after_rest", 1),
        (assign, "$g_town_assess_trade_goods_after_rest", 0),
        (jump_to_menu, "mnu_town_trade_assessment"),
      (try_end),
      (assign, "$talk_context", 0),
      (assign, "$all_doors_locked", 0),
      (try_begin),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (assign, "$town_entered", 1),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town", 1),
        (assign, "$g_leave_town", 0),
        (assign, "$g_permitted_to_center", 0),
        (leave_encounter),
        (change_screen_return),
      (try_end),
      (str_store_party_name, s2, "$current_town"),
      (party_get_slot, ":var9", "$current_town", 7),
      (store_faction_of_party, ":var10", "$current_town"),
      (str_store_faction_name, s9, ":var10"),
      (try_begin),
        (ge, ":var9", 0),
        (str_store_troop_name, s8, ":var9"),
        (str_store_string, s7, "@{s8} of the {s9}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (str_store_string, s60, s2),
        (party_get_slot, ":var11", "$current_town", 50),
        (try_begin),
          (ge, "$cheat_mode", 1),
          (assign, reg4, ":var11"),
          (display_message, "@{!}DEBUG -- Prosperity: {reg4}"),
        (try_end),
        (try_begin),
          (le, ":var11", 3),
          (assign, ":var12", 0),
        (else_try),
          (le, ":var11", 9),
          (assign, ":var12", 1),
        (else_try),
          (le, ":var11", 24),
          (assign, ":var12", 2),
        (else_try),
          (le, ":var11", 45),
          (assign, ":var12", 3),
        (else_try),
          (le, ":var11", 75),
          (assign, ":var12", 4),
        (else_try),
          (le, ":var11", 117),
          (assign, ":var12", 5),
        (else_try),
          (le, ":var11", 183),
          (assign, ":var12", 6),
        (else_try),
          (le, ":var11", 225),
          (assign, ":var12", 7),
        (else_try),
          (le, ":var11", 255),
          (assign, ":var12", 8),
        (else_try),
          (le, ":var11", 276),
          (assign, ":var12", 9),
        (else_try),
          (le, ":var11", 291),
          (assign, ":var12", 10),
        (else_try),
          (le, ":var11", 297),
          (assign, ":var12", 11),
        (else_try),
          (gt, ":var11", 297),
          (assign, ":var12", 12),
        (try_end),
        (store_add, ":var13", "str_town_prosperity_0", ":var12"),
        (str_store_string, s10, ":var13"),
        (store_div, ":var13", ":var11", 60),
        (val_min, ":var13", 4),
        (val_add, ":var13", "str_town_alt_prosperity_0"),
        (str_store_string, s14, ":var13"),
      (else_try),
        (str_clear, s14),
        (str_store_string, s10, "@You are at {s2}."),
      (try_end),
      (call_script, "script_gender_to_reg63"),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 2),
        (try_begin),
          (eq, ":var9", "trp_player"),
          (str_store_string, s11, "@ Your own banner flies over the castle gate."),
        (else_try),
          (gt, ":var9", -1),
          (troop_slot_eq, ":var9", 30, "trp_player"),
          (str_store_string, s11, "str__you_see_the_banner_of_your_wifehusband_s7_over_the_castle_gate"),
        (else_try),
          (ge, ":var9", 0),
          (str_store_string, s11, "@ You see the banner of {s7} over the castle gate."),
        (else_try),
          (str_store_string, s11, "@ This castle has no garrison."),
        (try_end),
      (else_try),
        (try_begin),
          (eq, ":var9", "trp_player"),
          (str_store_string, s11, "@ Your own banner flies over the town gates."),
        (else_try),
          (gt, ":var9", -1),
          (troop_slot_eq, ":var9", 30, "trp_player"),
          (str_store_string, s11, "str__the_banner_of_your_wifehusband_s7_flies_over_the_town_gates"),
        (else_try),
          (ge, ":var9", 0),
          (str_store_string, s11, "@ You see the banner of {s7} over the town gates."),
        (else_try),
          (str_store_string, s11, "@ This town has no garrison."),
        (try_end),
      (try_end),
      (str_clear, s12),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (party_get_slot, ":var14", "$current_town", 26),
        (call_script, "script_describe_center_relation_to_s3", ":var14"),
        (assign, reg9, ":var14"),
        (str_store_string, s12, "@{!} {s3} ({reg9})."),
      (try_end),
      (str_clear, s13),
      (try_begin),
        (gt, "$entry_to_town_forbidden", 0),
        (str_store_string, s13, "@ You have successfully sneaked in."),
      (else_try),
        (faction_slot_eq, ":var10", 4, 6),
        (faction_slot_eq, ":var10", 5, "$current_town"),
        (str_store_string, s13, "str__the_lord_is_currently_holding_a_feast_in_his_hall"),
      (try_end),
      (try_begin),
        (store_time_of_day, reg12),
        (ge, reg12, 5),
        (lt, reg12, 21),
        (assign, "$town_nighttime", 0),
      (else_try),
        (assign, "$town_nighttime", 1),
        (party_slot_eq, "$current_town", 0, 3),
        (str_store_string, s13, "str_town_nighttime"),
      (try_end),
      (try_begin),
        (party_slot_ge, "$current_town", 156, 1),
        (neg|is_currently_night),
        (party_set_slot, "$current_town", 156, 1),
        (str_store_string, s13, "@{s13} A tournament will be held here soon."),
        (try_begin),
          (neg|troop_slot_ge, "trp_player", 7, 150),
          (try_begin),
            (troop_slot_ge, "trp_player", 13, 1),
            (str_store_string, s13, "@{s13} Though the heralds recognize your banner and your noble origins, the few left free spots are quickly handed out to more renowned knights and you are not allowed to participate in this tournament."),
          (else_try),
            (str_store_string, s13, "@{s13} You have neither a noble origin nor are you renowned. Therefore you are not allowed to participate in this tournament."),
          (try_end),
        (else_try),
          (neg|troop_slot_ge, "trp_player", 13, 1),
          (str_store_string, s13, "@{s13} Despite not being of noble origins, the tales of your deeds in battle and your weapon prowess has spread over Pendor and reached the heralds. Therefore they allow you to join the ranks and fight in this tournament!"),
        (try_end),
      (try_end),
      (assign, "$castle_undefended", 0),
      (party_get_num_companions, ":var15", "p_collective_enemy"),
      (try_begin),
        (eq, ":var15", 0),
        (assign, "$castle_undefended", 1),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("castle_castle",
      [
        (party_slot_eq, "$current_town", 0, 2),
        (eq, "$sneaked_into_town", 0),
        (str_clear, s1),
        (try_begin),
          (store_faction_of_party, ":var0", "$current_town"),
          (faction_slot_eq, ":var0", 4, 6),
          (faction_slot_eq, ":var0", 5, "$current_town"),
          (str_store_string, s1, "str__join_the_feast"),
        (try_end),
      ],
      "Go_to_the_Lord's_hall{s1}.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$sneaked_into_town", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
          (neg|troop_slot_ge, "trp_player", 7, 50),
          (neg|troop_slot_ge, "trp_player", 7, 125),
          (neq, "$g_player_eligible_feast_center_no", "$current_town"),
          (faction_slot_eq, "$g_encountered_party_faction", 4, 6),
          (faction_slot_eq, "$g_encountered_party_faction", 5, "$g_encountered_party"),
          (neg|check_quest_active, "qst_wed_betrothed"),
          (neg|check_quest_active, "qst_wed_betrothed_female"),
          (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
          (jump_to_menu, "mnu_cannot_enter_court"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 289),
          (gt, ":var0", 0),
          (troop_slot_eq, "trp_player", 162, ":var0"),
          (store_troop_faction, ":var1", ":var0"),
          (faction_slot_eq, ":var1", 72, 6),
          (faction_slot_ge, ":var1", 71, 300),
          (quest_slot_eq, "qst_order_grandmaster", 11, 0),
          (quest_set_slot, "qst_order_grandmaster", 11, 1),
          (quest_set_slot, "qst_order_grandmaster", 12, "$current_town"),
          (set_jump_mission, "mt_grandmaster_ambush"),
          (party_get_slot, ":var2", "$current_town", 11),
          (modify_visitors_at_site, ":var2"),
          (reset_visitors),
          (set_visitor, 0, "trp_player"),
          (set_visitor, 1, ":var0"),
          (set_visitor, 2, ":var0"),
          (set_visitor, 3, "trp_snake_priestess"),
          (set_visitor, 4, "trp_anaconda_knight"),
          (set_visitor, 5, "trp_anaconda_knight"),
          (set_visitor, 6, "trp_cobra_warrior"),
          (set_visitor, 7, "trp_cobra_warrior"),
          (jump_to_scene, ":var2"),
          (scene_set_slot, ":var2", 0, 1),
          (change_screen_mission),
        (else_try),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court_castle", "$current_town"),
        (try_end),
      ]
,
      "Door_to_the_castle"
      ),

      ("join_tournament",
      [
        (party_slot_ge, "$current_town", 156, 1),
      ],
      "Join_the_tournament.",
      [
        (try_begin),
          (neg|troop_slot_ge, "trp_player", 7, 150),
          (display_message, "str_tournament_not_enough_renown", 0xFFFFAAAA),
        (else_try),
          (is_currently_night),
          (display_message, "str_tournament_is_night", 0xFFAAAAAA),
        (else_try),
          (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
          (assign, "$g_tournament_cur_tier", 0),
          (assign, "$g_tournament_player_team_won", -1),
          (assign, "$g_tournament_bet_placed", 0),
          (assign, "$g_tournament_bet_win_amount", 0),
          (assign, "$g_tournament_last_bet_tier", -1),
          (assign, "$g_tournament_next_num_teams", 0),
          (assign, "$g_tournament_next_team_size", 0),
          (jump_to_menu, "mnu_town_tournament"),
        (try_end),
      ]
      ),

      ("town_castle",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$entry_to_town_forbidden", 0),
        (str_clear, s1),
        (try_begin),
          (store_faction_of_party, ":var0", "$current_town"),
          (faction_slot_eq, ":var0", 4, 6),
          (faction_slot_eq, ":var0", 5, "$current_town"),
          (str_store_string, s1, "str__join_the_feast"),
        (try_end),
      ],
      "Go_to_the_castle{s1}.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$sneaked_into_town", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
          (neg|troop_slot_ge, "trp_player", 7, 50),
          (neg|troop_slot_ge, "trp_player", 7, 125),
          (neq, "$g_player_eligible_feast_center_no", "$current_town"),
          (faction_slot_eq, "$g_encountered_party_faction", 4, 6),
          (faction_slot_eq, "$g_encountered_party_faction", 5, "$g_encountered_party"),
          (neg|check_quest_active, "qst_wed_betrothed"),
          (neg|check_quest_active, "qst_wed_betrothed_female"),
          (neg|troop_slot_ge, "trp_player", 30, "trp_npc_adonja"),
          (jump_to_menu, "mnu_cannot_enter_court"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 289),
          (gt, ":var0", 0),
          (troop_slot_eq, "trp_player", 162, ":var0"),
          (store_troop_faction, ":var1", ":var0"),
          (faction_slot_eq, ":var1", 72, 6),
          (faction_slot_ge, ":var1", 71, 300),
          (quest_slot_eq, "qst_order_grandmaster", 11, 0),
          (quest_set_slot, "qst_order_grandmaster", 11, 1),
          (quest_set_slot, "qst_order_grandmaster", 12, "$current_town"),
          (set_jump_mission, "mt_grandmaster_ambush"),
          (party_get_slot, ":var2", "$current_town", 11),
          (modify_visitors_at_site, ":var2"),
          (reset_visitors),
          (set_visitor, 0, "trp_player"),
          (set_visitor, 1, ":var0"),
          (set_visitor, 2, ":var0"),
          (set_visitor, 3, "trp_snake_priestess"),
          (set_visitor, 4, "trp_anaconda_knight"),
          (set_visitor, 5, "trp_anaconda_knight"),
          (set_visitor, 6, "trp_cobra_warrior"),
          (set_visitor, 7, "trp_cobra_warrior"),
          (jump_to_scene, ":var2"),
          (scene_set_slot, ":var2", 0, 1),
          (change_screen_mission),
        (else_try),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court", "$current_town"),
        (try_end),
      ]
,
      "Door_to_the_castle"
      ),

      ("town_center",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Take_a_walk_around_the_streets.",
      [
        (try_begin),
          (eq, "$talk_context", 18),
          (assign, "$talk_context", 19),
          (assign, "$g_mt_mode", 3),
          (store_faction_of_party, ":var0", "$current_town"),
          (faction_get_slot, ":var1", ":var0", 42),
          (faction_get_slot, ":var2", ":var0", 43),
          (faction_get_slot, ":var3", ":var0", 44),
          (party_get_slot, ":var4", "$current_town", 10),
          (modify_visitors_at_site, ":var4"),
          (reset_visitors),
          (try_begin),
            (party_get_slot, ":var5", "$current_town", 240),
            (store_current_hours, ":var6"),
            (store_add, ":var7", ":var5", 4),
            (neg|is_between, ":var6", ":var5", ":var7"),
            (store_time_of_day, ":var8"),
            (try_begin),
              (ge, ":var8", 6),
              (lt, ":var8", 22),
              (set_visitors, 25, ":var1", 2),
              (set_visitors, 26, ":var1", 1),
              (set_visitors, 27, ":var2", 2),
              (set_visitors, 28, ":var3", 1),
            (else_try),
              (set_visitors, 25, ":var1", 1),
              (set_visitors, 26, ":var1", 1),
              (set_visitors, 27, ":var2", 1),
              (set_visitors, 28, ":var3", 1),
            (try_end),
          (else_try),
            (store_time_of_day, ":var8"),
            (try_begin),
              (ge, ":var8", 6),
              (lt, ":var8", 22),
              (set_visitors, 25, ":var1", 1),
              (set_visitors, 26, ":var1", 0),
              (set_visitors, 27, ":var2", 1),
              (set_visitors, 28, ":var3", 0),
            (else_try),
              (set_visitors, 25, ":var1", 1),
              (set_visitors, 26, ":var1", 0),
              (set_visitors, 27, ":var2", 0),
              (set_visitors, 28, ":var3", 0),
            (try_end),
          (try_end),
          (set_jump_mission, "mt_town_center"),
          (jump_to_scene, ":var4"),
          (change_screen_mission),
        (else_try),
          (assign, "$talk_context", 0),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var4", "$current_town", 10),
          (modify_visitors_at_site, ":var4"),
          (reset_visitors),
          (assign, "$g_mt_mode", 0),
          (store_faction_of_party, ":var0", "$current_town"),
          (try_begin),
            (neq, ":var0", "fac_player_supporters_faction"),
            (faction_get_slot, ":var9", "$g_encountered_party_faction", 51),
            (faction_get_slot, ":var10", "$g_encountered_party_faction", 52),
            (faction_get_slot, ":var1", ":var0", 42),
            (faction_get_slot, ":var2", ":var0", 43),
          (else_try),
            (eq, ":var0", "fac_player_supporters_faction"),
            (faction_get_slot, ":var9", "$g_encountered_party_faction", 51),
            (faction_get_slot, ":var10", "$g_encountered_party_faction", 52),
            (faction_get_slot, ":var1", ":var0", 42),
            (faction_get_slot, ":var2", ":var0", 43),
          (else_try),
            (party_get_slot, ":var11", "$current_town", 61),
            (faction_get_slot, ":var9", ":var11", 51),
            (faction_get_slot, ":var10", ":var11", 52),
            (faction_get_slot, ":var1", ":var11", 42),
            (faction_get_slot, ":var2", ":var11", 43),
          (try_end),
          (try_begin),
            (party_get_slot, ":var5", "$current_town", 240),
            (store_current_hours, ":var6"),
            (store_add, ":var7", ":var5", 4),
            (neg|is_between, ":var6", ":var5", ":var7"),
            (set_visitor, 23, ":var10"),
          (try_end),
          (set_visitor, 24, ":var9"),
          (try_begin),
            (gt, ":var1", 0),
            (assign, reg0, ":var2"),
            (assign, reg1, ":var2"),
            (assign, reg2, ":var1"),
            (assign, reg3, ":var1"),
          (else_try),
            (assign, reg0, "trp_rav_warden"),
            (assign, reg1, "trp_rav_warden"),
            (assign, reg2, "trp_rav_footman"),
            (assign, reg3, "trp_rav_footman"),
          (try_end),
          (shuffle_range, 0, 4),
          (try_begin),
            (party_get_slot, ":var5", "$current_town", 240),
            (store_current_hours, ":var6"),
            (store_add, ":var7", ":var5", 4),
            (neg|is_between, ":var6", ":var5", ":var7"),
            (set_visitor, 25, reg0),
            (set_visitor, 26, reg1),
            (set_visitor, 27, reg2),
            (set_visitor, 28, reg3),
          (try_end),
          (party_get_slot, ":var12", "$current_town", 22),
          (set_visitor, 9, ":var12"),
          (party_get_slot, ":var12", "$current_town", 21),
          (set_visitor, 10, ":var12"),
          (party_get_slot, ":var12", "$current_town", 25),
          (set_visitor, 11, ":var12"),
          (party_get_slot, ":var12", "$current_town", 24),
          (set_visitor, 12, ":var12"),
          (call_script, "script_init_town_walkers"),
          (set_jump_mission, "mt_town_center"),
          (assign, ":var13", 256),
          (try_begin),
            (eq, "$sneaked_into_town", 1),
            (assign, ":var13", 447),
          (try_end),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 0, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 2, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 3, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 4, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 5, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 6, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 7, ":var13"),
          (try_begin),
            (eq, "$town_entered", 0),
            (assign, "$town_entered", 1),
            (eq, "$town_nighttime", 0),
            (set_jump_entry, 1),
          (try_end),
          (jump_to_scene, ":var4"),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_town_center"
      ),

      ("town_tavern",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Visit_the_tavern.",
      [
        (try_begin),
          (eq, "$all_doors_locked", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (assign, "$town_entered", 1),
          (set_jump_mission, "mt_town_default"),
          (mission_tpl_entry_set_override_flags, "mt_town_default", 0, 256),
          (try_begin),
            (eq, "$sneaked_into_town", 1),
            (mission_tpl_entry_set_override_flags, "mt_town_default", 0, 447),
          (try_end),
          (party_get_slot, ":var0", "$current_town", 13),
          (jump_to_scene, ":var0"),
          (scene_set_slot, ":var0", 0, 1),
          (assign, "$talk_context", 14),
          (call_script, "script_initialize_tavern_variables"),
          (store_random_in_range, ":var1", 0, 4),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (assign, ":var2", 17),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (troop_get_slot, ":var3", "trp_belligerent_drunk", 12),
            (try_begin),
              (eq, "$cheat_mode", 0),
            (else_try),
              (is_between, ":var3", "p_town_1", "p_salt_mine"),
              (str_store_party_name, s4, ":var3"),
              (display_message, "str_belligerent_drunk_in_s4"),
            (else_try),
              (display_message, "str_belligerent_drunk_not_found"),
            (try_end),
            (troop_get_slot, ":var4", "trp_fight_promoter", 12),
            (try_begin),
              (eq, "$cheat_mode", 0),
            (else_try),
              (is_between, ":var4", "p_town_1", "p_salt_mine"),
              (str_store_party_name, s4, ":var4"),
              (display_message, "str_roughlooking_character_in_s4"),
            (else_try),
              (display_message, "str_roughlooking_character_not_found"),
            (try_end),
          (try_end),
          (try_begin),
            (store_current_hours, ":var5"),
            (store_sub, ":var6", ":var5", "$g_last_assassination_attempt_time"),
            (gt, ":var6", 168),
            (try_for_range, ":var7", "trp_npc_adonja", "trp_knight_1_1_wife"),
              (troop_slot_eq, ":var7", 52, 5),
              (troop_get_slot, ":var8", ":var7", 10),
              (party_is_active, ":var8"),
              (party_get_attached_to, ":var9", ":var8"),
              (eq, ":var9", "$g_encountered_party"),
              (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var7"),
              (lt, reg0, -20),
              (assign, "$g_last_assassination_attempt_time", ":var5"),
              (troop_set_slot, "trp_hired_assassin", 12, "$g_encountered_party"),
            (try_end),
          (try_end),
          (try_begin),
            (eq, ":var1", 0),
            (call_script, "script_setup_tavern_attacker", ":var2"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (eq, 1, 0),
            (troop_slot_eq, "trp_fight_promoter", 12, "$current_town"),
            (set_visitor, ":var2", "trp_fight_promoter"),
            (val_add, ":var2", 1),
          (try_end),
          (party_get_slot, ":var10", "$current_town", 90),
          (party_get_slot, ":var11", "$current_town", 91),
          (try_begin),
            (gt, ":var10", 0),
            (gt, ":var11", 0),
            (set_visitor, ":var2", ":var10"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (eq, ":var1", 1),
            (call_script, "script_setup_tavern_attacker", ":var2"),
            (val_add, ":var2", 1),
          (try_end),
          (try_for_range, ":var12", "trp_npc_adonja", "trp_kingdom_1_lord"),
            (troop_slot_eq, ":var12", 2, 0),
            (troop_slot_eq, ":var12", 12, "$current_town"),
            (neg|troop_slot_ge, ":var12", 8, "p_town_1"),
            (set_visitor, ":var2", ":var12"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (eq, ":var1", 2),
            (call_script, "script_setup_tavern_attacker", ":var2"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (party_get_slot, ":var13", "$current_town", 95),
            (gt, ":var13", 0),
            (assign, reg0, ":var13"),
            (assign, reg1, "$current_town"),
            (set_visitor, ":var2", ":var13"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (party_get_slot, ":var14", "$current_town", 96),
            (gt, ":var14", 0),
            (set_visitor, ":var2", ":var14"),
            (val_add, ":var2", 1),
          (try_end),
          (assign, ":var15", 0),
          (try_begin),
            (party_get_slot, ":var16", "$current_town", 99),
            (gt, ":var16", 0),
            (assign, ":var15", 1),
            (set_visitor, ":var2", ":var16"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (party_get_slot, ":var17", "$current_town", 98),
            (gt, ":var17", 0),
            (set_visitor, ":var2", ":var17"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (eq, ":var1", 3),
            (call_script, "script_setup_tavern_attacker", ":var2"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
            (neg|check_quest_active, "qst_deal_with_bandits_at_lords_village"),
            (assign, ":var18", "p_salt_mine"),
            (try_for_range, ":var19", "p_village_1", ":var18"),
              (party_slot_eq, ":var19", 120, "$current_town"),
              (party_slot_ge, ":var19", 39, 1),
              (neg|party_slot_eq, ":var19", 7, "trp_player"),
              (set_visitor, ":var2", "trp_farmer_from_bandit_village"),
              (val_add, ":var2", 1),
              (assign, ":var18", 0),
            (try_end),
          (try_end),
          (try_begin),
            (eq, "$g_starting_town", "$current_town"),
            (neg|this_or_next|check_quest_finished, "qst_collect_men"),
            (neg|this_or_next|check_quest_finished, "qst_learn_where_merchant_brother_is"),
            (neg|this_or_next|check_quest_finished, "qst_save_relative_of_merchant"),
            (eq, "$g_do_one_more_meeting_with_merchant", 1),
            (assign, ":var20", 0),
            (try_begin),
              (eq, "$g_encountered_party_faction", "fac_kingdom_1"),
              (assign, ":var20", "trp_sarleon_merchant"),
            (else_try),
              (eq, "$g_encountered_party_faction", "fac_kingdom_2"),
              (assign, ":var20", "trp_ravenstern_merchant"),
            (else_try),
              (eq, "$g_encountered_party_faction", "fac_kingdom_3"),
              (assign, ":var20", "trp_dshar_merchant"),
            (else_try),
              (eq, "$g_encountered_party_faction", "fac_kingdom_4"),
              (assign, ":var20", "trp_fierdsvain_merchant"),
            (else_try),
              (eq, "$g_encountered_party_faction", "fac_kingdom_5"),
              (assign, ":var20", "trp_empire_merchant"),
            (try_end),
            (gt, ":var20", 0),
            (set_visitor, ":var2", ":var20"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (store_random_in_range, ":var21", 0, 100),
            (lt, ":var21", 5),
            (store_random_in_range, ":var22", "trp_dragon_knight", "trp_player_knight"),
            (try_begin),
              (eq, ":var22", "trp_griffon_knight"),
              (assign, ":var23", 0),
              (assign, ":var24", "p_village_1"),
              (try_for_range, ":var25", "p_town_1", ":var24"),
                (party_get_slot, ":var26", ":var25", 289),
                (eq, ":var26", "trp_griffon_knight"),
                (assign, ":var23", 1),
                (assign, ":var24", "p_town_1"),
              (try_end),
              (eq, ":var23", 0),
              (assign, ":var22", "trp_lion_knight"),
            (try_end),
            (set_visitor, ":var2", ":var22"),
            (val_add, ":var2", 1),
          (try_end),
          (store_time_of_day, ":var27"),
          (try_begin),
            (neg|is_between, ":var27", 3, 6),
            (assign, "$g_mt_mode", 4),
          (else_try),
            (assign, "$g_mt_mode", 5),
          (try_end),
          (try_for_range, ":var28", 32, 46),
            (store_random_in_range, ":var29", 0, 100),
            (try_begin),
              (is_between, ":var27", 0, 2),
              (val_sub, ":var29", 10),
            (else_try),
              (is_between, ":var27", 2, 4),
              (val_sub, ":var29", 40),
            (else_try),
              (is_between, ":var27", 4, 6),
              (val_sub, ":var29", 42),
            (else_try),
              (is_between, ":var27", 6, 8),
              (val_sub, ":var29", 35),
            (else_try),
              (is_between, ":var27", 8, 10),
              (val_sub, ":var29", 15),
            (else_try),
              (is_between, ":var27", 10, 12),
              (val_sub, ":var29", 0),
            (else_try),
              (is_between, ":var27", 12, 14),
              (val_add, ":var29", 10),
            (else_try),
              (is_between, ":var27", 14, 16),
              (val_add, ":var29", 20),
            (else_try),
              (is_between, ":var27", 16, 18),
              (val_add, ":var29", 30),
            (else_try),
              (is_between, ":var27", 18, 20),
              (val_add, ":var29", 40),
            (else_try),
              (is_between, ":var27", 20, 22),
              (val_add, ":var29", 20),
            (else_try),
              (is_between, ":var27", 22, 24),
              (val_sub, ":var29", 5),
            (try_end),
            (gt, ":var29", 50),
            (try_begin),
              (eq, ":var15", 0),
              (store_random_in_range, ":var29", 0, 20),
              (try_begin),
                (is_between, ":var27", 1, 10),
                (val_sub, ":var29", 1),
              (try_end),
              (gt, ":var29", 18),
              (mission_tpl_entry_clear_override_items, "mt_town_default", ":var28"),
              (store_random_in_range, ":var29", 0, 2),
              (try_begin),
                (eq, ":var29", 0),
                (mission_tpl_entry_add_override_item, "mt_town_default", ":var28", "itm_dedal_lutnia"),
              (else_try),
                (mission_tpl_entry_add_override_item, "mt_town_default", ":var28", "itm_dedal_lira"),
              (try_end),
              (store_random_in_range, ":var30", 0, 1000),
              (party_get_slot, ":var31", "$current_town", 19),
              (faction_get_slot, ":var32", ":var31", 151),
              (faction_get_slot, ":var33", ":var31", 152),
              (store_add, ":var33", ":var33", 1),
              (store_random_in_range, ":var34", ":var32", ":var33"),
              (set_visitor, ":var28", ":var34", ":var30"),
              (assign, ":var15", 1),
            (else_try),
              (party_get_slot, ":var31", "$current_town", 19),
              (faction_get_slot, ":var35", ":var31", 53),
              (faction_get_slot, ":var36", ":var31", 54),
              (store_add, ":var36", ":var36", 1),
              (store_random_in_range, ":var37", ":var35", ":var36"),
              (store_random_in_range, ":var30", 0, 1000),
              (mission_tpl_entry_clear_override_items, "mt_town_default", ":var28"),
              (mission_tpl_entry_add_override_item, "mt_town_default", ":var28", "itm_dedal_kufel"),
              (set_visitor, ":var28", ":var37", ":var30"),
            (try_end),
          (try_end),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_tavern"
      ),

      ("town_merchant",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, 1, 0),
        (eq, "$town_nighttime", 0),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Speak_with_the_merchant.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$town_nighttime", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (assign, "$town_entered", 1),
          (set_jump_mission, "mt_town_default"),
          (mission_tpl_entry_set_override_flags, "mt_town_default", 0, 256),
          (try_begin),
            (eq, "$sneaked_into_town", 1),
            (mission_tpl_entry_set_override_flags, "mt_town_default", 0, 447),
          (try_end),
          (party_get_slot, ":var0", "$current_town", 14),
          (jump_to_scene, ":var0"),
          (scene_set_slot, ":var0", 0, 1),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_shop"
      ),

      ("town_arena",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$sneaked_into_town", 0),
      ],
      "Enter_the_arena.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$town_nighttime", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (assign, "$g_mt_mode", 2),
          (assign, "$town_entered", 1),
          (set_jump_mission, "mt_arena_melee_fight"),
          (party_get_slot, ":var0", "$current_town", 16),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (set_visitor, 43, "trp_veteran_fighter"),
          (set_visitor, 44, "trp_hired_blade"),
          (set_jump_entry, 50),
          (jump_to_scene, ":var0"),
          (scene_set_slot, ":var0", 0, 1),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_arena"
      ),

      ("town_dungeon",
      [
        (eq, 1, 0),
      ],
      "Never:_Enter_the_prison.",
      [
        (try_begin),
          (eq, "$talk_context", 18),
          (gt, "$g_main_attacker_agent", 0),
          (neg|agent_is_alive, "$g_main_attacker_agent"),
          (agent_get_troop_id, ":var0", "$g_main_attacker_agent"),
          (try_begin),
            (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
            (party_get_slot, ":var1", "$current_town", 61),
          (else_try),
            (assign, ":var1", "$g_encountered_party_faction"),
          (try_end),
          (faction_slot_eq, ":var1", 51, ":var0"),
          (call_script, "script_deduct_casualties_from_garrison"),
          (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
        (else_try),
          (eq, "$all_doors_locked", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (this_or_next|party_slot_eq, "$current_town", 7, "trp_player"),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
        (else_try),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (try_end),
      ]
,
      "Door_to_the_dungeon"
      ),

      ("castle_inspect",
      [
        (party_slot_eq, "$current_town", 0, 2),
      ],
      "Take_a_walk_around_the_courtyard.",
      [
        (try_begin),
          (eq, "$talk_context", 18),
          (assign, "$talk_context", 19),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (assign, ":var1", 40),
          (party_get_num_companion_stacks, ":var2", "$g_encountered_party"),
          (try_for_range, ":var3", 0, ":var2"),
            (party_get_slot, ":var4", "$current_town", 240),
            (store_current_hours, ":var5"),
            (store_add, ":var6", ":var4", 4),
            (this_or_next|eq, ":var1", 40),
            (neg|is_between, ":var5", ":var4", ":var6"),
            (lt, ":var1", 47),
            (party_stack_get_troop_id, ":var7", "$g_encountered_party", ":var3"),
            (neg|troop_is_hero, ":var7"),
            (party_stack_get_size, ":var8", "$g_encountered_party", ":var3"),
            (party_stack_get_num_wounded, ":var9", "$g_encountered_party", ":var3"),
            (val_sub, ":var8", ":var9"),
            (gt, ":var8", 0),
            (party_stack_get_troop_dna, ":var10", "$g_encountered_party", ":var3"),
            (set_visitor, ":var1", ":var7", ":var10"),
            (val_add, ":var1", 1),
          (try_end),
          (set_visitor, 7, "$g_player_troop"),
          (set_jump_mission, "mt_castle_visit"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (else_try),
          (assign, "$talk_context", 0),
          (assign, "$g_mt_mode", 0),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (try_begin),
            (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
            (faction_get_slot, ":var11", "$g_encountered_party_faction", 51),
          (else_try),
            (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
            (faction_get_slot, ":var11", "$g_encountered_party_faction", 51),
          (else_try),
            (party_get_slot, ":var12", "$current_town", 61),
            (faction_get_slot, ":var11", ":var12", 51),
          (try_end),
          (set_visitor, 24, ":var11"),
          (assign, ":var1", 40),
          (party_get_num_companion_stacks, ":var2", "$g_encountered_party"),
          (try_for_range, ":var3", 0, ":var2"),
            (party_get_slot, ":var4", "$current_town", 240),
            (store_current_hours, ":var5"),
            (store_add, ":var6", ":var4", 4),
            (neg|is_between, ":var5", ":var6", ":var4"),
            (lt, ":var1", 47),
            (party_stack_get_troop_id, ":var7", "$g_encountered_party", ":var3"),
            (neg|troop_is_hero, ":var7"),
            (party_stack_get_size, ":var8", "$g_encountered_party", ":var3"),
            (party_stack_get_num_wounded, ":var9", "$g_encountered_party", ":var3"),
            (val_sub, ":var8", ":var9"),
            (gt, ":var8", 0),
            (party_stack_get_troop_dna, ":var10", "$g_encountered_party", ":var3"),
            (set_visitor, ":var1", ":var7", ":var10"),
            (val_add, ":var1", 1),
          (try_end),
          (try_begin),
            (eq, "$town_entered", 0),
            (assign, "$town_entered", 1),
          (try_end),
          (set_jump_entry, 1),
          (assign, ":var13", 256),
          (try_begin),
            (eq, "$sneaked_into_town", 1),
            (assign, ":var13", 447),
          (try_end),
          (set_jump_mission, "mt_castle_visit"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 0, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 1, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 2, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 3, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 4, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 5, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 6, ":var13"),
          (mission_tpl_entry_set_override_flags, "mt_castle_visit", 7, ":var13"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (try_end),
      ]
,
      "To_the_castle_courtyard."
      ),

      ("town_enterprise_a",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (party_get_slot, ":var0", "$current_town", 137),
        (gt, ":var0", 1),
        (eq, "$entry_to_town_forbidden", 0),
        (call_script, "script_get_enterprise_name", ":var0"),
        (str_store_string, s3, reg0),
      ],
      "Visit_your_{s3}.",
      [
        (store_sub, ":var0", "$current_town", "p_town_1"),
        (store_add, ":var1", "trp_town_1_master_craftsman", ":var0"),
        (party_get_slot, ":var2", "$current_town", 137),
        (assign, ":var3", "scn_enterprise_mill"),
        (try_begin),
          (eq, ":var2", "itm_bread"),
          (assign, ":var3", "scn_enterprise_mill"),
        (else_try),
          (eq, ":var2", "itm_ale"),
          (assign, ":var3", "scn_enterprise_brewery"),
        (else_try),
          (eq, ":var2", "itm_oil"),
          (assign, ":var3", "scn_enterprise_oil_press"),
        (else_try),
          (eq, ":var2", "itm_wine"),
          (assign, ":var3", "scn_enterprise_winery"),
        (else_try),
          (eq, ":var2", "itm_leatherwork"),
          (assign, ":var3", "scn_enterprise_tannery"),
        (else_try),
          (eq, ":var2", "itm_wool_cloth"),
          (assign, ":var3", "scn_enterprise_wool_weavery"),
        (else_try),
          (eq, ":var2", "itm_linen"),
          (assign, ":var3", "scn_enterprise_linen_weavery"),
        (else_try),
          (eq, ":var2", "itm_velvet"),
          (assign, ":var3", "scn_enterprise_dyeworks"),
        (else_try),
          (eq, ":var2", "itm_tools"),
          (assign, ":var3", "scn_enterprise_smithy"),
        (try_end),
        (modify_visitors_at_site, ":var3"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, ":var1"),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, ":var3"),
        (change_screen_mission),
      ]
,
      "Door_to_your_enterprise"
      ),

      ("visit_lady",
      [
        (neg|troop_slot_ge, "trp_player", 30, "trp_knight_1_1_wife"),
        (assign, "$love_interest_in_town", 0),
        (assign, "$love_interest_in_town_2", 0),
        (assign, "$love_interest_in_town_3", 0),
        (assign, "$love_interest_in_town_4", 0),
        (assign, "$love_interest_in_town_5", 0),
        (assign, "$love_interest_in_town_6", 0),
        (assign, "$love_interest_in_town_7", 0),
        (assign, "$love_interest_in_town_8", 0),
        (try_for_range, ":var0", "trp_knight_1_1_wife", "trp_heroes_end"),
          (troop_slot_eq, ":var0", 12, "$current_town"),
          (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
          (assign, ":var1", reg0),
          (troop_slot_eq, ":var0", 30, -1),
          (ge, ":var1", 0),
          (this_or_next|troop_slot_ge, ":var0", 5, 2),
          (troop_slot_eq, ":var1", 38, 1),
          (neg|troop_slot_eq, ":var0", 5, 4),
          (try_begin),
            (eq, "$love_interest_in_town", 0),
            (assign, "$love_interest_in_town", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_2", 0),
            (assign, "$love_interest_in_town_2", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_3", 0),
            (assign, "$love_interest_in_town_3", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_4", 0),
            (assign, "$love_interest_in_town_4", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_5", 0),
            (assign, "$love_interest_in_town_5", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_6", 0),
            (assign, "$love_interest_in_town_6", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_7", 0),
            (assign, "$love_interest_in_town_7", ":var0"),
          (else_try),
            (eq, "$love_interest_in_town_8", 0),
            (assign, "$love_interest_in_town_8", ":var0"),
          (try_end),
        (try_end),
        (gt, "$love_interest_in_town", 0),
      ],
      "Attempt_to_visit_a_lady.",
      [
        (jump_to_menu, "mnu_lady_visit"),
      ]
,
      "Door_to_the_garden"
      ),

      ("trade_with_merchants",
      [
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "Go_to_the_marketplace.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (jump_to_menu, "mnu_town_trade"),
        (try_end),
      ]
      ),

      ("guildmaster_talk",
      [
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "Speak_with_the_Guildmaster.",
      [
        (party_get_slot, ":var0", "$current_town", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (party_get_slot, ":var1", "$current_town", 25),
        (set_visitor, 11, ":var1"),
        (call_script, "script_init_town_walkers"),
        (set_jump_mission, "mt_town_center"),
        (jump_to_scene, ":var0"),
        (change_screen_map_conversation, ":var1"),
      ]
      ),

      ("walled_center_manage",
      [
        (neg|party_slot_eq, "$current_town", 35, 5),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (assign, reg0, 1),
        (try_begin),
          (party_slot_eq, "$current_town", 0, 2),
          (assign, reg0, 0),
        (try_end),
      ],
      "Manage_this_{reg0?town:castle}.",
      [
        (assign, "$g_next_menu", "mnu_town"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("walled_center_train_steward",
      [
        (neg|party_slot_eq, "$current_town", 35, 5),
        (party_slot_eq, "$current_town", 295, 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (assign, reg0, 1),
        (try_begin),
          (party_slot_eq, "$current_town", 0, 2),
          (assign, reg0, 0),
        (try_end),
      ],
      "Train_your_{reg0?town:castle}_steward.",
      [
        (assign, "$g_next_menu", "mnu_town"),
        (jump_to_menu, "mnu_steward_training"),
      ]
      ),

      ("walled_center_move_court",
      [
        (neg|party_slot_eq, "$current_town", 35, 5),
        (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (neq, "$g_player_court", "$current_town"),
      ],
      "Move_your_court_here.",
      [
        (jump_to_menu, "mnu_establish_court"),
      ]
      ),

      ("castle_station_troops",
      [
        (neg|check_quest_active, "qst_order_challenge"),
        (party_get_slot, ":var0", "$current_town", 7),
        (str_clear, s10),
        (assign, ":var1", 0),
        (assign, "$temp_3", 0),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (assign, ":var1", 1),
        (else_try),
          (store_faction_of_party, ":var2", "$g_encountered_party"),
          (eq, ":var2", "fac_player_supporters_faction"),
          (neg|party_slot_ge, "$g_encountered_party", 7, "trp_npc_adonja"),
          (assign, ":var1", 1),
          (assign, "$temp_3", 1),
        (else_try),
          (lt, ":var0", 0),
          (store_faction_of_party, ":var3", "$g_encountered_party"),
          (eq, "$players_kingdom", ":var3"),
          (eq, "$g_encountered_party", "$g_castle_requested_by_player"),
          (str_store_string, s10, "str_retrieve_garrison_warning"),
          (assign, ":var1", 1),
        (else_try),
          (lt, ":var0", 0),
          (store_faction_of_party, ":var3", "$g_encountered_party"),
          (eq, "$players_kingdom", ":var3"),
          (store_party_size_wo_prisoners, ":var4", "$g_encountered_party"),
          (eq, ":var4", 0),
          (str_store_string, s10, "str_retrieve_garrison_warning"),
          (assign, ":var1", 1),
        (else_try),
          (party_slot_ge, "$g_encountered_party", 7, "trp_npc_adonja"),
          (store_faction_of_party, ":var3", "$g_encountered_party"),
          (eq, "$players_kingdom", ":var3"),
          (troop_slot_eq, "trp_player", 30, ":var0"),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Manage_the_garrison._{s10}",
      [
        (troop_set_slot, "trp_quick_battle_6_player", 406, 12),
        (try_begin),
          (eq, "$temp_3", 1),
          (change_screen_give_members, "$g_encountered_party"),
        (else_try),
          (change_screen_exchange_members, 1),
        (try_end),
      ]
      ),

      ("castle_wait",
      [
        (this_or_next|ge, "$g_encountered_party_relation", 0),
        (eq, "$castle_undefended", 1),
        (assign, ":var0", 1),
        (str_clear, s1),
        (try_begin),
          (neg|party_slot_eq, "$current_town", 7, "trp_player"),
          (troop_get_slot, ":var1", "trp_player", 30),
          (neg|party_slot_eq, "$current_town", 7, ":var1"),
          (party_slot_ge, "$current_town", 7, "trp_player"),
          (store_faction_of_party, ":var2", "$current_town"),
          (neq, ":var2", "fac_player_supporters_faction"),
          (party_get_num_companions, ":var3", "p_main_party"),
          (store_div, reg1, ":var3", 4),
          (val_add, reg1, 1),
          (str_store_string, s1, "@ ({reg1} denars per night)"),
          (store_troop_gold, ":var4", "trp_player"),
          (lt, ":var4", reg1),
          (assign, ":var0", 0),
        (try_end),
        (eq, ":var0", 1),
      ],
      "Wait_here_for_some_time{s1}.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (try_begin),
          (party_is_active, "p_main_party"),
          (party_get_current_terrain, ":var0", "p_main_party"),
          (try_begin),
            (eq, ":var0", 5),
            (372, 28),
          (try_end),
        (try_end),
        (rest_for_hours_interactive, 168, 5, 0),
        (change_screen_return),
      ]
      ),

      ("town_alley",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT:_Go_to_the_alley.",
      [
        (party_get_slot, reg11, "$current_town", 17),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, reg11),
        (change_screen_mission),
      ]
      ),

      ("collect_taxes_qst",
      [
        (check_quest_active, "qst_collect_taxes"),
        (quest_slot_eq, "qst_collect_taxes", 1, "$current_town"),
        (neg|quest_slot_eq, "qst_collect_taxes", 11, 4),
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (str_store_troop_name, s1, ":var0"),
        (quest_get_slot, reg5, "qst_collect_taxes", 11),
      ],
      "{reg5?Continue_collecting_taxes:Collect_taxes}_due_to_{s1}.",
      [
        (jump_to_menu, "mnu_collect_taxes"),
      ]
      ),

      ("town_leave",
      [],
      "Leave.",
      [
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
      ]
,
      "Leave_Area."
      ),

      ("castle_cheat_interior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Interior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 11),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_town_exterior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Exterior.",
      [
        (try_begin),
          (party_slot_eq, "$current_town", 0, 2),
          (party_get_slot, ":var0", "$current_town", 10),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 10),
        (try_end),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_dungeon",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Prison.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 12),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_town_walls",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "{!}CHEAT!_Town_Walls.",
      [
        (party_get_slot, ":var0", "$current_town", 18),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("cheat_town_start_siege",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$g_encountered_party", 54, -1),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),
      ],
      "{!}CHEAT:_Besiege_the_{reg6?town:castle}...",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("center_reports",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT!_Show_reports.",
      [
        (jump_to_menu, "mnu_center_reports"),
      ]
      ),

      ("sail_from_port",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT:_Sail_from_port.",
      [
        (assign, "$g_player_icon_state", 2),
        (party_set_flags, "p_main_party", 512, 1),
        (party_get_position, pos1, "p_main_party"),
        (map_get_water_position_around_position, pos2, pos1, 6),
        (party_set_position, "p_main_party", pos2),
        (assign, "$g_main_ship_party", -1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("cannot_enter_court", mnf_scale_picture,
    "There is a feast in progress in the lord's hall, but you are not of sufficient status to be invited inside. Perhaps increasing your renown would win you admittance -- or you might also try distinguishing yourself at a tournament while the feast is in progress...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_refusedcourt"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("lady_visit", mnf_scale_picture,
    "Whom do you wish to visit?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_visit_love"),
    ],
    [
      ("visit_lady_1",
      [
        (gt, "$love_interest_in_town", 0),
        (str_store_troop_name, s12, "$love_interest_in_town"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_2",
      [
        (gt, "$love_interest_in_town_2", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_2"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_2"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_3",
      [
        (gt, "$love_interest_in_town_3", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_3"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_3"),
        (jump_to_menu, "mnu_garden"),
      ]
,
      "Door_to_the_garden"
      ),

      ("visit_lady_4",
      [
        (gt, "$love_interest_in_town_4", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_4"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_4"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_5",
      [
        (gt, "$love_interest_in_town_5", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_5"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_5"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_6",
      [
        (gt, "$love_interest_in_town_6", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_6"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_6"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_7",
      [
        (gt, "$love_interest_in_town_7", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_7"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_7"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("visit_lady_8",
      [
        (gt, "$love_interest_in_town_8", 0),
        (str_store_troop_name, s12, "$love_interest_in_town_8"),
      ],
      "Visit_{s12}",
      [
        (assign, "$love_interest_in_town", "$love_interest_in_town_8"),
        (jump_to_menu, "mnu_garden"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("town_tournament_lost", mnf_scale_picture,
    "You have been eliminated from the tournament.{s8}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_lost"),
      (str_clear, s8),
      (try_begin),
        (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
        (neg|troop_slot_ge, "trp_player", 7, 50),
        (neg|troop_slot_ge, "trp_player", 7, 125),
        (gt, "$g_player_tournament_placement", 4),
        (faction_slot_eq, "$g_encountered_party_faction", 4, 6),
        (faction_slot_eq, "$g_encountered_party_faction", 5, "$g_encountered_party"),
        (str_store_string, s8, "str__however_you_have_sufficiently_distinguished_yourself_to_be_invited_to_attend_the_ongoing_feast_in_the_lords_castle"),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_order_tournament"),
        (quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
        (quest_get_slot, ":var0", "qst_order_tournament", 6),
        (store_troop_faction, ":var1", ":var0"),
        (str_store_faction_name, s9, ":var1"),
        (str_store_string, s8, "@{s8}^Your bid to champion the {s9} ends in failure."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town_tournament_won_by_another"),
      ]
      ),
    ],
  ),

  ("town_tournament_won", mnf_disable_all_keys|mnf_scale_picture,
    "You have won the tournament of {s3}! You are filled with pride as the crowd cheers your name. In addition to honor, fame and glory, you earn a prize of {reg9} denars. {s8}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_won"),
      (str_store_party_name, s3, "$current_town"),
      (call_script, "script_change_troop_renown", "trp_player", 20),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (val_add, "$g_tournaments_won", 1),
      (try_begin),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      (else_try),
        (party_get_slot, ":var0", "$current_town", 50),
        (val_add, ":var0", 10),
        (party_set_slot, "$current_town", 50, ":var0"),
      (try_end),
      (str_clear, s8),
      (assign, reg9, 2000),
      (add_xp_to_troop, 250, "trp_player"),
      (try_begin),
        (check_quest_active, "qst_order_tournament"),
        (quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
        (quest_get_slot, ":var1", "qst_order_tournament", 6),
        (store_troop_faction, ":var2", ":var1"),
        (str_store_faction_name, s9, ":var2"),
        (str_store_string, s8, "@However, you forfeit all material rewards and dedicate your victory to the glory of the {s9}!"),
      (else_try),
        (troop_add_gold, "trp_player", reg9),
      (try_end),
      (try_begin),
        (eq, "$current_town", "p_castle_noldor"),
        (val_add, "$noldor_tournaments_won", 1),
        (assign, ":var3", -1),
        (assign, ":var4", -1),
        (assign, ":var5", -1),
        (assign, ":var6", 0),
        (assign, ":var7", 0),
        (assign, ":var8", 0),
        (try_begin),
          (lt, "$event_rand_2a", 20),
          (assign, ":var3", "itm_qualis"),
          (str_store_item_name, s21, ":var3"),
        (else_try),
          (lt, "$event_rand_2a", 40),
          (try_begin),
            (lt, "$event_rand_2b", 25),
            (assign, ":var3", "itm_noldor_longsword"),
          (else_try),
            (lt, "$event_rand_2b", 50),
            (assign, ":var3", "itm_noldor_runesword"),
          (else_try),
            (lt, "$event_rand_2b", 70),
            (assign, ":var3", "itm_noldor_bastard"),
          (else_try),
            (assign, ":var3", "itm_noldor_bow"),
          (try_end),
          (try_begin),
            (lt, "$event_rand_2b", 70),
            (try_begin),
              (lt, "$event_rand_2c", 35),
              (assign, ":var6", 10),
            (else_try),
              (lt, "$event_rand_2c", 60),
              (assign, ":var6", 13),
            (else_try),
              (lt, "$event_rand_2c", 85),
              (assign, ":var6", 14),
            (else_try),
              (assign, ":var6", 17),
            (try_end),
            (try_begin),
              (lt, "$event_rand_2a", 27),
              (assign, ":var4", "itm_noldor_inf_shield"),
            (else_try),
              (lt, "$event_rand_2a", 35),
              (assign, ":var4", "itm_noldor_noble_shield"),
            (else_try),
              (assign, ":var4", "itm_noldor_ench_shield"),
            (try_end),
            (store_add, ":var9", "$event_rand_2b", "$event_rand_2c"),
            (val_div, ":var9", 2),
            (try_begin),
              (lt, ":var9", 51),
              (assign, ":var7", 25),
            (else_try),
              (assign, ":var7", 27),
            (try_end),
          (else_try),
            (try_begin),
              (lt, "$event_rand_2b", 81),
              (assign, ":var6", 10),
            (else_try),
              (lt, "$event_rand_2b", 94),
              (assign, ":var6", 19),
            (else_try),
              (assign, ":var6", 17),
            (try_end),
            (assign, ":var4", "itm_noldor_arrows"),
            (try_begin),
              (lt, "$event_rand_2a", 34),
              (assign, ":var7", 42),
            (try_end),
          (try_end),
          (str_store_string, s21, "@weapon pack"),
        (else_try),
          (lt, "$event_rand_2a", 65),
          (try_begin),
            (lt, "$event_rand_2b", 7),
            (assign, ":var3", "itm_noldor_archer_garb"),
          (else_try),
            (lt, "$event_rand_2b", 14),
            (assign, ":var3", "itm_noldor_archer_garb_cape"),
          (else_try),
            (lt, "$event_rand_2b", 24),
            (assign, ":var3", "itm_noldor_ranger_garb"),
          (else_try),
            (lt, "$event_rand_2b", 34),
            (assign, ":var3", "itm_noldor_ranger_garb_cape"),
          (else_try),
            (lt, "$event_rand_2b", 47),
            (assign, ":var3", "itm_noldor_female_armor"),
          (else_try),
            (lt, "$event_rand_2b", 60),
            (assign, ":var3", "itm_noldor_female_armor_cape"),
          (else_try),
            (lt, "$event_rand_2b", 75),
            (assign, ":var3", "itm_noldor_rune_armor"),
          (else_try),
            (lt, "$event_rand_2b", 90),
            (assign, ":var3", "itm_noldor_noble_armor"),
          (else_try),
            (assign, ":var3", "itm_noldor_ancient_plate"),
          (try_end),
          (try_begin),
            (lt, "$event_rand_2b", 60),
            (try_begin),
              (lt, "$event_rand_2c", 35),
              (assign, ":var6", 24),
            (else_try),
              (lt, "$event_rand_2c", 80),
              (assign, ":var6", 25),
            (else_try),
              (assign, ":var6", 26),
            (try_end),
          (else_try),
            (try_begin),
              (lt, "$event_rand_2c", 45),
              (assign, ":var6", 25),
            (else_try),
              (lt, "$event_rand_2c", 80),
              (assign, ":var6", 27),
            (else_try),
              (assign, ":var6", 29),
            (try_end),
          (try_end),
          (str_store_item_name, s21, ":var3"),
        (else_try),
          (lt, "$event_rand_2a", 80),
          (try_begin),
            (lt, "$event_rand_2b", 30),
            (assign, ":var3", "itm_noldor_inf_helm"),
          (else_try),
            (lt, "$event_rand_2b", 75),
            (assign, ":var3", "itm_noldor_capt_helm"),
          (else_try),
            (assign, ":var3", "itm_noldor_knight_helm"),
          (try_end),
          (try_begin),
            (lt, "$event_rand_2c", 50),
            (assign, ":var6", 25),
          (else_try),
            (lt, "$event_rand_2c", 85),
            (assign, ":var6", 27),
          (else_try),
            (assign, ":var6", 29),
          (try_end),
          (try_begin),
            (lt, "$event_rand_2a", 75),
            (assign, ":var4", "itm_noldor_leather_gloves"),
          (else_try),
            (assign, ":var4", "itm_noldor_silver_gauntlets"),
          (try_end),
          (store_add, ":var9", "$event_rand_2b", "$event_rand_2c"),
          (val_div, ":var9", 2),
          (try_begin),
            (lt, "$event_rand_2a", 75),
            (try_begin),
              (lt, ":var9", 50),
              (assign, ":var7", 24),
            (else_try),
              (lt, ":var9", 85),
              (assign, ":var7", 25),
            (else_try),
              (assign, ":var7", 26),
            (try_end),
          (else_try),
            (try_begin),
              (lt, ":var9", 50),
              (assign, ":var7", 25),
            (else_try),
              (lt, ":var9", 85),
              (assign, ":var7", 27),
            (else_try),
              (assign, ":var7", 29),
            (try_end),
          (try_end),
          (store_add, ":var10", "$event_rand_2a", "$event_rand_2b"),
          (val_div, ":var10", 2),
          (try_begin),
            (lt, ":var9", 49),
            (assign, ":var5", "itm_noldor_plate_greaves"),
          (else_try),
            (assign, ":var5", "itm_noldor_boots"),
          (try_end),
          (store_add, ":var11", "$event_rand_2b", "$event_rand_2c"),
          (val_add, ":var11", "$event_rand_2a"),
          (val_div, ":var11", 3),
          (try_begin),
            (lt, ":var9", 49),
            (try_begin),
              (lt, ":var11", 51),
              (assign, ":var8", 25),
            (else_try),
              (lt, ":var11", 79),
              (assign, ":var8", 27),
            (else_try),
              (assign, ":var8", 29),
            (try_end),
          (else_try),
            (try_begin),
              (lt, ":var11", 51),
              (assign, ":var8", 24),
            (else_try),
              (lt, ":var11", 79),
              (assign, ":var8", 25),
            (else_try),
              (assign, ":var8", 26),
            (try_end),
          (try_end),
          (str_store_string, s21, "@armor pieces"),
        (else_try),
          (try_begin),
            (lt, "$event_rand_2b", 25),
            (assign, ":var3", "itm_noldor_grey_horse"),
          (else_try),
            (lt, "$event_rand_2b", 50),
            (assign, ":var3", "itm_noldor_dark_horse"),
          (else_try),
            (lt, "$event_rand_2b", 80),
            (assign, ":var3", "itm_noldor_gold_horse"),
          (else_try),
            (assign, ":var3", "itm_noldor_spirit_horse"),
          (try_end),
          (try_begin),
            (lt, "$event_rand_2c", 25),
            (assign, ":var6", 32),
          (else_try),
            (lt, "$event_rand_2c", 65),
            (assign, ":var6", 18),
          (else_try),
            (lt, "$event_rand_2c", 85),
            (assign, ":var6", 35),
          (else_try),
            (assign, ":var6", 36),
          (try_end),
          (str_store_item_name, s21, ":var3"),
        (try_end),
        (troop_add_item, "trp_player", ":var3", ":var6"),
        (try_begin),
          (neq, ":var4", -1),
          (troop_add_item, "trp_player", ":var4", ":var7"),
          (try_begin),
            (neq, ":var5", -1),
            (troop_add_item, "trp_player", ":var5", ":var8"),
          (try_end),
        (try_end),
        (str_store_string, s8, "@Additionally, you have been presented with beautiful {s21} from the Noldor Council."),
        (call_script, "script_update_event_rand", 2),
      (else_try),
        (store_random_in_range, ":var12", 0, 100),
        (neg|this_or_next|check_quest_active, "qst_order_tournament"),
        (neg|quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
        (lt, ":var12", 10),
        (store_random_in_range, ":var13", 1, 80),
        (try_begin),
          (lt, ":var13", 15),
          (store_random_in_range, ":var14", "itm_lamellar_vest", "itm_dawn_plate"),
        (else_try),
          (lt, ":var13", 30),
          (store_random_in_range, ":var14", "itm_breastplate_on_red", "itm_ranger_plate"),
        (else_try),
          (lt, ":var13", 45),
          (store_random_in_range, ":var14", "itm_mail_coat_red", "itm_heraldic_surcoat_over_mail_04_for_tableau"),
        (else_try),
          (lt, ":var13", 60),
          (store_random_in_range, ":var14", "itm_surcoat_over_mail_01", "itm_surcoat_over_mail_20"),
        (else_try),
          (lt, ":var13", 75),
          (store_random_in_range, ":var14", "itm_nemean_helm", "itm_immortal_helmet"),
        (else_try),
          (store_random_in_range, ":var14", "itm_rav_bascinet", "itm_eventide_helm_cape"),
        (try_end),
        (troop_add_item, "trp_player", ":var14"),
        (str_store_item_name, s21, ":var14"),
        (str_store_string, s8, "@Additionally, you have been presented with one {s21} from the town Steward."),
      (try_end),
      (store_add, ":var15", "$g_tournament_bet_placed", "$g_tournament_bet_win_amount"),
      (try_begin),
        (gt, "$g_tournament_bet_win_amount", 0),
        (assign, reg8, ":var15"),
        (str_store_string, s8, "@ {s8}^Moreover, you earn {reg8} denars from the clever bets you placed on yourself..."),
      (try_end),
      (try_begin),
        (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
        (neg|troop_slot_ge, "trp_player", 7, 70),
        (neg|troop_slot_ge, "trp_player", 7, 145),
        (faction_slot_eq, "$g_encountered_party_faction", 4, 6),
        (faction_slot_eq, "$g_encountered_party_faction", 5, "$g_encountered_party"),
        (str_store_string, s8, "str_s8_you_are_also_invited_to_attend_the_ongoing_feast_in_the_castle"),
      (try_end),
      (troop_add_gold, "trp_player", ":var15"),
      (assign, ":var16", 0),
      (store_div, ":var16", "$g_tournament_bet_win_amount", 5),
      (party_get_slot, ":var17", "$current_town", 51),
      (val_sub, ":var17", ":var16"),
      (val_max, ":var17", 250),
      (party_set_slot, "$current_town", 51, ":var17"),
      (call_script, "script_play_victorious_sound"),
      (372, 33),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (eq, "$current_town", "p_castle_noldor"),
          (jump_to_menu, "mnu_noldor_castle"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("town_tournament_won_by_another", mnf_disable_all_keys|mnf_scale_picture,
    "As the only {reg3?fighter:man} to remain undefeated this day, {s1} wins the lists and the glory of this tournament.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_withdraw"),
      (call_script, "script_get_num_tournament_participants"),
      (store_sub, ":var0", reg0, 1),
      (try_begin),
        (troop_slot_eq, "trp_tournament_participants", 0, 0),
        (troop_set_slot, "trp_tournament_participants", 0, -1),
        (val_sub, ":var0", 1),
      (try_end),
      (call_script, "script_remove_tournament_participants_randomly", ":var0"),
      (call_script, "script_sort_tournament_participant_troops"),
      (troop_get_slot, ":var1", "trp_tournament_participants", 0),
      (str_store_troop_name, s1, ":var1"),
      (try_begin),
        (troop_is_hero, ":var1"),
        (call_script, "script_change_troop_renown", ":var1", 20),
      (try_end),
      (troop_get_type, reg3, ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (eq, "$current_town", "p_castle_noldor"),
          (jump_to_menu, "mnu_noldor_castle"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("town_tournament", mnf_disable_all_keys|mnf_scale_picture,
    "{s1}You are at tier {reg0} of the tournament, with {reg1} participants remaining. In the next round, there will be {reg2} teams with {reg3} {reg4?fighters:fighter} each.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament"),
      (party_set_slot, "$current_town", 156, 0),
      (call_script, "script_sort_tournament_participant_troops"),
      (call_script, "script_get_num_tournament_participants"),
      (assign, ":var0", reg0),
      (try_begin),
        (neg|troop_slot_eq, "trp_tournament_participants", 0, 0),
        (assign, ":var1", 0),
        (store_div, ":var1", "$g_tournament_bet_placed", 5),
        (party_get_slot, ":var2", "$current_town", 51),
        (val_add, ":var2", ":var1"),
        (val_min, ":var2", 4000),
        (party_set_slot, "$current_town", 51, ":var2"),
        (try_begin),
          (check_quest_active, "qst_order_tournament"),
          (quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
          (call_script, "script_fail_quest", "qst_order_tournament"),
        (try_end),
        (jump_to_menu, "mnu_town_tournament_lost"),
      (else_try),
        (eq, ":var0", 1),
        (try_begin),
          (check_quest_active, "qst_order_tournament"),
          (quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
          (call_script, "script_succeed_quest", "qst_order_tournament"),
        (try_end),
        (jump_to_menu, "mnu_town_tournament_won"),
      (else_try),
        (try_begin),
          (le, "$g_tournament_next_num_teams", 0),
          (call_script, "script_get_random_tournament_team_amount_and_size"),
          (assign, "$g_tournament_next_num_teams", reg0),
          (assign, "$g_tournament_next_team_size", reg1),
        (try_end),
        (assign, reg2, "$g_tournament_next_num_teams"),
        (assign, reg3, "$g_tournament_next_team_size"),
        (store_sub, reg4, reg3, 1),
        (str_clear, s1),
        (try_begin),
          (eq, "$g_tournament_player_team_won", 1),
          (str_store_string, s1, "@Victory is yours! You have won this melee, but now you must prepare yourself for the next round. "),
        (else_try),
          (eq, "$g_tournament_player_team_won", 0),
          (str_store_string, s1, "@You have been bested in this melee, but the master of ceremonies declares a recognition of your skill and bravery, allowing you to take part in the next round. "),
        (try_end),
        (assign, reg1, ":var0"),
        (store_add, reg0, "$g_tournament_cur_tier", 1),
      (try_end),
    ],
    [
      ("tournament_bet",
      [
        (neq, "$g_tournament_cur_tier", "$g_tournament_last_bet_tier"),
        (neg|this_or_next|check_quest_active, "qst_order_tournament"),
        (neg|quest_slot_eq, "qst_order_tournament", 1, "$current_town"),
      ],
      "Place_a_bet_on_yourself.",
      [
        (jump_to_menu, "mnu_tournament_bet"),
      ]
      ),

      ("tournament_join_next_fight",
      [],
      "Fight_in_the_next_round.",
      [
        (party_get_slot, ":var0", "$current_town", 16),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (assign, "$g_player_tournament_placement", "$g_tournament_cur_tier"),
        (try_begin),
          (gt, "$g_player_tournament_placement", 4),
          (assign, "$g_player_eligible_feast_center_no", "$current_town"),
        (try_end),
        (val_add, "$g_tournament_cur_tier", 1),
        (store_mul, "$g_tournament_num_participants_for_fight", "$g_tournament_next_num_teams", "$g_tournament_next_team_size"),
        (troop_set_slot, "trp_tournament_participants", 0, -1),
        (troop_set_slot, "trp_temp_array_a", 0, "trp_player"),
        (try_for_range, ":var1", 1, "$g_tournament_num_participants_for_fight"),
          (call_script, "script_get_random_tournament_participant"),
          (troop_set_slot, "trp_temp_array_a", ":var1", reg0),
        (try_end),
        (call_script, "script_shuffle_troop_slots", "trp_temp_array_a", 0, "$g_tournament_num_participants_for_fight"),
        (try_for_range, ":var1", 0, 4),
          (troop_set_slot, "trp_temp_array_b", ":var1", ":var1"),
        (try_end),
        (call_script, "script_shuffle_troop_slots", "trp_temp_array_b", 0, 4),
        (assign, ":var2", 0),
        (try_for_range, ":var3", 0, "$g_tournament_next_num_teams"),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var3"),
          (try_for_range, ":var1", 0, 8),
            (troop_set_slot, "trp_temp_array_c", ":var1", ":var1"),
          (try_end),
          (call_script, "script_shuffle_troop_slots", "trp_temp_array_c", 0, 8),
          (try_for_range, ":var5", 0, "$g_tournament_next_team_size"),
            (store_mul, ":var6", ":var4", 8),
            (troop_get_slot, ":var7", "trp_temp_array_c", ":var5"),
            (val_add, ":var6", ":var7"),
            (troop_get_slot, ":var8", "trp_temp_array_a", ":var2"),
            (set_visitor, ":var6", ":var8"),
            (val_add, ":var2", 1),
          (try_end),
        (try_end),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (assign, "$g_mt_mode", 3),
        (party_get_slot, ":var9", "$current_town", 61),
        (assign, ":var10", 0),
        (assign, ":var11", "p_castle_1"),
        (try_for_range, ":var12", "p_town_1", ":var11"),
          (try_begin),
            (eq, ":var12", "$current_town"),
            (assign, ":var11", 0),
          (else_try),
            (party_slot_eq, ":var12", 61, ":var9"),
            (val_add, ":var10", 1),
          (try_end),
        (try_end),
        (set_jump_mission, "mt_arena_melee_fight"),
        (try_begin),
          (eq, ":var9", "fac_kingdom_1"),
          (store_mod, ":var13", ":var10", 4),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 100, 0, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 100, 0, 100, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 3),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 40, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_2"),
          (store_mod, ":var13", ":var10", 4),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_rav_helmet_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 50, 0, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_rav_helmet_red"),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 100, 0, 50, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_rav_helmet_red"),
          (else_try),
            (eq, ":var13", 3),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 30, 0, 60, 0, "itm_arena_armor_red", "itm_rav_helmet_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_3"),
          (store_mod, ":var13", ":var10", 2),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 100, 0, 0, 0, 0, 40, 60, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 50, 25, 0, 0, 30, 50, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_4"),
          (store_mod, ":var13", ":var10", 3),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 0, 0, 0, 0, "itm_arena_armor_red", -1),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 0, 0, 0, 50, "itm_arena_armor_red", -1),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 40, 0, 0, 100, 0, 0, 0, 0, "itm_arena_armor_red", -1),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_5"),
          (call_script, "script_set_items_for_tournament", 25, 100, 60, 0, 0, 50, 0, 50, "itm_arena_tunic_red", "itm_empire_helmet_red"),
        (else_try),
          (eq, ":var9", "fac_noldor_castle"),
          (call_script, "script_set_items_for_tournament", 25, 0, 50, 0, 70, 0, 30, 0, "itm_arena_tunic_red", "itm_arena_helmet_red"),
        (try_end),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("tournament_view_participants",
      [],
      "View_participants.",
      [
        (jump_to_menu, "mnu_tournament_participants"),
      ]
      ),

      ("leave_tournament",
      [],
      "Withdraw_from_the_tournament.",
      [
        (jump_to_menu, "mnu_tournament_withdraw_verify"),
      ]
      ),
    ],
  ),

  ("tournament_withdraw_verify", mnf_scale_picture,
    "Are you sure you want to withdraw from the tournament?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_withdraw"),
    ],
    [
      ("tournament_withdraw_yes",
      [],
      "Yes._This_is_a_pointless_affectation.",
      [
        (jump_to_menu, "mnu_town_tournament_won_by_another"),
      ]
      ),

      ("tournament_withdraw_no",
      [],
      "No,_not_as_long_as_there_is_a_chance_of_victory!",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("tournament_bet", mnf_scale_picture,
    "The odds against you are {reg5} to {reg6}.{reg1? You have already bet {reg1} denars on yourself, and if you win, you will earn {reg2} denars.:} How much do you want to bet?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_bet"),
      (assign, reg1, "$g_tournament_bet_placed"),
      (store_add, reg2, "$g_tournament_bet_win_amount", "$g_tournament_bet_placed"),
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":var0", reg0),
      (assign, ":var1", 100000),
      (assign, ":var2", 1),
      (assign, ":var3", 1),
      (try_for_range, ":var4", 1, 50),
        (try_for_range, ":var5", 1, 50),
          (store_mul, ":var6", 100, ":var4"),
          (val_div, ":var6", ":var5"),
          (store_sub, ":var7", ":var0", ":var6"),
          (val_abs, ":var7"),
          (lt, ":var7", ":var1"),
          (assign, ":var1", ":var7"),
          (assign, ":var2", ":var5"),
          (assign, ":var3", ":var4"),
        (try_end),
      (try_end),
      (assign, reg5, ":var3"),
      (assign, reg6, ":var2"),
    ],
    [
      ("bet_500_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 500),
      ],
      "500_denars.",
      [
        (assign, "$temp", 500),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_250_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 250),
      ],
      "250_denars.",
      [
        (assign, "$temp", 250),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_100_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 100),
      ],
      "100_denars.",
      [
        (assign, "$temp", 100),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_50_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 50),
      ],
      "50_denars.",
      [
        (assign, "$temp", 50),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_25_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 25),
      ],
      "25_denars.",
      [
        (assign, "$temp", 25),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("tournament_bet_confirm", mnf_scale_picture,
    "If you bet {reg1} denars, you will earn {reg2} denars if you win the tournament. Is that all right?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_bet"),
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":var0", reg0),
      (val_mul, ":var0", "$temp"),
      (val_div, ":var0", 100),
      (assign, reg1, "$temp"),
      (assign, reg2, ":var0"),
    ],
    [
      ("tournament_bet_accept",
      [],
      "Go_ahead.",
      [
        (call_script, "script_tournament_place_bet", "$temp"),
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),

      ("tournament_bet_cancel",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_tournament_bet"),
      ]
      ),
    ],
  ),

  ("tournament_participants", mnf_scale_picture,
    "You ask one of the criers for the names of the tournament participants. They are:^{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_tournament_participants"),
      (str_clear, s11),
      (call_script, "script_sort_tournament_participant_troops"),
      (call_script, "script_get_num_tournament_participants"),
      (assign, ":var0", reg0),
      (try_for_range, ":var1", 0, ":var0"),
        (troop_get_slot, ":var2", "trp_tournament_participants", ":var1"),
        (str_store_troop_name, s12, ":var2"),
        (str_store_string, s11, "@{!}{s11}^{s12}"),
      (try_end),
    ],
    [
      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("collect_taxes", mnf_disable_all_keys|mnf_scale_picture,
    "As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} that collecting taxes from here will take {reg4} days...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
      (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
      (assign, ":var0", reg0),
      (assign, reg2, reg0),
      (assign, ":var1", reg1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (assign, ":var2", 3000),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (assign, ":var2", 6000),
      (try_end),
      (try_begin),
        (quest_slot_eq, "qst_collect_taxes", 11, 0),
        (store_add, ":var3", ":var0", 30),
        (try_begin),
          (party_slot_eq, "$current_town", 0, 3),
          (store_div, "$qst_collect_taxes_total_hours", 5040, ":var3"),
        (else_try),
          (store_div, "$qst_collect_taxes_total_hours", 2160, ":var3"),
        (try_end),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (val_add, reg0, 20),
        (val_mul, "$qst_collect_taxes_total_hours", 20),
        (val_div, "$qst_collect_taxes_total_hours", reg0),
        (quest_set_slot, "qst_collect_taxes", 10, "$qst_collect_taxes_total_hours"),
        (store_div, ":var4", "$qst_collect_taxes_total_hours", 20),
        (store_div, ":var5", "$qst_collect_taxes_total_hours", 4),
        (assign, ":var6", ":var5"),
        (store_mul, ":var7", "$qst_collect_taxes_total_hours", 3),
        (val_div, ":var7", 4),
        (val_mul, ":var2", 2),
        (store_div, "$qst_collect_taxes_hourly_income", ":var2", "$qst_collect_taxes_total_hours"),
        (store_random_in_range, "$qst_collect_taxes_menu_counter", ":var4", ":var5"),
        (store_random_in_range, "$qst_collect_taxes_unrest_counter", ":var6", ":var7"),
        (assign, "$qst_collect_taxes_halve_taxes", 0),
      (try_end),
      (quest_get_slot, ":var8", "qst_collect_taxes", 10),
      (store_div, ":var9", ":var8", 24),
      (val_mul, ":var9", 24),
      (try_begin),
        (lt, ":var9", ":var8"),
        (val_add, ":var9", 24),
      (try_end),
      (val_div, ":var9", 24),
      (assign, reg4, ":var9"),
    ],
    [
      ("start_collecting",
      [],
      "Start_collecting.",
      [
        (assign, "$qst_collect_taxes_currently_collecting", 1),
        (try_begin),
          (quest_slot_eq, "qst_collect_taxes", 11, 0),
          (quest_set_slot, "qst_collect_taxes", 11, 1),
        (try_end),
        (rest_for_hours_interactive, 1000, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
      ]
      ),

      ("collect_later",
      [],
      "Put_it_off_until_later.",
      [
        (try_begin),
          (party_slot_eq, "$current_town", 0, 3),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),
      ]
      ),
    ],
  ),

  ("collect_taxes_complete", mnf_disable_all_keys|mnf_scale_picture,
    "You've collected {reg3} denars in taxes from {s3}. {s19} will be expecting you to take the money to him.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
      (str_store_party_name, s3, "$current_town"),
      (quest_get_slot, ":var0", "qst_collect_taxes", 6),
      (str_store_troop_name, s19, ":var0"),
      (quest_get_slot, reg3, "qst_collect_taxes", 22),
      (try_begin),
        (eq, "$qst_collect_taxes_halve_taxes", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (try_end),
      (call_script, "script_succeed_quest", "qst_collect_taxes"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("collect_taxes_rebels_killed", mnf_scale_picture,
    "Your quick action and strong arm have successfully put down the revolt. Surely, anyone with a mind to rebel against you will think better of it after this.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("collect_taxes_failed", mnf_disable_all_keys|mnf_scale_picture,
    "You could collect only {reg3} denars as tax from {s3} before the revolt broke out. {s1} won't be happy, but some silver will placate him better than nothing at all...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
      (str_store_party_name, s3, "$current_town"),
      (quest_get_slot, ":var0", "qst_collect_taxes", 6),
      (str_store_troop_name, s1, ":var0"),
      (quest_get_slot, reg3, "qst_collect_taxes", 22),
      (call_script, "script_fail_quest", "qst_collect_taxes"),
      (quest_set_slot, "qst_collect_taxes", 11, 4),
      (rest_for_hours, 0, 0, 0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("collect_taxes_revolt_warning", mnf_scale_picture,
    "The people of {s3} are outraged at your demands and decry it as nothing more than extortion. They're getting very restless, and they may react badly if you keep pressing them.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
      (str_store_party_name, s3, "$current_town"),
    ],
    [
      ("continue_collecting_taxes",
      [],
      "Ignore_them_and_continue.",
      [
        (change_screen_return),
      ]
      ),

      ("halve_taxes",
      [
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (str_store_troop_name, s1, ":var0"),
      ],
      "Agree_to_reduce_your_collection_by_half._({s1}_may_be_upset)",
      [
        (assign, "$qst_collect_taxes_halve_taxes", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("collect_taxes_revolt", mnf_scale_picture,
    "You are interrupted while collecting the taxes at {s3}. A large band of angry {reg9?peasants:townsmen} is marching nearer, shouting about the exorbitant taxes and waving torches and weapons. It looks like they aim to fight you!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_taxes"),
      (str_store_party_name, s3, "$current_town"),
      (assign, reg9, 0),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 4),
        (assign, reg9, 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_jump_mission, "mt_back_alley_revolt"),
        (quest_get_slot, ":var0", "qst_collect_taxes", 1),
        (try_begin),
          (party_slot_eq, ":var0", 0, 3),
          (party_get_slot, ":var1", ":var0", 17),
        (else_try),
          (party_get_slot, ":var1", ":var0", 10),
        (try_end),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (assign, ":var2", 6),
        (store_character_level, ":var3", "trp_player"),
        (val_div, ":var3", 5),
        (val_add, ":var2", ":var3"),
        (set_visitors, 1, "trp_tax_rebel", ":var2"),
        (jump_to_scene, ":var1"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits", mnf_scale_picture,
    "As the party member with the highest training skill ({reg2}), {reg3?you expect:{s1} expects} that getting some peasants ready for practice will take {reg4} hours.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_training"),
      (call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
      (assign, ":var0", reg0),
      (assign, reg2, reg0),
      (assign, ":var1", reg1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (store_sub, ":var2", 20, ":var0"),
      (val_mul, ":var2", 3),
      (val_div, ":var2", 5),
      (store_sub, reg4, ":var2", "$qst_train_peasants_against_bandits_num_hours_trained"),
    ],
    [
      ("make_preparation",
      [],
      "Train_them.",
      [
        (assign, "$qst_train_peasants_against_bandits_currently_training", 1),
        (rest_for_hours_interactive, 1000, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
      ]
      ),

      ("train_later",
      [],
      "Put_it_off_until_later.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_ready", mnf_scale_picture,
    "You put the peasants through the basics of soldiering, discipline and obedience. You think {reg0} of them {reg1?have:has} fully grasped the training and {reg1?are:is} ready for some practice.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_training"),
      (store_character_level, ":var0", "trp_player"),
      (val_div, ":var0", 10),
      (val_add, ":var0", 1),
      (quest_get_slot, ":var1", "qst_train_peasants_against_bandits", 10),
      (quest_get_slot, ":var2", "qst_train_peasants_against_bandits", 11),
      (val_sub, ":var1", ":var2"),
      (assign, ":var3", ":var0"),
      (val_min, ":var3", ":var1"),
      (val_add, ":var3", 1),
      (store_random_in_range, ":var4", 1, ":var3"),
      (assign, "$g_train_peasants_against_bandits_num_peasants", ":var4"),
      (assign, reg0, ":var4"),
      (store_sub, reg1, ":var4", 1),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", ":var4"),
    ],
    [
      ("peasant_start_practice",
      [],
      "Start_the_practice_fight.",
      [
        (set_jump_mission, "mt_village_training"),
        (quest_get_slot, ":var0", "qst_train_peasants_against_bandits", 1),
        (party_get_slot, ":var1", ":var0", 10),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitors, 1, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
        (set_jump_entry, 11),
        (jump_to_scene, ":var1"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_training_result"),
        (music_set_situation, 0),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_training_result", mnf_disable_all_keys|mnf_scale_picture,
    "{s0}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_village_training"),
      (assign, reg5, "$g_train_peasants_against_bandits_num_peasants"),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
      (try_begin),
        (eq, "$g_train_peasants_against_bandits_training_succeeded", 0),
        (str_store_string, s0, "@You were beaten. The peasants are heartened by their success, but the lesson you wanted to teach them probably didn't get through..."),
      (else_try),
        (str_store_string, s0, "@After beating your last opponent, you explain to the peasants how to better defend themselves against such an attack. Hopefully they'll take the experience on board and will be prepared next time."),
        (quest_get_slot, ":var0", "qst_train_peasants_against_bandits", 11),
        (val_add, ":var0", "$g_train_peasants_against_bandits_num_peasants"),
        (quest_set_slot, "qst_train_peasants_against_bandits", 11, ":var0"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (quest_get_slot, ":var0", "qst_train_peasants_against_bandits", 11),
          (quest_slot_eq, "qst_train_peasants_against_bandits", 10, ":var0"),
          (jump_to_menu, "mnu_train_peasants_against_bandits_attack"),
        (else_try),
          (change_screen_map),
        (try_end),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_attack", mnf_scale_picture,
    "As you get ready to continue the training, a sentry from the village runs up to you, shouting alarums. The bandits have been spotted on the horizon, riding hard for {s3}. The elder begs that you organize your newly-trained militia and face them.",
    "none",
    [
      (set_background_mesh, "mesh_pic_forest_bandits"),
      (str_store_party_name, s3, "$current_town"),
    ],
    [
      ("peasants_against_bandits_attack_resist",
      [],
      "Prepare_for_a_fight!",
      [
        (store_random_in_range, ":var0", 0, 3),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", "trp_bandit"),
        (else_try),
          (eq, ":var0", 1),
          (assign, ":var1", "trp_mountain_bandit"),
        (else_try),
          (assign, ":var1", "trp_forest_bandit"),
        (try_end),
        (party_get_slot, ":var2", "$g_encountered_party", 10),
        (modify_visitors_at_site, ":var2"),
        (reset_visitors),
        (store_character_level, ":var3", "trp_player"),
        (val_div, ":var3", 2),
        (store_add, ":var4", ":var3", 16),
        (store_add, ":var5", ":var4", 6),
        (store_random_in_range, ":var0", ":var4", ":var5"),
        (set_visitors, 0, ":var1", ":var0"),
        (store_character_level, ":var3", "trp_player"),
        (val_div, ":var3", 5),
        (set_visitors, 0, "trp_rogue_knight", ":var3"),
        (val_div, ":var0", 5),
        (store_add, "$battle_renown_value", ":var3", ":var0"),
        (assign, ":var6", ":var5"),
        (set_visitors, 2, "trp_trainee_peasant", ":var6"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission, "mt_village_attack_bandits"),
        (jump_to_scene, ":var2"),
        (assign, "$g_next_menu", "mnu_train_peasants_against_bandits_attack_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", 2),
        (change_screen_mission),
      ]
      ),
#COOP BEGIN Village train peasants against bandits#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_village_player_defend),

        (store_random_in_range, ":var0", 0, 3),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", "trp_bandit"),
        (else_try),
          (eq, ":var0", 1),
          (assign, ":var1", "trp_mountain_bandit"),
        (else_try),
          (assign, ":var1", "trp_forest_bandit"),
        (try_end),

        (store_character_level, ":var3", "trp_player"),
        (val_div, ":var3", 2),
        (store_add, ":var4", ":var3", 16),
        (store_add, ":var5", ":var4", 6),
        (store_random_in_range, ":var0", ":var4", ":var5"),
        (party_clear, "p_temp_wounded"), #use this party to temp make bandits
        (party_add_members, "p_temp_wounded", ":var1", ":var0"),

        (assign, "$coop_encountered_party", "p_temp_wounded"),
        (assign, "$g_ally_party", "$current_town"),

        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
       ]),	
	  
      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.", 
      [

        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (assign, "$g_next_menu", "mnu_train_peasants_against_bandits_attack_result"),
        (jump_to_menu, "mnu_battle_debrief"),

      ]),		  
#COOP END#################################################
      
    ],
  ),

  ("train_peasants_against_bandits_attack_result", mnf_disable_all_keys|mnf_scale_picture,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s9, "@The bandits are broken! Those few who remain alive and conscious run off with their tails between their legs, terrified of the peasants and their new champion."),
        (call_script, "script_succeed_quest", "qst_train_peasants_against_bandits"),
        (set_background_mesh, "mesh_pic_pendor_village_cleaned"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_success"),
      (else_try),
        (call_script, "script_fail_quest", "qst_train_peasants_against_bandits"),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits. Infuriated, they raze the village to the ground to punish the peasants, and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (call_script, "script_village_set_state", "$current_town", 2),
          (party_set_slot, "$current_town", 36, 0),
          (party_set_slot, "$current_town", 37, 0),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
          (call_script, "script_finish_quest_simple", "qst_train_peasants_against_bandits", 30),
        (try_end),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_success", mnf_disable_all_keys|mnf_scale_picture,
    "The bandits are broken! Those few who remain run off with their tails between their legs, terrified of the peasants and their new champion. The villagers have little left in the way of wealth after their ordeal, but they offer you all they can find to show their gratitude.",
    "none",
    [
      (party_clear, "p_temp_party"),
      (set_background_mesh, "mesh_pic_pendor_village_cleaned"),
      (call_script, "script_finish_quest_simple", "qst_train_peasants_against_bandits", 100),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
      (party_get_slot, ":var0", "$current_town", 25),
      (try_for_range, ":var1", 10, 106),
        (store_random_in_range, ":var2", 0, 100),
        (lt, ":var2", 50),
        (troop_set_inventory_slot, ":var0", ":var1", -1),
      (try_end),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
    ],
    [
      ("village_bandits_defeated_accept",
      [],
      "Take_it_as_your_just_due.",
      [
        (jump_to_menu, "mnu_auto_return_to_map"),
        (party_get_slot, ":var0", "$current_town", 25),
        (troop_sort_inventory, ":var0"),
        (change_screen_loot, ":var0"),
      ]
      ),

      ("village_bandits_defeated_cont",
      [],
      "Refuse,_stating_that_they_need_these_items_more_than_you_do.",
      [
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
        (call_script, "script_change_player_honor", 1),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("disembark", 0,
    "Do you wish to disembark?",
    "none",
    [],
    [
      ("disembark_yes",
      [],
      "Yes.",
      [
        (assign, "$g_player_icon_state", 0),
        (party_set_flags, "p_main_party", 512, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
        (try_begin),
          (le, "$g_main_ship_party", 0),
          (set_spawn_radius, 0),
          (spawn_around_party, "p_main_party", "pt_none"),
          (assign, "$g_main_ship_party", reg0),
          (party_set_flags, "$g_main_ship_party", 2115072, 1),
          (str_store_troop_name, s1, "trp_player"),
          (party_set_name, "$g_main_ship_party", "@{s1}'s Ship"),
          (party_set_icon, "$g_main_ship_party", "icon_ship"),
          (party_set_slot, "$g_main_ship_party", 0, 16),
        (try_end),
        (enable_party, "$g_main_ship_party"),
        (party_set_position, "$g_main_ship_party", pos0),
        (party_set_icon, "$g_main_ship_party", "icon_ship_on_land"),
        (assign, "$g_main_ship_party", -1),
        (change_screen_return),
      ]
      ),

      ("disembark_no",
      [],
      "No.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("ship_reembark", 0,
    "Do you wish to embark?",
    "none",
    [],
    [
      ("reembark_yes",
      [],
      "Yes.",
      [
        (assign, "$g_player_icon_state", 2),
        (party_set_flags, "p_main_party", 512, 1),
        (party_get_position, pos1, "p_main_party"),
        (map_get_water_position_around_position, pos2, pos1, 6),
        (party_set_position, "p_main_party", pos2),
        (assign, "$g_main_ship_party", "$g_encountered_party"),
        (disable_party, "$g_encountered_party"),
        (change_screen_return),
      ]
      ),

      ("reembark_no",
      [],
      "No.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("center_reports", mnf_scale_picture,
    "Town Name: {s1}^Econ: {reg7} Prosperity: {reg6}^Rent Income: {reg1} Tariff Income: {reg2}^Wealth: {reg4} Projected: {reg8}^Player weekly income: {reg9}[{reg10}]^Garrison wage: {reg5}^Food Stock: for {reg3} days",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_town_reports"),
      (party_get_slot, ":var0", "$g_encountered_party", 53),
      (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
      (assign, ":var1", reg0),
      (call_script, "script_calculate_weekly_party_wage", "$g_encountered_party"),
      (assign, reg5, reg0),
      (try_begin),
        (gt, ":var1", 0),
        (store_div, reg3, ":var0", ":var1"),
      (else_try),
        (assign, reg3, 9999),
      (try_end),
      (str_store_party_name, s1, "$g_encountered_party"),
      (party_get_slot, reg1, "$g_encountered_party", 47),
      (party_get_slot, reg2, "$g_encountered_party", 48),
      (party_get_slot, reg4, "$g_encountered_party", 49),
      (assign, ":var2", "$g_encountered_party"),
      (assign, ":var3", reg4),
      (party_get_slot, reg6, "$g_encountered_party", 50),
      (party_get_slot, reg7, "$g_encountered_party", 290),
      (assign, ":var4", reg7),
      (val_mul, ":var4", 4),
      (store_mul, ":var5", reg6, 14),
      (val_add, ":var5", 1000),
      (val_add, ":var5", ":var4"),
      (try_begin),
        (this_or_next|eq, ":var2", "p_town_1"),
        (this_or_next|eq, ":var2", "p_town_5"),
        (this_or_next|eq, ":var2", "p_town_6"),
        (this_or_next|eq, ":var2", "p_town_8"),
        (eq, ":var2", "p_town_10"),
        (val_mul, ":var5", 12),
        (val_div, ":var5", 10),
      (try_end),
      (val_add, ":var3", ":var5"),
      (val_sub, ":var3", reg5),
      (val_max, ":var3", 0),
      (assign, reg8, ":var3"),
      (assign, ":var6", 0),
      (party_get_slot, ":var7", ":var2", 290),
      (try_begin),
        (party_slot_eq, ":var2", 0, 4),
        (try_begin),
          (party_slot_eq, ":var2", 35, 0),
          (assign, ":var6", 600),
          (val_mul, ":var7", 4),
          (val_add, ":var6", ":var7"),
        (try_end),
      (else_try),
        (party_slot_eq, ":var2", 0, 2),
        (assign, ":var6", 600),
        (val_mul, ":var7", 6),
        (val_add, ":var6", ":var7"),
      (else_try),
        (party_slot_eq, ":var2", 0, 3),
        (assign, ":var6", 1200),
        (val_mul, ":var7", 3),
        (val_add, ":var6", ":var7"),
      (try_end),
      (party_get_slot, ":var8", ":var2", 50),
      (store_add, ":var9", 80, ":var8"),
      (val_mul, ":var6", ":var9"),
      (val_div, ":var6", 480),
      (val_mul, ":var6", 125),
      (val_div, ":var6", 100),
      (assign, reg9, ":var6"),
      (store_add, reg10, reg9, reg1),
      (val_add, reg10, reg2),
    ],
    [
      ("to_price_and_productions",
      [],
      "Show_prices_and_productions.",
      [
        (jump_to_menu, "mnu_price_and_production"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 4),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("price_and_production", mnf_scale_picture,
    "Productions are:^(Note: base/modified by raw materials/modified by materials plus prosperity)^{s1}^^Price factors are:^{s2}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_town_reports"),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1", "p_castle_1"),
        (call_script, "script_center_get_goods_availability", ":var2"),
        (val_add, ":var0", reg0),
      (try_end),
      (try_for_range, ":var2", "p_village_1", "p_salt_mine"),
        (call_script, "script_center_get_goods_availability", ":var2"),
        (val_add, ":var1", reg0),
      (try_end),
      (val_div, ":var1", 90),
      (val_div, ":var0", 18),
      (call_script, "script_center_get_goods_availability", "$g_encountered_party"),
      (assign, reg1, ":var0"),
      (assign, reg2, ":var1"),
      (try_begin),
        (str_store_string, s1, "str___hardship_index_reg0_avg_towns_reg1_avg_villages_reg2__"),
        (display_message, "@{!}DEBUG - {s1}"),
      (try_end),
      (try_for_range, ":var3", "itm_spice", "itm_baggage_train"),
        (neq, ":var3", "itm_pork"),
        (neq, ":var3", "itm_chicken"),
        (neq, ":var3", "itm_butter"),
        (neq, ":var3", "itm_cattle_meat"),
        (neq, ":var3", "itm_cabbages"),
        (call_script, "script_center_get_production", "$g_encountered_party", ":var3"),
        (assign, ":var4", reg0),
        (assign, ":var5", reg2),
        (assign, ":var6", reg1),
        (call_script, "script_center_get_consumption", "$g_encountered_party", ":var3"),
        (assign, ":var7", reg2),
        (assign, ":var8", reg1),
        (assign, ":var9", reg0),
        (store_sub, ":var10", ":var3", "itm_spice"),
        (val_add, ":var10", 301),
        (party_get_slot, ":var11", "$g_encountered_party", ":var10"),
        (assign, ":var12", 0),
        (assign, ":var13", 0),
        (assign, ":var14", 0),
        (assign, ":var15", 0),
        (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
          (neg|is_between, ":var2", "p_castle_1", "p_village_1"),
          (val_add, ":var12", 1),
          (call_script, "script_center_get_production", ":var2", ":var3"),
          (assign, ":var16", reg2),
          (call_script, "script_center_get_consumption", ":var2", ":var3"),
          (store_add, ":var17", reg1, reg2),
          (party_get_slot, ":var18", ":var2", ":var10"),
          (val_add, ":var13", ":var18"),
          (val_add, ":var14", ":var16"),
          (val_add, ":var15", ":var17"),
        (try_end),
        (assign, ":var19", ":var14"),
        (assign, ":var20", ":var15"),
        (val_div, ":var13", ":var12"),
        (val_div, ":var14", ":var12"),
        (val_div, ":var15", ":var12"),
        (str_store_item_name, s3, ":var3"),
        (assign, reg1, ":var5"),
        (assign, reg2, ":var6"),
        (assign, reg3, ":var4"),
        (assign, reg4, ":var11"),
        (assign, reg5, ":var14"),
        (assign, reg6, ":var13"),
        (assign, reg7, ":var7"),
        (assign, reg8, ":var8"),
        (assign, reg9, ":var9"),
        (assign, reg10, ":var15"),
        (item_get_slot, ":var21", ":var3", 14),
        (party_get_slot, ":var22", "$g_encountered_party", ":var21"),
        (assign, reg11, ":var22"),
        (assign, reg12, ":var19"),
        (assign, reg13, ":var20"),
        (item_get_slot, ":var23", ":var3", 15),
        (str_store_string, s4, ":var23"),
        (str_store_string, s1, "str___s3_price_=_reg4_calradian_average_reg6_capital_reg11_s4_base_reg1modified_by_raw_material_reg2modified_by_prosperity_reg3_calradian_average_production_base_reg5_total_reg12_consumed_reg7used_as_raw_material_reg8modified_total_reg9_calradian_consumption_base_reg10_total_reg13s1_"),
      (try_end),
    ],
    [
      ("go_back_dot",
      [],
      "Go_back.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 4),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("town_trade", mnf_scale_picture,
    "You head towards the marketplace.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_forge"),
    ],
    [
      ("assess_prices",
      [
        (store_faction_of_party, ":var0", "$current_town"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (ge, ":var1", 0),
      ],
      "Assess_the_local_prices.",
      [
        (jump_to_menu, "mnu_town_trade_assessment_begin"),
      ]
      ),

      ("trade_with_weaponsmith",
      [
        (party_slot_ge, "$current_town", 21, 1),
      ],
      "Trade_with_the_arms_merchant.",
      [
        (party_get_slot, ":var0", "$current_town", 21),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_armorsmith",
      [
        (party_slot_ge, "$current_town", 22, 1),
      ],
      "Trade_with_the_armor_merchant.",
      [
        (party_get_slot, ":var0", "$current_town", 22),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_horse_trader",
      [
        (party_slot_ge, "$current_town", 24, 1),
      ],
      "Trade_with_the_horse_merchant.",
      [
        (party_get_slot, ":var0", "$current_town", 24),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_merchant",
      [
        (party_slot_ge, "$current_town", 23, 1),
      ],
      "Trade_with_the_goods_merchant.",
      [
        (party_get_slot, ":var0", "$current_town", 23),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("back_to_town_menu",
      [],
      "Head_back.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("town_trade_assessment_begin", mnf_scale_picture,
    "The trade district is bustling with merchants and caravan masters making deals. You overhear several discussions about the prices of trade goods across the local area.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_town_reports"),
      (str_clear, s42),
    ],
    [
      ("town_best_deals",
      [],
      "Listen_closely_and_attempt_to_work_out_the_best_deals",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_assess_trade_goods_after_rest", 1),
        (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
        (val_div, reg0, 2),
        (store_sub, ":var0", 6, reg0),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours, ":var0", 5, 0),
        (change_screen_return),
      ]
      ),

      ("back_to_market",
      [],
      "Go_back_to_the_market.",
      [
        (jump_to_menu, "mnu_town_trade"),
      ]
      ),
    ],
  ),

  ("town_trade_assessment", mnf_disable_all_keys|mnf_scale_picture,
    "As the party member with the highest trade skill ({reg2}), {reg3?you try to figure out:{s1} tries to figure out} the best goods to trade in. {s2}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_town_reports"),
      (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, ":var2", 0),
      (assign, ":var3", -1),
      (assign, ":var4", -1),
      (assign, ":var5", 0),
      (assign, ":var6", -1),
      (assign, ":var7", -1),
      (assign, ":var8", 0),
      (assign, ":var9", -1),
      (assign, ":var10", -1),
      (assign, ":var11", 0),
      (store_sub, ":var12", "p_castle_1", "p_town_1"),
      (store_sub, ":var13", "itm_baggage_train", "itm_spice"),
      (store_mul, ":var14", ":var12", ":var13"),
      (val_mul, ":var14", ":var0"),
      (val_div, ":var14", 20),
      (assign, ":var15", "$g_encountered_party"),
      (try_for_range, ":var16", 0, ":var14"),
        (store_random_in_range, ":var17", "itm_spice", "itm_baggage_train"),
        (store_random_in_range, ":var18", "p_town_1", "p_castle_1"),
        (assign, ":var19", 0),
        (try_begin),
          (eq, ":var17", ":var3"),
          (eq, ":var18", ":var4"),
          (val_add, ":var19", 1),
        (else_try),
          (eq, ":var17", ":var6"),
          (eq, ":var18", ":var7"),
          (val_add, ":var19", 1),
        (else_try),
          (eq, ":var17", ":var9"),
          (eq, ":var18", ":var10"),
          (val_add, ":var19", 1),
        (try_end),
        (eq, ":var19", 0),
        (store_item_value, ":var20", ":var17"),
        (assign, "$g_encountered_party", ":var15"),
        (call_script, "script_game_get_item_buy_price_factor", ":var17"),
        (store_mul, ":var21", ":var20", reg0),
        (val_div, ":var21", 100),
        (val_max, ":var21", 1),
        (assign, "$g_encountered_party", ":var18"),
        (call_script, "script_game_get_item_sell_price_factor", ":var17"),
        (store_mul, ":var22", ":var20", reg0),
        (val_div, ":var22", 100),
        (val_max, ":var22", 1),
        (store_sub, ":var23", ":var22", ":var21"),
        (try_begin),
          (gt, ":var23", ":var5"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var6"),
          (assign, ":var10", ":var7"),
          (assign, ":var11", ":var8"),
          (assign, ":var6", ":var3"),
          (assign, ":var7", ":var4"),
          (assign, ":var8", ":var5"),
          (assign, ":var3", ":var17"),
          (assign, ":var4", ":var18"),
          (assign, ":var5", ":var23"),
        (else_try),
          (gt, ":var23", ":var8"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var6"),
          (assign, ":var10", ":var7"),
          (assign, ":var11", ":var8"),
          (assign, ":var6", ":var17"),
          (assign, ":var7", ":var18"),
          (assign, ":var8", ":var23"),
        (else_try),
          (gt, ":var23", ":var11"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var17"),
          (assign, ":var10", ":var18"),
          (assign, ":var11", ":var23"),
        (try_end),
      (try_end),
      (assign, "$g_encountered_party", ":var15"),
      (str_clear, s3),
      (assign, reg2, ":var0"),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (try_begin),
        (le, ":var2", 0),
        (str_store_string, s2, "@However, {reg3?You are:{s1} is} unable to find any trade goods that would bring a profit."),
      (else_try),
        (try_begin),
          (ge, ":var9", 0),
          (assign, reg6, ":var11"),
          (str_store_item_name, s4, ":var9"),
          (str_store_party_name, s5, ":var10"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
        (try_end),
        (try_begin),
          (ge, ":var6", 0),
          (assign, reg6, ":var8"),
          (str_store_item_name, s4, ":var6"),
          (str_store_party_name, s5, ":var7"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
        (try_end),
        (try_begin),
          (ge, ":var3", 0),
          (assign, reg6, ":var5"),
          (str_store_item_name, s4, ":var3"),
          (str_store_party_name, s5, ":var4"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
        (try_end),
        (str_store_string, s2, "@{reg3?You find:{s1} finds} out the following:^{s3}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town_trade"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_suceeded", mnf_scale_picture,
    "Disguised in the garments of a poor pilgrim, you fool the guards and make your way into the town.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_sneaked_success"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$sneaked_into_town", 1),
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught", mnf_scale_picture,
    "As you try to sneak in, one of the guards recognizes you and raises the alarm! You must flee back through the gates before all the guards in the town come down on you!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_sneaked_fail"),
      (assign, "$auto_menu", "mnu_captivity_start_castle_surrender"),
    ],
    [
      ("sneak_caught_fight",
      [],
      "Try_to_fight_your_way_out!",
      [
        (assign, "$all_doors_locked", 1),
        (party_get_slot, ":var0", "$current_town", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (try_begin),
          (this_or_next|eq, "$talk_context", 19),
          (eq, "$talk_context", 18),
          (set_jump_entry, 7),
        (else_try),
          (party_slot_eq, "$current_town", 0, 3),
          (set_jump_entry, 0),
        (else_try),
          (set_jump_entry, 1),
        (try_end),
        (set_jump_mission, "mt_sneak_caught_fight"),
        (set_passage_menu, "mnu_town"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("sneak_caught_surrender",
      [],
      "Surrender.",
      [
        (jump_to_menu, "mnu_captivity_start_castle_surrender"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught_dispersed_guards", mnf_scale_picture,
    "You drive off the guards and cover your trail before running off, easily losing your pursuers in the maze of streets.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_sneaked_success"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$sneaked_into_town", 1),
        (assign, "$town_entered", 1),
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught_ran_away", mnf_scale_picture,
    "You make your way back through the gates and quickly retreat to the safety of the countryside.{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_sneaked_fail"),
      (str_clear, s11),
      (assign, ":var0", 0),
      (assign, ":var1", "trp_heroes_end"),
      (try_for_range, ":var2", "trp_npc_adonja", ":var1"),
        (try_begin),
          (troop_slot_eq, ":var2", 149, 4),
          (assign, "$talk_context", 8),
          (assign, reg14, ":var2"),
          (call_script, "script_setup_troop_meeting", ":var2", -1),
          (troop_set_slot, ":var2", 149, -1),
          (troop_get_slot, ":var3", ":var2", 8),
          (party_remove_prisoners, ":var3", ":var2", 1),
          (troop_set_slot, ":var2", 8, -1),
          (assign, ":var1", -1),
        (else_try),
          (troop_slot_eq, ":var2", 149, 5),
          (str_store_troop_name, s12, ":var2"),
          (try_begin),
            (eq, ":var0", 0),
            (str_store_string, s11, "str_s11_unfortunately_s12_was_wounded_and_had_to_be_left_behind"),
          (else_try),
            (str_store_string, s11, "str_s11_also_s12_was_wounded_and_had_to_be_left_behind"),
          (try_end),
          (assign, ":var0", 1),
        (try_end),
        (troop_set_slot, ":var2", 149, 0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$auto_menu", -1),
        (store_encountered_party, "$last_sneak_attempt_town"),
        (store_current_hours, "$last_sneak_attempt_time"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("enemy_offer_ransom_for_prisoner", mnf_scale_picture,
    "The {s2} offers you a sum of {reg12} denars in silver if you are willing to sell them {s1}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_enemyoffersransom"),
      (call_script, "script_calculate_ransom_amount_for_troop", "$g_ransom_offer_troop"),
      (assign, reg12, reg0),
      (str_store_troop_name, s1, "$g_ransom_offer_troop"),
      (store_troop_faction, ":var0", "$g_ransom_offer_troop"),
      (str_store_faction_name, s2, ":var0"),
    ],
    [
      ("ransom_accept",
      [],
      "Accept_the_offer.",
      [
        (troop_add_gold, "trp_player", reg12),
        (party_remove_prisoners, "$g_ransom_offer_party", "$g_ransom_offer_troop", 1),
        (call_script, "script_remove_troop_from_prison", "$g_ransom_offer_troop"),
        (try_begin),
          (troop_get_type, ":var0", "trp_player"),
          (ge, ":var0", 1),
          (370, ":var1", 75, 0),
          (val_add, ":var1", 1),
          (371, 75, 0, ":var1"),
          (eq, ":var1", 3),
          (372, 75),
        (try_end),
        (change_screen_return),
      ]
      ),

      ("ransom_reject",
      [],
      "Reject_the_offer.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -10),
        (call_script, "script_change_player_honor", -5),
        (assign, "$g_ransom_offer_rejected", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("training_ground", mnf_scale_picture,
    "You approach a training field where you can practice your martial skills. What kind of training do you want to do?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
      (store_add, "$g_training_ground_melee_training_scene", "scn_training_ground_ranged_melee_1", "$g_encountered_party"),
      (val_sub, "$g_training_ground_melee_training_scene", "p_training_ground_1"),
      (try_begin),
        (ge, "$g_training_ground_training_count", 3),
        (assign, "$g_training_ground_training_count", 0),
        (rest_for_hours, 1, 5, 1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      (try_end),
    ],
    [
      ("camp_trainer",
      [],
      "Speak_with_the_trainer.",
      [
        (set_jump_mission, "mt_training_ground_trainer_talk"),
        (modify_visitors_at_site, "$g_training_ground_melee_training_scene"),
        (reset_visitors),
        (set_jump_entry, 5),
        (jump_to_scene, "$g_training_ground_melee_training_scene"),
        (change_screen_mission),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_melee",
      [
        (neg|troop_is_wounded, "trp_player"),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
      ],
      "Sparring_practice.",
      [
        (assign, "$g_mt_mode", 1),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_1"),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_archery",
      [],
      "Ranged_weapon_practice.",
      [
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_1"),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_mounted",
      [],
      "Horseback_practice.",
      [
        (assign, "$g_mt_mode", 3),
        (jump_to_menu, "mnu_training_ground_selection_details_mounted"),
        (music_set_situation, 0),
      ]
      ),

      ("go_to_track",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}Cheat:_Go_to_track.",
      [
        (set_jump_mission, "mt_ai_training"),
        (store_add, ":var0", "scn_training_ground_horse_track_1", "$g_encountered_party"),
        (val_sub, ":var0", "p_training_ground_1"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("go_to_range",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}Cheat:_Go_to_range.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "$g_training_ground_melee_training_scene"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_melee_1", mnf_scale_picture,
    "How many opponents will you go against?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
      (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
      (troop_get_slot, "$temp", "trp_stack_selection_amounts", 1),
      (assign, "$temp_2", 1),
    ],
    [
      ("camp_train_melee_num_men_1",
      [
        (ge, "$temp", 1),
      ],
      "One.",
      [
        (assign, "$temp", 1),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_2",
      [
        (ge, "$temp", 2),
      ],
      "Two.",
      [
        (assign, "$temp", 2),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_3",
      [
        (ge, "$temp", 3),
      ],
      "Three.",
      [
        (assign, "$temp", 3),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_4",
      [
        (ge, "$temp", 4),
      ],
      "Four.",
      [
        (assign, "$temp", 4),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_melee_2", mnf_scale_picture,
    "Choose your opponent #{reg1}:",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
      (assign, reg1, "$temp_2"),
      (troop_get_slot, "$temp_3", "trp_stack_selection_amounts", 0),
    ],
    [
      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 1),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 1),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 2),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 2),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 3),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 3),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 4),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 4),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 5),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 5),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 6),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 6),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 7),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 7),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 8),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 8),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 9),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 9),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 10),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 10),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 11),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 11),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 12),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 12),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 13),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 13),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 14),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 14),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 15),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 15),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 16),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 16),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 17),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 17),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 18),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 18),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 19),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 19),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 20),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 20),
      ]
      ),

      ("training_ground_selection_details_melee_random",
      [],
      "Choose_randomly.",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", -1),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_mounted", mnf_scale_picture,
    "What kind of weapon do you want to train with?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
    ],
    [
      ("camp_train_mounted_details_1",
      [],
      "One_handed_weapon.",
      [
        (call_script, "script_start_training_at_training_ground", 2, 0),
      ]
      ),

      ("camp_train_mounted_details_2",
      [],
      "Polearm.",
      [
        (call_script, "script_start_training_at_training_ground", 4, 0),
      ]
      ),

      ("camp_train_mounted_details_3",
      [],
      "Bow.",
      [
        (call_script, "script_start_training_at_training_ground", 8, 0),
      ]
      ),

      ("camp_train_mounted_details_4",
      [],
      "Thrown_weapon.",
      [
        (call_script, "script_start_training_at_training_ground", 10, 0),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_ranged_1", mnf_scale_picture,
    "What kind of ranged weapon do you want to train with?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
    ],
    [
      ("camp_train_ranged_weapon_bow",
      [],
      "Bow_and_arrows.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 8),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("camp_train_ranged_weapon_crossbow",
      [],
      "Crossbow.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 9),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("camp_train_ranged_weapon_thrown",
      [],
      "Throwing_Knives.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 10),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_ranged_2", mnf_scale_picture,
    "What range do you want to practice at?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
    ],
    [
      ("camp_train_ranged_details_1",
      [],
      "10_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 10),
      ]
      ),

      ("camp_train_ranged_details_2",
      [],
      "20_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 20),
      ]
      ),

      ("camp_train_ranged_details_3",
      [],
      "30_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 30),
      ]
      ),

      ("camp_train_ranged_details_4",
      [],
      "40_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 40),
      ]
      ),

      ("camp_train_ranged_details_5",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "50_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 50),
      ]
      ),

      ("camp_train_ranged_details_6",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "60_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 60),
      ]
      ),

      ("camp_train_ranged_details_7",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "70_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 70),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_description", mnf_scale_picture,
    "{s0}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_scene, "$g_training_ground_training_scene"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("training_ground_training_result", mnf_disable_all_keys|mnf_scale_picture,
    "{s7}{s2}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_trainingground"),
      (store_skill_level, ":var0", "skl_trainer", "trp_player"),
      (store_add, ":var1", 5, ":var0"),
      (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
      (str_clear, s2),
      (troop_get_slot, ":var2", "trp_stack_selection_amounts", 1),
      (troop_get_slot, ":var3", "trp_stack_selection_amounts", 0),
      (try_begin),
        (gt, "$g_training_ground_training_success_ratio", 0),
        (store_mul, ":var4", "$g_training_ground_training_success_ratio", "$g_training_ground_training_success_ratio"),
        (try_begin),
          (eq, "$g_training_ground_training_success_ratio", 100),
          (val_mul, ":var4", 2),
        (try_end),
        (try_begin),
          (eq, "$g_mt_mode", 1),
          (val_div, ":var4", 2),
        (try_end),
        (val_div, ":var4", 10),
        (try_begin),
          (gt, ":var2", 8),
          (val_mul, ":var4", 3),
          (assign, ":var5", ":var2"),
          (convert_to_fixed_point, ":var5"),
          (store_sqrt, ":var5", ":var5"),
          (convert_to_fixed_point, ":var4"),
          (val_div, ":var4", ":var5"),
        (try_end),
        (store_mul, ":var6", ":var4", ":var1"),
        (val_div, ":var6", 10),
        (party_get_num_companion_stacks, ":var7", "p_main_party"),
        (store_add, ":var8", ":var3", 2),
        (try_for_range, ":var9", 2, ":var8"),
          (troop_get_slot, ":var10", "trp_stack_selection_amounts", ":var9"),
          (troop_get_slot, ":var11", "trp_stack_selection_ids", ":var9"),
          (assign, ":var12", ":var7"),
          (try_for_range, ":var13", 0, ":var12"),
            (party_stack_get_troop_id, ":var14", "p_main_party", ":var13"),
            (eq, ":var14", ":var11"),
            (assign, ":var12", 0),
            (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":var11", ":var13", ":var10", ":var6"),
            (str_store_troop_name_by_count, s1, ":var11", ":var10"),
            (assign, reg1, ":var10"),
            (str_store_string, s2, "@{s2}^{reg1} {s1} earned {reg0} experience."),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_mt_mode", 1),
          (store_mul, ":var15", ":var4", 3),
          (val_div, ":var15", 2),
          (try_for_range, ":var16", 0, "$g_training_ground_training_num_enemies"),
            (troop_get_slot, ":var11", "trp_temp_array_a", ":var16"),
            (assign, ":var12", ":var7"),
            (try_for_range, ":var13", 0, ":var12"),
              (party_stack_get_troop_id, ":var14", "p_main_party", ":var13"),
              (eq, ":var14", ":var11"),
              (assign, ":var12", 0),
              (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":var11", ":var13", 1, ":var15"),
              (str_store_troop_name, s1, ":var11"),
              (str_store_string, s2, "@{s2}^{s1} earned an additional {reg0} experience."),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (call_script, "script_cf_training_ground_sub_routine_for_training_result", "trp_player", -1, 1, ":var4"),
          (str_store_string, s2, "@^You earned {reg0} experience.{s2}"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_training_ground_training_success_ratio", 0),
        (str_store_string, s7, "@The training didn't go well at all."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 25),
        (str_store_string, s7, "@The training didn't go well at all."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 50),
        (str_store_string, s7, "@The training didn't go very well."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 75),
        (str_store_string, s7, "@The training went quite well."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 99),
        (str_store_string, s7, "@The training went very well."),
      (else_try),
        (str_store_string, s7, "@The training went perfectly."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("marshall_selection_candidate_ask", mnf_scale_picture,
    "{s15} will soon select a new marshall for the {s23}. Some of the lords have suggested your name as a likely candidate.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_marshall"),
      (try_begin),
        (eq, "$g_presentation_marshall_selection_ended", 1),
        (change_screen_return),
      (try_end),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s15, ":var0"),
      (str_store_faction_name, s23, "$players_kingdom"),
    ],
    [
      ("marshall_candidate_accept",
      [],
      "Let_{s15}_learn_that_you_are_willing_to_serve_as_marshall.",
      [
        (start_presentation, "prsnt_marshall_selection"),
      ]
      ),

      ("marshall_candidate_reject",
      [],
      "Tell_everyone_that_you_are_too_busy_these_days.",
      [
        (try_begin),
          (eq, "$g_presentation_marshall_selection_max_renown_2_troop", "trp_player"),
          (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
        (else_try),
          (assign, "$g_presentation_marshall_selection_max_renown_1", "$g_presentation_marshall_selection_max_renown_2"),
          (assign, "$g_presentation_marshall_selection_max_renown_1_troop", "$g_presentation_marshall_selection_max_renown_2_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
        (try_end),
        (start_presentation, "prsnt_marshall_selection"),
      ]
      ),
    ],
  ),

  ("captivity_avoid_wilderness", 0,
    "Suddenly all the world goes black around you. Many hours later you regain your conciousness and find yourself at the spot you fell. Your enemies must have taken you up for dead and left you there. However, it seems that none of your wounds were lethal, and although you feel awful, you find out you can still walk. You get up and try to look for any other survivors from your party.",
    "none",
    [],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (try_begin),
        (eq, "$g_player_surrenders", 1),
        (jump_to_menu, "mnu_captivity_start_wilderness_surrender"),
      (else_try),
        (jump_to_menu, "mnu_captivity_start_wilderness_defeat"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness_surrender", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness_defeat", 0,
    "Your enemies take you prisoner.",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (try_begin),
        (party_stack_get_troop_id, ":var0", "$g_encountered_party", 0),
        (is_between, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (store_sub, ":var1", ":var0", "trp_npc_adonja"),
        (371, 7, ":var1", 1),
      (try_end),
      (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_castle_surrender", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_castle_defeat", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_under_siege_defeat", 0,
    "Your enemies take you prisoner.",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (try_begin),
        (store_faction_of_party, ":var0", "$g_enemy_party"),
        (neg|is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (assign, "$capturer_party", "$g_enemy_party"),
        (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
      (else_try),
        (assign, "$capturer_party", "$g_encountered_party"),
        (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("captivity_wilderness_taken_prisoner", mnf_scale_picture,
    "Your enemies take you prisoner.",
    "none",
    [
      (set_background_mesh, "mesh_pic_prisoner_wilderness"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_for_range, ":var0", "trp_npc_adonja", "trp_kingdom_1_lord"),
          (main_party_has_troop, ":var0"),
          (store_random_in_range, ":var1", 0, 100),
          (lt, ":var1", 30),
          (remove_member_from_party, ":var0", "p_main_party"),
          (troop_set_slot, ":var0", 2, 0),
          (troop_set_slot, ":var0", 82, 1),
          (assign, "$last_lost_companion", ":var0"),
          (store_faction_of_party, ":var2", "$g_encountered_party"),
          (troop_set_slot, ":var0", 83, ":var2"),
          (troop_set_health, ":var0", 100),
          (store_random_in_range, ":var3", "p_town_1", "p_castle_1"),
          (troop_set_slot, ":var0", 12, ":var3"),
          (assign, ":var4", 1000),
          (try_for_range, ":var5", "p_town_1", "p_castle_1"),
            (store_faction_of_party, ":var6", ":var5"),
            (store_relation, ":var7", ":var6", "fac_player_faction"),
            (ge, ":var7", 0),
            (store_distance_to_party_from_party, ":var8", ":var5", "p_main_party"),
            (lt, ":var8", ":var4"),
            (assign, ":var4", ":var8"),
            (troop_set_slot, ":var0", 12, ":var5"),
          (try_end),
        (try_end),
        (set_camera_follow_party, "$capturer_party"),
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var9", 18, 30),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var9"),
        (assign, "$auto_menu", "mnu_captivity_wilderness_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_wilderness_check", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_captivity_end_wilderness_escape"),
    ],
    [
    ],
    [],
  ),

  ("captivity_end_wilderness_escape", mnf_scale_picture,
    "After painful days of being dragged about as a prisoner, you find a chance and escape from your captors!",
    "none",
    [
      (play_cue_track, "track_escape"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_escape_1_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_escape_1"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 0),
        (assign, "$pin_player_fallen", 0),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 4),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_taken_prisoner", mnf_scale_picture,
    "You are quickly surrounded by guards who take away your weapons. With curses and insults, they throw you into the dungeon where you must while away the miserable days of your captivity.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_prisoner_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var0", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var0"),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_rescue_lord_taken_prisoner", mnf_scale_picture,
    "You remain in disguise for as long as possible before revealing yourself. The guards are outraged and beat you savagely before throwing you back into the cell for God knows how long...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_prisoner_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var0", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var0"),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_check", 0,
    "stub",
    "none",
    [
      (store_random_in_range, reg7, 0, 10),
      (try_begin),
        (party_is_active, "$capturer_party"),
        (store_faction_of_party, ":var0", "$capturer_party"),
        (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (store_relation, ":var1", ":var0", "fac_player_faction"),
        (ge, ":var1", 0),
        (jump_to_menu, "mnu_captivity_end_exchanged_with_prisoner"),
      (else_try),
        (lt, reg7, 4),
        (store_character_level, ":var2", "trp_player"),
        (store_mul, "$player_ransom_amount", ":var2", 50),
        (val_add, "$player_ransom_amount", 100),
        (store_troop_gold, reg3, "trp_player"),
        (store_div, ":var3", reg3, 20),
        (val_add, "$player_ransom_amount", ":var3"),
        (gt, reg3, "$player_ransom_amount"),
        (jump_to_menu, "mnu_captivity_end_propose_ransom"),
      (else_try),
        (lt, reg7, 7),
        (jump_to_menu, "mnu_captivity_end_exchanged_with_prisoner"),
      (else_try),
        (jump_to_menu, "mnu_captivity_castle_remain"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("captivity_end_exchanged_with_prisoner", mnf_scale_picture,
    "After days of imprisonment, you are finally set free when your captors exchange you with another prisoner.",
    "none",
    [
      (play_cue_track, "track_escape"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (troop_get_type, ":var0", "trp_player"),
        (try_begin),
          (ge, ":var0", 1),
          (set_background_mesh, "mesh_pic_prisoner_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_prisoner_man"),
        (try_end),
        (assign, "$g_player_is_captive", 0),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 12),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_end_propose_ransom", mnf_scale_picture,
    "You spend long hours in the sunless dank of the dungeon, more than you can count. Suddenly one of your captors enters your cell with an offer; he proposes to free you in return for {reg5} denars of your hidden wealth. You decide to...",
    "none",
    [
      (assign, reg5, "$player_ransom_amount"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_prisoner_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
    ],
    [
      ("captivity_end_ransom_accept",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", "$player_ransom_amount"),
      ],
      "Accept_the_offer.",
      [
        (play_cue_track, "track_escape"),
        (assign, "$g_player_is_captive", 0),
        (troop_remove_gold, "trp_player", "$player_ransom_amount"),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 1),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 6),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),

      ("captivity_end_ransom_deny",
      [],
      "Refuse_him,_wait_for_something_better.",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, reg8, 16, 22),
        (call_script, "script_stay_captive_for_hours", reg8),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_remain", mnf_disable_all_keys|mnf_scale_picture,
    "More days pass in the darkness of your cell. You get through them as best you can, enduring the kicks and curses of the guards, watching your underfed body waste away more and more...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (ge, ":var0", 1),
        (set_background_mesh, "mesh_pic_prisoner_fem"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
      (store_random_in_range, ":var1", 16, 22),
      (call_script, "script_stay_captive_for_hours", ":var1"),
      (assign, "$auto_menu", "mnu_captivity_castle_check"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_report_to_army", mnf_scale_picture,
    "{s8} sends word that he wishes you to join {reg4?her:his} new military campaign. You need to bring at least {reg13} troops to the army, and are instructed to raise more men with all due haste if you do not have enough.",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (quest_get_slot, ":var0", "qst_report_to_army", 2),
      (quest_get_slot, ":var1", "qst_report_to_army", 10),
      (call_script, "script_get_information_about_troops_position", ":var0", 0),
      (str_clear, s9),
      (try_begin),
        (eq, reg0, 1),
        (str_store_string, s9, s1),
      (try_end),
      (str_store_troop_name, s8, ":var0"),
      (assign, reg13, ":var1"),
      (troop_get_type, reg4, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (quest_get_slot, ":var0", "qst_report_to_army", 2),
        (quest_get_slot, ":var1", "qst_report_to_army", 10),
        (str_store_troop_name_link, s13, ":var0"),
        (assign, reg13, ":var1"),
        (setup_quest_text, "qst_report_to_army"),
        (str_store_string, s2, "@{s13} asked you to report to him with at least {reg13} troops."),
        (call_script, "script_start_quest", "qst_report_to_army", ":var0"),
        (call_script, "script_report_quest_troop_positions", "qst_report_to_army", ":var0", 3),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_messenger", mnf_scale_picture,
    "{s8} sends word that he wishes to speak with you about a task he needs performed. He requests you to come and see him as soon as possible.",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (faction_get_slot, ":var0", "$players_kingdom", 8),
      (str_store_troop_name, s8, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_join_siege_order", mnf_scale_picture,
    "{s8} sends word that you are to join the siege of {s9} in preparation for a full assault. Your troops are to take {s9} at all costs.",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (faction_get_slot, ":var0", "$players_kingdom", 8),
      (quest_get_slot, ":var1", "qst_join_siege_with_army", 1),
      (str_store_troop_name, s8, ":var0"),
      (str_store_party_name, s9, ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_end_quest", "qst_follow_army"),
        (quest_get_slot, ":var0", "qst_join_siege_with_army", 1),
        (faction_get_slot, ":var1", "$players_kingdom", 8),
        (str_store_troop_name_link, s13, ":var1"),
        (str_store_party_name_link, s14, ":var0"),
        (setup_quest_text, "qst_join_siege_with_army"),
        (str_store_string, s2, "@{s13} ordered you to join the assault against {s14}."),
        (call_script, "script_start_quest", "qst_join_siege_with_army", ":var1"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_follow_failed", mnf_scale_picture,
    "You have failed to follow {s8}. The marshal assumes that you were otherwise engaged, but would have appreciated your support.",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (faction_get_slot, ":var0", "$players_kingdom", 8),
      (str_store_troop_name, s8, ":var0"),
      (call_script, "script_abort_quest", "qst_follow_army", 1),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction_without_center", mnf_scale_picture,
    "You receive an offer of vassalage!^^ {s8} of the {s9} has sent a royal herald to bring you an invitation in his own hand. You would be granted the honor of becoming a vassal {reg63?lord:lady} of the {s9}, and in return {s8} asks you to swear an oath of homage to him and fight in his military campaigns, although he offers you no lands or titles. He will surely be offended if you do not take the offer...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_factioninvitation"),
      (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", 11),
      (str_store_troop_name, s8, "$g_invite_faction_lord"),
      (str_store_faction_name, s9, "$g_invite_faction"),
      (call_script, "script_gender_to_reg63"),
    ],
    [
      ("faction_accept",
      [],
      "Accept!",
      [
        (str_store_troop_name, s1, "$g_invite_faction_lord"),
        (setup_quest_text, "qst_join_faction"),
        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", 6, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", 23, 30),
        (quest_set_slot, "qst_join_faction", 26, 0),
        (str_store_string, s2, "@Find and speak with {s3} of the {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
      ]
      ),

      ("faction_reject",
      [],
      "Decline_the_invitation.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (call_script, "script_change_player_relation_with_faction", "$g_invite_faction", -10),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction", mnf_scale_picture,
    "You receive an offer of vassalage!^^ {s8} of the {s9} has sent a royal herald to bring you an invitation in his own hand. You would be granted the honor of becoming a vassal {reg63?lord:lady} of the {s9}, and in return {s8} asks you to swear an oath of homage to him and fight in his military campaigns, offering you the fief of {s2} for your loyal service. He will surely be offended if you do not take the offer...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_factioninvitation"),
      (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", 11),
      (str_store_troop_name, s8, "$g_invite_faction_lord"),
      (str_store_faction_name, s9, "$g_invite_faction"),
      (str_store_party_name, s2, "$g_invite_offered_center"),
    ],
    [
      ("faction_accept",
      [],
      "Accept!",
      [
        (str_store_troop_name, s1, "$g_invite_faction_lord"),
        (setup_quest_text, "qst_join_faction"),
        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", 6, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", 23, 30),
        (str_store_string, s2, "@Find and speak with {s3} of the {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
      ]
      ),

      ("faction_reject",
      [],
      "Decline_the_invitation.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction_accepted", mnf_scale_picture,
    "In order to become a vassal, you must swear an oath of homage to {s3}. You shall have to find him and give him your oath in person. {s5}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_factioninvitation"),
      (call_script, "script_get_information_about_troops_position", "$g_invite_faction_lord", 0),
      (str_store_troop_name, s3, "$g_invite_faction_lord"),
      (str_store_string, s5, "@{!}{s1}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("question_peace_offer", mnf_scale_picture,
    "You Receive a Peace Offer^^The {s1} offers you a peace agreement. What is your answer?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_peace"),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
    [
      ("peace_offer_accept",
      [],
      "Accept",
      [
        (call_script, "script_diplomacy_start_peace_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
        (change_screen_return),
      ]
      ),

      ("peace_offer_reject",
      [],
      "Reject",
      [
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_truce_expired", mnf_scale_picture,
    "Truce Has Expired^^The truce between the {s1} and the {s2} has expired.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_truceexpired"),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_feast_quest_expired", 0,
    "{s10}",
    "none",
    [
      (str_store_string, s10, "str_feast_quest_expired"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_sortie_possible", mnf_scale_picture,
    "Enemies have been sighted outside the walls of {s4}; {s5} and others are preparing for a sortie. You may join them if you wish.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_siege_joindefenders"),
      (str_store_party_name, s4, "$g_notification_menu_var1"),
      (party_stack_get_troop_id, ":var0", "$g_notification_menu_var2", 0),
      (str_store_troop_name, s5, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_casus_belli_expired", mnf_scale_picture,
    "Kingdom Fails to Respond^^The {s1} has not responded to the {s2}'s provocations, and {s3} suffers a loss of face among {reg4?her:his} more bellicose subjects...^",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_provocation_noresponse"),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (faction_get_slot, ":var0", "$g_notification_menu_var1", 11),
      (str_store_troop_name, s3, ":var0"),
      (troop_get_type, reg4, ":var0"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_faction_follows_controversial_policy", "$g_notification_menu_var1", 81),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_lord_defects", mnf_scale_picture,
    "Defection: {s4} has abandoned the {s5} and joined the {s7}, taking {reg4?her:his} fiefs with him",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_defected"),
      (assign, ":var0", "$g_notification_menu_var1"),
      (assign, ":var1", "$g_notification_menu_var2"),
      (str_store_troop_name, s4, ":var0"),
      (str_store_faction_name, s5, ":var1"),
      (store_troop_faction, ":var2", ":var0"),
      (str_store_faction_name, s7, ":var2"),
      (troop_get_type, reg4, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_treason_indictment", mnf_scale_picture,
    "Treason Indictment^^{s9}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_defected"),
      (assign, ":var0", "$g_notification_menu_var1"),
      (assign, ":var1", "$g_notification_menu_var2"),
      (faction_get_slot, ":var2", ":var1", 11),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (str_store_troop_name, s7, ":var2"),
        (str_store_string, s9, "str_you_have_been_indicted_for_treason_to_s7_your_properties_have_been_confiscated_and_you_would_be_well_advised_to_flee_for_your_life"),
      (else_try),
        (str_store_troop_name, s4, ":var0"),
        (str_store_faction_name, s5, ":var1"),
        (str_store_troop_name, s6, ":var2"),
        (troop_get_type, reg4, ":var0"),
        (store_troop_faction, ":var3", ":var0"),
        (try_begin),
          (is_between, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (str_store_faction_name, s10, ":var3"),
          (str_store_string, s11, "str_with_the_s10"),
        (else_try),
          (str_store_string, s11, "str_outside_calradia"),
        (try_end),
        (str_store_string, s9, "str_by_order_of_s6_s4_of_the_s5_has_been_indicted_for_treason_the_lord_has_been_stripped_of_all_reg4herhis_properties_and_has_fled_for_reg4herhis_life_he_is_rumored_to_have_gone_into_exile_s11"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_border_incident", mnf_scale_picture,
    "Border incident^^Word reaches you that {s9}. Though you don't know whether or not the rumors are true, you do know one thing -- this seemingly minor incident has raised passions among the {s4}, making it easier for them to go to war against the {s3}, if they want it...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_provocation"),
      (assign, ":var0", "$g_notification_menu_var1"),
      (assign, ":var1", "$g_notification_menu_var2"),
      (store_faction_of_party, ":var2", ":var0"),
      (try_begin),
        (eq, ":var1", -1),
        (party_get_slot, ":var3", ":var0", 61),
        (try_begin),
          (this_or_next|eq, ":var3", ":var2"),
          (neg|faction_slot_eq, ":var3", 21, 0),
          (party_get_slot, ":var3", ":var0", 62),
        (try_end),
        (str_store_party_name, s1, ":var0"),
        (str_store_faction_name, s3, ":var2"),
        (str_store_faction_name, s4, ":var3"),
        (faction_get_slot, ":var4", ":var3", 11),
        (str_store_troop_name, s5, ":var4"),
        (str_store_string, s9, "str_local_notables_from_s1_a_village_claimed_by_the_s4_have_been_mistreated_by_their_overlords_from_the_s3_and_petition_s5_for_protection"),
        (display_log_message, "@There has been an alleged border incident: {s9}"),
        (call_script, "script_add_log_entry", 75, ":var0", -1, -1, ":var2"),
      (else_try),
        (store_faction_of_party, ":var3", ":var1"),
        (str_store_party_name, s1, ":var0"),
        (str_store_party_name, s2, ":var1"),
        (store_random_in_range, ":var5", 0, 3),
        (try_begin),
          (eq, ":var5", 0),
          (str_store_string, s9, "str_villagers_from_s1_stole_some_cattle_from_s2"),
          (display_log_message, "@There has been an alleged border incident: {s9}"),
          (call_script, "script_add_log_entry", 72, ":var0", ":var1", -1, ":var2"),
        (else_try),
          (eq, ":var5", 1),
          (str_store_string, s9, "str_villagers_from_s1_abducted_a_woman_from_a_prominent_family_in_s2_to_marry_one_of_their_boys"),
          (display_log_message, "@There has been an alleged border incident: {s9}"),
          (call_script, "script_add_log_entry", 73, ":var0", ":var1", -1, ":var2"),
        (else_try),
          (eq, ":var5", 2),
          (str_store_string, s9, "str_villagers_from_s1_killed_some_farmers_from_s2_in_a_fight_over_the_diversion_of_a_stream"),
          (display_log_message, "@There has been an alleged border incident: {s9}"),
          (call_script, "script_add_log_entry", 74, ":var0", ":var1", -1, ":var2"),
        (try_end),
      (try_end),
      (str_store_faction_name, s3, ":var2"),
      (str_store_faction_name, s4, ":var3"),
      (store_add, ":var6", ":var2", 130),
      (val_sub, ":var6", "fac_player_supporters_faction"),
      (faction_set_slot, ":var3", ":var6", 30),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_active", mnf_scale_picture,
    "You now possess land in your name, without being tied to any kingdom. This makes you a monarch in your own right, with your court temporarily located at {s12}. However, the other kings in Pendor will at first consider you a threat, for if any upstart warlord can grab a throne, then their own legitimacy is called into question.^^You may find it desirable at this time to pledge yourself to an existing kingdom. If you want to continue as a sovereign monarch, then your first priority should be to establish an independent right to rule. You can establish your right to rule through several means -- marrying into a high-born family, recruiting new lords, governing your lands, treating with other kings, or dispatching your companions on missions.^^At any rate, your first step should be to appoint a chief minister from among your companions, to handle affairs of state. Different companions have different capabilities.^You may appoint new ministers from time to time. You may also change the location of your court, by speaking to the minister.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_factionactive"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
      (372, 52),
      (play_track, "track_coronation"),
      (try_for_range, ":var0", "p_town_1", "p_village_1"),
        (lt, "$g_player_court", "p_town_1"),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (assign, "$g_player_court", ":var0"),
        (try_begin),
          (troop_get_slot, ":var2", "trp_player", 30),
          (is_between, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
          (troop_set_slot, ":var2", 12, "$g_player_court"),
        (try_end),
        (str_store_party_name, s12, "$g_player_court"),
      (try_end),
    ],
    [
      ("appoint_spouse",
      [
        (troop_slot_ge, "trp_player", 30, 1),
        (troop_get_slot, ":var0", "trp_player", 30),
        (neg|troop_slot_eq, ":var0", 2, 2),
        (str_store_troop_name, s10, ":var0"),
      ],
      "Appoint_your_wife,_{s10}...",
      [
        (troop_get_slot, ":var0", "trp_player", 30),
        (assign, "$g_player_minister", ":var0"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_adonja",
      [
        (main_party_has_troop, "trp_npc_adonja"),
        (str_store_troop_name, s10, "trp_npc_adonja"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_adonja"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_leslie",
      [
        (main_party_has_troop, "trp_npc_leslie"),
        (str_store_troop_name, s10, "trp_npc_leslie"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_leslie"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_ansen",
      [
        (main_party_has_troop, "trp_npc_ansen"),
        (str_store_troop_name, s10, "trp_npc_ansen"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_ansen"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_riva",
      [
        (main_party_has_troop, "trp_npc_riva"),
        (str_store_troop_name, s10, "trp_npc_riva"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_riva"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_kassim",
      [
        (main_party_has_troop, "trp_npc_kassim"),
        (str_store_troop_name, s10, "trp_npc_kassim"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_kassim"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_lethaldiran",
      [
        (main_party_has_troop, "trp_npc_lethaldiran"),
        (str_store_troop_name, s10, "trp_npc_lethaldiran"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_lethaldiran"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_jocelyn",
      [
        (main_party_has_troop, "trp_npc_jocelyn"),
        (str_store_troop_name, s10, "trp_npc_jocelyn"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_jocelyn"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_alistair",
      [
        (main_party_has_troop, "trp_npc_alistair"),
        (str_store_troop_name, s10, "trp_npc_alistair"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_alistair"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_rayne",
      [
        (main_party_has_troop, "trp_npc_rayne"),
        (str_store_troop_name, s10, "trp_npc_rayne"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_rayne"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_julia",
      [
        (main_party_has_troop, "trp_npc_julia"),
        (str_store_troop_name, s10, "trp_npc_julia"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_julia"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_frederick",
      [
        (main_party_has_troop, "trp_npc_frederick"),
        (str_store_troop_name, s10, "trp_npc_frederick"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_frederick"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_ediz",
      [
        (main_party_has_troop, "trp_npc_ediz"),
        (str_store_troop_name, s10, "trp_npc_ediz"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_ediz"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_sara",
      [
        (main_party_has_troop, "trp_npc_sara"),
        (str_store_troop_name, s10, "trp_npc_sara"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_sara"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_donavan",
      [
        (main_party_has_troop, "trp_npc_donavan"),
        (str_store_troop_name, s10, "trp_npc_donavan"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_donavan"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_diev",
      [
        (main_party_has_troop, "trp_npc_diev"),
        (str_store_troop_name, s10, "trp_npc_diev"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_diev"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_alyssa",
      [
        (main_party_has_troop, "trp_npc_alyssa"),
        (str_store_troop_name, s10, "trp_npc_alyssa"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_alyssa"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_roland",
      [
        (main_party_has_troop, "trp_npc_roland"),
        (str_store_troop_name, s10, "trp_npc_roland"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_roland"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_kaverra",
      [
        (main_party_has_troop, "trp_npc_kaverra"),
        (str_store_troop_name, s10, "trp_npc_kaverra"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_kaverra"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_sigismund",
      [
        (main_party_has_troop, "trp_npc_sigismund"),
        (str_store_troop_name, s10, "trp_npc_sigismund"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_sigismund"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_npc_boadice",
      [
        (main_party_has_troop, "trp_npc_boadice"),
        (str_store_troop_name, s10, "trp_npc_boadice"),
      ],
      "Appoint_{s10}",
      [
        (assign, "$g_player_minister", "trp_npc_boadice"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),

      ("appoint_default",
      [],
      "Appoint_a_prominent_citizen_from_the_area...",
      [
        (assign, "$g_player_minister", "trp_temporary_minister"),
        (troop_set_faction, "trp_temporary_minister", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_minister_confirm"),
      ]
      ),
    ],
  ),

  ("minister_confirm", 0,
    "{s9}can be found at your court in {s12}. You should consult periodically, to avoid the accumulation of unresolved issues that may sap your authority...",
    "none",
    [
      (try_begin),
        (eq, "$players_kingdom_name_set", 1),
        (change_screen_return),
      (try_end),
      (try_begin),
        (eq, "$g_player_minister", "trp_temporary_minister"),
        (str_store_string, s9, "str_your_new_minister_"),
      (else_try),
        (str_store_troop_name, s10, "$g_player_minister"),
        (str_store_string, s9, "str_s10_is_your_new_minister_and_"),
      (try_end),
      (try_begin),
        (main_party_has_troop, "$g_player_minister"),
        (remove_member_from_party, "$g_player_minister", "p_main_party"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (start_presentation, "prsnt_name_kingdom"),
      ]
      ),
    ],
  ),

  ("auto_name_stronghold", mnf_scale_picture,
    "stub",
    "none",
    [
      (try_begin),
        (eq, "$menu_control", -1),
        (start_presentation, "prsnt_name_stronghold"),
        (assign, "$menu_control", 0),
      (else_try),
        (change_screen_return),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("auto_name_order", mnf_scale_picture,
    "Long live the {s2} order and its faithful {s3} and {s4}, established on {s60} by the wise and honorable {s5}!",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (str_store_faction_name, s2, "fac_player_knights"),
      (str_store_troop_name_plural, s3, "trp_player_knight"),
      (str_store_troop_name_plural, s4, "trp_player_sergeant"),
      (store_current_hours, ":var0"),
      (str_store_date, s60, ":var0"),
      (str_store_troop_name, s5, "trp_player"),
      (try_begin),
        (eq, "$menu_control", -1),
        (start_presentation, "prsnt_name_order"),
        (assign, "$menu_control", 0),
      (else_try),
        (play_sound, "snd_achievement_screen_fanfare"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("upgrade_screen", mnf_scale_picture,
    "stub",
    "none",
    [
      (try_begin),
        (eq, "$menu_control", 0),
        (call_script, "script_prepare_dummy_and_wardrobe_for_upgrade", "$g_pop_upgrade_troop", "$g_pop_upgrade_type", "$g_pop_upgrade_max_price", "$g_pop_upgrade_min_price"),
        (try_begin),
          (eq, "$g_pop_upgrade_troop", "trp_player_knight"),
          (assign, "$g_pop_upgrade_troop_dummy", "trp_player_knight_dummy"),
        (else_try),
          (assign, "$g_pop_upgrade_troop_dummy", "trp_player_sergeant_dummy"),
        (try_end),
        (change_screen_equip_other, "$g_pop_upgrade_troop_dummy"),
        (assign, "$menu_control", 1),
      (else_try),
        (eq, "$menu_control", 1),
        (set_player_troop, "trp_player"),
        (assign, "$pop_teleport_player_to_pos59", 1),
        (assign, "$town_entered", 1),
        (call_script, "script_enter_court", "$current_town"),
        (assign, "$menu_control", 2),
      (else_try),
        (jump_to_menu, "mnu_town"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("auto_grandmaster", 0,
    "{!}This menu automatically returns to caller.",
    "none",
    [
      (try_begin),
        (eq, "$menu_control", 0),
        (party_clear, "p_temp_party"),
        (party_add_members, "p_temp_party", "$g_talk_troop", 30),
        (store_sub, ":var0", "$g_talk_troop", "trp_dragon_knight"),
        (val_add, ":var0", "trp_dragon_drake"),
        (party_add_members, "p_temp_party", ":var0", 50),
        (change_screen_exchange_with_party, "p_temp_party"),
        (assign, "$menu_control", 2),
      (else_try),
        (change_screen_map),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("notification_court_lost", mnf_scale_picture,
    "{s12}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_courtlost"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
      (try_begin),
        (is_between, "$g_player_court", "p_town_1", "p_salt_mine"),
        (str_store_party_name, s10, "$g_player_court"),
        (str_store_party_name, s11, "$g_player_court"),
      (else_try),
        (str_store_string, s10, "str_your_previous_court_some_time_ago"),
        (str_store_string, s11, "str_your_previous_court_some_time_ago"),
      (try_end),
      (assign, "$g_player_court", -1),
      (str_store_string, s14, "str_after_to_the_fall_of_s11_your_court_has_nowhere_to_go"),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 2),
        (str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
      (try_end),
      (try_for_range, ":var0", "p_town_1", "p_village_1"),
        (eq, "$g_player_court", -1),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (neg|party_slot_ge, ":var0", 7, "trp_npc_adonja"),
        (assign, "$g_player_court", ":var0"),
        (try_begin),
          (troop_get_slot, ":var2", "trp_player", 30),
          (is_between, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
          (troop_set_slot, ":var2", 12, "$g_player_court"),
          (str_store_party_name, s11, "$g_player_court"),
        (try_end),
        (str_store_string, s14, "str_due_to_the_fall_of_s10_your_court_has_been_relocated_to_s12"),
      (try_end),
      (try_for_range, ":var0", "p_town_1", "p_village_1"),
        (eq, "$g_player_court", -1),
        (store_faction_of_party, ":var1", ":var0"),
        (eq, ":var1", "fac_player_supporters_faction"),
        (assign, "$g_player_court", ":var0"),
        (try_begin),
          (troop_get_slot, ":var2", "trp_player", 30),
          (is_between, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
          (troop_set_slot, ":var2", 12, "$g_player_court"),
        (try_end),
        (party_get_slot, ":var3", ":var0", 7),
        (str_store_party_name, s11, "$g_player_court"),
        (str_store_troop_name, s9, ":var3"),
        (str_store_string, s14, "str_after_to_the_fall_of_s10_your_faithful_vassal_s9_has_invited_your_court_to_s11_"),
      (try_end),
      (try_begin),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 2),
        (str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
      (try_end),
      (str_store_string, s12, s14),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_deactive", mnf_scale_picture,
    "Your kingdom no longer holds any land.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_yourfactiondead"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
        (try_end),
        (assign, "$g_player_minister", -1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_wedding_day", mnf_scale_picture,
    "{s8} wishes to inform you that preparations for your wedding at {s10} have been complete, and that your presence is expected imminently .",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (str_store_troop_name, s8, "$g_notification_menu_var1"),
      (str_store_party_name, s10, "$g_notification_menu_var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_kingdom_holds_feast", mnf_scale_picture,
    "{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_feast"),
      (str_store_troop_name, s8, "$g_notification_menu_var1"),
      (store_troop_faction, ":var0", "$g_notification_menu_var1"),
      (str_store_faction_name, s9, ":var0"),
      (str_store_party_name, s10, "$g_notification_menu_var2"),
      (str_clear, s12),
      (try_begin),
        (check_quest_active, "qst_wed_betrothed"),
        (quest_get_slot, ":var1", "qst_wed_betrothed", 6),
        (store_troop_faction, ":var2", ":var1"),
        (eq, ":var2", "$players_kingdom"),
        (str_store_string, s12, "str_feast_wedding_opportunity"),
      (try_end),
      (str_store_string, s11, "str_s8_wishes_to_inform_you_that_the_lords_of_s9_will_be_gathering_for_a_feast_at_his_great_hall_in_s10_and_invites_you_to_be_part_of_this_august_assembly"),
      (try_begin),
        (eq, "$g_notification_menu_var1", 0),
        (str_store_string, s11, "str_the_great_lords_of_your_kingdom_plan_to_gather_at_your_hall_in_s10_for_a_feast"),
      (try_end),
      (str_store_string, s11, "@{!}{s11}{s12}"),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (store_current_hours, ":var3"),
        (faction_get_slot, ":var4", "$players_kingdom", 94),
        (val_sub, ":var3", ":var4"),
        (assign, reg4, ":var3"),
        (display_message, "@{!}DEBUG -- Hours since last feast started: {reg4}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_under_siege", mnf_scale_picture,
    "{s1} has been besieged by {s2} of the {s3}!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_centerundersiege"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_under_siege_special", mnf_scale_picture,
    "{s1} is under attack by {s2}!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_centerundersiege"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_party_name, s2, "$g_notification_menu_var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_village_raided", mnf_scale_picture,
    "Enemies have laid waste to a fief^^{s1} has been raided by {s2} of the {s3}!",
    "none",
    [
      (set_background_mesh, "mesh_pic_looted_village"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_village_raid_started", mnf_scale_picture,
    "Your village is under attack!^^{s2} of the {s3} is laying waste to {s1}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_villageattacked"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_one_faction_left", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_auto_return_to_map"),
      (music_set_situation, 0),
      (play_sound, "snd_end_game_victory_screen"),
      (try_begin),
        (faction_slot_eq, "$g_notification_menu_var1", 11, "trp_player"),
        (372, 44),
      (else_try),
        (372, 53),
      (try_end),
      (try_begin),
        (troop_get_type, ":var0", "trp_player"),
        (ge, ":var0", 1),
        (372, 78),
      (try_end),
      (start_presentation, "prsnt_victory_screen_simple"),
    ],
    [
    ],
    [],
  ),

  ("notification_order_founded", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_auto_return_to_map"),
      (music_set_situation, 0),
      (play_sound, "snd_kinghorn"),
      (start_presentation, "prsnt_order_founded"),
    ],
    [
    ],
    [],
  ),

  ("notification_oath_renounced_faction_defeated", 0,
    "Your old fraction was defeated^^You won the battle against the {s1}! This ends your struggle which started after you renounced your oath to them.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_lost", mnf_scale_picture,
    "An estate was lost^^You have lost {s1} to the {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_sacked", mnf_scale_picture,
    "An estate was sacked^^{s1} was sacked by the {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_troop_left_players_faction", mnf_scale_picture,
    "Betrayal!^^{s1} has left the {s2} and joined the {s3}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_defected"),
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$players_kingdom"),
      (str_store_faction_name, s3, "$g_notification_menu_var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_troop_joined_players_faction", mnf_scale_picture,
    "Good news!^^ {s1} has left the {s2} and joined the {s3}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_defectedtoyou"),
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (str_store_faction_name, s3, "$players_kingdom"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_war_declared", mnf_scale_picture,
    "Declaration of war^^The {s1} declared war against the {s2}!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_war"),
      (try_begin),
        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (try_end),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":var0", "$g_notification_menu_var1", "fac_player_supporters_faction"),
      (store_sub, ":var1", "$g_notification_menu_var2", "fac_player_supporters_faction"),
      (val_mul, ":var0", 128),
      (val_add, ":var0", ":var1"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":var0", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_peace_declared", mnf_scale_picture,
    "Peace agreement^^The {s1} and the {s2} have made peace!^{s57}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_peace"),
      (try_begin),
        (eq, 1, 0),
        (eq, "$g_include_diplo_explanation", "$g_notification_menu_var1"),
        (assign, "$g_include_diplo_explanation", 0),
      (else_try),
        (str_clear, s57),
      (try_end),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":var0", "$g_notification_menu_var1", "fac_player_supporters_faction"),
      (store_sub, ":var1", "$g_notification_menu_var2", "fac_player_supporters_faction"),
      (val_mul, ":var0", 128),
      (val_add, ":var0", ":var1"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":var0", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_faction_defeated", mnf_scale_picture,
    "Faction eliminated^^The {s1} is no more!",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_factiondead"),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (is_between, "$supported_pretender", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
          (troop_slot_eq, "$supported_pretender", 14, "$g_notification_menu_var1"),
          (try_for_range, ":var0", "trp_npc_adonja", "trp_knight_1_1_wife"),
            (troop_slot_eq, ":var0", 2, 2),
            (store_troop_faction, ":var1", ":var0"),
            (eq, ":var1", "fac_player_supporters_faction"),
            (troop_set_faction, ":var0", "$g_notification_menu_var1"),
            (call_script, "script_troop_set_title_according_to_faction", ":var0", "$g_notification_menu_var1"),
            (try_begin),
              (this_or_next|eq, "$g_notification_menu_var1", "$players_kingdom"),
              (eq, "$g_notification_menu_var1", "fac_player_supporters_faction"),
              (call_script, "script_check_concilio_calradi_achievement"),
            (try_end),
          (else_try),
            (troop_slot_eq, ":var0", 2, 2),
            (store_troop_faction, ":var1", ":var0"),
            (eq, ":var1", "$g_notification_menu_var1"),
            (call_script, "script_troop_change_relation_with_troop", ":var0", "trp_player", 5),
          (try_end),
          (try_for_parties, ":var2"),
            (store_faction_of_party, ":var1", ":var2"),
            (eq, ":var1", "fac_player_supporters_faction"),
            (party_set_faction, ":var2", "$g_notification_menu_var1"),
          (try_end),
          (assign, "$players_kingdom", "$g_notification_menu_var1"),
          (try_begin),
            (troop_get_slot, ":var3", "trp_player", 30),
            (is_between, ":var3", "trp_knight_1_1_wife", "trp_heroes_end"),
            (troop_set_faction, ":var3", "$g_notification_menu_var1"),
          (try_end),
          (call_script, "script_add_notification_menu", "mnu_notification_rebels_switched_to_faction", "$g_notification_menu_var1", "$supported_pretender"),
          (faction_set_slot, "$g_notification_menu_var1", 21, 0),
          (faction_set_slot, "fac_player_supporters_faction", 21, 2),
          (faction_get_slot, ":var4", "$g_notification_menu_var1", 11),
          (troop_set_slot, ":var4", 55, "fac_commoners"),
          (faction_set_slot, "$g_notification_menu_var1", 11, "$supported_pretender"),
          (troop_set_faction, "$supported_pretender", "$g_notification_menu_var1"),
          (faction_get_slot, ":var5", "$g_notification_menu_var1", 8),
          (try_begin),
            (ge, ":var5", 0),
            (troop_get_slot, ":var6", ":var5", 10),
            (party_is_active, ":var6"),
            (1604, ":var6", 0),
          (try_end),
          (faction_set_slot, "$g_notification_menu_var1", 8, "trp_player"),
          (faction_set_slot, "$g_notification_menu_var1", 4, 0),
          (faction_set_slot, "$g_notification_menu_var1", 5, -1),
          (troop_set_slot, "$supported_pretender", 2, 2),
          (troop_set_slot, "$supported_pretender", 7, 1000),
          (party_remove_members, "p_main_party", "$supported_pretender", 1),
          (call_script, "script_set_player_relation_with_faction", "$g_notification_menu_var1", 0),
          (try_for_range, ":var7", "fac_player_supporters_faction", "fac_kingdoms_end"),
            (faction_slot_eq, ":var7", 21, 0),
            (neq, ":var7", "$g_notification_menu_var1"),
            (store_relation, ":var8", ":var7", "fac_player_supporters_faction"),
            (set_relation, ":var7", "$g_notification_menu_var1", ":var8"),
          (try_end),
          (assign, "$supported_pretender", 0),
          (assign, "$supported_pretender_old_faction", 0),
          (assign, "$g_recalculate_ais", 1),
          (call_script, "script_update_all_notes"),
        (try_end),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_rebels_switched_to_faction", mnf_scale_picture,
    "Rebellion success^^ Your rebellion is victorious! Your faction now has the sole claim to the title of the {s11}, with {s12} as the single ruler.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_rebellionsuccess"),
      (str_store_faction_name, s11, "$g_notification_menu_var1"),
      (str_store_troop_name, s12, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$talk_context", 15),
        (start_map_conversation, "$g_notification_menu_var2", -1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_should_consult", mnf_scale_picture,
    "Your minister send words that there are problems brewing in the realm which, if left untreated, could sap your authority. You should consult with him at your earliest convenience",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (setup_quest_text, "qst_consult_with_minister"),
        (str_store_troop_name, s11, "$g_player_minister"),
        (str_store_party_name, s12, "$g_player_court"),
        (str_store_string, s2, "str_consult_with_s11_at_your_court_in_s12"),
        (call_script, "script_start_quest", "qst_consult_with_minister", -1),
        (quest_set_slot, "qst_consult_with_minister", 23, 30),
        (quest_set_slot, "qst_consult_with_minister", 6, "$g_player_minister"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_feast_in_progress", mnf_scale_picture,
    "Feast in preparation^^Your wife has started preparations for a feast in your hall in {s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_feast"),
      (str_store_party_name, s11, "$g_notification_menu_var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_lady_requests_visit", mnf_scale_picture,
    "An elderly woman approaches your party and passes one of your men a letter, sealed in plain wax. It is addressed to you. When you break the seal, you see it is from {s15}. It reads, 'I so enjoyed your last visit. {s14} I am currently in {s10}.{s12}'",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_ladywriting"),
      (assign, ":var0", "$g_notification_menu_var1"),
      (assign, ":var1", "$g_notification_menu_var2"),
      (str_store_troop_name, s15, ":var0"),
      (str_store_party_name, s10, ":var1"),
      (store_current_hours, ":var2"),
      (troop_get_slot, ":var3", ":var0", 4),
      (val_sub, ":var2", ":var3"),
      (call_script, "script_get_kingdom_lady_social_determinants", ":var0"),
      (assign, ":var4", reg0),
      (str_store_troop_name, s16, ":var4"),
      (call_script, "script_troop_get_family_relation_to_troop", ":var4", ":var0"),
      (str_clear, s14),
      (try_begin),
        (lt, ":var2", 336),
        (try_begin),
          (troop_slot_eq, ":var0", 52, 23),
          (str_store_string, s14, "str_as_brief_as_our_separation_has_been_the_longing_in_my_heart_to_see_you_has_made_it_seem_as_many_years"),
        (else_try),
          (str_store_string, s14, "str_although_it_has_only_been_a_short_time_since_your_departure_but_i_would_be_most_pleased_to_see_you_again"),
        (try_end),
      (else_try),
        (ge, ":var2", 336),
        (try_begin),
          (troop_slot_eq, ":var0", 52, 24),
          (str_store_string, s14, "str_although_i_have_received_no_word_from_you_for_quite_some_time_i_am_sure_that_you_must_have_been_very_busy_and_that_your_failure_to_come_see_me_in_no_way_indicates_that_your_attentions_to_me_were_insincere_"),
        (else_try),
          (troop_slot_eq, ":var0", 52, 25),
          (str_store_string, s14, "str_i_trust_that_you_have_comported_yourself_in_a_manner_becoming_a_gentleman_during_our_long_separation_"),
        (else_try),
          (str_store_string, s14, "str_it_has_been_many_days_since_you_came_and_i_would_very_much_like_to_see_you_again"),
        (try_end),
      (try_end),
      (str_clear, s12),
      (str_clear, s18),
      (try_begin),
        (troop_slot_eq, ":var4", 38, 0),
        (str_store_string, s12, "str__you_should_ask_my_s11_s16s_permission_but_i_have_no_reason_to_believe_that_he_will_prevent_you_from_coming_to_see_me"),
        (str_store_string, s18, "str__you_should_first_ask_her_s11_s16s_permission"),
      (else_try),
        (troop_slot_eq, ":var4", 38, -1),
        (str_store_string, s12, "str__alas_as_we_know_my_s11_s16_will_not_permit_me_to_see_you_however_i_believe_that_i_can_arrange_away_for_you_to_enter_undetected"),
      (else_try),
        (troop_slot_eq, ":var4", 38, 1),
        (str_store_string, s12, "str__as_my_s11_s16_has_already_granted_permission_for_you_to_see_me_i_shall_expect_your_imminent_arrival"),
      (try_end),
    ],
    [
      ("notification_lady_requests_visit_come",
      [],
      "Tell_the_woman_to_inform_her_mistress_that_you_will_come_shortly",
      [
        (assign, ":var0", "$g_notification_menu_var1"),
        (str_store_troop_name_link, s3, ":var0"),
        (str_store_party_name_link, s4, "$g_notification_menu_var2"),
        (str_store_string, s2, "str_visit_s3_who_was_last_at_s4s18"),
        (call_script, "script_start_quest", "qst_visit_lady", ":var0"),
        (quest_set_slot, "qst_visit_lady", 6, ":var0"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (quest_get_slot, ":var1", "qst_visit_lady", 6),
          (str_store_troop_name, s2, ":var1"),
          (display_message, "str_giver_troop_=_s2"),
        (try_end),
        (quest_set_slot, "qst_visit_lady", 23, 30),
        (change_screen_return),
      ]
      ),

      ("notification_lady_requests_visit_indisposed",
      [],
      "Tell_the_woman_to_inform_her_mistress_that_you_are_indisposed",
      [
        (troop_set_slot, "$g_notification_menu_var1", 37, 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("garden", mnf_scale_picture,
    "{s12}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_visit_love"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
      (assign, ":var0", reg0),
      (str_store_troop_name, s11, "$love_interest_in_town"),
      (try_begin),
        (call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", ":var0", "trp_player"),
        (lt, reg0, 0),
        (troop_set_slot, ":var0", 38, -1),
      (try_end),
      (assign, "$nurse_assists_entry", 0),
      (try_begin),
        (troop_slot_eq, ":var0", 38, 1),
        (str_store_string, s12, "str_the_guards_at_the_gate_have_been_ordered_to_allow_you_through_you_might_be_imagining_things_but_you_think_one_of_them_may_have_given_you_a_wink"),
      (else_try),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "$love_interest_in_town"),
        (gt, reg0, 0),
        (assign, ":var1", 0),
        (try_begin),
          (check_quest_active, "qst_visit_lady"),
          (quest_slot_eq, "qst_visit_lady", 6, "$love_interest_in_town"),
          (assign, ":var1", 1),
        (else_try),
          (check_quest_active, "qst_formal_marriage_proposal"),
          (quest_slot_eq, "qst_formal_marriage_proposal", 6, "$love_interest_in_town"),
          (this_or_next|check_quest_succeeded, "qst_formal_marriage_proposal"),
          (check_quest_failed, "qst_formal_marriage_proposal"),
          (assign, ":var1", 1),
        (else_try),
          (check_quest_active, "qst_duel_courtship_rival"),
          (quest_slot_eq, "qst_duel_courtship_rival", 6, "$love_interest_in_town"),
          (this_or_next|check_quest_succeeded, "qst_duel_courtship_rival"),
          (check_quest_failed, "qst_duel_courtship_rival"),
          (assign, ":var1", 1),
        (try_end),
        (try_begin),
          (store_current_hours, ":var2"),
          (troop_get_slot, ":var3", "$love_interest_in_town", 4),
          (val_sub, ":var2", ":var3"),
          (this_or_next|ge, ":var2", 96),
          (eq, ":var1", 1),
          (try_begin),
            (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
            (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_don_this_dress_and_throw_the_hood_over_your_face_i_will_smuggle_you_inside_the_castle_to_meet_her_in_the_guise_of_a_skullery_maid__the_guards_will_not_look_too_carefully_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
            (assign, "$nurse_assists_entry", 1),
          (else_try),
            (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_wait_for_a_while_by_the_spring_outside_the_walls_i_will_smuggle_her_ladyship_out_to_meet_you_dressed_in_the_guise_of_a_shepherdess_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
            (assign, "$nurse_assists_entry", 2),
          (try_end),
        (else_try),
          (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_her_ladyship_asks_me_to_say_that_yearns_to_see_you_but_that_you_should_bide_your_time_a_bit_her_ladyship_says_that_to_arrange_a_clandestine_meeting_so_soon_after_your_last_encounter_would_be_too_dangerous"),
        (try_end),
      (else_try),
        (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter"),
      (try_end),
    ],
    [
      ("enter",
      [
        (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
        (troop_slot_eq, reg0, 38, 1),
      ],
      "Enter.",
      [
        (jump_to_menu, "mnu_town"),
        (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
      ]
      ),

      ("nurse_go",
      [
        (eq, "$nurse_assists_entry", 1),
      ],
      "Go_with_the_nurse.",
      [
        (jump_to_menu, "mnu_town"),
        (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
      ]
      ),

      ("nurse_wait",
      [
        (eq, "$nurse_assists_entry", 2),
      ],
      "Wait_by_the_spring.",
      [
        (jump_to_menu, "mnu_town"),
        (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("kill_local_merchant_begin", mnf_scale_picture,
    "You spot your victim and follow him, observing as he turns a corner into a dark alley. This will surely be your best opportunity to attack him.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_phase_3"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_jump_mission, "mt_back_alley_kill_local_merchant"),
        (party_get_slot, ":var0", "$qst_kill_local_merchant_center", 17),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 1, "trp_local_merchant"),
        (jump_to_menu, "mnu_town"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("debug_alert_from_s65", 0,
    "DEBUG ALERT: {s65}",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$debug_message_in_queue", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("auto_return_to_map", 0,
    "stub",
    "none",
    [
      (change_screen_map),
    ],
    [
    ],
    [],
  ),

  ("bandit_lair", mnf_scale_picture,
    "{s3}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_banditlair"),
      (try_begin),
        (eq, "$loot_screen_shown", 1),
        (try_for_range, ":var0", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":var0", 4, "$g_encountered_party"),
          (party_template_set_slot, ":var0", 4, 0),
        (try_end),
        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (neq, ":var1", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),
        (assign, "$g_leave_encounter", 0),
        (change_screen_return),
      (else_try),
        (party_stack_get_troop_id, ":var2", "$g_encountered_party", 0),
        (str_store_troop_name_plural, s4, ":var2"),
        (str_store_string, s5, "str_bandit_approach_defile"),
        (try_begin),
          (eq, ":var2", "trp_mountain_bandit"),
          (str_store_string, s5, "str_bandit_approach_cliffs"),
        (else_try),
          (eq, ":var2", "trp_forest_bandit"),
          (str_store_string, s5, "str_bandit_approach_swamp"),
        (else_try),
          (eq, ":var2", "trp_snake_follower"),
          (str_store_string, s5, "str_bandit_approach_swamp"),
        (else_try),
          (eq, ":var2", "trp_steppe_bandit"),
          (str_store_string, s5, "str_bandit_approach_thickets"),
        (else_try),
          (eq, ":var2", "trp_vanskerry_marauder"),
          (str_store_string, s5, "str_bandit_approach_cove"),
        (try_end),
        (try_begin),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (eq, ":var1", "pt_looter_lair"),
          (check_quest_active, "qst_save_relative_of_merchant"),
          (store_faction_of_party, ":var3", "$g_starting_town"),
          (store_sub, ":var4", ":var3", "fac_kingdom_1"),
          (store_add, ":var5", "str_bandits_sarleon", ":var4"),
          (str_store_string, s4, ":var5"),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 8, 0),
          (str_store_string, s3, "str_bandit_hideout_preattack"),
        (else_try),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (eq, ":var1", "pt_looter_lair"),
          (party_slot_eq, "$g_encountered_party", 8, 1),
          (str_store_string, s3, "str_lost_startup_hideout_attack"),
        (else_try),
          (party_slot_eq, "$g_encountered_party", 8, 1),
          (str_store_string, s3, "str_bandit_hideout_failure"),
        (else_try),
          (party_slot_eq, "$g_encountered_party", 8, 2),
          (str_store_string, s3, "str_bandit_hideout_success"),
        (try_end),
      (try_end),
    ],
    [
      ("continue_1",
      [
        (party_slot_eq, "$g_encountered_party", 8, 0),
      ],
      "Attack_the_hideout...",
      [
        (party_set_slot, "$g_encountered_party", 8, 1),
        (party_get_template_id, ":var0", "$g_encountered_party"),
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (try_begin),
          (eq, ":var0", "pt_sea_raider_lair"),
          (assign, ":var1", "scn_lair_sea_raiders"),
        (else_try),
          (eq, ":var0", "pt_forest_bandit_lair"),
          (assign, ":var1", "scn_lair_forest_bandits"),
        (else_try),
          (eq, ":var0", "pt_mountain_bandit_lair"),
          (assign, ":var1", "scn_lair_taiga_bandits"),
        (else_try),
          (eq, ":var0", "pt_snake_bandit_lair"),
          (assign, ":var1", "scn_lair_mountain_bandits"),
        (else_try),
          (eq, ":var0", "pt_steppe_bandit_lair"),
          (assign, ":var1", "scn_lair_steppe_bandits"),
        (else_try),
          (eq, ":var0", "pt_looter_lair"),
          (store_faction_of_party, ":var2", "$g_starting_town"),
          (try_begin),
            (eq, ":var2", "fac_kingdom_1"),
            (assign, ":var1", "scn_lair_forest_bandits"),
          (else_try),
            (eq, ":var2", "fac_kingdom_2"),
            (assign, ":var1", "scn_lair_taiga_bandits"),
          (else_try),
            (eq, ":var2", "fac_kingdom_3"),
            (assign, ":var1", "scn_lair_steppe_bandits"),
          (else_try),
            (eq, ":var2", "fac_kingdom_4"),
            (assign, ":var1", "scn_lair_sea_raiders"),
          (else_try),
            (eq, ":var2", "fac_kingdom_5"),
            (assign, ":var1", "scn_lair_mountain_bandits"),
          (try_end),
        (else_try),
          (eq, ":var0", "pt_treasure_lair"),
          (assign, ":var1", "scn_lair_treasure"),
        (try_end),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (store_character_level, ":var3", "trp_player"),
        (store_add, ":var4", 5, ":var3"),
        (val_div, ":var4", 3),
        (try_for_range, ":var5", 0, ":var4"),
          (store_random_in_range, ":var6", 2, 11),
          (call_script, "script_select_lair_warrior", ":var0"),
          (set_visitor, ":var6", reg33, 1),
        (try_end),
        (party_clear, "p_temp_casualties"),
        (party_clear, "p_total_enemy_casualties"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission, "mt_bandit_lair"),
        (jump_to_scene, ":var1"),
        (change_screen_mission),
      ]
      ),
#COOP BEGIN Bandit lair#############################		  
      ("coop_setup",
       [
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
       ],
       "Setup multiplayer battle.", 
       [
        (assign, "$coop_battle_type", coop_battle_type_bandit_lair),
        (assign, "$coop_encountered_party", "$g_encountered_party"),

        (store_character_level, ":player_level", "trp_player"),        
        (store_add, ":number_of_bandits_will_be_spawned", 5, ":player_level"),

        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
        (party_stack_get_size, ":stack_size", "$g_encountered_party", 0),
        (val_sub, ":number_of_bandits_will_be_spawned", ":stack_size"),
        (party_add_members, "$g_encountered_party", ":bandit_type", ":number_of_bandits_will_be_spawned"),

        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit), 
        (try_end),
       ]),	
	  

      ("quit",[
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).", 
      [
        (change_screen_quit), 
      ]),		

      ("coop_use_result",[
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),

        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
      ],"Use multiplayer battle results.", 
      [
      (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
	    (assign, "$g_enemy_party", "$g_encountered_party"),

      (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
      (party_add_members, "$g_encountered_party", ":bandit_type", 1), #add one to remember what type

      (try_begin),
        (eq, "$g_battle_result", 1), #player won
        (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 2),
      (else_try),
        (eq, "$g_battle_result", -1), #enemy won
        (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 1),
	    (try_end),
      ]),		  

      ("encounter_save",[
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), 
        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
        ],"Give me time to save.",
      [
        (call_script, "script_coop_get_battle_state", 2),
        (leave_encounter),
        (change_screen_return),
       # (rest_for_hours, 1, 1, 0),#rest while not attackable
      ]),		  	  
#COOP END#################################################

      ("leave_no_attack",
      [
        (party_slot_eq, "$g_encountered_party", 8, 0),
      ],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),

      ("leave_victory",
      [
        (party_slot_eq, "$g_encountered_party", 8, 2),
      ],
      "Continue...",
      [
        (try_for_range, ":var0", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":var0", 4, "$g_encountered_party"),
          (party_template_set_slot, ":var0", 4, 0),
        (try_end),
        (party_get_template_id, ":var1", "$g_encountered_party"),
        (try_begin),
          (neq, ":var1", "pt_looter_lair"),
          (check_quest_active, "qst_destroy_bandit_lair"),
          (quest_slot_eq, "qst_destroy_bandit_lair", 8, "$g_encountered_party"),
          (call_script, "script_succeed_quest", "qst_destroy_bandit_lair"),
        (try_end),
        (assign, "$g_leave_encounter", 0),
        (change_screen_return),
        (try_begin),
          (eq, "$loot_screen_shown", 0),
          (assign, "$loot_screen_shown", 1),
          (try_begin),
            (gt, "$g_ally_party", 0),
            (call_script, "script_party_add_party", "$g_ally_party", "p_temp_party"),
          (else_try),
            (party_get_num_attached_parties, ":var2", "p_main_party"),
            (gt, ":var2", 0),
            (party_get_attached_party_with_rank, ":var3", "p_main_party", 0),
            (call_script, "script_party_add_party", ":var3", "p_temp_party"),
          (try_end),
          (troop_clear_inventory, "trp_temp_troop"),
          (party_get_num_companion_stacks, ":var4", "p_temp_casualties"),
          (try_for_range, ":var5", 0, ":var4"),
            (party_stack_get_troop_id, ":var6", "p_temp_casualties", ":var5"),
            (try_begin),
              (party_stack_get_size, ":var7", "p_temp_casualties", ":var5"),
              (party_stack_get_troop_id, ":var6", "p_temp_casualties", ":var5"),
              (gt, ":var7", 0),
              (party_add_members, "p_total_enemy_casualties", ":var6", ":var7"),
              (party_stack_get_num_wounded, ":var8", "p_temp_casualties", ":var5"),
              (gt, ":var8", 0),
              (party_wound_members, "p_total_enemy_casualties", ":var6", ":var8"),
            (try_end),
          (try_end),
          (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"),
          (gt, reg0, 0),
          (troop_sort_inventory, "trp_temp_troop"),
          (change_screen_loot, "trp_temp_troop"),
        (try_end),
        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (eq, ":var1", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),
      ]
      ),

      ("leave_defeat",
      [
        (party_slot_eq, "$g_encountered_party", 8, 1),
      ],
      "Continue...",
      [
        (try_for_range, ":var0", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":var0", 4, "$g_encountered_party"),
          (party_template_set_slot, ":var0", 4, 0),
        (try_end),
        (try_begin),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (neq, ":var1", "pt_looter_lair"),
          (check_quest_active, "qst_destroy_bandit_lair"),
          (quest_slot_eq, "qst_destroy_bandit_lair", 8, "$g_encountered_party"),
          (call_script, "script_fail_quest", "qst_destroy_bandit_lair"),
        (try_end),
        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":var1", "$g_encountered_party"),
          (neq, ":var1", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),
        (assign, "$g_leave_encounter", 0),
        (try_begin),
          (party_is_active, "$g_encountered_party"),
          (party_set_slot, "$g_encountered_party", 8, 0),
        (try_end),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_political_issue_resolved", mnf_scale_picture,
    "After consulting with the peers of the realm, {s10} has decided to confer {s11} on {s12}.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_castlerefused"),
      (assign, ":var0", "$g_notification_menu_var1"),
      (assign, ":var1", "$g_notification_menu_var2"),
      (faction_get_slot, ":var2", "$players_kingdom", 11),
      (str_store_troop_name, s10, ":var2"),
      (try_begin),
        (eq, ":var0", 1),
        (str_store_string, s11, "str_the_marshalship"),
      (else_try),
        (str_store_party_name, s11, ":var0"),
      (try_end),
      (str_store_troop_name, s12, ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_political_issue_resolved_for_player", mnf_scale_picture,
    "After consulting with the peers of the realm, {s10} has decided to confer {s11} on you. You may decline the honor, but it will probably mean that you will not receive other awards for a little while.{s12}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_townreceived"),
      (faction_get_slot, ":var0", "$players_kingdom", 11),
      (str_store_troop_name, s10, ":var0"),
      (faction_get_slot, ":var1", "$players_kingdom", 64),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s11, "str_the_marshalship"),
        (str_store_string, s12, "@^^Note that so long as you remain marshal, the lords of the realm will be expecting you to lead them on campaign. So, if you are awaiting a feast, either for a wedding or for other purposes, you may wish to resign the marshalship by speaking to your liege."),
      (else_try),
        (str_clear, s12),
        (str_store_party_name, s11, ":var1"),
      (try_end),
    ],
    [
      ("accept",
      [],
      "Accept_the_honor",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 64),
        (try_begin),
          (eq, ":var0", 1),
          (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
          (call_script, "script_appoint_faction_marshall", "$players_kingdom", "trp_player"),
          (372, 41),
        (else_try),
          (call_script, "script_give_center_to_lord", ":var0", "trp_player", 0),
        (try_end),
        (faction_set_slot, "$players_kingdom", 64, 0),
        (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var2", ":var1"),
          (eq, ":var2", "$players_kingdom"),
          (troop_set_slot, ":var1", 154, -1),
        (try_end),
        (change_screen_return),
      ]
      ),

      ("decline",
      [],
      "Decline_the_honor",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 64),
        (try_begin),
          (is_between, ":var0", "p_town_1", "p_salt_mine"),
          (assign, "$g_dont_give_fief_to_player_days", 30),
        (else_try),
          (assign, "$g_dont_give_marshalship_to_player_days", 30),
        (try_end),
        (try_for_range, ":var1", "trp_npc_adonja", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var2", ":var1"),
          (eq, ":var2", "$players_kingdom"),
          (troop_set_slot, ":var1", 154, -1),
        (try_end),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("start_phase_2_5", mnf_disable_all_keys|mnf_scale_picture,
    "{!}{s16}",
    "none",
    [
      (call_script, "script_set_town_picture"),
      (str_store_party_name, s1, "$g_starting_town"),
      (str_store_string, s16, "$g_journey_string"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_start_phase_3_without_sq"),
      ]
      ),
    ],
  ),

  ("start_phase_3_without_sq", mnf_disable_all_keys|mnf_scale_picture,
    "{!}{s16}",
    "none",
    [
      (troop_sort_inventory, "trp_player"),
      (assign, "$current_startup_quest_phase", 1),
      (assign, "$talked_with_merchant", 1),
      (assign, "$dialog_with_merchant_ended", 1),
      (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
      (assign, ":var0", 0),
      (str_clear, s16),
      (str_store_party_name, s1, "$g_starting_town"),
      (call_script, "script_set_town_picture"),
      (str_store_party_name, s1, "$g_starting_town"),
      (str_store_string, s16, "$g_journey_string"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_starting_town", "$current_town"),
        (call_script, "script_player_arrived"),
        (party_set_morale, "p_main_party", 100),
        (assign, ":var0", 0),
        (party_get_position, pos1, "$current_town"),
        (try_for_range, ":var1", 0, 10),
          (map_get_random_position_around_position, pos0, pos1, 2),
          (get_distance_between_positions, ":var2", pos0, pos1),
          (ge, ":var2", ":var0"),
          (assign, ":var0", ":var2"),
          (copy_position, pos2, pos0),
        (try_end),
        (party_set_position, "p_main_party", pos2),
        (assign, "$town_entered", 1),
        (assign, "$g_killed_first_bandit", 1),
        (try_begin),
          (eq, "$current_town", "p_town_1"),
          (assign, ":var3", "trp_fierdsvain_merchant"),
          (assign, ":var4", "scn_town_1_tavern"),
        (else_try),
          (eq, "$current_town", "p_town_5"),
          (assign, ":var3", "trp_empire_merchant"),
          (assign, ":var4", "scn_town_5_tavern"),
        (else_try),
          (eq, "$current_town", "p_town_6"),
          (assign, ":var3", "trp_sarleon_merchant"),
          (assign, ":var4", "scn_town_6_tavern"),
        (else_try),
          (eq, "$current_town", "p_town_8"),
          (assign, ":var3", "trp_ravenstern_merchant"),
          (assign, ":var4", "scn_town_8_tavern"),
        (else_try),
          (eq, "$current_town", "p_town_10"),
          (assign, ":var3", "trp_dshar_merchant"),
          (assign, ":var4", "scn_town_10_tavern"),
        (try_end),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("start_phase_3", mnf_disable_all_keys|mnf_scale_picture,
    "{s16}^^Exhausted by the time you find the inn in {s1}, you fall asleep quickly. Awake before dawn and eager to explore your surroundings, you venture out onto the streets, which are still deserted in the early morn. Suddenly, the rasp of a blade sliding from its scabbard makes the hairs of your neck stand on end. You are instantly on the alert for trouble...",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_phase_3"),
      (assign, ":var0", 1),
      (try_begin),
        (eq, "$current_startup_quest_phase", 1),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
        (else_try),
          (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
        (try_end),
        (jump_to_menu, "mnu_start_phase_4"),
        (assign, ":var0", 0),
      (else_try),
        (eq, "$current_startup_quest_phase", 3),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
        (else_try),
          (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
        (try_end),
        (jump_to_menu, "mnu_start_phase_4"),
        (assign, ":var0", 0),
      (try_end),
      (str_store_party_name, s1, "$g_starting_town"),
      (str_clear, s16),
      (eq, ":var0", 1),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_starting_town", "$current_town"),
        (call_script, "script_player_arrived"),
        (party_set_morale, "p_main_party", 100),
        (2205, "$current_town"),
        (call_script, "script_prepare_alley_to_fight"),
      ]
      ),
    ],
  ),

  ("start_phase_4", mnf_disable_all_keys|mnf_scale_picture,
    "{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_start_phase_4"),
      (assign, ":var0", 1),
      (try_begin),
        (eq, "$current_startup_quest_phase", 2),
        (change_screen_return),
        (assign, ":var0", 0),
      (else_try),
        (eq, "$current_startup_quest_phase", 3),
        (str_store_string, s11, "str_merchant_and_you_call_some_townsmen_and_guards_to_get_ready_and_you_get_out_from_tavern"),
      (else_try),
        (eq, "$current_startup_quest_phase", 4),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits"),
        (else_try),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits_you_wounded"),
        (try_end),
      (try_end),
      (eq, ":var0", 1),
    ],
    [
      ("continue",
      [
        (this_or_next|eq, "$current_startup_quest_phase", 1),
        (eq, "$current_startup_quest_phase", 4),
      ],
      "Continue...",
      [
        (assign, "$town_entered", 1),
        (try_begin),
          (eq, "$current_town", "p_town_1"),
          (assign, ":var0", "trp_fierdsvain_merchant"),
          (assign, ":var1", "scn_town_1_room"),
        (else_try),
          (eq, "$current_town", "p_town_5"),
          (assign, ":var0", "trp_empire_merchant"),
          (assign, ":var1", "scn_town_5_room"),
        (else_try),
          (eq, "$current_town", "p_town_6"),
          (assign, ":var0", "trp_sarleon_merchant"),
          (assign, ":var1", "scn_town_6_room"),
        (else_try),
          (eq, "$current_town", "p_town_8"),
          (assign, ":var0", "trp_ravenstern_merchant"),
          (assign, ":var1", "scn_town_8_room"),
        (else_try),
          (eq, "$current_town", "p_town_10"),
          (assign, ":var0", "trp_dshar_merchant"),
          (assign, ":var1", "scn_town_10_room"),
        (try_end),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 9, ":var0"),
        (assign, "$talk_context", 21),
        (assign, "$dialog_with_merchant_ended", 0),
        (set_jump_mission, "mt_meeting_merchant"),
        (jump_to_scene, ":var1"),
        (change_screen_mission),
      ]
      ),

      ("continue",
      [
        (eq, "$current_startup_quest_phase", 3),
      ],
      "Continue...",
      [
        (call_script, "script_prepare_town_to_fight"),
      ]
      ),
    ],
  ),

  ("lost_tavern_duel", mnf_disable_all_keys|mnf_scale_picture,
    "{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_lose"),
      (try_begin),
        (agent_get_troop_id, ":var0", "$g_main_attacker_agent"),
        (eq, ":var0", "trp_belligerent_drunk"),
        (str_store_string, s11, "str_lost_tavern_duel_ordinary"),
      (else_try),
        (agent_get_troop_id, ":var0", "$g_main_attacker_agent"),
        (eq, ":var0", "trp_hired_assassin"),
        (str_store_string, s11, "str_lost_tavern_duel_assassin"),
      (try_end),
      (troop_set_slot, "trp_hired_assassin", 12, -1),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("grandmaster_ambush_lost", mnf_disable_all_keys|mnf_scale_picture,
    "The sudden Snake Cult attack caught you by surprise and you were knocked out under their furious blows. You woke up dazed and unable to comprehend what has just happened and why.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_lose"),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (troop_get_slot, ":var0", "trp_player", 162),
      (store_troop_faction, ":var1", ":var0"),
      (str_store_faction_name, s9, ":var1"),
      (setup_quest_text, "qst_order_grandmaster"),
      (str_store_string, s2, "@Speak to the Order representative of the {s9}."),
      (call_script, "script_start_quest", "qst_order_grandmaster", ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("grandmaster_ambush_won", mnf_disable_all_keys|mnf_scale_picture,
    "The sudden Snake Cult attack was furious, yet you and your fellow Order Knights dispatched the intruders quickly. There's no obvious explanation why this happened and you must look for answers now.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_win"),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (troop_get_slot, ":var0", "trp_player", 162),
      (store_troop_faction, ":var1", ":var0"),
      (str_store_faction_name, s9, ":var1"),
      (setup_quest_text, "qst_order_grandmaster"),
      (str_store_string, s2, "@Speak to the Order representative of the {s9}."),
      (call_script, "script_start_quest", "qst_order_grandmaster", ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("establish_court", mnf_disable_all_keys|mnf_scale_picture,
    "To establish {s4} as your court will require a small refurbishment. In particular, you will need a set of tools and a bolt of velvet. it may also take a short while for some of your followers to relocate here. Do you wish to proceed?",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_manage_construction"),
      (str_store_party_name, s4, "$g_encountered_party"),
    ],
    [
      ("establish",
      [
        (player_has_item, "itm_tools"),
        (player_has_item, "itm_velvet"),
      ],
      "Establish_{s4}_as_your_court",
      [
        (assign, "$g_player_court", "$current_town"),
        (troop_remove_item, "trp_player", "itm_tools"),
        (troop_remove_item, "trp_player", "itm_velvet"),
        (jump_to_menu, "mnu_town"),
      ]
      ),

      ("hold_off",
      [],
      "Hold_off...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("notification_relieved_as_marshal", mnf_disable_all_keys|mnf_scale_picture,
    "{s4} wishes to inform you that your services as marshal are no longer required. In honor of valiant efforts on behalf of the realm over the last {reg4} days, however, {reg8?she:he} offers you a purse of {reg5} denars.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_marshall"),
      (assign, reg4, "$g_player_days_as_marshal"),
      (store_div, ":var0", "$g_player_days_as_marshal", 4),
      (val_min, ":var0", 20),
      (store_mul, ":var1", "$g_player_days_as_marshal", 50),
      (val_max, ":var1", 200),
      (val_min, ":var1", 4000),
      (troop_add_gold, "trp_player", ":var1"),
      (call_script, "script_change_troop_renown", "trp_player", ":var0"),
      (assign, "$g_player_days_as_marshal", 0),
      (assign, "$g_dont_give_marshalship_to_player_days", 15),
      (assign, reg5, ":var1"),
      (faction_get_slot, ":var2", "$players_kingdom", 11),
      (str_store_troop_name, s4, ":var2"),
      (troop_get_type, reg8, ":var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("manage_loot_pool", mnf_scale_picture,
    "{s10}^{s30}",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_loot"),
      (assign, "$pool_troop", "trp_temp_troop"),
      (assign, reg20, 0),
      (troop_sort_inventory, "$pool_troop"),
      (troop_ensure_inventory_space, "$pool_troop", 10),
      (store_free_inventory_capacity, reg11, "$pool_troop"),
      (troop_sort_inventory, "$pool_troop"),
      (troop_get_inventory_capacity, ":var0", "$pool_troop"),
      (try_for_range, ":var1", 0, ":var0"),
        (troop_get_inventory_slot, ":var2", "$pool_troop", ":var1"),
        (ge, ":var2", 0),
        (val_add, reg20, 1),
      (try_end),
      (try_begin),
        (eq, reg20, 0),
        (str_store_string, s10, "str_item_pool_no_items"),
        (str_store_string, s20, "str_item_pool_leave"),
      (else_try),
        (eq, reg20, 1),
        (str_store_string, s10, "str_item_pool_one_item"),
        (str_store_string, s20, "str_item_pool_abandon"),
      (else_try),
        (str_store_string, s10, "str_item_pool_many_items"),
        (str_store_string, s20, "str_item_pool_abandon"),
      (try_end),
      (assign, reg10, 0),
      (assign, reg11, 0),
      (assign, reg12, 0),
      (assign, reg13, 0),
      (assign, reg14, 0),
      (party_get_num_companion_stacks, ":var3", "p_main_party"),
      (try_for_range, ":var4", 1, ":var3"),
        (party_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
        (is_between, ":var5", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (val_add, reg10, 1),
        (try_begin),
          (store_add, reg2, "$inventory_menu_offset", 1),
          (eq, reg10, reg2),
          (assign, reg11, ":var5"),
          (str_store_troop_name, s11, ":var5"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 2),
          (eq, reg10, reg2),
          (assign, reg12, ":var5"),
          (str_store_troop_name, s12, ":var5"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 3),
          (eq, reg10, reg2),
          (assign, reg13, ":var5"),
          (str_store_troop_name, s13, ":var5"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 4),
          (eq, reg10, reg2),
          (assign, reg14, ":var5"),
          (str_store_troop_name, s14, ":var5"),
        (try_end),
      (try_end),
    ],
    [
      ("auto_no_companions",
      [
        (eq, reg10, 0),
        (disable_menu_option),
      ],
      "I_have_no_companions_to_give_loot_to,_yet",
      []
      ),

      ("auto_loot",
      [
        (gt, reg10, 0),
        (eq, "$inventory_menu_offset", 0),
        (store_free_inventory_capacity, ":var0", "$pool_troop"),
        (ge, ":var0", 10),
        (try_begin),
          (eq, reg20, 0),
          (disable_menu_option),
        (try_end),
      ],
      "Let_your_heroes_select_gear_from_the_item_pool.",
      [
        (call_script, "script_auto_loot_all"),
        (jump_to_menu, "mnu_manage_loot_pool"),
      ]
      ),

      ("auto_loot_no",
      [
        (gt, reg10, 0),
        (gt, reg20, 0),
        (eq, "$inventory_menu_offset", 0),
        (store_free_inventory_capacity, ":var0", "$pool_troop"),
        (lt, ":var0", 10),
        (disable_menu_option),
      ],
      "Insufficient_item_pool_space_for_auto-upgrade.",
      []
      ),

      ("previous_page",
      [
        (gt, reg10, 0),
        (neq, "$inventory_menu_offset", 0),
      ],
      "[Previous_page]",
      [
        (val_sub, "$inventory_menu_offset", 4),
        (jump_to_menu, "mnu_manage_loot_pool"),
      ]
      ),

      ("next_page",
      [
        (gt, reg10, 0),
        (try_begin),
          (le, reg10, 4),
          (disable_menu_option),
        (else_try),
          (store_sub, reg2, reg10, 4),
          (ge, "$inventory_menu_offset", reg2),
          (disable_menu_option),
        (try_end),
      ],
      "[Next_page]",
      [
        (val_add, "$inventory_menu_offset", 4),
        (jump_to_menu, "mnu_manage_loot_pool"),
      ]
      ),

      ("loot",
      [],
      "Access_the_item_pool.",
      [
        (change_screen_loot, "$pool_troop"),
      ]
      ),

      ("companion1",
      [
        (gt, reg11, 0),
      ],
      "Talk_to_{s11}",
      [
        (call_script, "script_loot_menu_talk", reg11),
      ]
      ),

      ("companion2",
      [
        (gt, reg12, 0),
      ],
      "Talk_to_{s12}",
      [
        (call_script, "script_loot_menu_talk", reg12),
      ]
      ),

      ("companion3",
      [
        (gt, reg13, 0),
      ],
      "Talk_to_{s13}",
      [
        (call_script, "script_loot_menu_talk", reg13),
      ]
      ),

      ("companion4",
      [
        (gt, reg14, 0),
      ],
      "Talk_to_{s14}",
      [
        (call_script, "script_loot_menu_talk", reg14),
      ]
      ),

      ("leave_1",
      [],
      "{s20}",
      [
        (assign, "$g_camp_talk", 0),
        (jump_to_menu, "$return_menu"),
      ]
      ),
    ],
  ),

  ("access_companions_inventory", mnf_scale_picture,
    "Access companions' inventories.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_loot"),
      (assign, reg10, 0),
      (assign, reg11, 0),
      (assign, reg12, 0),
      (assign, reg13, 0),
      (assign, reg14, 0),
      (assign, reg15, 0),
      (assign, reg16, 0),
      (party_get_num_companion_stacks, ":var0", "p_main_party"),
      (try_for_range, ":var1", 1, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (is_between, ":var2", "trp_npc_adonja", "trp_kingdom_1_lord"),
        (val_add, reg10, 1),
        (try_begin),
          (store_add, reg2, "$inventory_menu_offset", 1),
          (eq, reg10, reg2),
          (assign, reg11, ":var2"),
          (str_store_troop_name, s11, ":var2"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 2),
          (eq, reg10, reg2),
          (assign, reg12, ":var2"),
          (str_store_troop_name, s12, ":var2"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 3),
          (eq, reg10, reg2),
          (assign, reg13, ":var2"),
          (str_store_troop_name, s13, ":var2"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 4),
          (eq, reg10, reg2),
          (assign, reg14, ":var2"),
          (str_store_troop_name, s14, ":var2"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 5),
          (eq, reg10, reg2),
          (assign, reg15, ":var2"),
          (str_store_troop_name, s15, ":var2"),
        (else_try),
          (store_add, reg2, "$inventory_menu_offset", 6),
          (eq, reg10, reg2),
          (assign, reg16, ":var2"),
          (str_store_troop_name, s16, ":var2"),
        (try_end),
      (try_end),
    ],
    [
      ("previous_page",
      [
        (gt, reg10, 0),
        (neq, "$inventory_menu_offset", 0),
      ],
      "[Previous_page]",
      [
        (val_sub, "$inventory_menu_offset", 6),
        (jump_to_menu, "mnu_access_companions_inventory"),
      ]
      ),

      ("next_page",
      [
        (gt, reg10, 0),
        (try_begin),
          (le, reg10, 6),
          (disable_menu_option),
        (else_try),
          (store_sub, reg2, reg10, 6),
          (ge, "$inventory_menu_offset", reg2),
          (disable_menu_option),
        (try_end),
      ],
      "[Next_page]",
      [
        (val_add, "$inventory_menu_offset", 6),
        (jump_to_menu, "mnu_access_companions_inventory"),
      ]
      ),

      ("companion1a",
      [
        (gt, reg11, 0),
        (try_begin),
          (eq, reg11, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s11}",
      [
        (change_screen_equip_other, reg11),
      ]
      ),

      ("companion2a",
      [
        (gt, reg12, 0),
        (try_begin),
          (eq, reg12, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s12}",
      [
        (change_screen_equip_other, reg12),
      ]
      ),

      ("companion3a",
      [
        (gt, reg13, 0),
        (try_begin),
          (eq, reg13, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s13}",
      [
        (change_screen_equip_other, reg13),
      ]
      ),

      ("companion4a",
      [
        (gt, reg14, 0),
        (try_begin),
          (eq, reg14, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s14}",
      [
        (change_screen_equip_other, reg14),
      ]
      ),

      ("companion5a",
      [
        (gt, reg15, 0),
        (try_begin),
          (eq, reg15, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s15}",
      [
        (change_screen_equip_other, reg15),
      ]
      ),

      ("companion6a",
      [
        (gt, reg16, 0),
        (try_begin),
          (eq, reg16, "trp_npc_lethaldiran"),
          (store_character_level, ":var0", "trp_player"),
          (lt, ":var0", 30),
          (disable_menu_option),
        (try_end),
      ],
      "{s16}",
      [
        (change_screen_equip_other, reg16),
      ]
      ),

      ("back_to_camp_menu",
      [],
      "{!}Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("achievement_notify", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_auto_return_to_map"),
      (call_script, "script_gender_to_reg63"),
      (str_store_string, s11, "$g_notification_menu_var1"),
      (assign, reg11, "$g_notification_menu_var2"),
      (try_begin),
        (eq, reg11, 24),
        (call_script, "script_change_player_honor", -30),
        (call_script, "script_objectionable_action", 1, "str_cheat_in_battle"),
      (else_try),
        (assign, ":var0", 0),
        (store_and, ":var0", "$g_achieve_bitfield", 67108864),
        (neq, ":var0", 0),
      (else_try),
        (eq, reg11, 0),
        (call_script, "script_change_troop_renown", "trp_player", 20),
      (else_try),
        (eq, reg11, 1),
        (troop_raise_skill, "trp_player", skl_trainer, 1),
        (display_message, "@Your Trainer skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 2),
        (troop_raise_skill, "trp_player", skl_trainer, 2),
        (display_message, "@Your Trainer skill has increased by 2.", 0x50FF50),
      (else_try),
        (eq, reg11, 3),
        (troop_raise_skill, "trp_player", skl_tactics, 1),
        (display_message, "@Your Tactics skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 4),
        (troop_raise_skill, "trp_player", skl_tactics, 2),
        (display_message, "@Your Tactics skill has increased by 2.", 0x50FF50),
      (else_try),
        (eq, reg11, 5),
        (troop_raise_attribute, "trp_player", ca_intelligence, 1),
        (display_message, "@Your Intelligence has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 6),
        (troop_raise_attribute, "trp_player", ca_intelligence, 2),
        (display_message, "@Your Intelligence has increased by 2.", 0x50FF50),
      (else_try),
        (eq, reg11, 7),
        (troop_raise_attribute, "trp_player", ca_agility, 1),
        (display_message, "@Your Agility has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 8),
        (troop_raise_skill, "trp_player", skl_ironflesh, 1),
        (display_message, "@Your Ironflesh skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 9),
        (troop_raise_skill, "trp_player", skl_riding, 1),
        (display_message, "@Your Riding skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 10),
        (troop_raise_attribute, "trp_player", ca_strength, 1),
        (display_message, "@Your Strength has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 11),
        (call_script, "script_change_troop_renown", "trp_player", 100),
      (else_try),
        (eq, reg11, 12),
        (troop_raise_skill, "trp_player", skl_weapon_master, 1),
        (display_message, "@Your Weapon Master skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 13),
        (troop_raise_attribute, "trp_player", ca_charisma, 1),
        (display_message, "@Your Charisma has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 14),
        (troop_raise_attribute, "trp_player", ca_charisma, 2),
        (display_message, "@Your Charisma has increased by 2.", 0x50FF50),
      (else_try),
        (eq, reg11, 15),
        (troop_raise_attribute, "trp_player", ca_charisma, 1),
        (display_message, "@Your Charisma has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 16),
        (troop_raise_skill, "trp_player", skl_leadership, 1),
        (display_message, "@Your Leadership skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 17),
        (troop_raise_skill, "trp_player", skl_persuasion, 1),
        (display_message, "@Your Persuasion skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 18),
        (troop_raise_skill, "trp_player", skl_engineer, 1),
        (display_message, "@Your Engineer skill has increased by 1.", 0x50FF50),
      (else_try),
        (eq, reg11, 19),
        (call_script, "script_change_troop_renown", "trp_player", 20),
      (else_try),
        (eq, reg11, 20),
        (call_script, "script_change_troop_renown", "trp_player", -10),
      (else_try),
        (eq, reg11, 21),
        (troop_raise_skill, "trp_player", skl_tactics, -1),
        (display_message, "@Your Tactics skill has decreased by 1.", 0xFF5050),
      (else_try),
        (eq, reg11, 22),
        (troop_raise_attribute, "trp_player", ca_charisma, -1),
        (display_message, "@Your Charisma has decreased by 1.", 0xFF5050),
      (else_try),
        (eq, reg11, 23),
        (troop_raise_attribute, "trp_player", ca_charisma, -1),
        (display_message, "@Your Charisma has decreased by 1.", 0xFF5050),
      (else_try),
        (eq, reg11, 25),
        (troop_raise_skill, "trp_player", skl_persuasion, 1),
        (display_message, "@Your Persuasion skill has increased by 1.", 0x50FF50),
      (try_end),
      (play_sound, "snd_achievement_screen_fanfare"),
      (start_presentation, "prsnt_achievement_notify"),
    ],
    [
    ],
    [],
  ),

  ("ghostlady_knocked_out", mnf_scale_picture,
    "The murderous scribe turns out to be very good with a blade, and despite your skill, quickly bests you. Conciousness abruptly returns when the castle guards pour cold water over you; wounded, but more or less in one piece. To your angry demand to know why they did not aid you, they reply that it is not their job to attack scribes. The Scribe has fled. You reflect bitterly that he will never be brought to justice now,  because of your ineptitude.",
    "none",
    [
      (set_background_mesh, "mesh_pic_pendor_assassins_lose"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("heartbeat_quest", mnf_scale_picture,
    "You receive an urgent message!^^    Your steward, {s8}, of {s2}, has sent you an urgent summons. There are events that need your attention.^^ He asks that you return to {s2} with all haste.^ ^ There may be negative consequences if you refuse this request...",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger"),
      (party_get_slot, ":var0", "$g_notification_menu_var1", 293),
      (str_store_troop_name, s8, ":var0"),
      (str_store_party_name, s2, "$g_notification_menu_var1"),
    ],
    [
      ("heartbeat_quest_accept",
      [],
      "Send_a_return_message_that_you_will_return_shortly!",
      [
        (change_screen_return),
      ]
      ),

      ("heartbeat_quest_do_remotely",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 500),
      ],
      "Toss_500_denars_to_your_messenger_and_let_him_solve_the_issue.",
      [
        (troop_remove_gold, "trp_player", 500),
        (display_log_message, "@The issue has been resolved successfully."),
        (party_set_slot, "$g_notification_menu_var1", 296, 0),
        (change_screen_return),
      ]
      ),

      ("heartbeat_quest_reject",
      [],
      "Decline_the_request,_you_have_better_things_to_do.",
      [
        (display_log_message, "@ Your party members grumble at your refusal to help those you have sworn to protect."),
        (call_script, "script_change_player_honor", -1),
        (call_script, "script_change_player_party_morale", -5),
        (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -5),
        (party_set_slot, "$g_notification_menu_var1", 296, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("choose_scenes_0", 0,
    "Choose a scene: (Page 1 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_13"),
      ]
      ),

      ("choose_scene_0",
      [],
      "abhuva_pendor_castle_1_base:_generate",
      [
        (jump_to_scene, "scn_abhuva_pendor_castle_1_base"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_1",
      [],
      "abhuva_pendor_castle_2_base:_generate",
      [
        (jump_to_scene, "scn_abhuva_pendor_castle_2_base"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_2",
      [],
      "camp_scene:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_camp_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_3",
      [],
      "camp_scene_horse_track:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_camp_scene_horse_track"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_4",
      [],
      "castle_10_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_10_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_5",
      [],
      "castle_10_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_10_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_6",
      [],
      "castle_10_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_10_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_7",
      [],
      "castle_11_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_11_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_8",
      [],
      "castle_11_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_11_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_9",
      [],
      "castle_11_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_11_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_10",
      [],
      "castle_12_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_12_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_11",
      [],
      "castle_12_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_12_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_12",
      [],
      "castle_12_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_12_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_13", 0,
    "Choose a scene: (Page 2 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_26"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_0"),
      ]
      ),

      ("choose_scene_13",
      [],
      "castle_13_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_13_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_14",
      [],
      "castle_13_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_13_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_15",
      [],
      "castle_13_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_13_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_16",
      [],
      "castle_14_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_14_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_17",
      [],
      "castle_14_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_14_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_18",
      [],
      "castle_14_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_14_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_19",
      [],
      "castle_15_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_15_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_20",
      [],
      "castle_15_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_15_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_21",
      [],
      "castle_15_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_15_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_22",
      [],
      "castle_16_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_16_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_23",
      [],
      "castle_16_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_16_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_24",
      [],
      "castle_16_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_16_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_25",
      [],
      "castle_17_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_17_exterior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_26", 0,
    "Choose a scene: (Page 3 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_39"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_13"),
      ]
      ),

      ("choose_scene_26",
      [],
      "castle_17_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_17_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_27",
      [],
      "castle_17_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_17_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_28",
      [],
      "castle_18_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_18_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_29",
      [],
      "castle_18_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_18_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_30",
      [],
      "castle_18_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_18_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_31",
      [],
      "castle_19_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_19_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_32",
      [],
      "castle_19_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_19_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_33",
      [],
      "castle_19_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_19_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_34",
      [],
      "castle_1_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_1_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_35",
      [],
      "castle_1_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_1_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_36",
      [],
      "castle_1_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_1_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_37",
      [],
      "castle_20_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_20_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_38",
      [],
      "castle_20_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_20_interior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_39", 0,
    "Choose a scene: (Page 4 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_52"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_26"),
      ]
      ),

      ("choose_scene_39",
      [],
      "castle_20_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_20_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_40",
      [],
      "castle_21_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_21_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_41",
      [],
      "castle_21_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_21_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_42",
      [],
      "castle_21_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_21_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_43",
      [],
      "castle_22_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_22_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_44",
      [],
      "castle_22_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_22_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_45",
      [],
      "castle_22_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_22_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_46",
      [],
      "castle_23_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_23_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_47",
      [],
      "castle_23_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_23_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_48",
      [],
      "castle_23_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_23_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_49",
      [],
      "castle_24_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_24_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_50",
      [],
      "castle_24_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_24_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_51",
      [],
      "castle_24_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_24_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_52", 0,
    "Choose a scene: (Page 5 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_65"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_39"),
      ]
      ),

      ("choose_scene_52",
      [],
      "castle_25_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_25_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_53",
      [],
      "castle_25_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_25_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_54",
      [],
      "castle_25_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_25_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_55",
      [],
      "castle_26_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_26_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_56",
      [],
      "castle_26_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_26_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_57",
      [],
      "castle_26_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_26_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_58",
      [],
      "castle_27_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_27_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_59",
      [],
      "castle_27_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_27_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_60",
      [],
      "castle_27_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_27_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_61",
      [],
      "castle_28_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_28_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_62",
      [],
      "castle_28_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_28_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_63",
      [],
      "castle_28_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_28_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_64",
      [],
      "castle_29_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_29_exterior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_65", 0,
    "Choose a scene: (Page 6 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_78"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_52"),
      ]
      ),

      ("choose_scene_65",
      [],
      "castle_29_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_29_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_66",
      [],
      "castle_29_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_29_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_67",
      [],
      "castle_2_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_2_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_68",
      [],
      "castle_2_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_2_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_69",
      [],
      "castle_2_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_2_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_70",
      [],
      "castle_30_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_30_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_71",
      [],
      "castle_30_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_30_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_72",
      [],
      "castle_30_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_30_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_73",
      [],
      "castle_31_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_31_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_74",
      [],
      "castle_31_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_31_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_75",
      [],
      "castle_31_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_31_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_76",
      [],
      "castle_32_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_32_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_77",
      [],
      "castle_32_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_32_interior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_78", 0,
    "Choose a scene: (Page 7 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_91"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_65"),
      ]
      ),

      ("choose_scene_78",
      [],
      "castle_32_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_32_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_79",
      [],
      "castle_33_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_33_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_80",
      [],
      "castle_33_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_33_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_81",
      [],
      "castle_33_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_33_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_82",
      [],
      "castle_34_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_34_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_83",
      [],
      "castle_34_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_34_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_84",
      [],
      "castle_34_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_34_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_85",
      [],
      "castle_35_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_35_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_86",
      [],
      "castle_35_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_35_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_87",
      [],
      "castle_35_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_35_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_88",
      [],
      "castle_36_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_36_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_89",
      [],
      "castle_36_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_36_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_90",
      [],
      "castle_36_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_36_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_91", 0,
    "Choose a scene: (Page 8 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_104"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_78"),
      ]
      ),

      ("choose_scene_91",
      [],
      "castle_37_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_37_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_92",
      [],
      "castle_37_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_37_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_93",
      [],
      "castle_37_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_37_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_94",
      [],
      "castle_38_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_38_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_95",
      [],
      "castle_38_interior:_generate",
      [
        (jump_to_scene, "scn_castle_38_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_96",
      [],
      "castle_38_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_38_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_97",
      [],
      "castle_39_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_39_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_98",
      [],
      "castle_39_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_39_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_99",
      [],
      "castle_39_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_39_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_100",
      [],
      "castle_3_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_3_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_101",
      [],
      "castle_3_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_3_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_102",
      [],
      "castle_3_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_3_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_103",
      [],
      "castle_40_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_40_exterior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_104", 0,
    "Choose a scene: (Page 9 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_117"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_91"),
      ]
      ),

      ("choose_scene_104",
      [],
      "castle_40_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_40_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_105",
      [],
      "castle_40_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_40_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_106",
      [],
      "castle_4_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_4_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_107",
      [],
      "castle_4_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_4_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_108",
      [],
      "castle_4_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_4_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_109",
      [],
      "castle_5_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_5_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_110",
      [],
      "castle_5_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_5_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_111",
      [],
      "castle_5_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_5_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_112",
      [],
      "castle_6_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_6_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_113",
      [],
      "castle_6_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_6_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_114",
      [],
      "castle_6_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_6_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_115",
      [],
      "castle_7_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_7_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_116",
      [],
      "castle_7_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_7_interior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_117", 0,
    "Choose a scene: (Page 10 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_130"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_104"),
      ]
      ),

      ("choose_scene_117",
      [],
      "castle_7_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_7_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_118",
      [],
      "castle_8_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_8_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_119",
      [],
      "castle_8_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_8_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_120",
      [],
      "castle_8_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_8_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_121",
      [],
      "castle_9_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_9_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_122",
      [],
      "castle_9_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_9_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_123",
      [],
      "castle_9_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_9_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_124",
      [],
      "castle_noldor_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_noldor_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_125",
      [],
      "castle_noldor_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_noldor_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_126",
      [],
      "conversation_scene",
      [
        (jump_to_scene, "scn_conversation_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_127",
      [],
      "dhorak_keep:_generate",
      [
        (jump_to_scene, "scn_dhorak_keep"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_128",
      [],
      "elacrai_arena:_generate",
      [
        (jump_to_scene, "scn_elacrai_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_129",
      [],
      "enterprise_brewery:_indoors",
      [
        (jump_to_scene, "scn_enterprise_brewery"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_130", 0,
    "Choose a scene: (Page 11 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_143"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_117"),
      ]
      ),

      ("choose_scene_130",
      [],
      "enterprise_dyeworks:_indoors",
      [
        (jump_to_scene, "scn_enterprise_dyeworks"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_131",
      [],
      "enterprise_linen_weavery:_indoors",
      [
        (jump_to_scene, "scn_enterprise_linen_weavery"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_132",
      [],
      "enterprise_mill:_indoors",
      [
        (jump_to_scene, "scn_enterprise_mill"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_133",
      [],
      "enterprise_oil_press:_indoors",
      [
        (jump_to_scene, "scn_enterprise_oil_press"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_134",
      [],
      "enterprise_smithy:_indoors",
      [
        (jump_to_scene, "scn_enterprise_smithy"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_135",
      [],
      "enterprise_tannery:_generate",
      [
        (jump_to_scene, "scn_enterprise_tannery"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_136",
      [],
      "enterprise_winery:_indoors",
      [
        (jump_to_scene, "scn_enterprise_winery"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_137",
      [],
      "enterprise_wool_weavery:_indoors",
      [
        (jump_to_scene, "scn_enterprise_wool_weavery"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_138",
      [],
      "field_1:_generate",
      [
        (jump_to_scene, "scn_field_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_139",
      [],
      "field_2:_generate",
      [
        (jump_to_scene, "scn_field_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_140",
      [],
      "field_3:_generate",
      [
        (jump_to_scene, "scn_field_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_141",
      [],
      "field_4:_generate",
      [
        (jump_to_scene, "scn_field_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_142",
      [],
      "field_5:_generate",
      [
        (jump_to_scene, "scn_field_5"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_143", 0,
    "Choose a scene: (Page 12 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_156"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_130"),
      ]
      ),

      ("choose_scene_143",
      [],
      "four_ways_inn:_generate",
      [
        (jump_to_scene, "scn_four_ways_inn"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_144",
      [],
      "lair_forest_bandits:_generate",
      [
        (jump_to_scene, "scn_lair_forest_bandits"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_145",
      [],
      "lair_mountain_bandits:_generate",
      [
        (jump_to_scene, "scn_lair_mountain_bandits"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_146",
      [],
      "lair_sea_raiders:_generate",
      [
        (jump_to_scene, "scn_lair_sea_raiders"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_147",
      [],
      "lair_steppe_bandits:_generate",
      [
        (jump_to_scene, "scn_lair_steppe_bandits"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_148",
      [],
      "lair_taiga_bandits:_generate",
      [
        (jump_to_scene, "scn_lair_taiga_bandits"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_149",
      [],
      "lair_treasure:_generate",
      [
        (jump_to_scene, "scn_lair_treasure"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_150",
      [],
      "meeting_scene_desert",
      [
        (jump_to_scene, "scn_meeting_scene_desert"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_151",
      [],
      "meeting_scene_desert_forest",
      [
        (jump_to_scene, "scn_meeting_scene_desert_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_152",
      [],
      "meeting_scene_plain",
      [
        (jump_to_scene, "scn_meeting_scene_plain"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_153",
      [],
      "meeting_scene_plain_forest",
      [
        (jump_to_scene, "scn_meeting_scene_plain_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_154",
      [],
      "meeting_scene_snow",
      [
        (jump_to_scene, "scn_meeting_scene_snow"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_155",
      [],
      "meeting_scene_snow_forest",
      [
        (jump_to_scene, "scn_meeting_scene_snow_forest"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_156", 0,
    "Choose a scene: (Page 13 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_169"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_143"),
      ]
      ),

      ("choose_scene_156",
      [],
      "meeting_scene_steppe",
      [
        (jump_to_scene, "scn_meeting_scene_steppe"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_157",
      [],
      "meeting_scene_steppe_forest",
      [
        (jump_to_scene, "scn_meeting_scene_steppe_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_158",
      [],
      "multi_scene_1:_generate",
      [
        (jump_to_scene, "scn_multi_scene_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_159",
      [],
      "multi_scene_10:_generate",
      [
        (jump_to_scene, "scn_multi_scene_10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_160",
      [],
      "multi_scene_11:_generate",
      [
        (jump_to_scene, "scn_multi_scene_11"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_161",
      [],
      "multi_scene_12:_generate",
      [
        (jump_to_scene, "scn_multi_scene_12"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_162",
      [],
      "multi_scene_13:_generate",
      [
        (jump_to_scene, "scn_multi_scene_13"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_163",
      [],
      "multi_scene_14:_generate",
      [
        (jump_to_scene, "scn_multi_scene_14"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_164",
      [],
      "multi_scene_15:_generate",
      [
        (jump_to_scene, "scn_multi_scene_15"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_165",
      [],
      "multi_scene_16:_generate",
      [
        (jump_to_scene, "scn_multi_scene_16"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_166",
      [],
      "multi_scene_17:_generate",
      [
        (jump_to_scene, "scn_multi_scene_17"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_167",
      [],
      "multi_scene_18:_generate|muddy_water",
      [
        (jump_to_scene, "scn_multi_scene_18"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_168",
      [],
      "multi_scene_2:_generate",
      [
        (jump_to_scene, "scn_multi_scene_2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_169", 0,
    "Choose a scene: (Page 14 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_182"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_156"),
      ]
      ),

      ("choose_scene_169",
      [],
      "multi_scene_3:_generate",
      [
        (jump_to_scene, "scn_multi_scene_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_170",
      [],
      "multi_scene_4:_generate",
      [
        (jump_to_scene, "scn_multi_scene_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_171",
      [],
      "multi_scene_5:_generate",
      [
        (jump_to_scene, "scn_multi_scene_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_172",
      [],
      "multi_scene_6:_generate",
      [
        (jump_to_scene, "scn_multi_scene_6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_173",
      [],
      "multi_scene_7:_generate",
      [
        (jump_to_scene, "scn_multi_scene_7"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_174",
      [],
      "multi_scene_8:_generate",
      [
        (jump_to_scene, "scn_multi_scene_8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_175",
      [],
      "multi_scene_9:_generate",
      [
        (jump_to_scene, "scn_multi_scene_9"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_176",
      [],
      "multiplayer_maps_end:_generate",
      [
        (jump_to_scene, "scn_multiplayer_maps_end"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_177",
      [],
      "novice_ground:_indoors",
      [
        (jump_to_scene, "scn_novice_ground"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_178",
      [],
      "order_stronghold_exterior:_generate",
      [
        (jump_to_scene, "scn_order_stronghold_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_179",
      [],
      "quick_battle_1:_generate",
      [
        (jump_to_scene, "scn_quick_battle_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_180",
      [],
      "quick_battle_2:_generate",
      [
        (jump_to_scene, "scn_quick_battle_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_181",
      [],
      "quick_battle_3:_generate",
      [
        (jump_to_scene, "scn_quick_battle_3"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_182", 0,
    "Choose a scene: (Page 15 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_195"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_169"),
      ]
      ),

      ("choose_scene_182",
      [],
      "quick_battle_4:_generate",
      [
        (jump_to_scene, "scn_quick_battle_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_183",
      [],
      "quick_battle_5:_generate",
      [
        (jump_to_scene, "scn_quick_battle_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_184",
      [],
      "quick_battle_6:_generate",
      [
        (jump_to_scene, "scn_quick_battle_6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_185",
      [],
      "quick_battle_7:_generate",
      [
        (jump_to_scene, "scn_quick_battle_7"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_186",
      [],
      "quick_battle_maps_end:_generate",
      [
        (jump_to_scene, "scn_quick_battle_maps_end"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_187",
      [],
      "quick_battle_scene_1:_generate",
      [
        (jump_to_scene, "scn_quick_battle_scene_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_188",
      [],
      "quick_battle_scene_2:_generate",
      [
        (jump_to_scene, "scn_quick_battle_scene_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_189",
      [],
      "quick_battle_scene_3:_generate",
      [
        (jump_to_scene, "scn_quick_battle_scene_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_190",
      [],
      "quick_battle_scene_4:_generate",
      [
        (jump_to_scene, "scn_quick_battle_scene_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_191",
      [],
      "quick_battle_scene_5:_generate",
      [
        (jump_to_scene, "scn_quick_battle_scene_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_192",
      [],
      "random_multi_plain_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_multi_plain_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_193",
      [],
      "random_multi_plain_medium:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_multi_plain_medium"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_194",
      [],
      "random_multi_steppe_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_multi_steppe_large"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_195", 0,
    "Choose a scene: (Page 16 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_208"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_182"),
      ]
      ),

      ("choose_scene_195",
      [],
      "random_multi_steppe_medium:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_multi_steppe_medium"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_196",
      [],
      "random_scene:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_197",
      [],
      "random_scene_desert_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_desert_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_198",
      [],
      "random_scene_desert_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_desert_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_199",
      [],
      "random_scene_desert_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_desert_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_200",
      [],
      "random_scene_plain_forest_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_forest_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_201",
      [],
      "random_scene_plain_forest_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_forest_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_202",
      [],
      "random_scene_plain_forest_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_203",
      [],
      "random_scene_plain_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_204",
      [],
      "random_scene_plain_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_205",
      [],
      "random_scene_plain_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_plain_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_206",
      [],
      "random_scene_snow_forest_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_forest_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_207",
      [],
      "random_scene_snow_forest_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_forest_normal"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_208", 0,
    "Choose a scene: (Page 17 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_221"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_195"),
      ]
      ),

      ("choose_scene_208",
      [],
      "random_scene_snow_forest_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_209",
      [],
      "random_scene_snow_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_210",
      [],
      "random_scene_snow_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_211",
      [],
      "random_scene_snow_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_snow_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_212",
      [],
      "random_scene_steppe_forest_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_forest_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_213",
      [],
      "random_scene_steppe_forest_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_forest_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_214",
      [],
      "random_scene_steppe_forest_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_215",
      [],
      "random_scene_steppe_large:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_large"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_216",
      [],
      "random_scene_steppe_normal:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_normal"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_217",
      [],
      "random_scene_steppe_small:_generate|auto_entry_points|randomize",
      [
        (jump_to_scene, "scn_random_scene_steppe_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_218",
      [],
      "reserved10",
      [
        (jump_to_scene, "scn_reserved10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_219",
      [],
      "reserved11",
      [
        (jump_to_scene, "scn_reserved11"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_220",
      [],
      "reserved4:_generate",
      [
        (jump_to_scene, "scn_reserved4"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_221", 0,
    "Choose a scene: (Page 18 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_234"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_208"),
      ]
      ),

      ("choose_scene_221",
      [],
      "reserved5:_generate",
      [
        (jump_to_scene, "scn_reserved5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_222",
      [],
      "reserved6:_generate",
      [
        (jump_to_scene, "scn_reserved6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_223",
      [],
      "reserved7:_generate",
      [
        (jump_to_scene, "scn_reserved7"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_224",
      [],
      "reserved8:_generate",
      [
        (jump_to_scene, "scn_reserved8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_225",
      [],
      "salt_mine:_generate",
      [
        (jump_to_scene, "scn_salt_mine"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_226",
      [],
      "snake_stronghold_exterior:_generate",
      [
        (jump_to_scene, "scn_snake_stronghold_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_227",
      [],
      "test2:_generate",
      [
        (jump_to_scene, "scn_test2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_228",
      [],
      "test3:_generate",
      [
        (jump_to_scene, "scn_test3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_229",
      [],
      "test_scene:_generate",
      [
        (jump_to_scene, "scn_test_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_230",
      [],
      "town_10_alley:_generate",
      [
        (jump_to_scene, "scn_town_10_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_231",
      [],
      "town_10_arena:_generate",
      [
        (jump_to_scene, "scn_town_10_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_232",
      [],
      "town_10_castle:_indoors",
      [
        (jump_to_scene, "scn_town_10_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_233",
      [],
      "town_10_center:_generate",
      [
        (jump_to_scene, "scn_town_10_center"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_234", 0,
    "Choose a scene: (Page 19 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_247"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_221"),
      ]
      ),

      ("choose_scene_234",
      [],
      "town_10_prison:_indoors",
      [
        (jump_to_scene, "scn_town_10_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_235",
      [],
      "town_10_room:_indoors",
      [
        (jump_to_scene, "scn_town_10_room"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_236",
      [],
      "town_10_store:_indoors",
      [
        (jump_to_scene, "scn_town_10_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_237",
      [],
      "town_10_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_10_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_238",
      [],
      "town_10_walls:_generate",
      [
        (jump_to_scene, "scn_town_10_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_239",
      [],
      "town_11_alley:_generate",
      [
        (jump_to_scene, "scn_town_11_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_240",
      [],
      "town_11_arena:_generate",
      [
        (jump_to_scene, "scn_town_11_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_241",
      [],
      "town_11_castle:_indoors",
      [
        (jump_to_scene, "scn_town_11_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_242",
      [],
      "town_11_center:_generate",
      [
        (jump_to_scene, "scn_town_11_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_243",
      [],
      "town_11_prison:_indoors",
      [
        (jump_to_scene, "scn_town_11_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_244",
      [],
      "town_11_store:_indoors",
      [
        (jump_to_scene, "scn_town_11_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_245",
      [],
      "town_11_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_11_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_246",
      [],
      "town_11_walls:_generate",
      [
        (jump_to_scene, "scn_town_11_walls"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_247", 0,
    "Choose a scene: (Page 20 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_260"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_234"),
      ]
      ),

      ("choose_scene_247",
      [],
      "town_12_alley:_generate",
      [
        (jump_to_scene, "scn_town_12_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_248",
      [],
      "town_12_arena:_generate",
      [
        (jump_to_scene, "scn_town_12_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_249",
      [],
      "town_12_castle:_indoors",
      [
        (jump_to_scene, "scn_town_12_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_250",
      [],
      "town_12_center:_generate",
      [
        (jump_to_scene, "scn_town_12_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_251",
      [],
      "town_12_prison:_indoors",
      [
        (jump_to_scene, "scn_town_12_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_252",
      [],
      "town_12_store:_indoors",
      [
        (jump_to_scene, "scn_town_12_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_253",
      [],
      "town_12_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_12_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_254",
      [],
      "town_12_walls:_generate",
      [
        (jump_to_scene, "scn_town_12_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_255",
      [],
      "town_13_alley:_generate",
      [
        (jump_to_scene, "scn_town_13_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_256",
      [],
      "town_13_arena:_generate",
      [
        (jump_to_scene, "scn_town_13_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_257",
      [],
      "town_13_castle:_indoors",
      [
        (jump_to_scene, "scn_town_13_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_258",
      [],
      "town_13_center:_generate",
      [
        (jump_to_scene, "scn_town_13_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_259",
      [],
      "town_13_prison:_indoors",
      [
        (jump_to_scene, "scn_town_13_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_260", 0,
    "Choose a scene: (Page 21 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_273"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_247"),
      ]
      ),

      ("choose_scene_260",
      [],
      "town_13_store:_indoors",
      [
        (jump_to_scene, "scn_town_13_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_261",
      [],
      "town_13_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_13_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_262",
      [],
      "town_13_walls:_generate",
      [
        (jump_to_scene, "scn_town_13_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_263",
      [],
      "town_14_alley:_generate",
      [
        (jump_to_scene, "scn_town_14_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_264",
      [],
      "town_14_arena:_generate",
      [
        (jump_to_scene, "scn_town_14_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_265",
      [],
      "town_14_castle:_indoors",
      [
        (jump_to_scene, "scn_town_14_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_266",
      [],
      "town_14_center:_generate",
      [
        (jump_to_scene, "scn_town_14_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_267",
      [],
      "town_14_prison:_indoors",
      [
        (jump_to_scene, "scn_town_14_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_268",
      [],
      "town_14_store:_indoors",
      [
        (jump_to_scene, "scn_town_14_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_269",
      [],
      "town_14_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_14_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_270",
      [],
      "town_14_walls:_generate",
      [
        (jump_to_scene, "scn_town_14_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_271",
      [],
      "town_15_alley:_generate",
      [
        (jump_to_scene, "scn_town_15_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_272",
      [],
      "town_15_arena:_generate",
      [
        (jump_to_scene, "scn_town_15_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_273", 0,
    "Choose a scene: (Page 22 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_286"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_260"),
      ]
      ),

      ("choose_scene_273",
      [],
      "town_15_castle:_indoors",
      [
        (jump_to_scene, "scn_town_15_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_274",
      [],
      "town_15_center:_generate",
      [
        (jump_to_scene, "scn_town_15_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_275",
      [],
      "town_15_prison:_indoors",
      [
        (jump_to_scene, "scn_town_15_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_276",
      [],
      "town_15_store:_indoors",
      [
        (jump_to_scene, "scn_town_15_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_277",
      [],
      "town_15_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_15_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_278",
      [],
      "town_15_walls:_generate",
      [
        (jump_to_scene, "scn_town_15_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_279",
      [],
      "town_16_alley:_generate",
      [
        (jump_to_scene, "scn_town_16_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_280",
      [],
      "town_16_arena:_generate",
      [
        (jump_to_scene, "scn_town_16_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_281",
      [],
      "town_16_castle:_indoors",
      [
        (jump_to_scene, "scn_town_16_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_282",
      [],
      "town_16_center:_generate",
      [
        (jump_to_scene, "scn_town_16_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_283",
      [],
      "town_16_prison:_indoors",
      [
        (jump_to_scene, "scn_town_16_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_284",
      [],
      "town_16_store:_indoors",
      [
        (jump_to_scene, "scn_town_16_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_285",
      [],
      "town_16_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_16_tavern"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_286", 0,
    "Choose a scene: (Page 23 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_299"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_273"),
      ]
      ),

      ("choose_scene_286",
      [],
      "town_16_walls:_generate",
      [
        (jump_to_scene, "scn_town_16_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_287",
      [],
      "town_17_alley:_generate",
      [
        (jump_to_scene, "scn_town_17_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_288",
      [],
      "town_17_arena:_generate",
      [
        (jump_to_scene, "scn_town_17_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_289",
      [],
      "town_17_castle:_indoors",
      [
        (jump_to_scene, "scn_town_17_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_290",
      [],
      "town_17_center:_generate",
      [
        (jump_to_scene, "scn_town_17_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_291",
      [],
      "town_17_prison:_indoors",
      [
        (jump_to_scene, "scn_town_17_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_292",
      [],
      "town_17_store:_indoors",
      [
        (jump_to_scene, "scn_town_17_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_293",
      [],
      "town_17_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_17_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_294",
      [],
      "town_17_walls:_generate",
      [
        (jump_to_scene, "scn_town_17_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_295",
      [],
      "town_18_alley:_generate",
      [
        (jump_to_scene, "scn_town_18_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_296",
      [],
      "town_18_arena:_generate",
      [
        (jump_to_scene, "scn_town_18_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_297",
      [],
      "town_18_castle:_generate",
      [
        (jump_to_scene, "scn_town_18_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_298",
      [],
      "town_18_center:_generate",
      [
        (jump_to_scene, "scn_town_18_center"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_299", 0,
    "Choose a scene: (Page 24 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_312"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_286"),
      ]
      ),

      ("choose_scene_299",
      [],
      "town_18_prison:_indoors",
      [
        (jump_to_scene, "scn_town_18_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_300",
      [],
      "town_18_store:_indoors",
      [
        (jump_to_scene, "scn_town_18_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_301",
      [],
      "town_18_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_18_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_302",
      [],
      "town_18_walls:_generate",
      [
        (jump_to_scene, "scn_town_18_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_303",
      [],
      "town_1_alley:_generate",
      [
        (jump_to_scene, "scn_town_1_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_304",
      [],
      "town_1_arena:_generate",
      [
        (jump_to_scene, "scn_town_1_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_305",
      [],
      "town_1_castle:_indoors",
      [
        (jump_to_scene, "scn_town_1_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_306",
      [],
      "town_1_center:_generate",
      [
        (jump_to_scene, "scn_town_1_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_307",
      [],
      "town_1_prison:_indoors",
      [
        (jump_to_scene, "scn_town_1_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_308",
      [],
      "town_1_room:_indoors",
      [
        (jump_to_scene, "scn_town_1_room"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_309",
      [],
      "town_1_store:_indoors",
      [
        (jump_to_scene, "scn_town_1_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_310",
      [],
      "town_1_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_1_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_311",
      [],
      "town_1_walls:_generate",
      [
        (jump_to_scene, "scn_town_1_walls"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_312", 0,
    "Choose a scene: (Page 25 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_325"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_299"),
      ]
      ),

      ("choose_scene_312",
      [],
      "town_2_alley:_generate",
      [
        (jump_to_scene, "scn_town_2_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_313",
      [],
      "town_2_arena:_generate",
      [
        (jump_to_scene, "scn_town_2_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_314",
      [],
      "town_2_castle:_indoors",
      [
        (jump_to_scene, "scn_town_2_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_315",
      [],
      "town_2_center:_generate",
      [
        (jump_to_scene, "scn_town_2_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_316",
      [],
      "town_2_prison:_indoors",
      [
        (jump_to_scene, "scn_town_2_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_317",
      [],
      "town_2_store:_indoors",
      [
        (jump_to_scene, "scn_town_2_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_318",
      [],
      "town_2_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_2_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_319",
      [],
      "town_2_walls:_generate",
      [
        (jump_to_scene, "scn_town_2_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_320",
      [],
      "town_3_alley:_generate",
      [
        (jump_to_scene, "scn_town_3_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_321",
      [],
      "town_3_arena:_generate",
      [
        (jump_to_scene, "scn_town_3_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_322",
      [],
      "town_3_castle:_indoors",
      [
        (jump_to_scene, "scn_town_3_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_323",
      [],
      "town_3_center:_generate",
      [
        (jump_to_scene, "scn_town_3_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_324",
      [],
      "town_3_prison:_indoors",
      [
        (jump_to_scene, "scn_town_3_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_325", 0,
    "Choose a scene: (Page 26 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_338"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_312"),
      ]
      ),

      ("choose_scene_325",
      [],
      "town_3_store:_indoors",
      [
        (jump_to_scene, "scn_town_3_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_326",
      [],
      "town_3_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_3_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_327",
      [],
      "town_3_walls:_generate",
      [
        (jump_to_scene, "scn_town_3_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_328",
      [],
      "town_4_alley:_generate",
      [
        (jump_to_scene, "scn_town_4_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_329",
      [],
      "town_4_arena:_generate",
      [
        (jump_to_scene, "scn_town_4_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_330",
      [],
      "town_4_castle:_indoors",
      [
        (jump_to_scene, "scn_town_4_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_331",
      [],
      "town_4_center:_generate",
      [
        (jump_to_scene, "scn_town_4_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_332",
      [],
      "town_4_prison:_indoors",
      [
        (jump_to_scene, "scn_town_4_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_333",
      [],
      "town_4_store:_indoors",
      [
        (jump_to_scene, "scn_town_4_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_334",
      [],
      "town_4_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_4_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_335",
      [],
      "town_4_walls:_generate",
      [
        (jump_to_scene, "scn_town_4_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_336",
      [],
      "town_5_alley:_generate",
      [
        (jump_to_scene, "scn_town_5_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_337",
      [],
      "town_5_arena:_generate",
      [
        (jump_to_scene, "scn_town_5_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_338", 0,
    "Choose a scene: (Page 27 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_351"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_325"),
      ]
      ),

      ("choose_scene_338",
      [],
      "town_5_castle:_indoors",
      [
        (jump_to_scene, "scn_town_5_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_339",
      [],
      "town_5_center:_generate",
      [
        (jump_to_scene, "scn_town_5_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_340",
      [],
      "town_5_prison:_indoors",
      [
        (jump_to_scene, "scn_town_5_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_341",
      [],
      "town_5_room:_indoors",
      [
        (jump_to_scene, "scn_town_5_room"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_342",
      [],
      "town_5_store:_indoors",
      [
        (jump_to_scene, "scn_town_5_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_343",
      [],
      "town_5_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_5_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_344",
      [],
      "town_5_walls:_generate",
      [
        (jump_to_scene, "scn_town_5_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_345",
      [],
      "town_6_alley:_generate",
      [
        (jump_to_scene, "scn_town_6_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_346",
      [],
      "town_6_arena:_generate",
      [
        (jump_to_scene, "scn_town_6_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_347",
      [],
      "town_6_castle:_indoors",
      [
        (jump_to_scene, "scn_town_6_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_348",
      [],
      "town_6_center:_generate",
      [
        (jump_to_scene, "scn_town_6_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_349",
      [],
      "town_6_prison:_indoors",
      [
        (jump_to_scene, "scn_town_6_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_350",
      [],
      "town_6_room:_indoors",
      [
        (jump_to_scene, "scn_town_6_room"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_351", 0,
    "Choose a scene: (Page 28 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_364"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_338"),
      ]
      ),

      ("choose_scene_351",
      [],
      "town_6_store:_indoors",
      [
        (jump_to_scene, "scn_town_6_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_352",
      [],
      "town_6_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_6_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_353",
      [],
      "town_6_walls:_generate",
      [
        (jump_to_scene, "scn_town_6_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_354",
      [],
      "town_7_alley:_generate",
      [
        (jump_to_scene, "scn_town_7_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_355",
      [],
      "town_7_arena:_generate",
      [
        (jump_to_scene, "scn_town_7_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_356",
      [],
      "town_7_castle:_indoors",
      [
        (jump_to_scene, "scn_town_7_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_357",
      [],
      "town_7_center:_generate",
      [
        (jump_to_scene, "scn_town_7_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_358",
      [],
      "town_7_prison:_indoors",
      [
        (jump_to_scene, "scn_town_7_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_359",
      [],
      "town_7_store:_indoors",
      [
        (jump_to_scene, "scn_town_7_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_360",
      [],
      "town_7_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_7_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_361",
      [],
      "town_7_walls:_generate",
      [
        (jump_to_scene, "scn_town_7_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_362",
      [],
      "town_8_alley:_generate",
      [
        (jump_to_scene, "scn_town_8_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_363",
      [],
      "town_8_arena:_generate",
      [
        (jump_to_scene, "scn_town_8_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_364", 0,
    "Choose a scene: (Page 29 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_377"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_351"),
      ]
      ),

      ("choose_scene_364",
      [],
      "town_8_castle:_indoors",
      [
        (jump_to_scene, "scn_town_8_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_365",
      [],
      "town_8_center:_generate",
      [
        (jump_to_scene, "scn_town_8_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_366",
      [],
      "town_8_prison:_indoors",
      [
        (jump_to_scene, "scn_town_8_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_367",
      [],
      "town_8_room:_indoors",
      [
        (jump_to_scene, "scn_town_8_room"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_368",
      [],
      "town_8_store:_indoors",
      [
        (jump_to_scene, "scn_town_8_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_369",
      [],
      "town_8_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_8_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_370",
      [],
      "town_8_walls:_generate",
      [
        (jump_to_scene, "scn_town_8_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_371",
      [],
      "town_9_alley:_generate",
      [
        (jump_to_scene, "scn_town_9_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_372",
      [],
      "town_9_arena:_generate",
      [
        (jump_to_scene, "scn_town_9_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_373",
      [],
      "town_9_castle:_indoors",
      [
        (jump_to_scene, "scn_town_9_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_374",
      [],
      "town_9_center:_generate",
      [
        (jump_to_scene, "scn_town_9_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_375",
      [],
      "town_9_prison:_indoors",
      [
        (jump_to_scene, "scn_town_9_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_376",
      [],
      "town_9_store:_indoors",
      [
        (jump_to_scene, "scn_town_9_store"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_377", 0,
    "Choose a scene: (Page 30 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_390"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_364"),
      ]
      ),

      ("choose_scene_377",
      [],
      "town_9_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_9_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_378",
      [],
      "town_9_walls:_generate",
      [
        (jump_to_scene, "scn_town_9_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_379",
      [],
      "training_ground_horse_track_1:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_380",
      [],
      "training_ground_horse_track_2:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_381",
      [],
      "training_ground_horse_track_3:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_382",
      [],
      "training_ground_horse_track_4:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_383",
      [],
      "training_ground_horse_track_5:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_384",
      [],
      "training_ground_noldor:_generate",
      [
        (jump_to_scene, "scn_training_ground_noldor"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_385",
      [],
      "training_ground_ranged_melee_1:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_386",
      [],
      "training_ground_ranged_melee_2:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_387",
      [],
      "training_ground_ranged_melee_3:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_388",
      [],
      "training_ground_ranged_melee_4:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_389",
      [],
      "training_ground_ranged_melee_5:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_5"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_390", 0,
    "Choose a scene: (Page 31 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_403"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_377"),
      ]
      ),

      ("choose_scene_390",
      [],
      "tutorial_1:_indoors",
      [
        (jump_to_scene, "scn_tutorial_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_391",
      [],
      "tutorial_2:_indoors",
      [
        (jump_to_scene, "scn_tutorial_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_392",
      [],
      "tutorial_3:_indoors",
      [
        (jump_to_scene, "scn_tutorial_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_393",
      [],
      "tutorial_4:_generate",
      [
        (jump_to_scene, "scn_tutorial_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_394",
      [],
      "tutorial_5:_generate",
      [
        (jump_to_scene, "scn_tutorial_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_395",
      [],
      "tutorial_training_ground:_generate",
      [
        (jump_to_scene, "scn_tutorial_training_ground"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_396",
      [],
      "village_1:_generate",
      [
        (jump_to_scene, "scn_village_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_397",
      [],
      "village_10:_generate",
      [
        (jump_to_scene, "scn_village_10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_398",
      [],
      "village_11:_generate",
      [
        (jump_to_scene, "scn_village_11"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_399",
      [],
      "village_12:_generate",
      [
        (jump_to_scene, "scn_village_12"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_400",
      [],
      "village_13:_generate",
      [
        (jump_to_scene, "scn_village_13"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_401",
      [],
      "village_14:_generate",
      [
        (jump_to_scene, "scn_village_14"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_402",
      [],
      "village_15:_generate",
      [
        (jump_to_scene, "scn_village_15"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_403", 0,
    "Choose a scene: (Page 32 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_416"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_390"),
      ]
      ),

      ("choose_scene_403",
      [],
      "village_16:_generate",
      [
        (jump_to_scene, "scn_village_16"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_404",
      [],
      "village_17:_generate",
      [
        (jump_to_scene, "scn_village_17"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_405",
      [],
      "village_18:_generate",
      [
        (jump_to_scene, "scn_village_18"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_406",
      [],
      "village_19:_generate",
      [
        (jump_to_scene, "scn_village_19"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_407",
      [],
      "village_2:_generate",
      [
        (jump_to_scene, "scn_village_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_408",
      [],
      "village_20:_generate",
      [
        (jump_to_scene, "scn_village_20"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_409",
      [],
      "village_21:_generate",
      [
        (jump_to_scene, "scn_village_21"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_410",
      [],
      "village_22:_generate",
      [
        (jump_to_scene, "scn_village_22"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_411",
      [],
      "village_23:_generate",
      [
        (jump_to_scene, "scn_village_23"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_412",
      [],
      "village_24:_generate",
      [
        (jump_to_scene, "scn_village_24"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_413",
      [],
      "village_25:_generate",
      [
        (jump_to_scene, "scn_village_25"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_414",
      [],
      "village_26:_generate",
      [
        (jump_to_scene, "scn_village_26"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_415",
      [],
      "village_27:_generate",
      [
        (jump_to_scene, "scn_village_27"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_416", 0,
    "Choose a scene: (Page 33 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_429"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_403"),
      ]
      ),

      ("choose_scene_416",
      [],
      "village_28:_generate",
      [
        (jump_to_scene, "scn_village_28"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_417",
      [],
      "village_29:_generate",
      [
        (jump_to_scene, "scn_village_29"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_418",
      [],
      "village_3:_generate",
      [
        (jump_to_scene, "scn_village_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_419",
      [],
      "village_30:_generate",
      [
        (jump_to_scene, "scn_village_30"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_420",
      [],
      "village_31:_generate",
      [
        (jump_to_scene, "scn_village_31"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_421",
      [],
      "village_32:_generate",
      [
        (jump_to_scene, "scn_village_32"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_422",
      [],
      "village_33:_generate",
      [
        (jump_to_scene, "scn_village_33"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_423",
      [],
      "village_34:_generate",
      [
        (jump_to_scene, "scn_village_34"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_424",
      [],
      "village_35:_generate",
      [
        (jump_to_scene, "scn_village_35"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_425",
      [],
      "village_36:_generate",
      [
        (jump_to_scene, "scn_village_36"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_426",
      [],
      "village_37:_generate",
      [
        (jump_to_scene, "scn_village_37"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_427",
      [],
      "village_38:_generate",
      [
        (jump_to_scene, "scn_village_38"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_428",
      [],
      "village_39:_generate",
      [
        (jump_to_scene, "scn_village_39"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_429", 0,
    "Choose a scene: (Page 34 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_442"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_416"),
      ]
      ),

      ("choose_scene_429",
      [],
      "village_4:_generate",
      [
        (jump_to_scene, "scn_village_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_430",
      [],
      "village_40:_generate",
      [
        (jump_to_scene, "scn_village_40"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_431",
      [],
      "village_41:_generate",
      [
        (jump_to_scene, "scn_village_41"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_432",
      [],
      "village_42:_generate",
      [
        (jump_to_scene, "scn_village_42"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_433",
      [],
      "village_43:_generate",
      [
        (jump_to_scene, "scn_village_43"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_434",
      [],
      "village_44:_generate",
      [
        (jump_to_scene, "scn_village_44"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_435",
      [],
      "village_45:_generate",
      [
        (jump_to_scene, "scn_village_45"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_436",
      [],
      "village_46:_generate",
      [
        (jump_to_scene, "scn_village_46"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_437",
      [],
      "village_47:_generate",
      [
        (jump_to_scene, "scn_village_47"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_438",
      [],
      "village_48:_generate",
      [
        (jump_to_scene, "scn_village_48"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_439",
      [],
      "village_49:_generate",
      [
        (jump_to_scene, "scn_village_49"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_440",
      [],
      "village_5:_generate",
      [
        (jump_to_scene, "scn_village_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_441",
      [],
      "village_50:_generate",
      [
        (jump_to_scene, "scn_village_50"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_442", 0,
    "Choose a scene: (Page 35 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_455"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_429"),
      ]
      ),

      ("choose_scene_442",
      [],
      "village_51:_generate",
      [
        (jump_to_scene, "scn_village_51"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_443",
      [],
      "village_52:_generate",
      [
        (jump_to_scene, "scn_village_52"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_444",
      [],
      "village_53:_generate",
      [
        (jump_to_scene, "scn_village_53"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_445",
      [],
      "village_54:_generate",
      [
        (jump_to_scene, "scn_village_54"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_446",
      [],
      "village_55:_generate",
      [
        (jump_to_scene, "scn_village_55"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_447",
      [],
      "village_56:_generate",
      [
        (jump_to_scene, "scn_village_56"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_448",
      [],
      "village_57:_generate",
      [
        (jump_to_scene, "scn_village_57"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_449",
      [],
      "village_58:_generate",
      [
        (jump_to_scene, "scn_village_58"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_450",
      [],
      "village_59:_generate",
      [
        (jump_to_scene, "scn_village_59"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_451",
      [],
      "village_6:_generate",
      [
        (jump_to_scene, "scn_village_6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_452",
      [],
      "village_60:_generate",
      [
        (jump_to_scene, "scn_village_60"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_453",
      [],
      "village_61:_generate",
      [
        (jump_to_scene, "scn_village_61"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_454",
      [],
      "village_62:_generate",
      [
        (jump_to_scene, "scn_village_62"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_455", 0,
    "Choose a scene: (Page 36 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_468"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_442"),
      ]
      ),

      ("choose_scene_455",
      [],
      "village_63:_generate",
      [
        (jump_to_scene, "scn_village_63"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_456",
      [],
      "village_64:_generate",
      [
        (jump_to_scene, "scn_village_64"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_457",
      [],
      "village_65:_generate",
      [
        (jump_to_scene, "scn_village_65"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_458",
      [],
      "village_66:_generate",
      [
        (jump_to_scene, "scn_village_66"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_459",
      [],
      "village_67:_generate",
      [
        (jump_to_scene, "scn_village_67"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_460",
      [],
      "village_68:_generate",
      [
        (jump_to_scene, "scn_village_68"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_461",
      [],
      "village_69:_generate",
      [
        (jump_to_scene, "scn_village_69"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_462",
      [],
      "village_7:_generate",
      [
        (jump_to_scene, "scn_village_7"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_463",
      [],
      "village_70:_generate",
      [
        (jump_to_scene, "scn_village_70"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_464",
      [],
      "village_71:_generate",
      [
        (jump_to_scene, "scn_village_71"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_465",
      [],
      "village_72:_generate",
      [
        (jump_to_scene, "scn_village_72"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_466",
      [],
      "village_73:_generate",
      [
        (jump_to_scene, "scn_village_73"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_467",
      [],
      "village_74:_generate",
      [
        (jump_to_scene, "scn_village_74"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_468", 0,
    "Choose a scene: (Page 37 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_481"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_455"),
      ]
      ),

      ("choose_scene_468",
      [],
      "village_75:_generate",
      [
        (jump_to_scene, "scn_village_75"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_469",
      [],
      "village_76:_generate",
      [
        (jump_to_scene, "scn_village_76"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_470",
      [],
      "village_77:_generate",
      [
        (jump_to_scene, "scn_village_77"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_471",
      [],
      "village_78:_generate",
      [
        (jump_to_scene, "scn_village_78"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_472",
      [],
      "village_79:_generate",
      [
        (jump_to_scene, "scn_village_79"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_473",
      [],
      "village_8:_generate",
      [
        (jump_to_scene, "scn_village_8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_474",
      [],
      "village_80:_generate",
      [
        (jump_to_scene, "scn_village_80"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_475",
      [],
      "village_81:_generate",
      [
        (jump_to_scene, "scn_village_81"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_476",
      [],
      "village_82:_generate",
      [
        (jump_to_scene, "scn_village_82"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_477",
      [],
      "village_83:_generate",
      [
        (jump_to_scene, "scn_village_83"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_478",
      [],
      "village_84:_generate",
      [
        (jump_to_scene, "scn_village_84"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_479",
      [],
      "village_85:_generate",
      [
        (jump_to_scene, "scn_village_85"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_480",
      [],
      "village_86:_generate",
      [
        (jump_to_scene, "scn_village_86"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_481", 0,
    "Choose a scene: (Page 38 of 38)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_468"),
      ]
      ),

      ("choose_scene_481",
      [],
      "village_87:_generate",
      [
        (jump_to_scene, "scn_village_87"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_482",
      [],
      "village_88:_generate",
      [
        (jump_to_scene, "scn_village_88"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_483",
      [],
      "village_89:_generate",
      [
        (jump_to_scene, "scn_village_89"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_484",
      [],
      "village_9:_generate",
      [
        (jump_to_scene, "scn_village_9"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_485",
      [],
      "village_90:_generate",
      [
        (jump_to_scene, "scn_village_90"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_486",
      [],
      "water",
      [
        (jump_to_scene, "scn_water"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_487",
      [],
      "wedding:_indoors",
      [
        (jump_to_scene, "scn_wedding"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_488",
      [],
      "zendar_arena:_generate",
      [
        (jump_to_scene, "scn_zendar_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

]
